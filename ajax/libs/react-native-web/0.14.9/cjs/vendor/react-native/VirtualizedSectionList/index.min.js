"use strict";exports.__esModule=!0,exports.default=void 0;var React=_interopRequireWildcard(require("react")),_View=_interopRequireDefault(require("../../../exports/View")),_VirtualizedList=_interopRequireDefault(require("../VirtualizedList")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,n,i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&((n=o?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var VirtualizedSectionList=function(r){_inheritsLoose(t,r);var e=t.prototype;function t(e,t){var a=r.call(this,e,t)||this;return a._keyExtractor=function(e,t){var r=a._subExtractor(t);return r&&r.key||String(t)},a._convertViewable=function(e){(0,_invariant.default)(null!=e.index,"Received a broken ViewToken");var t=a._subExtractor(e.index);if(!t)return null;var r=t.section.keyExtractor||a.props.keyExtractor;return _objectSpread({},e,{index:t.index,key:r(e.item,t.index),section:t.section})},a._onViewableItemsChanged=function(e){var t=e.viewableItems,e=e.changed;a.props.onViewableItemsChanged&&a.props.onViewableItemsChanged({viewableItems:t.map(a._convertViewable,_assertThisInitialized(a)).filter(Boolean),changed:e.map(a._convertViewable,_assertThisInitialized(a)).filter(Boolean)})},a._renderItem=function(e){var t=e.item,r=e.index,n=a._subExtractor(r);if(!n)return null;e=n.index;if(null==e){var i=n.section;if(!0===n.header){var o=a.props.renderSectionHeader;return o?o({section:i}):null}o=a.props.renderSectionFooter;return o?o({section:i}):null}o=n.section.renderItem||a.props.renderItem,i=a._getSeparatorComponent(r,n);return(0,_invariant.default)(o,"no renderItem!"),React.createElement(ItemWithSeparator,{SeparatorComponent:i,LeadingSeparatorComponent:0===e?a.props.SectionSeparatorComponent:void 0,cellKey:n.key,index:e,item:t,leadingItem:n.leadingItem,leadingSection:n.leadingSection,onUpdateSeparator:a._onUpdateSeparator,prevCellKey:(a._subExtractor(r-1)||{}).key,ref:function(e){a._cellRefs[n.key]=e},renderItem:o,section:n.section,trailingItem:n.trailingItem,trailingSection:n.trailingSection})},a._onUpdateSeparator=function(e,t){e=a._cellRefs[e];e&&e.updateSeparatorProps(t)},a._cellRefs={},a._captureRef=function(e){a._listRef=e},a.state=a._computeState(e),a}return e.scrollToLocation=function(e){for(var t=e.itemIndex,r=0;r<e.sectionIndex;r++)t+=this.props.getItemCount(this.props.sections[r].data)+2;var n=0;0<e.itemIndex&&this.props.stickySectionHeadersEnabled&&(n=this._listRef._getFrameMetricsApprox(t-e.itemIndex).length);n=_objectSpread({},e,{viewOffset:n,index:t});this._listRef.scrollToIndex(n)},e.getListRef=function(){return this._listRef},e.UNSAFE_componentWillReceiveProps=function(e){this.setState(this._computeState(e))},e._computeState=function(r){var n=r.ListHeaderComponent?1:0,i=[],e=r.sections?r.sections.reduce(function(e,t){return i.push(e+n),e+r.getItemCount(t.data)+2},0):0;return{childProps:_objectSpread({},r,{renderItem:this._renderItem,ItemSeparatorComponent:void 0,data:r.sections,getItemCount:function(){return e},getItem:function(e,t){return _getItem(r,e,t)},keyExtractor:this._keyExtractor,onViewableItemsChanged:r.onViewableItemsChanged?this._onViewableItemsChanged:void 0,stickyHeaderIndices:r.stickySectionHeadersEnabled?i:void 0})}},e.render=function(){return React.createElement(_VirtualizedList.default,_extends({},this.state.childProps,{ref:this._captureRef}))},e._subExtractor=function(e){for(var t=e,e=this.props,r=e.getItem,n=e.getItemCount,i=e.keyExtractor,o=e.sections,a=0;a<o.length;a++){var s=o[a],c=s.data,p=s.key||String(a);if(--t,t>=n(c)+1)t-=n(c)+1;else return-1===t?{section:s,key:p+":header",index:null,header:!0,trailingSection:o[a+1]}:t===n(c)?{section:s,key:p+":footer",index:null,header:!1,trailingSection:o[a+1]}:{section:s,key:p+":"+(s.keyExtractor||i)(r(c,t),t),index:t,leadingItem:r(c,t-1),leadingSection:o[a-1],trailingItem:r(c,t+1),trailingSection:o[a+1]}}},e._getSeparatorComponent=function(e,t){if(!(t=t||this._subExtractor(e)))return null;var r=t.section.ItemSeparatorComponent||this.props.ItemSeparatorComponent,n=this.props.SectionSeparatorComponent,e=e===this.state.childProps.getItemCount()-1,t=t.index===this.props.getItemCount(t.section.data)-1;return n&&t?n:!r||t||e?null:r},t}(React.PureComponent);VirtualizedSectionList.defaultProps=_objectSpread({},_VirtualizedList.default.defaultProps,{data:[]});var ItemWithSeparator=function(n){function e(){for(var o,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(o=n.call.apply(n,[this].concat(t))||this).state={separatorProps:{highlighted:!1,leadingItem:o.props.item,leadingSection:o.props.leadingSection,section:o.props.section,trailingItem:o.props.trailingItem,trailingSection:o.props.trailingSection},leadingSeparatorProps:{highlighted:!1,leadingItem:o.props.leadingItem,leadingSection:o.props.leadingSection,section:o.props.section,trailingItem:o.props.item,trailingSection:o.props.trailingSection}},o._separators={highlight:function(){["leading","trailing"].forEach(function(e){return o._separators.updateProps(e,{highlighted:!0})})},unhighlight:function(){["leading","trailing"].forEach(function(e){return o._separators.updateProps(e,{highlighted:!1})})},updateProps:function(e,t){var r=o.props,n=r.LeadingSeparatorComponent,i=r.cellKey,r=r.prevCellKey;"leading"===e&&null!=n?o.setState(function(e){return{leadingSeparatorProps:_objectSpread({},e.leadingSeparatorProps,{},t)}}):o.props.onUpdateSeparator("leading"===e&&r||i,t)}},o}_inheritsLoose(e,n),e.getDerivedStateFromProps=function(e,t){return{separatorProps:_objectSpread({},t.separatorProps,{leadingItem:e.item,leadingSection:e.leadingSection,section:e.section,trailingItem:e.trailingItem,trailingSection:e.trailingSection}),leadingSeparatorProps:_objectSpread({},t.leadingSeparatorProps,{leadingItem:e.leadingItem,leadingSection:e.leadingSection,section:e.section,trailingItem:e.item,trailingSection:e.trailingSection})}};var t=e.prototype;return t.updateSeparatorProps=function(t){this.setState(function(e){return{separatorProps:_objectSpread({},e.separatorProps,{},t)}})},t.render=function(){var e=this.props,t=e.LeadingSeparatorComponent,r=e.SeparatorComponent,n=e.item,i=e.index,e=e.section,e=this.props.renderItem({item:n,index:i,section:e,separators:this._separators}),t=t&&React.createElement(t,this.state.leadingSeparatorProps),r=r&&React.createElement(r,this.state.separatorProps);return t||r?React.createElement(_View.default,null,t,e,r):e},e}(React.Component);function _getItem(e,t,r){if(!t)return null;for(var n=r-1,i=0;i<t.length;i++){var o=t[i],a=o.data,s=e.getItemCount(a);if(-1===n||n===s)return o;if(n<s)return e.getItem(a,n);n-=s+2}return null}var _default=VirtualizedSectionList;exports.default=VirtualizedSectionList,module.exports=exports.default;