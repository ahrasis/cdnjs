"use strict";exports.__esModule=!0,exports.default=void 0;var _Batchinator=_interopRequireDefault(require("../Batchinator")),_FillRateHelper=_interopRequireDefault(require("../FillRateHelper")),_propTypes=_interopRequireDefault(require("prop-types")),React=_interopRequireWildcard(require("react")),_RefreshControl=_interopRequireDefault(require("../../../exports/RefreshControl")),_ScrollView=_interopRequireDefault(require("../../../exports/ScrollView")),_StyleSheet=_interopRequireDefault(require("../../../exports/StyleSheet")),_UIManager=_interopRequireDefault(require("../../../exports/UIManager")),_View=_interopRequireDefault(require("../../../exports/View")),_ViewabilityHelper=_interopRequireDefault(require("../ViewabilityHelper")),_findNodeHandle=_interopRequireDefault(require("../../../exports/findNodeHandle")),_infoLog=_interopRequireDefault(require("../infoLog")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_warning=_interopRequireDefault(require("fbjs/lib/warning")),_VirtualizeUtils=require("../VirtualizeUtils");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,i,s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&((i=o?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(s,r,i):s[r]=e[r]);return s.default=e,t&&t.set(e,s),s}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ownKeys(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var flattenStyle=_StyleSheet.default.flatten,__DEV__="production"!==process.env.NODE_ENV,_usedIndexForKey=!1,_keylessItemComponentName="",VirtualizedList=function(r){_inheritsLoose(t,r);var e=t.prototype;function t(e,t){var m=r.call(this,e,t)||this;m._getScrollMetrics=function(){return m._scrollMetrics},m._getOutermostParentListRef=function(){return m._isNestedWithSameOrientation()?m.context.virtualizedList.getOutermostParentListRef():_assertThisInitialized(m)},m._getNestedChildState=function(e){e=m._nestedChildLists.get(e);return e&&e.state},m._registerAsNestedChild=function(e){var t=m._cellKeysToChildListKeys.get(e.cellKey)||new Set;t.add(e.key),m._cellKeysToChildListKeys.set(e.cellKey,t);t=m._nestedChildLists.get(e.key);t&&null!==t.ref&&console.error("A VirtualizedList contains a cell which itself contains more than one VirtualizedList of the same orientation as the parent list. You must pass a unique listKey prop to each sibling list."),m._nestedChildLists.set(e.key,{ref:e.ref,state:null}),m._hasInteracted&&e.ref.recordInteraction()},m._unregisterAsNestedChild=function(e){m._nestedChildLists.set(e.key,{ref:null,state:e.state})},m._onUpdateSeparators=function(e,t){e.forEach(function(e){e=null!=e&&m._cellRefs[e];e&&e.updateSeparatorProps(t)})},m._averageCellLength=0,m._cellKeysToChildListKeys=new Map,m._cellRefs={},m._frames={},m._footerLength=0,m._hasDataChangedSinceEndReached=!0,m._hasDoneInitialScroll=!1,m._hasInteracted=!1,m._hasMore=!1,m._hasWarned={},m._headerLength=0,m._hiPriInProgress=!1,m._highestMeasuredFrameIndex=0,m._indicesToKeys=new Map,m._nestedChildLists=new Map,m._offsetFromParentVirtualizedList=0,m._prevParentOffset=0,m._scrollMetrics={contentLength:0,dOffset:0,dt:10,offset:0,timestamp:0,velocity:0,visibleLength:0},m._scrollRef=null,m._sentEndForContentLength=0,m._totalCellLength=0,m._totalCellsMeasured=0,m._viewabilityTuples=[],m._captureScrollRef=function(e){m._scrollRef=e},m._defaultRenderScrollComponent=function(e){var t=e.onRefresh;return m._isNestedWithSameOrientation()?React.createElement(_View.default,e):t?((0,_invariant.default)("boolean"==typeof e.refreshing,"`refreshing` prop must be set as a boolean in order to use `onRefresh`, but got `"+JSON.stringify(e.refreshing)+"`"),React.createElement(_ScrollView.default,_extends({},e,{refreshControl:null==e.refreshControl?React.createElement(_RefreshControl.default,{refreshing:e.refreshing,onRefresh:t,progressViewOffset:e.progressViewOffset}):e.refreshControl}))):React.createElement(_ScrollView.default,e)},m._onCellUnmount=function(e){var t=m._frames[e];t&&(m._frames[e]=_objectSpread({},t,{inLayout:!1}))},m._onLayout=function(e){m._isNestedWithSameOrientation()?m.measureLayoutRelativeToContainingList():m._scrollMetrics.visibleLength=m._selectLength(e.nativeEvent.layout),m.props.onLayout&&m.props.onLayout(e),m._scheduleCellsToRenderUpdate(),m._maybeCallOnEndReached()},m._onLayoutEmpty=function(e){m.props.onLayout&&m.props.onLayout(e)},m._onLayoutFooter=function(e){m._footerLength=m._selectLength(e.nativeEvent.layout)},m._onLayoutHeader=function(e){m._headerLength=m._selectLength(e.nativeEvent.layout)},m._onContentSizeChange=function(e,t){0<e&&0<t&&null!=m.props.initialScrollIndex&&0<m.props.initialScrollIndex&&!m._hasDoneInitialScroll&&(m.scrollToIndex({animated:!1,index:m.props.initialScrollIndex}),m._hasDoneInitialScroll=!0),m.props.onContentSizeChange&&m.props.onContentSizeChange(e,t),m._scrollMetrics.contentLength=m._selectLength({height:t,width:e}),m._scheduleCellsToRenderUpdate(),m._maybeCallOnEndReached()},m._convertParentScrollMetrics=function(e){var t=e.offset-m._offsetFromParentVirtualizedList,r=e.visibleLength,e=t-m._scrollMetrics.offset;return{visibleLength:r,contentLength:m._scrollMetrics.contentLength,offset:t,dOffset:e}},m._onScroll=function(t){m._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScroll(t)}),m.props.onScroll&&m.props.onScroll(t);var e=t.timeStamp,r=m._selectLength(t.nativeEvent.layoutMeasurement),i=m._selectLength(t.nativeEvent.contentSize),s=(n=m._selectOffset(t.nativeEvent.contentOffset))-m._scrollMetrics.offset;if(m._isNestedWithSameOrientation()){if(0===m._scrollMetrics.contentLength)return;var o=m._convertParentScrollMetrics({visibleLength:r,offset:n}),r=o.visibleLength,i=o.contentLength,n=o.offset,s=o.dOffset}var l=m._scrollMetrics.timestamp?Math.max(1,e-m._scrollMetrics.timestamp):1,o=s/l;500<l&&500<m._scrollMetrics.dt&&5*r<i&&!m._hasWarned.perf&&((0,_infoLog.default)("VirtualizedList: You have a large list that is slow to update - make sure your renderItem function renders components that follow React performance best practices like PureComponent, shouldComponentUpdate, etc.",{dt:l,prevDt:m._scrollMetrics.dt,contentLength:i}),m._hasWarned.perf=!0),m._scrollMetrics={contentLength:i,dt:l,dOffset:s,offset:n,timestamp:e,velocity:o,visibleLength:r},m._updateViewableItems(m.props.data),m.props&&(m._maybeCallOnEndReached(),0!=o&&m._fillRateHelper.activate(),m._computeBlankness(),m._scheduleCellsToRenderUpdate())},m._onScrollBeginDrag=function(t){m._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScrollBeginDrag(t)}),m._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),m._hasInteracted=!0,m.props.onScrollBeginDrag&&m.props.onScrollBeginDrag(t)},m._onScrollEndDrag=function(e){var t=e.nativeEvent.velocity;t&&(m._scrollMetrics.velocity=m._selectOffset(t)),m._computeBlankness(),m.props.onScrollEndDrag&&m.props.onScrollEndDrag(e)},m._onMomentumScrollEnd=function(e){m._scrollMetrics.velocity=0,m._computeBlankness(),m.props.onMomentumScrollEnd&&m.props.onMomentumScrollEnd(e)},m._updateCellsToRender=function(){var e=m.props,f=e.data,_=e.getItemCount,g=e.onEndReachedThreshold,y=m._isVirtualizationDisabled();m._updateViewableItems(f),f&&m.setState(function(e){var t,r,i,s;if(y?(t=(i=m._scrollMetrics).contentLength,r=i.offset,i=t-(i=i.visibleLength)-r<g*i?m.props.maxToRenderPerBatch:0,s={first:0,last:Math.min(e.last+i,_(f)-1)}):m._scrollMetrics.visibleLength&&(m.props.initialScrollIndex&&!m._scrollMetrics.offset||(s=(0,_VirtualizeUtils.computeWindowedRenderLimits)(m.props,e,m._getFrameMetricsApprox,m._scrollMetrics))),s&&0<m._nestedChildLists.size)for(var e=s.first,o=s.last,n=e;n<=o;n++){var l=m._indicesToKeys.get(n),l=l&&m._cellKeysToChildListKeys.get(l);if(l){for(var a,c=!1,p=l,h=Array.isArray(p),d=0,p=h?p:p[Symbol.iterator]();;){if(h){if(d>=p.length)break;a=p[d++]}else{if((d=p.next()).done)break;a=d.value}var u=m._nestedChildLists.get(a);if(u&&u.ref&&u.ref.hasMore()){c=!0;break}}if(c){s.last=n;break}}}return s})},m._createViewToken=function(e,t){var r=m.props,i=r.data,s=r.getItem,r=r.keyExtractor,i=s(i,e);return{index:e,item:i,key:r(i,e),isViewable:t}},m._getFrameMetricsApprox=function(e){var t=m._getFrameMetrics(e);if(t&&t.index===e)return t;t=m.props.getItemLayout;return(0,_invariant.default)(!t,"Should not have to estimate frames when a measurement metrics function is provided"),{length:m._averageCellLength,offset:m._averageCellLength*e}},m._getFrameMetrics=function(e){var t=m.props,r=t.data,i=t.getItem,s=t.getItemCount,o=t.getItemLayout,t=t.keyExtractor;(0,_invariant.default)(s(r)>e,"Tried to get frame for out of range index "+e);i=i(r,e),i=i&&m._frames[t(i,e)];return i&&i.index===e||o&&(i=o(r,e),__DEV__&&(e=_propTypes.default.shape({length:_propTypes.default.number.isRequired,offset:_propTypes.default.number.isRequired,index:_propTypes.default.number.isRequired}).isRequired,_propTypes.default.checkPropTypes({frame:e},{frame:i},"frame","VirtualizedList.getItemLayout"))),i},(0,_invariant.default)(!e.onScroll||!e.onScroll.__isNative,"Components based on VirtualizedList must be wrapped with Animated.createAnimatedComponent to support native onScroll events with useNativeDriver"),(0,_invariant.default)(0<e.windowSize,"VirtualizedList: The windowSize prop must be present and set to a value greater than 0."),m._fillRateHelper=new _FillRateHelper.default(m._getFrameMetrics),m._updateCellsToRenderBatcher=new _Batchinator.default(m._updateCellsToRender,m.props.updateCellsBatchingPeriod),m.props.viewabilityConfigCallbackPairs?m._viewabilityTuples=m.props.viewabilityConfigCallbackPairs.map(function(e){return{viewabilityHelper:new _ViewabilityHelper.default(e.viewabilityConfig),onViewableItemsChanged:e.onViewableItemsChanged}}):m.props.onViewableItemsChanged&&m._viewabilityTuples.push({viewabilityHelper:new _ViewabilityHelper.default(m.props.viewabilityConfig),onViewableItemsChanged:m.props.onViewableItemsChanged});t={first:m.props.initialScrollIndex||0,last:Math.min(m.props.getItemCount(m.props.data),(m.props.initialScrollIndex||0)+m.props.initialNumToRender)-1};return!m._isNestedWithSameOrientation()||(e=m.context.virtualizedList.getNestedChildState(m.props.listKey||m._getCellKey()))&&(t=e,m.state=e,m._frames=e.frames),m.state=t,m}return e.scrollToEnd=function(e){var t=!e||e.animated,e=this.props.getItemCount(this.props.data)-1,e=this._getFrameMetricsApprox(e),e=Math.max(0,e.offset+e.length+this._footerLength-this._scrollMetrics.visibleLength);this._scrollRef.scrollTo(this.props.horizontal?{x:e,animated:t}:{y:e,animated:t})},e.scrollToIndex=function(e){var t=this.props,r=t.data,i=t.horizontal,s=t.getItemCount,o=t.getItemLayout,n=t.onScrollToIndexFailed,l=e.animated,a=e.index,t=e.viewOffset,e=e.viewPosition;if((0,_invariant.default)(0<=a&&a<s(r),"scrollToIndex out of range: "+a+" vs "+(s(r)-1)),!o&&a>this._highestMeasuredFrameIndex)return(0,_invariant.default)(!!n,"scrollToIndex should be used in conjunction with getItemLayout or onScrollToIndexFailed, otherwise there is no way to know the location of offscreen indices or handle failures."),void n({averageItemLength:this._averageCellLength,highestMeasuredFrameIndex:this._highestMeasuredFrameIndex,index:a});a=this._getFrameMetricsApprox(a),t=Math.max(0,a.offset-(e||0)*(this._scrollMetrics.visibleLength-a.length))-(t||0);this._scrollRef.scrollTo(i?{x:t,animated:l}:{y:t,animated:l})},e.scrollToItem=function(e){for(var t=e.item,r=this.props,i=r.data,s=r.getItem,o=(0,r.getItemCount)(i),n=0;n<o;n++)if(s(i,n)===t){this.scrollToIndex(_objectSpread({},e,{index:n}));break}},e.scrollToOffset=function(e){var t=e.animated,e=e.offset;this._scrollRef.scrollTo(this.props.horizontal?{x:e,animated:t}:{y:e,animated:t})},e.recordInteraction=function(){this._nestedChildLists.forEach(function(e){e.ref&&e.ref.recordInteraction()}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),this._updateViewableItems(this.props.data)},e.flashScrollIndicators=function(){this._scrollRef.flashScrollIndicators()},e.getScrollResponder=function(){if(this._scrollRef&&this._scrollRef.getScrollResponder)return this._scrollRef.getScrollResponder()},e.getScrollableNode=function(){return this._scrollRef&&this._scrollRef.getScrollableNode?this._scrollRef.getScrollableNode():(0,_findNodeHandle.default)(this._scrollRef)},e.getScrollRef=function(){return this._scrollRef&&this._scrollRef.getScrollRef?this._scrollRef.getScrollRef():this._scrollRef},e.setNativeProps=function(e){this._scrollRef&&this._scrollRef.setNativeProps(e)},e.getChildContext=function(){return{virtualizedList:{getScrollMetrics:this._getScrollMetrics,horizontal:this.props.horizontal,getOutermostParentListRef:this._getOutermostParentListRef,getNestedChildState:this._getNestedChildState,registerAsNestedChild:this._registerAsNestedChild,unregisterAsNestedChild:this._unregisterAsNestedChild}}},e._getCellKey=function(){return this.context.virtualizedCell&&this.context.virtualizedCell.cellKey||"rootList"},e.hasMore=function(){return this._hasMore},e.componentDidMount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.registerAsNestedChild({cellKey:this._getCellKey(),key:this.props.listKey||this._getCellKey(),ref:this})},e.componentWillUnmount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.unregisterAsNestedChild({key:this.props.listKey||this._getCellKey(),state:{first:this.state.first,last:this.state.last,frames:this._frames}}),this._updateViewableItems(null),this._updateCellsToRenderBatcher.dispose({abort:!0}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.dispose()}),this._fillRateHelper.deactivateAndFlush()},t.getDerivedStateFromProps=function(e,t){var r=e.data,i=e.getItemCount,e=e.maxToRenderPerBatch;return{first:Math.max(0,Math.min(t.first,i(r)-1-e)),last:Math.max(0,Math.min(t.last,i(r)-1))}},e._pushCells=function(i,s,o,e,t,n){var l,a=this,r=this.props,c=r.CellRendererComponent,p=r.ItemSeparatorComponent,h=r.data,d=r.getItem,u=r.getItemCount,f=r.horizontal,_=r.keyExtractor,g=this.props.ListHeaderComponent?1:0,y=u(h)-1;t=Math.min(y,t);for(var m=e;m<=t;m++)!function(t){var e=d(h,t),r=_(e,t);a._indicesToKeys.set(t,r),o.has(t+g)&&s.push(i.length),i.push(React.createElement(CellRenderer,{CellRendererComponent:c,ItemSeparatorComponent:t<y?p:void 0,cellKey:r,fillRateHelper:a._fillRateHelper,horizontal:f,index:t,inversionStyle:n,item:e,key:r,prevCellKey:l,onUpdateSeparators:a._onUpdateSeparators,onLayout:function(e){return a._onCellLayout(e,r,t)},onUnmount:a._onCellUnmount,parentProps:a.props,ref:function(e){a._cellRefs[r]=e}})),l=r}(m)},e._isVirtualizationDisabled=function(){return this.props.disableVirtualization||!1},e._isNestedWithSameOrientation=function(){var e=this.context.virtualizedList;return!(!e||!!e.horizontal!=!!this.props.horizontal)},e.render=function(){var t=this;__DEV__&&(l=flattenStyle(this.props.contentContainerStyle),(0,_warning.default)(null==l||"wrap"!==l.flexWrap,"`flexWrap: `wrap`` is not supported with the `VirtualizedList` components.Consider using `numColumns` with `FlatList` instead."));var e=this.props,r=e.ListEmptyComponent,i=e.ListFooterComponent,s=e.ListHeaderComponent,o=this.props,n=o.data,l=o.horizontal,e=this._isVirtualizationDisabled(),a=this.props.inverted?this.props.horizontal?styles.horizontallyInverted:styles.verticallyInverted:null,c=[],p=new Set(this.props.stickyHeaderIndices),h=[];s&&(p.has(0)&&h.push(0),_=React.isValidElement(s)?s:React.createElement(s,null),c.push(React.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-header",key:"$header"},React.createElement(_View.default,{onLayout:this._onLayoutHeader,style:_StyleSheet.default.compose(a,this.props.ListHeaderComponentStyle)},_))));var d,o=this.props.getItemCount(n);if(0<o){_usedIndexForKey=!1,_keylessItemComponentName="";var u=l?"width":"height",f=this.props.initialScrollIndex?-1:this.props.initialNumToRender-1,_=this.state,g=_.first,n=_.last;this._pushCells(c,h,p,0,f,a);l=Math.max(1+f,g);if(!e&&1+f<g){var y=!1;if(0<p.size)for(var m=s?1:0,v=l-1;f<v;v--)if(p.has(v+m)){var C=this._getFrameMetricsApprox(f),L=this._getFrameMetricsApprox(v),b=L.offset-C.offset-(this.props.initialScrollIndex?0:C.length);c.push(React.createElement(_View.default,{key:"$sticky_lead",style:((C={})[u]=b,C)})),this._pushCells(c,h,p,v,v,a);C=this._getFrameMetricsApprox(g).offset-(L.offset+L.length);c.push(React.createElement(_View.default,{key:"$sticky_trail",style:((L={})[u]=C,L)})),y=!0;break}y||(_=this._getFrameMetricsApprox(f),s=this._getFrameMetricsApprox(g).offset-(_.offset+_.length),c.push(React.createElement(_View.default,{key:"$lead_spacer",style:((_={})[u]=s,_)})))}this._pushCells(c,h,p,l,n,a),!this._hasWarned.keys&&_usedIndexForKey&&(console.warn("VirtualizedList: missing keys for items, make sure to specify a key or id property on each item or provide a custom keyExtractor.",_keylessItemComponentName),this._hasWarned.keys=!0),!e&&n<o-1&&(n=this._getFrameMetricsApprox(n),o=this.props.getItemLayout?o-1:Math.min(o-1,this._highestMeasuredFrameIndex),o=(o=this._getFrameMetricsApprox(o)).offset+o.length-(n.offset+n.length),c.push(React.createElement(_View.default,{key:"$tail_spacer",style:((n={})[u]=o,n)})))}else r&&(d=React.isValidElement(r)?r:React.createElement(r,null),c.push(React.cloneElement(d,{key:"$empty",onLayout:function(e){t._onLayoutEmpty(e),d.props.onLayout&&d.props.onLayout(e)},style:_StyleSheet.default.compose(a,d.props.style)})));i&&(R=React.isValidElement(i)?i:React.createElement(i,null),c.push(React.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-footer",key:"$footer"},React.createElement(_View.default,{onLayout:this._onLayoutFooter,style:_StyleSheet.default.compose(a,this.props.ListFooterComponentStyle)},R))));var R=_objectSpread({},this.props,{onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout,onScroll:this._onScroll,onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onMomentumScrollEnd:this._onMomentumScrollEnd,scrollEventThrottle:this.props.scrollEventThrottle,invertStickyHeaders:void 0!==this.props.invertStickyHeaders?this.props.invertStickyHeaders:this.props.inverted,stickyHeaderIndices:h});a&&(R.style=[a,this.props.style]),this._hasMore=this.state.last<this.props.getItemCount(this.props.data)-1;R=React.cloneElement((this.props.renderScrollComponent||this._defaultRenderScrollComponent)(R),{ref:this._captureScrollRef},c);return this.props.debug?React.createElement(_View.default,{style:styles.debug},R,this._renderDebugOverlay()):R},e.componentDidUpdate=function(e){var t=this.props,r=t.data,t=t.extraData;r===e.data&&t===e.extraData||(this._hasDataChangedSinceEndReached=!0,this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.resetViewableIndices()}));e=this._hiPriInProgress;this._scheduleCellsToRenderUpdate(),e&&(this._hiPriInProgress=!1)},e._computeBlankness=function(){this._fillRateHelper.computeBlankness(this.props,this.state,this._scrollMetrics)},e._onCellLayout=function(e,t,r){var i=e.nativeEvent.layout,e={offset:this._selectOffset(i),length:this._selectLength(i),index:r,inLayout:!0},i=this._frames[t];i&&e.offset===i.offset&&e.length===i.length&&r===i.index?this._frames[t].inLayout=!0:(this._totalCellLength+=e.length-(i?i.length:0),this._totalCellsMeasured+=i?0:1,this._averageCellLength=this._totalCellLength/this._totalCellsMeasured,this._frames[t]=e,this._highestMeasuredFrameIndex=Math.max(this._highestMeasuredFrameIndex,r),this._scheduleCellsToRenderUpdate());t=this._cellKeysToChildListKeys.get(t);if(t)for(var s,o=t,n=Array.isArray(o),l=0,o=n?o:o[Symbol.iterator]();;){if(n){if(l>=o.length)break;s=o[l++]}else{if((l=o.next()).done)break;s=l.value}var a=this._nestedChildLists.get(s);a&&a.ref&&a.ref.measureLayoutRelativeToContainingList()}this._computeBlankness(),this._updateViewableItems(this.props.data)},e.measureLayoutRelativeToContainingList=function(){var s=this;try{if(!this._scrollRef)return;this._scrollRef.measureLayout(this.context.virtualizedList.getOutermostParentListRef().getScrollRef().getNativeScrollRef(),function(e,t,r,i){s._offsetFromParentVirtualizedList=s._selectOffset({x:e,y:t}),s._scrollMetrics.contentLength=s._selectLength({width:r,height:i});i=s._convertParentScrollMetrics(s.context.virtualizedList.getScrollMetrics());s._scrollMetrics.visibleLength=i.visibleLength,s._scrollMetrics.offset=i.offset},function(e){console.warn("VirtualizedList: Encountered an error while measuring a list's offset from its containing VirtualizedList.")})}catch(e){console.warn("measureLayoutRelativeToContainingList threw an error",e.stack)}},e._renderDebugOverlay=function(){for(var r=this._scrollMetrics.visibleLength/(this._scrollMetrics.contentLength||1),e=[],t=this.props.getItemCount(this.props.data),i=0;i<t;i++){var s=this._getFrameMetricsApprox(i);s.inLayout&&e.push(s)}var o=this._getFrameMetricsApprox(this.state.first).offset,n=this._getFrameMetricsApprox(this.state.last),l=n.offset+n.length-o,a=this._scrollMetrics.offset,n=this._scrollMetrics.visibleLength;return React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlay]},e.map(function(e,t){return React.createElement(_View.default,{key:"f"+t,style:[styles.debugOverlayBase,styles.debugOverlayFrame,{top:e.offset*r,height:e.length*r}]})}),React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlayFrameLast,{top:o*r,height:l*r}]}),React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlayFrameVis,{top:a*r,height:n*r}]}))},e._selectLength=function(e){return this.props.horizontal?e.width:e.height},e._selectOffset=function(e){return this.props.horizontal?e.x:e.y},e._maybeCallOnEndReached=function(){var e=this.props,t=e.data,r=e.getItemCount,i=e.onEndReached,s=e.onEndReachedThreshold,o=this._scrollMetrics,n=o.contentLength,e=o.visibleLength,o=n-e-o.offset;i&&this.state.last===r(t)-1&&o<s*e&&(this._hasDataChangedSinceEndReached||this._scrollMetrics.contentLength!==this._sentEndForContentLength)&&(this._hasDataChangedSinceEndReached=!1,this._sentEndForContentLength=this._scrollMetrics.contentLength,i({distanceFromEnd:o}))},e._scheduleCellsToRenderUpdate=function(){var e=this.state,t=e.first,r=e.last,i=this._scrollMetrics,s=i.offset,o=i.visibleLength,n=i.velocity,l=this.props.getItemCount(this.props.data),e=!1,i=this.props.onEndReachedThreshold*o/2;0<t&&(t=s-this._getFrameMetricsApprox(t).offset,e=e||t<0||n<-2&&t<i),r<l-1&&(o=this._getFrameMetricsApprox(r).offset-(s+o),e=e||o<0||2<n&&o<i),e&&(this._averageCellLength||this.props.getItemLayout)&&!this._hiPriInProgress?(this._hiPriInProgress=!0,this._updateCellsToRenderBatcher.dispose({abort:!0}),this._updateCellsToRender()):this._updateCellsToRenderBatcher.schedule()},e._updateViewableItems=function(t){var r=this,i=this.props.getItemCount;this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.onUpdate(i(t),r._scrollMetrics.offset,r._scrollMetrics.visibleLength,r._getFrameMetrics,r._createViewToken,e.onViewableItemsChanged,r.state)})},t}(React.PureComponent);VirtualizedList.defaultProps={disableVirtualization:!1,horizontal:!1,initialNumToRender:10,keyExtractor:function(e,t){return null!=e.key?e.key:null!=e.id?e.id:(_usedIndexForKey=!0,e.type&&e.type.displayName&&(_keylessItemComponentName=e.type.displayName),String(t))},maxToRenderPerBatch:10,onEndReachedThreshold:2,scrollEventThrottle:50,updateCellsBatchingPeriod:50,windowSize:21},VirtualizedList.contextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string}),virtualizedList:_propTypes.default.shape({getScrollMetrics:_propTypes.default.func,horizontal:_propTypes.default.bool,getOutermostParentListRef:_propTypes.default.func,getNestedChildState:_propTypes.default.func,registerAsNestedChild:_propTypes.default.func,unregisterAsNestedChild:_propTypes.default.func})},VirtualizedList.childContextTypes={virtualizedList:_propTypes.default.shape({getScrollMetrics:_propTypes.default.func,horizontal:_propTypes.default.bool,getOutermostParentListRef:_propTypes.default.func,getNestedChildState:_propTypes.default.func,registerAsNestedChild:_propTypes.default.func,unregisterAsNestedChild:_propTypes.default.func})};var CellRenderer=function(i){function e(){for(var s,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(s=i.call.apply(i,[this].concat(t))||this).state={separatorProps:{highlighted:!1,leadingItem:s.props.item}},s._separators={highlight:function(){var e=s.props,t=e.cellKey,e=e.prevCellKey;s.props.onUpdateSeparators([t,e],{highlighted:!0})},unhighlight:function(){var e=s.props,t=e.cellKey,e=e.prevCellKey;s.props.onUpdateSeparators([t,e],{highlighted:!1})},updateProps:function(e,t){var r=s.props,i=r.cellKey,r=r.prevCellKey;s.props.onUpdateSeparators(["leading"===e?r:i],t)}},s}_inheritsLoose(e,i);var t=e.prototype;return t.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},t.updateSeparatorProps=function(t){this.setState(function(e){return{separatorProps:_objectSpread({},e.separatorProps,{},t)}})},t.componentWillUnmount=function(){this.props.onUnmount(this.props.cellKey)},t.render=function(){var e=this.props,t=e.CellRendererComponent,r=e.ItemSeparatorComponent,i=e.fillRateHelper,s=e.horizontal,o=e.item,n=e.index,l=e.inversionStyle,a=e.parentProps,c=a.renderItem,e=a.getItemLayout;(0,_invariant.default)(c,"no renderItem!");n=c({item:o,index:n,separators:this._separators}),i=!e||a.debug||i.enabled()?this.props.onLayout:void 0,r=r&&React.createElement(r,this.state.separatorProps),l=l?s?[styles.rowReverse,l]:[styles.columnReverse,l]:s?[styles.row,l]:l;return t?React.createElement(t,_extends({},this.props,{style:l,onLayout:i}),n,r):React.createElement(_View.default,{style:l,onLayout:i},n,r)},e}(React.Component);CellRenderer.childContextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string})};var VirtualizedCellWrapper=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var r=t.prototype;return r.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},r.render=function(){return this.props.children},t}(React.Component);VirtualizedCellWrapper.childContextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string})};var styles=_StyleSheet.default.create({verticallyInverted:{transform:[{scaleY:-1}]},horizontallyInverted:{transform:[{scaleX:-1}]},row:{flexDirection:"row"},rowReverse:{flexDirection:"row-reverse"},columnReverse:{flexDirection:"column-reverse"},debug:{flex:1},debugOverlayBase:{position:"absolute",top:0,right:0},debugOverlay:{bottom:0,width:20,borderColor:"blue",borderWidth:1},debugOverlayFrame:{left:0,backgroundColor:"orange"},debugOverlayFrameLast:{left:0,borderColor:"green",borderWidth:2},debugOverlayFrameVis:{left:0,borderColor:"red",borderWidth:2}}),_default=VirtualizedList;exports.default=VirtualizedList,module.exports=exports.default;