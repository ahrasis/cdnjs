"use strict";exports.__esModule=!0,exports.default=void 0;var _AnimatedValue=_interopRequireDefault(require("../nodes/AnimatedValue")),_AnimatedValueXY=_interopRequireDefault(require("../nodes/AnimatedValueXY")),_Animation2=_interopRequireDefault(require("./Animation")),_SpringConfig=_interopRequireDefault(require("../SpringConfig")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_NativeAnimatedHelper=require("../NativeAnimatedHelper");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _inheritsLoose(t,i){t.prototype=Object.create(i.prototype),(t.prototype.constructor=t).__proto__=i}var SpringAnimation=function(n){function l(t){var i,e,s=n.call(this)||this;return s._overshootClamping=null!==(i=t.overshootClamping)&&void 0!==i&&i,s._restDisplacementThreshold=null!==(i=t.restDisplacementThreshold)&&void 0!==i?i:.001,s._restSpeedThreshold=null!==(i=t.restSpeedThreshold)&&void 0!==i?i:.001,s._initialVelocity=null!==(i=t.velocity)&&void 0!==i?i:0,s._lastVelocity=null!==(i=t.velocity)&&void 0!==i?i:0,s._toValue=t.toValue,s._delay=null!==(i=t.delay)&&void 0!==i?i:0,s._useNativeDriver=(0,_NativeAnimatedHelper.shouldUseNativeDriver)(t),s.__isInteraction=null!==(i=t.isInteraction)&&void 0!==i?i:!s._useNativeDriver,s.__iterations=null!==(i=t.iterations)&&void 0!==i?i:1,void 0!==t.stiffness||void 0!==t.damping||void 0!==t.mass?((0,_invariant.default)(void 0===t.bounciness&&void 0===t.speed&&void 0===t.tension&&void 0===t.friction,"You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one"),s._stiffness=null!==(i=t.stiffness)&&void 0!==i?i:100,s._damping=null!==(i=t.damping)&&void 0!==i?i:10,s._mass=null!==(i=t.mass)&&void 0!==i?i:1):(void 0!==t.bounciness||void 0!==t.speed?((0,_invariant.default)(void 0===t.tension&&void 0===t.friction&&void 0===t.stiffness&&void 0===t.damping&&void 0===t.mass,"You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one"),e=_SpringConfig.default.fromBouncinessAndSpeed(null!==(e=t.bounciness)&&void 0!==e?e:8,null!==(e=t.speed)&&void 0!==e?e:12),s._stiffness=e.stiffness,s._damping=e.damping):(t=_SpringConfig.default.fromOrigamiTensionAndFriction(null!==(e=t.tension)&&void 0!==e?e:40,null!==(t=t.friction)&&void 0!==t?t:7),s._stiffness=t.stiffness,s._damping=t.damping),s._mass=1),(0,_invariant.default)(0<s._stiffness,"Stiffness value must be greater than 0"),(0,_invariant.default)(0<s._damping,"Damping value must be greater than 0"),(0,_invariant.default)(0<s._mass,"Mass value must be greater than 0"),s}_inheritsLoose(l,n);var t=l.prototype;return t.__getNativeAnimationConfig=function(){var t;return{type:"spring",overshootClamping:this._overshootClamping,restDisplacementThreshold:this._restDisplacementThreshold,restSpeedThreshold:this._restSpeedThreshold,stiffness:this._stiffness,damping:this._damping,mass:this._mass,initialVelocity:null!==(t=this._initialVelocity)&&void 0!==t?t:this._lastVelocity,toValue:this._toValue,iterations:this.__iterations}},t.start=function(t,i,e,s,n){var o=this;this.__active=!0,this._startPosition=t,this._lastPosition=this._startPosition,this._onUpdate=i,this.__onEnd=e,this._lastTime=Date.now(),this._frameTime=0,s instanceof l&&(s=s.getInternalState(),this._lastPosition=s.lastPosition,this._lastVelocity=s.lastVelocity,this._initialVelocity=this._lastVelocity,this._lastTime=s.lastTime);function a(){o._useNativeDriver?o.__startNativeAnimation(n):o.onUpdate()}this._delay?this._timeout=setTimeout(a,this._delay):a()},t.getInternalState=function(){return{lastPosition:this._lastPosition,lastVelocity:this._lastVelocity,lastTime:this._lastTime}},t.onUpdate=function(){var t=Date.now();t>this._lastTime+64&&(t=this._lastTime+64);var i=(t-this._lastTime)/1e3;this._frameTime+=i;var e=this._damping,s=this._mass,n=this._stiffness,o=-this._initialVelocity,a=e/(2*Math.sqrt(n*s)),l=Math.sqrt(n/s),r=l*Math.sqrt(1-a*a),_=this._toValue-this._startPosition,i=0,e=0,n=this._frameTime;if(e=a<1?(s=Math.exp(-a*l*n),i=this._toValue-s*((o+a*l*_)/r*Math.sin(r*n)+_*Math.cos(r*n)),a*l*s*(Math.sin(r*n)*(o+a*l*_)/r+_*Math.cos(r*n))-s*(Math.cos(r*n)*(o+a*l*_)-r*_*Math.sin(r*n))):(r=Math.exp(-l*n),i=this._toValue-r*(_+(o+l*_)*n),r*(o*(n*l-1)+n*_*(l*l))),this._lastTime=t,this._lastPosition=i,this._lastVelocity=e,this._onUpdate(i),this.__active){l=!1;this._overshootClamping&&0!==this._stiffness&&(l=this._startPosition<this._toValue?i>this._toValue:i<this._toValue);t=Math.abs(e)<=this._restSpeedThreshold,e=!0;if(0!==this._stiffness&&(e=Math.abs(this._toValue-i)<=this._restDisplacementThreshold),l||t&&e)return 0!==this._stiffness&&(this._lastPosition=this._toValue,this._lastVelocity=0,this._onUpdate(this._toValue)),void this.__debouncedOnEnd({finished:!0});this._animationFrame=requestAnimationFrame(this.onUpdate.bind(this))}},t.stop=function(){n.prototype.stop.call(this),this.__active=!1,clearTimeout(this._timeout),global.cancelAnimationFrame(this._animationFrame),this.__debouncedOnEnd({finished:!1})},l}(_Animation2.default),_default=SpringAnimation;exports.default=SpringAnimation,module.exports=exports.default;