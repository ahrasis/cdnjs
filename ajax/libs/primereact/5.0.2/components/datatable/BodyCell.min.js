"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BodyCell=void 0;var _react=_interopRequireWildcard(require("react")),_ClassNames=require("../utils/ClassNames"),_ObjectUtils=_interopRequireDefault(require("../utils/ObjectUtils")),_DomHandler=_interopRequireDefault(require("../utils/DomHandler")),_RowRadioButton=require("./RowRadioButton"),_RowCheckbox=require("./RowCheckbox"),_Ripple=require("../ripple/Ripple");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i,o,r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&((o=n?Object.getOwnPropertyDescriptor(e,i):null)&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]);return r.default=e,t&&t.set(e,r),r}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(i){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(i);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var BodyCell=function(){_inherits(i,_react.Component);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),(e=t.call(this,e)).state={editing:e.props.editing},e.onExpanderClick=e.onExpanderClick.bind(_assertThisInitialized(e)),e.onClick=e.onClick.bind(_assertThisInitialized(e)),e.onBlur=e.onBlur.bind(_assertThisInitialized(e)),e.onKeyDown=e.onKeyDown.bind(_assertThisInitialized(e)),e.onEditorFocus=e.onEditorFocus.bind(_assertThisInitialized(e)),e}return _createClass(i,[{key:"onExpanderClick",value:function(e){this.props.onRowToggle&&this.props.onRowToggle({originalEvent:e,data:this.props.rowData}),e.preventDefault()}},{key:"onKeyDown",value:function(e){"row"!==this.props.editMode&&(13!==e.which&&9!==e.which||this.switchCellToViewMode(e,!0),27===e.which&&this.switchCellToViewMode(e,!1))}},{key:"onClick",value:function(e){var t=this;"row"!==this.props.editMode&&(this.editingCellClick=!0,this.props.editor&&!this.state.editing&&(this.setState({editing:!0},function(){t.props.onEditorInit&&t.props.onEditorInit({originalEvent:e,columnProps:t.props})}),"click"===this.props.editorValidatorEvent&&this.bindDocumentEditListener()))}},{key:"onBlur",value:function(e){"row"!==this.props.editMode&&this.state.editing&&"blur"===this.props.editorValidatorEvent&&this.switchCellToViewMode(e,!0)}},{key:"onEditorFocus",value:function(e){this.onClick(e)}},{key:"bindDocumentEditListener",value:function(){var t=this;this.documentEditListener||(this.documentEditListener=function(e){t.editingCellClick||t.switchCellToViewMode(e,!0),t.editingCellClick=!1},this.editingCellClick=!1,document.addEventListener("click",this.documentEditListener,{capture:!0}))}},{key:"closeCell",value:function(){var e=this;setTimeout(function(){e.setState({editing:!1})},1),this.unbindDocumentEditListener()}},{key:"switchCellToViewMode",value:function(e,t){var i={originalEvent:e,columnProps:this.props};!t&&this.props.onEditorCancel&&this.props.onEditorCancel(i);e=!0;this.props.editorValidator&&(e=this.props.editorValidator(i)),e&&(t&&this.props.onEditorSubmit&&this.props.onEditorSubmit(i),this.closeCell())}},{key:"unbindDocumentEditListener",value:function(){this.documentEditListener&&(document.removeEventListener("click",this.documentEditListener,{capture:!0}),this.documentEditListener=null)}},{key:"componentDidUpdate",value:function(){var e,t=this;"row"!==this.props.editMode&&this.container&&this.props.editor&&(clearTimeout(this.tabindexTimeout),this.state.editing?((e=_DomHandler.default.findSingle(this.container,"input"))&&document.activeElement!==e&&!e.hasAttribute("data-isCellEditing")&&(e.setAttribute("data-isCellEditing",!0),e.focus()),this.keyHelper.tabIndex=-1):this.tabindexTimeout=setTimeout(function(){t.keyHelper&&t.keyHelper.setAttribute("tabindex",0)},50))}},{key:"componentWillUnmount",value:function(){this.unbindDocumentEditListener()}},{key:"render",value:function(){var e,t,i,o=this,r=(0,_ClassNames.classNames)(this.props.bodyClassName||this.props.className,{"p-selection-column":this.props.selectionMode,"p-editable-column":this.props.editor,"p-cell-editing":this.state.editing&&this.props.editor});return this.props.expander?(t=(0,_ClassNames.classNames)("p-row-toggler-icon pi pi-fw p-clickable",{"pi-chevron-down":this.props.expanded,"pi-chevron-right":!this.props.expanded}),t=_react.default.createElement("button",{type:"button",onClick:this.onExpanderClick,className:"p-row-toggler p-link"},_react.default.createElement("span",{className:t}),_react.default.createElement(_Ripple.Ripple,null))):this.props.selectionMode?(i=!0,this.props.showSelectionElement&&(i=this.props.showSelectionElement(this.props.rowData)),i&&(t="single"===this.props.selectionMode?_react.default.createElement(_RowRadioButton.RowRadioButton,{onClick:this.props.onRadioClick,rowData:this.props.rowData,selected:this.props.selected}):_react.default.createElement(_RowCheckbox.RowCheckbox,{onClick:this.props.onCheckboxClick,rowData:this.props.rowData,selected:this.props.selected}))):this.props.rowReorder?(i=!0,this.props.showRowReorderElement&&(i=this.props.showRowReorderElement(this.props.rowData)),i&&(i=(0,_ClassNames.classNames)("p-table-reorderablerow-handle",this.props.rowReorderIcon),t=_react.default.createElement("i",{className:i}))):t=this.props.rowEditor?this.state.editing?_react.default.createElement(_react.default.Fragment,null,_react.default.createElement("button",{type:"button",onClick:this.props.onRowEditSave,className:"p-row-editor-save p-link"},_react.default.createElement("span",{className:"p-row-editor-save-icon pi pi-fw pi-check p-clickable"}),_react.default.createElement(_Ripple.Ripple,null)),_react.default.createElement("button",{type:"button",onClick:this.props.onRowEditCancel,className:"p-row-editor-cancel p-link"},_react.default.createElement("span",{className:"p-row-editor-cancel-icon pi pi-fw pi-times p-clickable"}),_react.default.createElement(_Ripple.Ripple,null))):_react.default.createElement("button",{type:"button",onClick:this.props.onRowEditInit,className:"p-row-editor-init p-link"},_react.default.createElement("span",{className:"p-row-editor-init-icon pi pi-fw pi-pencil p-clickable"}),_react.default.createElement(_Ripple.Ripple,null)):this.state.editing&&this.props.editor?this.props.editor(this.props):this.props.body?this.props.body(this.props.rowData,this.props):_ObjectUtils.default.resolveFieldData(this.props.rowData,this.props.field),"row"!==this.props.editMode&&(e=this.props.editor&&_react.default.createElement("a",{tabIndex:"0",ref:function(e){o.keyHelper=e},className:"p-cell-editor-key-helper p-hidden-accessible",onFocus:this.onEditorFocus},_react.default.createElement("span",null))),_react.default.createElement("td",{ref:function(e){o.container=e},className:r,style:this.props.bodyStyle||this.props.style,onClick:this.onClick,onKeyDown:this.onKeyDown,rowSpan:this.props.rowSpan,onBlur:this.onBlur},void 0,e,t)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return"row"===e.editMode&&e.editing!==t.editing?{editing:e.editing}:null}}]),i}();exports.BodyCell=BodyCell;