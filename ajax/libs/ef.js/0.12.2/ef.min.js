!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ef={})}(this,(function(e){"use strict";var t="&",n="&&",r=new RegExp("\\&[0-7]{1,3}","g"),a=new RegExp("\\&u\\[.*?\\]","g"),o=new RegExp("\\&u.{0,4}","g"),c=new RegExp("\\&x.{0,2}","g"),i=new RegExp("\\&","g"),s=new RegExp("\\&b","g"),u=new RegExp("\\&t","g"),p=new RegExp("\\&n","g"),l=new RegExp("\\&v","g"),f=new RegExp("\\&f","g"),h=new RegExp("\\&r","g"),d=function(){throw new SyntaxError("Octal escape sequences are not allowed in EFML.")},v=function(e){if(e=e.substr(3,e.length-4),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");try{return String.fromCodePoint(e)}catch(e){throw new SyntaxError("Undefined Unicode code-point")}},m=function(e){if(e=e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");return String.fromCharCode(e)},y=function(e){if(e="00"+e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid hexadecimal escape sequence");return String.fromCharCode(e)},g=function(e){for(var g=[],b=0,x=e.split(n);b<x.length;b+=1){var $=x[b].replace(r,d).replace(a,v).replace(o,m).replace(c,y).replace(s,"\b").replace(u,"\t").replace(p,"\n").replace(l,"\v").replace(f,"\f").replace(h,"\r").replace(i,"");g.push($)}return g.join(t)},b=function(e){return e[e.length-1]===t},x=function(e,t){for(var n=[],r=!1,a=0,o=e.split(t);a<o.length;a+=1){var c=o[a];r?n[n.length-1]+=""+t+c:n.push(c),r=b(c)}return n},$=function(e,t){for(var r=e.split(n),a=x(r.shift(),t),o=0,c=r;o<c.length;o+=1){var i=c[o],s=x(i,t);a[a.length-1]+="&&"+s.shift(),a.push.apply(a,s)}return a},N=["$ctx","$refs","$data","$methods","$mount","$umount","$subscribe","$unsubscribe","$update","$dispatch","$emit","$on","$off","$destroy","__DIRECTMOUNT__"],w=/\{\{.+?\}\}/g,E=/^(\t*)( *).*/,k=/#([^}]|}[^}])*$/,_=function(e,t){return void 0===t&&(t=-2),"Failed to parse eft template: "+e+". at line "+(t+1)},O=function(e){return["number","boolean","string"].indexOf(typeof e)>-1},D=function(e){if(!e)return[e,!1];try{var t=JSON.parse(e);return-1===["number","boolean"].indexOf(typeof t)?[g(e),!0]:[t,!1]}catch(t){return[g(e),!0]}},T=function(e){e=e.slice(2,e.length-2);var t=$(e,"="),n=t[0],r=t.slice(1),a=$(n.trim(),".").map(g),o=D(r.join("=").trim()),c=o[0],i=o[1];return O(c)&&(i||!i&&""!==c)?[a,c]:[a]},F=function(e){var t=e.split(w);if(1===t.length)return D(e)[0];var n=[];2!==t.length||t[0]||t[1]?n.push(t.map(g)):n.push(0);var r=e.match(w);return r&&n.push.apply(n,r.map(T)),n},C=function(e,t){t&&e.push(t)},j=function(e){var t=F(e);if(O(t))return[""+t];for(var n=t[0],r=t.slice(1),a=[],o=0;o<r.length;o++)C(a,n[o]),a.push(r[o]);return C(a,n[n.length-1]),a},A=function(e){return e.replace(/\./g," ")},R=function(e,t,n){var r=parseInt(n,10);if(isNaN(r))return function(e,t){switch(t){case"stop":e.s=1;break;case"stopImmediate":e.i=1;break;case"prevent":e.p=1;break;case"shift":e.h=1;break;case"alt":e.a=1;break;case"ctrl":e.c=1;break;case"meta":e.t=1;break;case"capture":e.u=1;break;default:console.warn("Abandoned unsupported eft event option '"+t+"'.")}}(e,g(n));t.push(r)},P=function(e){var t,n,r=e.line,a=e.ast,o=e.parsingInfo,c=e.i;if(r.replace(/\s/,"")){!function(e,t){null===t.offset&&(t.offset=e.match(/\s*/)[0],t.offset&&(t.offsetReg=t.offset))}(r,o);var i=function(e,t,n){if(t.offsetReg){var r=!1;if(e=e.replace(t.offsetReg,(function(){return r=!0,""})),!r)throw new SyntaxError(_("Expected indent to be grater than 0 and less than "+(t.prevDepth+1)+", but got -1",n))}return e}(r,o,c);!function(e,t){if(!t.indentReg){var n=e.match(E)[2];n&&(t.indentReg=new RegExp(n,"g"))}}(i,o);var s=function(e,t,n){var r=0;t.indentReg&&(e=e.replace(/^\s*/,(function(e){return e.replace(t.indentReg,"\t")})));var a=e.replace(/^\t*/,(function(e){return r=e.length,""}));if(/^\s/.test(a))throw new SyntaxError(_("Bad indent",n));return{depth:r,content:a}}(i,o,c),u=s.depth,p=s.content;if(p){if(u<0||u-o.prevDepth>1||u-o.prevDepth==1&&-1===["comment","tag"].indexOf(o.prevType)||"comment"!==o.prevType&&0===u&&o.topExists)throw new SyntaxError(_("Expected indent to be grater than 0 and less than "+(o.prevDepth+1)+", but got "+u,c));var l=p[0];if(!(p=p.slice(1))&&">#%@.-+".indexOf(l)>=0)throw new SyntaxError(_("Empty content",c));switch((u<o.prevDepth||u===o.prevDepth&&"tag"===o.prevType)&&(o.currentNode=function(e,t){for(var n=e,r=0;r<t;r++)n=n[n.length-1];return n}(a,u)),o.prevDepth=u,l){case">":var f=function(e){var t={},n=$(e.replace(k,(function(e){return t.ref=e.slice(1),""})),"."),r=n[0],a=n.slice(1);return t.tag=g(r),t.class=F(a.join(".")),"string"==typeof t.class?t.class=A(t.class).trim():t.class[0]&&(t.class[0]=t.class[0].map(A)),t}(p),h=[{t:f.tag}];f.class&&(h[0].a={},h[0].a.class=f.class),f.ref&&(h[0].r=f.ref),o.currentNode.push(h),o.currentNode=h,o.prevType="tag";break;case"#":var d=function(e){var t=$(e,"=");return{name:g(t.shift().trim()),value:F(t.join("=").trim())}}(p),v=d.name,m=d.value;o.currentNode[0].a||(o.currentNode[0].a={}),o.currentNode[0].a[v]=m,o.prevType="attr";break;case"%":var y=function(e){var t=$(e,"=");return{propPath:$(t.shift().trim(),".").map(g),value:F(t.join("=").trim())}}(p),b=y.propPath,x=y.value;o.currentNode[0].p||(o.currentNode[0].p=[]),o.currentNode[0].p.push([b,x]),o.prevType="prop";break;case"@":var w=function(e){var t=$(e,"=");return{name:t.shift().trim(),value:t.join("=").trim()}}(p),O=w.name,D=w.value;o.currentNode[0].e||(o.currentNode[0].e=[]);var T=function(e){var t={},n=[],r=$(e,"."),a=r[0],o=r.slice(1);t.l=g(a);for(var c=0,i=o;c<i.length;c+=1){var s=i[c];R(t,n,s)}return n.length>0&&(t.k=n),t}(O),C=function(e){var t=$(e,":"),n=t[0],r=t.slice(1).join(":"),a=g(n.trim());return r?[a,F(r)]:[a]}(D),P=C[0],S=C[1];T.m=P,S&&(T.v=S),o.currentNode[0].e.push(T),o.prevType="event";break;case".":(t=o.currentNode).push.apply(t,j(p)),o.prevType="text";break;case"|":o.currentNode.length>1&&(p="\n"+p),(n=o.currentNode).push.apply(n,j(p)),o.prevType="multiline-text";break;case"-":if(-1!==N.indexOf(p))throw new SyntaxError(_("Reserved name '"+p+"' should not be used",c));o.currentNode.push({n:p,t:0}),o.prevType="node";break;case"+":o.currentNode.push({n:p,t:1}),o.prevType="list";break;default:o.prevType="comment"}}}},S=function(e){if(!e)throw new TypeError(_("Template required, but nothing given"));var t=typeof e;if("string"!==t)throw new TypeError(_("Expected a string, but got a(n) "+t));for(var n=e.split(/\r?\n/),r=[{t:0}],a={indentReg:null,prevDepth:0,offset:null,offsetReg:null,prevType:"comment",currentNode:r,topExists:!1},o=0;o<n.length;o++)P({line:n[o],ast:r,parsingInfo:a,i:o});if(r.length<=1)throw new SyntaxError(_("Nothing to be parsed",n.length-1));return 2===r.length&&Array.isArray(r[1])&&Object.hasOwnProperty.call(r[1][0],"t")?r[1]:r},I=function(e){return Array.isArray(e)?"array":typeof e},q=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var r="",a=0;a<t.length;a++)void 0===t[a]?r+=e[a]:r+=e[a]+t[a];return r+e[e.length-1]},U=function(e){var t=e.dataNode[e._key];return void 0===t?"":t},B=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(!e)return U(t[0]);var r=[e];return r.push.apply(r,t.map(U)),q.apply(void 0,r)},L=Array.prototype,M={copy:function(e){return L.slice.call(e,0)},empty:function(e){return e.length=0,e},equals:function(e,t){if(!Array.isArray(t))return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0},pop:function(e){return L.pop.call(e)},push:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return L.push.apply(e,t)},remove:function(e,t){var n=L.indexOf.call(e,t);if(n>-1)return L.splice.call(e,n,1),t},reverse:function(e){return L.reverse.call(e)},rightUnique:function(e){for(var t=[],n=0;n<e.length;n++){for(var r=n+1;r<e.length;r++)e[n]===e[r]&&(r=n+=1);t.push(e[n])}return t},shift:function(e){return L.shift.call(e)},slice:function(e,t,n){return L.slice.call(e,t,n)},sort:function(e,t){return L.sort.call(e,t)},splice:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return L.splice.apply(e,t)},unshift:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return L.unshift.apply(e,t)}};"undefined"!=typeof Set&&Array.from?M.unique=function(e){return Array.from(new Set(e))}:M.unique=M.rightUnique;var Z=[],K=[],J=[],V=0,W=function(e){return Z.push.apply(Z,e)},G=function(e){return K.push(e)},z=function(){return V+=1},H=function(){if(0!==J.length){var e=M.unique(J);M.empty(J);for(var t=0,n=e;t<n.length;t+=1){(0,n[t])()}}},Q=function(e){return!e&&(V-=1)>0||(V=0,Z.length>0&&function(){if(0!==Z.length){var e=M.unique(Z);M.empty(Z);for(var t=0,n=e;t<n.length;t+=1)(0,n[t])()}}(),K.length>0&&function(){if(0!==K.length){var e=M.rightUnique(K);M.empty(K);for(var t=0,n=e;t<n.length;t+=1)(0,n[t])()}}(),J.length>0&&setTimeout(H,0)),V},X=function(e,t){for(var n in t)e[n]=t[n];return e},Y=Object.assign||X,ee=function(e,t){var n={};return Object.defineProperty(t,e,{get:function(){return n},set:function(e){z(),Y(n,e),Q()},configurable:!1,enumerable:!0}),n},te=function(e){var t=e._path,n=e._key,r=e.data,a=e.handlers,o=e.subscribers,c=e.innerData,i=function(e,t){for(var n=0,r=e;n<r.length;n+=1){var a=r[n];t=t[a]?t[a]:ee(a,t)}return t}(t,r),s=function(e){for(var t=e._path,n=e.handlers,r=e.subscribers,a=e.innerData,o=0,c=t;o<c.length;o+=1){var i=c[o];n[i]||(n[i]={}),r[i]||(r[i]={}),a[i]||(a[i]={}),n=n[i],r=r[i],a=a[i]}return{handlerNode:n,subscriberNode:r,dataNode:a}}({_path:t,handlers:a,subscribers:o,innerData:c}),u=s.handlerNode,p=s.subscriberNode,l=s.dataNode;return u[n]||(u[n]=[]),p[n]||(p[n]=[]),Object.prototype.hasOwnProperty.call(l,n)||(l[n]=void 0),{parentNode:i,handlerNode:u[n],subscriberNode:p[n],dataNode:l}},ne=function(e){return e!=e},re="[EF] %s",ae={log:console.log.bind(console,re),info:console.info.bind(console,re),warn:console.warn.bind(console,re),error:console.error.bind(console,re)},oe=function(e){var t=e.bind,n=e.ctx,r=e.handlers,a=e.subscribers,o=e.innerData,c=M.copy(t[0]),i=c.pop(),s=te({_path:c,_key:i,data:n.data,handlers:r,subscribers:a,innerData:o}),u=s.parentNode,p=s.handlerNode,l=s.subscriberNode,f=s.dataNode;return Object.prototype.hasOwnProperty.call(u,i)||function(e){var t=e.parentNode,n=e.dataNode,r=e.handlerNode,a=e.subscriberNode,o=e.ctx,c=e._key,i=!1;Object.defineProperty(t,c,{get:function(){return n[c]},set:function(e){if(!i&&!(n[c]===e||ne(n[c])&&ne(e))&&(n[c]=e,z(),W(r),Q(),a.length>0)){i=!0,z();try{for(var t=0,s=a;t<s.length;t+=1)(0,s[t])({state:o.state,value:e})}catch(e){ae.error("Error caught when executing subscribers:\n",e)}Q(),i=!1}},enumerable:!0})}({parentNode:u,dataNode:f,handlerNode:p,subscriberNode:l,ctx:n,_key:i}),t.length>1&&(u[i]=t[1]),{dataNode:f,parentNode:u,handlerNode:p,subscriberNode:l,_key:i}},ce=function(e,t){return e.constructor===t},ie=function(e,t){for(var n=0,r=t;n<r.length;n+=1){var a=r[n];Object.defineProperty(e.prototype,a,{enumerable:!1})}return e},se=function(e,t){var n=M.copy(e);return M.unshift(n,t),n},ue="undefined"!=typeof document&&"undefined"!=typeof Node,pe={},le=new WeakMap,fe={},he=function(){function e(){this.$children=[],this.$safeZone=fe.document.createDocumentFragment()}return e.prototype.append=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return fe.append.apply(null,se(t,this.$safeZone)),(e=this.$children).push.apply(e,t)},e.prototype.appendTo=function(e){fe.append.apply(null,se(this.$children,e))},e.prototype.removeChild=function(e){fe.remove(e),M.remove(this.$children,e)},e.prototype.remove=function(){for(var e=0,t=this.$children;e<t.length;e+=1){var n=t[e];fe.append(this.$safeZone,n)}},e}(),de=function(e,t){var n=e.$ctx.nodeInfo,r=n.element,a=n.placeholder;fe.append(t,r,a)},ve=function(e,t){if(3===e.nodeType){var n=le.get(e);if(n){var r=n.node;if(r)if(Array.isArray(r))for(var a=0,o=r;a<o.length;a+=1){var c=o[a];de(c,t)}else de(r,t)}}};fe.before=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=fe.document.createDocumentFragment();z();for(var a=0,o=t;a<o.length;a+=1){var c=o[a];c instanceof pe.EFBaseComponent?c.$mount({target:r}):ce(c,he)?c.appendTo(r):(fe.Node.prototype.appendChild.call(r,c),ve(c,r))}fe.Node.prototype.insertBefore.call(e.parentNode,r,e),Q()},fe.after=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=fe.document.createDocumentFragment();z();for(var a=0,o=t;a<o.length;a+=1){var c=o[a];c instanceof pe.EFBaseComponent?c.$mount({target:r}):ce(c,he)?c.appendTo(r):fe.Node.prototype.appendChild.call(r,c)}e.nextSibling?fe.Node.prototype.insertBefore.call(e.parentNode,r,e.nextSibling):fe.Node.prototype.appendChild.call(e.parentNode,r),Q()},fe.append=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(ce(e,he))return e.append.apply(e,t);if(e instanceof pe.EFBaseComponent){if(!Array.isArray(e.children))return;z();for(var r=0,a=t;r<a.length;r+=1){var o=a[r];o=new pe.toEFComponent(o),e.children.push(o)}Q()}else if(-1!==[1,9,11].indexOf(e.nodeType)){for(var c=fe.document.createDocumentFragment(),i=0,s=t;i<s.length;i+=1){var u=s[i];ce(u,he)?u.appendTo(c):u instanceof fe.Node?(fe.Node.prototype.appendChild.call(c,u),ve(u,c)):u instanceof pe.EFBaseComponent&&u.$mount({target:c})}fe.Node.prototype.appendChild.call(e,c)}},fe.remove=function(e){ce(e,he)?e.remove():e instanceof pe.EFBaseComponent?e.$umount():fe.Node.prototype.removeChild.call(e.parentNode,e)};var me=function(e){return Y(fe,e)};ue&&me({Node:Node,document:document});var ye=function(e,t){void 0===t&&(t={bubbles:!1,cancelable:!1});var n=t.bubbles,r=t.cancelable,a=fe.document.createEvent("CustomEvent");return a.initEvent(e,n,r),a},ge={html:"http://www.w3.org/1999/xhtml",svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML",xlink:"http://www.w3.org/1999/xlink"},be=function(e){if(ge[e])return ge[e];throw new Error('[EF] Namespace "'+e+'" has not been declared.')},xe=function(e){return["number","boolean","string"].indexOf(typeof e)>-1},$e=function(e){var t=e.tagName,n=e.tagContent,r=e.attrs,a=e.ref,o=e.refs,c=function(e){var t=e.tagName,n=e.tagContent,r=e.attrs,a=e.namespace;switch(typeof n){case"string":var o={};return t===n&&r&&r.is&&"string"==typeof r.is&&(o.is=r.is),a?fe.document.createElementNS(a,n,o):fe.document.createElement(n,o);case"function":return new n;default:return n.tag&&(t=n.tag),a?fe.document.createElementNS(a,t,{is:n.is}):fe.document.createElement(t,{is:n.is})}}({tagName:t,tagContent:n,attrs:r,namespace:e.namespace});return a&&Object.defineProperty(o,a,{value:c,enumerable:!0}),c},Ne=function(e){var t=e.val,n=e.ctx,r=e.handlers,a=e.subscribers,o=e.innerData,c=e.handler;if(Array.isArray(t)){var i=t[0],s=t.slice(1),u=[i],p=function(){return c(B.apply(void 0,u))};return u.push.apply(u,s.map((function(e){var t=oe({bind:e,ctx:n,handlers:r,subscribers:a,innerData:o}),c=t.dataNode,i=t.handlerNode,s=t._key;return i.push(p),{dataNode:c,_key:s}}))),p}return function(){return t}},we=function(e){var t=e.element,n=e.attr,r=e.key,a=e.ctx,o=e.handlers,c=e.subscribers,i=e.innerData,s=e.custom;if(xe(n)){if(s)return void(t[r]=""===n||n);if("is"===r)return;if(r.indexOf(":")>-1){var u=r.split(":")[0];if("xmlns"!==u)return t.setAttributeNS(a.localNamespaces[u]||be(u),r,n)}return t.setAttribute(r,n)}var p=function(e){var t=e.element,n=e.key,r=e.custom,a=e.ctx;if(r)return function(e){t[n]=e};if("class"===n)return function(e){if(!(e=(""+e).replace(/\s+/g," ").trim()))return t.removeAttribute(n);t.setAttribute(n,e)};if(n.indexOf(":")>-1){var o=n.split(":")[0],c=a.localNamespaces[o]||be(o);return function(e){if(""===e)return t.removeAttributeNS(c,n);t.setAttributeNS(c,n,e)}}return function(e){if(""===e)return t.removeAttribute(n);t.setAttribute(n,e)}}({element:t,key:r,custom:s,ctx:a});W([Ne({val:n,ctx:a,handlers:o,subscribers:c,innerData:i,handler:p})])},Ee=function(e){var t=e.element,n=e.propPath,r=e.value,a=e.ctx,o=e.handlers,c=e.subscribers,i=e.innerData,s=e.custom,u=M.copy(n),p=u.pop();s&&u.unshift("$data");var l=function(e,t){for(var n=0,r=e;n<r.length;n+=1){var a=r[n];t[a]||(t[a]={}),t=t[a]}return t}(u,t);if(xe(r))l[p]=r;else{var f=Ne({val:r,ctx:a,handlers:o,subscribers:c,innerData:i,handler:function(e){l[p]=e}});1!==n.length||"value"!==p&&"checked"!==p||r[0]||function(e){var t=e.ctx,n=e.handlers,r=e.subscribers,a=e.innerData,o=e.element,c=e.key,i=e.expr,s=e.custom,u=s?"$on":"addEventListener",p=s?"$dispatch":"dispatchEvent",l=oe({bind:i,ctx:t,handlers:n,subscribers:r,innerData:a}),f=l.parentNode,h=l._key,d=function(){z(),f[h]=s?o.$data.value:o.value,Q()};"value"===c?(o[u]("input",d,!0),o[u]("keyup",d,!0),o[u]("change",d,!0)):(o[u]("change",(function(){if(o[p](ye("ef-change-event"),{bubbles:!0,canceoable:!1}),"INPUT"===o.tagName&&"radio"===o.type&&""!==o.name){var e=fe.document.querySelectorAll("input[name="+o.name+"][type=radio]");if(e){var t=M.copy(e);M.remove(t,o);for(var n=0,r=t;n<r.length;n+=1)r[n].dispatchEvent(ye("ef-change-event"))}}}),!0),o[u]("ef-change-event",(function(){z(),f[h]=s?o.$data.checked:o.checked,Q()})))}({ctx:a,handlers:o,subscribers:c,innerData:i,element:t,key:p,expr:r[1],custom:s}),W([f])}},ke=function(e){return e},_e=function(e){var t=e.element,n=e.event,r=e.ctx,a=e.handlers,o=e.subscribers,c=e.innerData,i=e.custom?"$on":"addEventListener",s=n.l,u=n.m,p=n.s,l=n.i,f=n.p,h=n.h,d=n.a,v=n.c,m=n.t,y=n.u,g=n.k,b=n.v,x=Ne({val:b,ctx:r,handlers:a,subscribers:o,innerData:c,handler:ke});t[i](s,(function(e){!!h!=!!e.shiftKey||!!d!=!!e.altKey||!!v!=!!e.ctrlKey||!!m!=!!e.metaKey||g&&-1===g.indexOf(e.which)||(p&&e.stopPropagation(),l&&e.stopImmediatePropagation(),f&&e.preventDefault(),r.methods[u]&&r.methods[u]({e:e,value:x(),state:r.state}))}),!!y)},Oe={empty:function(){z();for(var e=0,t=M.copy(this);e<t.length;e+=1){t[e].$destroy()}Q(),M.empty(this)},clear:function(){z();for(var e=0,t=M.copy(this);e<t.length;e+=1){t[e].$umount()}Q(),M.empty(this)},pop:function(){if(0!==this.length){var e=M.pop(this);return e.$umount(),e}},push:function(e){for(var t=e.ctx,n=e.key,r=e.anchor,a=[],o=arguments.length-1;o-- >0;)a[o]=arguments[o+1];a=a.map(pe.toEFComponent);var c=[];z();for(var i=0,s=a;i<s.length;i+=1){var u=s[i];M.push(c,u.$mount({parent:t.state,key:n}))}return 0===this.length?fe.after.apply(fe,[r].concat(c)):fe.after.apply(fe,[this[this.length-1].$ctx.nodeInfo.placeholder].concat(c)),Q(),M.push.apply(M,[this].concat(a))},remove:function(e){if(-1!==this.indexOf(e))return e.$umount(),e},reverse:function(e){var t=e.ctx,n=e.key,r=e.anchor;if(0===this.length)return this;var a=M.copy(this),o=[];z();for(var c=a.length-1;c>=0;c--)a[c].$umount(),M.push(o,a[c].$mount({parent:t.state,key:n}));return M.push.apply(M,[this].concat(M.reverse(a))),fe.after.apply(fe,[r].concat(o)),Q(),this},shift:function(){if(0!==this.length){var e=M.shift(this);return e.$umount(),e}},sort:function(e,t){var n=e.ctx,r=e.key,a=e.anchor;if(0===this.length)return this;var o=M.copy(M.sort(this,t)),c=[];z();for(var i=0,s=o;i<s.length;i+=1){var u=s[i];u.$umount(),M.push(c,u.$mount({parent:n.state,key:r}))}return M.push.apply(M,[this].concat(o)),fe.after.apply(fe,[a].concat(c)),Q(),this},splice:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(0===this.length)return this;var n=M.splice.apply(M,[M.copy(this)].concat(e));z();for(var r=0,a=n;r<a.length;r+=1){var o=a[r];o.$umount()}return Q(),n},unshift:function(e){for(var t,n=e.ctx,r=e.key,a=e.anchor,o=[],c=arguments.length-1;c-- >0;)o[c]=arguments[c+1];if(0===this.length)return(t=this).push.apply(t,o).length;o=o.map(pe.toEFComponent);var i=[];z();for(var s=0,u=o;s<u.length;s+=1){var p=u[s];M.push(i,p.$mount({parent:n.state,key:r}))}return fe.after.apply(fe,[a].concat(i)),Q(),M.unshift.apply(M,[this].concat(o))}},De={BEFORE:"before",AFTER:"after",APPEND:"append",REPLACE:"replace"},Te=be("svg"),Fe=be("math"),Ce=be("html"),je=Object.create(null),Ae=[function(e){var t=e.ctx,n=e.key,r=e.value,a=t.children[n],o=a.anchor,c=a.node;c!==r&&(r=pe.toEFComponent(r),z(),c&&(r===je?r=null:c.$umount()),a.node=r,r&&r.$mount({target:o,parent:t.state,option:De.BEFORE,key:n}),Q())},function(e){var t=e.ctx,n=e.key,r=e.value,a=t.children[n],o=a.anchor,c=a.node;if(!M.equals(c,r)){r=r?M.copy(r):[];var i=fe.document.createDocumentFragment();if(z(),c){c.clear();for(var s=0,u=r;s<u.length;s+=1){var p=u[s];(p=pe.toEFComponent(p)).$ctx.nodeInfo.parent&&p.$umount(),fe.append(i,p.$mount({parent:t.state,key:n}))}}else for(var l=0,f=r;l<f.length;l+=1){var h=f[l];fe.append(i,h.$mount({parent:t.state,key:n}))}c.length=0,M.push.apply(M,[c].concat(r)),fe.after(o,i),Q()}}],Re=function(e){var t=e.node,n=e.nodeType,r=e.element,a=e.ctx,o=e.innerData,c=e.refs,i=e.handlers,s=e.subscribers,u=e.namespace,p=e.create;if(t instanceof fe.Node)fe.append(r,t);else switch(n){case"string":fe.append(r,fe.document.createTextNode(t));break;case"array":"object"===I(t[0])?fe.append(r,p({node:t,ctx:a,innerData:o,refs:c,handlers:i,subscribers:s,namespace:u})):function(e){var t=e.node,n=e.ctx,r=e.handlers,a=e.subscribers,o=e.innerData,c=e.element,i=fe.document.createTextNode(""),s=oe({bind:t,ctx:n,handlers:r,subscribers:a,innerData:o}),u=s.dataNode,p=s.handlerNode,l=s._key,f=function(){var e=u[l];i.textContent=void 0!==e?e:""};p.push(f),W([f]),fe.append(c,i)}({node:t,ctx:a,handlers:i,subscribers:s,innerData:o,element:r});break;case"object":var l=fe.document.createTextNode("");0===t.t?function(e){var t=e.ctx,n=e.key,r=e.anchor,a=t.children,o=t.isFragment;a[n]={anchor:r},le.set(r,a[n]),o&&fe.append(t.safeZone,r)}({ctx:a,key:t.n,anchor:l}):function(e){var t,n,r=e.ctx,a=e.key,o=e.anchor,c=r.children,i=r.isFragment;c[a]={node:(t=[],n={ctx:r,key:a,anchor:o},Object.defineProperties(t,{empty:{value:Oe.empty},clear:{value:Oe.clear},pop:{value:Oe.pop},push:{value:Oe.push.bind(t,n)},remove:{value:Oe.remove},reverse:{value:Oe.reverse.bind(t,n)},shift:{value:Oe.shift},sort:{value:Oe.sort.bind(t,n)},splice:{value:Oe.splice},unshift:{value:Oe.unshift.bind(t,n)}}),t),anchor:o},le.set(o,c[a]),i&&fe.append(r.safeZone,o)}({ctx:a,key:t.n,anchor:l}),fe.append(r,l)}},Pe=function(e){var t=e.node,n=e.ctx,r=e.innerData,a=e.refs,o=e.handlers,c=e.subscribers,i=e.namespace,s=t[0],u=t.slice(1),p=0===s.t,l=Object.isPrototypeOf.call(pe.EFBaseComponent,n.scope[s.t]||s.t),f=!1,h=i;if(!p&&!l)if(n.scope[s.t]&&n.scope[s.t].namespaceURI)i=n.scope[s.t].namespaceURI;else{var d=s.t;if(n.scope[s.t]){var v=n.scope[s.t];"string"==typeof v?d=v:v.tag&&(d=v.tag)}if(d.indexOf(":")>-1){var m=d.split(":")[0];n.localNamespaces[m]?(i=n.localNamespaces[m],f=!0):i=be(m)}else if(s.a&&s.a.xmlns&&xe(s.a.xmlns))i=s.a.xmlns;else if(!i)switch(d=d.toLowerCase()){case"svg":i=Te;break;case"math":i=Fe}}i===Ce&&(i="");var y=function(e){var t=e.info,n=e.ctx,r=e.innerData,a=e.refs,o=e.handlers,c=e.subscribers,i=e.namespace,s=e.fragment,u=e.custom;if(s)return new he;var p=t.t,l=t.a,f=t.p,h=t.e,d=t.r,v=p,m=n.scope[p]||p,y=$e({tagName:v,tagContent:m,attrs:l,ref:d,refs:a,namespace:i});if(l)for(var g in l)we({element:y,custom:u,attr:l[g],key:g,ctx:n,handlers:o,subscribers:c,innerData:r});if(f)for(var b=0,x=f;b<x.length;b+=1){var $=x[b],N=$[0],w=$[1];Ee({element:y,custom:u,value:w,propPath:N,ctx:n,handlers:o,subscribers:c,innerData:r})}if(h)for(var E=0,k=h;E<k.length;E+=1){var _=k[E];_e({element:y,custom:u,event:_,ctx:n,handlers:o,subscribers:c,innerData:r})}return y}({info:s,ctx:n,innerData:r,refs:a,handlers:o,subscribers:c,namespace:i,fragment:p,custom:l});i&&i===Te&&["foreignobject","desc","title"].indexOf(s.t.toLowerCase())&&(i=""),f&&(i=h);for(var g=0,b=u;g<b.length;g+=1){var x=b[g];x instanceof pe.EFBaseComponent?x.$mount({target:y}):Re({node:x,nodeType:I(x),element:y,ctx:n,innerData:r,refs:a,handlers:o,subscribers:c,namespace:i,create:Pe})}return y},Se=function(e,t){var n=e.base,r=e.key,a=t.checkTrue,o=t.get,c=t.set;if(o){if(!c)throw new Error("[EF] Setter must be defined when getter exists");return o}return a?function(){return a(n(this)[r],this)}:function(){return n(this)[r]}},Ie=function(e,t){var n=e.base,r=e.key,a=t.checkTrue,o=t.trueVal,c=t.falseVal,i=t.get,s=t.set;if(s){if(!i)throw new Error("[EF] Getter must be defined when setter exists");return s}return a?function(e){var t=n(this),a=o,i=c;"function"!=typeof o&&(o=function(){return a}),"function"!=typeof c&&(c=function(){return i}),t[r]=e?o(this):c(this)}:function(e){n(this)[r]=e}},qe=function(e){return e.$data},Ue=function(e){return e?"function"==typeof e?e:("string"==typeof e&&(e=e.split(".")),function(t){for(var n=0,r=e;n<r.length;n+=1){t=t[r[n]]}return t}):qe},Be=function(e,t){for(var n in t){var r=t[n],a={base:Ue(r.base),key:r.key||n},o=Se(a,r),c=Ie(a,r);Object.defineProperty(e.prototype,n,{get:o,set:c,enumerable:!0,configurable:!1})}return e},Le=function(){function e(e,t){void 0===t&&(t={});var n={},r={},a={},o={},c={placeholder:null,replace:[],parent:null,key:null},i=fe.document.createDocumentFragment();c.placeholder=fe.document.createTextNode("");var s=function(){if(c.replace.length>0){for(var e=0,t=c.replace;e<t.length;e+=1){var n=t[e];fe.remove(n)}M.empty(c.replace)}fe.before(c.placeholder,c.element)},u={scope:t,mount:s,refs:n,data:{},innerData:r,methods:{},handlers:a,subscribers:o,nodeInfo:c,safeZone:i,children:{},state:this,isFragment:0===e[0].t,localNamespaces:this.constructor.__local_namespaces};Object.defineProperty(this,"$ctx",{value:u,enumerable:!1,configurable:!0}),z(),c.element=Pe({node:e,ctx:u,innerData:r,refs:n,handlers:a,subscribers:o,namespace:""}),fe.append(i,c.placeholder),G(s),Q()}var t={$data:{configurable:!0},$methods:{configurable:!0},$refs:{configurable:!0}};return t.$data.get=function(){return this.$ctx.data},t.$data.set=function(e){z(),Y(this.$ctx.data,e),Q()},t.$methods.get=function(){return this.$ctx.methods},t.$methods.set=function(e){this.$ctx.methods=e},t.$refs.get=function(){return this.$ctx.refs},e.prototype.$mount=function(e){var t=e.target,n=e.option,r=e.parent,a=e.key,o=this.$ctx,c=o.nodeInfo,i=o.mount;if("string"==typeof t&&(t=document.querySelector(t)),z(),c.parent&&this.$umount(),r||(r=t),a||(a="__DIRECTMOUNT__"),c.parent=r,c.key=a,G(i),!t)return Q(),c.placeholder;switch(n){case De.BEFORE:fe.before(t,c.placeholder);break;case De.AFTER:fe.after(t,c.placeholder);break;case De.REPLACE:fe.before(t,c.placeholder),c.replace.push(t);break;case De.APPEND:default:ce(r,he)?fe.append(t,c.element):fe.append(t,c.placeholder)}return Q()},e.prototype.$umount=function(){var e=this.$ctx,t=e.nodeInfo,n=e.safeZone,r=e.mount,a=t.parent,o=t.key;return t.parent=null,t.key=null,z(),a&&("__DIRECTMOUNT__"!==o?a[o]&&(Array.isArray(a[o])?M.remove(a[o],this):a[o]=je):ce(a,he)&&a.$ctx.nodeInfo.element.removeChild(t.element)),fe.append(n,t.placeholder),G(r),Q()},e.prototype.$subscribe=function(e,t){var n=this.$ctx,r=n.handlers,a=n.subscribers,o=n.innerData,c=e.split("."),i=oe({bind:[c],ctx:n,handlers:r,subscribers:a,innerData:o}),s=i.dataNode,u=i.subscriberNode,p=i._key;z();try{t({state:this,value:s[p]}),u.push(t)}catch(e){ae.error("Error caught when registering subscriber:\n",e)}Q()},e.prototype.$unsubscribe=function(e,t){!function(e,t,n){var r=function(e,t){for(var n=e.split("."),r=n.pop(),a=0,o=n;a<o.length;a+=1){var c=o[a];t[c]||(t[c]={}),t=t[c]}return t[r]}(e,n);M.remove(r,t)}(e,t,this.$ctx.subscribers)},e.prototype.$update=function(e){z(),X(this,e),Q()},e.prototype.$dispatch=function(e){return this.$ctx.nodeInfo.placeholder.dispatchEvent(e)},e.prototype.$emit=function(e,t){return this.$dispatch(ye(e,t))},e.prototype.$on=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return(e=this.$ctx.nodeInfo.placeholder).addEventListener.apply(e,t)},e.prototype.$off=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return(e=this.$ctx.nodeInfo.placeholder).removeEventListener.apply(e,t)},e.prototype.$destroy=function(){var e=this.$ctx,t=e.nodeInfo,n=e.children;for(var r in z(),this.$umount(),n)le.delete(n[r].anchor);for(var a in this)"array"===I(this[a])?this[a].clear():this[a]=null;return delete this.$ctx,G((function(){fe.remove(t.element),fe.remove(t.placeholder)})),Q()},Object.defineProperties(e.prototype,t),e}(),Me=[{t:0}],Ze=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];e.call(this,Me);var r=this.$ctx.nodeInfo.element;r.$children;r.append.apply(r,t),this.$ctx.elements=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={$el:{configurable:!0}};return n.$el.get=function(){return this.$ctx.elements},Object.defineProperties(t.prototype,n),t}(Le),Ke=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];e.call(this,[{t:0}].concat(t))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Le),Je=[{t:0},[["text"]]],Ve=function(e){function t(t){z(),e.call(this,Je),this.text=t,Q()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Le);Be(Ve,{text:{}}),ie(Le,["$mount","$umount","$subscribe","$unsubscribe","$update","$dispatch","$emit","$on","$off","$destroy"]),ie(Ze,["$el"]);var We=function(e){return null==e||e instanceof Le?e:e!==je?e instanceof Node?new Ze(e):new Ve("string"==typeof e?e:JSON.stringify(e)):void 0};pe.EFBaseComponent=Le,pe.toEFComponent=We;var Ge=function(e,t){return Array.isArray(t)?e.push.apply(e,t.map(We)):e.push(We(t)),e},ze=function(e,t){var n,r,a,o=I(e);switch(o){case"array":var c=e[0],i=e.slice(1);if("object"===I(c)){c.a&&function(e,t){for(var n in e)if(0===n.indexOf("xmlns:")){var r=n.split(":")[1];t.__local_namespaces[r]=e[n]}}(c.a,t);for(var s=0,u=i;s<u.length;s+=1){var p=u[s];ze(p,t)}}break;case"object":if(e.t>1)throw new TypeError("[EF] Not a standard ef.js AST: Unknown mounting point type '"+e.t+"'");n=e.t,r=e.n,a=t,Object.defineProperty(a.prototype,r,{get:function(){return this.$ctx.children[r].node},set:function(e){var t=this.$ctx;Ae[n]({ctx:t,key:r,value:e})},enumerable:!0});break;case"string":break;default:throw new TypeError("[EF] Not a standard ef.js AST: Unknown node type '"+o+"'")}},He=S,Qe=function(e){var t,n,r=I(e);if("string"===r)e=function(e,t){return t||(t=S),t(e)}(e,He);else if("array"!==r)throw new TypeError("Cannot create new component without proper template or AST!");return t=e,n=function(e){function n(n,r){z(),e.call(this,t,r),n&&this.$update(n),Q()}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n}(Le),Object.defineProperty(n.prototype,"constructor",{enumerable:!1}),Object.defineProperty(n,"__local_namespaces",{enumerable:!1,value:{}}),ze(t,n),n};e.EFNodeWrapper=Ze,e.EFTextFragment=Ve,e.Fragment=Ke,e.bundle=function(e){z();try{Q(e(z,Q))}catch(e){return Q(),e}},e.create=Qe,e.createElement=function(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];if(e===Ke)return new(Function.prototype.bind.apply(Ke,[null].concat(n)));if(Object.isPrototypeOf.call(Le,e))return n.length<=0?new e(t):new e(Y({children:n.reduce(Ge,[])},t||{}));var a=Y({},t);for(var o in a)!0===a[o]&&(a[o]="");return new Le([{t:e,a:a}].concat(n))},e.declareNamespace=function(e,t){if(ge[e])throw new Error('[EF] Namespace "'+e+'" has already been declared as "'+ge[e]+'".');ge[e]=t},e.exec=Q,e.inform=z,e.isPaused=function(){return V>0},e.mapAttrs=Be,e.mountOptions=De,e.onNextRender=function(e){return J.push(e)},e.parseEft=S,e.scoped=function(e,t){return function(e){function n(n,r){void 0===r&&(r={});var a=Y({},t);e.call(this,n,Y(a,r))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n}(e)},e.setDOMImpl=me,e.setParser=function(e){He=e},e.t=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Qe(q.apply(void 0,e))},e.version="0.12.2",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ef.min.js.map
