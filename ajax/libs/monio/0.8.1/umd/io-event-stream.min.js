!function(e,n,t,r){"function"==typeof define&&define.amd?(t=Object.keys(t).map(e=>e.replace(/^\.\//,"")),define(e,t,r)):"undefined"!=typeof module&&module.exports?(t=Object.keys(t).map(e=>require(e)),module.exports=r(...t)):(t=Object.values(t).map(e=>n[e]),n[e]=r(...t))}("IOEventStream","undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:new Function("return this")(),{"./lib/util.js":"MonioUtil","./io.js":"IO"},function(e,n){"use strict";var{isFunction:t,curry:r}=e;let i={};function o(e){return e.map(function(n,t){return n&&"function"==typeof n.next?(e[t]=async function(){var r=n.next();try{let i=await r;return e[t]=[t,n,i]}catch(n){return e[t]=null,r}}(),e[t]):n}).filter(Boolean)}function u(...e){return n(()=>Promise.all(e.map(async function(e){if(e&&"function"==typeof e.return)try{return await e.return()}catch(e){}})))}function l(){var e;return{pr:new Promise(n=>e=n),next:e}}return(i=r(function(e,r,i={}){var{bufferSize:o=100,throwBufferOverflow:u=!1,evtOpts:f={}}=i;return n(()=>{var n,i;return async function*(){n=[],i=[],t(e.addEventListener)?e.addEventListener(r,a,f):t(e.addListener)?e.addListener(r,a):t(e.on)&&e.on(r,a);try{for(;;){if(0==n.length){let{pr:e,next:t}=l();n.push(e),i.push(t)}yield n.shift()}}finally{t(e.removeEventListener)?e.removeEventListener(r,a,f):t(e.removeListener)?e.removeListener(r,a):t(e.off)&&e.off(r,a),n.length=i.length=0}}();function a(e){if(i.length>0)i.shift()(e);else if(n.length<o){let{pr:t,next:r}=l();n.push(t),r(e)}else if(u){let n=new Error("Event stream buffer overflow");throw n.evt=e,n}}})})).merge=function(...e){return n(()=>(async function*(){try{for(;;){let n=o(e);if(!(n.length>0))return;try{if(1==n.length){let[t,r,i]=await n[0];if(i.done)return void(e[t]=null);e[t]=r,yield i.value}else{let[t,r,i]=await Promise.race(n);e[t]=null,i.done||(e.push(r),yield i.value)}}catch(e){return Promise.reject(e)}}}finally{await u(e)}})())},i.zip=function(...e){return n(()=>(async function*(){try{for(;;){let n=o(e);if(!(n.length>0))return;try{let t=(await Promise.all(n)).reduce(function(n,t){var[r,i,o]=t;return o.done?(e[r]=null,n):(e[r]=i,[...n,o.value])},[]);if(!(t.length>0))return;yield t}catch(e){return Promise.reject(e)}}}finally{await u(...e).run()}})())},i.close=u,i});