!function(A){A.extend(A.jqx._jqxGrid.prototype,{_exportData:function(e,t,r){var h=this,s=(s="string"==typeof t?t:t.fileName)||"jqxGrid";t&&"string"!=typeof t||(t={header:!0,filterBy:null,groupBy:null,style:null,fileName:s,pageOrientation:"portrait",expandChart:"+",collapseChar:"-"});var l=new A.jqx.dataAdapter.DataExporter({exportHeader:t.header});l.expandChar=t.expandChar,l.collapseChar=t.collapseChar,l.pageOrientation=t.pageOrientation,l.style=t.style,l.filterBy=t.filterBy,l.groupBy=t.groupBy;for(var o=[],i=h.columngroups||[],a=0,n=0;n<h.columns.records.length;n++){(T=h.columns.records[n]).exportable&&null!==h.columns.records[n].datafield&&(o[a++]={label:h.columns.records[n].text,dataField:h.columns.records[n].datafield})}if(l.header={columns:o,columngroups:i},!t.style){var d=window.getComputedStyle(h.element),f=window.getComputedStyle(0<h.columns.records.length&&h.columns.records[0].element?h.columns.records[0].element:h.host.find(".jqx-grid-header")[0]),c=window.getComputedStyle(h.host.find(".jqx-grid-header")[0]);if(!(0===h.offsetWidth||0===h.offsetHeight)){function g(e){function n(e){return isNaN(e)?"00":o[(e-e%16)/16]+o[e%16]}function t(e){if(-1==e.toString().indexOf("rgba"))return(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#"+n(e[1])+n(e[2])+n(e[3]).toUpperCase():"#ffffff";var t=d.split(","),r=parseInt(t[0].substring(5)),s=parseInt(t[1]),l=parseInt(t[2]),o=parseFloat(t[3].substring(1,4)),i={r:r,g:s,b:l},a=h._rgbToHex(i);return 0==r&&0==s&&0==l&&0==o?"#ffffff":"#"+a}var r=e.fontSize,s=e.borderRightColor,l=e.backgroundColor,d=e.color,o=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return{borderColor:t(s),fontSize:r,fontFamily:"Helvetica",color:t(d),backgroundColor:t(l)}}for(var u,p,m=g(d),y=g(f),x=g(c),b={height:"30px",border:"1px solid "+m.borderColor,fontFamily:x.fontFamily,fontSize:x.fontSize,color:x.color,backgroundColor:y.backgroundColor,fontWeight:"400"},v={border:"1px solid "+m.borderColor,fontFamily:m.fontFamily,fontSize:m.fontSize},w={height:h.rowsheight+"px"},n=0;n<h.columns.records.length;n++){(T=h.columns.records[n]).exportable&&(b[T.datafield]={textAlign:T.align,width:T.width+"px",format:T.cellsformat||""},u=T.cellsformat||"","date"===T.dataType?u="d":"dateTime"===T.dataType?u="D":"time"===T.dataType&&(u="t"),p={textAlign:T.cellsalign,format:u},v[T.datafield]=p)}h.altrows&&(w.alternationCount=2,w.alternationStart=0,w.alternationEnd=0,w.alternationIndex0Color=m.color,w.alternationIndex0BackgroundColor=m.backgroundColor,w.alternationIndex1Color=m.color,w.alternationIndex1BackgroundColor="#F5F5F5"),l.style={border:"1px solid "+m.borderColor,borderCollapse:"collapse",header:b,columns:v,rows:w}}}for(var C=r||this.getrows(),S=[],n=0;n<C.length;n++){var j=C[n];if(!j.hidden){for(var T,q={},F=0;F<h.columns.records.length;F++){(T=h.columns.records[F]).exportable&&(q[T.datafield]=j[T.datafield])}S.push(q)}}return!t.groupBy&&h.groups&&(l.groupBy=h.groups.slice(0)),l.exportData(S,e,t.fileName,null)},exportview:function(e,t,r){this._exportData(e,t,r)},exportdata:function(h,e,f,c,t,r,s){if(!A.jqx.dataAdapter.ArrayExporter)throw"jqxGrid: Missing reference to jqxdata.export.js!";if("xlsx"!==h){null==f&&(f=!0);var g=this;if(null==c)if(0==(c=this.getrows()).length)throw"No data to export.";this.exporting=!0,this.pageable||(this.loadondemand=!0),this.altrows&&this._renderrows(this.virtualsizeinfo);var l=this.hScrollInstance.value;this.hScrollInstance.setPosition(0),this._renderrows(this.virtualsizeinfo);var u=null!=t&&t,p={},m={},o=this.host.find(".jqx-grid-cell:first"),i=this.host.find(".jqx-grid-cell-alt:first");o.removeClass(this.toThemeProperty("jqx-grid-cell-selected")),o.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),i.removeClass(this.toThemeProperty("jqx-grid-cell-selected")),i.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),o.removeClass(this.toThemeProperty("jqx-grid-cell-hover")),o.removeClass(this.toThemeProperty("jqx-fill-state-hover")),i.removeClass(this.toThemeProperty("jqx-grid-cell-hover")),i.removeClass(this.toThemeProperty("jqx-fill-state-hover"));for(var y="cell",x=1,b="column",v=1,w=[],a=0;a<this.columns.records.length;a++){var n=this.columns.records[a];if(""!=n.cellclassname)if(n.customCellStyles=new Array,"string"==typeof n.cellclassname)for(var d=0;d<c.length;d++)n.customCellStyles[d]=n.cellclassname;else for(d=0;d<c.length;d++){var C=this.getrowboundindex(d),S=n.cellclassname(C,n.displayfield,c[d][n.displayfield],c[d]);S&&(n.customCellStyles[d]=S)}}var j,T,q,F=new Array,_=null,I=null,P=null;A.each(this.columns.records,function(e){var t,r=A(g.table[0].rows[0].cells[e]);1<g.table[0].rows.length&&(t=A(g.table[0].rows[1].cells[e]),P=P||t),I=I||r;function s(e){if(e.removeClass(g.toThemeProperty("jqx-grid-cell-selected")),e.removeClass(g.toThemeProperty("jqx-fill-state-pressed")),e.removeClass(g.toThemeProperty("jqx-grid-cell-hover")),e.removeClass(g.toThemeProperty("jqx-fill-state-hover")),l.customCellStyles)for(var t in l.customCellStyles)e.removeClass(l.customCellStyles[t])}var l=this;if(s(r),t&&s(t),null==this.displayfield)return!0;g.showaggregates&&g.getcolumnaggregateddata&&w.push(g.getcolumnaggregateddata(this.displayfield,this.aggregates,!0,c));var d=g._getexportcolumntype(this);!this.exportable||this.hidden&&!u||(p[this.displayfield]={},p[this.displayfield].text=this.text,p[this.displayfield].width=parseInt(this.width),isNaN(p[this.displayfield].width)&&(p[this.displayfield].width=60),p[this.displayfield].formatString=this.cellsformat,p[this.displayfield].localization=g.gridlocalization,p[this.displayfield].type=d,p[this.displayfield].cellsAlign=this.cellsalign,p[this.displayfield].hidden=!f,p[this.displayfield].displayfield=this.displayfield,F.push(p[this.displayfield])),y="cell"+x;var o,i=A(this.element);if(null==this.element&&(i=A(this.uielement)),_?l._rendered||(i=_,r=I,t=P,o=g.toTP("jqx-grid-cell")+" "+g.toTP("jqx-item"),r[0].className=o,o+=g.toTP("jqx-grid-cell-alt"),t&&(t[0].className=o)):_=i,b="column"+v,"html"==h||"xls"==h||"pdf"==h){function a(e,t,r,s,l,o,i,a,n){m[e]={},null!=t&&0!=t[0].offsetWidth&&0!=t[0].offsetHeight&&(m[e]["font-size"]=t.css("font-size"),m[e]["font-weight"]=t.css("font-weight"),m[e]["font-style"]=t.css("font-style"),m[e]["background-color"]=o._getexportcolor(t.css("background-color")),m[e].color=o._getexportcolor(t.css("color")),m[e]["border-color"]=o._getexportcolor(t.css("border-top-color")),r?m[e]["text-align"]=l.align:(m[e]["text-align"]=l.cellsalign,m[e].formatString=l.cellsformat,m[e].dataType=d),"html"!=h&&"pdf"!=h||(m[e]["border-top-width"]=t.css("border-top-width"),m[e]["border-left-width"]=t.css("border-left-width"),m[e]["border-right-width"]=t.css("border-right-width"),m[e]["border-bottom-width"]=t.css("border-bottom-width"),m[e]["border-top-style"]=t.css("border-top-style"),m[e]["border-left-style"]=t.css("border-left-style"),m[e]["border-right-style"]=t.css("border-right-style"),m[e]["border-bottom-style"]=t.css("border-bottom-style"),r?(0==i&&(m[e]["border-left-width"]=t.css("border-right-width")),m[e]["border-top-width"]=t.css("border-right-width"),m[e]["border-bottom-width"]=t.css("border-bottom-width")):0==i&&(m[e]["border-left-width"]=t.css("border-right-width")),m[e].height=t.css("height")),!l.exportable||l.hidden&&!u||(1==a?(p[l.displayfield].customCellStyles||(p[l.displayfield].customCellStyles=new Array),p[l.displayfield].customCellStyles[n]=e):r?p[l.displayfield].style=e:s?p[l.displayfield].cellAltStyle=e:p[l.displayfield].cellStyle=e))}if(a(b,i,!0,!1,this,g,e),v++,a(y,r,!1,!1,this,g,e),g.altrows&&a(y="cellalt"+x,t,!1,!0,this,g,e),this.customCellStyles){for(var n in l.customCellStyles)r.removeClass(l.customCellStyles[n]);for(var n in l.customCellStyles)r.addClass(l.customCellStyles[n]),a(y+l.customCellStyles[n],r,!1,!1,this,g,e,!0,n),r.removeClass(l.customCellStyles[n])}x++}}),A.each(this.columns.records,function(e){p[this.displayfield]&&(p[this.displayfield].columnsDataFields=F)}),this.showaggregates&&(j=[],T="xls"==h?"_AG":"",q=this.groupable?this.groups.length:0,this.rowdetails&&q++,"checkbox"===this.selectionmode&&q++,0<w.length&&(A.each(this.columns.records,function(e){if(this.aggregates)for(var t,r,s,l=0;l<this.aggregates.length;l++){j[l]||(j[l]={}),j[l]&&(t=g._getaggregatename(this.aggregates[l]),r=g._getaggregatetype(this.aggregates[l]),(s=w[e-q])&&(j[l][this.displayfield]=T+t+": "+s[r]))}}),A.each(this.columns.records,function(e){for(var t=0;t<j.length;t++)null==j[t][this.displayfield]&&(j[t][this.displayfield]=T)})),A.each(j,function(){c.push(this)}));var z=this,N=A.jqx.dataAdapter.ArrayExporter(c,p,m);if(null==e){this._renderrows(this.virtualsizeinfo);var O=N.exportTo(h);return this.showaggregates&&A.each(j,function(){c.pop(this)}),setTimeout(function(){z.exporting=!1},50),this.hScrollInstance.setPosition(l),this._renderrows(this.virtualsizeinfo),O}N.exportToFile(h,e,r,s),this.showaggregates&&A.each(j,function(){c.pop(this)}),this._renderrows(this.virtualsizeinfo),setTimeout(function(){z.exporting=!1},50),this.hScrollInstance.setPosition(l),this._renderrows(this.virtualsizeinfo)}else this._exportData("xlsx",e)},_getexportcolor:function(e){var t,r="transparent"==e?"#FFFFFF":e;if(r&&r.toString()||(r="#FFFFFF"),-1==r.toString().indexOf("rgb"))return-1!=r.toString().indexOf("#")&&4==r.toString().length&&(t=r.toString().substring(1,4),r+=t),r;var s=r.split(",");if(-1!=r.toString().indexOf("rgba")){var l=parseInt(s[0].substring(5)),o=parseInt(s[1]),i=parseInt(s[2]),a=parseFloat(s[3].substring(1,4)),n={r:l,g:o,b:i},d=this._rgbToHex(n);return 0==l&&0==o&&0==i&&0==a?"#ffffff":"#"+d}n={r:l=parseInt(s[0].substring(4)),g:o=parseInt(s[1]),b:i=parseInt(s[2].substring(1,4))};return"#"+(d=this._rgbToHex(n))},_rgbToHex:function(e){return this._intToHex(e.r)+this._intToHex(e.g)+this._intToHex(e.b)},_intToHex:function(e){var t=parseInt(e).toString(16);return 1==t.length&&(t="0"+t),t.toUpperCase()},_getexportcolumntype:function(e){var t="string",r=this.source.datafields||(this.source._source?this.source._source.datafields:null);if(r){var s="";if(A.each(r,function(){if(this.name==e.displayfield)return this.type&&(s=this.type),!1}),s)return s}if(null!=e){if(null==this.dataview.cachedrecords)return t;var l=null;if(this.virtualmode)A.each(this.dataview.cachedrecords,function(){return l=this[e.displayfield],!1});else{if(0==this.dataview.cachedrecords.length)return t;if(null!=(l=this.dataview.cachedrecords[0][e.displayfield])&&""==l.toString())return"string"}if(null!=l){if(-1!=e.cellsformat.indexOf("c"))return"number";if(-1!=e.cellsformat.indexOf("n"))return"number";if(-1!=e.cellsformat.indexOf("p"))return"number";if(-1!=e.cellsformat.indexOf("d"))return"date";if(-1!=e.cellsformat.indexOf("y"))return"date";if(-1!=e.cellsformat.indexOf("M"))return"date";if(-1!=e.cellsformat.indexOf("m"))return"date";if(-1!=e.cellsformat.indexOf("t"))return"date";if("boolean"==typeof l)t="boolean";else if(A.jqx.dataFormat.isNumber(l))t="number";else{var o=new Date(l);if("NaN"==o.toString()||"Invalid Date"==o.toString())if(A.jqx.dataFormat){if(null!=(o=A.jqx.dataFormat.tryparsedate(l))){if(o&&o.getFullYear()&&1970==o.getFullYear()&&0==o.getMonth()&&1==o.getDate()){var i=new Number(l);return isNaN(i)?"string":"number"}return"date"}t="string"}else t="string";else t="date"}}}return t}})}(jqxBaseFramework);