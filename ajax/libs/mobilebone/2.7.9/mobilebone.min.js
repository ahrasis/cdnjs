!function(e,a){"function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(t){return a(e,t)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(e,{}):e.Mobilebone=a(e,{})}("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,function(o,f){if(document.MBLOADED)return o.console&&console.warn("Don't repeat load Mobilebone!"),{};var h={},m=[].slice,s=/^#?\w+(?:[\-_]\w+)*$/i,g="WebkitAppearance"in document.documentElement.style||void 0!==document.webkitHidden,y="pushState"in history&&"replaceState"in history;f.support=y;var l=!1;if(f.VERSION="2.7.9",f.captureLink=!0,f.captureForm=!0,f.rootTransition=o,f.mergeCallback=!0,f.classAnimation="slide",f.classPage="page",f.classMask="mask",f.pushStateEnabled=!0,f.evalScript=!1,0<=window.navigator.userAgent.indexOf("Firefox")&&window.top!==window&&(f.pushStateEnabled=!1),0==y)return f;history.popstate=!1,f.transition=function(t,e,a,o){if(0!=arguments.length&&t!=e){3==arguments.length&&1==isNaN(+a)&&(a=(o=a).back),e=e||null,a=a||!1,o=o||{};function s(a){if(!a||!a.getAttribute)return{};var n={},i=v(a.getAttribute("data-params")||"");return["title","root","form"].forEach(function(t){n[t]=a.getAttribute("data-"+t)||i[t]||o[t]||r[t]}),"string"==typeof n.root&&(n.root=f.getFunction(n.root)),["onpagefirstinto","callback","fallback","animationstart","animationend","preventdefault"].forEach(function(t){var e;1==f.mergeCallback&&"function"==typeof r[t]?(e=a.getAttribute("data-"+t)||i[t],"function"==typeof n.root[e]?n[t]=function(){r[t].apply(this,arguments),n.root[e].apply(this,arguments)}:"function"==typeof o[t]?n[t]=function(){r[t].apply(this,arguments),o[t].apply(this,arguments)}:n[t]=r[t]):n[t]=a.getAttribute("data-"+t)||i[t]||o[t]||r[t]}),n}var n,i,r={root:this.rootTransition,form:this.form||this.classAnimation,onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,preventdefault:this.preventdefault,fallback:this.fallback,callback:this.callback},l=s(e),c=s(t);if(null!=e&&e.classList&&(u=!1,"string"==typeof(n=l.preventdefault)&&(n=l.root[n])),null!=t&&t.classList&&(p=!1,"string"==typeof(i=c.preventdefault)&&(i=c.root[i])),"function"==typeof n&&(u=n.call(l.root,t,e,o)),1==u&&n===i)return!1;if("function"==typeof i&&(p=i.call(c.root,t,e,o)),1==p)return!1;var u,d,p=function(i,r){1!=i.flagAniBind&&["animationstart","animationend"].forEach(function(t,e){var a=c[t],n="webkit"+t.replace(/^a|s|e/g,function(t){return t.toUpperCase()}),t=g?n:t;e&&i.addEventListener(t,function(){0==this.classList.contains("in")&&(this.style.display="none"),this.classList.remove(s(this).form)}),"string"==typeof a&&c.root[a]?i.addEventListener(t,function(){r.root[a].call(r.root,this,this.classList.contains("in")?"into":"out",o)}):"function"==typeof a&&i.addEventListener(t,function(){a.call(r.root,this,this.classList.contains("in")?"into":"out",o)}),i.flagAniBind=!0})};null!=e&&e.classList&&1!=u&&(e.classList.add(l.form),e.offsetWidth,e.style.display="block",e.classList.add("out"),e.classList.remove("in"),e.classList[a?"add":"remove"]("reverse"),e.removeSelf=e.removeSelf||null,p(e,l),"string"==typeof(d=l.fallback)&&(d=l.root[d]),"function"==typeof d&&d.call(l.root,t,e,o)),null!=t&&t.classList&&(u=c.title,d=document.querySelector("h1"),l=document.querySelector("."+this.classPage),u&&!1!==o.title?(document.title=u,d&&(d.innerHTML=u,d.title=u)):l==t&&!e&&document.title&&t.setAttribute("data-title",document.title),d=o.id||t.id,u=o.id||t.id,e&&t.classList.add(c.form),t.offsetWidth,t.style.display="block",t.classList.remove("out"),t.classList.add("in"),t.classList[a?"add":"remove"]("reverse"),l=c.onpagefirstinto,t.firstintoBind||("string"==typeof l&&c.root[l]?c.root[l].call(c.root,t,e,o):"function"==typeof l&&l.call(c.root,t,e,o),m.call(t.querySelectorAll("form")).forEach(function(t){f.submit(t)}),t.firstintoBind=!0),p(t,c),p="",(u=u)&&0==/#/.test(u)&&(u="#"+u),p=u.replace(/#/,"#&"),y&&this.pushStateEnabled&&!1!==o.history&&u&&p!=location.hash&&(history.popstate=!1,history[e?"pushState":"replaceState"](null,document.title,u.replace(/#/,"#&"))),h[d]||(h[d]=t),"string"==typeof(d=c.callback)&&(d=c.root[d]),"function"==typeof d&&d.call(c.root,t,e,o),setTimeout(function(){history.popstate=!0},17),0==a&&0==history.popstate?h.lastShip=[t,e]:h.lastShip=null)}},f.remove=function(t){if(!t)return this;var e=t,t=t;if("string"==typeof t?e=h[t]:e.tagName&&"a"==e.tagName.toLowerCase()&&(t=this.getCleanUrl(e),e=h[t]),e&&e.parentElement){for(var a in h)h[a]==e&&delete h[a];e.parentElement.removeChild(e)}},f.getCleanUrl=function(t,e,a){var n="",i="",r="";if(t)if(1==t.nodeType)if(t.action){if(n=t.getAttribute("action"),t.method&&"POST"==t.method.toUpperCase())return n;window.$&&$.fn&&$.fn.serialize?i=$(t).serialize():(i={},m.call(t.querySelectorAll("input,select,textarea")).forEach(function(t){var e,a;t.name&&!t.disabled&&(e=t.value.trim(),a=t.name,/^radio|checkbox/i.test(t.type)?t.checked&&(i[a]?i[a].push(e):i[a]=[e]):i[a]=[e])}))}else{n=t.getAttribute("href"),i=t.getAttribute("data-formdata")||t.getAttribute("data-params")||"";var o="container",s=t.getAttribute("data-"+o);-1==i.indexOf(o)&&s&&(s=o+"="+s,i=i?i+"&"+s:s)}else t.url&&(n=t.url,i=t.data);if(!(n=n||e))return"";if("object"==typeof(i=i||a||"")){var l=[];for(key in i)i[key].forEach||(i[key]=[i[key]]),i[key].forEach(function(t){l.push(key+"="+encodeURIComponent(t))});i=0<l.length?l.join("&"):""}return"?"==(r=n.split("#")[0].replace(/&+$/,"")).slice(-1)&&(r=r.split("?")[0]),""!=i&&(/\?/.test(r)?r=r+"&"+(i=i.replace(/^&|\?/,"")):""!=i&&(r=r+"?"+(i=i.replace("?","")))),r},f.createPage=function(t,e,a){var n,i,r,o,s,l,c=null,u=null,d=this.classPage,p=null;t&&(void 0===a&&"object"==typeof e&&(a=e),a=a||{},n={},e&&(1==e.nodeType?((e.href||e.action)&&(i=e.getAttribute("data-title")||a.title),c=a.response,l=e.getAttribute("data-container"),u=document.getElementById(l),r=e.getAttribute("data-classpage"),p=(n.target=e).getAttribute("data-reload"),("form"==e.tagName.toLowerCase()||null!==p&&"false"!=p)&&(n.reload=!0),n.back="back"==e.getAttribute("data-rel"),"false"==e.getAttribute("data-history")&&(n.history=!1)):(c=e.response||a.response,i=e.title||a.title,u=e.container||a.container,r=e.classPage||a.classPage,n.target=e.target,n.back=e.back||a.back),u&&r&&(d=r)),o=(d==r?u:document).querySelector(".in."+d),s=null,l=document.createElement("div"),"string"==typeof t?l.innerHTML=t:l.appendChild(t),1==f.evalScript&&1!=t.firstintoBind&&m.call(l.getElementsByTagName("script")).forEach(function(t){var e=t.innerHTML.trim(),a=t.type||t.getAttribute("type"),n=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");a&&(i.type=a),e?i.appendChild(document.createTextNode(e)):t.src&&!document.querySelector('script[src="'+t.src+'"]')&&(i.src=t.src),setTimeout(function(){n.insertBefore(i,n.firstChild),n.removeChild(i),i=null},17),t=null}),p=l.getElementsByTagName("title")[0],(s=l.querySelector("."+d))||(l.className=d+" out",s=l),"string"==typeof i?s.setAttribute("data-title",i):p&&p.innerText&&s.setAttribute("data-title",p.innerText),n.response=c||t,n.id=this.getCleanUrl(e)||s.id||a.id||a.url||"unique"+Date.now(),"object"==typeof a&&(void 0!==a.history&&(n.history=a.history),void 0!==a.remove&&(n.remove=a.remove),void 0!==a.target&&(n.target=a.target),void 0!==a.title&&(n.title=a.title),void 0!==a.query&&(n.query=a.query)),d==r&&(n.history=!1,n.classPage=d),u=u||document.body,1==n.remove&&n.id&&this.remove(n.id),(d=n.id.split("?")[0])&&h[d]&&u.contains(h[d])?u.insertBefore(s,h[d]):u.appendChild(s),l=null,this.transition(s,o,n),(l=h.backShip||[]).push({pageIn:s,pageOut:o,isBack:!!n.back}),h.backShip=l)},f.getFunction=function(t){if("string"==typeof t){for(var e=f.rootTransition,a=t.split("."),n=0;n<a.length&&(e=e[a[n]]);n+=1);return e}},f.ajax=function(a){if(a){var t={url:"",type:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},n={},i=null,e=null,r=this.classMask,o={};if(1==a.nodeType){for(s in o=v(a.getAttribute("data-params")||""),t)n[s]=a.getAttribute("data-"+s)||o[s]||t[s],"function"==typeof t[s]&&"string"==typeof n[s]&&(n[s]=this.getFunction(n[s]),"function"!=typeof n[s]&&(n[s]=t[s]));n.url=this.getCleanUrl(a,n.url);var s,l=v(n.url.split("?")[1]);for(s in l)void 0===o[s]&&(o[s]=l[s]);n.query=o,n.target=a,n.back="back"==a.getAttribute("data-rel");var c,u=a.tagName.toLowerCase();"form"==u?(n.type=a.method,e=new FormData(a)):"a"==u&&(d=a.getAttribute("data-container"),c=a.getAttribute("data-classpage"),(d=d&&document.getElementById(d))&&c&&c!=f.classPage&&(n.history=!1,n.title=!1)),"true"!=(c=a.getAttribute("data-mask"))&&""!=c||(i=a.querySelector("."+r))}else{if(!a.url)return;for(key2 in t)n[key2]=a[key2]||t[key2];n.url=this.getCleanUrl(null,n.url,n.data),n.title=a.title,n.back=a.back,n.container=a.container,n.query=v(a.url.split("?")[1])}var d=d||document.body;"string"!=typeof c&&(i=[].slice.call(d.children).filter(function(t){return t.classList.contains(r)})[0]),null==i&&((i=document.createElement("div")).className=r,i.innerHTML='<i class="loading"></i>',("string"==typeof c?a:d).appendChild(i)),i.style.display="inline",this.showLoading&&this.showLoading();var p=new XMLHttpRequest;p.open(n.type||"GET",n.url+(/\?/.test(n.url)?"&":"?")+"r="+Date.now(),n.async,n.username,n.password),p.timeout=n.timeout,p.onload=function(){var e=null;if(200==p.status){if("json"==n.dataType||"JSON"==n.dataType)try{e=JSON.parse(p.response),n.response=e,f.createPage(f.jsonHandle(e,n),a,n)}catch(t){n.message="JSON parse errorï¼š"+t.message,n.error.call(n,p,p.status)}else if("unknown"==n.dataType){n.history=!1;try{e=JSON.parse(p.response),n.response=e,f.createPage(f.jsonHandle(e,n),a,n)}catch(t){e=p.response,f.createPage(e,a,n)}}else e=p.response,f.createPage(e,a,n);n.success.call(n,e,p.status)}else n.message="The status code exception!",n.error.call(n,p,p.status);n.complete.call(n,p,p.status),i.style.display="none",this.hideLoading&&this.hideLoading()},p.onerror=function(t){n.message="Illegal request address or an unexpected network error!",n.error.call(n,p,p.status),i.style.display="none",this.hideLoading&&this.hideLoading()},p.ontimeout=function(){n.message="The request timeout!",n.error.call(n,p,p.status),i.style.display="none",this.hideLoading&&this.hideLoading()},p.setRequestHeader("Type","ajax"),p.setRequestHeader("From","mobilebone"),p.send(e)}},f.submit=function(t){var e;t&&"string"==typeof t.action&&("false"==(e=t.getAttribute("data-ajax"))||0==f.captureForm&&"true"!=e||t.addEventListener("submit",function(t){var e=this.getAttribute("data-preventdefault"),e=f.getFunction(e);if("function"==typeof e&&1==e(this))return t.preventDefault(),!1;f.ajax(this),t.preventDefault()}))},f.isBack=function(e,a){if(1==history.tempBack)return!(history.tempBack=null);if(void 0===e)return!1;if(!a)return!1;var t=h.backShip||[],n=null;return t.forEach(function(t){t.pageIn==e&&t.pageOut==a?n=t.isBack:t.pageIn==a&&t.pageOut==e&&(n=!t.isBack)}),null===n&&(n=!!(e.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING)),n},f.jsonHandle=function(t,e){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},f.init=function(){if(1==l)return"Don't repeat initialization!";var t=location.hash.replace("#&","#"),e=null,a=null,n=t.split("?")[0],i=t.split("?")[1],r={query:{}};i&&(r.query=v(i)),""==n||"#"==n?this.transition(document.querySelector("."+this.classPage)):1==s.test(n)&&(e=document.querySelector(n))&&e.classList.contains(this.classPage)?(r.id=t.replace(/^#/,""),this.transition(e,null,r)):(2==t.split("container=").length&&(a=document.getElementById(t.split("container=")[1].split("&")[0])),this.ajax({url:t.replace("#",""),dataType:"unknown",container:a,error:function(){r.id=t.replace(/^#/,""),e=document.querySelector("."+f.classPage),f.transition(e,null,r)}}));a=o.$||o.jQuery||o.Zepto;a&&a.fn&&a.fn.tap&&"ontouchstart"in window==1?(a(document).tap(this.handleTapEvent),document.addEventListener("click",function(t){var e,a,n=t.target;n&&("a"!=n.tagName.toLowerCase()&&!(n=n.getParentElementByTag("a"))||(e=n.getAttribute("data-ajax"),a=n.href,"external"==n.getAttribute("data-rel")||"false"==e||a.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0]&&"true"!=e||0==f.captureLink&&"true"!=e?/^http/i.test(a)&&(location.href=a):t.preventDefault()))})):document.addEventListener("click",this.handleTapEvent);a=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&void 0!==document.hidden&&!window.chrome;"ontouchstart"in window==1&&a&&(document.addEventListener("touchmove",function(){history.popstateswipe=!0}),document.addEventListener("touchend",function(){history.popstateswipe=!1})),l=!0},f.handleTapEvent=function(t){var e=null;t&&1==t.nodeType&&((e=t).preventDefault=function(){});var a=(e=e||t.target||t.touches[0]).href;a&&0!=/a/i.test(e.tagName)||!(e=e.getParentElementByTag("a"))||(a=e.href);var n=document.querySelector(".in."+f.classPage);if(null!=n&&e){var i={target:e},r=e.getAttribute("data-preventdefault")||v(e.getAttribute("data-params")||"").preventdefault,o=f.getFunction(r);if("function"==typeof o&&1==o(e))return t.preventDefault(),!1;var s=e.getElementsByClassName(f.classMask)[0];if(s&&"none"!=s.style.display)return t.preventDefault(),!1;var l=e.getAttribute("data-container"),c=e.getAttribute("data-classpage"),r=l&&document.getElementById(l);r&&c&&c!=f.classPage&&(n=r.querySelector(".in."+c)||r.querySelector(c),i.history=!1,i.title=!1,i.classPage=c),"false"==e.getAttribute("data-history")&&(i.history=!1);o=1==f.captureLink,s=e.getAttribute("data-rel"),l=!1;"back"==s&&(l=!0);c="external"==s;if(a)if(a=a.replace("#&","#"),""!==e.getAttribute("href").replace(/#/g,"")){if(/^javascript/.test(a)){if(0==l)return}else if((1==(c=c||a.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0])||0==o)&&"true"!=e.getAttribute("data-ajax"))return;var u,c=e.getAttribute("href");1==/^#/.test(c)?(o=(u=a.split("#")[1]).split("?")[0],c=u.split("?")[1],i.query=v(c),i.id=u,u=o&&document.getElementById(o),0==l&&"auto"==s&&(l=f.isBack(u,n)),u&&((o=h.lastShip)&&u==o[1]&&n==o[0]?(history.tempBack=!0,history.back()):f.transition(u,n,l,i)),t.preventDefault()):/^javascript/.test(a)?(history.tempBack=!0,history.back()):"false"!=e.getAttribute("data-ajax")&&(u=f.getCleanUrl(e),i.query=v(u.split("?")[1]),null!=(a=e.getAttribute("data-reload"))&&"false"!=a||!h[u]?("string"==typeof a&&"false"!=a&&(""!=a&&"true"!=a?m.call(document.querySelectorAll('a[data-reload="'+a+'"]')).forEach(function(t){f.remove(t)}):f.remove(h[u])),f.ajax(e)):(0==l&&"auto"==s&&(l=f.isBack(h[u],n)),i.id=u,0==(r=r||document.body).contains(h[u])&&r.appendChild(h[u]),f.transition(h[u],n,l,i)),t.preventDefault())}else t.preventDefault()}},Element.prototype.getParentElementByTag=function(e){if(!e)return null;var a=null,n=this,i=function(){if(!(n=n.parentElement))return null;var t=n.tagName.toLowerCase();t===e?a=n:"body"==t?a=null:i()};return i(),a};var v=function(t){var a={};return"string"==typeof t&&t.split("&").forEach(function(t){var e=t.split("=");1<e.length&&(a[e[0]]=t.replace(e[0]+"=",""))}),a};return window.addEventListener("DOMContentLoaded",function(){0==l&&f.init()}),window.addEventListener("popstate",function(){if(1==history.popstateswipe)return location.reload(),void(history.popstateswipe=!1);if(0!=history.popstate){var t=location.hash.replace("#&","#").replace(/^#/,""),e=t.split("?")[0],a=null,n=document.querySelector(".in."+f.classPage),i=null;if(""==t){if((a=document.querySelector("."+f.classPage)).id)return}else if(a=h[e]||h[t],2==t.split("container=").length&&(i=document.getElementById(t.split("container=")[1].split("&")[0])),a&&0==s.test(e))return void f.transition(a,n,f.isBack(a,n),{id:t,history:!1,container:i,target:document.activeElement,query:v(t.split("?")[1])});if(!a){if(0==s.test(t))return void f.ajax({url:t,dataType:"unknown",back:f.isBack(),container:i});a=document.querySelector("#"+e)||document.querySelector("#"+t)}a&&a==n||0==f.pushStateEnabled||a&&f.transition(a,n,f.isBack(a,n),{id:t,history:!1,target:document.activeElement,query:v(t.split("?")[1])})}else history.popstate=!0}),document.MBLOADED=!0,f});