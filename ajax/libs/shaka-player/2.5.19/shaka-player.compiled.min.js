!function(){var e="undefined"!=typeof window?window:global,t={};if(function(d,e,t){var o="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)},u=(void 0===d||d!==this)&&void 0!==e&&null!=e?e:this;function c(){c=function(){},u.Symbol||(u.Symbol=i)}var n,i=(n=0,function(e){return"jscomp_symbol_"+(e||"")+n++});function l(){c();var e=(e=u.Symbol.iterator)||(u.Symbol.iterator=u.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&o(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return r(this)}}),l=function(){}}function r(e){var t=0;return a(function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}})}function a(e){return l(),(e={next:e})[u.Symbol.iterator]=function(){return this},e}function F(e){l();var t=e[Symbol.iterator];return t?t.call(e):r(e)}function s(e,t){if(t){for(var n=u,i=e.split("."),r=0;r<i.length-1;r++){var a=i[r];a in n||(n[a]={}),n=n[a]}(a=t(r=n[i=i[i.length-1]]))!=r&&null!=a&&o(n,i,{configurable:!0,writable:!0,value:a})}}function f(t){function r(e){return t.next(e)}function a(e){return t.throw(e)}return new Promise(function(n,i){!function e(t){t.done?n(t.value):Promise.resolve(t.value).then(r,a).then(e,i)}(t.next())})}function H(e){return f(e())}s("Promise",function(e){function o(e){this.b=0,this.g=void 0,this.a=[];var t=this.c();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}function t(){this.a=null}function s(t){return t instanceof o?t:new o(function(e){e(t)})}if(e)return e;t.prototype.b=function(e){null==this.a&&(this.a=[],this.f()),this.a.push(e)},t.prototype.f=function(){var e=this;this.c(function(){e.h()})};var n=u.setTimeout;t.prototype.c=function(e){n(e,0)},t.prototype.h=function(){for(;this.a&&this.a.length;){var e=this.a;this.a=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(e){this.g(e)}}}this.a=null},t.prototype.g=function(e){this.c(function(){throw e})},o.prototype.c=function(){function e(t){return function(e){i||(i=!0,t.call(n,e))}}var n=this,i=!1;return{resolve:e(this.u),reject:e(this.f)}},o.prototype.u=function(e){if(e===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.v(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.o(e):this.h(e)}},o.prototype.o=function(e){var t=void 0;try{t=e.then}catch(e){return void this.f(e)}"function"==typeof t?this.D(t,e):this.h(e)},o.prototype.f=function(e){this.i(2,e)},o.prototype.h=function(e){this.i(1,e)},o.prototype.i=function(e,t){if(0!=this.b)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.b);this.b=e,this.g=t,this.l()},o.prototype.l=function(){if(null!=this.a){for(var e=0;e<this.a.length;++e)r.b(this.a[e]);this.a=null}};var r=new t;return o.prototype.v=function(e){var t=this.c();e.kc(t.resolve,t.reject)},o.prototype.D=function(e,t){var n=this.c();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},o.prototype.then=function(e,t){function n(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(e){r(e)}}:e}var i,r,a=new o(function(e,t){i=e,r=t});return this.kc(n(e,i),n(t,r)),a},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.kc=function(e,t){function n(){switch(i.b){case 1:e(i.g);break;case 2:t(i.g);break;default:throw Error("Unexpected state: "+i.b)}}var i=this;null==this.a?r.b(n):this.a.push(n)},o.resolve=s,o.reject=function(n){return new o(function(e,t){t(n)})},o.race=function(r){return new o(function(e,t){for(var n=F(r),i=n.next();!i.done;i=n.next())s(i.value).kc(e,t)})},o.all=function(e){var t=F(e),a=t.next();return a.done?s([]):new o(function(n,e){for(var i=[],r=0;i.push(void 0),r++,s(a.value).kc(function(t){return function(e){i[t]=e,0==--r&&n(i)}}(i.length-1),e),a=t.next(),!a.done;);})},o}),s("Promise.prototype.finally",function(e){return e||function(t){return this.then(function(e){return Promise.resolve(t()).then(function(){return e})},function(e){return Promise.resolve(t()).then(function(){throw e})})}});var h,p="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)ks=Object.setPrototypeOf;else{e:{var m={};try{m.__proto__={Oe:!0},h=m.Oe;break e}catch(e){}h=!1}ks=h?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var g=ks;function v(e,t){if(e.prototype=p(t.prototype),e.prototype.constructor=e,g)g(e,t);else for(var n in t){var i;"prototype"!=n&&(Object.defineProperties?(i=Object.getOwnPropertyDescriptor(t,n))&&Object.defineProperty(e,n,i):e[n]=t[n])}e.Dg=t.prototype}function b(){this.g=!1,this.c=null,this.s=void 0,this.j=1,this.b=this.f=0,this.i=this.a=null}function y(e){if(e.g)throw new TypeError("Generator is already running");e.g=!0}function w(e,t){e.a={Yd:t,ie:!0},e.j=e.f||e.b}function V(e,t,n){return e.j=n,{value:t}}function I(e){e.j=0}function q(e,t,n){e.f=t,null!=n&&(e.b=n)}function M(e,t){e.f=0,e.b=t||0}function G(e,t){e.j=t,e.f=0}function W(e){e.f=0;var t=e.a.Yd;return e.a=null,t}function P(e){e.i=[e.a],e.f=0,e.b=0}function C(e,t){var n=e.i.splice(0)[0];(n=e.a=e.a||n)?n.ie?e.j=e.f||e.b:null!=n.C&&e.b<n.C?(e.j=n.C,e.a=null):e.j=e.b:e.j=t}function T(e){this.a=new b,this.b=e}function S(t,e,n,i){try{var r=e.call(t.a.c,n);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return t.a.g=!1,r;var a=r.value}catch(e){return t.a.c=null,w(t.a,e),E(t)}return t.a.c=null,i.call(t.a,a),E(t)}function E(t){for(;t.a.j;)try{var e=t.b(t.a);if(e)return t.a.g=!1,{value:e.value,done:!1}}catch(e){t.a.s=void 0,w(t.a,e)}if(t.a.g=!1,t.a.a){if(e=t.a.a,t.a.a=null,e.ie)throw e.Yd;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function x(t){this.next=function(e){return y(t.a),e=t.a.c?S(t,t.a.c.next,e,t.a.h):(t.a.h(e),E(t))},this.throw=function(e){return y(t.a),e=t.a.c?S(t,t.a.c.throw,e,t.a.h):(w(t.a,e),E(t))},this.return=function(e){return function(e,t){y(e.a);var n=e.a.c;return n?S(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.a.return):(e.a.return(t),E(e))}(t,e)},l(),this[Symbol.iterator]=function(){return this}}function z(e,t){return x.prototype=e.prototype,new x(new T(t))}function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function A(e,t,n){e instanceof String&&(e=String(e));for(var i=e.length,r=0;r<i;r++){var a=e[r];if(t.call(n,a,r,e))return{fe:r,Je:a}}return{fe:-1,Je:void 0}}function R(e,t,n){if(null==e)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return e+""}b.prototype.h=function(e){this.s=e},b.prototype.return=function(e){this.a={return:e},this.j=this.b},b.prototype.C=function(e){this.j=e},s("WeakMap",function(i){function e(e){if(this.a=(a+=Math.random()+1).toString(),e){c(),l(),e=F(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}function n(e){k(e,r)||o(e,r,{value:{}})}function t(e){var t=Object[e];t&&(Object[e]=function(e){return n(e),t(e)})}if(function(){if(i&&Object.seal)try{var e=Object.seal({}),t=Object.seal({}),n=new i([[e,2],[t,3]]);return 2!=n.get(e)||3!=n.get(t)?void 0:(n.delete(e),n.set(t,4),!n.has(e)&&4==n.get(t))}catch(e){return}}())return i;var r="$jscomp_hidden_"+Math.random();t("freeze"),t("preventExtensions"),t("seal");var a=0;return e.prototype.set=function(e,t){if(n(e),!k(e,r))throw Error("WeakMap key fail: "+e);return e[r][this.a]=t,this},e.prototype.get=function(e){return k(e,r)?e[r][this.a]:void 0},e.prototype.has=function(e){return k(e,r)&&k(e[r],this.a)},e.prototype.delete=function(e){return!(!k(e,r)||!k(e[r],this.a))&&delete e[r][this.a]},e}),s("Map",function(i){function n(){var e={};return e.Ja=e.next=e.head=e}function e(e,t){var n=e.a;return a(function(){if(n){for(;n.head!=e.a;)n=n.Ja;if(n.next!=n.head)return n=n.next,{done:!1,value:t(n)};n=null}return{done:!0,value:void 0}})}function r(e,t){var n=t&&typeof t;"object"==n||"function"==n?o.has(t)?n=o.get(t):(n=""+ ++s,o.set(t,n)):n="p_"+t;var i=e.b[n];if(i&&k(e.b,n))for(var r=0;r<i.length;r++){var a=i[r];if(t!=t&&a.key!=a.key||t===a.key)return{id:n,list:i,index:r,ba:a}}return{id:n,list:i,index:-1,ba:void 0}}function t(e){if(this.b={},this.a=n(),this.size=0,e){e=F(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}if(function(){if(i&&"function"==typeof i&&i.prototype.entries&&"function"==typeof Object.seal)try{var e=Object.seal({x:4}),t=new i(F([[e,"s"]]));if("s"!=t.get(e)||1!=t.size||t.get({x:4})||t.set({x:4},"t")!=t||2!=t.size)return;var n=t.entries(),t=n.next();return t.done||t.value[0]!=e||"s"!=t.value[1]?void 0:!((t=n.next()).done||4!=t.value[0].x||"t"!=t.value[1]||!n.next().done)}catch(e){return}}())return i;c(),l();var o=new WeakMap;t.prototype.set=function(e,t){var n=r(this,e);return n.list||(n.list=this.b[n.id]=[]),n.ba?n.ba.value=t:(n.ba={next:this.a,Ja:this.a.Ja,head:this.a,key:e,value:t},n.list.push(n.ba),this.a.Ja.next=n.ba,this.a.Ja=n.ba,this.size++),this},t.prototype.delete=function(e){return!(!(e=r(this,e)).ba||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.b[e.id],e.ba.Ja.next=e.ba.next,e.ba.next.Ja=e.ba.Ja,e.ba.head=null,this.size--,!0)},t.prototype.clear=function(){this.b={},this.a=this.a.Ja=n(),this.size=0},t.prototype.has=function(e){return!!r(this,e).ba},t.prototype.get=function(e){return(e=r(this,e).ba)&&e.value},t.prototype.entries=function(){return e(this,function(e){return[e.key,e.value]})},t.prototype.keys=function(){return e(this,function(e){return e.key})},t.prototype.values=function(){return e(this,function(e){return e.value})},t.prototype.forEach=function(e,t){for(var n,i=this.entries();!(n=i.next()).done;)n=n.value,e.call(t,n[1],n[0],this)},t.prototype[Symbol.iterator]=t.prototype.entries;var s=0;return t}),s("Set",function(i){function e(e){if(this.a=new Map,e){e=F(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.a.size}return function(){if(i&&"function"==typeof i&&i.prototype.entries&&"function"==typeof Object.seal)try{var e=Object.seal({x:4}),t=new i(F([e]));if(!t.has(e)||1!=t.size||t.add(e)!=t||1!=t.size||t.add({x:4})!=t||2!=t.size)return;var n=t.entries(),t=n.next();return t.done||t.value[0]!=e||t.value[1]!=e?void 0:!(t=n.next()).done&&t.value[0]!=e&&4==t.value[0].x&&t.value[1]==t.value[0]&&n.next().done}catch(e){return}}()?i:(c(),l(),e.prototype.add=function(e){return this.a.set(e,e),this.size=this.a.size,this},e.prototype.delete=function(e){return e=this.a.delete(e),this.size=this.a.size,e},e.prototype.clear=function(){this.a.clear(),this.size=0},e.prototype.has=function(e){return this.a.has(e)},e.prototype.entries=function(){return this.a.entries()},e.prototype.keys=e.prototype.values=function(){return this.a.values()},e.prototype[Symbol.iterator]=e.prototype.values,e.prototype.forEach=function(t,n){var i=this;this.a.forEach(function(e){return t.call(n,e,e,i)})},e)}),s("Array.prototype.findIndex",function(e){return e||function(e,t){return A(this,e,t).fe}}),s("Array.prototype.keys",function(e){return e||function(){return function(t,n){l(),t instanceof String&&(t+="");var i=0,r={next:function(){if(i<t.length){var e=i++;return{value:n(e,t[e]),done:!1}}return r.next=function(){return{done:!0,value:void 0}},r.next()}};return r[Symbol.iterator]=function(){return r},r}(this,function(e){return e})}}),s("Object.is",function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}}),s("Array.prototype.includes",function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var i=n.length,r=t||0;for(r<0&&(r=Math.max(r+i,0));r<i;r++){var a=n[r];if(a===e||Object.is(a,e))return!0}return!1}}),s("String.prototype.includes",function(e){return e||function(e,t){return-1!==R(this,e,"includes").indexOf(e,t||0)}}),s("Array.from",function(e){return e||function(e,t,n){l(),t=null!=t?t:function(e){return e};var i=[],r=e[Symbol.iterator];if("function"==typeof r)for(e=r.call(e);!(r=e.next()).done;)i.push(t.call(n,r.value));else{r=e.length;for(var a=0;a<r;a++)i.push(t.call(n,e[a]))}return i}}),s("String.prototype.startsWith",function(e){return e||function(e,t){for(var n=R(this,e,"startsWith"),i=n.length,r=e.length,a=Math.max(0,Math.min(0|t,n.length)),o=0;o<r&&a<i;)if(n[a++]!=e[o++])return!1;return r<=o}}),s("Array.prototype.find",function(e){return e||function(e,t){return A(this,e,t).Je}});var N="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)k(i,r)&&(e[r]=i[r])}return e};s("Object.assign",function(e){return e||N});var D=this;function L(e,t){var n,i=e.split("."),r=D;i[0]in r||!r.execScript||r.execScript("var "+i[0]);for(;i.length&&(n=i.shift());)i.length||void 0===t?r=r[n]||(r[n]={}):r[n]=t}function U(e,i){function t(){}t.prototype=i.prototype,e.Dg=i.prototype,e.prototype=new t,(e.prototype.constructor=e).Og=function(e,t,n){return i.prototype[t].apply(e,Array.prototype.slice.call(arguments,2))}}function _(e){this.c=Math.exp(Math.log(.5)/e),this.b=this.a=0}function O(e,t,n){var i=Math.pow(e.c,t);n=n*(1-i)+i*e.a,isNaN(n)||(e.a=n,e.b+=t)}function j(e){return e.a/(1-Math.pow(e.c,e.b))}function K(){this.b=new _(2),this.c=new _(5),this.a=0}D.a=!0,K.prototype.getBandwidthEstimate=function(e){return this.a<128e3?e:Math.min(j(this.b),j(this.c))};var X={mb:0,jc:function(){},Z:function(){},error:function(){},m:function(){},info:function(){},debug:function(){},F:function(){},J:function(){}};function Y(e,t,n,i){for(var r=[],a=3;a<arguments.length;++a)r[a-3]=arguments[a];this.severity=e,this.category=t,this.code=n,this.data=r,this.handled=!1}d.console&&d.console.log.bind&&(X.Z=console.warn.bind(console),X.jc=console.error.bind(console),1<=X.mb&&(X.error=console.error.bind(console)),2<=X.mb&&(X.m=console.warn.bind(console)),3<=X.mb&&(X.info=console.info.bind(console)),4<=X.mb&&(X.debug=console.log.bind(console)),5<=X.mb&&(X.F=console.debug.bind(console)),6<=X.mb&&(X.J=console.debug.bind(console))),L("shaka.util.Error",Y),Y.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},Y.Severity={RECOVERABLE:1,CRITICAL:2},Y.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},Y.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,HLS_INTERNAL_SKIP_STREAM:4035,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013};var B=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function $(e){var t;e instanceof $?(J(this,e.xa),this.jb=e.jb,this.wa=e.wa,Q(this,e.Jb),this.la=e.la,Z(this,e.a.clone()),this.Xa=e.Xa):e&&(t=String(e).match(B))?(J(this,t[1]||"",!0),this.jb=ee(t[2]||""),this.wa=ee(t[3]||"",!0),Q(this,t[4]),this.la=ee(t[5]||"",!0),Z(this,t[6]||"",!0),this.Xa=ee(t[7]||"")):this.a=new ue(null)}function J(e,t,n){e.xa=n?ee(t,!0):t,e.xa&&(e.xa=e.xa.replace(/:$/,""))}function Q(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.Jb=t}else e.Jb=null}function Z(e,t,n){t instanceof ue?e.a=t:(n||(t=te(t,oe)),e.a=new ue(t))}function ee(e,t){return e?(t?decodeURI:decodeURIComponent)(e):""}function te(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ne),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ne(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}(e=$.prototype).xa="",e.jb="",e.wa="",e.Jb=null,e.la="",e.Xa="",e.toString=function(){var e,t=[],n=this.xa;return n&&t.push(te(n,ie,!0),":"),(n=this.wa)&&(t.push("//"),(e=this.jb)&&t.push(te(e,ie,!0),"@"),t.push(encodeURIComponent(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.Jb)&&t.push(":",String(n))),(n=this.la)&&(this.wa&&"/"!=n.charAt(0)&&t.push("/"),t.push(te(n,"/"==n.charAt(0)?ae:re,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.Xa)&&t.push("#",te(n,se)),t.join("")},e.resolve=function(e){var t=this.clone();"data"===t.xa&&(t=new $);var n=!!e.xa;n?J(t,e.xa):n=!!e.jb,n?t.jb=e.jb:n=!!e.wa,n?t.wa=e.wa:n=null!=e.Jb;var i,r=e.la;if(n)Q(t,e.Jb);else if(n=!!e.la)if("/"!=r.charAt(0)&&(this.wa&&!this.la?r="/"+r:-1!=(i=t.la.lastIndexOf("/"))&&(r=t.la.substr(0,i+1)+r)),".."==r||"."==r)r="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");for(var a=[],o=0;o<r.length;){var s=r[o++];"."==s?i&&o==r.length&&a.push(""):".."==s?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),i&&o==r.length&&a.push("")):(a.push(s),i=!0)}r=a.join("/")}return n?t.la=r:n=""!==e.a.toString(),n?Z(t,e.a.clone()):n=!!e.Xa,n&&(t.Xa=e.Xa),t},e.clone=function(){return new $(this)};var ie=/[#\/\?@]/g,re=/[#\?:]/g,ae=/[#\?]/g,oe=/[#\?@]/g,se=/#/g;function ue(e){this.a=e||null}(e=ue.prototype).ja=null,e.nc=null,e.add=function(e,t){if(!this.ja&&(this.ja={},this.nc=0,this.a))for(var n=this.a.split("&"),i=0;i<n.length;i++){var r,a=n[i].indexOf("="),o=null;0<=a?(r=n[i].substring(0,a),o=n[i].substring(a+1)):r=n[i],r=decodeURIComponent(r.replace(/\+/g," ")),o=o||"",this.add(r,decodeURIComponent(o.replace(/\+/g," ")))}return this.a=null,(n=this.ja.hasOwnProperty(e)&&this.ja[e])||(this.ja[e]=n=[]),n.push(t),this.nc++,this},e.toString=function(){if(this.a)return this.a;if(!this.ja)return"";var e,t=[];for(e in this.ja)for(var n=encodeURIComponent(e),i=this.ja[e],r=0;r<i.length;r++){var a=n;""!==i[r]&&(a+="="+encodeURIComponent(i[r])),t.push(a)}return this.a=t.join("&")},e.clone=function(){var e=new ue;if(e.a=this.a,this.ja){var t,n={};for(t in this.ja)n[t]=this.ja[t].concat();e.ja=n,e.nc=this.nc}return e};var ce={Ye:function(e,t){return e.reduce(function(e,t,n){return t.catch(e.bind(null,n))}.bind(null,t),Promise.reject())},Oc:function(e,t){return e.concat(t)},wc:function(){},Na:function(e){return null!=e}};function le(e,t){if(0==t.length)return e;var n=t.map(function(e){return new $(e)});return e.map(function(e){return new $(e)}).map(function(e){return n.map(e.resolve.bind(e))}).reduce(ce.Oc,[]).map(function(e){return e.toString()})}function de(e,t){return{keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:t||[],keyIds:[]}}var fe={Ua:"video",Nb:"audio",va:"text",Mg:"image",Kg:"application"},he=1/15;function pe(){var n,i,e=new Promise(function(e,t){n=e,i=t});return e.resolve=n,e.reject=i,e}function me(e){if(!e)return"";239==(e=new Uint8Array(e))[0]&&187==e[1]&&191==e[2]&&(e=e.subarray(3)),e=we(e),e=escape(e);try{return decodeURIComponent(e)}catch(e){throw new Y(2,2,2004)}}function ge(e,t,n){if(!e)return"";if(!n&&0!=e.byteLength%2)throw X.error("Data has an incorrect length, must be even."),new Y(2,2,2004);var i=e instanceof ArrayBuffer?e:((n=new Uint8Array(e.byteLength)).set(new Uint8Array(e)),n.buffer);e=Math.floor(e.byteLength/2),n=new Uint16Array(e),i=new DataView(i);for(var r=0;r<e;r++)n[r]=i.getUint16(2*r,t);return we(n)}function ve(e){var t=new Uint8Array(e);if(239==t[0]&&187==t[1]&&191==t[2])return me(t);if(254==t[0]&&255==t[1])return ge(t.subarray(2),!1);if(255==t[0]&&254==t[1])return ge(t.subarray(2),!0);var n=function(e,t){return e.byteLength<=t||32<=e[t]&&e[t]<=126}.bind(null,t);if(X.debug("Unable to find byte-order-mark, making an educated guess."),0==t[0]&&0==t[2])return ge(e,!1);if(0==t[1]&&0==t[3])return ge(e,!0);if(n(0)&&n(1)&&n(2)&&n(3))return me(e);throw new Y(2,2,2003)}function be(e){e=encodeURIComponent(e),e=unescape(e);for(var t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t.buffer}function ye(e,t){for(var n=new Uint8Array(2*e.length),i=new DataView(n.buffer),r=0;r<e.length;++r)i.setUint16(2*r,e.charCodeAt(r),t);return n.buffer}function we(e){if(!Te)for(var t={size:65536};0<t.size;(t={size:t.size}).size/=2)if(function(e){try{var t=new Uint8Array(e);return 0<String.fromCharCode.apply(null,t).length}catch(e){return!1}}(t.size)){Te=function(i){return function(e){for(var t="",n=0;n<e.length;n+=i.size)t+=String.fromCharCode.apply(null,e.subarray(n,n+i.size));return t}}(t);break}return Te(e)}pe.prototype.resolve=function(){},pe.prototype.reject=function(){},L("shaka.util.StringUtils.fromUTF8",me),L("shaka.util.StringUtils.fromUTF16",ge),L("shaka.util.StringUtils.fromBytesAutoDetect",ve),L("shaka.util.StringUtils.toUTF8",be),L("shaka.util.StringUtils.toUTF16",ye);var Te=null;L("shaka.util.StringUtils.resetFromCharCode",function(){Te=null});var Se={Hc:function(e,t){e=we(e);return t=null==t||t,e=d.btoa(e).replace(/\+/g,"-").replace(/\//g,"_"),t?e:e.replace(/=*$/,"")}};function Ee(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.b=null,this.g=[],this.c=[],this.f=!1,this.a.on("data",this.i.bind(this)),this.a.on("done",this.h.bind(this))}function xe(e,t){return!(!d.muxjs||"mp2t"!=e.toLowerCase().split(";")[0].split("/")[1])&&(t?MediaSource.isTypeSupported(ke(t,e)):MediaSource.isTypeSupported(ke("audio",e))||MediaSource.isTypeSupported(ke("video",e)))}function ke(e,t){var n=t.replace(/mp2t/i,"mp4");"audio"==e&&(n=n.replace("video","audio"));var i=/avc1\.(66|77|100)\.(\d+)/.exec(n);return i&&(t="avc1.",t=("66"==(e=i[1])?t+"4200":"77"==e?t+"4d00":t+"6400")+((e=Number(i[2]))>>4).toString(16),t+=(15&e).toString(16),n=n.replace(i[0],t)),n}function Ae(e){this.b=e,this.a=null}function Me(e){this.b=e,this.a=null}function Ie(e,t){var n=Ce();this.i=(null==e.maxAttempts?n:e).maxAttempts,this.f=(null==e.baseDelay?n:e).baseDelay,this.h=(null==e.fuzzFactor?n:e).fuzzFactor,this.g=(null==e.backoffFactor?n:e).backoffFactor,this.a=0,this.b=this.f,(this.c=void 0!==t&&t)&&(this.a=1)}function Pe(i){return H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:if(i.a>=i.i){if(!i.c)return e.return(Promise.reject());i.a=1,i.b=i.f}return(t=i.a,i.a++,0==t)?e.return():(n=i.b*(1+(2*Math.random()-1)*i.h),V(e,new Promise(function(e){new Me(e).R(n/1e3)}),2));case 2:i.b*=i.g,I(e)}})})}function Ce(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}}function Re(e,t){this.promise=e,this.me=t,this.a=!1}function Ne(e){return new Re(Promise.reject(e),function(){return Promise.resolve()})}function De(){var e=Promise.reject(new Y(2,7,7001));return e.catch(function(){}),new Re(e,function(){return Promise.resolve()})}function Le(e){return new Re(Promise.resolve(e),function(){return Promise.resolve()})}function Ue(e){return new Re(e,function(){return e.catch(function(){})})}function _e(e){return new Re(Promise.all(e.map(function(e){return e.promise})),function(){return Promise.all(e.map(function(e){return e.abort()}))})}function Oe(e,t){for(var n in t=void 0===t?{}:t)this[n]=t[n];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=(d.performance&&d.performance.now?d.performance:Date).now(),this.type=e,this.isTrusted=!1,this.target=this.currentTarget=null,this.a=!1}function je(){this.a={}}function Ke(){this.Sc=new je,this.gc=this}function Be(e){var a=new Set;return function e(t){switch(typeof t){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return t;default:if(!t||t.buffer&&t.buffer.constructor==ArrayBuffer)return t;if(a.has(t))return null;var n=t.constructor==Array;if(t.constructor!=Object&&!n)return null;a.add(t);var i,r=n?[]:{};for(i in t)r[i]=e(t[i]);return n&&(r.length=t.length),r}}(e)}function Fe(e,t){return!("number"!=typeof e||"number"!=typeof t||!isNaN(e)||!isNaN(t))||e===t}function He(e,t){t=e.indexOf(t);-1<t&&e.splice(t,1)}function Ve(e,t,n){if(n=n||Fe,e.length!=t.length)return!1;t=t.slice();for(var i={},r=(e=F(e)).next();!r.done;i={item:i.item},r=e.next()){if(i.item=r.value,-1==(r=t.findIndex(function(t){return function(e){return n(t.item,e)}}(i))))return!1;t[r]=t[t.length-1],t.pop()}return 0==t.length}function qe(){this.a=[]}function Ge(e,t){e.a.push(t.finally(function(){He(e.a,t)}))}function We(e){Ke.call(this),this.f=!1,this.g=new qe,this.a=new Set,this.b=new Set,this.c=e||null}L("shaka.util.Uint8ArrayUtils.toBase64",Se.Hc),Se.Fa=function(e){e=d.atob(e.replace(/-/g,"+").replace(/_/g,"/"));for(var t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t},L("shaka.util.Uint8ArrayUtils.fromBase64",Se.Fa),Se.Yc=function(e){for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=d.parseInt(e.substr(n,2),16);return t},L("shaka.util.Uint8ArrayUtils.fromHex",Se.Yc),Se.Ic=function(e){for(var t="",n=0;n<e.length;++n){var i=e[n].toString(16);1==i.length&&(i="0"+i),t+=i}return t},L("shaka.util.Uint8ArrayUtils.toHex",Se.Ic),Se.Da=function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!=t[n])return!1;return!0},L("shaka.util.Uint8ArrayUtils.equal",Se.Da),Se.concat=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];for(var i=n=0;i<t.length;++i)n+=t[i].length;n=new Uint8Array(n);for(var r=i=0;r<t.length;++r)n.set(t[r],i),i+=t[r].length;return n},L("shaka.util.Uint8ArrayUtils.concat",Se.concat),Ee.prototype.destroy=function(){return this.a.dispose(),this.a=null,Promise.resolve()},Ee.prototype.i=function(e){this.c=e.captions;var t=new Uint8Array(e.data.byteLength+e.initSegment.byteLength);t.set(e.initSegment,0),t.set(e.data,e.initSegment.byteLength),this.g.push(t)},Ee.prototype.h=function(){var e={data:Se.concat.apply(null,this.g),captions:this.c};this.b.resolve(e),this.f=!1},Ae.prototype.R=function(e){var t=this;this.stop();var n=!0,i=null;return this.a=function(){d.clearTimeout(i),n=!1},i=d.setTimeout(function(){n&&t.b()},1e3*e),this},Ae.prototype.stop=function(){this.a&&(this.a(),this.a=null)},L("shaka.util.Timer",Me),Me.prototype.tickNow=Me.prototype.Gc=function(){return this.stop(),this.b(),this},Me.prototype.tickAfter=Me.prototype.R=function(e){var t=this;return this.stop(),this.a=new Ae(function(){t.b()}).R(e),this},Me.prototype.tickEvery=Me.prototype.Ka=function(e){var t=this;return this.stop(),this.a=new Ae(function(){t.a.R(e),t.b()}).R(e),this},Me.prototype.stop=function(){this.a&&(this.a.stop(),this.a=null)},L("shaka.util.AbortableOperation",Re),Re.failed=Ne,Re.aborted=De,Re.completed=Le,Re.notAbortable=Ue,Re.prototype.abort=function(){return this.a=!0,this.me()},Re.all=_e,Re.prototype.finally=function(e){return this.promise.then(function(){return e(!0)},function(){return e(!1)}),this},Re.prototype.chain=Re.prototype.Y=function(i,r){function e(n){return function(e){var t;o.a&&n?s.reject(u):(t=n?i:r)?a=function(e,t,n){try{var i=e(t);return i&&i.promise&&i.abort?(n.resolve(i.promise),function(){return i.abort()}):(n.resolve(i),function(){return Promise.resolve(i).then(function(){},function(){})})}catch(e){return n.reject(e),function(){return Promise.resolve()}}}(t,e,s):(n?s.resolve:s.reject)(e)}}function a(){return s.reject(u),o.abort()}var o=this,s=new pe,u=new Y(2,7,7001);return this.promise.then(e(!0),e(!1)),new Re(s,function(){return a()})},L("shaka.util.FakeEvent",Oe),Oe.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},Oe.prototype.stopImmediatePropagation=function(){this.a=!0},Oe.prototype.stopPropagation=function(){},(e=je.prototype).push=function(e,t){this.a.hasOwnProperty(e)?this.a[e].push(t):this.a[e]=[t]},e.get=function(e){return(e=this.a[e])?e.slice():null},e.getAll=function(){var e,t=[];for(e in this.a)t.push.apply(t,this.a[e]);return t},e.remove=function(e,t){var n=this.a[e];if(n)for(var i=0;i<n.length;++i)n[i]==t&&(n.splice(i,1),--i)},e.forEach=function(e){for(var t in this.a)e(t,this.a[t])},Ke.prototype.addEventListener=function(e,t){this.Sc.push(e,t)},Ke.prototype.removeEventListener=function(e,t){this.Sc.remove(e,t)},Ke.prototype.dispatchEvent=function(e){for(var t=this.Sc.get(e.type)||[],n=0;n<t.length;++n){e.target=this.gc,e.currentTarget=this.gc;var i=t[n];try{i.handleEvent?i.handleEvent(e):i.call(this,e)}catch(e){X.error("Uncaught exception in event handler",e,e?e.message:null,e?e.stack:null)}if(e.a)break}return e.defaultPrevented},qe.prototype.destroy=function(){var t=[];return this.a.forEach(function(e){e.promise.catch(function(){}),t.push(e.abort())}),this.a=[],Promise.all(t)},U(We,Ke),L("shaka.net.NetworkingEngine",We),We.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4},We.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3};var ze={};function Xe(e,t,n){n=n||3;var i=ze[e];(!i||n>=i.priority)&&(ze[e]={priority:n,dg:t})}function Ye(e,t){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null}}function $e(){this.a=0}function Je(e,t,n){Re.call(this,e,t),this.b=n}function Qe(){}function Ze(){this.a=new je}function et(e,t,n,i){this.target=e,this.type=t,this.listener=n,this.a=function(e,t){if(null==t)return!1;if("boolean"==typeof t)return t;var n=new Set(["passive","capture"]);return Object.keys(t).filter(function(e){return!n.has(e)}),function(e){var t=tt;if(null==t){t=!1;try{var n={},i={get:function(){return!(t=!0)}};Object.defineProperty(n,"passive",i),Object.defineProperty(n,"capture",i),i=function(){},e.addEventListener("test",i,n),e.removeEventListener("test",i,n)}catch(e){t=!1}tt=t}return t||!1}(e)?t:t.capture||!1}(e,i),this.target.addEventListener(t,n,this.a)}We.registerScheme=Xe,We.unregisterScheme=function(e){delete ze[e]},We.prototype.registerRequestFilter=We.prototype.fg=function(e){this.a.add(e)},We.prototype.unregisterRequestFilter=We.prototype.Fg=function(e){this.a.delete(e)},We.prototype.clearAllRequestFilters=We.prototype.We=function(){this.a.clear()},We.prototype.registerResponseFilter=We.prototype.gg=function(e){this.b.add(e)},We.prototype.unregisterResponseFilter=We.prototype.Gg=function(e){this.b.delete(e)},We.prototype.clearAllResponseFilters=We.prototype.Xe=function(){this.b.clear()},We.defaultRetryParameters=Ce,We.makeRequest=Ye,We.prototype.destroy=function(){return this.f=!0,this.a.clear(),this.b.clear(),this.g.destroy()},We.prototype.request=function(i,e){var r=this,t=new $e;if(this.f){var n=Promise.reject(new Y(2,7,7001));return n.catch(function(){}),new Je(n,function(){return Promise.resolve()},t)}e.method=e.method||"GET",e.headers=e.headers||{},e.retryParameters=e.retryParameters?Be(e.retryParameters):Ce(),e.uris=Be(e.uris);var a=(n=function(e,t,n){for(var i=Le(void 0),r={},a=(e=F(e.a)).next();!a.done;r={Ad:r.Ad},a=e.next())r.Ad=a.value,i=i.Y(function(e){return function(){return e.Ad(t,n)}}(r));return i.Y(void 0,function(e){if(e&&7001==e.code)throw e;throw new Y(2,1,1006,e)})}(this,i,e)).Y(function(){return function t(i,r,n,a,o,s,u){var e=new $(n.uris[o]),c=e.xa,l=!1;c||(c=location.protocol,c=c.slice(0,-1),J(e,c),n.uris[o]=e.toString());c=c.toLowerCase();var d=(c=ze[c])?c.dg:null;if(!d)return Ne(new Y(2,1,1e3,e));var f;return Ue(Pe(a)).Y(function(){return i.f?De():(f=Date.now(),d(n.uris[o],n,r,function(e,t,n){i.c&&1==r&&(i.c(e,t),l=!0,u.a=n)}))}).Y(function(e){return null==e.timeMs&&(e.timeMs=Date.now()-f),{response:e,Ef:l}},function(e){if(e&&7001==e.code)throw e;if(i.f)return De();if(e&&1==e.severity)return i.dispatchEvent(new Oe("retry",{error:e instanceof Y?e:null})),o=(o+1)%n.uris.length,t(i,r,n,a,o,e,u);throw e||s})}(r,i,e,new Ie(e.retryParameters,!1),0,null,t)}),o=a.Y(function(e){return function(e,t,n){for(var i=Le(void 0),r=(e=F(e.b)).next();!r.done;r=e.next())i=i.Y(r.value.bind(null,t,n.response));return i.Y(function(){return n},function(e){if(e&&7001==e.code)throw e;var t=2;throw e instanceof Y&&(t=e.severity),new Y(t,1,1007,e)})}(r,i,e)}),s=Date.now(),u=0;n.promise.then(function(){u=Date.now()-s},function(){});var c=0;return a.promise.then(function(){c=Date.now()},function(){}),n=new Je((n=o.Y(function(e){var t=Date.now()-c,n=e.response;return n.timeMs+=u,n.timeMs+=t,e.Ef||!r.c||n.fromCache||1!=i||r.c(n.timeMs,n.data.byteLength),n},function(e){throw e&&(e.severity=2),e})).promise,n.me,t),Ge(this.g,n),n},We.NumBytesRemainingClass=$e,v(Je,Re),(We.PendingRequest=Je).all=_e,Je.notAbortable=Ue,Je.completed=Le,Je.aborted=De,Je.failed=Ne,L("shaka.util.IReleasable",Qe),Qe.prototype.release=function(){},L("shaka.util.EventManager",Ze),Ze.prototype.release=function(){this.hb(),this.a=null},Ze.prototype.listen=Ze.prototype.B=function(e,t,n,i){this.a&&(e=new et(e,t,n,i),this.a.push(t,e))},Ze.prototype.listenOnce=Ze.prototype.ua=function(n,i,r,e){var a=this;this.B(n,i,function e(t){a.pa(n,i,e),r(t)},e)},Ze.prototype.unlisten=Ze.prototype.pa=function(e,t,n){if(this.a)for(var i=this.a.get(t)||[],r=(i=F(i)).next();!r.done;r=i.next())(r=r.value).target!=e||n!=r.listener&&n||(r.pa(),this.a.remove(t,r))},Ze.prototype.removeAll=Ze.prototype.hb=function(){if(this.a){for(var e=this.a.getAll(),t=(e=F(e)).next();!t.done;t=e.next())t.value.pa();this.a.a={}}},et.prototype.unlisten=et.prototype.pa=function(){this.target.removeEventListener(this.type,this.listener,this.a),this.listener=this.target=null,this.a=!1};var tt=void 0;function nt(e){return new $(e=ve(e)).wa}function it(e,t,n){function i(e){new DataView(r.buffer).setUint32(a,e.byteLength,!0),a+=4,r.set(e,a),a+=e.byteLength}if(!n||!n.byteLength)throw new Y(2,6,6015);t="string"==typeof t?new Uint8Array(ye(t,!0)):new Uint8Array(t),e=ye(e=ve(e),!0);var r=new Uint8Array(12+e.byteLength+t.byteLength+n.byteLength),a=0;return i(new Uint8Array(e)),i(t),i(new Uint8Array(n)),r}function rt(e,t){for(var n=[],i=F(e),r=i.next();!r.done;r=i.next())n.push(t(r.value));return n}function at(e,t){for(var n=F(e),i=n.next();!i.done;i=n.next())if(!t(i.value))return!1;return!0}function ot(t){var n=new Map;return Object.keys(t).forEach(function(e){n.set(e,t[e])}),n}function st(e){var n={};return e.forEach(function(e,t){n[t]=e}),n}function ut(e,t){return t&&(e+='; codecs="'+t+'"'),e}function ct(e){var t=(e=e.split("."))[0];return e.pop(),[t,e.join(".")]}L("shaka.util.FairPlayUtils.defaultGetContentId",nt),L("shaka.util.FairPlayUtils.initDataTransform",it);var lt=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels");function dt(){return!(!d.MediaSource||!MediaSource.isTypeSupported)}function ft(e){return""!=vt().canPlayType(e)}function ht(){return gt("Tizen")}function pt(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!ht()}function mt(){if(!pt())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return(e=e||navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null}function gt(e){return(navigator.userAgent||"").includes(e)}function vt(){return yt||(bt=bt||new Me(function(){yt=null}),(yt=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0])||(yt=document.createElement("video")),bt.R(1),yt)}var bt=null,yt=null;function wt(t,e){var i=this;e=void 0===e?1:e,this.D=t,this.u=new Set,this.h=this.l=null,this.V=!1,this.K=0,this.a=null,this.i=new Ze,this.b=new Map,this.v=[],this.o=new pe,this.f=null,this.g=function(e){i.o.reject(e),t.onError(e)},this.sa=new Map,this.$=new Map,this.T=new Me(function(){return t=(e=i).sa,(n=e.$).clear(),t.forEach(function(e,t){return n.set(t,e)}),(t=Array.from(n.values())).length&&t.every(function(e){return"expired"==e})&&e.g(new Y(2,6,6014)),void e.D.yc(st(n));var e,t,n}),this.c=!1,this.qa=new pe,this.G=!1,this.H=[],this.ra=!1,this.ea=new Me(function(){var r;(r=i).b.forEach(function(e,t){var n=e.rd,i=t.expiration;isNaN(i)&&(i=1/0),i!=n&&(r.D.onExpirationUpdated(t.sessionId,i),e.rd=i)})}).Ka(e),this.o.catch(function(){})}function Tt(e,t,n){return e.v=n,e.G=0<n.length,St(e,t)}function St(e,t){var n=function(e){if(0==(e=ot(e.f.clearKeys)).size)return null;var n=[],i=[];e.forEach(function(e,t){t=Se.Yc(t),e=Se.Yc(e),t={kty:"oct",kid:Se.Hc(t,!1),k:Se.Hc(e,!1)};n.push(t),i.push(t.kid)}),e=JSON.stringify({keys:n});var t=JSON.stringify({kids:i});return t=[{initData:new Uint8Array(be(t)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+d.btoa(e),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:t,keyIds:[]}}(e);if(n)for(var i=F(t),r=i.next();!r.done;r=i.next())r.value.drmInfos=[n];for((n=t.some(function(e){return 0<e.drmInfos.length}))||function(e,t){var n=[];t.forEach(function(e,t){n.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})});for(var i=F(e),r=i.next();!r.done;r=i.next())r.value.drmInfos=n}(t,r=ot(e.f.servers)),r=(i=F(t)).next();!r.done;r=i.next())for(var a=(r=F(r.value.drmInfos)).next();!a.done;a=r.next())Kt(a.value,ot(e.f.servers),ot(e.f.advanced||{}));return(r=function(e,t){for(var n=new Set,i=F(t),r=i.next();!r.done;r=i.next()){var a=F(r.value.drmInfos);for(r=a.next();!r.done;r=a.next())n.add(r.value)}for(i=F(n),r=i.next();!r.done;r=i.next())Kt(r.value,ot(e.f.servers),ot(e.f.advanced||{}));a=e.G?"required":"optional";var o=e.G?["persistent-license"]:["temporary"];for(i=new Map,n=F(n),r=n.next();!r.done;r=n.next())r=r.value,i.set(r.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:a,sessionTypes:o,label:r.keySystem,drmInfos:[]});for(n=F(t),r=n.next();!r.done;r=n.next()){r=r.value,a=r.audio,o=r.video;var s=a?Pt(a):"",u=o?Pt(o):"",c=F(r.drmInfos);for(r=c.next();!r.done;r=c.next()){r=r.value;var l=i.get(r.keySystem);l.drmInfos.push(r),r.distinctiveIdentifierRequired&&(l.distinctiveIdentifier="required"),r.persistentStateRequired&&(l.persistentState="required"),a&&(l.audioCapabilities.push({robustness:r.audioRobustness||"",contentType:s}),"ac-3"==a.codecs.toLowerCase()&&ht()&&l.audioCapabilities.push({robustness:r.audioRobustness||"",contentType:ut(a.mimeType,"ec-3")})),o&&l.videoCapabilities.push({robustness:r.videoRobustness||"",contentType:u})}}return i}(e,t)).size?(r=Ct(e,r),n?r:r.catch(function(){})):(e.V=!0,Promise.resolve())}function Et(n){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:if(n.l&&n.a&&n.a.serverCertificate&&n.a.serverCertificate.length)return q(e,3),V(e,n.l.setServerCertificate(n.a.serverCertificate),5);e.C(0);break;case 5:e.s||X.m("Server certificates are not supported by the key system.  The server certificate has been ignored."),G(e,0);break;case 3:return t=W(e),e.return(Promise.reject(new Y(2,6,6004,t.message)))}})})}function xt(t){var e=t.a?t.a.initData:[];return e.forEach(function(e){return kt(t,e.initDataType,e.initData)}),t.v.forEach(function(e){return Rt(t,e)}),e.length||t.v.length||t.o.resolve(),t.o}function kt(e,t,n){for(var i=e.b.values(),r=(i=F(i)).next();!r.done;r=i.next())if(Se.Da(n,r.value.initData)&&!gt("Tizen 2"))return void X.debug("Ignoring duplicate init data.");!function(n,t,e){try{var i;i=n.G?(X.F("Creating new persistent session"),n.l.createSession("persistent-license")):(X.F("Creating new temporary session"),n.l.createSession())}catch(e){return n.g(new Y(2,6,6005,e.message))}n.i.B(i,"message",n.se.bind(n)),n.i.B(i,"keystatuseschange",n.qe.bind(n)),n.b.set(i,{initData:e,loaded:!1,rd:1/0,Ca:null});try{e=n.f.initDataTransform(e,n.a)}catch(e){return(t=e)instanceof Y||(t=new Y(2,6,6016,e)),n.g(t)}i.generateRequest(t,e).catch(function(e){var t;n.c||(n.b.delete(i),e.errorCode&&e.errorCode.systemCode&&((t=e.errorCode.systemCode)<0&&(t+=Math.pow(2,32)),t="0x"+t.toString(16)),n.g(new Y(2,6,6006,e.message,e,t)))})}(e,t,n)}function At(e){return e?e.keySystem:""}function Mt(e,t){if(navigator.userAgent.match(/Edge\//))return 1;if(t=t.toLowerCase(),ht()&&t.includes('codecs="ac-3"')){var n=t.replace("ac-3","ec-3");return e.u.has(t)||e.u.has(n)}return e.u.has(t)}function It(e){return e=rt(e=e.b.keys(),function(e){return e.sessionId}),Array.from(e)}function Pt(e){var t=ut(e.mimeType,e.codecs);return xe(t)?ke(e.type,t):t}function Ct(e,f){if(1==f.size&&f.has(""))return Promise.reject(new Y(2,6,6e3));for(var t=F(f.values()),n=t.next();!n.done;n=t.next())0==(n=n.value).audioCapabilities.length&&delete n.audioCapabilities,0==n.videoCapabilities.length&&delete n.videoCapabilities;var r=t=new pe;return[!0,!1].forEach(function(n){var i=this;f.forEach(function(e,t){e.drmInfos.some(function(e){return!!e.licenseServerUri})==n&&(r=r.catch(function(){if(!this.c)return navigator.requestMediaKeySystemAccess(t,[e])}.bind(i)))})}.bind(e)),r=(r=r.catch(function(){return Promise.reject(new Y(2,6,6001))})).then(function(e){if(this.c)return Promise.reject();this.u.clear();for(var t=(i=e.getConfiguration()).videoCapabilities||[],n=F(i.audioCapabilities||[]),i=n.next();!i.done;i=n.next())this.u.add(i.value.contentType.toLowerCase());for(i=(t=F(t)).next();!i.done;i=t.next())this.u.add(i.value.contentType.toLowerCase());t=e.keySystem,i=f.get(e.keySystem),n=[];var r,a,o,s,u,c=[],l=[],d=[];return r=i.drmInfos,a=n,o=c,s=l,u=d,r.forEach(function(t){if(a.includes(t.licenseServerUri)||a.push(t.licenseServerUri),t.serverCertificate&&(o.some(function(e){return Se.Da(e,t.serverCertificate)})||o.push(t.serverCertificate)),t.initData&&t.initData.forEach(function(t){s.some(function(e){return!(!e.keyId||e.keyId!=t.keyId)||e.initDataType==t.initDataType&&Se.Da(e.initData,t.initData)})||s.push(t)}),t.keyIds)for(var e=0;e<t.keyIds.length;++e)u.includes(t.keyIds[e])||u.push(t.keyIds[e])}),1<c.length&&X.m("Multiple unique server certificates found! Only the first will be used."),1<n.length&&X.m("Multiple unique license server URIs found! Only the first will be used."),this.a={keySystem:t,licenseServerUri:n[0],distinctiveIdentifierRequired:"required"==i.distinctiveIdentifier,persistentStateRequired:"required"==i.persistentState,audioRobustness:(i.audioCapabilities?i.audioCapabilities[0].robustness:"")||"",videoRobustness:(i.videoCapabilities?i.videoCapabilities[0].robustness:"")||"",serverCertificate:c[0],initData:l,keyIds:d},this.a.licenseServerUri?e.createMediaKeys():Promise.reject(new Y(2,6,6012,this.a.keySystem))}.bind(e)).then(function(e){if(this.c)return Promise.reject();X.info("Created MediaKeys object for key system",this.a.keySystem),this.l=e,this.V=!0}.bind(e)).catch(function(e){if(!this.c)return this.a=null,this.u.clear(),e instanceof Y?Promise.reject(e):Promise.reject(new Y(2,6,6002,e.message))}.bind(e)),t.reject(),r}function Rt(t,n){try{X.F("Attempting to load an offline session",n);var i=t.l.createSession("persistent-license")}catch(e){var r=new Y(2,6,6005,e.message);return t.g(r),Promise.reject(r)}t.i.B(i,"message",t.se.bind(t)),t.i.B(i,"keystatuseschange",t.qe.bind(t));var a={initData:null,loaded:!1,rd:1/0,Ca:null};return t.b.set(i,a),i.load(n).then(function(e){return this.c?Promise.reject():(X.J("Loaded offline session",n,e),e?(a.loaded=!0,jt(this)&&this.o.resolve(),i):(this.b.delete(i),void this.g(new Y(2,6,6013))))}.bind(t),function(e){this.c||(this.b.delete(i),this.g(new Y(2,6,6005,e.message)))}.bind(t))}function Nt(e,t){return At(t).startsWith("com.apple.fps")&&(t=t.serverCertificate,e=it(e,nt(e),t)),e}function Dt(e,t){var n=t.target;X.F("Sending license request for session",n.sessionId,"of type",t.messageType);var i=e.b.get(n),r=e.a.licenseServerUri,a=e.f.advanced[e.a.keySystem];"individualization-request"==t.messageType&&a&&a.individualizationServer&&(r=a.individualizationServer),(r=Ye([r],e.f.retryParameters)).body=t.message,r.method="POST",r.licenseRequestType=t.messageType,r.sessionId=n.sessionId,"com.microsoft.playready"!=e.a.keySystem&&"com.chromecast.playready"!=e.a.keySystem||function(e){var t=ge(e.body,!0,!0);if(t.includes("PlayReadyKeyMessage")){X.debug("Unwrapping PlayReady request.");for(var n=(t=(new DOMParser).parseFromString(t,"application/xml")).getElementsByTagName("HttpHeader"),i=0;i<n.length;++i)e.headers[n[i].getElementsByTagName("name")[0].textContent]=n[i].getElementsByTagName("value")[0].textContent;e.body=Se.Fa(t.getElementsByTagName("Challenge")[0].textContent).buffer}else X.debug("PlayReady request is already unwrapped."),e.headers["Content-Type"]="text/xml; charset=utf-8"}(r),e.a.keySystem.startsWith("com.apple.fps")&&e.f.fairPlayTransform&&(a=r,t=new Uint8Array(a.body),t="spc="+Se.Hc(t),a.headers["Content-Type"]="application/x-www-form-urlencoded",a.body=be(t));var o=Date.now();e.D.Db.request(2,r).promise.then(function(e){return this.c?Promise.reject():(this.a.keySystem.startsWith("com.apple.fps")&&this.f.fairPlayTransform&&function(e){try{var t=me(e.data)}catch(e){return}"<ckc>"===(t=t.trim()).substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6));try{t=JSON.parse(t).ckc}catch(e){}e.data=Se.Fa(t).buffer}(e),this.K+=(Date.now()-o)/1e3,X.F("Updating session",n.sessionId),n.update(e.data).then(function(){var e=this;this.D.onEvent(new Oe("drmsessionupdate")),i&&(i.Ca&&i.Ca.resolve(),new Me(function(){i.loaded=!0,jt(e)&&e.o.resolve()}).R(Ft))}.bind(this)))}.bind(e),function(e){this.c||(e=new Y(2,6,6007,e),this.g(e),i&&i.Ca&&i.Ca.reject(e))}.bind(e)).catch(function(e){this.c||(e=new Y(2,6,6008,e.message),this.g(e),i&&i.Ca&&i.Ca.reject(e))}.bind(e))}function Lt(){var r=[{videoCapabilities:e=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:e}],a=new Map,e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map(function(e){return i=e,H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return q(e,2),V(e,navigator.requestMediaKeySystemAccess(i,r),4);case 4:return t=e.s,n=!!(n=t.getConfiguration().sessionTypes)&&n.includes("persistent-license"),gt("Tizen 3")&&(n=!1),a.set(i,{persistentState:n}),V(e,t.createMediaKeys(),5);case 5:G(e,0);break;case 2:W(e),a.set(i,null),I(e)}})});var i});return Promise.all(e).then(function(){return st(a)})}function Ut(e,t){var n=t.audio,i=t.video;if(n&&n.encrypted&&!Mt(e,n=Pt(n))||i&&i.encrypted&&!Mt(e,i=Pt(i)))return!1;var r=At(e.a);return 0==t.drmInfos.length||t.drmInfos.some(function(e){return e.keySystem==r})}function _t(e,t){if(!e.length)return t;if(!t.length)return e;for(var n=[],i=0;i<e.length;i++)for(var r=0;r<t.length;r++)if(e[i].keySystem==t[r].keySystem){var a=e[i],r=t[r],o=[];o=(o=o.concat(a.initData||[])).concat(r.initData||[]);var s=[];s=(s=s.concat(a.keyIds)).concat(r.keyIds),n.push({keySystem:a.keySystem,licenseServerUri:a.licenseServerUri||r.licenseServerUri,distinctiveIdentifierRequired:a.distinctiveIdentifierRequired||r.distinctiveIdentifierRequired,persistentStateRequired:a.persistentStateRequired||r.persistentStateRequired,videoRobustness:a.videoRobustness||r.videoRobustness,audioRobustness:a.audioRobustness||r.audioRobustness,serverCertificate:a.serverCertificate||r.serverCertificate,initData:o,keyIds:s});break}return n}function Ot(n){return H(function e(){var t;return z(e,function(e){if(1===e.j)return t=Array.from(n.b.keys()),n.b.clear(),V(e,Promise.all(t.map(function(t){return H(function e(){return z(e,function(e){switch(e.j){case 1:return X.F("Closing session",t.sessionId),q(e,2),V(e,(n=t,H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return t=new Promise(function(e,t){new Me(t).R(Bt)}),q(e,2),V(e,Promise.race([Promise.all([n.close(),n.closed]),t]),4);case 4:G(e,0);break;case 2:W(e),X.m("Timeout waiting for session close"),I(e)}})})),4);case 4:G(e,0);break;case 2:W(e),I(e)}var n})})})),0)})})}function jt(e){return at(e=e.b.values(),function(e){return e.loaded})}function Kt(e,t,n){!e.keySystem||"org.w3.clearkey"==e.keySystem&&e.licenseServerUri||(t.size&&(t=t.get(e.keySystem)||"",e.licenseServerUri=t),e.keyIds||(e.keyIds=[]),(n=n.get(e.keySystem))&&(e.distinctiveIdentifierRequired||(e.distinctiveIdentifierRequired=n.distinctiveIdentifierRequired),e.persistentStateRequired||(e.persistentStateRequired=n.persistentStateRequired),e.videoRobustness||(e.videoRobustness=n.videoRobustness),e.audioRobustness||(e.audioRobustness=n.audioRobustness),e.serverCertificate||(e.serverCertificate=n.serverCertificate)),d.cast&&d.cast.__platform__&&"com.microsoft.playready"==e.keySystem&&(e.keySystem="com.chromecast.playready"))}(e=wt.prototype).destroy=function(){var n=this;return H(function e(){return z(e,function(e){switch(e.j){case 1:return n.c?V(e,n.qa,0):(n.c=!0,V(e,(t=n,H(function e(){return z(e,function(e){switch(e.j){case 1:return t.i.release(),t.i=null,t.o.reject(),t.ea.stop(),t.ea=null,t.T.stop(),t.T=null,V(e,Ot(t),2);case 2:if(t.h)return q(e,4),V(e,t.h.setMediaKeys(null),6);e.C(3);break;case 6:G(e,5);break;case 4:W(e);case 5:t.h=null;case 3:t.a=null,t.u.clear(),t.l=null,t.v=[],t.f=null,t.g=null,t.D=null,I(e)}})})),4));case 4:n.qa.resolve(),e.C(0)}var t})})},e.configure=function(e){this.f=e},e.Qb=function(e){var t=this;if(!this.l)return this.i.ua(e,"encrypted",function(){t.g(new Y(2,6,6010))}),Promise.resolve();this.h=e,this.i.ua(this.h,"play",function(){for(var e=0;e<t.H.length;e++)Dt(t,t.H[e]);t.ra=!0,t.H=[]}),"webkitCurrentPlaybackTargetIsWireless"in this.h&&this.i.B(this.h,"webkitcurrentplaybacktargetiswirelesschanged",function(){return Ot(t)}),e=(e=this.h.setMediaKeys(this.l)).catch(function(e){return Promise.reject(new Y(2,6,6003,e.message))});var n=Et(this);return Promise.all([e,n]).then(function(){return t.c?Promise.reject():(xt(t),void(t.a.initData.length||t.v.length||t.i.B(t.h,"encrypted",function(e){return kt(t,e.initDataType,new Uint8Array(e.initData))})))}).catch(function(e){if(!t.c)return Promise.reject(e)})},e.Tb=function(){for(var e=1/0,t=this.b.keys(),n=(t=F(t)).next();!n.done;n=t.next())n=n.value,isNaN(n.expiration)||(e=Math.min(e,n.expiration));return e},e.se=function(e){this.h&&this.f.delayLicenseRequestUntilPlayed&&this.h.paused&&!this.ra?this.H.push(e):Dt(this,e)},e.qe=function(e){e=e.target,X.J("Key status changed for session",e.sessionId);var o=this.b.get(e),s=!1;e.keyStatuses.forEach(function(e,t){var n,i,r,a;"string"==typeof t&&(n=t,t=e,e=n),"com.microsoft.playready"==this.a.keySystem&&16==t.byteLength&&(gt("Trident/")||navigator.userAgent.match(/Edge?\//))&&(i=(n=new DataView(t)).getUint32(0,!0),r=n.getUint16(4,!0),a=n.getUint16(6,!0),n.setUint32(0,i,!1),n.setUint16(4,r,!1),n.setUint16(6,a,!1)),"com.microsoft.playready"==this.a.keySystem&&"status-pending"==e&&(e="usable"),"status-pending"!=e&&(o.loaded=!0),"expired"==e&&(s=!0),n=Se.Ic(new Uint8Array(t)),this.sa.set(n,e)}.bind(this));var t=e.expiration-Date.now();(t<0||s&&t<1e3)&&o&&!o.Ca&&(X.debug("Session has expired",e.sessionId),this.b.delete(e),e.close().catch(function(){})),jt(this)&&(this.o.resolve(),this.T.R(Ht))};var Bt=1,Ft=5,Ht=.5;function Vt(){this.a=new muxjs.mp4.CaptionParser,this.g=[],this.f={}}function qt(){}function Gt(e){return e&&!(1==e.length&&e.end(0)-e.start(0)<1e-6)&&e.length?e.end(e.length-1):null}function Wt(e,t,n){return n=void 0===n?0:n,!(!e||!e.length||1==e.length&&e.end(0)-e.start(0)<1e-6||t>e.end(e.length-1))&&t+n>=e.start(0)}function zt(e,t){if(!e||!e.length||1==e.length&&e.end(0)-e.start(0)<1e-6)return 0;for(var n=0,i=e.length-1;0<=i&&e.end(i)>t;--i)n+=e.end(i)-Math.max(e.start(i),t);return n}function Xt(e){if(!e)return[];for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}function Yt(e,t,n){this.startTime=e,this.direction=tn,this.endTime=t,this.payload=n,this.region=new ln,this.position=null,this.positionAlign=$t,this.size=0,this.textAlign=Jt,this.writingMode=nn,this.lineInterpretation=rn,this.line=null,this.lineHeight="",this.lineAlign=an,this.displayAlign=Zt,this.fontSize=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=sn,this.fontStyle=un,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=!1}Vt.prototype.init=function(e){var t=muxjs.mp4.probe;e=new Uint8Array(e),this.g=t.videoTrackIds(e),this.f=t.timescale(e),this.a.init()},Vt.prototype.b=function(e,t){e=new Uint8Array(e);(e=this.a.parse(e,this.g,this.f))&&e.captions&&t(e.captions),this.a.clearParsedCaptions()},Vt.prototype.c=function(){this.a.resetCaptionStream()},qt.prototype.init=function(){},qt.prototype.b=function(){},qt.prototype.c=function(){},L("shaka.text.Cue",Yt),Yt.prototype.clone=function(){var e,t=new Yt(0,0,"");for(e in this)t[e]=this[e],t[e]&&t[e].constructor==Array&&(t[e]=t[e].slice());return t};var $t="auto";Yt.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:$t};var Jt="center",Qt={LEFT:"left",RIGHT:"right",CENTER:Jt,START:"start",END:"end"};Yt.textAlign=Qt;var Zt="after",en={BEFORE:"before",CENTER:"center",AFTER:Zt};Yt.displayAlign=en;var tn="ltr";Yt.direction={HORIZONTAL_LEFT_TO_RIGHT:tn,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var nn="horizontal-tb";Yt.writingMode={HORIZONTAL_TOP_TO_BOTTOM:nn,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var rn=0;Yt.lineInterpretation={LINE_NUMBER:rn,PERCENTAGE:1};var an="start",on={CENTER:"center",START:an,END:"end"};Yt.lineAlign=on;var sn=400;Yt.fontWeight={NORMAL:sn,BOLD:700};var un="normal",cn={NORMAL:un,ITALIC:"italic",OBLIQUE:"oblique"};function ln(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=dn,this.scroll=fn}Yt.fontStyle=cn,Yt.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},L("shaka.text.CueRegion",ln);var dn=1;ln.units={PX:0,PERCENTAGE:dn,LINES:2};var fn="";function hn(e){this.g=null,this.c=e,this.f=this.o=0,this.h=1/0,this.b=this.a=null,this.l="",this.i=new Map}ln.scrollMode={NONE:fn,UP:"up"};var pn={};function mn(e){return!!(pn[e]||d.muxjs&&"application/cea-608"==e)}function gn(e,t){"application/cea-608"!=t&&(e.g=new pn[t])}function vn(e,t,n,i,r){for(var a=n+" "+i,o=new Map,s=(t=F(t)).next();!s.done;s=t.next()){var u=s.value,s=u.stream;o.has(s)||o.set(s,new Map),o.get(s).has(a)||o.get(s).set(a,[]),u.startTime+=r,u.endTime+=r,u.startTime>=e.f&&u.startTime<e.h&&(u=new Yt(u.startTime,u.endTime,u.text),o.get(s).get(a).push(u),s==e.l&&e.c.append([u]))}for(a=(r=F(o.keys())).next();!a.done;a=r.next())for(a=a.value,e.i.has(a)||e.i.set(a,new Map),s=(t=F(o.get(a).keys())).next();!s.done;s=t.next())s=s.value,u=o.get(a).get(s),e.i.get(a).set(s,u);e.a=null==e.a?Math.max(n,e.f):Math.min(e.a,Math.max(n,e.f)),e.b=Math.max(e.b,Math.min(i,e.h))}function bn(e,t,n){var i,r;this.f=e,this.g=n,this.b={},this.a=null,this.c={},this.i=new Ze,this.v=!1,this.l={},this.o=t,this.u=new pe,this.h=(r=(i=this).u,t=new MediaSource,i.i.ua(t,"sourceopen",function(){URL.revokeObjectURL(i.D),r.resolve()}),i.D=yn(t),i.f.src=i.D,t),this.D=""}L("shaka.text.TextEngine.registerParser",function(e,t){pn[e]=t}),L("shaka.text.TextEngine.unregisterParser",function(e){delete pn[e]}),hn.prototype.destroy=function(){return this.c=this.g=null,this.i.clear(),Promise.resolve()},hn.prototype.sc=function(e){try{return this.g.parseMedia(new Uint8Array(e),{periodStart:0,segmentStart:null,segmentEnd:0})[0].startTime}catch(e){throw new Y(2,2,2009,e)}},hn.prototype.remove=function(e,t){return Promise.resolve().then(function(){!this.c||!this.c.remove(e,t)||null==this.a||t<=this.a||e>=this.b||(e<=this.a&&t>=this.b?this.a=this.b=null:e<=this.a&&t<this.b?this.a=t:e>this.a&&t>=this.b&&(this.b=e))}.bind(this))};var yn=d.URL.createObjectURL;function wn(e){var n,i,t=ut(e.mimeType,e.codecs),r=(i=[(n=e).mimeType],lt.forEach(function(e,t){t=n[t];t&&i.push(e+'="'+t+'"')}),i.join(";"));return mn(t)||MediaSource.isTypeSupported(r)||xe(t,e.type)}function Tn(e,t){e.a||(e.a=new hn(e.g)),gn(e.a,t)}function Sn(e){return!e.h||"ended"==e.h.readyState}function En(e,t){var n="text"==t?e.a.a:!(n=kn(e,t))||1==n.length&&n.end(0)-n.start(0)<1e-6?null:1==n.length&&n.start(0)<0?0:n.length?n.start(0):null;return n}function xn(e,t){return"text"==t?e.a.b:Gt(kn(e,t))}function kn(t,n){try{return t.b[n].buffered}catch(e){return n in t.b&&X.error("failed to get buffered range for "+n,e),null}}function An(t,n,e,i,r,a){return"text"==n?(l=t.a,o=e,s=i,u=r,Promise.resolve().then(function(){var e;this.g&&this.c&&(null==s||null==u?this.g.parseInit(new Uint8Array(o)):(e={periodStart:this.o,segmentStart:s,segmentEnd:u},e=this.g.parseMedia(new Uint8Array(o),e).filter(function(e){return e.startTime>=this.f&&e.startTime<this.h}.bind(this)),this.c.append(e),null==this.a&&(this.a=Math.max(s,this.f)),this.b=Math.min(u,this.h)))}.bind(l))):t.l[n]?(c=t.l[n],l=e,c.f=!0,c.b=new pe,c.g=[],c.c=[],l=new Uint8Array(l),c.a.push(l),c.a.flush(),c.f&&c.b.reject(new Y(2,3,3018)),c.b.then(function(e){return this.a||Tn(this,"text/vtt"),e.captions&&e.captions.length&&vn(this.a,e.captions,i,r,this.b.video.timestampOffset),Pn(this,n,this.Fe.bind(this,n,e.data.buffer))}.bind(t))):(a&&d.muxjs&&(t.a||Tn(t,"text/vtt"),null==i&&null==r?t.o.init(e):t.o.b(e,function(e){e.length&&vn(t.a,e,i,r,t.b.video.timestampOffset)})),Pn(t,n,t.Fe.bind(t,n,e)));var o,s,u,c,l}function Mn(e,t){var n=xn(e,"video")||0;!function(e,t,n){if(e.l=t,t=e.i.get(t))for(var i=F(t.keys()),r=i.next();!r.done;r=i.next())(r=t.get(r.value).filter(function(e){return e.endTime<=n}))&&e.c.append(r)}(e.a,t,n)}function In(e,t){return"text"==t?e.a?(e.o.c(),e.a.remove(0,1/0)):Promise.resolve():Pn(e,t,e.Ge.bind(e,t,0,e.h.duration))}function Pn(t,n,i){if(t.v)return Promise.reject();if(i={start:i,p:new pe},t.c[n].push(i),1==t.c[n].length)try{i.start()}catch(e){"QuotaExceededError"==e.name?i.p.reject(new Y(2,3,3017,n)):i.p.reject(new Y(2,3,3015,e)),Rn(t,n)}return i.p}function Cn(e,n){if(e.v)return Promise.reject();var t,i=[];for(t in e.b){var r=new pe,a={start:function(e){e.resolve()}.bind(null,r),p:r};e.c[t].push(a),i.push(r),1==e.c[t].length&&a.start()}return Promise.all(i).then(function(){try{n()}catch(e){var t=Promise.reject(new Y(2,3,3015,e))}for(var e in this.b)Rn(this,e);return t}.bind(e),function(e){throw e}.bind(e))}function Rn(t,n){t.c[n].shift();var i=t.c[n][0];if(i)try{i.start()}catch(e){i.p.reject(new Y(2,3,3015,e)),Rn(t,n)}}function Nn(e,t){return e=Ln(e),t=Ln(t),e.split("-")[0]==t.split("-")[0]}function Dn(e,t){e=Ln(e),t=Ln(t);e=e.split("-"),t=t.split("-");return e[0]==t[0]&&1==e.length&&2==t.length}function Ln(e){var t=e.split("-");return e=t[0]||"",t=t[1]||"",e=e.toLowerCase(),e=On.get(e)||e,(t=t.toUpperCase())?e+"-"+t:e}function Un(e){return e.language?Ln(e.language):e.audio&&e.audio.language?Ln(e.audio.language):e.video&&e.video.language?Ln(e.video.language):"und"}function _n(e,t){for(var n=Ln(e),i=new Set,r=F(t),a=r.next();!a.done;a=r.next())i.add(Ln(a.value));for(a=(r=F(i)).next();!a.done;a=r.next())if((a=a.value)==n)return a;for(a=(r=F(i)).next();!a.done;a=r.next())if(Dn(a=a.value,n))return a;for(a=(r=F(i)).next();!a.done;a=r.next()){var o=n,s=Ln(s=a=a.value),o=Ln(o);if(s=s.split("-"),o=o.split("-"),2==s.length&&2==o.length&&s[0]==o[0])return a}for(a=(i=F(i)).next();!a.done;a=i.next())if(Dn(n,r=a.value))return r;return null}(e=bn.prototype).destroy=function(){var e=this;this.v=!0;var t,n,i=[];for(t in this.c){var r=this.c[t],a=r[0];for(this.c[t]=r.slice(0,1),a&&i.push(a.p.catch(ce.wc)),a=1;a<r.length;++a)r[a].p.reject()}for(n in this.a&&i.push(this.a.destroy()),this.g&&i.push(this.g.destroy()),this.l)i.push(this.l[n].destroy());return Promise.all(i).then(function(){e.i&&(e.i.release(),e.i=null),e.f&&(e.f.removeAttribute("src"),e.f.load(),e.f=null),e.h=null,e.a=null,e.g=null,e.b={},e.l={},e.o=null,e.c={}})},e.init=function(t,i){var r=this;return H(function e(){var n;return z(e,function(e){switch(e.j){case 1:return n=fe,V(e,r.u,2);case 2:t.forEach(function(e,t){e=ut(e.mimeType,e.codecs);t==n.va?Tn(r,e):(!i&&MediaSource.isTypeSupported(e)||!xe(e,t)||(r.l[t]=new Ee,e=ke(t,e)),e=r.h.addSourceBuffer(e),r.i.B(e,"error",r.vg.bind(r,t)),r.i.B(e,"updateend",r.Gb.bind(r,t)),r.b[t]=e,r.c[t]=[])}),I(e)}})})},e.$c=function(e){var t,n;e.total=Xt(this.f.buffered),e.audio=Xt(kn(this,"audio")),e.video=Xt(kn(this,"video")),e.text=[],this.a&&(t=this.a.a,n=this.a.b,null!=t&&null!=n&&e.text.push({start:t,end:n}))},e.remove=function(e,t,n){return"text"==e?this.a.remove(t,n):Pn(this,e,this.Ge.bind(this,e,t,n))},e.flush=function(e){return"text"==e?Promise.resolve():Pn(this,e,this.cf.bind(this,e))},e.endOfStream=function(e){return Cn(this,function(){Sn(this)||(e?this.h.endOfStream(e):this.h.endOfStream())}.bind(this))},e.Ba=function(e){return Cn(this,function(){this.h.duration=e}.bind(this))},e.ca=function(){return this.h.duration},e.Fe=function(e,t){this.b[e].appendBuffer(t)},e.Ge=function(e,t,n){n<=t?this.Gb(e):this.b[e].remove(t,n)},e.Pe=function(e){var t=this.b[e].appendWindowStart,n=this.b[e].appendWindowEnd;this.b[e].abort(),this.b[e].appendWindowStart=t,this.b[e].appendWindowEnd=n,this.Gb(e)},e.cf=function(e){this.f.currentTime-=.001,this.Gb(e)},e.ug=function(e,t){t<0&&(t+=.001),this.b[e].timestampOffset=t,this.Gb(e)},e.rg=function(e,t,n){this.b[e].appendWindowStart=0,this.b[e].appendWindowEnd=n,this.b[e].appendWindowStart=t,this.Gb(e)},e.vg=function(e){this.c[e][0].p.reject(new Y(2,3,3014,this.f.error?this.f.error.code:0))},e.Gb=function(e){var t=this.c[e][0];t&&(t.p.resolve(),Rn(this,e))};var On=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),jn={Vd:function(e,t){function n(e){var t="";e.video&&(t=ct(e.video.codecs)[0]);var n="";return e.audio&&(n=ct(e.audio.codecs)[0]),t+"-"+n}for(var i=e.periods.reduce(function(e,t){return e.concat(t.variants)},[]),i=jn.$d(i,t),r=new je,a=(i=F(i)).next();!a.done;a=i.next()){var o=n(a=a.value);r.push(o,a)}var s=null,u=1/0;for(r.forEach(function(e,t){for(var n=0,i=0,r=F(t),a=r.next();!a.done;a=r.next())n+=a.value.bandwidth||0,++i;n/=i,X.debug("codecs",e,"avg bandwidth",n),n<u&&(s=e,u=n)}),i=(r=F(e.periods)).next();!i.done;i=r.next())(i=i.value).variants=i.variants.filter(function(e){return n(e)==s||(X.debug("Dropping Variant (better codec available)",e),!1)})},ld:function(e,t,n){function i(e,t,n){return t<=e&&e<=n}var r=e.video;return!(r&&r.width&&r.height&&(!i(r.width,t.minWidth,Math.min(t.maxWidth,n.width))||!i(r.height,t.minHeight,Math.min(t.maxHeight,n.height))||!i(r.width*r.height,t.minPixels,t.maxPixels))||e&&e.video&&e.video.frameRate&&!i(e.video.frameRate,t.minFrameRate,t.maxFrameRate)||!i(e.bandwidth,t.minBandwidth,t.maxBandwidth))},Sd:function(e,n,i){var r=!1;return e.forEach(function(e){var t=e.allowedByApplication;e.allowedByApplication=jn.ld(e,n,i),t!=e.allowedByApplication&&(r=!0)}),r},filterNewPeriod:function(n,i,r,e){e.variants=e.variants.filter(function(e){if(n&&n.V&&!Ut(n,e))return X.debug("Dropping variant - not compatible with key system",e),!1;var t=e.audio;return e=e.video,t&&!wn(t)?(X.debug("Dropping variant - audio not compatible with platform",jn.yb(t)),!1):e&&!wn(e)?(X.debug("Dropping variant - video not compatible with platform",jn.yb(e)),!1):t&&i&&!jn.Td(t,i)?(X.debug("Droping variant - not compatible with active audio","active audio",jn.yb(i),"variant.audio",jn.yb(t)),!1):!(e&&r&&!jn.Td(e,r))||(X.debug("Droping variant - not compatible with active video","active video",jn.yb(r),"variant.video",jn.yb(e)),!1)}),e.textStreams=e.textStreams.filter(function(e){var t=mn(ut(e.mimeType,e.codecs));return t||X.debug("Dropping text stream. Is not supported by the platform.",e),t})},Td:function(e,t){return e.mimeType==t.mimeType&&e.codecs.split(".")[0]==t.codecs.split(".")[0]},Qd:function(e){var t=e.audio,n=e.video,i=t?t.codecs:null,r=n?n.codecs:null,a=[];r&&a.push(r),i&&a.push(i);var o=[];n&&o.push(n.mimeType),t&&o.push(t.mimeType),o=o[0]||null;var s=[];t&&s.push(t.kind),n&&s.push(n.kind),s=s[0]||null;var u=new Set;return t&&t.roles.forEach(function(e){return u.add(e)}),n&&n.roles.forEach(function(e){return u.add(e)}),e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:s,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:o,codecs:a.join(", "),audioCodec:i,videoCodec:r,primary:e.primary,roles:Array.from(u),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},n&&(e.videoId=n.id,e.originalVideoId=n.originalId,e.width=n.width||null,e.height=n.height||null,e.frameRate=n.frameRate||null,e.pixelAspectRatio=n.pixelAspectRatio||null,e.videoBandwidth=n.bandwidth||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.label=t.label,e.audioRoles=t.roles),e},Fc:function(e){return{id:e.id,active:!1,type:"text",bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:e.mimeType,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId}},ed:function(e){return e.__shaka_id||(e.__shaka_id=jn.Lf++),e.__shaka_id},Lf:0,Ff:function(e){var t=jn.ee(e);return t.active="disabled"!=e.mode,t.type="text",t.originalTextId=e.id,"captions"==e.kind&&(t.mimeType="application/cea-608"),e.kind&&(t.roles=[e.kind]),t},de:function(e){var t=jn.ee(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind&&(t.primary=!0),e.kind&&(t.roles=[e.kind],t.audioRoles=[e.kind]),t},ee:function(e){return{id:jn.ed(e),active:!1,type:"",bandwidth:0,language:Ln(e.language),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}},Bb:function(e){return e.allowedByApplication&&e.allowedByKeySystem},tf:function(e){return e.filter(function(e){return jn.Bb(e)})},$d:function(e,t){for(var n=e.filter(function(e){return e.audio&&e.audio.channelsCount}),i=new Map,r=(n=F(n)).next();!r.done;r=n.next()){var a=(r=r.value).audio.channelsCount;i.has(a)||i.set(a,[]),i.get(a).push(r)}return 0==(n=Array.from(i.keys())).length?e:(r=n.filter(function(e){return e<=t})).length?i.get(Math.max.apply(null,r)):i.get(Math.min.apply(null,n))},Sb:function(e,t,n){var i=e,r=e.filter(function(e){return e.primary});r.length&&(i=r);var a,o=i.length?i[0].language:"",i=i.filter(function(e){return e.language==o});if(!t||(a=_n(Ln(t),e.map(function(e){return e.language})))&&(i=e.filter(function(e){return Ln(e.language)==a})),n){if((e=jn.Zd(i,n)).length)return e;X.m("No exact match for the text role could be found.")}else if((e=i.filter(function(e){return 0==e.roles.length})).length)return e;return(e=i.map(function(e){return e.roles}).reduce(ce.Oc,[])).length?jn.Zd(i,e[0]):i},Zd:function(e,t){return e.filter(function(e){return e.roles.includes(t)})},ce:function(e,t,n){for(var i=0;i<n.length;i++)if(n[i].audio==e&&n[i].video==t)return n[i];return null},Gf:function(e){return"audio"==e.type},Jf:function(e){return"video"==e.type},Cf:function(e){var t=[];return e.audio&&t.push(e.audio),e.video&&t.push(e.video),t},yb:function(e){return jn.Gf(e)?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:jn.Jf(e)?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"}};function Kn(){this.h=null,this.c=!1,this.b=new K,this.g=[],this.i=!1,this.a=this.f=null}function Bn(t,e){return t&&(e=e.filter(function(e){return jn.ld(e,t,{width:1/0,height:1/0})})),e.sort(function(e,t){return e.bandwidth-t.bandwidth})}function Fn(e,t){this.a=e,this.b=t}function Hn(e,t){var n=new Fn(2,6),i=Gn.a,r=n.b-i.b;(0<(n.a-i.a||r)?Gn.c:Gn.b)(Gn.a,n,e,t)}function Vn(e,t,n,i){X.Z([n,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",i].join(" "))}function qn(e,t,n,i){X.jc([n,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",i].join(""))}L("shaka.abr.SimpleAbrManager",Kn),Kn.prototype.stop=function(){this.h=null,this.c=!1,this.g=[],this.f=null},Kn.prototype.init=function(e){this.h=e},Kn.prototype.chooseVariant=function(){var e=Bn(this.a.restrictions,this.g),t=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);this.g.length&&!e.length&&(X.m("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),e=[(e=Bn(null,this.g))[0]]);for(var n=e[0]||null,i=0;i<e.length;++i){var r=e[i],a=r.bandwidth/this.a.bandwidthDowngradeTarget,o=(e[i+1]||{bandwidth:1/0}).bandwidth/this.a.bandwidthUpgradeTarget;X.J("Bandwidth ranges:",(r.bandwidth/1e6).toFixed(3),(a/1e6).toFixed(3),(o/1e6).toFixed(3)),a<=t&&t<=o&&(n=r)}return this.f=Date.now(),n},Kn.prototype.enable=function(){this.c=!0},Kn.prototype.disable=function(){this.c=!1},Kn.prototype.segmentDownloaded=function(e,t){X.J("Segment downloaded:","deltaTimeMs="+e,"numBytes="+t,"lastTimeChosenMs="+this.f,"enabled="+this.c);var n,i=this.b;if(t<16e3||(n=8e3*t/e,e=e/1e3,i.a+=t,O(i.b,e,n),O(i.c,e,n)),null!=this.f&&this.c)e:{if(X.J("Suggesting Streams..."),this.i){if(Date.now()-this.f<1e3*this.a.switchInterval){X.J("Still within switch interval...");break e}}else{if(!(128e3<=this.b.a)){X.J("Still waiting for a good estimate...");break e}this.i=!0}i=this.chooseVariant(),n=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate),X.debug("Calling switch_(), bandwidth="+Math.round(n/1e3)+" kbps"),this.h(i)}},Kn.prototype.getBandwidthEstimate=function(){return this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate)},Kn.prototype.setVariants=function(e){this.g=e},Kn.prototype.configure=function(e){this.a=e},Fn.prototype.toString=function(){return"v"+this.a+"."+this.b};var Gn=null,Wn="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),zn="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),Xn=["loop","playbackRate"],Yn=["pause","play"],$n="abrstatuschanged adaptation buffering drmsessionupdate emsg error expirationupdated largegap loading manifestparsed onstatechange onstateidle streaming textchanged texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading variantchanged".split(" "),Jn={getAssetUri:2,getAudioLanguages:2,getAudioLanguagesAndRoles:2,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:2,getTextLanguagesAndRoles:2,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,usingEmbeddedTextTrack:2,getLoadMode:10},Qn={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},Zn=[["getConfiguration","configure"]],ei=[["isTextTrackVisible","setTextTrackVisibility"]],ti="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectEmbeddedTextTrack selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay".split(" "),ni=["attach","detach","load","unload"];function ii(e){return JSON.stringify(e,function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof Oe){var n={};for(r in t){var i=t[r];i&&"object"==typeof i?"detail"==r&&(n[r]=i):r in Event||(n[r]=i)}return n}if(t instanceof Error){var r=new Set(["name","message","stack"]);for(n in t)r.add(n);for(n=(i=F(Object.getOwnPropertyNames(t))).next();!n.done;n=i.next())r.add(n.value);for(i={},n=(r=F(r)).next();!n.done;n=r.next())i[n=n.value]=t[n];r={__type__:"Error",contents:i}}else if(t instanceof TimeRanges)for(r={__type__:"TimeRanges",length:t.length,start:[],end:[]},n=0;n<t.length;++n)r.start.push(t.start(n)),r.end.push(t.end(n));else r=t instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(t)}:"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:t<0?"-Infinity":"Infinity":t;return r}})}function ri(e){return JSON.parse(e,function(e,t){if("NaN"==t)var n=NaN;else if("-Infinity"==t)n=-1/0;else if("Infinity"==t)n=1/0;else if(t&&"object"==typeof t&&"TimeRanges"==t.__type__)n={length:(a=t).length,start:function(e){return a.start[e]},end:function(e){return a.end[e]}};else if(t&&"object"==typeof t&&"Uint8Array"==t.__type__)n=new Uint8Array(t.entries);else if(t&&"object"==typeof t&&"Error"==t.__type__){n=t.contents;var i,r=Error(n.message);for(i in n)r[i]=n[i];n=r}else n=t;var a;return n})}function ai(e,t,n,i,r,a){this.T=e,this.f=new Me(t),this.V=n,this.l=!1,this.v=i,this.K=r,this.G=a,this.b=this.h=!1,this.H="",this.i=null,this.o=this.sd.bind(this),this.u=this.Sf.bind(this),this.a={video:{},player:{}},this.D=0,this.c={},this.g=null,fi.add(this)}var oi=!1,si=null;function ui(e,t){X.debug("CastSender: onExistingSessionJoined");var n=e.G();e.g=new pe,e.l=!0,e.ud(n,t)}function ci(e){var t=si;t.removeUpdateListener(e.o),t.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.u)}function li(e){for(var t in e.c){var n=e.c[t];delete e.c[t],n.reject(new Y(1,7,7e3))}}function di(t,e){var n=ii(e),i=si;try{i.sendMessage("urn:x-cast:com.google.shaka.v2",n,function(){},X.error)}catch(e){throw X.error("Cast session sendMessage threw",e),n=new Y(2,8,8005,e),t.v("player",new Oe("error",{detail:n})),t.vb(),n}}(e=ai.prototype).destroy=function(){return fi.delete(this),li(this),si&&ci(this),this.f&&(this.f.stop(),this.f=null),this.K=this.v=null,this.b=this.h=!1,this.u=this.o=this.g=this.c=this.a=this.i=null,Promise.resolve()},e.ha=function(){return this.b},e.xd=function(){return this.H},e.init=function(){var e;d.chrome&&chrome.cast&&chrome.cast.isAvailable&&this.T.length&&(this.h=!0,this.f.Gc(),e=new chrome.cast.SessionRequest(this.T),e=new chrome.cast.ApiConfig(e,function(e){for(var t=F(fi),n=t.next();!n.done;n=t.next())ui(n.value,e)}.bind(this),function(e){for(var t=F(fi),n=t.next();!n.done;n=t.next()){n=n.value;var i=e;X.debug("CastSender: receiver status",i),oi="available"==i,n.f.Gc()}}.bind(this),"origin_scoped"),chrome.cast.initialize(e,function(){X.debug("CastSender: init")},function(e){X.error("CastSender: init error",e)}),oi&&this.f.R(.02),(e=si)&&e.status!=chrome.cast.SessionStatus.STOPPED?(X.debug("CastSender: re-using existing connection"),ui(this,e)):si=null)},e.Gd=function(e){this.i=e,this.b&&di(this,{type:"appData",appData:this.i})},e.cast=function(e){return this.h?oi?this.b?Promise.reject(new Y(1,8,8002)):(this.g=new pe,chrome.cast.requestSession(this.ud.bind(this,e),this.pe.bind(this)),this.g):Promise.reject(new Y(1,8,8001)):Promise.reject(new Y(1,8,8e3))},e.vb=function(){if(this.b){if(li(this),si){ci(this);try{si.stop(function(){},function(){})}catch(e){}si=null}this.sd()}},e.get=function(e,t){if("video"==e){if(Yn.includes(t))return this.ye.bind(this,e,t)}else if("player"==e){if(Qn[t]&&!this.get("player","isLive")())return function(){};if(ti.includes(t))return this.ye.bind(this,e,t);if(ni.includes(t))return this.ig.bind(this,e,t);if(Jn[t])return this.ve.bind(this,e,t)}return this.ve(e,t)},e.set=function(e,t,n){this.a[e][t]=n,di(this,{type:"set",targetName:e,property:t,value:n})},e.ud=function(e,t){X.debug("CastSender: onSessionInitiated"),(si=t).addUpdateListener(this.o),t.addMessageListener("urn:x-cast:com.google.shaka.v2",this.u),this.sd(),di(this,{type:"init",initState:e,appData:this.i}),this.g.resolve()},e.pe=function(e){var t=8003;switch(e.code){case"cancel":t=8004;break;case"timeout":t=8005;break;case"receiver_unavailable":t=8006}this.g.reject(new Y(2,8,t,e))},e.ve=function(e,t){return this.a[e][t]},e.ye=function(e,t,n){for(var i=[],r=2;r<arguments.length;++r)i[r-2]=arguments[r];di(this,{type:"call",targetName:e,methodName:t,args:i})},e.ig=function(e,t,n){for(var i=[],r=2;r<arguments.length;++r)i[r-2]=arguments[r];r=new pe;var a=this.D.toString();this.D++,this.c[a]=r;try{di(this,{type:"asyncCall",targetName:e,methodName:t,args:i,id:a})}catch(e){r.reject(e)}return r},e.sd=function(){var e=!!si&&"connected"==si.status;if(X.debug("CastSender: connection status",e),this.b&&!e){for(var t in this.K(),this.a)this.a[t]={};li(this)}this.H=(this.b=e)?si.receiver.friendlyName:"",this.f.Gc()},e.Sf=function(e,t){var n=ri(t);switch(X.J("CastSender: message",n),n.type){case"event":var i=n.event;this.v(n.targetName,new Oe(i.type,i));break;case"update":for(var r in i=n.update)for(var a in n=this.a[r]||{},i[r])n[a]=i[r][a];this.l&&(this.V(),this.l=!1);break;case"asyncComplete":if(r=n.id,n=n.error,a=this.c[r],delete this.c[r],a)if(n){for(i in r=new Y(n.severity,n.category,n.code),n)r[i]=n[i];a.reject(r)}else a.resolve()}};var fi=new Set;function hi(e,t,n){var i=this;Ke.call(this),this.c=e,this.b=t,this.i=this.g=this.f=this.l=this.h=null,this.u=n,this.o=new Map,this.a=new ai(n,function(){return gi(i)},function(){return vi(i)},function(e,t){return yi(i,e,t)},function(){return bi(i)},function(){return mi(i)}),function(t){for(var e in t.a.init(),t.i=new Ze,Wn.forEach(function(e){this.i.B(this.c,e,this.G.bind(this))}.bind(t)),$n.forEach(function(e){this.i.B(this.b,e,this.v.bind(this))}.bind(t)),t.h={},t.c)Object.defineProperty(t.h,e,{configurable:!1,enumerable:!0,get:t.D.bind(t,e),set:t.H.bind(t,e)});t.l={},pi(t,function(e){Object.defineProperty(t.l,e,{configurable:!1,enumerable:!0,get:function(){return function e(t,n){t.o.has(n)&&(n=t.o.get(n));if("addEventListener"==n)return t.g.addEventListener.bind(t.g);if("removeEventListener"==n)return t.g.removeEventListener.bind(t.g);if("getMediaElement"==n)return function(){return this.h}.bind(t);if("getSharedConfiguration"==n)return X.m("Can't share configuration across a network. Returning copy."),t.a.get("player","getConfiguration");if("getNetworkingEngine"==n)return t.a.ha()&&X.m("NOTE: getNetworkingEngine() is always local!"),t.b.Ub.bind(t.b);if(t.a.ha()){if("getManifest"==n||"drmInfo"==n)return function(){return X.Z(n+"() does not work while casting!"),null};if("getManifestUri"==n)return Hn("getManifestUri",'Please use "getAssetUri" instead.'),e(t,"getAssetUri");if("attach"==n||"detach"==n)return function(){return X.Z(n+"() does not work while casting!"),Promise.resolve()}}return t.a.ha()&&0==Object.keys(t.a.a.video).length&&Jn[n]||!t.a.ha()?t.b[n].bind(t.b):t.a.get("player",n)}(t,e)}})}),function(i){var r=new Map;pi(i,function(e,t){var n;r.has(t)?(n=r.get(t),e.length<n.length?i.o.set(e,n):i.o.set(n,e)):r.set(t,e)})}(t),t.f=new Ke,t.f.gc=t.h,t.g=new Ke,t.g.gc=t.l}(this)}function pi(e,t){function n(e){return"constructor"!=e&&"function"==typeof i[e]&&!r.has(e)}var i=e.b,r=new Set;for(a in i)n(a)&&(r.add(a),t(a,i[a]));for(var a=Object.getPrototypeOf(i),o=Object.getPrototypeOf({});a&&a!=o;){for(var s=F(Object.getOwnPropertyNames(a)),u=s.next();!u.done;u=s.next())n(u=u.value)&&(r.add(u),t(u,i[u]));a=Object.getPrototypeOf(a)}}function mi(e){var n={video:{},player:{},playerAfterLoad:{},manifest:e.b.pc(),startTime:null};return e.c.pause(),Xn.forEach(function(e){n.video[e]=this.c[e]}.bind(e)),e.c.ended||(n.startTime=e.c.currentTime),Zn.forEach(function(e){var t=e[1];e=this.b[e[0]](),n.player[t]=e}.bind(e)),ei.forEach(function(e){var t=e[1];e=this.b[e[0]](),n.playerAfterLoad[t]=e}.bind(e)),n}function gi(e){e.dispatchEvent(new Oe("caststatuschanged"))}function vi(e){e.f.dispatchEvent(new Oe(e.h.paused?"pause":"play"))}function bi(t){Zn.forEach(function(e){var t=e[1];e=this.a.get("player",e[0])(),this.b[t](e)}.bind(t));var e=t.a.get("player","getAssetUri")(),n=t.a.get("video","ended"),i=Promise.resolve(),r=t.c.autoplay,a=null;n||(a=t.a.get("video","currentTime")),e&&(t.c.autoplay=!1,i=t.b.load(e,a));var o={};Xn.forEach(function(e){o[e]=this.a.get("video",e)}.bind(t)),i.then(function(){t.c&&(Xn.forEach(function(e){this.c[e]=o[e]}.bind(t)),ei.forEach(function(e){var t=e[1];e=this.a.get("player",e[0])(),this.b[t](e)}.bind(t)),t.c.autoplay=r,e&&t.c.play())},function(e){t.b.dispatchEvent(new Oe("error",{detail:e}))})}function yi(e,t,n){e.a.ha()&&("video"==t?e.f.dispatchEvent(n):"player"==t&&e.g.dispatchEvent(n))}function wi(e,t,n,i){var r=this;Ke.call(this),this.a=e,this.b=t,this.c=new Ze,this.G={video:e,player:t},this.u=n||function(){},this.H=i||function(e){return e},this.v=!1,this.h=!0,this.g=0,this.o=!1,this.l=!0,this.i=this.f=null,this.D=new Me(function(){Si(r)}),n=this,(i=cast.receiver.CastReceiverManager.getInstance()).onSenderConnected=n.re.bind(n),i.onSenderDisconnected=n.re.bind(n),i.onSystemVolumeChanged=n.bf.bind(n),n.i=i.getCastMessageBus("urn:x-cast:com.google.cast.media"),n.i.onMessage=n.Nf.bind(n),n.f=i.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),n.f.onMessage=n.Xf.bind(n),i.start(),Wn.forEach(function(e){this.c.B(this.a,e,this.we.bind(this,"video"))}.bind(n)),$n.forEach(function(e){this.c.B(this.b,e,this.we.bind(this,"player"))}.bind(n)),cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?n.b.Hd(3840,2160):n.b.Hd(1920,1080),n.c.B(n.a,"loadeddata",function(){this.o=!0}.bind(n)),n.c.B(n.b,"loading",function(){this.h=!1,Ti(this)}.bind(n)),n.c.B(n.a,"playing",function(){this.h=!1,Ti(this)}.bind(n)),n.c.B(n.a,"pause",function(){Ti(this)}.bind(n)),n.c.B(n.b,"unloading",function(){this.h=!0,Ti(this)}.bind(n)),n.c.B(n.a,"ended",function(){var e=this;new Me(function(){e.a&&e.a.ended&&(e.h=!0,Ti(e))}).R(5)}.bind(n))}function Ti(e){Promise.resolve().then(function(){this.b&&(this.dispatchEvent(new Oe("caststatuschanged")),Ei(this)||Ai(this))}.bind(e))}function Si(e){e.D.R(.5);var t,n={video:{},player:{}};if(zn.forEach(function(e){n.video[e]=this.a[e]}.bind(e)),e.b.X())for(var i in Qn)0==e.g%Qn[i]&&(n.player[i]=e.b[i]());for(t in Jn)0==e.g%Jn[t]&&(n.player[t]=e.b[t]());(i=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(n.video.volume=i.level,n.video.muted=i.muted),e.o&&(e.g+=1),ki(e,{type:"update",update:n},e.f),Ei(e)}function Ei(e){return e.l&&(e.a.duration||e.b.X())&&(xi(e),e.l=!1,1)}function xi(e,t){t=void 0===t?0:t;var n={contentId:e.b.pc(),streamType:e.b.X()?"LIVE":"BUFFERED",contentType:""};e.b.X()||(n.duration=e.a.duration),Ai(e,t,n)}function ki(e,t,n,i){e.v&&(e=ii(t),i?n.getCastChannel(i).send(e):n.broadcast(e))}function Ai(e,t,n){t=void 0===t?0:t,n=void 0===n?null:n;var i=e.a.playbackRate,r=Mi,i={mediaSessionId:0,playbackRate:i,playerState:r=e.h?r.IDLE:e.b.fd()?r.Ke:e.a.paused?r.Me:r.Ne,currentTime:e.a.currentTime,supportedMediaCommands:63,volume:{level:e.a.volume,muted:e.a.muted}};n&&(i.media=n),ki(e,{requestId:t,type:"MEDIA_STATUS",status:[i]},e.i)}d.__onGCastApiAvailable=function(e){if(e)for(var t=(e=F(fi)).next();!t.done;t=e.next())t.value.init()},U(hi,Ke),L("shaka.cast.CastProxy",hi),hi.prototype.destroy=function(e){return e&&this.a.vb(),this.i&&(this.i.release(),this.i=null),e=[],this.b&&(e.push(this.b.destroy()),this.b=null),this.a&&(e.push(this.a.destroy()),this.a=null),this.l=this.h=this.c=null,Promise.all(e)},hi.prototype.getVideo=hi.prototype.Df=function(){return this.h},hi.prototype.getPlayer=hi.prototype.vf=function(){return this.l},hi.prototype.canCast=hi.prototype.Se=function(){return this.a.h&&oi},hi.prototype.isCasting=hi.prototype.ha=function(){return this.a.ha()},hi.prototype.receiverName=hi.prototype.xd=function(){return this.a.xd()},hi.prototype.cast=function(){var e=mi(this);return this.a.cast(e).then(function(){if(this.b)return this.b.Od()}.bind(this))},hi.prototype.setAppData=hi.prototype.Gd=function(e){this.a.Gd(e)},hi.prototype.suggestDisconnect=hi.prototype.Cg=function(){var e,t=this.a;t.b&&(e=t.G(),chrome.cast.requestSession(t.ud.bind(t,e),t.pe.bind(t)))},hi.prototype.changeReceiverId=hi.prototype.Ve=function(t){var n=this;return H(function e(){return z(e,function(e){switch(e.j){case 1:return t==n.u?e.return():(n.u=t,n.a.vb(),V(e,n.a.destroy(),2));case 2:n.a=null,n.a=new ai(t,function(){return gi(n)},function(){return vi(n)},function(e,t){return yi(n,e,t)},function(){return bi(n)},function(){return mi(n)}),n.a.init(),I(e)}})})},hi.prototype.forceDisconnect=hi.prototype.vb=function(){this.a.vb()},hi.prototype.D=function(e){if("addEventListener"==e)return this.f.addEventListener.bind(this.f);if("removeEventListener"==e)return this.f.removeEventListener.bind(this.f);if(this.a.ha()&&0==Object.keys(this.a.a.video).length){var t=this.c[e];if("function"!=typeof t)return t}return this.a.ha()?this.a.get("video",e):("function"==typeof(e=this.c[e])&&(e=e.bind(this.c)),e)},hi.prototype.H=function(e,t){this.a.ha()?this.a.set("video",e,t):this.c[e]=t},hi.prototype.G=function(e){this.a.ha()||this.f.dispatchEvent(new Oe(e.type,e))},hi.prototype.v=function(e){this.a.ha()||this.g.dispatchEvent(e)},U(wi,Ke),L("shaka.cast.CastReceiver",wi),wi.prototype.isConnected=function(){return this.v},wi.prototype.isIdle=wi.prototype.If=function(){return this.h},wi.prototype.destroy=function(){var n=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return n.c&&(n.c.release(),n.c=null),t=[],n.b&&(t.push(n.b.destroy()),n.b=null),n.D&&(n.D.stop(),n.D=null),n.a=null,n.G=null,n.u=null,n.v=!1,n.h=!0,n.f=null,n.i=null,V(e,Promise.all(t),2);case 2:cast.receiver.CastReceiverManager.getInstance().stop(),I(e)}})})},(e=wi.prototype).re=function(){this.g=0,this.l=!0,this.v=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,Ti(this)},e.we=function(e,t){this.b&&(Si(this),ki(this,{type:"event",targetName:e,event:t},this.f))},e.bf=function(){var e=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();e&&ki(this,{type:"update",update:{video:{volume:e.level,muted:e.muted}}},this.f),ki(this,{type:"event",targetName:"video",event:{type:"volumechange"}},this.f)},e.Xf=function(e){var t=ri(e.data);switch(X.debug("CastReceiver: message",t),t.type){case"init":this.g=0,this.o=!1,this.l=!0,function(n,i,e){for(var t in i.player)n.b[t](i.player[t]);n.u(e),e=Promise.resolve();var r=n.a.autoplay;i.manifest&&(n.a.autoplay=!1,e=n.b.load(i.manifest,i.startTime)),e.then(function(){if(n.b){for(var e in i.video)n.a[e]=i.video[e];for(var t in i.playerAfterLoad)n.b[t](i.playerAfterLoad[t]);n.a.autoplay=r,i.manifest&&(n.a.play(),Ai(n))}},function(e){n.b.dispatchEvent(new Oe("error",{detail:e}))})}(this,t.initState,t.appData),Si(this);break;case"appData":this.u(t.appData);break;case"set":var n=t.targetName,i=t.property,t=t.value;if("video"==n){var r=cast.receiver.CastReceiverManager.getInstance();if("volume"==i){r.setSystemVolumeLevel(t);break}if("muted"==i){r.setSystemVolumeMuted(t);break}}this.G[n][i]=t;break;case"call":(n=this.G[t.targetName])[t.methodName].apply(n,t.args);break;case"asyncCall":n=t.targetName,i=t.methodName,"player"==n&&"load"==i&&(this.g=0,this.o=!1),r=t.id,e=e.senderId;var a=this.G[n];t=a[i].apply(a,t.args),"player"==n&&"load"==i&&(t=t.then(function(){this.l=!0}.bind(this))),t.then(this.Ce.bind(this,e,r,null),this.Ce.bind(this,e,r))}},e.Nf=function(e){var n=ri(e.data);switch(X.debug("CastReceiver: message",n),n.type){case"PLAY":this.a.play(),Ai(this);break;case"PAUSE":this.a.pause(),Ai(this);break;case"SEEK":e=n.currentTime;var t=n.resumeState;null!=e&&(this.a.currentTime=Number(e)),t&&"PLAYBACK_START"==t?(this.a.play(),Ai(this)):t&&"PLAYBACK_PAUSE"==t&&(this.a.pause(),Ai(this));break;case"STOP":this.b.Od().then(function(){this.b&&Ai(this)}.bind(this));break;case"GET_STATUS":xi(this,Number(n.requestId));break;case"VOLUME":e=(t=n.volume).level,t=t.muted;var i=this.a.volume,r=this.a.muted;null!=e&&(this.a.volume=Number(e)),null!=t&&(this.a.muted=t),i==this.a.volume&&r==this.a.muted||Ai(this);break;case"LOAD":this.g=0,this.l=this.o=!1,e=n.media,t=n.currentTime,i=this.H(e.contentId),r=n.autoplay||!0,this.u(e.customData),r&&(this.a.autoplay=!0),this.b.load(i,t).then(function(){this.b&&xi(this)}.bind(this)).catch(function(e){var t="LOAD_FAILED";7==e.category&&7e3==e.code&&(t="LOAD_CANCELLED"),ki(this,{requestId:Number(n.requestId),type:t},this.i)}.bind(this));break;default:X.m("Unrecognized message type from the generic Chromecast controller!",n.type),ki(this,{requestId:Number(n.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.i)}},e.Ce=function(e,t,n){this.b&&ki(this,{type:"asyncComplete",id:t,error:n},this.f,e)};var Mi={IDLE:"IDLE",Ne:"PLAYING",Ke:"BUFFERING",Me:"PAUSED"};function Ii(e,t){this.N=e,this.b=t==Pi,this.a=0}L("shaka.util.DataViewReader",Ii);var Pi=1;function Ci(){throw new Y(2,3,3e3)}function Ri(){this.c=[],this.b=[],this.a=!1}function Ni(e){for(var t=null!=e.flags?12:8;e.reader.ya()&&!e.parser.a;)e.parser.Ac(e.start+t,e.reader,e.partialOkay)}function Di(e){for(var t=null!=e.flags?12:8,n=e.reader.I();0<n&&!e.parser.a;--n)e.parser.Ac(e.start+t,e.reader,e.partialOkay)}function Li(t){return function(e){t(e.reader.gb(e.reader.N.byteLength-e.reader.ga()))}}function Ui(e){for(var t=0,n=0;n<e.length;n++)t=t<<8|e.charCodeAt(n);return t}function _i(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function Oi(e){var r=this;this.a=[],this.b=[],this.data=[],(new Ri).L("moov",Ni).ia("pssh",function(e){if(1<e.version)X.m("Unrecognized PSSH version found!");else{var t=e.reader.N,t=new Uint8Array(t.buffer,t.byteOffset-12,e.size);if(r.data.push(t),r.a.push(Se.Ic(e.reader.gb(16))),0<e.version){t=e.reader.I();for(var n=0;n<t;++n){var i=Se.Ic(e.reader.gb(16));r.b.push(i)}}}}).parse(e),0==this.data.length&&X.m("No pssh box found!")}function ji(e){if(!e)return e;var t=new Oi(e);if(t.data.length<=1)return e;e=[];for(var n={},i=(t=F(t.data)).next();!i.done;n={tc:n.tc},i=t.next())n.tc=i.value,e.some(function(t){return function(e){return Se.Da(e,t.tc)}}(n))||e.push(n.tc);return Se.concat.apply(Se,e instanceof Array?e:function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(F(e)))}Ii.Endianness={Lg:0,Ng:Pi},Ii.prototype.hasMoreData=Ii.prototype.ya=function(){return this.a<this.N.byteLength},Ii.prototype.getPosition=Ii.prototype.ga=function(){return this.a},Ii.prototype.getLength=Ii.prototype.jf=function(){return this.N.byteLength},Ii.prototype.readUint8=Ii.prototype.na=function(){try{var e=this.N.getUint8(this.a);return this.a+=1,e}catch(e){Ci()}},Ii.prototype.readUint16=Ii.prototype.$b=function(){try{var e=this.N.getUint16(this.a,this.b);return this.a+=2,e}catch(e){Ci()}},Ii.prototype.readUint32=Ii.prototype.I=function(){try{var e=this.N.getUint32(this.a,this.b);return this.a+=4,e}catch(e){Ci()}},Ii.prototype.readInt32=Ii.prototype.xe=function(){try{var e=this.N.getInt32(this.a,this.b);return this.a+=4,e}catch(e){Ci()}},Ii.prototype.readUint64=Ii.prototype.Kb=function(){try{var e,t;this.b?(e=this.N.getUint32(this.a,!0),t=this.N.getUint32(this.a+4,!0)):(t=this.N.getUint32(this.a,!1),e=this.N.getUint32(this.a+4,!1))}catch(e){Ci()}if(2097151<t)throw new Y(2,3,3001);return this.a+=8,t*Math.pow(2,32)+e},Ii.prototype.readBytes=Ii.prototype.gb=function(e){this.a+e>this.N.byteLength&&Ci();var t=new Uint8Array(this.N.buffer,this.N.byteOffset+this.a,e);return this.a+=e,t},Ii.prototype.skip=Ii.prototype.P=function(e){this.a+e>this.N.byteLength&&Ci(),this.a+=e},Ii.prototype.rewind=Ii.prototype.ze=function(e){this.a<e&&Ci(),this.a-=e},Ii.prototype.seek=function(e){(e<0||e>this.N.byteLength)&&Ci(),this.a=e},Ii.prototype.readTerminatedString=Ii.prototype.wd=function(){for(var e=this.a;this.ya()&&0!=this.N.getUint8(this.a);)this.a+=1;return e=new Uint8Array(this.N.buffer,this.N.byteOffset+e,this.a-e),this.a+=1,me(e)},L("shaka.util.Mp4Parser",Ri),Ri.prototype.box=Ri.prototype.L=function(e,t){e=Ui(e);return this.c[e]=0,this.b[e]=t,this},Ri.prototype.fullBox=Ri.prototype.ia=function(e,t){e=Ui(e);return this.c[e]=1,this.b[e]=t,this},Ri.prototype.stop=function(){this.a=!0},Ri.prototype.parse=function(e,t){var n=new Uint8Array(e),n=new Ii(new DataView(n.buffer,n.byteOffset,n.byteLength),0);for(this.a=!1;n.ya()&&!this.a;)this.Ac(0,n,t)},Ri.prototype.parseNext=Ri.prototype.Ac=function(e,t,n){var i=t.ga(),r=t.I(),a=t.I();switch(X.J("Parsing MP4 box",_i(a)),r){case 0:r=t.N.byteLength-i;break;case 1:r=t.Kb()}var o,s,u=this.b[a];u?(s=o=null,1==this.c[a]&&(o=(s=t.I())>>>24,s&=16777215),a=i+r,n&&a>t.N.byteLength&&(a=t.N.byteLength),t=0<(a-=t.ga())?t.gb(a):new Uint8Array(0),u({parser:this,partialOkay:n||!1,version:o,flags:s,reader:t=new Ii(new DataView(t.buffer,t.byteOffset,t.byteLength),0),size:r,start:i+e})):t.P(Math.min(i+r-t.ga(),t.N.byteLength-t.ga()))},Ri.children=Ni,Ri.sampleDescription=Di,Ri.allData=Li,Ri.typeToString=_i;var Ki={oc:function(e,t){t=Ki.U(e,t);return 1!=t.length?null:t[0]},Wc:function(e,t,n){return 1!=(e=Ki.ae(e,t,n)).length?null:e[0]},U:function(e,t){return Array.prototype.filter.call(e.childNodes,function(e){return e instanceof Element&&e.tagName==t})},ae:function(e,t,n){return Array.prototype.filter.call(e.childNodes,function(e){return e instanceof Element&&e.localName==n&&e.namespaceURI==t})},getAttributeNS:function(e,t,n){return e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null},qc:function(e){return Array.prototype.every.call(e.childNodes,function(e){return e.nodeType==Node.TEXT_NODE||e.nodeType==Node.CDATA_SECTION_NODE})?e.textContent.trim():null},M:function(e,t,n,i){i=void 0===i?null:i;var r=null;return null!=(e=e.getAttribute(t))&&(r=n(e)),null==r?i:r},ag:function(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:Math.floor(e/1e3)):null},Ia:function(e){if(!e)return null;var t=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e);return t?(e=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null),isFinite(e)?e:null):(X.m("Invalid duration string:",e),null)},Cc:function(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null},parseInt:function(e){return 0==(e=Number(e))%1?e:null},Bc:function(e){return 0==(e=Number(e))%1&&0<e?e:null},Hb:function(e){return 0==(e=Number(e))%1&&0<=e?e:null},parseFloat:function(e){return e=Number(e),isNaN(e)?null:e},$e:function(e){var t;return e=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e),isNaN(e)?null:e},ue:function(e,t){var n,i=new DOMParser;try{var r=i.parseFromString(e,"text/xml")}catch(e){}return r&&r.documentElement.tagName==t&&(n=r.documentElement),n&&0<n.getElementsByTagName("parsererror").length?null:n},te:function(e,t){try{var n=me(e);return Ki.ue(n,t)}catch(e){}}},Bi=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime");function Fi(e,t,n){var i=function(e){for(var t=[],n=(e=F(e)).next();!n.done;n=e.next())(n=function(e){var t=e.getAttribute("schemeIdUri"),n=Ki.getAttributeNS(e,"urn:mpeg:cenc:2013","default_KID"),i=Ki.ae(e,"urn:mpeg:cenc:2013","pssh").map(Ki.qc);if(!t)return X.error("Missing required schemeIdUri attribute on","ContentProtection element",e),null;if(t=t.toLowerCase(),n&&(n=n.replace(/-/g,"").toLowerCase()).includes(" "))throw new Y(2,4,4009);var r=[];try{r=i.map(function(e){return{initDataType:"cenc",initData:Se.Fa(e),keyId:null}})}catch(e){throw new Y(2,4,4007)}return{node:e,Ae:t,keyId:n,init:0<r.length?r:null}}(n.value))&&t.push(n);return t}(e),r=null;e=[];var a=[],o=new Set(i.map(function(e){return e.keyId}));if(o.delete(null),1<o.size)throw new Y(2,4,4010);if(n||(a=i.filter(function(e){return"urn:mpeg:dash:mp4protection:2011"!=e.Ae||(r=e.init||r,!1)})).length&&(0==(e=function(e,t,n){for(var i,r=[],a=(n=F(n)).next();!a.done;a=n.next()){a=a.value;var o,s,u,c,l,d,f=Bi.get(a.Ae);if(f)i=(i=Ki.Wc(a.node,"urn:microsoft:playready","pro"))?(i=Se.Fa(i.textContent),o=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),s=i.length,u=o.length+16+s,c=new ArrayBuffer(u),l=new Uint8Array(c),c=new DataView(c),d=0,c.setUint32(0,u),d+=4,c.setUint32(4,1886614376),d+=4,c.setUint32(8,0),d+=4,l.set(o,12),d+=o.length,c.setUint32(d,s),d+=4,l.set(i,d),[{initData:l,initDataType:"cenc",keyId:a.keyId}]):null,i=de(f,a.init||e||i),(f=Vi.get(f))&&(i.licenseServerUri=f(a)),r.push(i);else for(a=t(a.node)||[],a=F(a),f=a.next();!f.done;f=a.next())r.push(f.value)}return r}(r,t,a)).length&&(e=[de("",r)])),i.length&&(n||!a.length))for(e=[],n=(t=F(Bi.values())).next();!n.done;n=t.next())"org.w3.clearkey"!=(n=n.value)&&e.push(de(n,r));if(o=Array.from(o)[0]||null)for(n=(t=F(e)).next();!n.done;n=t.next())for(i=(n=F(n.value.initData)).next();!i.done;i=n.next())i.value.keyId=o;return{Xd:o,Pg:r,drmInfos:e,be:!0}}var Hi,Vi=(new Map).set("com.widevine.alpha",function(e){return(e=Ki.Wc(e.node,"urn:microsoft","laurl"))&&e.getAttribute("licenseUrl")||""}).set("com.microsoft.playready",function(e){return(e=Ki.Wc(e.node,"urn:microsoft:playready","pro"))&&(e=function(e){var t=0,n=new DataView(e).getUint32(t,!0);if(t+=4,n!==e.byteLength)return X.m("PlayReady Object with invalid length encountered."),[];t+=2,n=[];for(var i=new DataView(e);t<e.byteLength-1;){var r=i.getUint16(t,!0);t+=2;var a=i.getUint16(t,!0);t+=2;var o=new Uint8Array(e,t,a);n.push({type:r,value:o}),t+=a}return n}((e=Se.Fa(e.textContent)).buffer).filter(function(e){return 1===e.type})[0])?(e=ge(e.value,!0),(e=Ki.ue(e,"WRMHEADER"))?function(e){for(var t=(e=F(e.getElementsByTagName("DATA"))).next();!t.done;t=e.next())for(var n=(t=F(t.value.childNodes)).next();!n.done;n=t.next())if((n=n.value)instanceof Element&&"LA_URL"==n.tagName)return n.textContent;return""}(e):""):""});function qi(a,e,t,n,i){var o={RepresentationID:e,Number:t,Bandwidth:n,Time:i};return a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(e,t,n,i){if("$$"==e)return"$";var r=o[t];if(null==r)return X.m("URL template does not have an available substitution for identifier",'"'+t+'":',a),e;switch("RepresentationID"==t&&n&&(X.m("URL template should not contain a width specifier for identifier",'"RepresentationID":',a),n=void 0),"Time"==t&&(r=Math.round(r)),i){case void 0:case"d":case"i":case"u":e=r.toString();break;case"o":e=r.toString(8);break;case"x":e=r.toString(16);break;case"X":e=r.toString(16).toUpperCase();break;default:e=r.toString()}return n=d.parseInt(n,10)||1,Array(Math.max(0,n-e.length)+1).join("0")+e})}function Gi(e,t){var n=Wi(e,t,"timescale"),i=1;n&&(i=Ki.Bc(n)||1),n=Wi(e,t,"duration"),(n=Ki.Bc(n||""))&&(n/=i);var r=Wi(e,t,"startNumber"),a=Number(Wi(e,t,"presentationTimeOffset"))||0,o=Ki.Hb(r||"");null!=r&&null!=o||(o=1);r=null;if(u=zi(e,t,"SegmentTimeline")){r=i;for(var s=e.W.duration||1/0,u=Ki.U(u,"S"),c=[],l=-a,d=0;d<u.length;++d){var f=u[d],h=Ki.M(f,"t",Ki.Hb),p=Ki.M(f,"d",Ki.Hb),m=Ki.M(f,"r",Ki.parseInt);if(null!=h&&(h-=a),!p){X.m('"S" element must have a duration:','ignoring the remaining "S" elements.',f);break}if(h=null!=h?h:l,(m=m||0)<0)if(d+1<u.length){if(null==(m=Ki.M(u[d+1],"t",Ki.Hb))){X.m('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',f);break}if(m<=h){X.m('An "S" element cannot have a negative repeat','if its start time exceeds the next "S" element\'s start time:','ignoring the remaining "S" elements.',f);break}m=Math.ceil((m-h)/p)-1}else{if(1/0==s){X.m('The last "S" element cannot have a negative repeat',"if the Period has an infinite duration:",'ignoring the last "S" element.',f);break}if(s<=h/r){X.m('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',f);break}m=Math.ceil((s*r-h)/p)-1}for(0<c.length&&h!=l&&(Math.abs((h-l)/r)>=he&&X.m("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",f),c[c.length-1].end=h/r),f=0;f<=m;++f)l=h+p,c.push({start:h/r,end:l/r,Hg:h}),h=l}r=c}return{timescale:i,da:n,ib:o,oa:a/i||0,Pd:a,S:r}}function Wi(e,t,n){return[t(e.A),t(e.aa),t(e.ma)].filter(ce.Na).map(function(e){return e.getAttribute(n)}).reduce(function(e,t){return e||t})}function zi(e,t,n){return[t(e.A),t(e.aa),t(e.ma)].filter(ce.Na).map(function(e){return Ki.oc(e,n)}).reduce(function(e,t){return e||t})}function Xi(e,t,n,i,r,a){if(a=void 0===a?0:a,Ki.getAttributeNS(e,"http://www.w3.org/1999/xlink","href")){var o=function(r,a,o,e,s,u){for(var c=Ki.getAttributeNS(r,"http://www.w3.org/1999/xlink","href"),t=Ki.getAttributeNS(r,"http://www.w3.org/1999/xlink","actuate")||"onRequest",n=0;n<r.attributes.length;n++){var i=r.attributes[n];"http://www.w3.org/1999/xlink"==i.namespaceURI&&(r.removeAttributeNS(i.namespaceURI,i.localName),--n)}if(5<=u)return Ne(new Y(2,4,4028));if("onLoad"!=t)return Ne(new Y(2,4,4027));var l=le([e],[c]);return s.request(0,Ye(l,a)).Y(function(e){if(!(e=Ki.te(e.data,r.tagName)))return Ne(new Y(2,4,4001,c));for(;r.childNodes.length;)r.removeChild(r.childNodes[0]);for(;e.childNodes.length;){var t=e.childNodes[0];e.removeChild(t),r.appendChild(t)}for(t=0;t<e.attributes.length;t++){var n=e.attributes[t].nodeName,i=e.getAttribute(n);r.setAttribute(n,i)}return Xi(r,a,o,l[0],s,u+1)})}(e,t,n,i,r,a);return n&&(o=o.Y(void 0,function(){return Xi(e,t,n,i,r,a)})),o}o=[];for(var s=0;s<e.childNodes.length;s++){var u=e.childNodes[s];u instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==Ki.getAttributeNS(u,"http://www.w3.org/1999/xlink","href")?(e.removeChild(u),--s):"SegmentTimeline"!=u.tagName&&o.push(Xi(u,t,n,i,r,a)))}return _e(o).Y(function(){return e})}function Yi(e,t,n){this.c=e,this.b=t,this.a=n}function $i(e,t,n,i,r,a){this.position=e,this.startTime=t,this.endTime=n,this.c=i,this.b=r,this.a=a}function Ji(e,t,n,i){var r,a=(new Ri).ia("sidx",function(e){r=function(e,t,n,i){var r=[];i.reader.P(4);var a=i.reader.I();if(0==a)throw X.error("Invalid timescale."),new Y(2,3,3005);{var o,s;s=0==i.version?(o=i.reader.I(),i.reader.I()):(o=i.reader.Kb(),i.reader.Kb())}i.reader.P(2);var u=i.reader.$b();for(e=e+i.size+s,s=0;s<u;s++){var c=i.reader.I(),l=(2147483648&c)>>>31;c&=2147483647;var d=i.reader.I();if(i.reader.P(4),1==l)throw X.error("Heirarchical SIDXs are not supported."),new Y(2,3,3006);r.push(new $i(r.length,o/a-t,(o+d)/a-t,function(){return n},e,e+c-1)),o+=d,e+=c}return i.parser.stop(),r}(t,i,n,e)});if(e&&a.parse(e),r)return r;throw X.error('Invalid box type, expected "sidx".'),new Y(2,3,3004)}function Qi(e){this.a=e}function Zi(e,t){for(;e.a.length&&e.a[e.a.length-1].startTime>=t;)e.a.pop();for(;e.a.length&&e.a[0].endTime<=0;)e.a.shift();var n;0!=e.a.length&&(n=e.a[e.a.length-1],e.a[e.a.length-1]=new $i(n.position,n.startTime,t,n.c,n.b,n.a))}function er(e){this.b=e,this.a=new Ii(e,0),Hi=Hi||[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])]}function tr(e){var t=nr(e);if(7<t.length)throw new Y(2,3,3002);for(var n=0,i=0;i<t.length;i++)n=256*n+t[i];t=n,n=nr(e);e:{i=Se.Da;for(var r=0;r<Hi.length;r++)if(i(n,Hi[r])){i=!0;break e}i=!1}if(i)n=e.b.byteLength-e.a.ga();else{if(8==n.length&&224&n[1])throw new Y(2,3,3001);for(i=n[0]&(1<<8-n.length)-1,r=1;r<n.length;r++)i=256*i+n[r];n=i}return n=e.a.ga()+n<=e.b.byteLength?n:e.b.byteLength-e.a.ga(),i=new DataView(e.b.buffer,e.b.byteOffset+e.a.ga(),n),e.a.P(n),new ir(t,i)}function nr(e){for(var t=e.a.na(),n=1;n<=8&&!(t&1<<8-n);n++);if(8<n)throw new Y(2,3,3002);var i=new Uint8Array(n);for(i[0]=t,t=1;t<n;t++)i[t]=e.a.na();return i}function ir(e,t){this.id=e,this.a=t}function rr(e){if(8<e.a.byteLength)throw new Y(2,3,3002);if(8==e.a.byteLength&&224&e.a.getUint8(0))throw new Y(2,3,3001);for(var t=0,n=0;n<e.a.byteLength;n++)t=256*t+e.a.getUint8(n);return t}function ar(){}function or(e,t){var n=zi(e,t,"Initialization");if(!n)return null;var i=e.A.ta,t=n.getAttribute("sourceURL");t&&(i=le(e.A.ta,[t])),t=0;e=null;return(n=Ki.M(n,"range",Ki.Cc))&&(t=n.start,e=n.end),new Yi(function(){return i},t,e)}function sr(e,t,n,i,r,a,o,s){var u=e.presentationTimeline,c=!e.tb||!e.W.hd,l=e.W.start,d=e.W.duration,f=t,h=null;return{createSegmentIndex:function(){var e=[f(i,r,a),"webm"==o?f(n.c(),n.b,n.a):null];return f=null,Promise.all(e).then(function(e){var t=e[0];e=e[1]||null,t="mp4"==o?Ji(t,r,i,s):(new ar).parse(t,e,i,s),u.Eb(t,l),h=new Qi(t),c&&Zi(h,d)})},findSegmentPosition:function(e){return h.find(e)},getSegmentReference:function(e){return h.get(e)}}}function ur(e){return e.ac}function cr(e,t){var n,i=or(e,lr),r=[(n=e).A.Qa,n.aa.Qa,n.ma.Qa].filter(ce.Na).map(function(e){return Ki.U(e,"SegmentURL")}).reduce(function(e,t){return 0<e.length?e:t}).map(function(e){return e.getAttribute("indexRange")&&!n.he&&(n.he=!0,X.m("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate.")),{Kf:e.getAttribute("media"),start:(e=Ki.M(e,"mediaRange",Ki.Cc,{start:0,end:null})).start,end:e.end}}),a=Gi(e,lr),o=a.ib;0==o&&(X.m("SegmentList@startNumber must be > 0"),o=1);var s=0;if(a.da?s=a.da*(o-1):a.S&&0<a.S.length&&(s=a.S[0].start),!(r={da:a.da,startTime:s,ib:o,oa:a.oa,S:a.S,cb:r}).da&&!r.S&&1<r.cb.length)throw X.m("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",e.A),new Y(2,4,4002);if(!r.da&&!e.W.duration&&!r.S&&1==r.cb.length)throw X.m("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",e.A),new Y(2,4,4002);if(r.S&&0==r.S.length)throw X.m("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",e.A),new Y(2,4,4002);return o=a=null,e.ma.id&&e.A.id&&(a=t[o=e.ma.id+","+e.A.id]),s=function(e,t,n,i){var r=i.cb.length;i.S&&i.S.length!=i.cb.length&&(r=Math.min(i.S.length,i.cb.length),X.m("The number of items in the segment timeline and the number of segment","URLs do not match, truncating",i.cb.length,"to",r));for(var a=[],o=i.startTime,s=0;s<r;s++){var u=i.cb[s],c=le(n,[u.Kf]),l=void 0;l=null!=i.da?o+i.da:i.S?i.S[s].end:o+e,a.push(new $i(s+t,o,l,function(e){return e}.bind(null,c),u.start,u.end)),o=l}return a}(e.W.duration,r.ib,e.A.ta,r),a?(a.md(s),o=e.presentationTimeline.Wb(),a.Tc(o-e.W.start)):(e.presentationTimeline.Eb(s,e.W.start),a=new Qi(s),o&&e.tb&&(t[o]=a)),e.tb&&e.W.hd||Zi(a,e.W.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:a.find.bind(a),getSegmentReference:a.get.bind(a),initSegmentReference:i,oa:r.oa}}function lr(e){return e.Qa}function dr(e,t,n,i){var r,a,o,s,u,c,l,d,f,h,p=function(e){var t=Wi(e,fr,"initialization");if(!t)return null;var n=e.A.id,i=e.bandwidth||null,r=e.A.ta;return new Yi(function(){var e=qi(t,n,null,i,null);return le(r,[e])},0,null)}(e),m=Gi(e,fr),g=Wi(e,fr,"media"),v=Wi(e,fr,"index"),g=(m={da:m.da,timescale:m.timescale,ib:m.ib,oa:m.oa,Pd:m.Pd,S:m.S,kd:g,Yb:v}).Yb?1:0;if(g+=m.S?1:0,0==(g+=m.da?1:0))throw X.error("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",e.A),new Y(2,4,4002);if(1!=g&&(X.m("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",e.A),m.Yb?(X.info("Using the index URL template by default."),m.S=null):X.info("Using the SegmentTimeline by default."),m.da=null),!m.Yb&&!m.kd)throw X.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",e.A),new Y(2,4,4002);if(m.Yb){if("mp4"!=(n=e.A.mimeType.split("/")[1])&&"webm"!=n)throw X.error("SegmentTemplate specifies an unsupported container type.",e.A),new Y(2,4,4006);if("webm"==n&&!p)throw X.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate uses a WebM container,","but does not contain an initialization URL template.",e.A),new Y(2,4,4005);i=qi(m.Yb,e.A.id,null,e.bandwidth||null,null),e=sr(e,t,p,i=le(e.A.ta,[i]),0,null,n,m.oa)}else e=m.da?(i||(e.presentationTimeline.od(m.da),e.presentationTimeline.pd(e.W.start)),a=m,o=(r=e).W.duration,s=a.da,u=a.ib,c=a.timescale,l=a.kd,d=r.bandwidth||null,f=r.A.id,h=r.A.ta,{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return e<0||o&&o<=e?null:Math.floor(e/s)},getSegmentReference:function(t){var n=t*s,e=n+s;return o&&(e=Math.min(e,o)),e<0||o&&o<=n?null:new $i(t,n,e,function(){var e=qi(l,f,t+u,d,n*c);return le(h,[e])},0,null)}}):(g=t=null,e.ma.id&&e.A.id&&(t=n[g=e.ma.id+","+e.A.id]),v=function(e,t){for(var n=[],i=0;i<t.S.length;i++){var r=i+t.ib;n.push(new $i(r,t.S[i].start,t.S[i].end,function(e,t,n,i,r,a){return le(i,[e=qi(e,t,r,n,a)]).map(function(e){return e.toString()})}.bind(null,t.kd,e.A.id,e.bandwidth||null,e.A.ta,r,t.S[i].Hg+t.Pd),0,null))}return n}(e,m),i=!e.tb||!e.W.hd,t?(i&&Zi(new Qi(v),e.W.duration),t.md(v),n=e.presentationTimeline.Wb(),t.Tc(n-e.W.start)):(e.presentationTimeline.Eb(v,e.W.start),t=new Qi(v),g&&e.tb&&(n[g]=t)),i&&Zi(t,e.W.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:t.find.bind(t),getSegmentReference:t.get.bind(t)});return{createSegmentIndex:e.createSegmentIndex,findSegmentPosition:e.findSegmentPosition,getSegmentReference:e.getSegmentReference,initSegmentReference:p,oa:m.oa}}function fr(e){return e.cc}L("shaka.media.InitSegmentReference",Yi),Yi.prototype.createUris=Yi.prototype.Qc=function(){return this.c()},Yi.prototype.getStartByte=Yi.prototype.bd=function(){return this.b},Yi.prototype.getEndByte=Yi.prototype.ad=function(){return this.a},L("shaka.media.SegmentReference",$i),$i.prototype.getPosition=$i.prototype.ga=function(){return this.position},$i.prototype.getStartTime=$i.prototype.sc=function(){return this.startTime},$i.prototype.getEndTime=$i.prototype.gf=function(){return this.endTime},$i.prototype.createUris=$i.prototype.Qc=function(){return this.c()},$i.prototype.getStartByte=$i.prototype.bd=function(){return this.b},$i.prototype.getEndByte=$i.prototype.ad=function(){return this.a},L("shaka.media.SegmentIndex",Qi),Qi.prototype.destroy=function(){return this.a=null,Promise.resolve()},Qi.prototype.find=function(e){for(var t=this.a.length-1;0<=t;--t){var n=this.a[t];if(e>=n.startTime&&e<n.endTime)return n.position}return this.a.length&&e<this.a[0].startTime?this.a[0].position:null},Qi.prototype.get=function(e){return 0==this.a.length||(e-=this.a[0].position)<0||e>=this.a.length?null:this.a[e]},Qi.prototype.offset=function(e){for(var t=0;t<this.a.length;++t)this.a[t].startTime+=e,this.a[t].endTime+=e},Qi.prototype.merge=Qi.prototype.md=function(e){for(var t=[],n=0,i=0;n<this.a.length&&i<e.length;){var r=this.a[n],a=e[i];r.startTime<a.startTime?(t.push(r),n++):(r.startTime>a.startTime?0==n?t.push(a):X.m("Refusing to rewrite original references on update!"):(.1<Math.abs(r.endTime-a.endTime)?t.push(new $i(r.position,a.startTime,a.endTime,a.c,a.b,a.a)):t.push(r),n++),i++)}for(;n<this.a.length;)t.push(this.a[n++]);if(t.length)for(n=t[t.length-1].position+1;i<e.length;)r=new $i(n++,(r=e[i++]).startTime,r.endTime,r.c,r.b,r.a),t.push(r);else t=e;this.a=t},Qi.prototype.evict=Qi.prototype.Tc=function(e){for(var t=0;t<this.a.length;++t)if(this.a[t].endTime>e)return void this.a.splice(0,t);this.a=[]},er.prototype.ya=function(){return this.a.ya()},ar.prototype.parse=function(e,t,n,i){var r;if(440786851!=tr(t=new er(new DataView(t))).id)throw X.error("Not an EBML element."),new Y(2,3,3008);var a=tr(t);if(408125543!=a.id)throw X.error("Not a Segment element."),new Y(2,3,3009);for(t=a.a.byteOffset,a=new er(a.a),r=null;a.ya();){var o=tr(a);if(357149030==o.id){r=o;break}}if(!r)throw X.error("Not an Info element."),new Y(2,3,3010);for(a=new er(r.a),r=1e6,o=null;a.ya();){var s=tr(a);if(2807729==s.id)r=rr(s);else if(17545==s.id)if(4==(o=s).a.byteLength)o=o.a.getFloat32(0);else{if(8!=o.a.byteLength)throw new Y(2,3,3003);o=o.a.getFloat64(0)}}if(null==o)throw new Y(2,3,3011);if(r=o*(a=r/1e9),475249515!=(e=tr(new er(new DataView(e)))).id)throw X.error("Not a Cues element."),new Y(2,3,3007);return function(e,t,n,i,r,a){function o(){return r}var s=[];e=new er(e.a);for(var u=null,c=null;e.ya();){var l,d=tr(e);187!=d.id||(l=function(e){var t=new er(e.a);if(179!=(e=tr(t)).id)throw X.m("Not a CueTime element."),new Y(2,3,3013);if(e=rr(e),183!=(t=tr(t)).id)throw X.m("Not a CueTrackPositions element."),new Y(2,3,3012);t=new er(t.a);for(var n=0;t.ya();){var i=tr(t);if(241==i.id){n=rr(i);break}}return{Ig:e,hg:n}}(d))&&(d=n*l.Ig,l=t+l.hg,null!=u&&s.push(new $i(s.length,u-a,d-a,o,c,l-1)),u=d,c=l)}return null!=u&&s.push(new $i(s.length,u-a,i-a,o,c,null)),s}(e,t,a,r,n,i)};var hr={Ib:{},Zb:{},zd:function(e,t){hr.Zb[e]=t}};function pr(e,t,n){this.f=e,this.Dc=t,this.h=this.g=1/0,this.a=1,this.b=this.c=null,this.l=0,this.o=!0,this.i=0,this.u=void 0===n||n}function mr(e,t,n,i){return e=Ye(e,i),0==t&&null==n||(e.headers.Range=n?"bytes="+t+"-"+n:"bytes="+t+"-"),e}function gr(){var e=this;this.b=this.a=null,this.f=[],this.c=null,this.l=[],this.h=1,this.o={},this.u=0,this.v=new _(5),this.i=new Me(function(){var i;i=e,H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return X.info("Updating manifest..."),t=0,q(e,2),V(e,vr(i),4);case 4:t=e.s,G(e,3);break;case 2:n=W(e),i.b&&(n.severity=1,i.b.onError(n));case 3:if(!i.b)return e.return();yr(i,t),I(e)}})})}),this.g=new qe}function vr(t){var n=Date.now(),e=t.b.networkingEngine.request(0,Ye(t.f,t.a.retryParameters));return Ge(t.g,e),e.promise.then(function(e){if(t.b)return e.uri&&!t.f.includes(e.uri)&&t.f.unshift(e.uri),function(t,e,n){if(!(e=Ki.te(e,"MPD")))throw new Y(2,4,4001,n);return e=Xi(e,t.a.retryParameters,t.a.dash.xlinkFailGracefully,n,t.b.networkingEngine),Ge(t.g,e),e.promise.then(function(e){return k=t,A=e,M=n,H(function e(){var f,h,p,m,g,v,b,y,w,T,S,E,x;return z(e,function(e){switch(e.j){case 1:m=ce,b=[M],0<(g=(f=Ki).U(A,"Location").map(f.qc).filter(m.Na)).length&&(v=le(b,g),b=k.f=v),y=f.U(A,"BaseURL").map(f.qc),h=le(b,y),w=k.a.dash.ignoreMinBufferTime,p=0,w||(p=f.M(A,"minBufferTime",f.Ia)),k.u=f.M(A,"minimumUpdatePeriod",f.Ia,-1),m=f.M(A,"availabilityStartTime",f.ag),g=f.M(A,"timeShiftBufferDepth",f.Ia),v=f.M(A,"maxSegmentDuration",f.Ia),b=A.getAttribute("type")||"static",y=k.a.dash.ignoreSuggestedPresentationDelay,w=null,y||(w=f.M(A,"suggestedPresentationDelay",f.Ia)),w=k.c?k.c.presentationTimeline:(T=Math.max(k.a.dash.defaultPresentationDelay,1.5*p),new pr(m,null!=w?w:T,k.a.dash.autoCorrectDrift));for(var t={tb:"static"!=b,presentationTimeline:w,ma:null,W:null,aa:null,A:null,bandwidth:0,he:!1},n=h,i=Ki.M(A,"mediaPresentationDuration",Ki.Ia),r=[],a=0,o=Ki.U(A,"Period"),s=0;s<o.length;s++){var u,c=o[s],a=Ki.M(c,"start",Ki.Ia,a),l=Ki.M(c,"duration",Ki.Ia),d=null;if(s!=o.length-1?null!=(u=Ki.M(o[s+1],"start",Ki.Ia))&&(d=u-a):null!=i&&(d=i-a),u=he,d&&l&&Math.abs(d-l)>u&&X.m("There is a gap/overlap between Periods",c),null==d&&(d=l),c=function(e,t,n,i){if(t.ma=wr(i.node,null,n),t.W=i,t.ma.id||(X.info("No Period ID given for Period with start time "+i.start+",  Assigning a default"),t.ma.id="__shaka_period_"+i.start),Ki.U(i.node,"EventStream").forEach(e.bg.bind(e,i.start,i.duration)),n=Ki.U(i.node,"AdaptationSet").map(e.$f.bind(e,t)).filter(ce.Na),t.tb){t=[];for(var r=F(n),a=r.next();!a.done;a=r.next())for(var o=(a=F(a.value.kg)).next();!o.done;o=a.next())t.push(o.value);if(t.length!=new Set(t).size)throw new Y(2,4,4018)}var s=n.filter(function(e){return!e.Nd});if(n.filter(function(e){return e.Nd}).forEach(function(n){var t=n.Nd.split(" ");s.forEach(function(e){t.includes(e.id)&&e.streams.forEach(function(t){t.trickModeVideo=n.streams.find(function(e){return ct(t.codecs)[0]==ct(e.codecs)[0]})})})}),t=br(s,"video"),r=br(s,"audio"),!t.length&&!r.length)throw new Y(2,4,4004);n=e.a.disableAudio,r.length&&!n||(r=[null]);n=e.a.disableVideo,t.length&&!n||(t=[null]);for(n=[],a=0;a<r.length;a++)for(o=0;o<t.length;o++)!function(e,t,n,i){if(t||n)if(t&&n){var r=t.drmInfos,a=n.drmInfos;if(!r.length||!a.length||0<_t(r,a).length){a=_t(t.drmInfos,n.drmInfos);for(var o=0;o<t.streams.length;o++)for(var s=0;s<n.streams.length;s++)r=(n.streams[s].bandwidth||0)+(t.streams[o].bandwidth||0),r={id:e.h++,language:t.language,primary:t.jd||n.jd,audio:t.streams[o],video:n.streams[s],bandwidth:r,drmInfos:a,allowedByApplication:!0,allowedByKeySystem:!0},i.push(r)}}else for(a=t||n,o=0;o<a.streams.length;o++)r=a.streams[o].bandwidth||0,r={id:e.h++,language:a.language||"und",primary:a.jd,audio:t?a.streams[o]:null,video:n?a.streams[o]:null,bandwidth:r,drmInfos:a.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},i.push(r)}(e,r[a],t[o],n);if(t=[],!e.a.disableText)for(e=br(s,"text"),r=0;r<e.length;r++)t.push.apply(t,e[r].streams);return{startTime:i.start,textStreams:t,variants:n}}(k,t,n,{start:a,duration:d,node:c,hd:null==d||s==o.length-1}),r.push(c),l=t.ma.id,k.l.includes(l)||(k.l.push(l),k.c&&(k.b.filterNewPeriod(c),k.c.periods.push(c))),null==d){s!=o.length-1&&X.m("Skipping Period",s+1,"and any subsequent Periods:","Period",s+1,"does not have a valid start time.",r[s+1]),a=null;break}a+=d}if(null==k.c&&k.b.filterAllPeriods(r),T=null!=i?(a!=i&&X.m("@mediaPresentationDuration does not match the total duration of all","Periods."),E=r,S=i,!1):(E=r,S=a,!0),S=S,E=E,w.dc("static"==b),"static"!=b&&T||w.Ba(S||1/0),w.X()&&!isNaN(k.a.availabilityWindowOverride)&&(g=k.a.availabilityWindowOverride),null==g&&(g=1/0),w.Jd(g),w.od(v||1),k.c){e.C(0);break}if(k.c={presentationTimeline:w,periods:E,offlineSessionIds:[],minBufferTime:p||0},w.Ie())return x=f.U(A,"UTCTiming"),V(e,function(e,n,t){t=t.map(function(e){return{scheme:e.getAttribute("schemeIdUri"),value:e.getAttribute("value")}});var i=e.a.dash.clockSyncUri;return!t.length&&i&&t.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:i}),ce.Ye(t,function(e){var t=e.scheme;switch(e=e.value,t){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return Tr(this,n,e,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return Tr(this,n,e,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return t=Date.parse(e),isNaN(t)?0:t-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return X.Z("NTP UTCTiming scheme is not supported"),Promise.reject();default:return X.Z("Unrecognized scheme in UTCTiming element",t),Promise.reject()}}.bind(e)).catch(function(){return X.Z("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),0})}(k,h,x),4);e.C(0);break;case 4:if(x=e.s,!k.b)return e.return();w.De(x),I(e)}})});var k,A,M})}(t,e.data,e.uri)}).then(function(){var e=(Date.now()-n)/1e3;return O(t.v,1,e),e})}function br(e,t){return e.filter(function(e){return e.contentType==t})}function yr(e,t){e.u<0||e.i.R(Math.max(3,e.u-t,j(e.v)))}function wr(e,t,n){t=t||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,qd:null,audioSamplingRate:null},n=n||t.ta;for(var i=Ki.Hb,r=Ki.$e,a=Ki.U(e,"BaseURL").map(Ki.qc),o=e.getAttribute("contentType")||t.contentType,s=e.getAttribute("mimeType")||t.mimeType,u=e.getAttribute("codecs")||t.codecs,r=Ki.M(e,"frameRate",r)||t.frameRate,c=e.getAttribute("sar")||t.pixelAspectRatio,l=Ki.U(e,"InbandEventStream"),d=t.emsgSchemeIdUris.slice(),f=(l=F(l)).next();!f.done;f=l.next())f=f.value.getAttribute("schemeIdUri"),d.includes(f)||d.push(f);return l=function(e){for(var t=0;t<e.length;++t){var n=e[t],i=n.getAttribute("schemeIdUri");if(i&&(n=n.getAttribute("value")))switch(i){case"urn:mpeg:dash:outputChannelPositionList:2012":return n.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":var r=parseInt(n,10);if(r)return r;X.m("Channel parsing failure! Ignoring scheme and value",i,n);continue;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(!(r=parseInt(n,16))){X.m("Channel parsing failure! Ignoring scheme and value",i,n);continue}for(e=0;r;)1&r&&++e,r>>=1;return e;default:X.m("Unrecognized audio channel scheme:",i,n)}}return null}(l=Ki.U(e,"AudioChannelConfiguration"))||t.qd,f=Ki.M(e,"audioSamplingRate",i)||t.audioSamplingRate,o=o||Sr(s,u),{ta:le(n,a),ac:Ki.oc(e,"SegmentBase")||t.ac,Qa:Ki.oc(e,"SegmentList")||t.Qa,cc:Ki.oc(e,"SegmentTemplate")||t.cc,width:Ki.M(e,"width",i)||t.width,height:Ki.M(e,"height",i)||t.height,contentType:o,mimeType:s,codecs:u,frameRate:r,pixelAspectRatio:c,emsgSchemeIdUris:d,id:e.getAttribute("id"),qd:l,audioSamplingRate:f}}function Tr(e,t,n,i){return(t=Ye(t=le(t,[n]),e.a.retryParameters)).method=i,t=e.b.networkingEngine.request(4,t),Ge(e.g,t),t.promise.then(function(e){if("HEAD"==i){if(!e.headers||!e.headers.date)return X.m("UTC timing response is missing","expected date header"),0;e=e.headers.date}else e=me(e.data);return e=Date.parse(e),isNaN(e)?(X.m("Unable to parse date from UTC timing response"),0):e-Date.now()})}function Sr(e,t){return mn(ut(e,t))?"text":e.split("/")[0]}function Er(e,t,n,i){this.b=e,this.type=t,this.a=n,this.segments=i||null}function xr(e,t,n,i){this.id=e,this.name=t,this.a=n,this.value=void 0===i?null:i}function kr(e,t){this.name=e,this.value=t}function Ar(e,t,n){return(e=e.getAttribute(t))?e.value:n||null}function Mr(e,t){this.b=t,this.a=e}L("shaka.media.ManifestParser.registerParserByExtension",hr.zd),hr.Lb=function(e,t){hr.Ib[e]=t},L("shaka.media.ManifestParser.registerParserByMime",hr.Lb),hr.eg=function(){var e={};if(dt()){for(var t in hr.Ib)e[t]=!0;for(var n in hr.Zb)e[n]=!0}t={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var i,r=(n=F(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!r.done;r=n.next())e[r=r.value]=dt()?!!hr.Ib[r]:ft(r);for(i in t)e[i]=dt()?!!hr.Zb[i]:ft(t[i]);return e},hr.create=function(n,i,r,a){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return q(e,2),V(e,hr.hf(n,i,r,a),4);case 4:return t=e.s,e.return(new t);case 2:throw(t=W(e)).severity=2,t}})})},hr.hf=function(r,a,o,s){return H(function e(){var t,n,i;return z(e,function(e){switch(e.j){case 1:if(i=hr,s){if(n=i.Ib[s.toLowerCase()])return e.return(n);X.m("Could not determine manifest type using MIME type ",s)}if(t=i.getExtension(r)){if(n=i.Zb[t])return e.return(n);X.m("Could not determine manifest type for extension ",t)}else X.m("Could not find extension for ",r);if(s){e.C(2);break}return V(e,i.rf(r,a,o),3);case 3:if(s=e.s){if(i=hr.Ib[s])return e.return(i);X.m("Could not determine manifest type using MIME type",s)}case 2:throw new Y(2,4,4e3,r)}})})},hr.rf=function(n,i,r){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return(t=Ye([n],r)).method="HEAD",V(e,i.request(0,t).promise,2);case 2:return t=e.s,t=t.headers["content-type"],e.return(t?t.toLowerCase().split(";").shift():"")}})})},hr.getExtension=function(e){return 1==(e=new $(e).la.split("/").pop().split(".")).length?"":e.pop().toLowerCase()},hr.isSupported=function(e,t){return!!dt()&&(t in hr.Ib||hr.getExtension(e)in hr.Zb)},L("shaka.media.PresentationTimeline",pr),pr.prototype.getDuration=pr.prototype.ca=function(){return this.g},pr.prototype.getMaxSegmentDuration=pr.prototype.pf=function(){return this.a},pr.prototype.setDuration=pr.prototype.Ba=function(e){this.g=e},pr.prototype.getPresentationStartTime=pr.prototype.xf=function(){return this.f},pr.prototype.setClockOffset=pr.prototype.De=function(e){this.l=e},pr.prototype.setStatic=pr.prototype.dc=function(e){this.o=e},pr.prototype.setSegmentAvailabilityDuration=pr.prototype.Jd=function(e){this.h=e},pr.prototype.setDelay=pr.prototype.sg=function(e){this.Dc=e},pr.prototype.getDelay=pr.prototype.ff=function(){return this.Dc},pr.prototype.notifySegments=pr.prototype.Eb=function(e,t){var n;0!=e.length&&(n=e[e.length-1].endTime+t,this.pd(e[0].startTime+t),this.a=e.reduce(function(e,t){return Math.max(e,t.endTime-t.startTime)},this.a),this.b=Math.max(this.b,n),null!=this.f&&this.u&&(this.f=(Date.now()+this.l)/1e3-this.b-this.a),X.F("notifySegments:","maxSegmentDuration="+this.a))},pr.prototype.notifyMinSegmentStartTime=pr.prototype.pd=function(e){this.c=null==this.c?e:Math.min(this.c,e)},pr.prototype.notifyMaxSegmentDuration=pr.prototype.od=function(e){this.a=Math.max(this.a,e),X.F("notifyNewSegmentDuration:","maxSegmentDuration="+this.a)},pr.prototype.offset=function(e){null!=this.c&&(this.c+=e),null!=this.b&&(this.b+=e)},pr.prototype.isLive=pr.prototype.X=function(){return 1/0==this.g&&!this.o},pr.prototype.isInProgress=pr.prototype.bb=function(){return 1/0!=this.g&&!this.o},pr.prototype.getSegmentAvailabilityStart=pr.prototype.Wb=function(){if(1/0==this.h)return this.i;var e=this.xb()-this.h;return Math.max(this.i,e)},pr.prototype.setUserSeekStart=pr.prototype.Ee=function(e){this.i=e},pr.prototype.getSegmentAvailabilityEnd=pr.prototype.xb=function(){return this.X()||this.bb()?Math.min(Math.max(0,(Date.now()+this.l)/1e3-this.a-this.f),this.g):this.g},pr.prototype.getSafeSeekRangeStart=pr.prototype.Vb=function(e){var t=Math.max(this.c,this.i);if(1/0==this.h)return t;var n=this.xb()-this.h;return e=Math.min(n+e,this.Ga()),Math.max(t,e)},pr.prototype.getSeekRangeStart=pr.prototype.wb=function(){return this.Vb(0)},pr.prototype.getSeekRangeEnd=pr.prototype.Ga=function(){var e=this.X()||this.bb()?this.Dc:0;return Math.max(0,this.xb()-e)},pr.prototype.usingPresentationStartTime=pr.prototype.Ie=function(){return!(null==this.f||null!=this.b&&this.u)},L("shaka.dash.DashParser",gr),(e=gr.prototype).configure=function(e){this.a=e},e.start=function(n,i){var r=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return r.f=[n],r.b=i,V(e,vr(r),2);case 2:if(t=e.s,r.b&&yr(r,t),!r.b)throw new Y(2,7,7001);return e.return(r.c)}})})},e.stop=function(){return this.a=this.b=null,this.f=[],this.c=null,this.l=[],this.o={},null!=this.i&&(this.i.stop(),this.i=null),this.g.destroy()},e.update=function(){vr(this).catch(function(e){this.b&&this.b.onError(e)}.bind(this))},e.onExpirationUpdated=function(){},e.$f=function(t,e){if(t.aa=wr(e,t.ma,null),"image"==t.aa.contentType)return X.m("Skipping Image AdaptationSet",t.aa),null;var n=!1,i=(d=Ki.U(e,"Role")).map(function(e){return e.getAttribute("value")}).filter(ce.Na),r=void 0,a="text"==t.aa.contentType;a&&(r="subtitle");for(var o=0;o<d.length;o++){var s=d[o].getAttribute("schemeIdUri");if(null==s||"urn:mpeg:dash:role:2011"==s)switch(s=d[o].getAttribute("value"),s){case"main":n=!0;break;case"caption":case"subtitle":r=s}}var u=null,c=!1;Ki.U(e,"EssentialProperty").forEach(function(e){"http://dashif.org/guidelines/trickmode"==e.getAttribute("schemeIdUri")?u=e.getAttribute("value"):c=!0}),o=Ki.U(e,"Accessibility");var l=new Map,d={};for(s=(o=F(o)).next();!s.done;d={Rb:d.Rb},s=o.next()){var s=(f=s.value).getAttribute("schemeIdUri"),f=f.getAttribute("value");"urn:scte:dash:cc:cea-608:2015"==s||"urn:scte:dash:cc:cea-708:2015"==s?(d.Rb=1,null!=f?f.split(";").forEach(function(n){return function(e){var t;e.includes("=")?(t=(e=e.split("="))[0].startsWith("CC")?e[0]:"CC"+e[0],e=e[1].split(",")[0].split(":").pop()):(t="CC"+n.Rb,n.Rb+=2),l.set(t,Ln(e))}}(d)):l.set("CC1","und")):"urn:mpeg:dash:role:2011"==s&&null!=f&&(i.push(f),"captions"==f&&(r="caption"))}if(c)return null;var h=Fi(d=Ki.U(e,"ContentProtection"),this.a.dash.customScheme,this.a.dash.ignoreDrmInfo);if(d=Ln(e.getAttribute("lang")||"und"),o=e.getAttribute("label"),(s=Ki.U(e,"Label"))&&s.length&&((s=s[0]).textContent&&(o=s.textContent)),0!=(i=(s=Ki.U(e,"Representation")).map(this.cg.bind(this,t,h,r,d,o,n,i,l)).filter(function(e){return!!e})).length)return t.aa.contentType&&"application"!=t.aa.contentType||(t.aa.contentType=Sr(i[0].mimeType,i[0].codecs),i.forEach(function(e){e.type=t.aa.contentType})),i.forEach(function(t){h.drmInfos.forEach(function(e){t.keyId&&e.keyIds.push(t.keyId)})}),a=s.map(function(e){return e.getAttribute("id")}).filter(ce.Na),{id:t.aa.id||"__fake__"+this.h++,contentType:t.aa.contentType,language:d,jd:n,streams:i,drmInfos:h.drmInfos,Nd:u,kg:a};if(this.a.dash.ignoreEmptyAdaptationSet||a)return null;throw new Y(2,4,4003)},e.cg=function(e,t,n,i,r,a,o,s,u){if(e.A=wr(u,e.aa,null),l=e.A,c=l.ac?1:0,c+=l.Qa?1:0,!(0!=(c+=l.cc?1:0)?(1!=c&&(X.m("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",l),l.ac?(X.info("Using SegmentBase by default."),l.Qa=null):X.info("Using SegmentList by default."),l.cc=null),!0):"text"==l.contentType||"application"==l.contentType||(X.m("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',l),!1)))return X.m("Skipping Representation",e.A),null;var c;e.bandwidth=Ki.M(u,"bandwidth",Ki.Bc)||0;var l="text"==(l=e.A.contentType)||"application"==l;try{var d,f,h,p=this.lg.bind(this);h=e.A.ac?function(e,t){var n=Number(Wi(e,ur,"presentationTimeOffset"))||0,i=Wi(e,ur,"timescale"),r=1;i&&(r=Ki.Bc(i)||1),n=n/r||0,i=or(e,ur);var a=e.A.contentType,r=e.A.mimeType.split("/")[1];if("text"!=a&&"mp4"!=r&&"webm"!=r)throw X.error("SegmentBase specifies an unsupported container type.",e.A),new Y(2,4,4006);if("webm"==r&&!i)throw X.error("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",e.A),new Y(2,4,4005);a=zi(e,ur,"RepresentationIndex");var o,s=Wi(e,ur,"indexRange"),u=e.A.ta,s=Ki.Cc(s||"");if(a&&((o=a.getAttribute("sourceURL"))&&(u=le(e.A.ta,[o])),s=Ki.M(a,"range",Ki.Cc,s)),!s)throw X.error("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",e.A),new Y(2,4,4002);return{createSegmentIndex:(r=sr(e,t,i,u,s.start,s.end,r,n)).createSegmentIndex,findSegmentPosition:r.findSegmentPosition,getSegmentReference:r.getSegmentReference,initSegmentReference:i,oa:n}}(e,p):e.A.Qa?cr(e,this.o):e.A.cc?dr(e,p,this.o,!!this.c):(d=e.A.ta,f=e.W.duration||0,{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0<=e&&e<f?1:null},getSegmentReference:function(e){return 1!=e?null:new $i(1,0,f,function(){return d},0,null)},initSegmentReference:null,oa:0})}catch(e){if(l&&4002==e.code)return null;throw e}return u=function(e,t,n,i){var r=Fi(e,t,i);if(n.be)e=1==n.drmInfos.length&&!n.drmInfos[0].keySystem,t=0==r.drmInfos.length,(0==n.drmInfos.length||e&&!t)&&(n.drmInfos=r.drmInfos),n.be=!1;else if(0<r.drmInfos.length&&(n.drmInfos=n.drmInfos.filter(function(t){return r.drmInfos.some(function(e){return e.keySystem==t.keySystem})}),0==n.drmInfos.length))throw new Y(2,4,4008);return r.Xd||n.Xd}(u=Ki.U(u,"ContentProtection"),this.a.dash.customScheme,t,this.a.dash.ignoreDrmInfo),{id:this.h++,originalId:e.A.id,createSegmentIndex:h.createSegmentIndex,findSegmentPosition:h.findSegmentPosition,getSegmentReference:h.getSegmentReference,initSegmentReference:h.initSegmentReference,presentationTimeOffset:h.oa,mimeType:e.A.mimeType,codecs:e.A.codecs,frameRate:e.A.frameRate,pixelAspectRatio:e.A.pixelAspectRatio,bandwidth:e.bandwidth,width:e.A.width,height:e.A.height,kind:n,encrypted:0<t.drmInfos.length,keyId:u,language:i,label:r,type:e.aa.contentType,primary:a,trickModeVideo:null,emsgSchemeIdUris:e.A.emsgSchemeIdUris,roles:o,channelsCount:e.A.qd,audioSamplingRate:e.A.audioSamplingRate,closedCaptions:s}},e.bg=function(i,r,e){var a=Ki.Hb,o=e.getAttribute("schemeIdUri")||"",s=e.getAttribute("value")||"",u=Ki.M(e,"timescale",a)||1;Ki.U(e,"Event").forEach(function(e){var t=Ki.M(e,"presentationTime",a)||0,n=Ki.M(e,"duration",a)||0,n=(t=t/u+i)+n/u;null!=r&&(t=Math.min(t,i+r),n=Math.min(n,i+r)),e={schemeIdUri:o,value:s,startTime:t,endTime:n,id:e.getAttribute("id")||"",eventElement:e},this.b.onTimelineRegionAdded(e)}.bind(this))},e.lg=function(e,t,n){return e=mr(e,t,n,this.a.retryParameters),e=this.b.networkingEngine.request(1,e),Ge(this.g,e),e.promise.then(function(e){return e.data})},hr.zd("mpd",gr),hr.Lb("application/dash+xml",gr),hr.Lb("video/vnd.mpeg.dash.mpd",gr),xr.prototype.toString=function(){var e="#"+this.name,t=this.a?this.a.map(function(e){return e.name+"="+(isNaN(Number(e.value))?'"'+e.value+'"':e.value)}):[];return this.value&&t.unshift(this.value),0<t.length&&(e+=":"+t.join(",")),e},xr.prototype.getAttribute=function(t){var e=this.a.filter(function(e){return e.name==t});return e.length?e[0]:null};var Ir={ub:function(e,t){return e.filter(function(e){return e.name==t})},Ya:function(e,t){t=Ir.ub(e,t);return t.length?t[0]:null},Xc:function(e,n,i){return e.filter(function(e){var t=e.getAttribute("TYPE");return e=e.getAttribute("GROUP-ID"),t.value==n&&e.value==i})},Pc:function(e,t){return le([e],[t])[0]},gd:function(e){return/^#(?!EXT)/m.test(e)}};function Pr(e){this.b=e,this.a=0}function Cr(e){Rr(e,/[ \t]+/gm)}function Rr(e,t){t.lastIndex=e.a;t=null==(t=t.exec(e.b))?null:{position:t.index,length:t[0].length,ng:t};return e.a==e.b.length||null==t||t.position!=e.a?null:(e.a+=t.length,t.ng)}function Nr(e){return e.a!=e.b.length&&(e=Rr(e,/[^ \t\n]*/gm))?e[0]:null}function Dr(){this.a=0}function Lr(e,t,n){var i=(t=(t=me(t)).replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(i[0]))throw new Y(2,4,4015);t=0;for(var r=1;r<i.length;r++)if(!Ir.gd(i[r])){var a=Ur(e,i[r]);if(--e.a,_r.includes(a.name)){t=1;break}"EXT-X-STREAM-INF"==a.name&&(r+=1)}for(r=[],a=1;a<i.length;)if(Ir.gd(i[a]))a+=1;else{var o=Ur(e,i[a]);if(Or.includes(o.name)){if(1!=t)throw new Y(2,4,4017);return new Er(n,t,r,e=function(t,n,e,i){var r=[],a=[];return e.forEach(function(e){if(/^(#EXT)/.test(e))e=Ur(t,e),(_r.includes(e.name)?i:a).push(e);else{if(Ir.gd(e))return[];e=Ir.Pc(n,e.trim()),r.push(new Mr(e,a)),a=[]}}),r}(e,n,i=i.splice(a,i.length-a),r))}r.push(o),a+=1,"EXT-X-STREAM-INF"==o.name&&(o.a.push(new kr("URI",i[a])),a+=1)}return new Er(n,t,r)}function Ur(e,t){e=e.a++;if(!(a=t.match(/^#(EXT[^:]*)(?::(.*))?$/)))throw new Y(2,4,4016,t);var n,i,t=a[1],r=a[2],a=[];if(r){(i=Rr(r=new Pr(r),/^([^,=]+)(?:,|$)/g))&&(n=i[1]);for(var o=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;i=Rr(r,o);)a.push(new kr(i[1],i[2]||i[3]))}return new xr(e,t,a,n)}var _r="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST".split(" "),Or="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE".split(" ");function jr(e){try{var t=jr.parse(e);return Le({uri:e,vd:e,data:t.data,headers:{"content-type":t.contentType}})}catch(e){return Ne(e)}}function Kr(){var e=this;this.a=this.f=null,this.ea=1,this.G=new Map,this.V=new Set,this.b=new Map,this.c=null,this.v="",this.u=new Dr,this.T=0,this.h=new Me(function(){var n;n=e,H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return(X.info("Updating manifest..."),n.f)?(q(e,2),V(e,n.update(),4)):e.return();case 4:t=n.T,n.h.R(t),G(e,0);break;case 2:if(t=W(e),!n.f)return e.return();t.severity=1,n.f.onError(t),n.h.R(.1),I(e)}})})}),this.g=ia,this.o=null,this.D=0,this.H=1/0,this.i=new qe,this.K=[],this.l=new Map,this.$=!1}function Br(e){e.forEach(function(e){var t;e&&(t=(t=e.stream.codecs.split(",")).filter(function(e){return"mp4a.40.34"!=e}),e.stream.codecs=t.join(","))})}function Fr(c,l,d){return H(function e(){var n,i,r,a,o,s,u;return z(e,function(e){switch(e.j){case 1:return(n=Yr(l,"URI"),c.b.has(n))?e.return(c.b.get(n)):(i=Yr(l,"TYPE").toLowerCase(),u=fe,"subtitles"==i&&(i=u.va),r=Ln(Ar(l,"LANGUAGE","und")),a=Ar(l,"NAME"),s=l.getAttribute("DEFAULT"),o="YES"==s,u=Ar(l,"CHANNELS"),t="audio"==i&&u?(t=u.split("/")[0],parseInt(t,10)):null,s=t,u=Ar(l,"CHARACTERISTICS"),V(e,Hr(c,n,d,i,r,o,a,s,null,u),2));var t;case 2:return(u=e.s,c.b.has(n))?e.return(c.b.get(n)):null==u?e.return(null):(c.G.set(l.id,u),c.b.set(n,u),e.return(u))}})})}function Hr(R,N,D,L,U,_,O,j,K,B){return H(function e(){var f,h,p,m,g,v,b,y,w,T,S,E,x,k,A,M,I,P,C;return z(e,function(e){switch(e.j){case 1:return h=(f=Ir).Pc(R.v,N),V(e,ta(R,Ye([h],R.a.retryParameters),0),2);case 2:if(E=e.s,h=E.uri,1!=(C=Lr(R.u,E.data,h)).type)throw new Y(2,4,4017);p=[],C.segments.forEach(function(e){e=f.ub(e.b,"EXT-X-KEY"),p.push.apply(p,e)}),m=!1,g=[],v=null;for(var t=F(p),n=t.next();!n.done;n=t.next())if(w=n.value,"NONE"!=(y=Yr(w,"METHOD"))){if(m=!0,"AES-128"==y)return X.m("Unsupported HLS Encryption",y),R.$=!0,e.return(null);b=Yr(w,"KEYFORMAT"),(w=(y=na[b])?y(w):null)?(w.keyIds.length&&(v=w.keyIds[0]),g.push(w)):X.m("Unsupported HLS KEYFORMAT",b)}if(m&&!g.length)throw new Y(2,4,4026);return i=R,r=C,a=ra,l=Ir.Ya(r.a,"EXT-X-PLAYLIST-TYPE"),d=Ir.Ya(r.a,"EXT-X-ENDLIST"),d=l&&"VOD"==l.value||d,l=l&&"EVENT"==l.value&&!d,l=!d&&!l,d?ea(i,a.Va):(ea(i,l?a.Rd:a.Le),a=$r(r.a,"EXT-X-TARGETDURATION"),a=Number(a.value),i.D=Math.max(a,i.D),i.H=Math.min(a,i.H)),T=function(e,t){if(1==t.length)return t[0];e=Xr(e,t);if(null!=e)return e;throw new Y(2,4,4025,t)}(L,D),V(e,(o=R,s=L,u=T,c=C,H(function e(){var t,n,i,r,a;return z(e,function(e){switch(e.j){case 1:return(t=fe,n=c.segments[0].a,r=new $(n),i=r.la.split(".").pop(),r=Zr[s],r=r[i])?e.return(r):s==t.va?u&&"vtt"!=u&&"wvtt"!=u?e.return("application/mp4"):e.return("text/vtt"):((a=Ye([n],o.a.retryParameters)).method="HEAD",V(e,ta(o,a,1),2));case 2:if(a=e.s,!(a=a.headers["content-type"]))throw new Y(2,4,4021,i);return e.return(a.split(";")[0])}})})),3);case 3:return S=e.s,Qr.includes(S)&&(T=""),k=(x=f.Ya(C.a,"EXT-X-MEDIA-SEQUENCE"))?Number(x.value):0,q(e,4),V(e,Wr(R,N,C,k,S,T),6);case 6:M=e.s,G(e,5);break;case 4:if(4035==(A=W(e)).code)return X.Z("Skipping unsupported HLS stream",S,N),e.return(null);throw A;case 5:if(E=M[0].startTime,x=M[M.length-1].endTime,k=x-E,A=new Qi(M),M=Vr(C),C=void 0,"text"==L&&(C="subtitle"),I=[],B)for(n=(t=F(B.split(","))).next();!n.done;n=t.next())P=n.value,I.push(P);return C={id:R.ea++,originalId:O,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:A.find.bind(A),getSegmentReference:A.get.bind(A),initSegmentReference:M,presentationTimeOffset:0,mimeType:S,codecs:T,kind:C,encrypted:m,keyId:v,language:U,label:O,type:L,primary:_,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:I,channelsCount:j,audioSamplingRate:null,closedCaptions:K},e.return({stream:C,bc:A,drmInfos:g,Jc:N,Qe:h,nd:E,Qg:x,duration:k})}var o,s,u,c,i,r,a,l,d})})}function Vr(e){var t=Ir.ub(e.a,"EXT-X-MAP");if(!t.length)return null;if(1<t.length)throw new Y(2,4,4020);var n=Yr(t=t[0],"URI"),i=Ir.Pc(e.b,n);return e=0,n=null,(t=Ar(t,"BYTERANGE"))&&(e=t.split("@"),t=Number(e[0]),n=(e=Number(e[1]))+t-1),new Yi(function(){return[i]},e,n)}function qr(e,t,n,i){var r=t.b,a=t.a;t=$r(r,"EXTINF").value.split(","),t=i+Number(t[0]);var o=0,s=null;return(r=Ir.Ya(r,"EXT-X-BYTERANGE"))&&(o=r.value.split("@"),r=Number(o[0]),s=(o=o[1]?Number(o[1]):e.a+1)+r-1),new $i(n,i,t,function(){return[a]},o,s)}function Gr(t){t.c&&(t.K.forEach(function(e){t.c.Eb(e,0)}),t.K=[])}function Wr(v,b,y,w,T,S){return H(function e(){var n,i,r,a,f,h,p,m,g;return z(e,function(e){switch(e.j){case 1:return n=y.segments,i=[],r=n[0].a,a=qr(null,n[0],w,0),f=Vr(y),V(e,(o=v,s=b,u=f,c=a,l=T,d=S,H(function e(){var i,r,a;return z(e,function(e){switch(e.j){case 1:if(o.o){if(r=o.b.get(s),r=r.bc,r=r.get(c.position))return X.F("Found segment start time in previous manifest"),e.return(r.startTime);X.debug("Unable to find segment start time in previous manifest!")}if(X.F("Fetching segment to find start time"),l=l.toLowerCase(),Qr.includes(l))throw X.Z("Raw formats are not yet supported.  Skipping "+l),new Y(1,4,4035);if("video/webm"==l)throw X.Z("WebM in HLS is not yet supported.  Skipping."),new Y(1,4,4035);if("video/mp4"==l||"audio/mp4"==l)return i=[zr(o,c)],u&&i.push(zr(o,u)),V(e,Promise.all(i),3);e.C(2);break;case 3:return r=e.s,i=r[0],r=r[1]||r[0],e.return(function(e,t,n,i){var r=0;if((new Ri).L("moov",Ni).L("trak",Ni).L("mdia",Ni).ia("mdhd",function(e){e.reader.P(0==e.version?8:16),r=e.reader.I(),e.parser.stop()}).parse(i,!0),!r)throw X.error("Unable to find timescale in init segment!"),new Y(2,4,4030,e,t);var a=0,o=!1;if((new Ri).L("moof",Ni).L("traf",Ni).ia("tfdt",function(e){a=(0==e.version?e.reader.I():e.reader.Kb())/r,o=!0,e.parser.stop()}).parse(n,!0),!o)throw new Y(2,4,4030,e,t);return a}(s,i.uri,i.data,r.data));case 2:if("video/mp2t"==l)return V(e,zr(o,c),5);e.C(4);break;case 5:return a=e.s,e.return(function(e,t,n){function i(){a.seek(o+188),71!=(s=a.na())&&(a.seek(o+192),s=a.na()),71!=s&&(a.seek(o+204),s=a.na()),71!=s&&r(),a.ze(1)}function r(){throw new Y(2,4,4030,e,t)}for(var a=new Ii(new DataView(n),0),o=0,s=0;;)if(o=a.ga(),71!=(s=a.na())&&r(),8191==(8191&(n=a.$b())))i();else if(16384&n){if(0!=(n=(48&a.na())>>4)&&2!=n||r(),3==n&&(n=a.na(),a.P(n)),1==a.I()>>8){a.P(3),0!=(n=a.na()>>6)&&1!=n||r(),0==a.na()&&r(),n=a.na();var u=a.$b(),c=a.$b();return(1073741824*((14&n)>>1)+((65534&u)<<14|(65534&c)>>1))/9e4}i()}else i()}(s,a.uri,a.data));case 4:if("application/mp4"==l||l.startsWith("text/"))return V(e,zr(o,c),7);e.C(6);break;case 7:return a=e.s,e.return((t=l,n=d,e=a.data,mn(t=ut(t,n))?(gn(n=new hn(null),t),n.sc(e)):0));case 6:throw new Y(2,4,4030,s)}var t,n})})),2);case 2:h=e.s,X.debug("First segment",r.split("/").pop(),"starts at",h);for(var t=0;t<n.length;++t)p=n[t],m=i[i.length-1],g=0==t?h:m.endTime,g=qr(m,p,w+t,g),i.push(g);return v.K.push(i),Gr(v),e.return(i)}var o,s,u,c,l,d})})}function zr(a,o){return H(function e(){var t,n,i,r;return z(e,function(e){switch(e.j){case 1:return(r=1,t=mr(o.c(),o.b,o.b+2048-1,a.a.retryParameters),n=mr(o.c(),o.b,o.a,a.a.retryParameters),a.a.hls.useFullSegmentsForStartTime)?e.return(ta(a,n,r)):(q(e,2),V(e,ta(a,t,r),4));case 4:return i=e.s,e.return(i);case 2:if(7001==(i=W(e)).code)throw i;return X.Z("Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",t.uris[0]),V(e,ta(a,n,r),5);case 5:return r=e.s,e.return(r)}})})}function Xr(e,t){for(var n=Jr[e],i=0;i<n.length;i++)for(var r=0;r<t.length;r++)if(n[i].test(t[r].trim()))return t[r].trim();return"text"==e?"":null}function Yr(e,t){e=e.getAttribute(t);if(!e)throw new Y(2,4,4023,t);return e.value}function $r(e,t){e=Ir.Ya(e,t);if(!e)throw new Y(2,4,4024,t);return e}L("shaka.net.DataUriPlugin",jr),jr.parse=function(e){var t=e.split(":");if(t.length<2||"data"!=t[0])throw X.error("Bad data URI, failed to parse scheme"),new Y(2,1,1004,e);if((t=t.slice(1).join(":").split(",")).length<2)throw X.error("Bad data URI, failed to extract encoding and MIME type"),new Y(2,1,1004,e);var n=t[0];e=d.decodeURIComponent(t.slice(1).join(",")),n=(t=n.split(";"))[0];var i=!1;return 1<t.length&&"base64"==t[t.length-1]&&(i=!0,t.pop()),{data:i?Se.Fa(e).buffer:be(e),contentType:n}},Xe("data",jr),L("shaka.hls.HlsParser",Kr),(e=Kr.prototype).configure=function(e){this.a=e},e.start=function(n,i){var r=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return r.f=i,V(e,ta(r,Ye([n],r.a.retryParameters),0),2);case 2:return t=e.s,r.v=t.uri,V(e,(p=r,m=t.data,H(function e(){var i,r,a,o,s,l,d,f,h;return z(e,function(e){switch(e.j){case 1:if(0!=(l=Lr(p.u,m,p.v)).type)throw new Y(2,4,4022);return V(e,(u=p,c=l,H(function e(){var t,n,i,r,a,o,s;return z(e,function(e){switch(e.j){case 1:return t=Ir,s=ce,n=c.a,r=t.ub(c.a,"EXT-X-MEDIA"),i=r.filter(function(e){return"SUBTITLES"==Yr(e,"TYPE")}.bind(u)),i=i.map(function(r){var a=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return a.a.disableText?e.return(null):(q(e,2),V(e,(n=a,i=r,H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return Yr(i,"TYPE"),V(e,Fr(n,i,[]),2);case 2:return t=e.s,e.return(t.stream)}})})),4));case 4:return e.return(e.s);case 2:if(t=W(e),a.a.hls.ignoreTextStreamFailures)return e.return(null);throw t}var n,i})})}.bind(u)),r=r.filter(function(e){return"CLOSED-CAPTIONS"==Yr(e,"TYPE")}),function(e,t){for(var n=F(t),i=n.next();!i.done;i=n.next()){Yr(i=i.value,"TYPE");var r=Ar(i,"LANGUAGE")||"und";r=Ln(r);var a=Yr(i,"GROUP-ID");i=Yr(i,"INSTREAM-ID"),e.l.get(a)||e.l.set(a,new Map),e.l.get(a).set(i,r)}}(u,r),V(e,Promise.all(i),2);case 2:return a=e.s,o=t.ub(n,"EXT-X-STREAM-INF"),o=o.map(function(e){return E=this,x=e,k=c,H(function e(){var t,n,i,r,c,l,d,f,h,p,m,g,v,b,y,w,T,S;return z(e,function(e){switch(e.j){case 1:return t=fe,n=Ir,h=[],E.a.disableVideo||h.push("avc1.42E01E"),E.a.disableAudio||h.push("mp4a.40.2"),w=h.join(","),g=Ar(x,"CODECS",w),i=function(e){for(var t=new Set,n=[],i=(e=F(e)).next();!i.done;i=e.next()){var r=ct(i=i.value)[0];t.has(r)?X.debug("Ignoring duplicate codec"):(n.push(i),t.add(r))}return n}(g.split(/\s*,\s*/)),r=x.getAttribute("RESOLUTION"),l=c=null,d=Ar(x,"FRAME-RATE"),f=Number(Yr(x,"BANDWIDTH")),r&&(p=r.value.split("x"),c=p[0],l=p[1]),v=(v=(v=n.ub(k.a,"EXT-X-MEDIA")).filter(function(e){return"CLOSED-CAPTIONS"!=Yr(e,"TYPE")})).filter(function(e){var t=Ar(e,"URI")||"";return"SUBTITLES"==(Ar(e,"TYPE")||"")||""!=t}),h=Ar(x,"AUDIO"),w=Ar(x,"VIDEO"),h?v=n.Xc(v,"AUDIO",h):w&&(v=n.Xc(v,"VIDEO",w)),(g=Xr(t.va,i))&&((p=Ar(x,"SUBTITLES"))&&(m=n.Xc(v,"SUBTITLES",p)).length&&(T=E.G.get(m[0].id))&&(T.stream.codecs=g),He(i,g)),T=v.map(function(e){return Fr(this,e,i)}.bind(E)),g=[],v=[],V(e,Promise.all(T),2);case 2:if(T=(T=e.s).filter(function(e){return null!=e}),h?g=T:w&&(v=T),X.debug("Guessing stream type for",x.toString()),w=!1,g.length||v.length?g.length?(T=Yr(x,"URI"),S=g[0].Jc,T==S?(X.debug("Guessing audio-only."),y=t.Nb,w=!0):(X.debug("Guessing video."),y=t.Ua)):(X.debug("Guessing audio."),y=t.Nb):1==i.length?(S=Xr(t.Ua,i),y=r||d||S?(X.debug("Guessing video-only."),t.Ua):(X.debug("Guessing audio-only."),t.Nb)):(X.debug("Guessing multiplexed audio+video."),y=t.Ua,i=[i.join(",")]),w){e.C(3);break}return V(e,(a=E,o=x,s=i,u=y,H(function e(){var t,n,i,r;return z(e,function(e){switch(e.j){case 1:return(t=fe,n=Yr(o,"URI"),a.b.has(n))?e.return(a.b.get(n)):(i=Ar(o,"CLOSED-CAPTIONS"),r=null,u==t.Ua&&i&&"NONE"!=i&&(r=a.l.get(i)),V(e,Hr(a,n,s,u,"und",!1,null,null,r,null),2));case 2:return null==(r=e.s)?e.return(null):a.b.has(n)?e.return(a.b.get(n)):(a.b.set(n,r),e.return(r))}})})),4);case 4:b=e.s;case 3:if(b)b.stream.type==t.Nb?g=[b]:v=[b];else if(null===b)return X.debug("streamInfo is null"),e.return([]);return v&&Br(v),g&&Br(g),e.return(function(e,t,n,i,r,a,o){n.forEach(function(e){(e=e.stream)&&(e.width=Number(r)||void 0,e.height=Number(a)||void 0,e.frameRate=Number(o)||void 0)}.bind(e));var s=!!e.a&&e.a.disableAudio;t.length&&!s||(t=[null]);s=!!e.a&&e.a.disableVideo,n.length&&!s||(n=[null]);s=[];for(var u=(t=F(t)).next();!u.done;u=t.next()){u=u.value;for(var c=F(n),l=c.next();!l.done;l=c.next()){var d=l.value;l=u?u.stream:null;var f=d?d.stream:null,h=u?u.drmInfos:null,p=d?d.drmInfos:null;d=(d?d.Jc:"")+" - "+(u?u.Jc:"");var m=void 0;if(l&&f){if(h.length&&p.length&&!(0<_t(h,p).length)){X.m("Incompatible DRM info in HLS variant.  Skipping.");continue}m=_t(h,p)}else l?m=h:f&&(m=p);e.V.has(d)?X.debug("Skipping variant which only differs in text streams."):(l=function(e,t,n,i,r){return{id:e.ea++,language:t?t.language:"und",primary:!!t&&t.primary||!!n&&n.primary,audio:t,video:n,bandwidth:i,drmInfos:r,allowedByApplication:!0,allowedByKeySystem:!0}}(e,l,f,i,m),s.push(l),e.V.add(d))}}return s}(E,g,v,f,c,l,d))}var a,o,s,u})});var E,x,k}.bind(u)),V(e,Promise.all(o),3);case 3:return o=e.s,s=(s=o.reduce(s.Oc,[])).filter(function(e){return null!=e}),e.return({startTime:0,variants:s,textStreams:a.filter(function(e){return null!=e})})}})})),2);case 2:if(i=e.s,!p.f)throw new Y(2,7,7001);if(p.$&&0==i.variants.length)throw X.info("No stream is created, because we don't support AES-128","encryption yet"),new Y(2,4,4034);p.f.filterAllPeriods([i]),r=1/0,o=1/(a=0);for(var t=F(p.b.values()),n=t.next();!n.done;n=t.next())s=n.value,r=Math.min(r,s.nd),a=Math.max(a,s.nd),"text"!=s.stream.type&&(o=Math.min(o,s.duration));if(p.g!=ra.Va?(p.c=new pr(0,3*p.D),p.c.dc(!1)):(p.c=new pr(null,0),p.c.dc(!0)),Gr(p),p.g!=ra.Va){for(p.T=p.H,p.g==ra.Rd&&(l=p.c.Dc,isNaN(p.a.availabilityWindowOverride)||(l=p.a.availabilityWindowOverride),p.c.Jd(l)),d=0;95443.7176888889<=a;)d+=95443.7176888889,a-=95443.7176888889;if(d)for(X.debug("Offsetting live streams by",d,"to compensate for rollover"),n=(t=F(p.b.values())).next();!n.done;n=t.next())(f=n.value).nd<95443.7176888889?(X.F("Offset applied to",f.stream.type),f.stream.presentationTimeOffset=-d,f.bc.offset(d)):X.F("Offset NOT applied to",f.stream.type)}else for(p.c.Ba(o),p.c.offset(-r),n=(t=F(p.b.values())).next();!n.done;n=t.next())(h=n.value).stream.presentationTimeOffset=r,h.bc.offset(-r),Zi(h.bc,o);p.o={presentationTimeline:p.c,periods:[i],offlineSessionIds:[],minBufferTime:0},I(e)}var u,c})})),3);case 3:return 0<(t=r.T)&&r.h.R(t),e.return(r.o)}var p,m})})},e.stop=function(){this.h&&(this.h.stop(),this.h=null);var e=[];return this.i&&(e.push(this.i.destroy()),this.i=null),this.a=this.f=null,this.G.clear(),this.V.clear(),this.b.clear(),this.o=null,Promise.all(e)},e.update=function(){if(this.g!=ra.Va){for(var e=[],t=F(this.b.values()),n=t.next();!n.done;n=t.next())e.push(function(o,s){return H(function e(){var t,n,i,r,a;return z(e,function(e){switch(e.j){case 1:return t=Ir,n=ra,r=s.Qe,V(e,ta(o,Ye([r],o.a.retryParameters),0),2);case 2:if(r=e.s,1!=(i=Lr(o.u,r.data,r.uri)).type)throw new Y(2,4,4017);return r=(a=t.Ya(i.a,"EXT-X-MEDIA-SEQUENCE"))?Number(a.value):0,a=s.stream,V(e,Wr(o,s.Jc,i,r,a.mimeType,a.codecs),3);case 3:a=e.s,s.bc.a=a,a=a[a.length-1],t.Ya(i.a,"EXT-X-ENDLIST")&&(ea(o,n.Va),o.c.Ba(a.endTime)),I(e)}})})}(this,n.value));return Promise.all(e)}},e.onExpirationUpdated=function(){};var Jr={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]},Qr=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"],Zr={audio:{mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},video:{mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"}};function ea(e,t){e.g=t,e.c&&e.c.dc(e.g==ra.Va),e.g!=ra.Va||e.h.stop()}function ta(e,t,n){if(!e.i)throw new Y(2,7,7001);return t=e.f.networkingEngine.request(n,t),Ge(e.i,t),t.promise}var na={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var t=Yr(e,"METHOD");Hn("HLS SAMPLE-AES-CENC","SAMPLE-AES-CENC will no longer be supported, see Issue #1227");var n=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];return n.includes(t)?(t=Yr(e,"URI"),t=jr.parse(t),t=de("com.widevine.alpha",[{initDataType:"cenc",initData:t=new Uint8Array(t.data)}]),(e=Ar(e,"KEYID"))&&(t.keyIds=[e.toLowerCase().substr(2)]),t):(X.error("Widevine in HLS is only supported with [",n.join(", "),"], not",t),null)}},ia="VOD",ra={Va:ia,Le:"EVENT",Rd:"LIVE"};function aa(){this.a=new Map}function oa(e,t,n){sa(e,t).text=n}function sa(e,t){return e.a.has(t)||e.a.set(t,new ua),e.a.get(t)}function ua(){this.text=this.variant=null}function ca(e,t){this.a=e,this.b=new Set([e]);for(var n=F(t=t||[]),i=n.next();!i.done;i=n.next())this.add(i.value)}function la(e,t){var n,i;return!(i=!!e.audio!=!!t.audio||!!e.video!=!!t.video||e.language!=t.language)&&(i=e.audio&&t.audio)&&(i=e.audio,n=t.audio,i=!(i.channelsCount==n.channelsCount&&da(i,n)&&fa(i.roles,n.roles))),!i&&(i=e.video&&t.video)&&(i=!(da(i=e.video,n=t.video)&&fa(i.roles,n.roles))),!i}function da(e,t){if(e.mimeType==t.mimeType){var n=e.codecs.split(",").map(function(e){return ct(e)[0]}),i=t.codecs.split(",").map(function(e){return ct(e)[0]});if(n.length==i.length){n.sort(),i.sort();for(var r=0;r<n.length;r++)if(n[r]!=i[r])return;return 1}}}function fa(e,t){var n=new Set(e),i=new Set(t);if(n.delete("main"),i.delete("main"),n.size==i.size){for(var r=(n=F(n)).next();!r.done;r=n.next())if(!i.has(r.value))return;return 1}}function ha(e){this.a=e,this.b=new pa(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"")}function pa(e,t,n,i){this.c=e,this.f=t,this.a=n,this.b=void 0===i?"":i}function ma(){this.a=ba,this.b=(new Map).set(ba,2).set(va,1)}function ga(e,t,n){e.b.set(ba,n).set(va,t)}hr.zd("m3u8",Kr),hr.Lb("application/x-mpegurl",Kr),hr.Lb("application/vnd.apple.mpegurl",Kr),ca.prototype.add=function(e){return la(this.a,e)?(this.b.add(e),!0):(X.m("Rejecting variant - not compatible with root."),!1)},ca.prototype.values=function(){return this.b.values()},ha.prototype.create=function(e){var t=this,n=e.filter(function(e){return la(t.a,e)});return n.length?new ca(n[0],n):this.b.create(e)},pa.prototype.create=function(e){var t,n,i=[];a=e,t=this.c,i=(n=_n(Ln(t),a.map(Un)))?a.filter(function(e){return n==Un(e)}):[];var r,a,o,s=e.filter(function(e){return e.primary}),i=i.length?i:s.length?s:e;for(a=i,r=this.f,(e=a.filter(function(e){return!!e.audio&&(r?e.audio.roles.includes(r):0==e.audio.roles.length)})).length?i=e:X.m("No exact match for variant role could be found."),this.a&&((e=jn.$d(i,this.a)).length?i=e:X.m("No exact match for the channel count could be found.")),this.b&&(a=i,o=this.b,(e=a.filter(function(e){return!!e.audio&&e.audio.label.toLowerCase()==o.toLowerCase()})).length?i=e:X.m("No exact match for variant label could be found.")),e=new ca(i[0]),s=(i=F(i)).next();!s.done;s=i.next())s=s.value,la(e.a,s)&&e.add(s);return e};var va=0,ba=1;function ya(e,t){this.g=e,this.h=Ta(e),this.a=e.a.currentTime,this.f=Date.now()/1e3,this.b=!1,this.i=t,this.c=function(){}}function wa(e){this.a=e}function Ta(e){if(e.a.paused||0==e.a.playbackRate||0==e.a.buffered.length)var t=!1;else e:{t=e.a.buffered,e=e.a.currentTime;for(var n=0;n<t.length;n++){var i=t.start(n),r=t.end(n);if(!(e<i-.1||r-.5<e)){t=!0;break e}}t=!1}return t}function Sa(e,t,n,i,r){var a=this;this.a=e,this.v=t,this.u=n,this.l=r,this.f=new Ze,this.i=!1,this.o=e.readyState,this.c=!1,this.b=i,this.h=!1,this.f.B(e,"waiting",function(){return Ea(a)}),this.g=new Me(function(){Ea(a)}).Ka(.25)}function Ea(e){if(0!=e.a.readyState){if(e.a.seeking){if(!e.i)return}else e.i=!1;var t,n,i,r,a,o,s,u;if(!e.a.paused)if(e.a.readyState!=e.o&&(e.c=!1,e.o=e.a.readyState),(t=!e.b)||(i=Ta(n=(t=e.b).g),r=n.a.currentTime,a=Date.now()/1e3,t.a==r&&t.h==i||(t.f=a,t.a=r,t.h=i,t.b=!1),(i=(r=a-t.f)>=t.i&&i&&!t.b)&&(t.c(t.a,r),t.b=!0,t.a=n.a.currentTime),t=!i),t){a=e.u.smallGapLimit,t=e.a.currentTime;e:{if((n=e.a.buffered)&&n.length&&!(1==n.length&&n.end(0)-n.start(0)<1e-6))for(i=navigator.userAgent.match(/Edge\//)||gt("Trident/")||ht()||gt("CrKey")?.5:.1,r=0;r<n.length;r++)if(n.start(r)>t&&(0==r||n.end(r-1)-t<=i)){i=r;break e}i=null}null==i||0==i&&!e.h||(r=n.start(i),(o=e.v.Ga())<=r||(a=(o=r-t)<=a,s=!1,o<.001||(a||e.c||(e.c=!0,(u=new Oe("largegap",{currentTime:t,gapSize:o})).cancelable=!0,e.l(u),e.u.jumpLargeGaps&&!u.defaultPrevented?s=!0:X.info("Ignoring large gap at",t,"size",o)),(a||s)&&(0==i?X.info("Jumping forward",o,"seconds because of gap before start time of",r):X.info("Jumping forward",o,"seconds because of gap starting at",n.end(i-1),"and ending at",r),e.a.currentTime=r))))}}}function xa(e){var t=this;this.c=e,this.a=new Set,this.b=new Me(function(){ka(t,!1)}).Ka(.25)}function ka(e,t){for(var n=F(e.a),i=n.next();!i.done;i=n.next())i.value.g(e.c.currentTime,t)}function Aa(e){for(var t=[],n=(e=F(e)).next();!n.done;n=e.next())for(var i=(n=F(n.value.variants)).next();!i.done;i=n.next())t.push(i.value);return t}function Ma(e,t){for(var n=null,i=F(e),r=i.next();!r.done;r=i.next())t>=(r=r.value).startTime&&(n=r);return n}function Ia(e){this.c=e,this.a=null,this.b=function(){}}function Pa(e){var t=this;this.a=e,this.f=!1,this.c=this.a.rc(),this.b=new Me(function(){t.a.le(.25*t.c)})}function Ca(e){e.b.stop();var t=e.f?0:e.c;if(0<=t)try{return void(e.a.rc()!=t&&e.a.Id(t))}catch(e){}e.b.Ka(.25),0!=e.a.rc()&&e.a.Id(0)}function Ra(e,t,n,i){t==HTMLMediaElement.HAVE_NOTHING||e.readyState>=t?i():(t=Na.get(t),n.ua(e,t,i))}ya.prototype.release=function(){this.g=null,this.c=function(){}},Sa.prototype.release=function(){this.f&&(this.f.release(),this.f=null),null!=this.g&&(this.g.stop(),this.g=null),this.b&&(this.b.release(),this.b=null),this.a=this.v=this.l=null},Sa.prototype.td=function(){this.h=!0,Ea(this)},xa.prototype.release=function(){this.b.stop();for(var e=F(this.a),t=e.next();!t.done;t=e.next())t.value.release();this.a.clear()},Ia.prototype.release=function(){this.a=this.c=null,this.b=function(){}},Ia.prototype.g=function(e){var t=this.a,n=this.c.periods;t!=(e=Ma(n,e)||n[0])&&this.b(e),this.a=e},Pa.prototype.release=function(){this.b&&(this.b.stop(),this.b=null),this.a=null},Pa.prototype.set=function(e){this.c=e,Ca(this)};var Na=new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]]);function Da(e,t,n){var i=this;this.a=e,this.g=t,this.f=n,this.h=!1,this.b=new Ze,this.c=new ja(e),Ra(this.a,HTMLMediaElement.HAVE_METADATA,this.b,function(){_a(i,i.f)})}function La(e){return e.h?e.a.currentTime:e.f}function Ua(e,t){0<e.a.readyState?Ka(e.c,t):Ra(e.a,HTMLMediaElement.HAVE_METADATA,e.b,function(){_a(e,e.f)})}function _a(e,t){Math.abs(e.a.currentTime-t)<.001?Oa(e):(e.b.ua(e.a,"seeking",function(){Oa(e)}),Ka(e.c,0==e.a.currentTime?t:e.a.currentTime))}function Oa(e){e.h=!0,e.b.B(e.a,"seeking",function(){return e.g()})}function ja(e){var t=this;this.b=e,this.h=10,this.g=this.c=this.f=0,this.a=new Me(function(){t.f<=0?(X.m(["Failed to move playhead from",t.c,"to",t.g].join(" ")),t.a.stop()):t.b.currentTime!=t.c?t.a.stop():(t.b.currentTime=t.g,t.f--)})}function Ka(e,t){e.c=e.b.currentTime,e.g=t,e.f=e.h,e.b.currentTime=t,e.a.Ka(.1)}function Ba(e){var t=this;this.a=e,this.f=!1,this.c=null,this.b=new Ze,Ra(this.a,HTMLMediaElement.HAVE_CURRENT_DATA,this.b,function(){null==t.c?t.f=!0:(t.b.ua(t.a,"seeking",function(){t.f=!0}),t.a.currentTime=Math.max(0,t.a.currentTime+t.c))})}function Fa(e,t,n,i,r,a){var o=this;this.c=e,this.a=t.presentationTimeline,this.D=t.minBufferTime||0,this.h=n,this.v=r,this.l=null,this.f=new Sa(e,t.presentationTimeline,n,function(n,e){if(!e.stallEnabled)return null;var i=e.stallSkip,e=new ya(new wa(n),e.stallThreshold);return function(e,t){e.c=t}(e,function(e,t){X.debug("Stall detected at "+e+" for "+t+" seconds."),i?(X.debug("Seeking forward "+i+" seconds to break stall."),n.currentTime+=i):(X.debug("Pausing and unpausing to break stall."),n.pause(),n.play())}),e}(e,n),a),this.b=new Da(e,function(){e:{var e=o.f;e.i=!0,e.h=!1,e.c=!1,e=La(o.b);var t=Va(o,e);if(.001<Math.abs(t-e)){var n=Date.now()/1e3;if(!o.l||o.l<n-1){o.l=n,Ua(o.b,t),e=void 0;break e}}X.F("Seek to "+e),o.v(),e=void 0}return e},(e=this,null==(i=i)?i=1/0>e.a.ca()?e.a.wb():e.a.Ga():i<0&&(i=e.a.Ga()+i),Ha(e,qa(e,i)))),this.i=new Me(function(){var e,t,n;0==o.c.readyState||o.c.paused||(e=La(o.b),t=o.a.wb(),(n=o.a.Ga())-t<3&&(t=n-3),e<t&&(t=Va(o,e),X.info("Jumping forward "+(t-e)+" seconds to catch up with the seek range."),o.c.currentTime=t))}).Ka(.25)}function Ha(e,t){var n=e.a.ca();return n<=t?n-e.h.durationBackoff:t}function Va(e,t){var n=Wt.bind(null,e.c.buffered),i=Math.max(e.D,e.h.rebufferingGoal),r=e.h.safeSeekOffset,a=e.a.wb(),o=e.a.Ga(),s=e.a.ca();o-a<3&&(a=o-3);var u=e.a.Vb(i),c=e.a.Vb(r),i=e.a.Vb(i+r);return s<=t?(X.F("Playhead past duration."),Ha(e,t)):o<t?(X.F("Playhead past end."),o):t<a?n(c)?(X.F("Playhead before start & start is buffered"),c):(X.F("Playhead before start & start is unbuffered"),i):u<=t||n(t)?(X.F("Playhead in safe region or in buffered region."),t):(X.F("Playhead outside safe region & in unbuffered region."),i)}function qa(e,t){var n=e.a.wb();return t<n||(n=e.a.Ga())<t?n:t}function Ga(e){var i=this;this.b=function(){},this.a=new Set,this.f=e,this.c=new Me(function(){for(var e=i.f(),t=F(i.a),n=t.next();!n.done;n=t.next())(n=n.value).endTime<e.start&&i.a.delete(n)}).Ka(2)}function Wa(e){var n=this;this.h=e,this.f=new Map,this.a=function(){},this.b=function(){},this.c=function(){},this.i=[{lb:null,kb:Xa,ab:function(e,t){return n.a(e,t)}},{lb:za,kb:Xa,ab:function(e,t){return n.a(e,t)}},{lb:Ya,kb:Xa,ab:function(e,t){return n.a(e,t)}},{lb:Xa,kb:za,ab:function(e,t){return n.b(e,t)}},{lb:Xa,kb:Ya,ab:function(e,t){return n.b(e,t)}},{lb:za,kb:Ya,ab:function(e,t){return n.c(e,t)}},{lb:Ya,kb:za,ab:function(e,t){return n.c(e,t)}}]}Da.prototype.release=function(){this.b&&(this.b.release(),this.b=null),null!=this.c&&(this.c.release(),this.c=null),this.g=function(){},this.a=null},ja.prototype.release=function(){this.a&&(this.a.stop(),this.a=null),this.b=null},Ba.prototype.release=function(){this.b&&(this.b.release(),this.b=null),this.a=null},Ba.prototype.o=function(e){this.c=this.f?this.c:e},Ba.prototype.g=function(){return(this.f?this.a.currentTime:this.c)||0},Ba.prototype.u=function(){},Fa.prototype.release=function(){this.b&&(this.b.release(),this.b=null),this.f&&(this.f.release(),this.f=null),this.i&&(this.i.stop(),this.i=null),this.c=this.b=this.a=this.h=null,this.v=function(){}},Fa.prototype.o=function(e){Ua(this.b,e)},Fa.prototype.g=function(){var e=La(this.b);return 0<this.c.readyState&&!this.c.paused?qa(this,e):e},Fa.prototype.u=function(){this.f.td()},Ga.prototype.release=function(){this.b=function(){},this.a.clear(),this.c.stop()},Wa.prototype.release=function(){this.h=null,this.f.clear(),this.a=function(){},this.b=function(){},this.c=function(){}},Wa.prototype.g=function(e,t){for(var n=F(this.h.a),i=n.next();!i.done;i=n.next()){i=i.value;var r=this.f.get(i),a=e<i.startTime?za:e>i.endTime?Ya:Xa;this.f.set(i,a);for(var o=F(this.i),s=o.next();!s.done;s=o.next())(s=s.value).lb==r&&s.kb==a&&s.ab(i,t)}};var za=1,Xa=2,Ya=3;function $a(e,t){this.a=t,this.c=e,this.g=null,this.l=1,this.v=Promise.resolve(),this.h=[],this.i=new Map,this.b=new Map,this.u=!1,this.H=null,this.G=this.f=this.o=!1,this.D=0}function Ja(e){return Za(e,"audio")}function Qa(e){return Za(e,"video")}function Za(e,t){t=e.b.get(t);return t?t.Pa||t.stream:null}function eo(o,s){return H(function e(){var t,n,i,r,a;return z(e,function(e){switch(e.j){case 1:return t=fe,V(e,In(o.a.O,t.va),2);case 2:return o.D++,o.G=!1,n=o.D,i=o.a.O,r=new Map,a=new Set,r.set(t.va,s),a.add(s),V(e,i.init(r,!1),3);case 3:return o.f?e.return():V(e,uo(o,a),4);case 4:if(o.f)return e.return();a=o.a.O.g.isTextVisible()||o.g.alwaysStreamText,o.D!=n||o.b.has(t.va)||o.G||!a||(a=o.a.Za(),a=vo(o,a),a=oo(s,a,0),o.b.set(t.va,a),To(o,a,0)),I(e)}})})}function to(e,t){var n,i=e.b.get("video");!i||(n=i.stream)&&(X.debug("setTrickPlay",t),t?(t=n.trickModeVideo)&&!i.Pa&&(X.debug("Engaging trick mode stream",t),io(e,t,!1,0,!1),i.Pa=n):(n=i.Pa)&&(X.debug("Restoring non-trick-mode stream",n),io(e,n,!(i.Pa=null),0,!1)))}function no(e,t,n,i){var r,a=!1;return t.video&&(r=io(e,t.video,n,i,!1),a=a||r),t.audio&&(e=io(e,t.audio,n,i,!1),a=a||e),a}function io(t,e,n,i,r){var a=t.b.get(e.type);if(!a&&"text"==e.type&&t.g.ignoreTextStreamFailures)return eo(t,e),!0;if(!a)return!1;var o=bo(t,e),s=Array.from(t.b.values()).every(function(e){return e.ka==a.ka});return n&&o!=a.ka&&s?(X.debug("switch: switching to stream in another Period; clearing buffer and changing Periods"),t.b.forEach(function(e){ro(t,e)}),!0):(a.Pa&&(X.debug("switch during trick play mode",e),e.trickModeVideo?(e=(a.Pa=e).trickModeVideo,X.debug("switch found trick play stream",e)):(a.Pa=null,X.debug("switch found no special trick play stream"))),!(!(s=t.h[o])||!s.Mb)&&(!(!(s=t.i.get(e.id))||!s.Mb)&&(a.stream!=e||r?("text"==e.type&&Tn(t.a.O,ut(e.mimeType,e.codecs)),a.stream=e,a.vc=!0,X.debug("switch: switching to Stream "+ko(a)),function(e,t,n){if(!t.fb)return!1;var i=e.a.Za(),r=xn(e.a.O,t.type),a=fo(e,t,i,r,n);return n=a&&a.a?a.a-a.b:null,a&&!n&&(n=(a.endTime-a.sc())*t.stream.bandwidth/8),!isNaN(n)&&((a=t.stream.initSegmentReference)&&(n+=(a.a?a.a-a.b:null)||0),a=e.a.getBandwidthEstimate(),8*n/a<r-i-Math.max(e.c.minBufferTime||0,e.g.rebufferingGoal)||t.fb.b.a>n)}(t,a,o)&&(X.info("Aborting current segment request to switch."),a.fb.abort()),n&&(a.Wa?a.Kc=!0:a.Oa?(a.Sa=!0,a.lc=i,a.Kc=!0):(So(a),wo(t,a,!0,i).catch(function(e){t.a&&t.a.onError(e)}))),!0):(X.debug("switch: Stream "+ko(a)+" already active"),!1))))}function ro(t,e){var n=ko(e);e.Wa?X.debug(n,"clear: already clearing the buffer"):e.Sa?X.debug(n,"clear: already waiting"):e.Oa?(X.debug(n,"clear: currently updating"),e.Sa=!0,e.lc=0):null==En(t.a.O,e.type)?(X.debug(n,"clear: nothing buffered"),null==e.La&&To(t,e,0)):(X.debug(n,"clear: handling right now"),So(e),wo(t,e,!1,0).catch(function(e){t.a&&t.a.onError(e)}))}function ao(u,c,l,d,f){return H(function e(){var i,r,a,o,s;return z(e,function(e){switch(e.j){case 1:return o=u.a.Za(),i=vo(u,o),s=fe,r=new Map,a=new Set,c&&(r.set(s.Nb,c),a.add(c)),l&&(r.set(s.Ua,l),a.add(l)),d&&(r.set(s.va,d),a.add(d)),o=u.a.O,s=u.g.forceTransmuxTS,V(e,o.init(r,s),2);case 2:return u.f?e.return():((n=(t=u).c.presentationTimeline.ca())<1/0?t.a.O.Ba(n):t.a.O.Ba(Math.pow(2,32)),V(e,uo(u,a),3));case 3:if(u.f)return e.return();r.forEach(function(e,t){u.b.has(t)||(e=oo(e,i,f),u.b.set(t,e),To(u,e,0))}),I(e)}var t,n})})}function oo(e,t,n){return{stream:e,type:e.type,Cb:null,Ha:null,Pa:null,vc:!0,ka:t,endOfStream:!1,Oa:!1,La:null,Sa:!1,lc:0,Kc:!1,Wa:!1,yd:!1,Xb:!1,Bd:n||0,fb:null}}function so(e,t){var n=e.h[t];if(n)return X.debug("(all) Period "+t+" is being or has been set up"),n.promise;X.debug("(all) setting up Period "+t),n={promise:new pe,Mb:!1},e.h[t]=n;for(var i=new Set,r=F(e.c.periods[t].variants),a=r.next();!a.done;a=r.next())(a=a.value).video&&i.add(a.video),a.video&&a.video.trickModeVideo&&i.add(a.video.trickModeVideo),a.audio&&i.add(a.audio);for(a=(r=F(e.c.periods[t].textStreams)).next();!a.done;a=r.next())i.add(a.value);return e.v=e.v.then(function(){if(!this.f)return uo(this,i)}.bind(e)).then(function(){this.f||(this.h[t].promise.resolve(),this.h[t].Mb=!0,X.F("(all) setup Period "+t))}.bind(e)).catch(function(e){this.f||(this.h[t].promise.catch(function(){}),this.h[t].promise.reject(),delete this.h[t],X.m("(all) failed to setup Period "+t),this.a.onError(e))}.bind(e)),n.promise}function uo(l,d){return H(function e(){var i,r,a,o,s,u,c;return z(e,function(e){switch(e.j){case 1:i=[];for(var t=F(d),n=t.next();!n.done;n=t.next())r=n.value,(a=l.i.get(r.id))?(X.debug("(all) Stream "+r.id+" is being or has been set up"),i.push(a.promise)):(X.F("(all) setting up Stream "+r.id),l.i.set(r.id,{promise:new pe,Mb:!1}),i.push(r.createSegmentIndex()));return q(e,2),V(e,Promise.all(i),4);case 4:if(l.f)return e.return();G(e,3);break;case 2:if(o=W(e),l.f)return e.return();for(n=(e=F(d)).next();!n.done;n=e.next())s=n.value,l.i.get(s.id).promise.catch(function(){}),l.i.get(s.id).promise.reject(),l.i.delete(s.id);throw o;case 3:for(n=(t=F(d)).next();!n.done;n=t.next())u=n.value,(c=l.i.get(u.id)).Mb||(c.promise.resolve(),c.Mb=!0,X.F("(all) setup Stream "+u.id));I(e)}})})}function co(t,e){if(!t.f){var n=ko(e);if(!e.Oa&&null!=e.La&&!e.Wa)if(e.La=null,e.Sa)X.debug(n,"skipping update and clearing the buffer"),wo(t,e,e.Kc,e.lc);else{try{var i=function(t,e){if(mo(e))return Mn(t.a.O,e.stream.originalId||""),null;var n=ko(e),i=t.a.Za(),r=lo(t,e,i);X.J(n,"timeNeeded="+r);var a=bo(t,e.stream),o=vo(t,r),s=function(e,t,n){return"text"==t?null==(e=e.a).b||e.b<n?0:e.b-Math.max(n,e.a):zt(e=kn(e,t),n)}(t.a.O,e.type,i);X.J(n,"update_:","presentationTime="+i,"bufferedAhead="+s);var u=Math.max(t.c.minBufferTime||0,t.g.rebufferingGoal,t.g.bufferingGoal)*t.l;if(r>=t.c.presentationTimeline.ca())return X.debug(n,"buffered to end of presentation"),e.endOfStream=!0,"video"==e.type&&(r=t.b.get("text"))&&"application/cea-608"==r.stream.mimeType&&(r.endOfStream=!0),null;if(e.endOfStream=!1,(e.ka=o)!=a)return X.debug(n,"need Period "+o,"presentationTime="+i,"timeNeeded="+r,"currentPeriodIndex="+a),null;if(u<=s)return X.J(n,"buffering goal met"),.5;if(n=xn(t.a.O,e.type),!(n=fo(t,e,i,n,a)))return 1;var c=1/0;return Array.from(t.b.values()).forEach(function(e){mo(e)||(e=lo(t,e,i),c=Math.min(c,e))}),r>=c+t.c.presentationTimeline.a?1:(e.Bd=0,function(e,l,d,t,f){var n=ko(l),h=e.c.periods[t];X.F(n,"fetchAndAppend_:","presentationTime="+d,"currentPeriod.startTime="+h.startTime,"reference.position="+f.position,"reference.startTime="+f.startTime,"reference.endTime="+f.endTime);var p=l.stream,i=e.c.presentationTimeline.ca(),r=e.c.periods[t+1];t=function(e,t,n,i,r){if(!t.vc)return Promise.resolve();var a=ko(t);return n=e.c.periods[n].startTime-t.stream.presentationTimeOffset,X.F(a,"setting timestamp offset to "+n),X.F(a,"setting append window start to "+i),X.F(a,"setting append window end to "+r),i=function(e,t,n,i,r){return"text"==t?(e.a.o=n,(e=e.a).f=i,e.h=r,Promise.resolve()):Promise.all([Pn(e,t,e.Pe.bind(e,t)),Pn(e,t,e.ug.bind(e,t,n)),Pn(e,t,e.rg.bind(e,t,i,r))])}(e.a.O,t.type,n,i,r),t.stream.initSegmentReference?(X.F(a,"fetching init segment"),e=yo(e,t,t.stream.initSegmentReference).then(function(e){if(!this.f)return X.F(a,"appending init segment"),An(this.a.O,t.type,e,null,null,t.stream.closedCaptions&&0<t.stream.closedCaptions.size)}.bind(e)).catch(function(e){return t.vc=!0,Promise.reject(e)}),Promise.all([i,e])):i}(e,l,t,Math.max(0,h.startTime-.1),r?r.startTime+.01:i),l.Oa=!0,l.vc=!1,X.J(n,"fetching segment"),i=yo(e,l,f),Promise.all([t,i]).then(function(e){if(!this.f&&!this.o)return t=this,n=l,i=d,r=h,a=p,o=f,s=e[1],u=ko(n),c=a.closedCaptions&&0<a.closedCaptions.size,null!=a.emsgSchemeIdUris&&0<a.emsgSchemeIdUris.length&&(new Ri).ia("emsg",t.K.bind(t,r,o,a.emsgSchemeIdUris)).parse(s),function(e,t,n){var i=ko(t);X.J(i,"checking buffer length");var r=Math.max(e.g.bufferBehind,e.c.presentationTimeline.a),a=En(e.a.O,t.type);if(null==a)return X.J(i,"buffer behind okay because nothing buffered:","presentationTime="+n,"bufferBehind="+r),Promise.resolve();var o=n-a,s=o-r;return s<=.01?(X.J(i,"buffer behind okay:","presentationTime="+n,"bufferedBehind="+o,"bufferBehind="+r,"underflow="+Math.abs(s)),Promise.resolve()):(X.F(i,"buffer behind too large:","presentationTime="+n,"bufferedBehind="+o,"bufferBehind="+r,"overflow="+s),e.a.O.remove(t.type,a,a+s).then(function(){this.f||X.F(i,"evicted "+s+" seconds")}.bind(e)))}(t,n,i).then(function(){if(!this.f)return X.F(u,"appending media segment"),An(this.a.O,n.type,s,o.startTime+r.startTime,o.endTime+r.startTime,c)}.bind(t)).then(function(){if(!this.f)return X.J(u,"appended media segment"),n.Cb=a,n.Ha=o,Promise.resolve()}.bind(t));var t,n,i,r,a,o,s,u,c}.bind(e)).then(function(){this.f||this.o||(l.Oa=!1,l.yd=!1,l.Sa||this.a.td(),To(this,l,0),function(e,t,n){if(!e.u){var i=ko(t);if(1==(t=Array.from(e.b.values())).length&&"text"==t[0].type||(e.u=t.every(function(e){return"text"==e.type||!e.Sa&&!e.Wa&&e.Ha})),e.u){for(X.debug(i,"startup complete"),n=bo(e,n),e.h[n]||so(e,n).then(function(){this.f||(X.F(i,"calling onCanSwitch()..."),this.a.ne())}.bind(e)).catch(ce.wc),n=0;n<e.c.periods.length;++n)so(e,n).catch(ce.wc);e.a.Yf&&(X.F(i,"calling onStartupComplete()..."),e.a.Yf())}}}(this,l,p),X.F(n,"finished fetch and append"))}.bind(e)).catch(function(e){this.f||this.o||(l.Oa=!1,"text"==l.type&&this.g.ignoreTextStreamFailures?(1001==e.code?X.m(n,"Text stream failed to download. Proceeding without it."):X.m(n,"Text stream failed to parse. Proceeding without it."),this.b.delete("text")):7001==e.code?(l.Oa=!1,l.La=null,To(this,l,0)):3017==e.code?function(e,t,n){var i=ko(t);if(Array.from(e.b.values()).some(function(e){return e!=t&&e.yd}))X.debug(i,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var r=Math.round(100*e.l);if(20<r)e.l-=.2;else{if(!(4<r))return X.error(i,"MediaSource threw QuotaExceededError too many times"),t.Xb=!0,e.o=!0,e.a.onError(n);e.l-=.04}X.m(i,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*e.l))+"%"),t.yd=!0}To(e,t,4)}(this,l,e):(X.error(n,"failed fetch and append: code="+e.code),l.Xb=!0,e.severity=2,xo(this,e)))}.bind(e))}(t,e,i,a,n),null)}(t,e);null!=i&&(To(t,e,i),e.Xb=!1)}catch(e){return void xo(t,e)}i=Array.from(t.b.values()),function(e,t){var s=ko(t),n=bo(e,t.stream);{var u,c;t.ka!=n&&(u=t.ka,(c=Array.from(e.b.values())).every(function(e){return e.ka==u||mo(e)})?c.every(go)?(X.debug(s,"all need Period "+u),so(e,u).then(function(){if(!this.f)if(c.every(function(e){var t=go(e),n=bo(this,e.stream);return!!mo(e)||t&&e.ka==u&&n!=u}.bind(this))){var e=this.c.periods[u];X.F(s,"calling onChooseStreams()...");var t=this.a.oe(e),n=new Map;t.variant&&t.variant.video&&n.set("video",t.variant.video),t.variant&&t.variant.audio&&n.set("audio",t.variant.audio),t.text&&n.set("text",t.text);for(var i=(t=F(this.b.keys())).next();!i.done;i=t.next())if(i=i.value,!n.has(i)&&"text"!=i)return X.error(s,"invalid Streams chosen: missing "+i+" Stream"),void this.a.onError(new Y(2,5,5005));for(i=(t=F(Array.from(n.keys()))).next();!i.done;i=t.next())if(i=i.value,!this.b.has(i)){if("text"!=i)return X.error(s,"invalid Streams chosen: unusable "+i+" Stream"),void this.a.onError(new Y(2,5,5005));ao(this,null,null,n.get("text"),e.startTime),n.delete(i)}for(i=(t=F(Array.from(this.b.keys()))).next();!i.done;i=t.next()){i=i.value;var r,a=this.b.get(i),o=n.get(i);o?((r=mo(a))&&(a.ka=u,a.Bd=e.startTime),io(this,o,!1,0,!1),r&&mo(a)||To(this,this.b.get(i),0)):this.b.delete(i)}X.F(s,"calling onCanSwitch()..."),this.a.ne()}else X.debug(s,"ignoring transition to Period",u,"since another is happening")}.bind(e)).catch(ce.wc)):X.debug(s,"all MediaStates need Period "+u+", but not all MediaStates are idle"):X.debug(s,"not all MediaStates need Period "+u))}}(t,e),t.u&&i.every(function(e){return e.endOfStream})&&(X.F(n,"calling endOfStream()..."),t.a.O.endOfStream().then(function(){var e;this.f||0!=(e=this.a.O.ca())&&e<this.c.presentationTimeline.ca()&&this.c.presentationTimeline.Ba(e)}.bind(t)))}}}function lo(e,t,n){return t.Cb&&t.Ha?(n=bo(e,t.Cb),e.c.periods[n].startTime+t.Ha.endTime):Math.max(n,t.Bd)}function fo(e,t,n,i,r){var a=ko(t);return t.Ha&&t.stream==t.Cb?(i=t.Ha.position+1,X.J(a,"next position known:","position="+i),po(e,t,r,i)):null==(a=t.Ha?(X.F(a,"next position unknown: another Stream buffered"),a=bo(e,t.Cb),ho(e,t,e.c.periods[a].startTime+t.Ha.endTime,r)):(X.F(a,"next position unknown: nothing buffered"),ho(e,t,i||n,r)))?null:((n=null)==i&&(n=po(e,t,r,Math.max(0,a-1))),n||po(e,t,r,a))}function ho(e,t,n,i){var r=ko(t);return e=e.c.periods[i],X.debug(r,"looking up segment:","presentationTime="+n,"currentPeriod.startTime="+e.startTime),n=Math.max(0,n-e.startTime),null==(t=t.stream.findSegmentPosition(n))&&X.m(r,"cannot find segment:","currentPeriod.startTime="+e.startTime,"lookupTime="+n),t}function po(e,t,n,i){var r=ko(t);return n=e.c.periods[n],(t=t.stream.getSegmentReference(i))?(e=(i=e.c.presentationTimeline).Wb(),i=i.xb(),n.startTime+t.endTime<e||n.startTime+t.startTime>i?(X.J(r,"segment is not available:","currentPeriod.startTime="+n.startTime,"reference.startTime="+t.startTime,"reference.endTime="+t.endTime,"availabilityStart="+e,"availabilityEnd="+i),null):t):(X.F(r,"segment does not exist:","currentPeriod.startTime="+n.startTime,"position="+i),null)}function mo(e){return e&&"text"==e.type&&"application/cea-608"==e.stream.mimeType}function go(e){return!e.Oa&&null==e.La&&!e.Sa&&!e.Wa}function vo(e,t){t=Ma(e.c.periods,t+he);return t?e.c.periods.indexOf(t):0}function bo(e,t){for(var n=e.c.periods,i=0;i<n.length;i++){for(var r=n[i],a=new Set,o=F(r.variants),s=o.next();!s.done;s=o.next())(s=s.value).audio&&a.add(s.audio),s.video&&a.add(s.video),s.video&&s.video.trickModeVideo&&a.add(s.video.trickModeVideo);for(o=(r=F(r.textStreams)).next();!o.done;o=r.next())a.add(o.value);if(a.has(t))return i}return-1}function yo(e,t,n){var i=mr(n.c(),n.b,n.a,e.g.retryParameters);return X.J("fetching: reference=",n),e=e.a.Db.request(1,i),(t.fb=e).promise.then(function(e){return t.fb=null,e.data})}function wo(r,a,o,s){return H(function e(){var t,n,i;return z(e,function(e){switch(e.j){case 1:return t=ko(a),a.Sa=!1,a.Kc=!1,a.lc=0,a.Wa=!0,a.Cb=null,a.Ha=null,X.debug(t,"clearing buffer"),V(e,s?(n=r.a.Za(),i=r.a.O.ca(),r.a.O.remove(a.type,n+s,i)):In(r.a.O,a.type).then(function(){if(!this.f&&o)return this.a.O.flush(a.type)}.bind(r)),2);case 2:if(r.f)return e.return();X.debug(t,"cleared buffer"),a.Wa=!1,a.endOfStream=!1,To(r,a,0),I(e)}})})}function To(n,i,e){var t=ko(i),r=i.type;"text"!=r||n.b.has(r)?(X.J(t,"updating in "+e+" seconds"),i.La=new Ae(function(){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return q(e,2),V(e,co(n,i),4);case 4:G(e,0);break;case 2:t=W(e),n.a&&n.a.onError(t),I(e)}})})}).R(e)):X.F(t,"Text stream is unloaded. No update is needed.")}function So(e){null!=e.La&&(e.La.stop(),e.La=null)}function Eo(t){return H(function e(){return z(e,function(e){if(1===e.j){if(t.fb)return V(e,t.fb.abort(),0);e.C(0)}})})}function xo(e,t){Pe(e.H).then(function(){this.f||(this.a.onError(t),t.handled||this.g.failureCallback(t))}.bind(e))}function ko(e){return"("+e.type+":"+e.stream.id+")"}function Ao(e,t,n,i,r,a){if(200<=n&&n<=299&&202!=n)return{uri:r||i,vd:i,data:t,headers:e,fromCache:!!e["x-shaka-from-cache"]};r=null;try{r=ve(t)}catch(e){}throw X.debug("HTTP error text:",r),new Y(401==n||403==n?2:1,1,1001,i,n,r,e,a)}function Mo(e,t,n,i){var r=new Mo.b;ot(t.headers).forEach(function(e,t){r.append(t,e)});var a,o=new Mo.a,s={Ud:!1,He:!1};return e=new Re(e=Mo.l(e,n,{body:t.body||void 0,headers:r,method:t.method,signal:o.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},s,i),function(){return s.Ud=!0,o.abort(),Promise.resolve()}),(t=t.retryParameters.timeout)&&((a=new Me(function(){s.He=!0,o.abort()})).R(t/1e3),e.finally(function(){a.stop()})),e}function Io(s,t,u,n){var i=new Io.f,r=Date.now(),c=0;return new Re(new Promise(function(a,o){for(var e in i.open(t.method,s,!0),i.responseType="arraybuffer",i.timeout=t.retryParameters.timeout,i.withCredentials=t.allowCrossSiteCredentials,i.onabort=function(){o(new Y(1,1,7001,s,u))},i.onload=function(e){for(var t=(e=e.target).getAllResponseHeaders().trim().split("\r\n"),n={},i=(t=F(t)).next();!i.done;i=t.next())n[(i=i.value.split(": "))[0].toLowerCase()]=i.slice(1).join(": ");try{var r=Ao(n,e.response,e.status,s,e.responseURL,u);a(r)}catch(e){o(e)}},i.onerror=function(e){o(new Y(1,1,1002,s,e,u))},i.ontimeout=function(){o(new Y(1,1,1003,s,u))},i.onprogress=function(e){var t=Date.now();(100<t-r||e.lengthComputable&&e.loaded==e.total)&&(n(t-r,e.loaded-c,e.total-e.loaded),c=e.loaded,r=t)},t.headers)i.setRequestHeader(e.toLowerCase(),t.headers[e]);i.send(t.body)}),function(){return i.abort(),Promise.resolve()})}function Po(){this.a=this.f=this.b=0,this.c=new Map,this.g=0}function Co(e,t,n){this.h=e,this.b=new Map,this.c=!1,this.g=t,this.f=n,this.a=new Po}function Ro(c,e,l,t,d,f){var h=function(e,t){e.b+=t;var n=e.g;return e.g++,e.c.set(n,t),n}(c.a,t);t=c.b.get(e)||Promise.resolve(),c.b.set(e,t.then(function(){return H(function e(){var r,a,o,s,u;return z(e,function(e){switch(e.j){case 1:return V(e,(n=c,i=l,H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return V(e,n.h.request(1,i).promise,2);case 2:return t=e.s,e.return(t.data)}})})),2);case 2:if(r=e.s,c.c)throw new Y(2,9,7001);if(d)for(var t in a=new Uint8Array(r),(o=new Oi(a)).data)u=Number(t),s=o.data[u],u=o.a[u],c.f(s,u);return c.a.close(h,r.byteLength),t=c.a,c.g(0==t.b?0:t.f/t.b,c.a.a),e.return(f(r))}var n,i})})}))}function No(e,t){var n=this;this.c=e,this.b=e.objectStore(t),this.a=new pe,e.onabort=function(e){e.preventDefault(),n.a.reject()},e.onerror=function(e){e.preventDefault(),n.a.reject()},e.oncomplete=function(){n.a.resolve()}}function Do(i,r){return new Promise(function(t,e){var n=i.b.openCursor();n.onerror=e,n.onsuccess=function(e){if(!(e=e.target.result))return t();r(e.key,e.value,e),e.continue()}})}function Lo(e){this.b=e,this.a=[]}function Uo(e,t){return _o(e,t,"readwrite")}function _o(e,t,n){var i=new No(n=e.b.transaction([t],n),t);return e.a.push(i),i.promise().then(function(){He(e.a,i)},function(){He(e.a,i)}),i}function Oo(e,t,n){this.b=new Lo(e),this.c=t,this.a=n}function jo(e){return Promise.reject(new Y(2,9,9011,"Cannot add new value to "+e))}function Ko(e,t,n,i){t=(e=Uo(e.b,t)).store();for(var r={},a=(n=F(n)).next();!a.done;r={key:r.key},a=n.next())r.key=a.value,t.delete(r.key).onsuccess=function(e){return function(){return i(e.key)}}(r);return e.promise()}function Bo(u,c,l){return H(function e(){var t,n,i,r,a,o,s;return z(e,function(e){switch(e.j){case 1:for(t=_o(u.b,c,"readonly"),n=t.store(),i={},r=[],a={},o=F(l),s=o.next();!s.done;a={request:a.request,key:a.key},s=o.next())a.key=s.value,a.request=n.get(a.key),a.request.onsuccess=function(e){return function(){null==e.request.result&&r.push(e.key),i[e.key]=e.request.result}}(a);return V(e,t.promise(),2);case 2:if(r.length)throw new Y(2,9,9012,"Could not find values for "+r);return e.return(l.map(function(e){return i[e]}))}})})}function Fo(e){this.a=new Lo(e)}function Ho(){this.a=new Map}function Vo(e,t,n){if(!(e=e.a.get(t)))throw new Y(2,9,9013,"Could not find mechanism with name "+t);if(!(t=e.getCells().get(n)))throw new Y(2,9,9013,"Could not find cell with name "+n);return t}function qo(e,t){Go.set(e,t)}$a.prototype.destroy=function(){var a=this;return H(function e(){var i,r;return z(e,function(e){switch(e.j){case 1:i=[];for(var t=F(a.b.values()),n=t.next();!n.done;n=t.next())So(r=n.value),i.push(Eo(r));return V(e,Promise.all(i),2);case 2:a.b.clear(),a.i.clear(),a.a=null,a.c=null,a.v=null,a.h=null,a.g=null,a.f=!0,I(e)}})})},$a.prototype.configure=function(e){this.g=e,this.H=new Ie({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0},!0)},$a.prototype.start=function(){var i=this;return H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return t=i.a.Za(),n=vo(i,t),(n=i.a.oe(i.c.periods[n])).variant||n.text?V(e,ao(i,n.variant?n.variant.audio:null,n.variant?n.variant.video:null,n.text,t),2):(X.error("init: no Streams chosen"),e.return(new Y(2,5,5005)));case 2:if(i.f)return e.return();X.debug("init: completed initial Stream setup"),i.a&&i.a.Pf&&(X.F("init: calling onInitialStreamsSetup()..."),i.a.Pf()),I(e)}})})},$a.prototype.K=function(e,t,n,i){var r=i.reader.wd(),a=i.reader.wd(),o=i.reader.I(),s=i.reader.I(),u=i.reader.I(),c=i.reader.I();i=i.reader.gb(i.reader.N.byteLength-i.reader.ga()),e=e.startTime+t.startTime+s/o,n.includes(r)&&("urn:mpeg:dash:event:2012"==r?this.a.Qf():this.a.onEvent(new Oe("emsg",{detail:{startTime:e,endTime:e+u/o,schemeIdUri:r,value:a,timescale:o,presentationTimeDelta:s,eventDuration:u,id:c,messageData:i}})))},L("shaka.net.HttpFetchPlugin",Mo),Mo.l=function(d,f,h,p,m){return H(function e(){var t,n,a,o,s,u,i,c,r,l;return z(e,function(e){switch(e.j){case 1:return i=Mo.g,r=Mo.c,o=a=0,s=Date.now(),q(e,2),V(e,i(d,h),4);case 4:return t=e.s,u=t.clone().body.getReader(),c=(i=t.headers.get("Content-Length"))?parseInt(i,10):0,new r({start:function(r){!function i(){return H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return q(e,2),V(e,u.read(),4);case 4:t=e.s,G(e,3);break;case 2:return n=W(e),X.F("error reading from stream",n.message),e.return();case 3:t.done||(a+=t.value.byteLength),(100<(n=Date.now())-s||t.done)&&(m(n-s,a-o,c-a),o=a,s=n),t.done?r.close():(r.enqueue(t.value),i()),I(e)}})})}()}}),V(e,t.arrayBuffer(),5);case 5:n=e.s,G(e,3);break;case 2:if(r=W(e),p.Ud)throw new Y(1,1,7001,d,f);if(p.He)throw new Y(1,1,1003,d,f);throw new Y(1,1,1002,d,r,f);case 3:return l={},t.headers.forEach(function(e,t){l[t.trim()]=e}),e.return(Ao(l,n,t.status,d,t.url,f))}})})},Mo.isSupported=function(){if(!d.ReadableStream)return!1;try{new ReadableStream({})}catch(e){return!1}return!(!d.fetch||!d.AbortController)},Mo.isSupported,Mo.g=d.fetch,Mo.a=d.AbortController,Mo.c=d.ReadableStream,Mo.b=d.Headers,Mo.isSupported()&&(Xe("http",Mo,2),Xe("https",Mo,2)),L("shaka.net.HttpXHRPlugin",Io),Io.f=d.XMLHttpRequest,Xe("http",Io,1),Xe("https",Io,1),Po.prototype.close=function(e,t){var n;this.c.has(e)&&(n=this.c.get(e),this.c.delete(e),this.f+=n,this.a+=t)},Co.prototype.destroy=function(){return this.c=!0,Promise.all(this.b.values()).then(function(){},function(){})},No.prototype.abort=function(){try{this.c.abort()}catch(e){}return this.a.catch(function(){})},No.prototype.store=function(){return this.b},No.prototype.promise=function(){return this.a},Lo.prototype.destroy=function(){return Promise.all(this.a.map(function(e){return e.abort()}))},(e=Oo.prototype).destroy=function(){return this.b.destroy()},e.hasFixedKeySpace=function(){return!0},e.addSegments=function(){return jo(this.c)},e.removeSegments=function(e,t){return Ko(this,this.c,e,t)},e.getSegments=function(n){var i=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return V(e,Bo(i,i.c,n),2);case 2:return t=e.s,e.return(t.map(function(e){return i.Wd(e)}))}})})},e.addManifests=function(){return jo(this.a)},e.updateManifestExpiration=function(t,n){var e=Uo(this.b,this.a),i=e.store();return i.get(t).onsuccess=function(e){(e=e.target.result)&&(e.expiration=n,i.put(e,t))},e.promise()},e.removeManifests=function(e,t){return Ko(this,this.a,e,t)},e.getManifests=function(n){var i=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return V(e,Bo(i,i.a,n),2);case 2:return t=e.s,e.return(t.map(function(e){return i.mc(e)}))}})})},e.getAllManifests=function(){var i=this;return H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return t=_o(i.b,i.a,"readonly"),n=new Map,V(e,Do(t,function(e,t){n.set(e,i.mc(t))}),2);case 2:return V(e,t.promise(),3);case 3:return e.return(n)}})})},e.Wd=function(e){return e},e.mc=function(e){return e},e.add=function(s,u){var c=this;return H(function e(){var i,r,a,o;return z(e,function(e){switch(e.j){case 1:i=Uo(c.b,s),r=i.store(),a=[];for(var t=F(u),n=t.next();!n.done;n=t.next())o=n.value,r.add(o).onsuccess=function(e){a.push(e.target.result)};return V(e,i.promise(),2);case 2:return e.return(a)}})})},Fo.prototype.destroy=function(){return this.a.destroy()},Fo.prototype.getAll=function(){var i=this;return H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return t=_o(i.a,"session-ids","readonly"),n=[],V(e,Do(t,function(e,t){n.push(t)}),2);case 2:return V(e,t.promise(),3);case 3:return e.return(n)}})})},Fo.prototype.add=function(e){for(var t=Uo(this.a,"session-ids"),n=t.store(),i=(e=F(e)).next();!i.done;i=e.next())n.add(i.value);return t.promise()},Fo.prototype.remove=function(i){var n=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return V(e,Do(t=Uo(n.a,"session-ids"),function(e,t,n){0<=i.indexOf(t.sessionId)&&n.delete()}),2);case 2:return V(e,t.promise(),0)}})})},Ho.prototype.destroy=function(){for(var e=[],t=F(this.a.values()),n=t.next();!n.done;n=t.next())e.push(n.value.destroy());return this.a.clear(),Promise.all(e)},Ho.prototype.init=function(){var n=this;Go.forEach(function(e,t){e=e();e?n.a.set(t,e):X.info("Skipping "+t+" as it is not supported on this platform")});for(var e=[],t=F(this.a.values()),i=t.next();!i.done;i=t.next())e.push(i.value.init());return Promise.all(e)},Ho.prototype.erase=function(){var i=this;return H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return t=Array.from(i.a.values()),(n=0<t.length)||Go.forEach(function(e){(e=e())&&t.push(e)}),V(e,Promise.all(t.map(function(e){return e.erase()})),2);case 2:if(!n)return V(e,Promise.all(t.map(function(e){return e.destroy()})),0);e.C(0)}})})},L("shaka.offline.StorageMuxer.register",qo),L("shaka.offline.StorageMuxer.unregister",function(e){Go.delete(e)});var Go=new Map;function Wo(e){Oo.apply(this,arguments)}function zo(e){return function(e){var t=e.streams.filter(function(e){return"audio"==e.contentType}),i=e.streams.filter(function(e){return"video"==e.contentType});{var r,n,a;t.every(function(e){return e.variantIds})&&i.every(function(e){return e.variantIds})||(t.forEach(function(e){e.variantIds=[]}),i.forEach(function(e){e.variantIds=[]}),r=0,i.length&&!t.length&&(X.debug("Found video-only content. Creating variants for video."),n=r++,i.forEach(function(e){e.variantIds.push(n)})),!i.length&&t.length&&(X.debug("Found audio-only content. Creating variants for audio."),a=r++,t.forEach(function(e){e.variantIds.push(a)})),i.length&&t.length&&(X.debug("Found audio-video content. Creating variants."),t.forEach(function(n){i.forEach(function(e){var t=r++;n.variantIds.push(t),e.variantIds.push(t)})})))}}(e),e.streams.forEach(function(){}),{startTime:e.startTime,streams:e.streams.map(Xo)}}function Xo(e){var t=e.initSegmentUri?$o(e.initSegmentUri):null;return{id:e.id,originalId:null,primary:e.primary,presentationTimeOffset:e.presentationTimeOffset,contentType:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,initSegmentKey:t,encrypted:e.encrypted,keyId:e.keyId,segments:e.segments.map(Yo),variantIds:e.variantIds}}function Yo(e){var t=$o(e.uri);return{startTime:e.startTime,endTime:e.endTime,dataKey:t}}function $o(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new Y(2,9,9004,"Could not parse uri "+e)}function Jo(e,t,n,i){Oo.call(this,e,t,n),this.f=i}function Qo(){this.g=this.c=this.b=this.a=this.f=null}function Zo(e,t,n,i){this.a=e,this.g=t,this.f=n,this.c=i,this.b=["offline:",e,"/",t,"/",n,"/",i].join("")}function es(e){if(null==(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e)))return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var n=e[2];if(!n)return null;var i=e[3];return i&&null!=t?new Zo(t,n,i,Number(e[4])):null}function ts(e,t){this.b=e,this.a=t}function ns(n,t,i){var e=t.streams.filter(function(e){return"audio"==e.contentType}),r=t.streams.filter(function(e){return"video"==e.contentType}),e=function(e,t,n){for(var i=new Set,r=F(t),a=r.next();!a.done;a=r.next()){var o=F(a.value.variantIds);for(a=o.next();!a.done;a=o.next())i.add(a.value)}for(r=F(n),a=r.next();!a.done;a=r.next())for(o=F(a.value.variantIds),a=o.next();!a.done;a=o.next())i.add(a.value);for(r=new Map,i=F(i),a=i.next();!a.done;a=i.next())a=a.value,r.set(a,{id:a,language:"",primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0});for(t=F(t),i=t.next();!i.done;i=t.next())for(i=i.value,a=is(e,i),o=F(i.variantIds),i=o.next();!i.done;i=o.next())(i=r.get(i.value)).language=a.language,i.primary=i.primary||a.primary,i.audio=a;for(n=F(n),t=n.next();!t.done;t=n.next())for(i=t.value,t=is(e,i),a=F(i.variantIds),i=a.next();!i.done;i=a.next())(i=r.get(i.value)).primary=i.primary||t.primary,i.video=t;return r}(n,e,r),r=t.streams.filter(function(e){return"text"==e.contentType}).map(function(e){return is(n,e)});return t.streams.forEach(function(e){e=e.segments.map(function(e,t){return rs(n,t,e)}),i.Eb(e,t.startTime)}),{startTime:t.startTime,variants:Array.from(e.values()),textStreams:r}}function is(n,e){var t,i,r=new Qi(a=e.segments.map(function(e,t){return rs(n,t,e)})),a={id:e.id,originalId:e.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(e){return r.find(e)},getSegmentReference:function(e){return r.get(e)},initSegmentReference:null,presentationTimeOffset:e.presentationTimeOffset,mimeType:e.mimeType,codecs:e.codecs,width:e.width||void 0,height:e.height||void 0,frameRate:e.frameRate||void 0,pixelAspectRatio:e.pixelAspectRatio||void 0,kind:e.kind,encrypted:e.encrypted,keyId:e.keyId,language:e.language,label:e.label||null,type:e.contentType,primary:e.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null};return null!=e.initSegmentKey&&(a.initSegmentReference=(t=n,e=e.initSegmentKey,i=new Zo("segment",t.b,t.a,e),new Yi(function(){return[i.toString()]},0,null))),a}function rs(e,t,n){var i=new Zo("segment",e.b,e.a,n.dataKey);return new $i(t,n.startTime,n.endTime,function(){return[i.toString()]},0,null)}function as(){this.a=null}function os(e){var t=es(e);return t&&"manifest"==t.a?os.h(e):t&&"segment"==t.a?os.i(t.key(),t):Ne(new Y(2,1,9004,e))}function ss(v,b,y){return H(function e(){var l,p,m,g;return z(e,function(e){switch(e.j){case 1:l=[];for(var t=[],n=F(y),i=n.next();!i.done;i=n.next()){i=i.value;for(var r=!1,a=F(t),o=a.next();!o.done;o=a.next())if(o=o.value,s=o.info,u=i,s.keySystem==u.keySystem&&s.licenseUri==u.licenseUri&&Ve(s.audioCapabilities,u.audioCapabilities,c)&&Ve(s.videoCapabilities,u.videoCapabilities,c)){o.sessionIds.push(i.sessionId),r=!0;break}r||t.push({info:i,sessionIds:[i.sessionId]})}p=F(t),m=p.next();case 2:if(m.done){e.C(4);break}return g=m.value,d=v,f=b,h=g,g=H(function e(){var u,c,l;return z(e,function(e){switch(e.j){case 1:return u=new wt({Db:f,onError:function(){},yc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),q(e,2),u.configure(d),V(e,(t=u,n=h.info.keySystem,i=h.info.licenseUri,r=h.info.serverCertificate,a=h.info.audioCapabilities,o=h.info.videoCapabilities,(s=new Map).set(n,{audioCapabilities:a,videoCapabilities:o,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:n,drmInfos:[{keySystem:n,licenseServerUri:i,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:r,initData:null,keyIds:null}]}),Ct(t,s)),4);case 4:G(e,3);break;case 2:return c=W(e),X.m("Error initializing EME",c),V(e,u.destroy(),5);case 5:return e.return([]);case 3:return q(e,6),V(e,Et(u),8);case 8:G(e,7);break;case 6:return c=W(e),X.m("Error setting server certificate",c),V(e,u.destroy(),9);case 9:return e.return([]);case 7:return l=[],V(e,Promise.all(h.sessionIds.map(function(n){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return q(e,2),V(e,(r=u,a=n,H(function e(){var t,n,i;return z(e,function(e){switch(e.j){case 1:return V(e,Rt(r,a),2);case 2:return(t=e.s)?(n=[],(i=r.b.get(t))&&(i.Ca=new pe,n.push(i.Ca)),X.J("Attempting to remove session",a),n.push(t.remove()),V(e,Promise.all(n),0)):(X.J("Ignoring attempt to remove missing session",a),e.return())}})})),4);case 4:l.push(n),G(e,0);break;case 2:t=W(e),X.m("Error deleting offline session",t),I(e)}var r,a})})})),10);case 10:return V(e,u.destroy(),11);case 11:return e.return(l)}var t,n,i,r,a,o,s})}),V(e,g,5);case 5:g=e.s,l=l.concat(g),m=p.next(),e.C(2);break;case 4:return e.return(l)}var d,f,h,s,u;function c(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType}})})}function us(e,t){var n=du(),i=this;this.h=t,this.c=e,this.f=n,this.i=null,this.g=[],this.b=this.a=null,this.l=!0,this.o=Promise.resolve().then(function(){return r=i,H(function e(){return z(e,function(e){if(1===e.j){if(r.l){var t,n=!(0==r.g.length||r.a&&!r.a.$a)&&(r.a&&(r.a.za.eb(),r.a=null),(t=(n=r.g.shift()).create(r.f))?(n.za.Fb(),r.a={node:t.node,payload:t.payload,$a:t.$a,za:n.za}):n.za.zc(),!0);return n=n?Promise.resolve():r.a?(i=r,H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return i.c=i.h.sf(i.c,i.f,i.a.node,i.a.payload),q(e,2),i.b=i.h.Ze(i.c,i.f,i.a.payload),V(e,i.b.promise,4);case 4:i.b=null,i.c==i.a.node&&(i.a.za.xc(),i.a=null),G(e,0);break;case 2:return 7001==(t=W(e)).code?i.a.za.eb():i.a.za.onError(t),i.a=null,i.b=null,V(e,(n=i).h.handleError(i.f,t),5);case 5:n.c=e.s,I(e)}})})):(r.h.Of(r.c),r.i=new pe,r.i),V(e,n,1)}e.C(0)}var i})});var r})}function cs(e,t){var n={Fb:function(){},xc:function(){},eb:function(){},onError:function(){},zc:function(){},Sg:function(){}};return e.g.push({create:t,za:n}),e.b&&e.b.abort(),ls(e),n}function ls(e){e.i&&(e.i.resolve(),e.i=null)}function ds(e){this.a=null;for(var t=0;t<e.textTracks.length;++t){var n=e.textTracks[t];n.mode="disabled","Shaka Player TextTrack"==n.label&&(this.a=n)}this.a||(this.a=e.addTextTrack("subtitles","Shaka Player TextTrack")),this.a.mode="hidden"}function fs(e){if(e.startTime>=e.endTime)return X.m("Invalid cue times: "+e.startTime+" - "+e.endTime),null;var t=new VTTCue(e.startTime,e.endTime,e.payload);t.lineAlign=e.lineAlign,t.positionAlign=e.positionAlign,e.size&&(t.size=e.size);try{t.align=e.textAlign}catch(e){}return"center"==e.textAlign&&"center"!=t.align&&(t.align="middle"),"vertical-lr"==e.writingMode?t.vertical="lr":"vertical-rl"==e.writingMode&&(t.vertical="rl"),1==e.lineInterpretation&&(t.snapToLines=!1),null!=e.line&&(t.line=e.line),null!=e.position&&(t.position=e.position),t}function hs(e,t){var n=e.mode;e.mode="showing"==n?"showing":"hidden";for(var i=e.cues,r=i.length-1;0<=r;r--){var a=i[r];a&&t(a)&&e.removeCue(a)}e.mode=n}function ps(e,t,n,i,r){var a,o=r in i,s=!0;for(a in t){var u=r+"."+a,c=o?i[r]:n[a];o||a in n?void 0===t[a]?void 0===c||o?delete e[a]:e[a]=Be(c):c.constructor==Object&&t[a]&&t[a].constructor==Object?(e[a]||(e[a]=Be(c)),u=ps(e[a],t[a],c,i,u),s=s&&u):typeof t[a]!=typeof c||null==t[a]||"function"!=typeof t[a]&&t[a].constructor!=c.constructor?(X.jc("Invalid config, wrong type for "+u),s=!1):("function"==typeof n[a]&&n[a].length!=t[a].length&&X.Z("Unexpected number of arguments for "+u),e[a]=t[a]):(X.jc("Invalid config, unrecognized key "+u),s=!1)}return s}function ms(e,t){for(var n={},i=n,r=0,a=0;!((r=e.indexOf(".",r))<0);)0!=r&&"\\"==e[r-1]||(i[a=e.substring(a,r).replace(/\\\./g,".")]={},i=i[a],a=r+1),r+=1;return i[e.substring(a).replace(/\\\./g,".")]=t,n}function gs(){}function vs(){var e=5e5,t=1/0;navigator.connection&&(navigator.connection.downlink&&(e=1e6*navigator.connection.downlink),navigator.connection.saveData&&(t=360));var n={retryParameters:Ce(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:Nt,fairPlayTransform:!0,updateExpirationTime:1},i={retryParameters:Ce(),availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,dash:{customScheme:function(e){if(e)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1},hls:{ignoreTextStreamFailures:!1,useFullSegmentsForStartTime:!1}},r={retryParameters:Ce(),failureCallback:function(e){return X.error("Unhandled streaming error",e),[e]},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0};(gt("Web0S")||ht()||gt("CrKey"))&&(r.stallSkip=0);var a={trackSelectionCallback:function(t){return H(function e(){return z(e,function(e){if(1===e.j)return e.return(t)})})},progressCallback:function(e,t){return[e,t]},usePersistentLicense:!0},o={drm:n,manifest:i,streaming:r,offline:a,abrFactory:Kn,abr:{enabled:!0,defaultBandwidthEstimate:e,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:t,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return a.trackSelectionCallback=function(t){return H(function e(){return z(e,function(e){if(1===e.j)return e.return(function(e,t){var n=e.filter(function(e){return"variant"==e.type}),i=[],r=_n(t,n.map(function(e){return e.language}));r&&(i=n.filter(function(e){return Ln(e.language)==r})),0==i.length&&(i=n.filter(function(e){return e.primary})),0==i.length&&(1<new Set(n.map(function(e){return e.language})).size&&X.m("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),i=n);var a=i.filter(function(e){return e.height&&e.height<=480});{var o;a.length&&(a.sort(function(e,t){return t.height-e.height}),i=a.filter(function(e){return e.height==a[0].height})),n=[],i.length&&(o=Math.floor(i.length/2),i.sort(function(e,t){return e.bandwidth-t.bandwidth}),n.push(i[o]))}for(i=F(e),o=i.next();!o.done;o=i.next())"text"==(o=o.value).type&&n.push(o);return n}(t,o.preferredAudioLanguage))})})},o}function bs(e,t,n){var i={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return ps(e,t,n||vs(),i,"")}function ys(){this.a=null,this.b=[]}function ws(e,t){var n;null==e.a?e.a={timestamp:Date.now()/1e3,state:t,duration:0}:(n=Date.now()/1e3,e.a.duration=n-e.a.timestamp,e.a.state!=t&&(e.b.push(e.a),e.a={timestamp:n,state:t,duration:0}))}function Ts(e,t){var n=0;e.a&&e.a.state==t&&(n+=e.a.duration);for(var i=F(e.b),r=i.next();!r.done;r=i.next())n+=(r=r.value).state==t?r.duration:0;return n}function Ss(){this.b=this.c=null,this.a=[]}function Es(){this.f=this.u=this.h=this.b=this.i=this.l=this.o=this.g=this.v=NaN,this.a=new ys,this.c=new Ss}function xs(e,t){var n,s=this;Ke.call(this),this.i=pu,this.a=null,this.ob=!1,this.g=new Ze,this.Lc=this.l=this.Ob=this.c=this.u=this.f=this.ec=this.D=this.fc=this.H=this.qb=this.o=this.G=this.h=this.T=null,this.ke=1e9,this.hc=new Set,this.sb=!0,this.sa=null,this.je=!1,this.ge=0,this.ra=null,this.ea=new aa,this.b=_s(this),this.ic={width:1/0,height:1/0},this.v=null,this.Pb=new pa(this.b.preferredAudioLanguage,this.b.preferredVariantRole,this.b.preferredAudioChannelCount),this.qa=this.b.preferredTextLanguage,this.nb=this.b.preferredTextRole,this.Mc=[],t&&t(this),this.T=(n=this,new We(function(e,t){n.l&&n.l.segmentDownloaded(e,t)})),this.g.B(d,"online",function(){s.Cd()}),this.K={name:"detach"},this.V={name:"attach"},this.Ma={name:"unload"},this.Zc={name:"manifest-parser"},this.Uc={name:"manifest"},this.pb={name:"media-source"},this.Nc={name:"drm-engine"},this.$={name:"load"},this.dd={name:"src-equals-drm-engine"},this.rb={name:"src-equals"};var i=new Map;i.set(this.V,function(e,t){return Ue((n=s,t=t,null==(e=e).w&&(e.w=t.w,n.g.B(e.w,"error",function(){var e=Zs(n);e&&n.Ra(e)})),n.a=e.w,Promise.resolve()));var n}),i.set(this.K,function(e){return e.w&&(s.g.pa(e.w,"error"),e.w=null),s.a=null,Ue(e=Promise.resolve())}),i.set(this.Ma,function(e){return Ue(Is(s,e))}),i.set(this.pb,function(e){var r,a;return r=s,a=e,Ue(e=H(function e(){var t,n,i;return z(e,function(e){switch(e.j){case 1:return t=new(d.muxjs?Vt:qt),n=r.b.textDisplayFactory,i=new n,r.Rc=n,V(e,(i=new bn(a.w,t,i)).u,2);case 2:r.G=i,I(e)}})}))}),i.set(this.Zc,function(e,t){var r,a,o;return Ue((r=s,a=e,o=t,H(function e(){var t,n,i;return z(e,function(e){switch(e.j){case 1:if(a.Ea=o.Ea,a.mimeType=o.mimeType,a.uri=o.uri,t=a.uri,n=r.T,r.Ob=t,a.Ea){r.u=a.Ea(),e.C(2);break}return i=r,V(e,hr.create(t,n,r.b.manifest.retryParameters,a.mimeType),3);case 3:i.u=e.s;case 2:i=Be(r.b.manifest),o.w&&"AUDIO"===o.w.nodeName&&(i.disableVideo=!0),r.u.configure(i),I(e)}})})))}),i.set(this.Uc,function(e){return function(r,e){var a=e.uri,e=r.T;r.ec=new Ga(function(){return r.Be()}),function(e,t){e.b=t}(r.ec,function(e){Qs(r,"timelineregionadded",e)});var o={networkingEngine:e,filterNewPeriod:function(e){return r.Vc(e)},filterAllPeriods:function(e){return Os(r,e)},onTimelineRegionAdded:function(e){var t=r.ec;e:{for(var n=F(t.a),i=n.next();!i.done;i=n.next())if((i=i.value).schemeIdUri==e.schemeIdUri&&i.id==e.id&&i.startTime==e.startTime&&i.endTime==e.endTime){n=i;break e}n=null}null==n&&(t.a.add(e),t.b(e))},onEvent:function(e){return r.dispatchEvent(e)},onError:function(e){return r.Ra(e)}};return new Re(Promise.resolve().then(function(){return H(function e(){var i;return z(e,function(e){switch(e.j){case 1:return V(e,(i=r).u.start(a,o),2);case 2:if(i.c=e.s,r.dispatchEvent(new Oe("manifestparsed")),0==r.c.periods.length)throw new Y(2,4,4014);(n=r.c.periods).some(function(e){return e.variants.some(t)})&&(X.debug("Found variant with audio and video content, so filtering out audio-only content in all periods."),n.forEach(function(e){e.variants=e.variants.filter(t)})),I(e)}function t(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")}var n})})}),function(){return X.info("Aborting parser step..."),r.u.stop()})}(s,e)}),i.set(this.Nc,function(){var n;return Ue((n=s,H(function e(){return z(e,function(e){switch(e.j){case 1:return n.h=Ps(n,{Db:n.T,onError:function(e){n.Ra(e)},yc:function(e){eu(n,e)},onExpirationUpdated:function(e,t){tu(n,e,t)},onEvent:function(e){n.dispatchEvent(e)}}),n.h.configure(n.b.drm),V(e,Tt(n.h,Aa(n.c.periods),n.c.offlineSessionIds),2);case 2:Os(n,n.c.periods),I(e)}})})))}),i.set(this.$,function(e,t){return Ue((p=s,m=e,g=t,H(function e(){var c,l,d,f,h;return z(e,function(e){switch(e.j){case 1:return m.startTime=g.startTime,c=m.w,d=m.uri,p.Ob=d,p.H=new Pa({rc:function(){return m.w.playbackRate},Id:function(e){m.w.playbackRate=e},le:function(e){m.w.currentTime+=e}}),p.v=new Es,l=function(){return Hs(p)},d=function(){return Fs(p)},p.g.B(c,"playing",l),p.g.B(c,"pause",l),p.g.B(c,"ended",l),p.g.B(c,"ratechange",d),d=p.b.abrFactory,p.l&&p.Lc==d||(p.Lc=d,p.l=new d,p.l.configure(p.b.abr)),function(e,t){for(var n=0;n<t.length;n++){for(var i=t[n],r=new Map,a=F(i.variants),o=a.next();!o.done;o=a.next())if((o=o.value).video&&o.video.closedCaptions)for(var s,u=F((o=o.video).closedCaptions.keys()),c=u.next();!c.done;c=u.next())c=c.value,r.has(c)||(s={id:e.ke++,originalId:c,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"application/cea-608",codecs:"",kind:"caption",encrypted:!1,keyId:null,language:o.closedCaptions.get(c),label:null,type:"text",primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:o.roles,channelsCount:null,audioSamplingRate:null,closedCaptions:null},r.set(c,s));for(r=F(r.values()),a=r.next();!a.done;a=r.next())i.textStreams.push(a.value)}}(p,p.c.periods),p.Pb=new pa(p.b.preferredAudioLanguage,p.b.preferredVariantRole,p.b.preferredAudioChannelCount),p.qa=p.b.preferredTextLanguage,o=p.c.presentationTimeline,s=p.b.playRangeStart,u=p.b.playRangeEnd,0<s&&(o.X()?X.m("|playRangeStart| has been configured for live content. Ignoring the setting."):o.Ee(s)),u<o.ca()&&(o.X()?X.m("|playRangeEnd| has been configured for live content. Ignoring the setting."):o.Ba(u)),V(e,p.h.Qb(c),2);case 2:return p.l.init(function(e,t,n){t=void 0!==t&&t,n=void 0===n?0:n,X.debug("switch_");e:{for(var i=F(p.c.periods),r=i.next();!r.done;r=i.next())if((r=r.value).variants.includes(e)){i=r;break e}i=null}Ls(p,i,e,!0),p.f&&no(p.f,e,t,n)&&Ws(p)}),p.o=(r=p,a=m.startTime,new Fa(r.a,r.c,r.b.streaming,a,function(){r.qb&&ka(r.qb,!0),r.f&&function(n){function e(e){var t=n.a.O;return e="text"==e?null!=(e=t.a).a&&null!=e.b&&(i>=e.a&&i<e.b):Wt(e=kn(t,e),i,r)}var i=n.a.Za(),r=n.g.smallGapLimit,t=!1,a=vo(n,i);if(at(n.b.values(),function(e){return e.ka==a}))for(var o=F(n.b.keys()),s=o.next();!s.done;s=o.next())e(s=s.value)||(ro(n,n.b.get(s)),t=!0);else at(n.b.keys(),e)||(X.debug("(all): seeked: unbuffered seek: clearing all buffers"),n.b.forEach(function(e){ro(n,e)}),t=!0);t||X.debug("(all): seeked: buffered seek: presentationTime="+i)}(r.f),r.D&&Rs(r)},function(e){return r.dispatchEvent(e)})),p.qb=function(n){var e=new Ia(n.c);!function(e,t){e.b=t}(e,function(){zs(n)});var t=new Wa(n.ec);!function(e,t,n,i){e.a=t,e.b=n,e.c=i}(t,function(e){Qs(n,"timelineregionenter",e)},function(e){Qs(n,"timelineregionexit",e)},function(e,t){t||(Qs(n,"timelineregionenter",e),Qs(n,"timelineregionexit",e))});var i=new xa(n.a);return i.a.add(e),i.a.add(t),i}(p),d=Math.max(p.c.minBufferTime,p.b.streaming.rebufferingGoal),Cs(p,d),p.f=new $a((i=p).c,{Za:function(){return i.o.g()},getBandwidthEstimate:function(){return i.l.getBandwidthEstimate()},O:i.G,Db:i.T,oe:i.Mf.bind(i),ne:i.Te.bind(i),onError:i.Ra.bind(i),onEvent:function(e){return i.dispatchEvent(e)},Qf:i.Rf.bind(i),td:i.Wf.bind(i)}),p.f.configure(p.b.streaming),jn.Vd(p.c,p.b.preferredAudioChannelCount),p.i=mu,p.dispatchEvent(new Oe("streaming")),V(e,p.f.start(),3);case 3:p.b.streaming.startAtSegmentBoundary&&(f=p.o.g(),s=f,u=Ja((o=p).f),a=Qa(o.f),n=su(o),u=t(u,s),h=null!=(a=t(a,s))&&null!=u?Math.max(a,u):null!=a?a:null!=u?u:s,p.o.o(h)),p.c.periods.forEach(p.Vc.bind(p)),zs(p),Ws(p),f=su(p)||p.c.periods[0],h=f.variants.some(function(e){return e.primary}),p.b.preferredAudioLanguage||h||X.m("No preferred audio language set.  We will choose an arbitrary language initially"),Vs(p,f.variants),p.g.ua(c,"loadedmetadata",function(){p.v.b=Date.now()/1e3-g.Ld}),I(e)}function t(e,t){if(!e)return null;t=e.findSegmentPosition(t-n.startTime);return null!=t&&(t=e.getSegmentReference(t))?t.startTime+n.startTime:null}var n,i,r,a,o,s,u})})));var p,m,g}),i.set(this.dd,function(e){var n,i;return n=s,i=e,Ue(e=H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return t=fe,n.h=Ps(n,{Db:n.T,onError:function(e){n.Ra(e)},yc:function(e){eu(n,e)},onExpirationUpdated:function(e,t){tu(n,e,t)},onEvent:function(e){n.dispatchEvent(e)}}),n.h.configure(n.b.drm),t={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"video/mp4",codecs:"",encrypted:!0,keyId:null,language:"und",label:null,type:t.Ua,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0},V(e,Tt(n.h,[t],[]),2);case 2:return V(e,n.h.Qb(i.w),0)}})}))}),i.set(this.rb,function(e,t){return function(t,n,e){function i(){return Hs(t)}{var r;n.uri=e.uri,n.startTime=e.startTime,t.Ob=n.uri,t.v=new Es,t.o=new Ba(n.w),null!=n.startTime&&t.o.o(n.startTime),t.H=new Pa({rc:function(){return n.w.playbackRate},Id:function(e){n.w.playbackRate=e},le:function(e){n.w.currentTime+=e}}),Cs(t,t.b.streaming.rebufferingGoal),t.g.B(n.w,"playing",i),t.g.B(n.w,"pause",i),t.g.B(n.w,"ended",i),t.g.B(n.w,"ratechange",function(){return Fs(t)}),"none"!=t.a.preload&&t.g.ua(n.w,"loadedmetadata",function(){t.v.b=Date.now()/1e3-e.Ld}),t.a.audioTracks&&(t.g.B(t.a.audioTracks,"addtrack",function(){return zs(t)}),t.g.B(t.a.audioTracks,"removetrack",function(){return zs(t)}),t.g.B(t.a.audioTracks,"change",function(){return zs(t)})),t.a.textTracks&&(r=t.a.textTracks,t.g.B(r,"addtrack",function(){return zs(t)}),t.g.B(r,"removetrack",function(){return zs(t)}),t.g.B(r,"change",function(){return zs(t)}))}n.w.src=n.uri,(ht()||gt("Web0S"))&&n.w.load(),t.i=gu,t.dispatchEvent(new Oe("streaming"));var a=new pe;Ra(t.a,HTMLMediaElement.HAVE_METADATA,t.g,function(){a.resolve()});var o=!1;return t.Mc.push(function(){o=!0}),Ra(t.a,HTMLMediaElement.HAVE_CURRENT_DATA,t.g,function(){return H(function e(){return z(e,function(e){switch(e.j){case 1:if(o)return e.return();if(!function(e){var t=e.b.preferredAudioLanguage;{var n;""!=t&&(e.Dd(t),""!=(n=e.b.preferredVariantRole)&&e.Dd(t,n))}}(t),Ds(t).find(function(e){return"disabled"!=e.mode})){e.C(2);break}return V(e,new Promise(function(e){t.g.ua(t.a.textTracks,"change",e),new Me(e).R(1)}),2);case 2:if(o)return e.return();!function(e){var t=e.b.preferredTextLanguage;{var n;""!=t&&(e.Ed(t),""!=(n=e.b.preferredTextRole)&&e.Ed(t,n))}}(t),I(e)}})})}),t.a.error?a.reject(Zs(t)):"none"==t.a.preload&&(X.Z('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),a.resolve()),t.g.ua(t.a,"error",function(){a.reject(Zs(t))}),new Re(a,function(){return a.reject(new Y(2,7,7001)),Promise.resolve()})}(s,e,t)}),this.Ta=new us(this.K,{sf:function(e,t,n,i){var r=null;return e==s.K&&(r=n==s.K?s.K:s.V),e==s.V&&(r=n==s.K||t.w!=i.w?s.K:n==s.V?s.V:n==s.pb||n==s.$?s.pb:n==s.rb?s.dd:null),e==s.pb&&(r=n==s.$&&t.w==i.w?s.Zc:s.Ma),e==s.Zc&&(r=lu(s.$,s.Uc,s.Ma,n,t,i)),e==s.Uc&&(r=lu(s.$,s.Nc,s.Ma,n,t,i)),e==s.Nc&&(r=lu(s.$,s.$,s.Ma,n,t,i)),e==s.dd&&(r=n==s.rb&&t.w==i.w?s.rb:s.Ma),e!=s.$&&e!=s.rb||(r=s.Ma),e==s.Ma&&(r=i.w&&t.w==i.w?s.V:s.K),r},Ze:function(e,t,n){return s.dispatchEvent(new Oe("onstatechange",{state:e.name})),i.get(e)(t,n)},handleError:function(t,n){return H(function e(){return z(e,function(e){switch(e.j){case 1:return X.m("The walker saw an error:"),n instanceof Y?X.m("Error Code:",n.code):(X.m("Error Message:",n.message),X.m("Error Stack:",n.stack)),V(e,Is(s,t),2);case 2:return e.return(t.w?s.V:s.K)}})})},Of:function(e){s.dispatchEvent(new Oe("onstateidle",{state:e.name}))}}),e&&this.Qb(e,!0)}v(Wo,Oo),Wo.prototype.updateManifestExpiration=function(t,n){var e=Uo(this.b,this.a),i=e.store(),r=new pe;return i.get(t).onsuccess=function(e){(e=e.target.result)?(e.expiration=n,i.put(e),r.resolve()):r.reject(new Y(2,9,9012,"Could not find values for "+t))},e.promise().then(function(){return r})},Wo.prototype.mc=function(e){return{originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,periods:e.periods.map(zo),sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata}},Wo.prototype.Wd=function(e){return{data:e.data}},v(Jo,Oo),Jo.prototype.hasFixedKeySpace=function(){return this.f},Jo.prototype.addSegments=function(e){return this.f?jo(this.c):this.add(this.c,e)},Jo.prototype.addManifests=function(e){return this.f?jo(this.a):this.add(this.a,e)},Jo.prototype.mc=function(e){return null==e.expiration&&(e.expiration=1/0),e},(e=Qo.prototype).init=function(){var n=this,i=new pe,t=d.indexedDB.open("shaka_offline_db",4);return t.onsuccess=function(e){e=e.target.result;var t=(t=(n.f=e).objectStoreNames).contains("manifest")&&t.contains("segment")?(X.debug("Mounting v1 idb storage cell"),new Wo(e,"segment","manifest")):null;n.a=t,t=(t=e.objectStoreNames).contains("manifest-v2")&&t.contains("segment-v2")?(X.debug("Mounting v2 idb storage cell"),new Jo(e,"segment-v2","manifest-v2",!0)):null,n.b=t,t=(t=e.objectStoreNames).contains("manifest-v3")&&t.contains("segment-v3")?(X.debug("Mounting v3 idb storage cell"),new Jo(e,"segment-v3","manifest-v3",!1)):null,n.c=t,e=e.objectStoreNames.contains("session-ids")?(X.debug("Mounting session ID idb storage cell"),new Fo(e)):null,n.g=e,i.resolve()},t.onupgradeneeded=function(e){e=e.target.result;for(var t=F(["segment-v3","manifest-v3","session-ids"]),n=t.next();!n.done;n=t.next())n=n.value,e.objectStoreNames.contains(n)||e.createObjectStore(n,{autoIncrement:!0})},t.onerror=function(e){i.reject(new Y(2,9,9001,t.error)),e.preventDefault()},i},e.destroy=function(){var t=this;return H(function e(){return z(e,function(e){switch(e.j){case 1:if(t.a)return V(e,t.a.destroy(),2);e.C(2);break;case 2:if(t.b)return V(e,t.b.destroy(),4);e.C(4);break;case 4:if(t.c)return V(e,t.c.destroy(),6);e.C(6);break;case 6:if(t.g)return V(e,t.g.destroy(),8);e.C(8);break;case 8:t.f&&t.f.close(),I(e)}})})},e.getCells=function(){var e=new Map;return this.a&&e.set("v1",this.a),this.b&&e.set("v2",this.b),this.c&&e.set("v3",this.c),e},e.getEmeSessionCell=function(){return this.g},e.erase=function(){var i=this;return H(function e(){return z(e,function(e){switch(e.j){case 1:if(i.a)return V(e,i.a.destroy(),2);e.C(2);break;case 2:if(i.b)return V(e,i.b.destroy(),4);e.C(4);break;case 4:if(i.c)return V(e,i.c.destroy(),6);e.C(6);break;case 6:return i.f&&i.f.close(),V(e,(t=new pe,(n=d.indexedDB.deleteDatabase("shaka_offline_db")).onblocked=function(){X.m("Deleting","shaka_offline_db","is being blocked")},n.onsuccess=function(){t.resolve()},n.onerror=function(e){t.reject(new Y(2,9,9001,n.error)),e.preventDefault()},t),8);case 8:return i.f=null,i.a=null,i.b=null,i.c=null,V(e,i.init(),0)}var t,n})})},qo("idb",function(){return gt("CrKey")||!d.indexedDB?null:new Qo}),Zo.prototype.Aa=function(){return this.g},Zo.prototype.fa=function(){return this.f},Zo.prototype.key=function(){return this.c},Zo.prototype.toString=function(){return this.b},(e=as.prototype).configure=function(){},e.start=function(r){var a=this;return H(function e(){var t,n,i;return z(e,function(e){switch(e.j){case 1:return(i=es(r),null==(a.a=i)||"manifest"!=i.a)?e.return(Promise.reject(new Y(2,1,9004,i))):(t=new Ho,M(e,2),V(e,t.init(),4));case 4:return V(e,Vo(t,i.Aa(),i.fa()),5);case 5:return V(e,e.s.getManifests([i.key()]),6);case 6:return n=e.s,n=n[0],i=new ts(i.Aa(),i.fa()),e.return(function(t,e){var n=new pr(null,0);n.Ba(e.duration);var i=e.periods.map(function(e){return ns(t,e,n)}),r=e.drmInfo?[e.drmInfo]:[];return e.drmInfo&&i.forEach(function(e){e.variants.forEach(function(e){e.drmInfos=r})}),{presentationTimeline:n,minBufferTime:2,offlineSessionIds:e.sessionIds,periods:i}}(i,n));case 2:return P(e),V(e,t.destroy(),7);case 7:C(e,0)}})})},e.stop=function(){return Promise.resolve()},e.update=function(){},e.onExpirationUpdated=function(o,s){var u=this;return H(function e(){var t,n,i,r,a;return z(e,function(e){switch(e.j){case 1:return t=u.a,a=new Ho,q(e,2,3),V(e,a.init(),5);case 5:return V(e,Vo(a,t.Aa(),t.fa()),6);case 6:return V(e,(n=e.s).getManifests([t.key()]),7);case 7:if(i=e.s,r=i[0],i=r.sessionIds.includes(o),r=null==r.expiration||r.expiration>s,i&&r)return X.debug("Updating expiration for stored content"),V(e,n.updateManifestExpiration(t.key(),s),3);e.C(3);break;case 3:return P(e),V(e,a.destroy(),10);case 10:C(e,0);break;case 2:a=W(e),X.error("There was an error updating",t,a),e.C(3)}})})},hr.Lb("application/x-offline-manifest",as),L("shaka.offline.OfflineScheme",os),os.h=function(e){return Le(e={uri:e,vd:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}})},os.i=function(e,t){var n=new Ho;return Le(void 0).Y(function(){return n.init()}).Y(function(){return Vo(n,t.Aa(),t.fa())}).Y(function(e){return e.getSegments([t.key()])}).Y(function(e){return{uri:t,vd:t,data:e[0].data,headers:{}}}).finally(function(){return n.destroy()})},Xe("offline",os),us.prototype.destroy=function(){var i=this;return H(function e(){return z(e,function(e){switch(e.j){case 1:return i.l=!1,i.b&&i.b.abort(),ls(i),V(e,i.o,2);case 2:i.a&&i.a.za.eb();for(var t=F(i.g),n=t.next();!n.done;n=t.next())n.value.za.eb();i.a=null,i.g=[],i.h=null,I(e)}})})},L("shaka.text.SimpleTextDisplayer",ds),ds.prototype.remove=function(t,n){return!!this.a&&(hs(this.a,function(e){return e.startTime<n&&e.endTime>t}),!0)},ds.prototype.append=function(e){var t=fs,n=e.map(function(e){var t;return e.nestedCues.length&&(t=e.nestedCues.map(function(e){return e.spacer?"\n":e.payload+" "}).join("").replace(/ $/m,""),(e=e.clone()).nestedCues=[],e.payload=t),e}),i=[];e=this.a.cues?Array.from(this.a.cues):[];for(var r={},a=(n=F(n)).next();!a.done;r={Ab:r.Ab},a=n.next())r.Ab=a.value,e.some(function(t){return function(e){return e.startTime==t.Ab.startTime&&e.endTime==t.Ab.endTime&&e.text==t.Ab.payload}}(r))||(a=t(r.Ab))&&i.push(a);i.slice().sort(function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:"line"in VTTCue.prototype?i.indexOf(t)-i.indexOf(e):i.indexOf(e)-i.indexOf(t)}).forEach(function(e){this.a.addCue(e)}.bind(this))},ds.prototype.destroy=function(){return this.a&&hs(this.a,function(){return 1}),this.a=null,Promise.resolve()},ds.prototype.isTextVisible=function(){return"showing"==this.a.mode},ds.prototype.setTextVisibility=function(e){this.a.mode=e?"showing":"hidden"},L("shaka.util.ConfigUtils.mergeConfigObjects",ps),L("shaka.util.ConfigUtils.convertToConfigObject",ms),L("shaka.util.PlayerConfiguration",gs),gs.mergeConfigObjects=bs,U(xs,Ke),L("shaka.Player",xs),xs.prototype.destroy=function(){var n=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return n.i==hu?e.return():(n.i=hu,t=cs(n.Ta,function(){return{node:n.K,payload:du(),$a:!1}}),V(e,new Promise(function(e){t.Fb=function(){X.info("Preparing to destroy walker...")},t.xc=function(){e(),n.dispatchEvent(new Oe("loaded"))},t.eb=function(){e()},t.onError=function(){e()},t.zc=function(){e()}}),2));case 2:return V(e,n.Ta.destroy(),3);case 3:if(n.g&&(n.g.release(),n.g=null),n.Lc=null,n.l=null,n.b=null,n.T)return V(e,n.T.destroy(),5);e.C(0);break;case 5:n.T=null,I(e)}})})},xs.version="v2.5.19";var ks=["2","5"],Gn=new function(e){this.a=e,this.c=Vn,this.b=qn}(new Fn(Number(ks[0]),Number(ks[1]))),As=["output-restricted","internal-error"],Ms={};function Is(n,i){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return n.i!=hu&&(n.i=pu),t=n.Mc.map(function(e){return e()}),n.Mc=[],V(e,Promise.all(t),2);case 2:if(n.dispatchEvent(new Oe("unloading")),i.Ea=null,i.mimeType=null,i.startTime=null,i.uri=null,i.w&&(n.g.pa(i.w,"loadedmetadata"),n.g.pa(i.w,"playing"),n.g.pa(i.w,"pause"),n.g.pa(i.w,"ended"),n.g.pa(i.w,"ratechange")),n.qb&&(n.qb.release(),n.qb=null),n.fc&&(n.fc.stop(),n.fc=null),n.u)return V(e,n.u.stop(),4);e.C(3);break;case 4:n.u=null;case 3:if(n.l)return V(e,n.l.stop(),5);e.C(5);break;case 5:if(n.f)return V(e,n.f.destroy(),8);e.C(7);break;case 8:n.f=null;case 7:if(n.H&&(n.H.release(),n.H=null),n.o&&(n.o.release(),n.o=null),n.G)return V(e,n.G.destroy(),10);e.C(9);break;case 10:n.G=null;case 9:if(i.w&&i.w.src)return V(e,new Promise(function(e){return new Me(e).R(.1)}),12);e.C(11);break;case 12:i.w.removeAttribute("src"),i.w.load();case 11:if(n.h)return V(e,n.h.destroy(),14);e.C(13);break;case 14:n.h=null;case 13:n.ea.a.clear(),n.Ob=null,n.D=null,n.hc.clear(),n.c=null,n.v=null,n.Rc=null,n.sb=!0,Bs(n),I(e)}})})}function Ps(e,t){return new wt(t,e.b.drm.updateExpirationTime)}function Cs(e,t){e.D=new ma,e.D.a=va,ga(e.D,t,Math.min(.5,t/2)),Bs(e),e.fc=new Me(function(){Rs(e)}).Ka(.25)}function Rs(e){switch(e.i){case gu:var t=!!e.a.ended||Gt(e.a.buffered)>=e.a.duration-1;break;case mu:e:if(e.a.ended||Sn(e.G))t=!0;else{if(e.c.presentationTimeline.X()){var n=e.c.presentationTimeline.xb();if(Gt(e.a.buffered)>=n){t=!0;break e}}t=!1}break;default:t=!1}var i=zt(e.a.buffered,e.a.currentTime),r=t,a=(n=e.D).b.get(n.a),t=n.a,i=r||a<=i?ba:va;t!=(n.a=i)&&Bs(e)}function Ns(t){var e;if(t.u&&(r=Be(t.b.manifest),t.a&&"AUDIO"===t.a.nodeName&&(r.disableVideo=!0),t.u.configure(r)),t.h&&t.h.configure(t.b.drm),t.f){t.f.configure(t.b.streaming);try{t.c.periods.forEach(t.Vc.bind(t))}catch(e){t.Ra(e)}var n=Ja(t.f),i=Qa(t.f),r=su(t),n=jn.ce(n,i,r.variants);t.l&&n&&n.allowedByApplication&&n.allowedByKeySystem?Vs(t,r.variants):(X.debug("Choosing new streams after changing configuration"),qs(t,r))}t.G&&(r=t.b.textDisplayFactory,t.Rc!=r)&&(n=new r,e=(i=t.G).g,i.g=n,e&&(n.setTextVisibility(e.isTextVisible()),e.destroy()),i.a&&(i.a.c=n),t.Rc=r,!t.f||(n=(r=t.f).b.get("text"))&&io(r,n.stream,!0,0,!0)),t.l&&(t.l.configure(t.b.abr),t.b.abr.enabled&&!t.sb?t.l.enable():t.l.disable(),Js(t)),t.D&&(r=t.b.streaming.rebufferingGoal,t.c&&(r=Math.max(r,t.c.minBufferTime)),ga(t.D,r,Math.min(.5,r/2)))}function Ds(e){return Array.from(e.a.textTracks).filter(function(e){return"metadata"!=e.kind&&"chapters"!=e.kind&&"Shaka Player TextTrack"!=e.label})}function Ls(e,t,n,i){sa(e.ea,t).variant=n,(e=e.v.c).c!=n&&(e.c=n,e.a.push({timestamp:Date.now()/1e3,id:n.id,type:"variant",fromAdaptation:i,bandwidth:n.bandwidth}))}function Us(e,t,n,i){oa(e.ea,t,n),(e=e.v.c).b!=n&&(e.b=n,e.a.push({timestamp:Date.now()/1e3,id:n.id,type:"text",fromAdaptation:i,bandwidth:null}))}function _s(t){var e=vs();return e.streaming.failureCallback=function(e){t.X()&&[1001,1002,1003].includes(e.code)&&(e.severity=1,X.m("Live streaming error.  Retrying automatically..."),t.Cd())},e.textDisplayFactory=function(){return new ds(t.a)},e}function Os(e,t){var n,i,r=e.f?Ja(e.f):null,a=e.f?Qa(e.f):null;if(t.forEach(jn.filterNewPeriod.bind(null,e.h,r,a)),n=function(e){return e.variants.some(jn.Bb)},i=0,t.forEach(function(e){i+=n(e)?1:0}),0==(r=i))throw new Y(2,4,4032);if(r<t.length)throw new Y(2,4,4011);t.forEach(function(e){jn.Sd(e.variants,this.b.restrictions,this.ic)&&this.f&&su(this)==e&&zs(this),nu(this,e.variants)}.bind(e))}function js(e,t,n,i){return n=void 0!==n&&n,i=void 0===i?0:i,e.sb?(e.sa=t,e.je=n,e.ge=i,!0):((t=no(e.f,t,n,i))&&Xs(e),t)}function Ks(e,t){if(e.sb)return e.ra=t,!0;t=io(e.f,t,!0,0,!1);return t&&Ys(e),t}function Bs(e){var t,n=e.fd();e.v&&e.D&&e.o&&((t=e.H).f=n,Ca(t),Hs(e)),e.dispatchEvent(new Oe("buffering",{buffering:n}))}function Fs(e){var t=e.a.playbackRate;0!=t&&e.H.set(t)}function Hs(e){var t;e.v&&e.D&&(t=e.v.a,e.D.a==va?ws(t,"buffering"):e.a.paused?ws(t,"paused"):e.a.ended?ws(t,"ended"):ws(t,"playing"))}function Vs(t,e){try{nu(t,e)}catch(e){return t.Ra(e),null}var n=e.filter(function(e){return jn.Bb(e)}),n=t.Pb.create(n);return t.l.setVariants(Array.from(n.values())),t.l.chooseVariant()}function qs(e,t){var n=Gs(e,t,!1),i=jn.Sb(t.textStreams,e.qa,e.nb)[0]||null,r=!1;i&&(e.b.streaming.alwaysStreamText||e.uc())&&(Us(e,t,i,!0),r=Ks(e,i)),(n||r)&&Ws(e)}function Gs(e,t,n){n=void 0===n||n;var i=Vs(e,t.variants),r=!1;return i&&(Ls(e,t,i,!0),r=js(e,i,!0)),n&&r&&Ws(e),r}function Ws(e){iu(e,new Oe("adaptation"))}function zs(e){iu(e,new Oe("trackschanged"))}function Xs(e){iu(e,new Oe("variantchanged"))}function Ys(e){iu(e,new Oe("textchanged"))}function $s(e){iu(e,new Oe("texttrackvisibility"))}function Js(e){iu(e,new Oe("abrstatuschanged",{Rg:e.b.abr.enabled}))}function Qs(e,t,n){e.dispatchEvent(new Oe(t,{detail:{schemeIdUri:n.schemeIdUri,value:n.value,startTime:n.startTime,endTime:n.endTime,id:n.id,eventElement:n.eventElement}}))}function Zs(e){if(!e.a.error)return null;var t=e.a.error.code;if(1==t)return null;var n=e.a.error.msExtendedCode;return n&&(n<0&&(n+=Math.pow(2,32)),n=n.toString(16)),new Y(2,3,3016,t,n,e.a.error.message)}function eu(e,i){var t,r,n,a,o;e.f&&(t=su(e),r=!1,0==(n=Object.keys(i)).length&&X.m("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks."),(a=1==n.length&&"00"==n[0])&&X.m("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks."),n.length&&e.c.periods.forEach(function(e){e.variants.forEach(function(n){jn.Cf(n).forEach(function(e){var t=n.allowedByKeySystem;e.keyId&&(e=i[a?"00":e.keyId],n.allowedByKeySystem=!!e&&!As.includes(e)),t!=n.allowedByKeySystem&&(r=!0)})})}),n=Ja(e.f),o=Qa(e.f),(n=jn.ce(n,o,t.variants))&&!n.allowedByKeySystem&&(X.debug("Choosing new variants after key status changed"),Gs(e,t)),r&&(zs(e),Vs(e,t.variants)))}function tu(e,t,n){e.u&&e.u.onExpirationUpdated&&e.u.onExpirationUpdated(t,n),e.dispatchEvent(new Oe("expirationupdated"))}function nu(e,t){for(var n=e.h?st(e.h.$):{},i=(i=Object.keys(n)).length&&"00"==i[0],r=!1,a=!1,o=[],s=[],u=F(t),c=u.next();!c.done;c=u.next()){var l=[];(c=c.value).audio&&l.push(c.audio),c.video&&l.push(c.video);for(var d,f=(l=F(l)).next();!f.done;f=l.next())(f=f.value).keyId&&((d=n[i?"00":f.keyId])?As.includes(d)&&(s.includes(d)||s.push(d)):o.includes(f.keyId)||o.push(f.keyId));c.allowedByApplication?c.allowedByKeySystem&&(r=!0):a=!0}if(!r)throw new Y(2,4,4012,{hasAppRestrictions:a,missingKeys:o,restrictedKeyStatuses:s})}function iu(t,n){H(function e(){return z(e,function(e){switch(e.j){case 1:return V(e,Promise.resolve(),2);case 2:t.i!=hu&&t.dispatchEvent(n),I(e)}})})}function ru(e){for(var t=new Set,n=(e=F(e)).next();!n.done;n=e.next())(n=n.value).language?t.add(Ln(n.language)):t.add("und");return t}function au(e){for(var t=new Map,n=(e=F(e)).next();!n.done;n=e.next()){var i=n.value,n="und",r=[];for(i.language&&(n=Ln(i.language)),(r="variant"==i.type?i.audioRoles:i.roles)&&r.length||(r=[""]),t.has(n)||t.set(n,new Set),r=(i=F(r)).next();!r.done;r=i.next())r=r.value,t.get(n).add(r)}var a=[];return t.forEach(function(e,t){for(var n=F(e),i=n.next();!i.done;i=n.next())a.push({language:t,role:i.value})}),a}function ou(e){return null==(e=su(e))?[]:e.variants.filter(function(e){return jn.Bb(e)})}function su(e){for(var t=e.o.g(),n=null,i=(e=F(e.c.periods)).next();!i.done;i=e.next())(i=i.value).startTime<=t&&(n=i);return n}function uu(e){var t=su(e);return sa(e.ea,t).variant}function cu(){return new Y(2,7,7e3)}function lu(e,t,n,i,r,a){return i==e&&r.w==a.w&&r.uri==a.uri&&r.mimeType==a.mimeType&&r.Ea==a.Ea?t:n}function du(){return{Ea:null,w:null,mimeType:null,startTime:null,Ld:null,uri:null}}function fu(n){return new Promise(function(e,t){n.eb=function(){return t(cu())},n.xc=function(){return e()},n.onError=function(e){return t(e)},n.zc=function(){return t(cu())}})}xs.registerSupportPlugin=function(e,t){Ms[e]=t},xs.isBrowserSupported=function(){if(!(d.Promise&&d.Uint8Array&&Array.prototype.forEach))return!1;var e=mt();return!(e&&e<12||!(d.MediaKeys&&d.navigator&&d.navigator.requestMediaKeySystemAccess&&d.MediaKeySystemAccess&&d.MediaKeySystemAccess.prototype.getConfiguration))&&(!!dt()||ft("application/x-mpegurl"))},xs.probeSupport=function(){return Lt().then(function(e){for(var t,n=hr.eg(),i={},r=F('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),a=r.next();!a.done;a=r.next()){i[a=a.value]=dt()?!!mn(a)||(MediaSource.isTypeSupported(a)||xe(a)):ft(a);var o=a.split(";")[0];i[o]=i[o]||i[a]}for(t in e={manifest:n,media:i,drm:e},Ms)e[t]=Ms[t]();return e})},xs.prototype.attach=xs.prototype.Qb=function(e,t){if(t=void 0===t||t,this.i==hu)return Promise.reject(cu());var n=du();n.w=e,dt()||(t=!1);var i=t?this.pb:this.V,t=cs(this.Ta,function(){return{node:i,payload:n,$a:!1}});return t.Fb=function(){return X.info("Starting attach...")},fu(t)},xs.prototype.detach=function(){var e=this;if(this.i==hu)return Promise.reject(cu());var t=cs(this.Ta,function(){return{node:e.K,payload:du(),$a:!1}});return t.Fb=function(){return X.info("Starting detach...")},fu(t)},xs.prototype.unload=xs.prototype.Od=function(n){var i=this;if(n=void 0===n||n,this.i==hu)return Promise.reject(cu());dt()||(n=!1);var r=du(),e=cs(this.Ta,function(e){var t=e.w&&n?i.pb:e.w?i.V:i.K;return r.w=e.w,{node:t,payload:r,$a:!1}});return e.Fb=function(){return X.info("Starting unload...")},fu(e)},xs.prototype.load=function(e,t,n){if(this.i==hu)return Promise.reject(cu());this.dispatchEvent(new Oe("loading"));var i=du();i.uri=e,i.Ld=Date.now()/1e3,n&&"string"!=typeof n&&(Hn("Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),i.Ea=function(){return new n}),n&&"string"==typeof n&&(i.mimeType=n),void 0!==t&&(i.startTime=t);var r=function(e,t){if(t.Ea)return!1;if(!dt())return!0;var n=t.mimeType,i=t.uri||"";return!!(n=n||{mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"}[hr.getExtension(i)])&&(""!=(t.w||vt()).canPlayType(n)&&(!hr.isSupported(i,n)||pt()&&e.b.streaming.useNativeHlsOnSafari))}(this,i)?this.rb:this.$,a=cs(this.Ta,function(e){return null==e.w?null:(i.w=e.w,{node:r,payload:i,$a:!0})});return a.Fb=function(){return X.info("Starting load of "+e+"...")},new Promise(function(e,t){a.zc=function(){return t(new Y(2,7,7002))},a.xc=function(){return e()},a.eb=function(){return t(cu())},a.onError=function(e){return t(e)}})},xs.prototype.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=ms(e,t));var n=bs(this.b,e,_s(this));return Ns(this),n},xs.prototype.getConfiguration=function(){var e=_s(this);return bs(e,this.b,_s(this)),e},xs.prototype.resetConfiguration=xs.prototype.mg=function(){for(var e in this.b)delete this.b[e];bs(this.b,_s(this),_s(this)),Ns(this)},xs.prototype.getLoadMode=xs.prototype.kf=function(){return this.i},xs.prototype.getMediaElement=xs.prototype.qf=function(){return this.a},xs.prototype.getNetworkingEngine=xs.prototype.Ub=function(){return this.T},xs.prototype.getAssetUri=xs.prototype.pc=function(){return this.Ob},xs.prototype.getManifestUri=xs.prototype.nf=function(){return Hn("getManifestUri",'Please use "getAssetUri" instead.'),this.pc()},xs.prototype.isLive=xs.prototype.X=function(){return this.c?this.c.presentationTimeline.X():!(!this.a||!this.a.src)&&1/0==this.a.duration},xs.prototype.isInProgress=xs.prototype.bb=function(){return!!this.c&&this.c.presentationTimeline.bb()},xs.prototype.isAudioOnly=xs.prototype.Hf=function(){if(this.c){if(!this.c.periods.length)return!1;var e=this.c.periods[0].variants;return!!e.length&&!e[0].video}return!(!this.a||!this.a.src)&&(this.a.videoTracks?0==this.a.videoTracks.length:0==this.a.videoHeight)},xs.prototype.seekRange=xs.prototype.Be=function(){if(this.c){var e=this.c.presentationTimeline;return{start:e.wb(),end:e.Ga()}}return this.a&&this.a.src&&(e=this.a.seekable).length?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},xs.prototype.keySystem=function(){return At(this.drmInfo())},xs.prototype.drmInfo=function(){return this.h?this.h.a:null},xs.prototype.getExpiration=xs.prototype.Tb=function(){return this.h?this.h.Tb():1/0},xs.prototype.isBuffering=xs.prototype.fd=function(){return!!this.D&&this.D.a==va},xs.prototype.getPlaybackRate=xs.prototype.uf=function(){var e;return e=!this.H||(e=this.H).f?0:e.c},xs.prototype.trickPlay=xs.prototype.Eg=function(e){0==e?X.Z("A trick play rate of 0 is unsupported!"):(this.a.paused&&this.a.play(),this.H&&this.H.set(e),this.i==mu&&to(this.f,1<Math.abs(e)))},xs.prototype.cancelTrickPlay=xs.prototype.Ue=function(){this.i==gu&&this.H.set(1),this.i==mu&&(this.H.set(1),to(this.f,!1))},xs.prototype.getVariantTracks=xs.prototype.cd=function(){if(this.c&&this.o){for(var e=uu(this),t=[],n=F(ou(this)),i=n.next();!i.done;i=n.next()){i=i.value;var r=jn.Qd(i);r.active=i==e,t.push(r)}return t}return this.a&&this.a.audioTracks?Array.from(this.a.audioTracks).map(function(e){return jn.de(e)}):[]},xs.prototype.getTextTracks=xs.prototype.zb=function(){if(this.c&&this.o){for(var e=function(e){var t=su(e);if(null==t)return null;{var n;sa(e.ea,t).text||(n=jn.Sb(t.textStreams,e.qa,e.nb)).length&&oa(e.ea,t,n[0])}return sa(e.ea,t).text}(this),t=[],n=F(null==(o=su(a=this))?[]:o.textStreams.filter(function(e){return!a.hc.has(e)})),i=n.next();!i.done;i=n.next()){i=i.value;var r=jn.Fc(i);r.active=i==e,t.push(r)}return t}var a,o;return this.a&&this.a.src&&this.a.textTracks?Ds(this).map(function(e){return jn.Ff(e)}):[]},xs.prototype.selectTextTrack=xs.prototype.Fd=function(t){if(this.c&&this.f){var e=su(this),n=e.textStreams.find(function(e){return e.id==t.id});n?(Us(this,e,n,!1),Ks(this,n),this.qa=n.language):X.error("No stream with id",t.id)}else if(this.a&&this.a.src&&this.a.textTracks){for(n=(e=F(e=Ds(this))).next();!n.done;n=e.next())n=n.value,jn.ed(n)==t.id?n.mode=this.ob?"showing":"hidden":n.mode="disabled";Ys(this)}},xs.prototype.selectEmbeddedTextTrack=xs.prototype.og=function(){Hn("selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var e=this.zb().filter(function(e){return"application/cea-608"==e.mimeType});0<e.length?this.Fd(e[0]):X.m("Unable to find the text track embedded in the video.")},xs.prototype.usingEmbeddedTextTrack=xs.prototype.Jg=function(){Hn("usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var e=this.zb().filter(function(e){return e.active})[0];return!!e&&"application/cea-608"==e.mimeType},xs.prototype.selectVariantTrack=xs.prototype.pg=function(t,e,n){if(n=void 0===n?0:n,this.c&&this.f){var i=su(this);this.b.abr.enabled&&X.Z("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var r=i.variants.find(function(e){return e.id==t.id});r?jn.Bb(r)?(Ls(this,i,r,!1),js(this,r,e,n),this.Pb=new ha(r),Vs(this,i.variants)):X.error("Unable to switch to restricted track",t.id):X.error("No variant with id",t.id)}else if(this.a&&this.a.audioTracks){for(n=(e=F(e=Array.from(this.a.audioTracks))).next();!n.done;n=e.next())n=n.value,jn.ed(n)==t.id&&(n.enabled=!0);Xs(this)}},xs.prototype.getAudioLanguagesAndRoles=xs.prototype.ef=function(){return au(this.cd())},xs.prototype.getTextLanguagesAndRoles=xs.prototype.Bf=function(){return au(this.zb())},xs.prototype.getAudioLanguages=xs.prototype.df=function(){return Array.from(ru(this.cd()))},xs.prototype.getTextLanguages=xs.prototype.Af=function(){return Array.from(ru(this.zb()))},xs.prototype.selectAudioLanguage=xs.prototype.Dd=function(e,t){if(this.c&&this.o){var n=su(this);this.Pb=new pa(e,t||"",0,""),Gs(this,n)}else if(this.a&&this.a.audioTracks){for(var i=Array.from(this.a.audioTracks),n=Ln(e),r=null,a=null,o=(i=F(i)).next();!o.done;o=i.next()){o=o.value;var s=jn.de(o);Ln(s.language)==n&&(r=o,t?s.roles.includes(t)&&(a=o):0==s.roles.length&&(a=o))}a?(a.enabled=!0,Xs(this)):r&&(r.enabled=!0,Xs(this))}},xs.prototype.selectTextLanguage=xs.prototype.Ed=function(e,t){var n,i,r;this.c&&this.o?(n=su(this),this.qa=e,this.nb=t||"",(i=jn.Sb(n.textStreams,this.qa,this.nb)[0]||null)&&(Us(this,n,i,!1),(this.b.streaming.alwaysStreamText||this.uc())&&Ks(this,i))):(r=Ln(e),(n=this.zb().filter(function(e){return Ln(e.language)==r&&(!t||e.roles.includes(t))})[0])&&this.Fd(n))},xs.prototype.selectVariantsByLabel=xs.prototype.qg=function(e){if(this.c&&this.o){for(var t=su(this),n=null,i=F(ou(this)),r=i.next();!r.done;r=i.next())if((r=r.value).audio.label==e){n=r;break}null==n?X.m("No variants were found with label: "+e+". Ignoring the request to switch."):(this.Pb=new pa(n.language,"",0,e),Gs(this,t))}},xs.prototype.isTextTrackVisible=xs.prototype.uc=function(){var e=this.ob;return this.G?this.G.g.isTextVisible():this.a&&this.a.src&&this.a.textTracks?Ds(this).some(function(e){return"showing"==e.mode}):e},xs.prototype.setTextTrackVisibility=xs.prototype.tg=function(o){var s=this;return H(function e(){var i,r,a;return z(e,function(e){switch(e.j){case 1:if(s.ob==(i=!!o))return e.return();if(s.ob=i,s.i!=mu){if(s.a&&s.a.src&&s.a.textTracks)for(var t=F(Ds(s)),n=t.next();!n.done;n=t.next())"disabled"!=(r=n.value).mode&&(r.mode=i?"showing":"hidden");e.C(2);break}if(s.G.g.setTextVisibility(i),s.b.streaming.alwaysStreamText){e.C(2);break}if(!i){!function(e){e.G=!0;var t=e.b.get("text");t&&(So(t),Eo(t).catch(function(){}),e.b.delete("text"))}(s.f),e.C(2);break}if(Za(s.f,"text")){e.C(2);break}if(a=su(s),0<(a=jn.Sb(a.textStreams,s.qa,s.nb)).length)return V(e,eo(s.f,a[0]),2);e.C(2);break;case 2:$s(s),I(e)}})})},xs.prototype.getPlayheadTimeAsDate=xs.prototype.wf=function(){if(!this.X())return X.m("getPlayheadTimeAsDate is for live streams!"),null;var e=this.Ta.f,t=0;if(this.o)t=this.o.g();else if(e){if(null==e.startTime)return new Date;t=e.startTime}return this.c?new Date(1e3*(this.c.presentationTimeline.f+this.a.currentTime)):this.a&&this.a.getStartDate?(e=this.a.getStartDate(),isNaN(e.getTime())?(X.m("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(e.getTime()+1e3*t)):(X.m("No way to get playhead time as Date!"),null)},xs.prototype.getPresentationStartTimeAsDate=xs.prototype.yf=function(){if(!this.X())return X.m("getPresentationStartTimeAsDate is for live streams!"),null;if(this.c)return new Date(1e3*this.c.presentationTimeline.f);if(this.a&&this.a.getStartDate){var e=this.a.getStartDate();return isNaN(e.getTime())?(X.m("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):e}return X.m("No way to get presentation start time as Date!"),null},xs.prototype.getBufferedInfo=xs.prototype.$c=function(){var e={total:[],audio:[],video:[],text:[]};return this.i==gu&&(e.total=Xt(this.a.buffered)),this.i==mu&&this.G.$c(e),e},xs.prototype.getStats=function(){if(this.i!=mu&&this.i!=gu)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,switchHistory:[],stateHistory:[]};Hs(this),(t=this.a).getVideoPlaybackQuality&&(t=t.getVideoPlaybackQuality(),n=this.v,i=Number(t.totalVideoFrames),n.o=Number(t.droppedVideoFrames),n.l=i,this.v.i=Number(t.corruptedVideoFrames)),t=this.h?(t=this.h).K||NaN:NaN,this.v.h=t,this.i==mu&&((t=uu(this))&&(this.v.u=t.bandwidth),t&&t.video&&(n=this.v,i=t.video.height||NaN,n.v=t.video.width||NaN,n.g=i),t=this.l.getBandwidthEstimate(),this.v.f=t);for(var e=this.v,t=e.v,n=e.g,i=e.u,r=e.l,a=e.o,o=e.i,s=e.f,u=e.b,c=Ts(e.a,"playing"),l=Ts(e.a,"paused"),d=Ts(e.a,"buffering"),f=e.h,h=function(e){function t(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}}for(var n=[],i=F(e.b),r=i.next();!r.done;r=i.next())n.push(t(r.value));return e.a&&n.push(t(e.a)),n}(e.a),p=[],m=(e=F(e.c.a)).next();!m.done;m=e.next())m=m.value,p.push({timestamp:m.timestamp,id:m.id,type:m.type,fromAdaptation:m.fromAdaptation,bandwidth:m.bandwidth});return{width:t,height:n,streamBandwidth:i,decodedFrames:r,droppedFrames:a,corruptedFrames:o,estimatedBandwidth:s,loadLatency:u,playTime:c,pauseTime:l,bufferingTime:d,licenseTime:f,stateHistory:h,switchHistory:p}},xs.prototype.addTextTrack=function(a,o,s,u,c,l){var d=this;return H(function e(){var t,n,i,r;return z(e,function(e){switch(e.j){case 1:if(d.i==gu)throw X.error("Cannot add text when loaded with src="),Error("State error!");if(d.i!=mu)throw X.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");if(t=su(d),r=fe,i=d.c.periods.indexOf(t),i=(i=i+1)>=d.c.periods.length?d.c.presentationTimeline.ca():d.c.periods[i].startTime,1/0==(i=i-t.startTime))throw new Y(1,4,4033);return n=new $i(1,0,i,function(){return[a]},0,null),i={id:d.ke++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(e){return 1==e?n:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:u,codecs:c||"",kind:s,encrypted:!1,keyId:null,language:o,label:l||null,type:r.va,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},d.hc.add(i),t.textStreams.push(i),V(e,eo(d.f,i),2);case 2:return(r=Za(d.f,"text"))&&oa(d.ea,t,r),d.hc.delete(i),X.debug("Choosing new streams after adding a text stream"),qs(d,t),zs(d),e.return(jn.Fc(i))}})})},xs.prototype.setMaxHardwareResolution=xs.prototype.Hd=function(e,t){this.ic.width=e,this.ic.height=t},xs.prototype.retryStreaming=xs.prototype.Cd=function(){if(this.i==mu){var e=this.f;if(e.f)X.error("Unable to retry after StreamingEngine is destroyed!"),e=!1;else if(e.o)X.error("Unable to retry after StreamingEngine encountered a fatal error!"),e=!1;else{for(var t=F(e.b.values()),n=t.next();!n.done;n=t.next()){var i=ko(n=n.value);n.Xb&&(X.info(i,"Retrying after failure..."),n.Xb=!1,To(e,n,.1))}e=!0}}else e=!1;return e},xs.prototype.getManifest=xs.prototype.lf=function(){return this.c},xs.prototype.getManifestParserFactory=xs.prototype.mf=function(){return this.u?this.u.constructor:null},(e=xs.prototype).Vc=function(e){var t=this.f?Ja(this.f):null,n=this.f?Qa(this.f):null;if(jn.filterNewPeriod(this.h,t,n,e),!(t=e.variants).some(jn.Bb))throw new Y(2,4,4011);if(nu(this,e.variants),jn.Sd(t,this.b.restrictions,this.ic)&&this.f&&su(this)==e&&zs(this),e=this.h?this.h.a:null)for(n=(t=F(t)).next();!n.done;n=t.next())for(var i=(n=F(n.value.drmInfos)).next();!i.done;i=n.next())if((i=i.value).keySystem==e.keySystem)for(var r=(i=F(i.initData||[])).next();!r.done;r=i.next())r=r.value,kt(this.h,r.initDataType,r.initData)},e.Mf=function(e){X.debug("onChooseStreams_",e);try{X.J("onChooseStreams_, choosing variant from ",e.variants),X.J("onChooseStreams_, choosing text from ",e.textStreams),this.sb=!0,this.l.disable(),Js(this),X.debug("Choosing new streams after period changed");var t=Vs(this,e.variants),n=jn.Sb(e.textStreams,this.qa,this.nb)[0]||null;this.sa&&(e.variants.includes(this.sa)&&(t=this.sa),this.sa=null),this.ra&&(e.textStreams.includes(this.ra)&&(n=this.ra),this.ra=null),t&&Ls(this,e,t,!0),n&&Us(this,e,n,!0);var i=this.f,r=i.b.get("video");o=r?i.c.periods[r.ka]:(a=i.b.get("audio"))?i.c.periods[a.ka]:null;var a,o,r=t?t.audio:null;!o&&n&&((i=r)&&(e=n,a=Ln(this.b.preferredTextLanguage),o=Ln(r.language),i=Nn(r=Ln(e.language),a)&&!Nn(o,r)),i&&(this.ob=!0),this.ob&&this.G.g.setTextVisibility(!0),$s(this));t=this.b.streaming.alwaysStreamText||this.uc()?{variant:t,text:n}:{variant:t,text:null};return X.J("onChooseStreams_, chose variant ",t.variant),X.J("onChooseStreams_, chose text ",t.text),t}catch(e){return this.Ra(e),{variant:null,text:null}}},e.Te=function(){X.debug("canSwitch_"),this.sb=!1,this.b.abr.enabled&&(this.l.enable(),Js(this)),this.sa&&(no(this.f,this.sa,this.je,this.ge),Xs(this),this.sa=null),this.ra&&(io(this.f,this.ra,!0,0,!1),Ys(this),this.ra=null)},e.Rf=function(){this.u&&this.u.update&&this.u.update()},e.Wf=function(){this.o&&this.o.u()},e.Ra=function(e){var t;this.i!=hu&&(t=new Oe("error",{detail:e}),this.dispatchEvent(t),t.defaultPrevented&&(e.handled=!0))};var hu=0,pu=1,mu=2,gu=3;function vu(e,t){var n=ns(new ts(e.Aa(),e.fa()),t.periods[0],new pr(null,0)),i=t.appMetadata||{},n=bu(n);return{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:n,appMetadata:i}}function bu(e){for(var t=[],n=jn.tf(e.variants),i=(n=F(n)).next();!i.done;i=n.next())t.push(jn.Qd(i.value));for(n=(e=F(e.textStreams)).next();!n.done;n=e.next())t.push(jn.Fc(n.value));return t}function yu(){this.a={}}function wu(e,t){t=e.a[t];return null==t&&(t=0,X.error("Asking for bitrate of stream not given to the estimator")),0==t&&X.m("Using bitrate of 0, this stream won't affect progress"),t}function Tu(e){this.a=!1,this.b=new pe,this.c=e}function Su(e){var a=new xu;e.periods.forEach(function(e,t){var n,i=Au(e.variants);if(0==t)for(var r=(i=F(i.a)).next();!r.done;r=i.next())a.add(r.value);else n=i,(t=a).a=t.a.filter(function(e){return ku(n,e)})});for(var t=(e=F(e.periods)).next();!t.done;t=e.next())(t=t.value).variants=t.variants.filter(function(e){return ku(a,new Eu(e))})}function Eu(e){var t=e.audio;e=e.video,this.b=t?t.mimeType:null,this.a=t?t.codecs.split(".")[0]:null,this.f=e?e.mimeType:null,this.c=e?e.codecs.split(".")[0]:null}function xu(){this.a=[]}function ku(e,t){return e.a.some(function(e){return t.b==e.b&&t.a==e.a&&t.f==e.f&&t.c==e.c})}function Au(e){for(var t=new xu,n=(e=F(e)).next();!n.done;n=e.next())t.add(new Eu(n.value));return t}function Mu(e){var n=this;if(e&&e.constructor!=xs)throw new Y(2,9,9008);this.b=this.a=null,e?(this.a=e.b,this.b=e.Ub()):(this.a=vs(),this.b=new We),this.f=!1,this.c=[],this.g=[];var i=!e;this.h=new Tu(function(){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return t=function(){},V(e,Promise.all(n.g.map(function(e){return e.then(t,t)})),2);case 2:if(i)return V(e,n.b.destroy(),3);e.C(3);break;case 3:n.a=null,n.b=null,I(e)}})})})}function Iu(){if(dt())e:{for(var e=F(Go.values()),t=e.next();!t.done;t=e.next())if(t=(t=t.value)()){t.destroy(),e=!0;break e}e=!1}else e=!1;return e}function Pu(e,t){for(var n=[],i=F(e.periods),r=i.next();!r.done;r=i.next())for(var a=(r=F(r.value.streams)).next();!a.done;a=r.next())a=a.value,t&&"video"==a.contentType?n.push({contentType:ut(a.mimeType,a.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=a.contentType||n.push({contentType:ut(a.mimeType,a.codecs),robustness:e.drmInfo.audioRobustness});return n}function Cu(e){if(e.h.a)throw new Y(2,9,7001)}function Ru(){if(!Iu())throw new Y(2,9,9e3)}function Nu(t,n){return H(function e(){return z(e,function(e){switch(e.j){case 1:return t.g.push(n),M(e,2),V(e,n,4);case 4:return e.return(e.s);case 2:P(e),He(t.g,n),C(e,0)}})})}xs.LoadMode={DESTROYED:hu,NOT_LOADED:pu,MEDIA_SOURCE:mu,SRC_EQUALS:gu},Tu.prototype.destroy=function(){var e=this;return this.a?this.b:(this.a=!0,this.c().then(function(){e.b.resolve()},function(){e.b.resolve()}))},xu.prototype.add=function(e){ku(this,e)||this.a.push(e)},L("shaka.offline.Storage",Mu),Mu.support=Iu,Mu.prototype.destroy=function(){return this.h.destroy()},Mu.prototype.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=ms(e,t));var n=e,i=!1;return null!=n.trackSelectionCallback&&(i=!0,n.offline=n.offline||{},n.offline.trackSelectionCallback=n.trackSelectionCallback,delete n.trackSelectionCallback),null!=n.progressCallback&&(i=!0,n.offline=n.offline||{},n.offline.progressCallback=n.progressCallback,delete n.progressCallback),null!=n.usePersistentLicense&&(i=!0,n.offline=n.offline||{},n.offline.usePersistentLicense=n.usePersistentLicense,delete n.usePersistentLicense),i&&Hn("Storage.configure with OfflineConfig","Please configure storage with a player configuration."),bs(this.a,e)},Mu.prototype.getConfiguration=function(){var e=vs();return bs(e,this.a,vs()),e},Mu.prototype.getNetworkingEngine=Mu.prototype.Ub=function(){return this.b},Mu.prototype.store=function(n,e,i){var v,b,y,A,r=this;return Nu(this,(v=this,b=n,y=e||{},A=function(){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return i&&"string"!=typeof i?(Hn("Storing with a manifest parser factory","Please register a manifest parser and for the mime-type."),e.return(new i)):V(e,hr.create(n,r.b,r.a.manifest.retryParameters,i),2);case 2:return t=e.s,e.return(t)}})})},H(function e(){var t,r,d,h,p,m,g;return z(e,function(e){switch(e.j){case 1:return(Ru(),v.f)?e.return(Promise.reject(new Y(2,9,9006))):(v.f=!0,V(e,(a=v,o=b,l=A,H(function e(){var t,n,i,r;return z(e,function(e){switch(e.j){case 1:return t=null,r=a.b,r={networkingEngine:r,filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){t=e}},V(e,l(),2);case 2:return(n=e.s).configure(a.a.manifest),Cu(a),M(e,3),V(e,n.start(o,r),5);case 5:return i=e.s,Cu(a),r=function(e){for(var t=new Set,n=(e=F(e.periods)).next();!n.done;n=e.next()){for(var i=F((n=n.value).textStreams),r=i.next();!r.done;r=i.next())t.add(r.value);for(n=F(n.variants),i=n.next();!i.done;i=n.next())(i=i.value).audio&&t.add(i.audio),i.video&&t.add(i.video)}return t}(i),V(e,Promise.all(rt(r,function(e){return e.createSegmentIndex()})),6);case 6:if(Cu(a),t)throw t;return e.return(i);case 3:return P(e),V(e,n.stop(),7);case 7:C(e,0)}})})),2));case 2:if(m=e.s,Cu(v),!(!m.presentationTimeline.X()&&!m.presentationTimeline.bb()))throw new Y(2,9,9005,b);return t=null,r=new Ho,h=d=null,q(e,3,4),V(e,(s=v,u=m,c=function(e){h=h||e},H(function e(){var r,a,o;return z(e,function(e){switch(e.j){case 1:return r=new wt({Db:s.b,onError:c,yc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),a=Aa(u.periods),o=s.a,r.configure(o.drm),V(e,(t=r,n=a,i=o.offline.usePersistentLicense,t.v=[],t.G=i,St(t,n)),2);case 2:return V(e,Et(r),3);case 3:return V(e,xt(r),4);case 4:return e.return(r)}var t,n,i})})),6);case 6:if(t=e.s,Cu(v),h)throw h;return V(e,(f=v,n=m,i=t,H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return t={width:1/0,height:1/0},function(e,t,n){for(var i=(e=F(e.periods)).next();!i.done;i=e.next())(i=i.value).variants=i.variants.filter(function(e){return jn.ld(e,t,n)})}(n,f.a.restrictions,t),function(e){for(var t=(e=F(e.periods)).next();!t.done;t=e.next())(t=t.value).variants=t.variants.filter(function(e){var t=!0;return e.audio&&(t=t&&wn(e.audio)),e.video&&(t=t&&wn(e.video)),t})}(n),function(e,t){for(var n=F(e.periods),i=n.next();!i.done;i=n.next())(i=i.value).variants=i.variants.filter(function(e){return Ut(t,e)})}(n,i),Su(n),t=f.a.preferredAudioChannelCount,jn.Vd(n,t),V(e,(a=n,o=function(d){return H(function e(){var i,r,a,o,s,u,c,l;return z(e,function(e){switch(e.j){case 1:i=jn,r=[];for(var t=F(d.variants),n=t.next();!n.done;n=t.next())a=n.value,r.push(i.Qd(a));for(n=(t=F(d.textStreams)).next();!n.done;n=t.next())o=n.value,r.push(i.Fc(o));return V(e,f.a.offline.trackSelectionCallback(r),2);case 2:for(s=e.s,u=new Set,c=new Set,n=(t=F(s)).next();!n.done;n=t.next())"variant"==(l=n.value).type&&u.add(l.id),"text"==l.type&&c.add(l.id);d.variants=d.variants.filter(function(e){return u.has(e.id)}),d.textStreams=d.textStreams.filter(function(e){return c.has(e.id)}),I(e)}})})},H(function e(){var t,n,i,r;return z(e,function(e){switch(e.j){case 1:t=null,n=F(a.periods),i=n.next();case 2:if(i.done){e.C(0);break}return r=i.value,t&&(r.variants=r.variants.filter(function(e){return ku(t,new Eu(e))})),V(e,o(r),5);case 5:t=Au(r.variants),i=n.next(),e.C(2)}})})),2);case 2:(function(e){if(0==e.periods.length)throw new Y(2,4,4014);for(var t=(e=F(e.periods)).next();!t.done;t=e.next())!function(e){var t=new Set(e.variants.map(function(e){return e.video})),n=new Set(e.variants.map(function(e){return e.audio}));e=e.textStreams,1<t.size&&X.m("Multiple video tracks selected to be stored");for(var i=(t=F(n)).next();!i.done;i=t.next()){i=i.value;for(var r=F(n),a=r.next();!a.done;a=r.next())a=a.value,i!=a&&i.language==a.language&&X.m("Similar audio tracks were selected to be stored",i.id,a.id)}for(n=F(e),t=n.next();!t.done;t=n.next())for(t=t.value,i=F(e),r=i.next();!r.done;r=i.next())r=r.value,t!=r&&t.language==r.language&&X.m("Similar text tracks were selected to be stored",t.id,r.id)}(t.value)})(n),I(e)}var a,o})})),7);case 7:return V(e,r.init(),8);case 8:return Cu(v),V(e,function(e){var i=null;if(e.a.forEach(function(e,n){e.getCells().forEach(function(e,t){e.hasFixedKeySpace()||i||(i={path:{Aa:n,fa:t},fa:e})})}),i)return i;throw new Y(2,9,9013,"Could not find a cell that supports add-operations")}(r),9);case 9:return d=e.s,Cu(v),V(e,(w=v,T=d.fa,S=t,E=m,x=b,k=y,H(function e(){var h,p,m,g,v,b,y;return z(e,function(e){switch(e.j){case 1:return c=x,d=k,f=null==(l=E).expiration?1/0:l.expiration,h={offlineUri:null,originalManifestUri:c,duration:l.presentationTimeline.ca(),size:0,expiration:f,tracks:l=bu(l.periods[0]),appMetadata:d},p=E.periods.some(function(e){return e.variants.some(function(e){return e.drmInfos&&e.drmInfos.length})}),b=E.periods.some(function(e){return e.variants.some(function(e){return e.drmInfos.some(function(e){return e.initData&&e.initData.length})})}),g=null,(m=p&&!b)&&(y=S.a,g=Du.get(y.keySystem)),v=new Co(w.b,function(e,t){h.size=t,w.a.offline.progressCallback(h,e)},function(e,t){m&&w.a.offline.usePersistentLicense&&g==t&&kt(S,"cenc",e)}),M(e,2),n=w,i=v,r=T,a=S,o=E,s=x,c=k,u=new yu,f=o.periods.map(function(e){return function(e,t,n,i,r,a){for(var o=F(a.variants),s=o.next();!s.done;s=o.next())!function(e,t){var n,i,r=t.audio,a=t.video;r&&!a&&(e.a[r.id]=r.bandwidth||t.bandwidth),!r&&a&&(e.a[a.id]=a.bandwidth||t.bandwidth),r&&a&&(n=r.bandwidth||393216,(i=a.bandwidth||t.bandwidth-n)<=0&&(X.m("Audio bit rate consumes variants bandwidth. Setting video bandwidth to match variant's bandwidth."),i=t.bandwidth),e.a[r.id]=n,e.a[a.id]=i)}(i,s.value);for(o=F(a.textStreams),s=o.next();!s.done;s=o.next())i.a[s.value.id]=52;o=function(e){for(var t=new Set,n=F(e.textStreams),i=n.next();!i.done;i=n.next())t.add(i.value);for(e=F(e.variants),n=e.next();!n.done;n=e.next())(n=n.value).audio&&t.add(n.audio),n.video&&t.add(n.video);return t}(a);var u=new Map;for(o=F(o),s=o.next();!s.done;s=o.next()){s=s.value;var c=function(r,a,o,s,e,u){var c={id:u.id,originalId:u.originalId,primary:u.primary,presentationTimeOffset:u.presentationTimeOffset||0,contentType:u.type,mimeType:u.mimeType,codecs:u.codecs,frameRate:u.frameRate,pixelAspectRatio:u.pixelAspectRatio,kind:u.kind,language:u.language,label:u.label,width:u.width||null,height:u.height||null,initSegmentKey:null,encrypted:u.encrypted,keyId:u.keyId,segments:[],variantIds:[]};e=e.presentationTimeline.Wb();var l=u.id,t=u.initSegmentReference;return t&&(t=mr(t.c(),t.b,t.a,r.a.streaming.retryParameters),Ro(a,l,t,.5*wu(s,u.id),!0,function(n){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return V(e,o.addSegments([{data:n}]),2);case 2:t=e.s,r.c.push(t[0]),c.initSegmentKey=t[0],I(e)}})})})),function(e,t,n){for(var i=null==(t=e.findSegmentPosition(t))?null:e.getSegmentReference(t);i;)n(i),i=e.getSegmentReference(++t)}(u,e,function(i){var e,t,n=mr(i.c(),i.b,i.a,r.a.streaming.retryParameters);Ro(a,l,n,(e=s,t=u.id,n=(n=i).endTime-n.startTime,wu(e,t)*n),!1,function(n){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return V(e,o.addSegments([{data:n}]),2);case 2:t=e.s,r.c.push(t[0]),c.segments.push({startTime:i.startTime,endTime:i.endTime,dataKey:t[0]}),I(e)}})})})}),c}(e,t,n,i,r,s);u.set(s.id,c)}return a.variants.forEach(function(e){e.audio&&u.get(e.audio.id).variantIds.push(e.id),e.video&&u.get(e.video.id).variantIds.push(e.id)}),{startTime:a.startTime,streams:Array.from(u.values())}}(n,i,r,u,o,e)}),l=a.a,d=n.a.offline.usePersistentLicense,l&&d&&(l.initData=[]),y=b={originalManifestUri:s,duration:o.presentationTimeline.ca(),size:0,expiration:a.Tb(),periods:f,sessionIds:d?It(a):[],drmInfo:l,appMetadata:c},V(e,(t=v,H(function e(){return z(e,function(e){switch(e.j){case 1:return V(e,Promise.all(t.b.values()),2);case 2:return e.return(t.a.a)}})})),4);case 4:if(y.size=e.s,b.expiration=S.Tb(),y=It(S),b.sessionIds=w.a.offline.usePersistentLicense?y:[],p&&w.a.offline.usePersistentLicense&&!y.length)throw new Y(2,9,9007);return e.return(b);case 2:return P(e),V(e,v.destroy(),5);case 5:C(e,0)}var t,n,i,r,a,o,s,u,c,l,d,f})})),10);case 10:if(p=e.s,Cu(v),h)throw h;return V(e,d.fa.addManifests([p]),11);case 11:return m=e.s,Cu(v),m=new Zo("manifest",d.path.Aa,d.path.fa,m[0]),e.return(vu(m,p));case 4:return P(e),v.f=!1,v.c=[],V(e,r.destroy(),12);case 12:if(t)return V(e,t.destroy(),13);e.C(13);break;case 13:C(e,0);break;case 3:if(g=W(e),d)return V(e,d.fa.removeSegments(v.c,function(){}),15);e.C(15);break;case 15:throw h||g}var w,T,S,E,x,k,f,n,i,s,u,c,a,o,l})})))},Mu.prototype.getStoreInProgress=Mu.prototype.zf=function(){return this.f},Mu.prototype.remove=function(e){return Nu(this,(v=this,b=e,H(function e(){var h,p,m,g;return z(e,function(e){switch(e.j){case 1:return(Ru(),null==(g=es(b))||"manifest"!=g.a)?e.return(Promise.reject(new Y(2,9,9004,b))):(h=g,p=new Ho,M(e,2),V(e,p.init(),4));case 4:return V(e,Vo(p,h.Aa(),h.fa()),5);case 5:return V(e,(m=e.s).getManifests([h.key()]),6);case 6:return g=e.s,g=g[0],V(e,Promise.all([(l=v,d=g,f=p,H(function e(){return z(e,function(e){if(1===e.j)return V(e,(r=l.b,a=l.a.drm,o=f,s=d,H(function e(){var t,n,i;return z(e,function(e){switch(e.j){case 1:return s.drmInfo?(t=function(e){var t=Array.from(e.a.keys());if(!t.length)throw new Y(2,9,9e3,"No supported storage mechanisms found");return e.a.get(t[0]).getEmeSessionCell()}(o),n=s.sessionIds.map(function(e){return{sessionId:e,keySystem:s.drmInfo.keySystem,licenseUri:s.drmInfo.licenseServerUri,serverCertificate:s.drmInfo.serverCertificate,audioCapabilities:Pu(s,!1),videoCapabilities:Pu(s,!0)}}),V(e,ss(a,r,n),2)):e.return();case 2:return i=e.s,V(e,t.remove(i),3);case 3:return V(e,t.add(n.filter(function(e){return-1==i.indexOf(e.sessionId)})),0)}})})),0);var r,a,o,s})})),(n=v,i=m,r=h,o=function(e){var t=[];return e.periods.forEach(function(e){e.streams.forEach(function(e){null!=e.initSegmentKey&&t.push(e.initSegmentKey),e.segments.forEach(function(e){t.push(e.dataKey)})})}),t}(a=g),s=o.length+1,u=0,c=vu(r,a),Promise.all([i.removeSegments(o,t),i.removeManifests([r.key()],t)]))]),2);case 2:return P(e),V(e,p.destroy(),8);case 8:C(e,0)}function t(){u+=1,n.a.offline.progressCallback(c,u/s)}var n,i,r,a,o,s,u,c,l,d,f})})));var v,b},Mu.prototype.removeEmeSessions=Mu.prototype.jg=function(){return Nu(this,(d=this,H(function e(){var r,a,n,o,i,s,u,c,l;return z(e,function(e){switch(e.j){case 1:return Ru(),r=d.b,a=d.a.drm,n=new Ho,o=!1,M(e,2),V(e,n.init(),4);case 4:for(i=[],t=function(e){return i.push(e)},n.a.forEach(function(e){t(e.getEmeSessionCell())}),s=Promise.resolve(),u={},c=F(i),l=c.next();!l.done;u={Ec:u.Ec},l=c.next())u.Ec=l.value,s=s.then(function(i){return function(){return H(function e(){var t,n;return z(e,function(e){switch(e.j){case 1:return V(e,i.Ec.getAll(),2);case 2:return t=e.s,V(e,ss(a,r,t),3);case 3:return n=e.s,V(e,i.Ec.remove(n),4);case 4:n.length!=t.length&&(o=!0),I(e)}})})}}(u));return V(e,s,2);case 2:return P(e),V(e,n.destroy(),6);case 6:C(e,3);break;case 3:return e.return(!o)}var t})})));var d},Mu.prototype.list=function(){return Nu(this,H(function e(){var r,t,a;return z(e,function(e){switch(e.j){case 1:return Ru(),r=[],t=new Ho,M(e,2),V(e,t.init(),4);case 4:return a=Promise.resolve(),i=function(n,t){a=a.then(function(){return H(function e(){return z(e,function(e){switch(e.j){case 1:return V(e,t.getAllManifests(),2);case 2:e.s.forEach(function(e,t){e=vu(new Zo("manifest",n.Aa,n.fa,t),e);r.push(e)}),I(e)}})})})},t.a.forEach(function(e,n){e.getCells().forEach(function(e,t){i({Aa:n,fa:t},e)})}),V(e,a,2);case 2:return P(e),V(e,t.destroy(),6);case 6:C(e,3);break;case 3:return e.return(r)}var i})}))},Mu.deleteAll=function(){return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return t=new Ho,M(e,2),V(e,t.erase(),2);case 2:return P(e),V(e,t.destroy(),5);case 5:C(e,0)}})})};var Du=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb");Ms.offline=Iu,L("shaka.polyfill.installAll",function(){for(var e=0;e<_u.length;++e)try{_u[e].Re()}catch(e){X.Z("Error installing polyfill!",e)}});var Lu,Uu,_u=[];function Ou(e,t){for(var n={priority:t=t||0,Re:e},i=0;i<_u.length;i++)if(_u[i].priority<t)return void _u.splice(i,0,n);_u.push(n)}function ju(e){var t,n=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();"function"==typeof Event?t=new Event(n,e):(t=document.createEvent("Event")).initEvent(n,e.bubbles,e.cancelable),e.target.dispatchEvent(t)}function Ku(e,t,n){"input"==e&&"range"===this.type&&(e="change"),HTMLInputElement.prototype.originalAddEventListener.call(this,e,t,n)}function Bu(){var i=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];return(t=i.apply(this,t)).abort=function(){},t}}function Fu(e,t){X.debug("PatchedMediaKeysApple.requestMediaKeySystemAccess");try{var n=new Hu(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function Hu(e,t){if(X.debug("PatchedMediaKeysApple.MediaKeySystemAccess"),(this.keySystem=e).startsWith("com.apple.fps"))for(var n=F(t),i=n.next();!i.done;i=n.next()){var r=i.value;if("required"==r.persistentState)i=null;else{var a,o=!(i={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"],label:r.label}),s=!1;if(r.audioCapabilities)for(var u=F(r.audioCapabilities),c=u.next();!c.done;c=u.next())(c=c.value).contentType&&(o=!0,a=c.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,a)&&(i.audioCapabilities.push(c),s=!0));if(r.videoCapabilities)for(c=(r=F(r.videoCapabilities)).next();!c.done;c=r.next())(u=c.value).contentType&&(o=!0,c=u.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,c)&&(i.videoCapabilities.push(u),s=!0));o||(s=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),i=s?i:null}if(i)return void(this.a=i)}throw(n=Error("Unsupported keySystem")).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function Vu(e){X.debug("PatchedMediaKeysApple.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&Gu(t,null),delete this.mediaKeys,(this.mediaKeys=e)?Gu(e,this):Promise.resolve()}function qu(e){X.debug("PatchedMediaKeysApple.MediaKeys"),this.b=new WebKitMediaKeys(e),this.a=new Ze}function Gu(e,t){if(e.a.hb(),!t)return Promise.resolve();e.a.B(t,"webkitneedkey",zu);try{return Ra(t,HTMLMediaElement.HAVE_METADATA,e.a,function(){t.webkitSetMediaKeys(e.b)}),Promise.resolve()}catch(e){return Promise.reject(e)}}function Wu(e){X.debug("PatchedMediaKeysApple.MediaKeySession"),Ke.call(this),this.b=null,this.g=e,this.c=this.a=null,this.f=new Ze,this.sessionId="",this.expiration=NaN,this.closed=new pe,this.keyStatuses=new Yu}function zu(e){if(X.debug("PatchedMediaKeysApple.onWebkitNeedKey_",e),e=new Uint8Array(e.initData),new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=be(e=ge(e.subarray(4),!0));var t=new Event("encrypted");t.initDataType="skd",t.initData=e,this.dispatchEvent(t)}function Xu(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.a=t,e.dispatchEvent(new Oe("keystatuseschange"))}function Yu(){this.size=0,this.a=void 0}function $u(e,t){X.debug("PatchedMediaKeysMs.requestMediaKeySystemAccess");try{var n=new Ju(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function Ju(e,t){X.debug("PatchedMediaKeysMs.MediaKeySystemAccess"),this.keySystem=e;for(var n=!1,i=0;i<t.length;++i){var r=t[i],a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"],label:r.label},o=!1;if(r.audioCapabilities)for(var s=0;s<r.audioCapabilities.length;++s){var u,c=r.audioCapabilities[s];c.contentType&&(o=!0,u=c.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,u)&&(a.audioCapabilities.push(c),n=!0))}if(r.videoCapabilities)for(s=0;s<r.videoCapabilities.length;++s)(c=r.videoCapabilities[s]).contentType&&(o=!0,u=c.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,u)&&(a.videoCapabilities.push(c),n=!0));if(o||(n=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==r.persistentState&&(n=!1),n)return void(this.a=a)}throw(n=Error("Unsupported keySystem")).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function Qu(e){X.debug("PatchedMediaKeysMs.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&ec(t,null),delete this.mediaKeys,(this.mediaKeys=e)?ec(e,this):Promise.resolve()}function Zu(e){X.debug("PatchedMediaKeysMs.MediaKeys"),this.b=new MSMediaKeys(e),this.a=new Ze}function ec(e,t){if(e.a.hb(),!t)return Promise.resolve();e.a.B(t,"msneedkey",nc);try{return Ra(t,HTMLMediaElement.HAVE_METADATA,e.a,function(){t.msSetMediaKeys(e.b)}),Promise.resolve()}catch(e){return Promise.reject(e)}}function tc(e){X.debug("PatchedMediaKeysMs.MediaKeySession"),Ke.call(this),this.c=null,this.g=e,this.b=this.a=null,this.f=new Ze,this.sessionId="",this.expiration=NaN,this.closed=new pe,this.keyStatuses=new rc}function nc(e){var t;X.debug("PatchedMediaKeysMs.onMsNeedKey_",e),e.initData&&((t=document.createEvent("CustomEvent")).initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",t.initData=ji(e.initData).buffer,this.dispatchEvent(t))}function ic(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.a=t,e.dispatchEvent(new Oe("keystatuseschange"))}function rc(){this.size=0,this.a=void 0}function ac(){return X.debug("PatchedMediaKeysNop.requestMediaKeySystemAccess"),Promise.reject(Error("The key system specified is not supported."))}function oc(e){return X.debug("PatchedMediaKeysNop.setMediaKeys"),null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function sc(){throw new TypeError("Illegal constructor.")}function uc(){throw new TypeError("Illegal constructor.")}L("shaka.polyfill.register",Ou),Ou(function(){wl()},-1),Ou(function(){var e;d.Document&&((e=Element.prototype).requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen,(e=Document.prototype).exitFullscreen=e.exitFullscreen||e.mozCancelFullScreen||e.msExitFullscreen||e.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",ju),document.addEventListener("webkitfullscreenerror",ju),document.addEventListener("mozfullscreenchange",ju),document.addEventListener("mozfullscreenerror",ju),document.addEventListener("MSFullscreenChange",ju),document.addEventListener("MSFullscreenError",ju))}),Ou(function(){X.debug("InputEvent.install"),gt("Trident/")&&!HTMLInputElement.prototype.originalAddEventListener&&(X.info("Patching input event support on IE."),HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=Ku)}),Ou(function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})}),Ou(function(){X.debug("mathRound.install")}),Ou(function(){X.debug("MediaSource.install");var t,n,i,r,e=mt();d.MediaSource?d.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(X.info("Patching Chromecast MSE bugs."),r=MediaSource.isTypeSupported,MediaSource.isTypeSupported=function(e){var t=e.split(/ *; */);return t.shift(),t.some(function(e){return e.startsWith("codecs=")})?cast.__platform__.canDisplayType(e):r(e)}):e?(i=MediaSource.isTypeSupported,MediaSource.isTypeSupported=function(e){return"mp2t"!=e.split(/ *; */)[0].split("/")[1].toLowerCase()&&i(e)},e<=12?(X.info("Patching Safari 11 & 12 MSE bugs."),Bu(),n=SourceBuffer.prototype.remove,SourceBuffer.prototype.remove=function(e,t){return n.call(this,e,t-.001)}):(X.info("Patching Safari 13 MSE bugs."),Bu())):gt("Tizen 2")||gt("Tizen 3")||gt("Tizen 4")?(t=MediaSource.isTypeSupported,MediaSource.isTypeSupported=function(e){return"opus"!=ct(e)[0]&&t(e)}):X.info("Using native MSE as-is."):X.info("No MSE implementation available.")}),Hu.prototype.createMediaKeys=function(){X.debug("PatchedMediaKeysApple.MediaKeySystemAccess.createMediaKeys");var e=new qu(this.keySystem);return Promise.resolve(e)},Hu.prototype.getConfiguration=function(){return X.debug("PatchedMediaKeysApple.MediaKeySystemAccess.getConfiguration"),this.a},qu.prototype.createSession=function(e){if(X.debug("PatchedMediaKeysApple.MediaKeys.createSession"),"temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new Wu(this.b)},qu.prototype.setServerCertificate=function(e){return X.debug("PatchedMediaKeysApple.MediaKeys.setServerCertificate"),e&&new Uint8Array(e),Promise.resolve(!0)},U(Wu,Ke),(e=Wu.prototype).generateRequest=function(e,t){X.debug("PatchedMediaKeysApple.MediaKeySession.generateRequest"),this.a=new pe;try{this.b=this.g.createSession("video/mp4",new Uint8Array(t)),this.sessionId=this.b.sessionId||"",this.f.B(this.b,"webkitkeymessage",this.yg.bind(this)),this.f.B(this.b,"webkitkeyadded",this.wg.bind(this)),this.f.B(this.b,"webkitkeyerror",this.xg.bind(this)),Xu(this,"status-pending")}catch(e){this.a.reject(e)}return this.a},e.load=function(){return X.debug("PatchedMediaKeysApple.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},e.update=function(e){X.debug("PatchedMediaKeysApple.MediaKeySession.update"),this.c=new pe;try{this.b.update(new Uint8Array(e))}catch(e){this.c.reject(e)}return this.c},e.close=function(){X.debug("PatchedMediaKeysApple.MediaKeySession.close");try{this.b.close(),this.closed.resolve(),this.f.hb()}catch(e){this.closed.reject(e)}return this.closed},e.remove=function(){return X.debug("PatchedMediaKeysApple.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},e.yg=function(e){X.debug("PatchedMediaKeysApple.onWebkitKeyMessage_",e),this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new Oe("message",{messageType:null==this.keyStatuses.a?"license-request":"license-renewal",message:e.message.buffer}))},e.wg=function(e){X.debug("PatchedMediaKeysApple.onWebkitKeyAdded_",e),this.c&&(Xu(this,"usable"),this.c.resolve(),this.c=null)},e.xg=function(e){if(X.debug("PatchedMediaKeysApple.onWebkitKeyError_",e),(e=Error("EME PatchedMediaKeysApple key error")).errorCode=this.b.error,null!=this.a)this.a.reject(e),this.a=null;else if(null!=this.c)this.c.reject(e),this.c=null;else switch(this.b.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:Xu(this,"output-not-allowed");break;default:Xu(this,"internal-error")}},(e=Yu.prototype).forEach=function(e){this.a&&e(this.a,Lu)},e.get=function(e){if(this.has(e))return this.a},e.has=function(e){var t=Lu;return!(!this.a||!Se.Da(new Uint8Array(e),new Uint8Array(t)))},e.entries=function(){},e.keys=function(){},e.values=function(){},Ou(function(){d.HTMLVideoElement&&d.WebKitMediaKeys&&(X.info("Using Apple-prefixed EME"),Lu=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Vu,d.MediaKeys=qu,d.MediaKeySystemAccess=Hu,navigator.requestMediaKeySystemAccess=Fu)}),Ju.prototype.createMediaKeys=function(){X.debug("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var e=new Zu(this.keySystem);return Promise.resolve(e)},Ju.prototype.getConfiguration=function(){return X.debug("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration"),this.a},Zu.prototype.createSession=function(e){if(X.debug("PatchedMediaKeysMs.MediaKeys.createSession"),"temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new tc(this.b)},Zu.prototype.setServerCertificate=function(){return X.debug("PatchedMediaKeysMs.MediaKeys.setServerCertificate"),Promise.resolve(!1)},U(tc,Ke),(e=tc.prototype).generateRequest=function(e,t){X.debug("PatchedMediaKeysMs.MediaKeySession.generateRequest"),this.a=new pe;try{this.c=this.g.createSession("video/mp4",new Uint8Array(t),null),this.f.B(this.c,"mskeymessage",this.Vf.bind(this)),this.f.B(this.c,"mskeyadded",this.Tf.bind(this)),this.f.B(this.c,"mskeyerror",this.Uf.bind(this)),ic(this,"status-pending")}catch(e){this.a.reject(e)}return this.a},e.load=function(){return X.debug("PatchedMediaKeysMs.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},e.update=function(e){X.debug("PatchedMediaKeysMs.MediaKeySession.update"),this.b=new pe;try{this.c.update(new Uint8Array(e))}catch(e){this.b.reject(e)}return this.b},e.close=function(){X.debug("PatchedMediaKeysMs.MediaKeySession.close");try{this.c.close(),this.closed.resolve(),this.f.hb()}catch(e){this.closed.reject(e)}return this.closed},e.remove=function(){return X.debug("PatchedMediaKeysMs.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},e.Vf=function(e){X.debug("PatchedMediaKeysMs.onMsKeyMessage_",e),this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new Oe("message",{messageType:null==this.keyStatuses.a?"license-request":"license-renewal",message:e.message.buffer}))},e.Tf=function(e){X.debug("PatchedMediaKeysMs.onMsKeyAdded_",e),this.a?(X.debug("Simulating completion for a PR persistent license."),ic(this,"usable"),this.a.resolve(),this.a=null):this.b&&(ic(this,"usable"),this.b.resolve(),this.b=null)},e.Uf=function(e){if(X.debug("PatchedMediaKeysMs.onMsKeyError_",e),(e=Error("EME PatchedMediaKeysMs key error")).errorCode=this.c.error,null!=this.a)this.a.reject(e),this.a=null;else if(null!=this.b)this.b.reject(e),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:ic(this,"output-not-allowed");break;default:ic(this,"internal-error")}},(e=rc.prototype).forEach=function(e){this.a&&e(this.a,Uu)},e.get=function(e){if(this.has(e))return this.a},e.has=function(e){var t=Uu;return!(!this.a||!Se.Da(new Uint8Array(e),new Uint8Array(t)))},e.entries=function(){},e.keys=function(){},e.values=function(){},Ou(function(){!d.HTMLVideoElement||!d.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(X.info("Using ms-prefixed EME v20140218"),Uu=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Qu,d.MediaKeys=Zu,d.MediaKeySystemAccess=Ju,navigator.requestMediaKeySystemAccess=$u)}),sc.prototype.createSession=function(){},sc.prototype.setServerCertificate=function(){},uc.prototype.getConfiguration=function(){},uc.prototype.createMediaKeys=function(){},Ou(function(){!d.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(X.info("EME not available."),navigator.requestMediaKeySystemAccess=ac,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=oc,d.MediaKeys=sc,d.MediaKeySystemAccess=uc)},-10);var cc,lc="";function dc(e){return lc?lc+e.charAt(0).toUpperCase()+e.slice(1):e}function fc(e,t){X.debug("PatchedMediaKeysWebkit.requestMediaKeySystemAccess");try{var n=new pc(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function hc(e){X.debug("PatchedMediaKeysWebkit.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&gc(t,null),delete this.mediaKeys,(this.mediaKeys=e)&&gc(e,this),Promise.resolve()}function pc(e,t){X.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess");var n=!1;"org.w3.clearkey"==(this.a=this.keySystem=e)&&(n=!(this.a="webkit-org.w3.clearkey"));for(var i=!1,r=(r=document.getElementsByTagName("video")).length?r[0]:document.createElement("video"),a=0;a<t.length;++a){var o=t[a],s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:o.initDataTypes,sessionTypes:["temporary"],label:o.label},u=!1;if(o.audioCapabilities)for(var c=0;c<o.audioCapabilities.length;++c){var l,d=o.audioCapabilities[c];d.contentType&&(u=!0,l=d.contentType.split(";")[0],r.canPlayType(l,this.a)&&(s.audioCapabilities.push(d),i=!0))}if(o.videoCapabilities)for(c=0;c<o.videoCapabilities.length;++c)(d=o.videoCapabilities[c]).contentType&&(u=!0,r.canPlayType(d.contentType,this.a)&&(s.videoCapabilities.push(d),i=!0));if(u||(i=r.canPlayType("video/mp4",this.a)||r.canPlayType("video/webm",this.a)),"required"==o.persistentState&&(n?(s.persistentState="required",s.sessionTypes=["persistent-license"]):i=!1),i)return void(this.b=s)}throw n="org.w3.clearkey"!=e&&"com.widevine.alpha"!=e?"Unsupported keySystem":"None of the requested configurations were supported.",(n=Error(n)).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function mc(e){X.debug("PatchedMediaKeysWebkit.MediaKeys"),this.g=e,this.b=null,this.a=new Ze,this.c=[],this.f={}}function gc(e,t){e.b=t,e.a.hb();var n=lc;t&&(e.a.B(t,n+"needkey",e.Zf.bind(e)),e.a.B(t,n+"keymessage",e.Bg.bind(e)),e.a.B(t,n+"keyadded",e.zg.bind(e)),e.a.B(t,n+"keyerror",e.Ag.bind(e)))}function vc(e,t){var n=e.f[t];return n?(X.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",n),n):(n=e.c.shift())?(n.sessionId=t,e.f[t]=n,X.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",n),n):null}function bc(e,t,n){X.debug("PatchedMediaKeysWebkit.MediaKeySession"),Ke.call(this),this.f=e,this.h=!1,this.a=this.b=null,this.c=t,this.g=n,this.sessionId="",this.expiration=NaN,this.closed=new pe,this.keyStatuses=new Tc}function yc(t,e,n){if(t.h)return Promise.reject(Error("The session is already initialized."));t.h=!0;try{var i,r,a="persistent-license"==t.g?n?new Uint8Array(be("LOAD_SESSION|"+n)):(i=be("PERSISTENT|"),(r=new Uint8Array(i.byteLength+e.byteLength)).set(new Uint8Array(i),0),r.set(new Uint8Array(e),i.byteLength),r):new Uint8Array(e)}catch(e){return Promise.reject(e)}t.b=new pe;var o=dc("generateKeyRequest");try{t.f[o](t.c,a)}catch(e){if("InvalidStateError"!=e.name)return t.b=null,Promise.reject(e);new Me(function(){try{t.f[o](t.c,a)}catch(e){t.b.reject(e),t.b=null}}).R(.01)}return t.b}function wc(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.a=t,e.dispatchEvent(new Oe("keystatuseschange"))}function Tc(){this.size=0,this.a=void 0}function Sc(e){var t="picture-in-picture"==(e=e.target).webkitPresentationMode?(document.pictureInPictureElement=e,new Event("enterpictureinpicture")):(document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),new Event("leavepictureinpicture"));e.dispatchEvent(t)}function Ec(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function xc(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function kc(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode("picture-in-picture")}function Ac(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")}function Mc(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function Ic(e,t,n){return new d.TextTrackCue(e,t,n)}function Pc(e,t,n){return new d.TextTrackCue(e+"-"+t+"-"+n,e,t,n)}function Cc(){}pc.prototype.createMediaKeys=function(){X.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var e=new mc(this.a);return Promise.resolve(e)},pc.prototype.getConfiguration=function(){return X.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration"),this.b},(e=mc.prototype).createSession=function(e){if(X.debug("PatchedMediaKeysWebkit.MediaKeys.createSession"),"temporary"!=(e=e||"temporary")&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=this.b||document.createElement("video");return t.src||(t.src="about:blank"),e=new bc(t,this.g,e),this.c.push(e),e},e.setServerCertificate=function(){return X.debug("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate"),Promise.resolve(!1)},e.Zf=function(e){X.debug("PatchedMediaKeysWebkit.onWebkitNeedKey_",e);var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",e.initData instanceof ArrayBuffer?t.initData=e.initData:t.initData=e.initData.buffer,this.b.dispatchEvent(t)},e.Bg=function(e){X.debug("PatchedMediaKeysWebkit.onWebkitKeyMessage_",e);var t=vc(this,e.sessionId);t?(e=new Oe("message",{messageType:null==t.keyStatuses.a?"licenserequest":"licenserenewal",message:e.message}),X.debug("PatchedMediaKeysWebkit.MediaKeySession.generated"),t.b&&(t.b.resolve(),t.b=null),t.dispatchEvent(e)):X.error("Session not found",e.sessionId)},e.zg=function(e){X.debug("PatchedMediaKeysWebkit.onWebkitKeyAdded_",e),(e=vc(this,e.sessionId))&&(X.debug("PatchedMediaKeysWebkit.MediaKeySession.ready"),wc(e,"usable"),e.a&&e.a.resolve(),e.a=null)},e.Ag=function(e){X.debug("PatchedMediaKeysWebkit.onWebkitKeyError_",e);var t=vc(this,e.sessionId);t&&t.handleError(e)},U(bc,Ke),(e=bc.prototype).handleError=function(e){X.debug("PatchedMediaKeysWebkit.MediaKeySession.handleError",e);var t=Error("EME v0.1b key error"),n=e.errorCode;n.systemCode=e.systemCode,t.errorCode=n,!e.sessionId&&this.b?(45==e.systemCode&&(t.message="Unsupported session type."),this.b.reject(t),this.b=null):e.sessionId&&this.a?(this.a.reject(t),this.a=null):(t=e.systemCode,e.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?wc(this,"output-restricted"):wc(this,1==t?"expired":"internal-error"))},e.Kd=function(e,t){if(this.a)this.a.then(this.Kd.bind(this,e,t)).catch(this.Kd.bind(this,e,t));else{var n,i;this.a=e,i="webkit-org.w3.clearkey"==this.c?(n=me(t),"oct"!=(i=JSON.parse(n)).keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),n=Se.Fa(i.keys[0].k),Se.Fa(i.keys[0].kid)):(n=new Uint8Array(t),null);var r=dc("addKey");try{this.f[r](this.c,n,i,this.sessionId)}catch(e){this.a.reject(e),this.a=null}}},e.generateRequest=function(e,t){return X.debug("PatchedMediaKeysWebkit.MediaKeySession.generateRequest"),yc(this,t,null)},e.load=function(e){return X.debug("PatchedMediaKeysWebkit.MediaKeySession.load"),"persistent-license"==this.g?yc(this,null,e):Promise.reject(Error("Not a persistent session."))},e.update=function(e){X.debug("PatchedMediaKeysWebkit.MediaKeySession.update",e);var t=new pe;return this.Kd(t,e),t},e.close=function(){if(X.debug("PatchedMediaKeysWebkit.MediaKeySession.close"),"persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=dc("cancelKeyRequest");try{this.f[e](this.c,this.sessionId)}catch(e){}}return this.closed.resolve(),this.closed},e.remove=function(){return X.debug("PatchedMediaKeysWebkit.MediaKeySession.remove"),"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()},(e=Tc.prototype).forEach=function(e){this.a&&e(this.a,cc)},e.get=function(e){if(this.has(e))return this.a},e.has=function(e){var t=cc;return!(!this.a||!Se.Da(new Uint8Array(e),new Uint8Array(t)))},e.entries=function(){},e.keys=function(){},e.values=function(){},Ou(function(){if(!(!d.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)X.info("Using webkit-prefixed EME v0.1b"),lc="webkit";else{if(!HTMLMediaElement.prototype.generateKeyRequest)return;X.info("Using nonprefixed EME v0.1b")}cc=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=fc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=hc,d.MediaKeys=mc,d.MediaKeySystemAccess=pc}}),Ou(function(){var e;d.HTMLVideoElement&&((e=HTMLVideoElement.prototype).requestPictureInPicture&&document.exitPictureInPicture||!e.webkitSupportsPresentationMode||(X.debug("PiPWebkit.install"),document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,e.requestPictureInPicture=Ec,Object.defineProperty(e,"disablePictureInPicture",{get:kc,set:Ac,enumerable:!0,configurable:!0}),document.exitPictureInPicture=xc,document.addEventListener("webkitpresentationmodechanged",Sc,!0)))}),Ou(function(){var t;X.debug("VideoPlayPromise.install"),d.HTMLMediaElement&&(t=HTMLMediaElement.prototype.play,HTMLMediaElement.prototype.play=function(){var e=t.apply(this);return e&&e.catch(function(){}),e})}),Ou(function(){var e;!d.HTMLVideoElement||!(e=HTMLVideoElement.prototype).getVideoPlaybackQuality&&"webkitDroppedFrameCount"in e&&(e.getVideoPlaybackQuality=Mc)}),Ou(function(){if(d.VTTCue)X.info("Using native VTTCue.");else if(d.TextTrackCue){var e=TextTrackCue.length;if(3==e)X.info("Using VTTCue polyfill from 3 argument TextTrackCue."),d.VTTCue=Ic;else if(6==e)X.info("Using VTTCue polyfill from 6 argument TextTrackCue."),d.VTTCue=Pc;else{try{var t=!!Ic(1,2,"")}catch(e){t=!1}t&&(X.info("Using VTTCue polyfill from 3 argument TextTrackCue."),d.VTTCue=Ic)}}else X.error("VTTCue not available.")}),L("shaka.text.TtmlTextParser",Cc),Cc.prototype.parseInit=function(){},Cc.prototype.parseMedia=function(e,t){var n=me(e),i=[],r=new DOMParser,a=null;if(""==n)return i;try{a=r.parseFromString(n,"text/xml")}catch(e){throw new Y(2,2,2005,"Failed to parse TTML.")}if(a){if(n=a.getElementsByTagName("parsererror")[0])throw new Y(2,2,2005,n.textContent);if(!(r=a.getElementsByTagName("tt")[0]))throw new Y(2,2,2005,"TTML does not contain <tt> tag.");var o=Ki.getAttributeNS(r,"http://www.w3.org/ns/ttml#parameter","frameRate"),s=Ki.getAttributeNS(r,"http://www.w3.org/ns/ttml#parameter","subFrameRate"),u=Ki.getAttributeNS(r,"http://www.w3.org/ns/ttml#parameter","frameRateMultiplier"),c=Ki.getAttributeNS(r,"http://www.w3.org/ns/ttml#parameter","tickRate"),a=r.getAttribute("xml:space")||"default",n=Ki.getAttributeNS(r,"http://www.w3.org/ns/ttml#styling","extent");if("default"!=a&&"preserve"!=a)throw new Y(2,2,2005,"Invalid xml:space value: "+a);a="default"==a,o=new tl(o,s,u,c),s=qc(r.getElementsByTagName("metadata")[0]),u=qc(r.getElementsByTagName("styling")[0]),c=qc(r.getElementsByTagName("layout")[0]);for(var l=[],d=0;d<c.length;d++){var f,h,p=c[d],m=u,g=n,v=new ln,b=p.getAttribute("xml:id");b?(v.id=b,b=null,g&&(b=Dc.exec(g)||Uc.exec(g)),g=b?Number(b[1]):null,b=b?Number(b[2]):null,!(f=Yc(p,m,"extent"))||null!=(f=(h=Dc.exec(f))||Uc.exec(f))&&(v.width=null!=g?100*Number(f[1])/g:Number(f[1]),v.height=null!=b?100*Number(f[2])/b:Number(f[2]),v.widthUnits=h||null!=g?dn:0,v.heightUnits=h||null!=b?dn:0),!(p=Yc(p,m,"origin"))||null!=(f=(h=Dc.exec(p))||Uc.exec(p))&&(v.viewportAnchorX=null!=g?100*Number(f[1])/g:Number(f[1]),v.viewportAnchorY=null!=b?100*Number(f[2])/b:Number(f[2]),v.viewportAnchorUnits=h||null!=g?dn:0)):(X.m("TtmlTextParser parser encountered a region with no id. Region will be ignored."),v=null),v&&l.push(v)}for(n=function e(t){if(!t)return[];var n=[];t=F(t.childNodes);for(var i=t.next();!i.done;i=t.next())i=i.value,i instanceof Element&&(i.hasAttribute("begin")?n.push(i):n=n.concat(e(i)));return n}(r.getElementsByTagName("body")[0]),r=(n=F(n)).next();!r.done;r=n.next())(r=function e(t,n,i,r,a,o,s,u,c){if(c&&"br"==t.nodeName)return t=new Yt(0,0,""),t.spacer=!0,t;var l=/^[\s\n]*$/.test(t.textContent),d=t.nodeType==Node.ELEMENT_NODE&&!t.hasAttribute("begin")&&!t.hasAttribute("end");if(t.nodeType!=Node.ELEMENT_NODE||d&&l||d&&!c)return null;l=Zc(t.getAttribute("begin"),i);d=Zc(t.getAttribute("end"),i);var f=Zc(t.getAttribute("dur"),i);null==d&&null!=f&&(d=l+f);if(!c&&(null==l||null==d))throw new Y(2,2,2001);l=c&&null==l?0:l+n;d=c&&null==d?0:d+n;f="";c=[];if(Array.from(t.childNodes).find(function(e){return e.nodeType===Node.TEXT_NODE&&/\S+/.test(e.textContent)}))f=Gc(t,u);else for(var h=F(t.childNodes),p=h.next();!p.done;p=h.next())(p=e(p.value,n,i,r,a,o,s,u,!0))&&(p.startTime=p.startTime||l,p.endTime=p.endTime||d,c.push(p));n=new Yt(l,d,f);n.nestedCues=c;{var m;(o=Qc(t,"region",o,"")[0])&&o.getAttribute("xml:id")&&(m=o.getAttribute("xml:id"),n.region=s.filter(function(e){return e.id==m})[0])}r=Qc(t,"backgroundImage",r,"#","http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt")[0];Wc(n,t,o,r,a);return n}(r.value,t.periodStart,o,s,u,c,l,a,!1))&&i.push(r)}return i};var Rc,Nc,Dc=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,Lc=/^(\d+px|\d+em)$/,Uc=/^(\d+)px (\d+)px$/,_c=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Oc=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,jc=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,Kc=/^(\d*(?:\.\d*)?)f$/,Bc=/^(\d*(?:\.\d*)?)t$/,Fc=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,Hc={left:an,center:"center",right:"end",start:an,end:"end"},Vc={left:"line-left",center:"center",right:"line-right"};function qc(e){var t=[];if(!e)return t;for(var n=F(e.childNodes),i=n.next();!i.done;i=n.next())(i=i.value).nodeType==Node.ELEMENT_NODE&&"br"!==i.nodeName&&(i=qc(i),t=t.concat(i));return t.length||t.push(e),t}function Gc(e,t){for(var n="",i=F(e.childNodes),r=i.next();!r.done;r=i.next())"br"==(r=r.value).nodeName&&e.childNodes[0]!==r?n+="\n":r.childNodes&&0<r.childNodes.length?n+=Gc(r,t):t?n+=r=(r=r.textContent.trim()).replace(/\s+/g," "):n+=r.textContent;return n}function Wc(e,t,n,i,r){"rtl"==Xc(t,n,r,"direction")&&(e.direction="rtl");var a,o=Xc(t,n,r,"writingMode");"tb"==o||"tblr"==o?e.writingMode="vertical-lr":"tbrl"==o?e.writingMode="vertical-rl":"rltb"==o||"rl"==o?e.direction="rtl":o&&(e.direction=tn),(o=Xc(t,n,r,"textAlign"))?(e.positionAlign=Vc[o],e.lineAlign=Hc[o],e.textAlign=Qt[o.toUpperCase()]):e.textAlign="start",(o=Xc(t,n,r,"displayAlign"))&&(e.displayAlign=en[o.toUpperCase()]),(o=Xc(t,n,r,"color"))&&(e.color=o),(o=Xc(t,n,r,"backgroundColor"))&&(e.backgroundColor=o),(o=Xc(t,n,r,"fontFamily"))&&(e.fontFamily=o),(o=Xc(t,n,r,"fontWeight"))&&"bold"==o&&(e.fontWeight=700),(o=Xc(t,n,r,"wrapOption"))&&"noWrap"==o&&(e.wrapLine=!1),(o=Xc(t,n,r,"lineHeight"))&&o.match(Lc)&&(e.lineHeight=o),(o=Xc(t,n,r,"fontSize"))&&o.match(Lc)&&(e.fontSize=o),(o=Xc(t,n,r,"fontStyle"))&&(e.fontStyle=cn[o.toUpperCase()]),i&&(o=i.getAttribute("imagetype"),a=i.getAttribute("encoding"),i=i.textContent.trim(),"PNG"==o&&"Base64"==a&&i&&(e.backgroundImage="data:image/png;base64,"+i)),(n=Yc(n,r,"textDecoration"))&&zc(e,n),(t=$c(t,r,"textDecoration"))&&zc(e,t)}function zc(e,t){for(var n=t.split(" "),i=0;i<n.length;i++)switch(n[i]){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&He(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&He(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&He(e.textDecoration,"overline")}}function Xc(e,t,n,i){return(e=$c(e,n,i))?e:Yc(t,n,i)}function Yc(e,t,n){if(!e)return null;for(var i=qc(e),r=0;r<i.length;r++){var a=Ki.getAttributeNS(i[r],"http://www.w3.org/ns/ttml#styling",n);if(a)return a}return Jc(e,t,n)}function $c(e,t,n){var i=Ki.getAttributeNS(e,"http://www.w3.org/ns/ttml#styling",n);return i||Jc(e,t,n)}function Jc(e,t,n){e=Qc(e,"style",t,"");for(var i=null,r=0;r<e.length;r++){var a=Ki.getAttributeNS(e[r],"http://www.w3.org/ns/ttml#styling",n);(a=a||$c(e[r],t,n))&&(i=a)}return i}function Qc(e,t,n,i,r){var a=[];if(!e||n.length<1)return a;var o=e;for(e=null;o&&!(e=r?Ki.getAttributeNS(o,r,t):o.getAttribute(t))&&(o=o.parentNode)instanceof Element;);if(t=e)for(r=(t=F(t=t.split(" "))).next();!r.done;r=t.next())for(r=r.value,o=(e=F(n)).next();!o.done;o=e.next())if(i+(o=o.value).getAttribute("xml:id")==r){a.push(o);break}return a}function Zc(e,t){var n,i,r,a,o=null;return _c.test(e)?(o=_c.exec(e),n=Number(o[1]),i=Number(o[2]),r=Number(o[3]),a=Number(o[4]),o=(r+=(a+=(Number(o[5])||0)/t.b)/t.frameRate)+60*i+3600*n):Oc.test(e)?o=el(Oc,e):jc.test(e)?o=el(jc,e):Kc.test(e)?(o=Kc.exec(e),o=Number(o[1])/t.frameRate):Bc.test(e)?(o=Bc.exec(e),o=Number(o[1])/t.a):Fc.test(e)&&(o=el(Fc,e)),o}function el(e,t){t=e.exec(t);return null==t||""==t[0]?null:(Number(t[4])||0)/1e3+(Number(t[3])||0)+60*(Number(t[2])||0)+3600*(Number(t[1])||0)}function tl(e,t,n,i){this.frameRate=Number(e)||30,this.b=Number(t)||1,this.a=Number(i),0==this.a&&(this.a=e?this.frameRate*this.b:1),n&&(e=/^(\d+) (\d+)$/g.exec(n))&&(this.frameRate*=Number(e[1])/Number(e[2]))}function nl(){this.a=new Cc}function il(){}function rl(e,t,n){var i;if(i=/^align:(start|middle|center|end|left|right)$/.exec(t))t=i[1],e.textAlign="middle"==t?Jt:Qt[t.toUpperCase()];else if(i=/^vertical:(lr|rl)$/.exec(t))e.writingMode="lr"==i[1]?"vertical-lr":"vertical-rl";else if(i=/^size:([\d.]+)%$/.exec(t))e.size=Number(i[1]);else if(i=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(t))e.position=Number(i[1]),i[2]&&(t=i[2],e.positionAlign="line-left"==t||"start"==t?"line-left":"line-right"==t||"end"==t?"line-right":"center");else{if(!(i=/^region:(.*)$/.exec(t))){e:{if(n=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))e.lineInterpretation=1,e.line=Number(n[1]),n[2]&&(e.lineAlign=on[n[2].toUpperCase()]);else{if(!(n=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t))){e=!1;break e}e.lineInterpretation=rn,e.line=Number(n[1]),n[2]&&(e.lineAlign=on[n[2].toUpperCase()])}e=!0}return e}(t=function(e,t){e=e.filter(function(e){return e.id==t});return e.length?e[0]:(X.m("VTT parser could not find a region with id: ",t," The region will be ignored."),null)}(n,i[1]))&&(e.region=t)}return 1}function al(e){if(null==(e=Rr(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var t=Number(e[2]),n=Number(e[3]);return 59<t||59<n?null:Number(e[4])/1e3+n+60*t+3600*(Number(e[1])||0)}function ol(){this.a=null}function sl(){}function ul(){Rc?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(Rc=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=cl):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function cl(n,i){var r=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),V(e,Rc.call(r,n,i),2);case 2:return bl(t=e.s)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=Rc,e.return(t)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=ll,e.return(ll.call(r,n,i)))}})})}function ll(c,l){var d=this;return H(function e(){var i,r,a,o,s,u;return z(e,function(e){switch(e.j){case 1:console.assert(d==navigator,'bad "this" for requestMediaKeySystemAccess'),i=vl(c),r=[];for(var t=F(l),n=t.next();!n.done;n=t.next())s=n.value,a=dl(s.videoCapabilities,i),o=dl(s.audioCapabilities,i),s.videoCapabilities&&s.videoCapabilities.length&&!a.length||s.audioCapabilities&&s.audioCapabilities.length&&!o.length||((s=Object.assign({},s)).videoCapabilities=a,s.audioCapabilities=o,r.push(s));if(!r.length)throw(u=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",u.code=DOMException.NOT_SUPPORTED_ERR,u;return V(e,Rc.call(d,c,r),2);case 2:return u=e.s,e.return(new gl(u,i))}})})}function dl(e,t){return e&&e.filter(function(e){return!e.encryptionScheme||e.encryptionScheme==t})}function fl(){}function hl(){navigator.mediaCapabilities?(Nc=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=pl):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")}function pl(n){var i=this;return H(function e(){var t;return z(e,function(e){switch(e.j){case 1:return console.assert(i==navigator.mediaCapabilities,'bad "this" for decodingInfo'),V(e,Nc.call(i,n),2);case 2:return(t=e.s,n.keySystemConfiguration)?bl(t.keySystemAccess)?(console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=Nc,e.return(t)):(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=ml,e.return(ml.call(i,n))):e.return(t)}})})}function ml(a){var o=this;return H(function e(){var t,n,i,r;return z(e,function(e){switch(e.j){case 1:return console.assert(o==navigator.mediaCapabilities,'bad "this" for decodingInfo'),t=null,a.keySystemConfiguration&&(i=a.keySystemConfiguration,r=i.keySystem,n=i.audio&&i.audio.encryptionScheme,i=i.video&&i.video.encryptionScheme,t=vl(r),r={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:a},n&&n!=t||i&&i!=t)?e.return(r):V(e,Nc.call(o,a),2);case 2:return(r=e.s).keySystemAccess&&(r.keySystemAccess=new gl(r.keySystemAccess,t)),e.return(r)}})})}function gl(e,t){this.b=e,this.a=t,this.keySystem=e.keySystem}function vl(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function bl(e){var t=(e=e.getConfiguration()).audioCapabilities&&e.audioCapabilities[0];return!(!(e=e.videoCapabilities&&e.videoCapabilities[0]||t)||void 0===e.encryptionScheme)}function yl(){}function wl(){ul(),hl()}pn["application/ttml+xml"]=Cc,L("shaka.text.Mp4TtmlParser",nl),nl.prototype.parseInit=function(e){var t=!1;if((new Ri).L("moov",Ni).L("trak",Ni).L("mdia",Ni).L("minf",Ni).L("stbl",Ni).ia("stsd",Di).L("stpp",function(e){t=!0,e.parser.stop()}).parse(e),!t)throw new Y(2,2,2007)},nl.prototype.parseMedia=function(e,t){var n=!1,i=[];if((new Ri).L("mdat",Li(function(e){n=!0,i=i.concat(this.a.parseMedia(e,t))}.bind(this))).parse(e),!n)throw new Y(2,2,2007);return i},pn['application/mp4; codecs="stpp"']=nl,pn['application/mp4; codecs="stpp.ttml.im1t"']=nl,pn['application/mp4; codecs="stpp.TTML.im1t"']=nl,L("shaka.text.VttTextParser",il),il.prototype.parseInit=function(){},il.prototype.parseMedia=function(e,t){var n=me(e);if(n=(n=n.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(n[0]))throw new Y(2,2,2e3);var i=t.segmentStart;if(null==i&&n[i=0].includes("X-TIMESTAMP-MAP")){var r=n[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),a=n[0].match(/MPEGTS:(\d+)/m);if(r&&a){if(null==(i=al(new Pr(r[1]))))throw new Y(2,2,2e3);i=t.periodStart+(Number(a[1])/9e4-i)}}a=[];for(var o=n[0].split("\n"),r=1;r<o.length;r++)if(/^Region:/.test(o[r])){var s=new Pr(o[r]),u=new ln;Nr(s),Cr(s);for(var c,l=Nr(s);l;){e:{var d=u,f=l;if(c=/^id=(.*)$/.exec(f))d.id=c[1];else if(c=/^width=(\d{1,2}|100)%$/.exec(f))d.width=Number(c[1]);else if(c=/^lines=(\d+)$/.exec(f))d.height=Number(c[1]),d.heightUnits=2;else if(c=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(f))d.regionAnchorX=Number(c[1]),d.regionAnchorY=Number(c[2]);else if(c=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(f))d.viewportAnchorX=Number(c[1]),d.viewportAnchorY=Number(c[2]);else{if(!/^scroll=up$/.exec(f)){c=!1;break e}d.scroll="up"}c=!0}c||X.m("VTT parser encountered an invalid VTTRegion setting: ",l," The setting will be ignored."),Cr(s),l=Nr(s)}a.push(u)}for(r=[],s=1;s<n.length;s++){if(c=o=n[s].split("\n"),d=i,o=a,1==c.length&&!c[0]||/^NOTE($|[ \t])/.test(c[0])||"STYLE"==c[0])o=null;else{u=null,c[0].includes("--\x3e")||(u=c[0],c.splice(0,1)),f=al(l=new Pr(c[0]));var h=Rr(l,/[ \t]+--\x3e[ \t]+/g),p=al(l);if(null==f||null==h||null==p)throw new Y(2,2,2001);for(c=new Yt(f+d,p+d,c.slice(1).join("\n").trim()),Cr(l),d=Nr(l);d;)rl(c,d,o)||X.m("VTT parser encountered an invalid VTT setting: ",d," The setting will be ignored."),Cr(l),d=Nr(l);null!=u&&(c.id=u),o=c}o&&r.push(o)}return r},pn["text/vtt"]=il,pn['text/vtt; codecs="vtt"']=il,pn['text/vtt; codecs="wvtt"']=il,L("shaka.text.Mp4VttParser",ol),ol.prototype.parseInit=function(e){var t=!1;if((new Ri).L("moov",Ni).L("trak",Ni).L("mdia",Ni).ia("mdhd",function(e){0==e.version?(e.reader.P(4),e.reader.P(4),this.a=e.reader.I(),e.reader.P(4)):(e.reader.P(8),e.reader.P(8),this.a=e.reader.I(),e.reader.P(8)),e.reader.P(4)}.bind(this)).L("minf",Ni).L("stbl",Ni).ia("stsd",Di).L("wvtt",function(){t=!0}).parse(e),!this.a)throw new Y(2,2,2008);if(!t)throw new Y(2,2,2008)},ol.prototype.parseMedia=function(e,s){var u=this;if(!this.a)throw X.error("No init segment for MP4+VTT!"),new Y(2,2,2008);var t,c=0,l=[],d=[],n=!1,f=!1,i=!1,h=null;if((new Ri).L("moof",Ni).L("traf",Ni).ia("tfdt",function(e){n=!0,c=0==e.version?e.reader.I():e.reader.Kb()}).ia("tfhd",function(e){var t=e.flags;(e=e.reader).P(4),1&t&&e.P(8),2&t&&e.P(4),h=8&t?e.I():null}).ia("trun",function(e){f=!0;var t=e.version,n=e.flags,i=(e=e.reader).I();1&n&&e.P(4),4&n&&e.P(4);for(var r=[],a=0;a<i;a++){var o={duration:null,sampleSize:null,Md:null};256&n&&(o.duration=e.I()),512&n&&(o.sampleSize=e.I()),1024&n&&e.P(4),2048&n&&(o.Md=0==t?e.I():e.xe()),r.push(o)}l=r}).L("mdat",Li(function(e){i=!0,t=e})).parse(e),!i&&!n&&!f)throw new Y(2,2,2008);var p=c,m=new Ii(new DataView(t.buffer,t.byteOffset,t.byteLength),0);return l.forEach(function(e){var t=e.duration||h,n=e.Md?c+e.Md:p;p=n+(t||0);var i=0;do{var r=m.I();i+=r;var a=m.I(),o=null;"vttc"==(a=_i(a))?8<r&&(o=m.gb(r-8)):("vtte"!=a&&X.error("Unknown box "+a+"! Skipping!"),m.P(r-8)),t?o&&d.push(function(e,t,n){var i,r,a;return(new Ri).L("payl",Li(function(e){i=me(e)})).L("iden",Li(function(e){r=me(e)})).L("sttg",Li(function(e){a=me(e)})).parse(e),i?function(e,t,n,i,r){if(e=new Yt(i,r,e),t&&(e.id=t),n)for(t=new Pr(n),n=Nr(t);n;)rl(e,n,[])||X.m("VTT parser encountered an invalid VTT setting: ",n," The setting will be ignored."),Cr(t),n=Nr(t);return e}(i,r,a,t,n):null}(o,s.periodStart+n/u.a,s.periodStart+p/u.a)):X.error("WVTT sample duration unknown, and no default found!")}while(e.sampleSize&&i<e.sampleSize)}),d.filter(ce.Na)},pn['application/mp4; codecs="wvtt"']=ol,L("shaka.util.Dom.createHTMLElement",function(e){return document.createElement(e)}),L("shaka.util.Dom.createVideoElement",function(){var e=document.createElement("video");return e.muted=!0,e.width=600,e.height=400,e}),L("shaka.util.Dom.asHTMLElement",function(e){return e}),L("shaka.util.Dom.asHTMLMediaElement",function(e){return e}),L("shaka.util.Dom.removeAllChildren",function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}),L("EmeEncryptionSchemePolyfill",sl),sl.install=ul,L("McEncryptionSchemePolyfill",fl),fl.install=hl,gl.prototype.getConfiguration=function(){var e=this.b.getConfiguration();if(e.videoCapabilities)for(var t=F(e.videoCapabilities),n=t.next();!n.done;n=t.next())n.value.encryptionScheme=this.a;if(e.audioCapabilities)for(n=(t=F(e.audioCapabilities)).next();!n.done;n=t.next())n.value.encryptionScheme=this.a;return e},gl.prototype.createMediaKeys=function(){return this.b.createMediaKeys()},L("EncryptionSchemePolyfills",yl),yl.install=wl,void 0!==t&&t.af&&(t.af=yl)}.call(t,e,e,void 0),"undefined"!=typeof exports)for(var n in t.shaka)exports[n]=t.shaka[n];else"function"==typeof define&&define.amd?define(function(){return t.shaka}):e.shaka=t.shaka}();