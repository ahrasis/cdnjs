import _extends from"@babel/runtime/helpers/esm/extends";import _slicedToArray from"@babel/runtime/helpers/esm/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import*as React from"react";import PropTypes from"prop-types";import clsx from"clsx";import{visuallyHidden}from"@material-ui/system";import{chainPropTypes}from"@material-ui/utils";import{useTheme,withStyles}from"../styles";import{capitalize,useForkRef,useIsFocusVisible,useControlled,unstable_useId as useId}from"../utils";import Star from"../internal/svg-icons/Star";import StarBorder from"../internal/svg-icons/StarBorder";function clamp(e,t,o){return e<t?t:e>o?o:e}function getDecimalPrecision(e){var t=e.toString().split(".")[1];return t?t.length:0}function roundValueToPrecision(e,t){if(null==e)return e;var o=Math.round(e/t)*t;return Number(o.toFixed(getDecimalPrecision(t)))}export var styles=function(e){return{root:{display:"inline-flex",position:"relative",fontSize:e.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",WebkitTapHighlightColor:"transparent","&$disabled":{opacity:e.palette.action.disabledOpacity,pointerEvents:"none"},"&$focusVisible $iconActive":{outline:"1px solid #999"}},sizeSmall:{fontSize:e.typography.pxToRem(18)},sizeLarge:{fontSize:e.typography.pxToRem(30)},readOnly:{pointerEvents:"none"},disabled:{},focusVisible:{},visuallyHidden:visuallyHidden,label:{cursor:"inherit"},labelEmptyValueActive:{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"},icon:{display:"flex",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),pointerEvents:"none"},iconEmpty:{color:e.palette.action.disabled},iconFilled:{},iconHover:{},iconFocus:{},iconActive:{transform:"scale(1.2)"},decimal:{position:"relative"}}};function IconContainer(e){e.value;var t=_objectWithoutProperties(e,["value"]);return React.createElement("span",t)}"production"!==process.env.NODE_ENV&&(IconContainer.propTypes={value:PropTypes.number.isRequired});var defaultIcon=React.createElement(Star,{fontSize:"inherit"}),defaultEmptyIcon=React.createElement(StarBorder,{fontSize:"inherit"});function defaultLabelText(e){return"".concat(e," Star").concat(1!==e?"s":"")}var Rating=React.forwardRef(function(e,t){var o=e.classes,n=e.className,a=e.defaultValue,r=void 0===a?null:a,i=e.disabled,l=void 0!==i&&i,s=e.emptyIcon,c=void 0===s?defaultEmptyIcon:s,u=e.emptyLabelText,p=void 0===u?"Empty":u,d=e.getLabelText,m=void 0===d?defaultLabelText:d,v=e.icon,f=void 0===v?defaultIcon:v,y=e.IconContainerComponent,h=void 0===y?IconContainer:y,b=e.max,T=void 0===b?5:b,g=e.name,R=e.onChange,x=e.onChangeActive,P=e.onMouseLeave,E=e.onMouseMove,C=e.precision,I=void 0===C?1:C,S=e.readOnly,F=void 0!==S&&S,A=e.size,N=void 0===A?"medium":A,V=e.value,M=_objectWithoutProperties(e,["classes","className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"]),z=useId(g),k=useControlled({controlled:V,default:r,name:"Rating"}),L=_slicedToArray(k,2),_=L[0],w=L[1],H=roundValueToPrecision(_,I),O=useTheme(),B=React.useState({hover:-1,focus:-1}),j=B[0],W=j.hover,D=j.focus,X=B[1],$=H;-1!==W&&($=W),-1!==D&&($=D);var q=useIsFocusVisible(),U=q.isFocusVisibleRef,Y=q.onBlur,G=q.onFocus,J=q.ref,K=React.useState(!1),Q=K[0],Z=K[1],ee=React.useRef(),te=useForkRef(J,ee),oe=useForkRef(te,t),ne=function(e){var t=parseFloat(e.target.value);w(t),R&&R(e,t)},ae=function(e){0===e.clientX&&0===e.clientY||(X({hover:-1,focus:-1}),w(null),R&&parseFloat(e.target.value)===H&&R(e,null))},re=function(e){G(e),!0===U.current&&Z(!0);var t=parseFloat(e.target.value);X(function(e){return{hover:e.hover,focus:t}}),x&&D!==t&&x(e,t)},ie=function(e){if(-1===W){Y(e),!1===U.current&&Z(!1);X(function(e){return{hover:e.hover,focus:-1}}),x&&-1!==D&&x(e,-1)}},le=React.useState(!1),se=le[0],ce=le[1],ue=function(e,t){var n="".concat(z,"-").concat(String(e.value).replace(".","-")),a=React.createElement(h,{value:e.value,className:clsx(o.icon,e.filled?o.iconFilled:o.iconEmpty,e.hover&&o.iconHover,e.focus&&o.iconFocus,e.active&&o.iconActive)},c&&!e.filled?c:f);return F?React.createElement("span",_extends({key:e.value},t),a):React.createElement(React.Fragment,{key:e.value},React.createElement("label",_extends({className:o.label,htmlFor:n},t),a,React.createElement("span",{className:o.visuallyHidden},m(e.value))),React.createElement("input",{onFocus:re,onBlur:ie,onChange:ne,onClick:ae,disabled:l,value:e.value,id:n,type:"radio",name:z,checked:e.checked,className:o.visuallyHidden}))};return React.createElement("span",_extends({ref:oe,onMouseMove:function(e){E&&E(e);var t,o=ee.current,n=o.getBoundingClientRect(),a=n.right,r=n.left,i=o.firstChild.getBoundingClientRect().width;t="rtl"===O.direction?(a-e.clientX)/(i*T):(e.clientX-r)/(i*T);var l=roundValueToPrecision(T*t+I/2,I);l=clamp(l,I,T),X(function(e){return e.hover===l&&e.focus===l?e:{hover:l,focus:l}}),Z(!1),x&&W!==l&&x(e,l)},onMouseLeave:function(e){P&&P(e);X({hover:-1,focus:-1}),x&&-1!==W&&x(e,-1)},className:clsx(o.root,n,"medium"!==N&&o["size".concat(capitalize(N))],l&&o.disabled,Q&&o.focusVisible,F&&o.readOnly),role:F?"img":null,"aria-label":F?m($):null},M),Array.from(new Array(T)).map(function(e,t){var n=t+1;if(I<1){var a=Array.from(new Array(1/I));return React.createElement("span",{key:n,className:clsx(o.decimal,n===Math.ceil($)&&(-1!==W||-1!==D)&&o.iconActive)},a.map(function(e,t){var o=roundValueToPrecision(n-1+(t+1)*I,I);return ue({value:o,filled:o<=$,hover:o<=W,focus:o<=D,checked:o===H},{style:a.length-1===t?{}:{width:o===$?"".concat((t+1)*I*100,"%"):"0%",overflow:"hidden",zIndex:1,position:"absolute"}})}))}return ue({value:n,active:n===$&&(-1!==W||-1!==D),filled:n<=$,hover:n<=W,focus:n<=D,checked:n===H})}),!F&&!l&&null==H&&React.createElement("label",{className:clsx(se&&o.labelEmptyValueActive)},React.createElement("input",{value:"",id:"".concat(z,"-empty"),type:"radio",name:z,defaultChecked:!0,className:o.visuallyHidden,onFocus:function(){return ce(!0)},onBlur:function(){return ce(!1)}}),React.createElement("span",{className:o.visuallyHidden},p)))});"production"!==process.env.NODE_ENV&&(Rating.propTypes={classes:PropTypes.object,className:PropTypes.string,defaultValue:PropTypes.number,disabled:PropTypes.bool,emptyIcon:PropTypes.node,emptyLabelText:PropTypes.node,getLabelText:PropTypes.func,icon:PropTypes.node,IconContainerComponent:PropTypes.elementType,max:PropTypes.number,name:PropTypes.string,onChange:PropTypes.func,onChangeActive:PropTypes.func,onMouseLeave:PropTypes.func,onMouseMove:PropTypes.func,precision:chainPropTypes(PropTypes.number,function(e){return e.precision<.1?new Error(["Material-UI: The prop `precision` should be above 0.1.","A value below this limit has an imperceptible impact."].join("\n")):null}),readOnly:PropTypes.bool,size:PropTypes.oneOf(["large","medium","small"]),value:PropTypes.number});export default withStyles(styles,{name:"MuiRating"})(Rating);