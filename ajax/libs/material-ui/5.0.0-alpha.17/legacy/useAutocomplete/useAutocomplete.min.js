import _extends from"@babel/runtime/helpers/esm/extends";import _slicedToArray from"@babel/runtime/helpers/esm/slicedToArray";import _typeof from"@babel/runtime/helpers/esm/typeof";import*as React from"react";import{setRef,useEventCallback,useControlled,unstable_useId as useId}from"../utils";function stripDiacritics(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}export function createFilterOptions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ignoreAccents,n=void 0===t||t,r=e.ignoreCase,o=void 0===r||r,i=e.limit,a=e.matchFrom,u=void 0===a?"any":a,c=e.stringify,l=e.trim,s=void 0!==l&&l;return function(e,t){var r=t.inputValue,a=t.getOptionLabel,l=s?r.trim():r;o&&(l=l.toLowerCase()),n&&(l=stripDiacritics(l));var f=e.filter(function(e){var t=(c||a)(e);return o&&(t=t.toLowerCase()),n&&(t=stripDiacritics(t)),"start"===u?0===t.indexOf(l):t.indexOf(l)>-1});return"number"==typeof i?f.slice(0,i):f}};function findIndex(e,t){for(var n=0;n<e.length;n+=1)if(t(e[n]))return n;return-1}var defaultFilterOptions=createFilterOptions(),pageSize=5;export default function useAutocomplete(e){var t=e.autoComplete,n=void 0!==t&&t,r=e.autoHighlight,o=void 0!==r&&r,i=e.autoSelect,a=void 0!==i&&i,u=e.blurOnSelect,c=void 0!==u&&u,l=e.clearOnBlur,s=void 0===l?!e.freeSolo:l,f=e.clearOnEscape,d=void 0!==f&&f,p=e.componentName,v=void 0===p?"useAutocomplete":p,g=e.defaultValue,h=void 0===g?e.multiple?[]:null:g,b=e.disableClearable,m=void 0!==b&&b,x=e.disableCloseOnSelect,y=void 0!==x&&x,O=e.disabledItemsFocusable,k=void 0!==O&&O,S=e.disableListWrap,C=void 0!==S&&S,D=e.filterOptions,A=void 0===D?defaultFilterOptions:D,E=e.filterSelectedOptions,R=void 0!==E&&E,w=e.freeSolo,I=void 0!==w&&w,T=e.getOptionDisabled,L=e.getOptionLabel,N=void 0===L?function(e){var t;return null!==(t=e.label)&&void 0!==t?t:e}:L,M=e.getOptionSelected,P=void 0===M?function(e,t){return e===t}:M,_=e.groupBy,V=e.handleHomeEndKeys,F=void 0===V?!e.freeSolo:V,H=e.id,q=e.includeInputInList,z=void 0!==q&&q,B=e.inputValue,K=e.multiple,U=void 0!==K&&K,J=e.onChange,j=e.onClose,Y=e.onHighlightChange,W=e.onInputChange,G=e.onOpen,Q=e.open,X=e.openOnFocus,Z=void 0!==X&&X,$=e.options,ee=e.selectOnFocus,te=void 0===ee?!e.freeSolo:ee,ne=e.value,re=useId(H),oe=N;"production"!==process.env.NODE_ENV&&(oe=function(e){var t=N(e);if("string"!=typeof t){var n=void 0===t?"undefined":"".concat(_typeof(t)," (").concat(t,")");console.error("Material-UI: The `getOptionLabel` method of ".concat(v," returned ").concat(n," instead of a string for ").concat(JSON.stringify(e),"."))}return t});var ie=React.useRef(!1),ae=React.useRef(!0),ue=React.useRef(null),ce=React.useRef(null),le=React.useState(null),se=le[0],fe=le[1],de=React.useState(-1),pe=de[0],ve=de[1],ge=o?0:-1,he=React.useRef(ge),be=useControlled({controlled:ne,default:h,name:v}),me=_slicedToArray(be,2),xe=me[0],ye=me[1],Oe=useControlled({controlled:B,default:"",name:v,state:"inputValue"}),ke=_slicedToArray(Oe,2),Se=ke[0],Ce=ke[1],De=React.useState(!1),Ae=De[0],Ee=De[1],Re=useEventCallback(function(e,t){var n;if(U)n="";else if(null==t)n="";else{var r=oe(t);n="string"==typeof r?r:""}Se!==n&&(Ce(n),W&&W(e,n,"reset"))});React.useEffect(function(){Re(null,xe)},[xe,Re]);var we=useControlled({controlled:Q,default:!1,name:v,state:"open"}),Ie=_slicedToArray(we,2),Te=Ie[0],Le=Ie[1],Ne=React.useState(!0),Me=Ne[0],Pe=Ne[1],_e=!U&&null!=xe&&Se===oe(xe),Ve=Te,Fe=Ve?A($.filter(function(e){return!R||!(U?xe:[xe]).some(function(t){return null!==t&&P(e,t)})}),{inputValue:_e&&Me?"":Se,getOptionLabel:oe}):[],He=Te&&Fe.length>0;if("production"!==process.env.NODE_ENV&&null!==xe&&!I&&$.length>0){var qe=(U?xe:[xe]).filter(function(e){return!$.some(function(t){return P(t,e)})});qe.length>0&&console.warn(["Material-UI: The value provided to ".concat(v," is invalid."),"None of the options match with `".concat(qe.length>1?JSON.stringify(qe):JSON.stringify(qe[0]),"`."),"You can use the `getOptionSelected` prop to customize the equality test."].join("\n"))}var ze=useEventCallback(function(e){-1===e?ue.current.focus():se.querySelector('[data-tag-index="'.concat(e,'"]')).focus()});React.useEffect(function(){U&&pe>xe.length-1&&(ve(-1),ze(-1))},[xe,U,pe,ze]);var Be=useEventCallback(function(e){var t=e.event,n=e.index,r=e.reason,o=void 0===r?"auto":r;if(he.current=n,-1===n?ue.current.removeAttribute("aria-activedescendant"):ue.current.setAttribute("aria-activedescendant","".concat(re,"-option-").concat(n)),Y&&Y(t,-1===n?null:Fe[n],o),ce.current){var i=ce.current.querySelector("[data-focus]");i&&(i.removeAttribute("data-focus"),i.classList.remove("Mui-focusVisible"));var a=ce.current.parentElement.querySelector('[role="listbox"]');if(a)if(-1!==n){var u=ce.current.querySelector('[data-option-index="'.concat(n,'"]'));if(u&&(u.setAttribute("data-focus","true"),"keyboard"===o&&u.classList.add("Mui-focusVisible"),a.scrollHeight>a.clientHeight&&"mouse"!==o)){var c=u,l=a.clientHeight+a.scrollTop,s=c.offsetTop+c.offsetHeight;s>l?a.scrollTop=s-a.clientHeight:c.offsetTop-c.offsetHeight*(_?1.3:0)<a.scrollTop&&(a.scrollTop=c.offsetTop-c.offsetHeight*(_?1.3:0))}}else a.scrollTop=0}}),Ke=useEventCallback(function(e){var t=e.event,r=e.diff,o=e.direction,i=void 0===o?"next":o,a=e.reason,u=void 0===a?"auto":a;if(Ve){var c=function(e,t){if(!ce.current||-1===e)return-1;for(var n=e;;){if("next"===t&&n===Fe.length||"previous"===t&&-1===n)return-1;var r=ce.current.querySelector('[data-option-index="'.concat(n,'"]')),o=!k&&(!r||r.disabled||"true"===r.getAttribute("aria-disabled"));if(!(r&&!r.hasAttribute("tabindex")||o))return n;n+="next"===t?1:-1}}(function(){var e=Fe.length-1;if("reset"===r)return ge;if("start"===r)return 0;if("end"===r)return e;var t=he.current+r;return t<0?-1===t&&z?-1:C&&-1!==he.current||Math.abs(r)>1?0:e:t>e?t===e+1&&z?-1:C||Math.abs(r)>1?e:0:t}(),i);if(Be({index:c,reason:u,event:t}),n&&"reset"!==r)if(-1===c)ue.current.value=Se;else{var l=oe(Fe[c]);ue.current.value=l,0===l.toLowerCase().indexOf(Se.toLowerCase())&&Se.length>0&&ue.current.setSelectionRange(Se.length,l.length)}}}),Ue=React.useCallback(function(){if(Ve){var e=U?xe[0]:xe;if(0!==Fe.length&&null!=e){if(ce.current)if(null==e)he.current>=Fe.length-1?Be({index:Fe.length-1}):Be({index:he.current});else{var t=Fe[he.current];if(U&&t&&-1!==findIndex(xe,function(e){return P(t,e)}))return;var n=findIndex(Fe,function(t){return P(t,e)});-1===n?Ke({diff:"reset"}):Be({index:n})}}else Ke({diff:"reset"})}},[0===Fe.length,!U&&xe,R,Ke,Be,Ve,Se,U]),Je=useEventCallback(function(e){setRef(ce,e),e&&Ue()});React.useEffect(function(){Ue()},[Ue]);var je=function(e){Te||(Le(!0),Pe(!0),G&&G(e))},Ye=function(e,t){Te&&(Le(!1),j&&j(e,t))},We=function(e,t,n,r){xe!==t&&(J&&J(e,t,n,r),ye(t))},Ge=React.useRef(!1),Qe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"select-option",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"options",o=n,i=t;if(U){if(i=Array.isArray(xe)?xe.slice():[],"production"!==process.env.NODE_ENV){var a=i.filter(function(e){return P(t,e)});a.length>1&&console.error(["Material-UI: The `getOptionSelected` method of ".concat(v," do not handle the arguments correctly."),"The component expects a single value to match a given option but found ".concat(a.length," matches.")].join("\n"))}var u=findIndex(i,function(e){return P(t,e)});-1===u?i.push(t):"freeSolo"!==r&&(i.splice(u,1),o="remove-option")}Re(e,i),We(e,i,o,{option:t}),y||e.ctrlKey||e.metaKey||Ye(e,o),(!0===c||"touch"===c&&Ge.current||"mouse"===c&&!Ge.current)&&ue.current.blur()};var Xe=function(e,t){if(U){Ye(e,"toggleInput");var n=pe;-1===pe?""===Se&&"previous"===t&&(n=xe.length-1):((n+="next"===t?1:-1)<0&&(n=0),n===xe.length&&(n=-1)),n=function(e,t){if(-1===e)return-1;for(var n=e;;){if("next"===t&&n===xe.length||"previous"===t&&-1===n)return-1;var r=se.querySelector('[data-tag-index="'.concat(n,'"]'));if(r&&r.hasAttribute("tabindex")&&!r.disabled&&"true"!==r.getAttribute("aria-disabled"))return n;n+="next"===t?1:-1}}(n,t),ve(n),ze(n)}},Ze=function(e){ie.current=!0,Ce(""),W&&W(e,"","clear"),We(e,U?[]:null,"clear")},$e=function(e){Ee(!0),Z&&!ie.current&&je(e)},et=function(e){null!==ce.current&&ce.current.parentElement.contains(document.activeElement)?ue.current.focus():(Ee(!1),ae.current=!0,ie.current=!1,a&&-1!==he.current&&Ve?Qe(e,Fe[he.current],"blur"):a&&I&&""!==Se?Qe(e,Se,"blur","freeSolo"):s&&Re(e,xe),Ye(e,"blur"))},tt=function(e){var t=e.target.value;Se!==t&&(Ce(t),Pe(!1),W&&W(e,t,"input")),""===t?m||U||We(e,null,"clear"):je(e)},nt=function(e){Be({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"mouse"})},rt=function(){Ge.current=!0},ot=function(e){var t=Number(e.currentTarget.getAttribute("data-option-index"));Qe(e,Fe[t],"select-option"),Ge.current=!1},it=function(e){Te?Ye(e,"toggleInput"):je(e)},at=function(e){e.target.getAttribute("id")!==re&&e.preventDefault()},ut=function(){ue.current.focus(),te&&ae.current&&ue.current.selectionEnd-ue.current.selectionStart==0&&ue.current.select(),ae.current=!1},ct=function(e){""!==Se&&Te||it(e)},lt=I&&Se.length>0;lt=lt||(U?xe.length>0:null!==xe);var st=Fe;if(_){var ft=new Map,dt=!1;st=Fe.reduce(function(e,t,n){var r=_(t);return e.length>0&&e[e.length-1].group===r?e[e.length-1].options.push(t):("production"!==process.env.NODE_ENV&&(ft.get(r)&&!dt&&(console.warn("Material-UI: The options provided combined with the `groupBy` method of ".concat(v," returns duplicated headers."),"You can solve the issue by sorting the options with the output of `groupBy`."),dt=!0),ft.set(r,!0)),e.push({key:n,index:n,group:r,options:[t]})),e},[])}return{getRootProps:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _extends({"aria-owns":He?"".concat(re,"-listbox"):null,role:"combobox","aria-expanded":He},e,{onKeyDown:function(e){return function(t){if(-1!==pe&&-1===["ArrowLeft","ArrowRight"].indexOf(t.key)&&(ve(-1),ze(-1)),229!==t.which)switch(t.key){case"Home":Ve&&F&&(t.preventDefault(),Ke({diff:"start",direction:"next",reason:"keyboard",event:t}));break;case"End":Ve&&F&&(t.preventDefault(),Ke({diff:"end",direction:"previous",reason:"keyboard",event:t}));break;case"PageUp":t.preventDefault(),Ke({diff:-pageSize,direction:"previous",reason:"keyboard",event:t}),je(t);break;case"PageDown":t.preventDefault(),Ke({diff:pageSize,direction:"next",reason:"keyboard",event:t}),je(t);break;case"ArrowDown":t.preventDefault(),Ke({diff:1,direction:"next",reason:"keyboard",event:t}),je(t);break;case"ArrowUp":t.preventDefault(),Ke({diff:-1,direction:"previous",reason:"keyboard",event:t}),je(t);break;case"ArrowLeft":Xe(t,"previous");break;case"ArrowRight":Xe(t,"next");break;case"Enter":if(-1!==he.current&&Ve){var r=Fe[he.current],o=!!T&&T(r);if(t.preventDefault(),o)return;Qe(t,r,"select-option"),n&&ue.current.setSelectionRange(ue.current.value.length,ue.current.value.length)}else I&&""!==Se&&!1===_e&&(U&&t.preventDefault(),Qe(t,Se,"create-option","freeSolo"));break;case"Escape":Ve?(t.preventDefault(),t.stopPropagation(),Ye(t,"escape")):d&&(""!==Se||U&&xe.length>0)&&(t.preventDefault(),t.stopPropagation(),Ze(t));break;case"Backspace":if(U&&""===Se&&xe.length>0){var i=-1===pe?xe.length-1:pe,a=xe.slice();a.splice(i,1),We(t,a,"remove-option",{option:xe[i]})}}e.onKeyDown&&e.onKeyDown(t)}}(e),onMouseDown:at,onClick:ut})},getInputLabelProps:function(){return{id:"".concat(re,"-label"),htmlFor:re}},getInputProps:function(){return{id:re,value:Se,onBlur:et,onFocus:$e,onChange:tt,onMouseDown:ct,"aria-activedescendant":Ve?"":null,"aria-autocomplete":n?"both":"list","aria-controls":He?"".concat(re,"-listbox"):null,autoComplete:"off",ref:ue,autoCapitalize:"none",spellCheck:"false"}},getClearProps:function(){return{tabIndex:-1,onClick:Ze}},getPopupIndicatorProps:function(){return{tabIndex:-1,onClick:it}},getTagProps:function(e){var t=e.index;return{key:t,"data-tag-index":t,tabIndex:-1,onDelete:function(e){return function(t){var n=xe.slice();n.splice(e,1),We(t,n,"remove-option",{option:xe[e]})}}(t)}},getListboxProps:function(){return{role:"listbox",id:"".concat(re,"-listbox"),"aria-labelledby":"".concat(re,"-label"),ref:Je,onMouseDown:function(e){e.preventDefault()}}},getOptionProps:function(e){var t=e.index,n=e.option,r=(U?xe:[xe]).some(function(e){return null!=e&&P(n,e)}),o=!!T&&T(n);return{key:t,tabIndex:-1,role:"option",id:"".concat(re,"-option-").concat(t),onMouseOver:nt,onClick:ot,onTouchStart:rt,"data-option-index":t,"aria-disabled":o,"aria-selected":r}},id:re,inputValue:Se,value:xe,dirty:lt,popupOpen:Ve,focused:Ae||-1!==pe,anchorEl:se,setAnchorEl:fe,focusedTag:pe,groupedOptions:st}};