import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import clsx from"clsx";import{deepmerge}from"@material-ui/utils";import experimentalStyled from"../styles/experimentalStyled";import useThemeProps from"../styles/useThemeProps";import Person from"../internal/svg-icons/Person";import avatarClasses,{getAvatarUtilityClass}from"./avatarClasses";const overridesResolver=(e,t)=>{const{colorDefault:r,variant:a="circular"}=e;return deepmerge(t.root||{},_extends({},t[a],r&&t.colorDefault,{[`& .${avatarClasses.img}`]:t.img,[`& .${avatarClasses.fallback}`]:t.fallback}))},useUtilityClasses=e=>{const{classes:t={},variant:r,colorDefault:a}=e;return{root:clsx(avatarClasses.root,t.root,getAvatarUtilityClass(r),t[r],a&&[avatarClasses.colorDefault,t.colorDefault]),img:clsx(avatarClasses.img,t.img),fallback:clsx(avatarClasses.fallback,t.fallback)}},AvatarRoot=experimentalStyled("div",{},{name:"MuiAvatar",slot:"Root",overridesResolver:overridesResolver})(({theme:e,styleProps:t})=>_extends({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none"},"rounded"===t.variant&&{borderRadius:e.shape.borderRadius},"square"===t.variant&&{borderRadius:0},t.colorDefault&&{color:e.palette.background.default,backgroundColor:"light"===e.palette.mode?e.palette.grey[400]:e.palette.grey[600]})),AvatarImg=experimentalStyled("img",{},{name:"MuiAvatar",slot:"Img"})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),AvatarFallback=experimentalStyled(Person,{},{name:"MuiAvatar",slot:"Fallback"})({width:"75%",height:"75%"});function useLoaded({src:e,srcSet:t}){const[r,a]=React.useState(!1);return React.useEffect(()=>{if(!e&&!t)return;a(!1);let r=!0;const s=new Image;return s.src=e,t&&(s.srcset=t),s.onload=(()=>{r&&a("loaded")}),s.onerror=(()=>{r&&a("error")}),()=>{r=!1}},[e,t]),r}const Avatar=React.forwardRef(function(e,t){const r=useThemeProps({props:e,name:"MuiAvatar"}),{alt:a,children:s,className:o,component:l="div",imgProps:i,sizes:n,src:c,srcSet:p,variant:m="circular"}=r,d=_objectWithoutPropertiesLoose(r,["alt","children","className","component","imgProps","sizes","src","srcSet","variant"]);let u=null;const v=useLoaded({src:c,srcSet:p}),f=c||p,y=f&&"error"!==v,g=_extends({},r,{variant:m,colorDefault:!y}),h=useUtilityClasses(g);return u=y?React.createElement(AvatarImg,_extends({alt:a,src:c,srcSet:p,sizes:n,className:h.img},i)):null!=s?s:f&&a?a[0]:React.createElement(AvatarFallback,{className:h.fallback}),React.createElement(AvatarRoot,_extends({as:l,styleProps:g,className:clsx(h.root,o),ref:t},d),u)});"production"!==process.env.NODE_ENV&&(Avatar.propTypes={alt:PropTypes.string,children:PropTypes.node,classes:PropTypes.object,className:PropTypes.string,component:PropTypes.elementType,imgProps:PropTypes.object,sizes:PropTypes.string,src:PropTypes.string,srcSet:PropTypes.string,sx:PropTypes.object,variant:PropTypes.oneOfType([PropTypes.oneOf(["circular","rounded","square"]),PropTypes.string])});export default Avatar;