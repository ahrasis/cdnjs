"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFilterOptions=createFilterOptions,exports.default=useAutocomplete;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),React=_interopRequireWildcard(require("react")),_utils=require("../utils");function stripDiacritics(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}function createFilterOptions(e={}){const{ignoreAccents:t=!0,ignoreCase:n=!0,limit:r,matchFrom:o="any",stringify:i,trim:l=!1}=e;return(e,{inputValue:a,getOptionLabel:u})=>{let s=l?a.trim():a;n&&(s=s.toLowerCase()),t&&(s=stripDiacritics(s));const c=e.filter(e=>{let r=(i||u)(e);return n&&(r=r.toLowerCase()),t&&(r=stripDiacritics(r)),"start"===o?0===r.indexOf(s):r.indexOf(s)>-1});return"number"==typeof r?c.slice(0,r):c}}function findIndex(e,t){for(let n=0;n<e.length;n+=1)if(t(e[n]))return n;return-1}const defaultFilterOptions=createFilterOptions(),pageSize=5;function useAutocomplete(e){const{autoComplete:t=!1,autoHighlight:n=!1,autoSelect:r=!1,blurOnSelect:o=!1,clearOnBlur:i=!e.freeSolo,clearOnEscape:l=!1,componentName:a="useAutocomplete",debug:u=!1,defaultValue:s=(e.multiple?[]:null),disableClearable:c=!1,disableCloseOnSelect:p=!1,disabledItemsFocusable:d=!1,disableListWrap:f=!1,filterOptions:g=defaultFilterOptions,filterSelectedOptions:b=!1,freeSolo:h=!1,getOptionDisabled:v,getOptionLabel:m=(e=>{var t;return null!==(t=e.label)&&void 0!==t?t:e}),getOptionSelected:x=((e,t)=>e===t),groupBy:y,handleHomeEndKeys:O=!e.freeSolo,id:k,includeInputInList:S=!1,inputValue:D,multiple:R=!1,onChange:C,onClose:w,onHighlightChange:E,onInputChange:A,onOpen:_,open:$,openOnFocus:I=!1,options:q,selectOnFocus:T=!e.freeSolo,value:L}=e,N=(0,_utils.unstable_useId)(k);let M=m;"production"!==process.env.NODE_ENV&&(M=(e=>{const t=m(e);if("string"!=typeof t){const n=void 0===t?"undefined":`${typeof t} (${t})`;console.error(`Material-UI: The \`getOptionLabel\` method of ${a} returned ${n} instead of a string for ${JSON.stringify(e)}.`)}return t}));const P=React.useRef(!1),F=React.useRef(!0),V=React.useRef(null),H=React.useRef(null),[z,B]=React.useState(null),[K,U]=React.useState(-1),W=n?0:-1,j=React.useRef(W),[J,Y]=(0,_utils.useControlled)({controlled:L,default:s,name:a}),[G,Q]=(0,_utils.useControlled)({controlled:D,default:"",name:a,state:"inputValue"}),[X,Z]=React.useState(!1),ee=(0,_utils.useEventCallback)((e,t)=>{let n;if(R)n="";else if(null==t)n="";else{const e=M(t);n="string"==typeof e?e:""}G!==n&&(Q(n),A&&A(e,n,"reset"))});React.useEffect(()=>{ee(null,J)},[J,ee]);const[te,ne]=(0,_utils.useControlled)({controlled:$,default:!1,name:a,state:"open"}),[re,oe]=React.useState(!0),ie=!R&&null!=J&&G===M(J),le=te,ae=le?g(q.filter(e=>!b||!(R?J:[J]).some(t=>null!==t&&x(e,t))),{inputValue:ie&&re?"":G,getOptionLabel:M}):[],ue=te&&ae.length>0;if("production"!==process.env.NODE_ENV&&null!==J&&!h&&q.length>0){const e=(R?J:[J]).filter(e=>!q.some(t=>x(t,e)));e.length>0&&console.warn([`Material-UI: The value provided to ${a} is invalid.`,`None of the options match with \`${e.length>1?JSON.stringify(e):JSON.stringify(e[0])}\`.`,"You can use the `getOptionSelected` prop to customize the equality test."].join("\n"))}const se=(0,_utils.useEventCallback)(e=>{-1===e?V.current.focus():z.querySelector(`[data-tag-index="${e}"]`).focus()});React.useEffect(()=>{R&&K>J.length-1&&(U(-1),se(-1))},[J,R,K,se]);const ce=(0,_utils.useEventCallback)(({event:e,index:t,reason:n="auto"})=>{if(j.current=t,-1===t?V.current.removeAttribute("aria-activedescendant"):V.current.setAttribute("aria-activedescendant",`${N}-option-${t}`),E&&E(e,-1===t?null:ae[t],n),!H.current)return;const r=H.current.querySelector("[data-focus]");r&&(r.removeAttribute("data-focus"),r.classList.remove("Mui-focusVisible"));const o=H.current.parentElement.querySelector('[role="listbox"]');if(!o)return;if(-1===t)return void(o.scrollTop=0);const i=H.current.querySelector(`[data-option-index="${t}"]`);if(i&&(i.setAttribute("data-focus","true"),"keyboard"===n&&i.classList.add("Mui-focusVisible"),o.scrollHeight>o.clientHeight&&"mouse"!==n)){const e=i,t=o.clientHeight+o.scrollTop,n=e.offsetTop+e.offsetHeight;n>t?o.scrollTop=n-o.clientHeight:e.offsetTop-e.offsetHeight*(y?1.3:0)<o.scrollTop&&(o.scrollTop=e.offsetTop-e.offsetHeight*(y?1.3:0))}}),pe=(0,_utils.useEventCallback)(({event:e,diff:n,direction:r="next",reason:o="auto"})=>{if(!le)return;const i=function(e,t){if(!H.current||-1===e)return-1;let n=e;for(;;){if("next"===t&&n===ae.length||"previous"===t&&-1===n)return-1;const e=H.current.querySelector(`[data-option-index="${n}"]`),r=!d&&(!e||e.disabled||"true"===e.getAttribute("aria-disabled"));if(!(e&&!e.hasAttribute("tabindex")||r))return n;n+="next"===t?1:-1}}((()=>{const e=ae.length-1;if("reset"===n)return W;if("start"===n)return 0;if("end"===n)return e;const t=j.current+n;return t<0?-1===t&&S?-1:f&&-1!==j.current||Math.abs(n)>1?0:e:t>e?t===e+1&&S?-1:f||Math.abs(n)>1?e:0:t})(),r);if(ce({index:i,reason:o,event:e}),t&&"reset"!==n)if(-1===i)V.current.value=G;else{const e=M(ae[i]);V.current.value=e,0===e.toLowerCase().indexOf(G.toLowerCase())&&G.length>0&&V.current.setSelectionRange(G.length,e.length)}}),de=React.useCallback(()=>{if(!le)return;const e=R?J[0]:J;if(0!==ae.length&&null!=e){if(H.current)if(null==e)j.current>=ae.length-1?ce({index:ae.length-1}):ce({index:j.current});else{const t=ae[j.current];if(R&&t&&-1!==findIndex(J,e=>x(t,e)))return;const n=findIndex(ae,t=>x(t,e));-1===n?pe({diff:"reset"}):ce({index:n})}}else pe({diff:"reset"})},[0===ae.length,!R&&J,b,pe,ce,le,G,R]),fe=(0,_utils.useEventCallback)(e=>{(0,_utils.setRef)(H,e),e&&de()});React.useEffect(()=>{de()},[de]);const ge=e=>{te||(ne(!0),oe(!0),_&&_(e))},be=(e,t)=>{te&&(ne(!1),w&&w(e,t))},he=(e,t,n,r)=>{J!==t&&(C&&C(e,t,n,r),Y(t))},ve=React.useRef(!1),me=(e,t,n="select-option",r="options")=>{let i=n,l=t;if(R){if(l=Array.isArray(J)?J.slice():[],"production"!==process.env.NODE_ENV){const e=l.filter(e=>x(t,e));e.length>1&&console.error([`Material-UI: The \`getOptionSelected\` method of ${a} do not handle the arguments correctly.`,`The component expects a single value to match a given option but found ${e.length} matches.`].join("\n"))}const e=findIndex(l,e=>x(t,e));-1===e?l.push(t):"freeSolo"!==r&&(l.splice(e,1),i="remove-option")}ee(e,l),he(e,l,i,{option:t}),p||e.ctrlKey||e.metaKey||be(e,i),(!0===o||"touch"===o&&ve.current||"mouse"===o&&!ve.current)&&V.current.blur()};const xe=(e,t)=>{if(!R)return;be(e,"toggleInput");let n=K;-1===K?""===G&&"previous"===t&&(n=J.length-1):((n+="next"===t?1:-1)<0&&(n=0),n===J.length&&(n=-1)),n=function(e,t){if(-1===e)return-1;let n=e;for(;;){if("next"===t&&n===J.length||"previous"===t&&-1===n)return-1;const e=z.querySelector(`[data-tag-index="${n}"]`);if(e&&e.hasAttribute("tabindex")&&!e.disabled&&"true"!==e.getAttribute("aria-disabled"))return n;n+="next"===t?1:-1}}(n,t),U(n),se(n)},ye=e=>{P.current=!0,Q(""),A&&A(e,"","clear"),he(e,R?[]:null,"clear")},Oe=e=>{ce({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"mouse"})},ke=()=>{ve.current=!0},Se=e=>{const t=Number(e.currentTarget.getAttribute("data-option-index"));me(e,ae[t],"select-option"),ve.current=!1},De=e=>{te?be(e,"toggleInput"):ge(e)},Re=e=>{e.target.getAttribute("id")!==N&&e.preventDefault()},Ce=()=>{V.current.focus(),T&&F.current&&V.current.selectionEnd-V.current.selectionStart==0&&V.current.select(),F.current=!1};let we=h&&G.length>0;we=we||(R?J.length>0:null!==J);let Ee=ae;if(y){const e=new Map;let t=!1;Ee=ae.reduce((n,r,o)=>{const i=y(r);return n.length>0&&n[n.length-1].group===i?n[n.length-1].options.push(r):("production"!==process.env.NODE_ENV&&(e.get(i)&&!t&&(console.warn(`Material-UI: The options provided combined with the \`groupBy\` method of ${a} returns duplicated headers.`,"You can solve the issue by sorting the options with the output of `groupBy`."),t=!0),e.set(i,!0)),n.push({key:o,index:o,group:i,options:[r]})),n},[])}return{getRootProps:(e={})=>(0,_extends2.default)({"aria-owns":ue?`${N}-listbox`:null,role:"combobox","aria-expanded":ue},e,{onKeyDown:(e=>n=>{if(-1!==K&&-1===["ArrowLeft","ArrowRight"].indexOf(n.key)&&(U(-1),se(-1)),229!==n.which)switch(n.key){case"Home":le&&O&&(n.preventDefault(),pe({diff:"start",direction:"next",reason:"keyboard",event:n}));break;case"End":le&&O&&(n.preventDefault(),pe({diff:"end",direction:"previous",reason:"keyboard",event:n}));break;case"PageUp":n.preventDefault(),pe({diff:-pageSize,direction:"previous",reason:"keyboard",event:n}),ge(n);break;case"PageDown":n.preventDefault(),pe({diff:pageSize,direction:"next",reason:"keyboard",event:n}),ge(n);break;case"ArrowDown":n.preventDefault(),pe({diff:1,direction:"next",reason:"keyboard",event:n}),ge(n);break;case"ArrowUp":n.preventDefault(),pe({diff:-1,direction:"previous",reason:"keyboard",event:n}),ge(n);break;case"ArrowLeft":xe(n,"previous");break;case"ArrowRight":xe(n,"next");break;case"Enter":if(-1!==j.current&&le){const e=ae[j.current],r=!!v&&v(e);if(n.preventDefault(),r)return;me(n,e,"select-option"),t&&V.current.setSelectionRange(V.current.value.length,V.current.value.length)}else h&&""!==G&&!1===ie&&(R&&n.preventDefault(),me(n,G,"create-option","freeSolo"));break;case"Escape":le?(n.preventDefault(),n.stopPropagation(),be(n,"escape")):l&&(""!==G||R&&J.length>0)&&(n.preventDefault(),n.stopPropagation(),ye(n));break;case"Backspace":if(R&&""===G&&J.length>0){const e=-1===K?J.length-1:K,t=J.slice();t.splice(e,1),he(n,t,"remove-option",{option:J[e]})}}e.onKeyDown&&e.onKeyDown(n)})(e),onMouseDown:Re,onClick:Ce}),getInputLabelProps:()=>({id:`${N}-label`,htmlFor:N}),getInputProps:()=>({id:N,value:G,onBlur:e=>{null!==H.current&&H.current.parentElement.contains(document.activeElement)?V.current.focus():(Z(!1),F.current=!0,P.current=!1,u&&""!==G||(r&&-1!==j.current&&le?me(e,ae[j.current],"blur"):r&&h&&""!==G?me(e,G,"blur","freeSolo"):i&&ee(e,J),be(e,"blur")))},onFocus:e=>{Z(!0),I&&!P.current&&ge(e)},onChange:e=>{const t=e.target.value;G!==t&&(Q(t),oe(!1),A&&A(e,t,"input")),""===t?c||R||he(e,null,"clear"):ge(e)},onMouseDown:e=>{""!==G&&te||De(e)},"aria-activedescendant":le?"":null,"aria-autocomplete":t?"both":"list","aria-controls":ue?`${N}-listbox`:null,autoComplete:"off",ref:V,autoCapitalize:"none",spellCheck:"false"}),getClearProps:()=>({tabIndex:-1,onClick:ye}),getPopupIndicatorProps:()=>({tabIndex:-1,onClick:De}),getTagProps:({index:e})=>({key:e,"data-tag-index":e,tabIndex:-1,onDelete:(e=>t=>{const n=J.slice();n.splice(e,1),he(t,n,"remove-option",{option:J[e]})})(e)}),getListboxProps:()=>({role:"listbox",id:`${N}-listbox`,"aria-labelledby":`${N}-label`,ref:fe,onMouseDown:e=>{e.preventDefault()}}),getOptionProps:({index:e,option:t})=>{const n=(R?J:[J]).some(e=>null!=e&&x(t,e)),r=!!v&&v(t);return{key:e,tabIndex:-1,role:"option",id:`${N}-option-${e}`,onMouseOver:Oe,onClick:Se,onTouchStart:ke,"data-option-index":e,"aria-disabled":r,"aria-selected":n}},id:N,inputValue:G,value:J,dirty:we,popupOpen:le,focused:X||-1!==K,anchorEl:z,setAnchorEl:B,focusedTag:K,groupedOptions:Ee}}