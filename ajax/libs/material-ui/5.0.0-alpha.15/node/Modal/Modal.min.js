"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.styles=void 0;var _objectWithoutPropertiesLoose2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_styles=require("@material-ui/styles"),_utils=require("@material-ui/utils"),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_Portal=_interopRequireDefault(require("../Portal")),_createChainedFunction=_interopRequireDefault(require("../utils/createChainedFunction")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef")),_useEventCallback=_interopRequireDefault(require("../utils/useEventCallback")),_zIndex=_interopRequireDefault(require("../styles/zIndex")),_ModalManager=_interopRequireWildcard(require("./ModalManager")),_Unstable_TrapFocus=_interopRequireDefault(require("../Unstable_TrapFocus")),_SimpleBackdrop=_interopRequireDefault(require("./SimpleBackdrop"));function getContainer(e){return"function"==typeof e?e():e}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}const defaultManager=new _ModalManager.default,styles=e=>({root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}});exports.styles=styles;const Modal=React.forwardRef(function(e,o){const t=(0,_styles.useTheme)(),r=(0,_styles.getThemeProps)({name:"MuiModal",props:(0,_extends2.default)({},e),theme:t}),{BackdropComponent:a=_SimpleBackdrop.default,BackdropProps:l,children:n,closeAfterTransition:s=!1,container:u,disableAutoFocus:i=!1,disableBackdropClick:p=!1,disableEnforceFocus:d=!1,disableEscapeKeyDown:c=!1,disablePortal:f=!1,disableRestoreFocus:_=!1,disableScrollLock:b=!1,hideBackdrop:y=!1,keepMounted:R=!1,manager:k=defaultManager,onBackdropClick:T,onClose:q,onEscapeKeyDown:m,open:E}=r,h=(0,_objectWithoutPropertiesLoose2.default)(r,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","open"]),[C,D]=React.useState(!0),x=React.useRef({}),F=React.useRef(null),M=React.useRef(null),g=(0,_useForkRef.default)(M,o),B=getHasTransition(r),P=()=>(0,_ownerDocument.default)(F.current),v=()=>(x.current.modalRef=M.current,x.current.mountNode=F.current,x.current),w=()=>{k.mount(v(),{disableScrollLock:b}),M.current.scrollTop=0},I=(0,_useEventCallback.default)(()=>{const e=getContainer(u)||P().body;k.add(v(),e),M.current&&w()}),A=React.useCallback(()=>k.isTopModal(v()),[k]),K=(0,_useEventCallback.default)(e=>{F.current=e,e&&(E&&A()?w():(0,_ModalManager.ariaHidden)(M.current,!0))}),L=React.useCallback(()=>{k.remove(v())},[k]);if(React.useEffect(()=>()=>{L()},[L]),React.useEffect(()=>{E?I():B&&s||L()},[E,L,B,s,I]),!R&&!E&&(!B||C))return null;const S=()=>{D(!1)},W=()=>{D(!0),s&&L()},z=styles(t||{zIndex:_zIndex.default}),j={};return void 0===n.props.tabIndex&&(j.tabIndex=n.props.tabIndex||"-1"),B&&(j.onEnter=(0,_createChainedFunction.default)(S,n.props.onEnter),j.onExited=(0,_createChainedFunction.default)(W,n.props.onExited)),React.createElement(_Portal.default,{ref:K,container:u,disablePortal:f},React.createElement("div",(0,_extends2.default)({ref:g,onKeyDown:e=>{"Escape"===e.key&&A()&&(m&&m(e),c||(e.stopPropagation(),q&&q(e,"escapeKeyDown")))},role:"presentation"},h,{style:(0,_extends2.default)({},z.root,!E&&C?z.hidden:{},h.style)}),y?null:React.createElement(a,(0,_extends2.default)({open:E,onClick:e=>{e.target===e.currentTarget&&(T&&T(e),!p&&q&&q(e,"backdropClick"))}},l)),React.createElement(_Unstable_TrapFocus.default,{disableEnforceFocus:d,disableAutoFocus:i,disableRestoreFocus:_,getDoc:P,isEnabled:A,open:E},React.cloneElement(n,j))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:_propTypes.default.elementType,BackdropProps:_propTypes.default.object,children:_utils.elementAcceptingRef.isRequired,closeAfterTransition:_propTypes.default.bool,container:_propTypes.default.oneOfType([_utils.HTMLElementType,_propTypes.default.func]),disableAutoFocus:_propTypes.default.bool,disableBackdropClick:_propTypes.default.bool,disableEnforceFocus:_propTypes.default.bool,disableEscapeKeyDown:_propTypes.default.bool,disablePortal:_propTypes.default.bool,disableRestoreFocus:_propTypes.default.bool,disableScrollLock:_propTypes.default.bool,hideBackdrop:_propTypes.default.bool,keepMounted:_propTypes.default.bool,onBackdropClick:_propTypes.default.func,onClose:_propTypes.default.func,onEscapeKeyDown:_propTypes.default.func,open:_propTypes.default.bool.isRequired});var _default=Modal;exports.default=_default;