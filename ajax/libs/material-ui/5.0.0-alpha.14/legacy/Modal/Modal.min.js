import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef,HTMLElementType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"../Unstable_TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return"function"==typeof e?e():e}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}var defaultManager=new ModalManager;export var styles=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}};var Modal=React.forwardRef(function(e,o){var r=useTheme(),t=getThemeProps({name:"MuiModal",props:_extends({},e),theme:r}),n=t.BackdropComponent,a=void 0===n?SimpleBackdrop:n,i=t.BackdropProps,c=t.children,s=t.closeAfterTransition,p=void 0!==s&&s,l=t.container,d=t.disableAutoFocus,u=void 0!==d&&d,f=t.disableBackdropClick,m=void 0!==f&&f,b=t.disableEnforceFocus,k=void 0!==b&&b,y=t.disableEscapeKeyDown,T=void 0!==y&&y,P=t.disablePortal,E=void 0!==P&&P,R=t.disableRestoreFocus,h=void 0!==R&&R,v=t.disableScrollLock,C=void 0!==v&&v,F=t.hideBackdrop,g=void 0!==F&&F,x=t.keepMounted,M=void 0!==x&&x,B=t.manager,w=void 0===B?defaultManager:B,D=t.onBackdropClick,A=t.onClose,I=t.onEscapeKeyDown,_=t.open,K=_objectWithoutProperties(t,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","open"]),S=React.useState(!0),z=S[0],H=S[1],L=React.useRef({}),j=React.useRef(null),N=React.useRef(null),O=useForkRef(N,o),W=getHasTransition(t),q=function(){return ownerDocument(j.current)},U=function(){return L.current.modalRef=N.current,L.current.mountNode=j.current,L.current},V=function(){w.mount(U(),{disableScrollLock:C}),N.current.scrollTop=0},G=useEventCallback(function(){var e=getContainer(l)||q().body;w.add(U(),e),N.current&&V()}),J=React.useCallback(function(){return w.isTopModal(U())},[w]),Q=useEventCallback(function(e){j.current=e,e&&(_&&J()?V():ariaHidden(N.current,!0))}),X=React.useCallback(function(){w.remove(U())},[w]);if(React.useEffect(function(){return function(){X()}},[X]),React.useEffect(function(){_?G():W&&p||X()},[_,X,W,p,G]),!M&&!_&&(!W||z))return null;var Y=styles(r||{zIndex:zIndex}),Z={};return void 0===c.props.tabIndex&&(Z.tabIndex=c.props.tabIndex||"-1"),W&&(Z.onEnter=createChainedFunction(function(){H(!1)},c.props.onEnter),Z.onExited=createChainedFunction(function(){H(!0),p&&X()},c.props.onExited)),React.createElement(Portal,{ref:Q,container:l,disablePortal:E},React.createElement("div",_extends({ref:O,onKeyDown:function(e){"Escape"===e.key&&J()&&(I&&I(e),T||(e.stopPropagation(),A&&A(e,"escapeKeyDown")))},role:"presentation"},K,{style:_extends({},Y.root,!_&&z?Y.hidden:{},K.style)}),g?null:React.createElement(a,_extends({open:_,onClick:function(e){e.target===e.currentTarget&&(D&&D(e),!m&&A&&A(e,"backdropClick"))}},i)),React.createElement(TrapFocus,{disableEnforceFocus:k,disableAutoFocus:u,disableRestoreFocus:h,getDoc:q,isEnabled:J,open:_},React.cloneElement(c,Z))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([HTMLElementType,PropTypes.func]),disableAutoFocus:PropTypes.bool,disableBackdropClick:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,onBackdropClick:PropTypes.func,onClose:PropTypes.func,onEscapeKeyDown:PropTypes.func,open:PropTypes.bool.isRequired});export default Modal;