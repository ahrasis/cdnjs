import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef,HTMLElementType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"../Unstable_TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return"function"==typeof e?e():e}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}const defaultManager=new ModalManager;export const styles=e=>({root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}});const Modal=React.forwardRef(function(e,o){const r=useTheme(),t=getThemeProps({name:"MuiModal",props:_extends({},e),theme:r}),{BackdropComponent:n=SimpleBackdrop,BackdropProps:a,children:s,closeAfterTransition:c=!1,container:p,disableAutoFocus:l=!1,disableBackdropClick:i=!1,disableEnforceFocus:d=!1,disableEscapeKeyDown:u=!1,disablePortal:m=!1,disableRestoreFocus:b=!1,disableScrollLock:f=!1,hideBackdrop:k=!1,keepMounted:y=!1,manager:T=defaultManager,onBackdropClick:P,onClose:E,onEscapeKeyDown:R,open:h}=t,C=_objectWithoutPropertiesLoose(t,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","open"]),[F,g]=React.useState(!0),x=React.useRef({}),M=React.useRef(null),B=React.useRef(null),w=useForkRef(B,o),D=getHasTransition(t),v=()=>ownerDocument(M.current),A=()=>(x.current.modalRef=B.current,x.current.mountNode=M.current,x.current),I=()=>{T.mount(A(),{disableScrollLock:f}),B.current.scrollTop=0},L=useEventCallback(()=>{const e=getContainer(p)||v().body;T.add(A(),e),B.current&&I()}),_=React.useCallback(()=>T.isTopModal(A()),[T]),K=useEventCallback(e=>{M.current=e,e&&(h&&_()?I():ariaHidden(B.current,!0))}),S=React.useCallback(()=>{T.remove(A())},[T]);if(React.useEffect(()=>()=>{S()},[S]),React.useEffect(()=>{h?L():D&&c||S()},[h,S,D,c,L]),!y&&!h&&(!D||F))return null;const z=()=>{g(!1)},H=()=>{g(!0),c&&S()},j=styles(r||{zIndex:zIndex}),N={};return void 0===s.props.tabIndex&&(N.tabIndex=s.props.tabIndex||"-1"),D&&(N.onEnter=createChainedFunction(z,s.props.onEnter),N.onExited=createChainedFunction(H,s.props.onExited)),React.createElement(Portal,{ref:K,container:p,disablePortal:m},React.createElement("div",_extends({ref:w,onKeyDown:e=>{"Escape"===e.key&&_()&&(R&&R(e),u||(e.stopPropagation(),E&&E(e,"escapeKeyDown")))},role:"presentation"},C,{style:_extends({},j.root,!h&&F?j.hidden:{},C.style)}),k?null:React.createElement(n,_extends({open:h,onClick:e=>{e.target===e.currentTarget&&(P&&P(e),!i&&E&&E(e,"backdropClick"))}},a)),React.createElement(TrapFocus,{disableEnforceFocus:d,disableAutoFocus:l,disableRestoreFocus:b,getDoc:v,isEnabled:_,open:h},React.cloneElement(s,N))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([HTMLElementType,PropTypes.func]),disableAutoFocus:PropTypes.bool,disableBackdropClick:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,onBackdropClick:PropTypes.func,onClose:PropTypes.func,onEscapeKeyDown:PropTypes.func,open:PropTypes.bool.isRequired});export default Modal;