"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_utils=require("@material-ui/utils"),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef"));function Unstable_TrapFocus(e){const{children:t,disableAutoFocus:r=!1,disableEnforceFocus:n=!1,disableRestoreFocus:u=!1,getDoc:c,isEnabled:o,open:s}=e,a=React.useRef(),i=React.useRef(null),l=React.useRef(null),f=React.useRef(),p=React.useRef(null),d=React.useRef(!1),R=React.useRef(null),_=(0,_useForkRef.default)(t.ref,R),b=React.useRef();React.useEffect(()=>{b.current=s},[s]),b.current||!s||"undefined"==typeof window||r||(f.current=c().activeElement),React.useEffect(()=>{s&&R.current&&(d.current=!r)},[r,s]),React.useEffect(()=>{if(!s||!R.current)return;const e=(0,_ownerDocument.default)(R.current);return R.current.contains(e.activeElement)||(R.current.hasAttribute("tabIndex")||("production"!==process.env.NODE_ENV&&console.error(["Material-UI: The modal content node does not accept focus.",'For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".'].join("\n")),R.current.setAttribute("tabIndex",-1)),d.current&&R.current.focus()),()=>{u||(f.current&&f.current.focus&&(a.current=!0,f.current.focus()),f.current=null)}},[s]),React.useEffect(()=>{if(!s||!R.current)return;const e=(0,_ownerDocument.default)(R.current),t=t=>{const{current:r}=R;if(null!==r)if(e.hasFocus()&&!n&&o()&&!a.current)if(r.contains(e.activeElement))d.current=!0;else{if(t&&p.current!==t.target||e.activeElement!==p.current)p.current=null;else if(null!==p.current)return;if(!d.current)return;r.focus()}else a.current=!1},r=t=>{!n&&o()&&"Tab"===t.key&&e.activeElement===R.current&&(a.current=!0,t.shiftKey?l.current.focus():i.current.focus())};e.addEventListener("focusin",t),e.addEventListener("keydown",r,!0);const u=setInterval(()=>{"BODY"===e.activeElement.tagName&&t()},50);return()=>{clearInterval(u),e.removeEventListener("focusin",t),e.removeEventListener("keydown",r,!0)}},[r,n,u,o,s]);return React.createElement(React.Fragment,null,React.createElement("div",{tabIndex:0,ref:i,"data-test":"sentinelStart"}),React.cloneElement(t,{ref:_,onFocus:e=>{d.current||(f.current=e.relatedTarget),d.current=!0,p.current=e.target;const r=t.props.onFocus;r&&r(e)}}),React.createElement("div",{tabIndex:0,ref:l,"data-test":"sentinelEnd"}))}"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes={children:_utils.elementAcceptingRef,disableAutoFocus:_propTypes.default.bool,disableEnforceFocus:_propTypes.default.bool,disableRestoreFocus:_propTypes.default.bool,getDoc:_propTypes.default.func.isRequired,isEnabled:_propTypes.default.func.isRequired,open:_propTypes.default.bool.isRequired}),"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes=(0,_utils.exactProp)(Unstable_TrapFocus.propTypes));var _default=Unstable_TrapFocus;exports.default=_default;