"use strict";const{validate:validateSchema}=require("./validation"),{hookRunner:hookRunner,hookIterator:hookIterator}=require("./hooks"),wrapThenable=require("./wrapThenable");function handleRequest(e,n,a){if(!0!==a.sent)if(null==e){var r=n.raw.method,t=n.headers;if("GET"!==r&&"HEAD"!==r){var l=t["content-type"];"POST"!==r&&"PUT"!==r&&"PATCH"!==r?"OPTIONS"!==r&&"DELETE"!==r?a.code(404).send(new Error("Not Found")):void 0===l||void 0===t["transfer-encoding"]&&void 0===t["content-length"]?handler(n,a):a.context.contentTypeParser.run(l,handler,n,a):void 0===l?void 0!==t["transfer-encoding"]||"0"!==t["content-length"]&&void 0!==t["content-length"]?a.context.contentTypeParser.run("",handler,n,a):handler(n,a):a.context.contentTypeParser.run(l,handler,n,a)}else handler(n,a)}else a.send(e)}function handler(e,n){try{null!==n.context.preValidation?hookRunner(n.context.preValidation,hookIterator,e,n,preValidationCallback):preValidationCallback(null,e,n)}catch(a){preValidationCallback(a,e,n)}}function preValidationCallback(e,n,a){if(!0!==a.sent&&!0!==a.raw.writableEnded&&!1!==a.raw.writable)if(null==e){var r=validateSchema(a.context,n);if(r){if(!1===a.context.attachValidation)return void a.code(400).send(r);a.request.validationError=r}null!==a.context.preHandler?hookRunner(a.context.preHandler,hookIterator,n,a,preHandlerCallback):preHandlerCallback(null,n,a)}else a.send(e)}function preHandlerCallback(e,n,a){if(!a.sent&&!0!==a.raw.writableEnded&&!1!==a.raw.writable)if(null==e){var r;try{r=a.context.handler(n,a)}catch(e){return void a.send(e)}void 0!==r&&(null!==r&&"function"==typeof r.then?wrapThenable(r,a):a.send(r))}else a.send(e)}module.exports=handleRequest,module.exports[Symbol.for("internals")]={handler:handler,preHandlerCallback:preHandlerCallback};