/*! @name videojs-contrib-dash @version 3.0.0 @license Apache-2.0 */
!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("dashjs"),require("video.js"),require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define(["dashjs","video.js","global/window","global/document"],a):e.videojsDash=a(e.dashjs,e.videojs,e.window,e.document)}(this,function(l,d,o,r){"use strict";function s(n,e){var r=n.dash.mediaPlayer,t=r.getTracksFor("audio"),i=n.audioTracks();function o(e){return"dash-audio-"+e}i.length&&e.clearTracks(["audio"]);var s=r.getCurrentTrackFor("audio");t.forEach(function(e){var a,r;if(Array.isArray(e.labels))for(var t=0;t<e.labels.length;t++)if(e.labels[t].lang&&-1!==n.language().indexOf(e.labels[t].lang.toLowerCase())){a=e.labels[t];break}a?r=a.text:Array.isArray(e.labels)&&1===e.labels.length?r=e.labels[0].text:(r=e.lang,e.roles&&e.roles.length&&(r+=" ("+e.roles.join(", ")+")")),i.addTrack(new d.AudioTrack({enabled:e===s,id:o(e.index),kind:e.kind||"main",label:r,language:e.lang}))});function a(){for(var e=0;e<i.length;e++){var a=i[e];a.enabled&&(a=function(e,a){return e.find(function(e){return o(e.index)===a.id})}(t,a),r.setCurrentTrack(a))}}i.addEventListener("change",a),n.dash.mediaPlayer.on(l.MediaPlayer.events.STREAM_TEARDOWN_COMPLETE,function(){i.removeEventListener("change",a)})}function c(n,e,i){var o=[],a=i.map(function(e){var a;if(Array.isArray(e.labels))for(var r=0;r<e.labels.length;r++)if(e.labels[r].lang&&-1!==n.language().indexOf(e.labels[r].lang.toLowerCase())){a=e.labels[r];break}return{dashTrack:e,trackConfig:{label:a?a.text:Array.isArray(e.labels)&&1===e.labels.length?e.labels[0].text:e.lang||e.label,language:e.lang,srclang:e.lang,kind:e.kind}}}).map(function(e){var a=e.trackConfig,e=e.dashTrack,a=n.addRemoteTextTrack(a,!1);return o.push({textTrack:a.track,dashTrack:e}),a});function r(){for(var e=n.dash.mediaPlayer,r=n.textTracks(),t=-1,a=0;a<r.length;a+=1)!function(e){var a=r[e];"showing"!==a.mode||(e=(e=function(e,a){for(var r=0;r<e.length;r++)if(a(e[r]))return e[r]}(o,function(e){return e.textTrack===a}))?e.dashTrack:null)&&(t=i.indexOf(e))}(a);t!==e.getCurrentTextTrackIndex()&&e.setTextTrack(t)}return n.textTracks().on("change",r),n.dash.mediaPlayer.on(l.MediaPlayer.events.STREAM_TEARDOWN_COMPLETE,function(){n.textTracks().off("change",r)}),r(),a}function u(a,e,r){o.VTTCue&&!/\[native code\]/.test(o.VTTCue.toString())&&(o.VTTCue=!1);var t,n=[];function i(e){e.index;e=e.tracks;t.off(l.MediaPlayer.events.TEXT_TRACKS_ADDED,i),n.forEach(a.removeRemoteTextTrack.bind(a)),n=[],e.length&&(n=c(a,0,e))}e.featuresNativeTextTracks?d.log.error("You must pass {html: {nativeCaptions: false}} in the videojs constructor to use text tracks in videojs-contrib-dash"):((t=a.dash.mediaPlayer).on(l.MediaPlayer.events.TEXT_TRACKS_ADDED,i),t.on(l.MediaPlayer.events.CAN_PLAY,function(){t.off(l.MediaPlayer.events.TEXT_TRACKS_ADDED,i)}))}l=l&&l.hasOwnProperty("default")?l.default:l,d=d&&d.hasOwnProperty("default")?d.default:d,o=o&&o.hasOwnProperty("default")?o.default:o,r=r&&r.hasOwnProperty("default")?r.default:r;var t=function(){function i(a,e,t){var r,n=this;t=t||e.options_,this.player=d(t.playerId),this.player.dash=this.player.dash||{},this.tech_=e,this.el_=e.el(),this.elParent_=this.el_.parentNode,this.hasFiniteDuration_=!1,a.src&&(e.isReady_=!1,i.updateSourceData&&(d.log.warn('updateSourceData has been deprecated. Please switch to using hook("updatesource", callback).'),a=i.updateSourceData(a)),i.hooks("updatesource").forEach(function(e){a=e(a)}),r=a.src,this.keySystemOptions_=i.buildDashJSProtData(a.keySystemOptions),this.player.dash.mediaPlayer=l.MediaPlayer().create(),this.mediaPlayer_=this.player.dash.mediaPlayer,this.mediaPlayer_.setTextDefaultEnabled(!1),i.useVideoJSDebug&&(d.log.warn('useVideoJSDebug has been deprecated. Please switch to using hook("beforeinitialize", callback).'),i.useVideoJSDebug(this.mediaPlayer_)),i.beforeInitialize&&(d.log.warn('beforeInitialize has been deprecated. Please switch to using hook("beforeinitialize", callback).'),i.beforeInitialize(this.player,this.mediaPlayer_)),i.hooks("beforeinitialize").forEach(function(e){e(n.player,n.mediaPlayer_)}),this.mediaPlayer_.initialize(),this.retriggerError_=function(e){if("capability"===e.error&&"mediasource"===e.event)n.player.error({code:4,message:"The media cannot be played because it requires a feature that your browser does not support."});else if("manifestError"!==e.error||"createParser"!==e.event.id&&"codec"!==e.event.id&&"nostreams"!==e.event.id&&"nostreamscomposed"!==e.event.id&&"parse"!==e.event.id&&"multiplexedrep"!==e.event.id)if("mediasource"===e.error)e.event.match("MEDIA_ERR_ABORTED")?n.player.error({code:1,message:e.event}):e.event.match("MEDIA_ERR_NETWORK")?n.player.error({code:2,message:e.event}):e.event.match("MEDIA_ERR_DECODE")?n.player.error({code:3,message:e.event}):e.event.match("MEDIA_ERR_SRC_NOT_SUPPORTED")?n.player.error({code:4,message:e.event}):e.event.match("MEDIA_ERR_ENCRYPTED")?n.player.error({code:5,message:e.event}):(e.event.match("UNKNOWN"),n.player.error({code:4,message:e.event}));else if("capability"===e.error&&"encryptedmedia"===e.event)n.player.error({code:5,message:"The media cannot be played because it requires encryption features that your browser does not support."});else if("key_session"===e.error)n.player.error({code:5,message:e.event});else if("download"===e.error)n.player.error({code:2,message:"The media playback was aborted because too many consecutive download errors occurred."});else{if("mssError"!==e.error)return;n.player.error({code:3,message:e.event})}else n.player.error({code:4,message:e.event.message});setTimeout(function(){n.mediaPlayer_.reset()},10)},this.mediaPlayer_.on(l.MediaPlayer.events.ERROR,this.retriggerError_),this.getDuration_=function(e){var a=e.data.Period_asArray,r=n.hasFiniteDuration_;e.data.mediaPresentationDuration||a[a.length-1].duration?n.hasFiniteDuration_=!0:n.hasFiniteDuration_=!1,n.hasFiniteDuration_!==r&&n.player.trigger("durationchange")},this.mediaPlayer_.on(l.MediaPlayer.events.MANIFEST_LOADED,this.getDuration_),t.dash&&Object.keys(t.dash).forEach(function(e){var a="set"+e.charAt(0).toUpperCase()+e.slice(1),r=t.dash[e];n.mediaPlayer_.hasOwnProperty(a)&&(d.log.warn("Using dash options in videojs-contrib-dash without the set prefix has been deprecated. Change '"+e+"' to '"+a+"'"),e=a),n.mediaPlayer_.hasOwnProperty(e)?(Array.isArray(r)||(r=[r]),(a=n.mediaPlayer_)[e].apply(a,r)):d.log.warn("Warning: dash configuration option unrecognized: "+e)}),this.mediaPlayer_.attachView(this.el_),this.mediaPlayer_.setAutoPlay(!1),function(e,a){e.dash.mediaPlayer.on(l.MediaPlayer.events.PLAYBACK_METADATA_LOADED,s.bind(null,e,a))}.call(null,this.player,e),u.call(null,this.player,e,t),this.mediaPlayer_.setProtectionData(this.keySystemOptions_),this.mediaPlayer_.attachSource(r),this.tech_.triggerReady())}i.buildDashJSProtData=function(e){var a={};if(!e||!Array.isArray(e))return null;for(var r=0;r<e.length;r++){var t=e[r],n=d.mergeOptions({},t.options);n.licenseUrl&&(n.serverURL=n.licenseUrl,delete n.licenseUrl),a[t.name]=n}return a};var e=i.prototype;return e.dispose=function(){this.mediaPlayer_&&(this.mediaPlayer_.off(l.MediaPlayer.events.ERROR,this.retriggerError_),this.mediaPlayer_.off(l.MediaPlayer.events.MANIFEST_LOADED,this.getDuration_),this.mediaPlayer_.reset()),this.player.dash&&delete this.player.dash},e.duration=function(){return this.mediaPlayer_.isDynamic()&&!this.hasFiniteDuration_?1/0:this.mediaPlayer_.duration()},i.hooks=function(e,a){return i.hooks_[e]=i.hooks_[e]||[],a&&(i.hooks_[e]=i.hooks_[e].concat(a)),i.hooks_[e]},i.hook=function(e,a){i.hooks(e,a)},i.removeHook=function(e,a){a=i.hooks(e).indexOf(a);return-1!==a&&(i.hooks_[e]=i.hooks_[e].slice(),i.hooks_[e].splice(a,1),!0)},i}();t.hooks_={};return d.DashSourceHandler=function(){return{canHandleSource:function(e){return function(a){a=JSON.parse(JSON.stringify(a)),t.updateSourceData&&(d.log.warn('updateSourceData has been deprecated. Please switch to using hook("updatesource", callback).'),a=t.updateSourceData(a)),t.hooks("updatesource").forEach(function(e){a=e(a)});var e=r.createElement("video");return!(a.keySystemOptions&&!o.navigator.requestMediaKeySystemAccess&&!e.msSetMediaKeys)}(e)?d.DashSourceHandler.canPlayType(e.type)?"probably":/\.mpd/i.test(e.src)?"maybe":"":""},handleSource:function(e,a,r){return new t(e,a,r)},canPlayType:function(e){return d.DashSourceHandler.canPlayType(e)}}},d.DashSourceHandler.canPlayType=function(e){return/^application\/dash\+xml/i.test(e)?"probably":""},o.MediaSource&&d.getTech("Html5").registerSourceHandler(d.DashSourceHandler(),0),d.Html5DashJS=t});
