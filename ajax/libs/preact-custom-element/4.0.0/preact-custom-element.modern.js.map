{"version":3,"file":"preact-custom-element.modern.js","sources":["../src/index.js"],"sourcesContent":["import { h, cloneElement, render, hydrate } from 'preact';\n\nexport default function register(Component, tagName, propNames, options) {\n\tfunction PreactElement() {\n\t\tconst inst = Reflect.construct(HTMLElement, [], PreactElement);\n\t\tinst._vdomComponent = Component;\n\t\tinst._root = options && options.shadow ? inst.attachShadow({ mode: 'open' }) : inst;\n\t\treturn inst;\n\t}\n\tPreactElement.prototype = Object.create(HTMLElement.prototype);\n\tPreactElement.prototype.constructor = PreactElement;\n\tPreactElement.prototype.connectedCallback = connectedCallback;\n\tPreactElement.prototype.attributeChangedCallback = attributeChangedCallback;\n\tPreactElement.prototype.detachedCallback = detachedCallback;\n\tPreactElement.observedAttributes = propNames || Component.observedAttributes || Object.keys(Component.propTypes || {});\n\n\treturn customElements.define(\n\t\ttagName || Component.tagName || Component.displayName || Component.name,\n\t\tPreactElement\n\t);\n}\n\nfunction connectedCallback() {\n\tthis._vdom = toVdom(this, this._vdomComponent);\n\t(this.hasAttribute('hydrate') ? hydrate : render)(this._vdom, this._root);\n}\n\nfunction toCamelCase(str) {\n\treturn str.replace(/-(\\w)/g, function(_, c) {\n\t\treturn c ? c.toUpperCase() : ''\n\t});\n}\n\nfunction attributeChangedCallback(name, oldValue, newValue) {\n\tif (!this._vdom) return;\n\tconst props = {};\n\tprops[name] = newValue;\n\tprops[toCamelCase(name)] = newValue;\n\tthis._vdom = cloneElement(this._vdom, props);\n\trender(this._vdom, this._root);\n}\n\nfunction detachedCallback() {\n\trender(this._vdom = null, this._root);\n}\n\nfunction toVdom(element, nodeName) {\n\tif (element.nodeType === 3) return element.data;\n\tif (element.nodeType !== 1) return null;\n\tlet children = [],\n\t\tprops = {},\n\t\ti = 0,\n\t\ta = element.attributes,\n\t\tcn = element.childNodes;\n\tfor (i = a.length; i--; ) {\n\t  props[a[i].name] = a[i].value;\n\t  props[toCamelCase(a[i].name)] = a[i].value;\n  }\n\tfor (i = cn.length; i--; ) children[i] = toVdom(cn[i]);\n\treturn h(nodeName || element.nodeName.toLowerCase(), props, children);\n}\n"],"names":["connectedCallback","this","_vdom","toVdom","element","nodeName","nodeType","data","children","props","i","a","attributes","cn","childNodes","length","name","value","toCamelCase","h","toLowerCase","_vdomComponent","hasAttribute","hydrate","render","_root","str","replace","_","c","toUpperCase","attributeChangedCallback","oldValue","newValue","cloneElement","detachedCallback","Component","tagName","propNames","options","PreactElement","inst","Reflect","construct","HTMLElement","shadow","attachShadow","mode","prototype","Object","create","constructor","observedAttributes","keys","propTypes","customElements","define","displayName"],"mappings":"sEAsBA,SAASA,IACRC,KAAKC,MAuBN,SAASC,EAAOC,EAASC,GACxB,GAAyB,IAArBD,EAAQE,SAAgB,OAAOF,EAAQG,KAC3C,GAAyB,IAArBH,EAAQE,SAAgB,YAC5B,IAAIE,EAAW,GACdC,EAAQ,GACRC,EAAI,EACJC,EAAIP,EAAQQ,WACZC,EAAKT,EAAQU,WACd,IAAKJ,EAAIC,EAAEI,OAAQL,KACjBD,EAAME,EAAED,GAAGM,MAAQL,EAAED,GAAGO,MACxBR,EAAMS,EAAYP,EAAED,GAAGM,OAASL,EAAED,GAAGO,MAEvC,IAAKP,EAAIG,EAAGE,OAAQL,KAAOF,EAASE,GAAKP,EAAOU,EAAGH,IACnD,OAAOS,EAAEd,GAAYD,EAAQC,SAASe,cAAeX,EAAOD,GApC/CL,CAAOF,KAAMA,KAAKoB,iBAC9BpB,KAAKqB,aAAa,WAAaC,EAAUC,GAAQvB,KAAKC,MAAOD,KAAKwB,OAGpE,SAASP,EAAYQ,GACpB,OAAOA,EAAIC,QAAQ,UAAU,SAASC,EAAGC,GACxC,OAAOA,EAAIA,EAAEC,cAAgB,MAI/B,SAASC,EAAyBf,EAAMgB,EAAUC,GACjD,GAAKhC,KAAKC,MAAV,CACA,IAAMO,EAAQ,GACdA,EAAMO,GAAQiB,EACdxB,EAAMS,EAAYF,IAASiB,EAC3BhC,KAAKC,MAAQgC,EAAajC,KAAKC,MAAOO,GACtCe,EAAOvB,KAAKC,MAAOD,KAAKwB,QAGzB,SAASU,IACRX,EAAOvB,KAAKC,MAAQ,KAAMD,KAAKwB,+BAzCCW,EAAWC,EAASC,EAAWC,GAC/D,SAASC,IACR,IAAMC,EAAOC,QAAQC,UAAUC,YAAa,GAAIJ,GAGhD,OAFAC,EAAKpB,eAAiBe,EACtBK,EAAKhB,MAAQc,GAAWA,EAAQM,OAASJ,EAAKK,aAAa,CAAEC,KAAM,SAAYN,EACxEA,EASR,OAPAD,EAAcQ,UAAYC,OAAOC,OAAON,YAAYI,YAC5BG,YAAcX,EACtCA,EAAcQ,UAAUhD,kBAAoBA,EAC5CwC,EAAcQ,UAAUjB,yBAA2BA,EACnDS,EAAcQ,UAAUb,iBAAmBA,EAC3CK,EAAcY,mBAAqBd,GAAaF,EAAUgB,oBAAsBH,OAAOI,KAAKjB,EAAUkB,WAAa,IAE5GC,eAAeC,OACrBnB,GAAWD,EAAUC,SAAWD,EAAUqB,aAAerB,EAAUpB,KACnEwB"}