!function(e, t){"object" == typeof exports && "undefined" != typeof module ? module.exports = t():"function" == typeof define && define.amd ? define(t):(e = "undefined" != typeof globalThis ? globalThis:e || self).CSSDoodle = t();}(this, (function(){"use strict";function e(e){let t = 0, r = 1, n = 1;return{curr:(r = 0) =>e[t + r], end:() =>e.length<= t, info:() =>({index:t, col:r, line:n}), index:e =>void 0 === e ? t:t = e, next(){let s = e[t++];return "\n" == s ? (n++, r = 0):r++, s;}};} function t(t){t = t.trim();let r = [];if (!/^var\(/.test(t)) return r;let n = e(t);try{r = function(e){let t = "", r = [], n = [], s ={};for (;!e.end();){let i = e.curr();if ("(" == i) r.push(i), t = "";else if (")" == i || "," == i){if (/^\-\-.+/.test(t) && (s.name ? (s.alternative || (s.alternative = []), s.alternative.push({name:t})):s.name = t), ")" == i){if ("(" != r[r.length - 1]) throw new Error("bad match");r.pop();} "," == i && (r.length || (n.push(s), s ={})), t = "";} else /\s/.test(i) || (t += i);e.next();} return r.length ? []:(s.name && n.push(s), n);}(n);} catch (e){console.error(e && e.message || "Bad variables.");} return r;} function r(e){return{make_array:function(e){return Array.isArray(e) ? e:[ e ];}, join:function(e, t = "\n"){return (e || []).join(t);}, last:function(e, t = 1){return e[e.length - t];}, first:function(e){return e[0];}, clone:function(e){return JSON.parse(JSON.stringify(e));}, shuffle:function(t){let r = Array.from ? Array.from(t):t.slice(), n = t.length;for (;n;){let t = ~~(e() * n--), s = r[n];r[n] = r[t], r[t] = s;} return r;}, flat_map:function(e, t){return Array.prototype.flatMap ? e.flatMap(t):e.reduce(((e, r) =>e.concat(t(r))), []);}, remove_empty_values:function(e){return e.filter((e =>null != e && String(e).trim().length));}};} let{first:n, last:s, clone:i} = r();const l ={func:(e = "") =>({type:"func", name:e, arguments:[]}), argument:() =>({type:"argument", value:[]}), text:(e = "") =>({type:"text", value:e}), pseudo:(e = "") =>({type:"pseudo", selector:e, styles:[]}), cond:(e = "") =>({type:"cond", name:e, styles:[], arguments:[]}), rule:(e = "") =>({type:"rule", property:e, value:[]}), keyframes:(e = "") =>({type:"keyframes", name:e, steps:[]}), step:(e = "") =>({type:"step", name:e, styles:[]})}, u ={white_space:e =>/[\s\n\t]/.test(e), line_break:e =>/\n/.test(e), number:e =>!isNaN(e), pair:e =>[ '"', "(", ")", "'" ].includes(e), pair_of:(e, t) =>({'"':'"', "'":"'", "(":")"}[e] == t)}, o ={\u03c0:Math.PI, "\u220f":Math.PI};function a(e,{col:t, line:r}){console.warn(`(at line ${r}, column ${t}) ${e}`);} function c(e){return function(t, r){let n = t.index(), s = "";for (;!t.end();){let r = t.next();if (e(r)) break;s += r;} return r && t.index(n), s;};} function p(e, t){return c((e =>/[^\w@]/.test(e)))(e, t);} function h(e){return c((e =>/[\s\{]/.test(e)))(e);} function f(e, t){return c((e =>u.line_break(e) || "{" == e))(e, t);} function d(e, t){let r, n = l.step();for (;!e.end() && "}" != (r = e.curr());) if (u.white_space(r)) e.next();else{if (n.name.length){if (n.styles.push(S(e, t)), "}" == e.curr()) break;} else n.name = $(e);e.next();} return n;} function g(e, t){const r = [];let n;for (;!e.end() && "}" != (n = e.curr());) u.white_space(n) || r.push(d(e, t)), e.next();return r;} function m(e, t){let r, n = l.keyframes();for (;!e.end() && "}" != (r = e.curr());) if (n.name.length){if ("{" == r){e.next(), n.steps = g(e, t);break;} e.next();} else if (p(e), n.name = h(e), !n.name.length){a("missing keyframes name", e.info());break;} return n;} function y(e, t ={}){for (e.next();!e.end();){let r = e.curr();if (t.inline){if ("\n" == r) break;} else if ("*" == (r = e.curr()) && "/" == e.curr(1)) break;e.next();} t.inline || (e.next(), e.next());} function v(e){let t, r = "";for (;!e.end() && ":" != (t = e.curr());) u.white_space(t) || (r += t), e.next();return r;} function _(e, t){let r, n = [], a = [], c = [], p = "";for (;!e.end();){if (r = e.curr(), /[\('"`]/.test(r) && "\\" !== e.curr(-1)) c.length && "(" != r && r === s(c) ? c.pop():c.push(r), p += r;else if ("@" == r) a.length || (p = p.trimLeft()), p.length && (a.push(l.text(p)), p = ""), a.push(b(e));else if (/[,)]/.test(r)) if (c.length) ")" == r && c.pop(), p += r;else{if (p.length && (a.length ? a.push(l.text(p)):a.push(l.text((h = p).trim().length ? u.number(+h) ? +h:h.trim():h)), p.startsWith("\xb1"))){let e = p.substr(1), t = i(a);s(t).value = "-" + e, n.push(x(t)), s(a).value = e;} if (n.push(x(a)), [a, p] = [ [], "" ], ")" == r) break;} else o[r] && (r = o[r]), p += r;if (t && ")" == e.curr() && !c.length){a.length && n.push(x(a));break;} e.next();} var h;return n;} function x(e){let t = e.map((e =>{if ("text" == e.type && "string" == typeof e.value){let t = String(e.value);t.includes("`") && (e.value = t = t.replace(/`/g, '"')), e.value = t.replace(/\n+|\s+/g, " ");} return e;})), r = n(t) ||{}, i = s(t) ||{};if ("text" == r.type && "text" == i.type){let e = n(r.value), l = s(i.value);"string" == typeof r.value && "string" == typeof i.value && u.pair_of(e, l) && (r.value = r.value.slice(1), i.value = i.value.slice(0, i.value.length - 1), t.cluster = !0);} return t;} function b(e){let t, r = l.func(), n = "@", s = !1;for (e.next();!e.end();){t = e.curr();let i = "." == t && "@" == e.curr(1), l = e.curr(1);if ("(" == t || i){s = !0, e.next(), r.arguments = _(e, i);break;} if (!s && "(" !== l && !/[0-9a-zA-Z_\-.]/.test(l)){n += t;break;} n += t, e.next();} let{fname:i, extra:u} = function(e){let t = "", r = "";if (/\D$/.test(e) || Math[e.substr(1)]) return{fname:e, extra:r};for (let n = e.length - 1;n>= 0;n--){let s = e[n];if (!/[\d.]/.test(s)){t = e.substring(0, n + 1);break;} r = s + r;} return{fname:t, extra:r};}(n);return r.name = i, u.length && r.arguments.unshift([{type:"text", value:u} ]), r.position = e.info().index, r;} function k(e){let t, r = l.text(), n = 0, s = !0;const i = [], a = [];for (i[n] = [];!e.end();) if (t = e.curr(), s && u.white_space(t)) e.next();else{if (s = !1, "\n" != t || u.white_space(e.curr(-1))) if ("," != t || a.length){if (/[;}]/.test(t)){r.value.length && (i[n].push(r), r = l.text());break;} "@" == t ? (r.value.length && (i[n].push(r), r = l.text()), i[n].push(b(e))):u.white_space(t) && u.white_space(e.curr(-1)) || ("(" == t && a.push(t), ")" == t && a.pop(), o[t] && (t = o[t]), r.value += t);} else r.value.length && (i[n].push(r), r = l.text()), i[++n] = [], s = !0;else r.value += " ";e.next();} return r.value.length && i[n].push(r), i;} function $(e){let t, r = "";for (;!e.end() && "{" != (t = e.curr());) u.white_space(t) || (r += t), e.next();return r;} function w(e){let t, r ={name:"", arguments:[]};for (;!e.end();){if ("(" == (t = e.curr())) e.next(), r.arguments = _(e);else{if (/[){]/.test(t)) break;u.white_space(t) || (r.name += t);} e.next();} return r;} function z(e, t){let r, n = l.pseudo();for (;!e.end() && "}" != (r = e.curr());) if (u.white_space(r)) e.next();else{if (n.selector){let r = S(e, t);if ("@use" == r.property ? n.styles = n.styles.concat(r.value):n.styles.push(r), "}" == e.curr()) break;} else n.selector = $(e);e.next();} return n;} function S(e, t){let r, n = l.rule();for (;!e.end() && ";" != (r = e.curr());){if (n.property.length){n.value = k(e);break;} if (n.property = v(e), "@use" == n.property){n.value = A(e, t);break;} e.next();} return n;} function j(e, t){let r, n = l.cond();for (;!e.end() && "}" != (r = e.curr());){if (n.name.length) if (":" == r){let t = z(e);t.selector && n.styles.push(t);} else if ("@" != r || f(e, !0).includes(":")){if (!u.white_space(r)){let r = S(e, t);if (r.property && n.styles.push(r), "}" == e.curr()) break;}} else n.styles.push(j(e));else Object.assign(n, w(e));e.next();} return n;} function C(e, t){let r = "";return e && e.get_variable && (r = e.get_variable(t)), r;} function E(e, r){e.forEach && e.forEach((e =>{if ("text" == e.type && e.value){let n = t(e.value);e.value = n.reduce(((e, t) =>{let n, s = "", i = "";s = C(r, t.name), !s && t.alternative && t.alternative.every((e =>{if (i = C(r, e.name), i) return s = i, !1;}));try{n = M(s, r);} catch (e){} return n && e.push.apply(e, n), e;}), []);} "func" == e.type && e.arguments && e.arguments.forEach((e =>{E(e, r);}));}));} function A(e, t){return e.next(), (k(e) || []).reduce(((e, r) =>{E(r, t);let [n] = r;return n.value && n.value.length && e.push(...n.value), e;}), []);} function M(t, r){const n = e(t), s = [];for (;!n.end();){let e = n.curr();if (u.white_space(e)) n.next();else{if ("/" == e && "*" == n.curr(1)) y(n);else if ("/" == e && "/" == n.curr(1)) y(n,{inline:!0});else if (":" == e){let e = z(n, r);e.selector && s.push(e);} else if ("@" == e && "@keyframes" === p(n, !0)){let e = m(n, r);s.push(e);} else if ("@" != e || f(n, !0).includes(":")){if (!u.white_space(e)){let e = S(n, r);e.property && s.push(e);}} else{let e = j(n, r);e.name.length && s.push(e);} n.next();}} return s;} function O(e, t, r){return Math.max(t, Math.min(r, e));} function L(e, t, r){let n = 0, s = e, i = e =>e>0 && e<1 ? .1:1, l = arguments.length;1 == l && ([e, t] = [ i(e), e ]), l<3 && (r = i(e));let u = [];for (;(r>= 0 && e<= t || r<0 && e>t) && (u.push(e), e += r, !(n++>= 1e3)););return u.length || u.push(s), u;} function T(e){return /^[a-zA-Z]$/.test(e);} function N(e){return null == e;} function D(e){let t = () =>e;return t.lazy = !0, t;} function H(e, t, r){return "c-" + e + "-" + t + "-" + r;} function W(e){for (;e && e.value;) return W(e.value);return e || "";} const [q, I, P] = [ 1, 32, 1024 ];function R(e){let [t, r, n] = (e + "").replace(/\s+/g, "").replace(/[,\uff0cxX]+/g, "x").split("x").map(Number);const s = 1 == t || 1 == r ? P:I, i = 1 == t && 1 == r ? P:q, l ={x:O(t || q, 1, s), y:O(r || t || q, 1, s), z:O(n || q, 1, i)};return Object.assign({}, l,{count:l.x * l.y * l.z});} function U(e, t){if (t){let r = new Blob([ e ],{type:"image/svg+xml"});return`url(${URL.createObjectURL(r)}#${t})`;} return`url("data:image/svg+xml;utf8,${encodeURIComponent(e)}")`;} function F(e){const t = 'xmlns="http://www.w3.org/2000/svg"';return e.includes("<svg") || (e =`<svg ${t}>${e}</svg>`), e.includes("xmlns") || (e = e.replace(/<svg([\s>])/,`<svg ${t}$1`)), e;} function V(e){return (...t) =>{let r = function(e){let t = "";return e.some((e =>{let r = String(e).trim();if (!r) return "";let n = r.match(/\d(\D+)$/);return t = n ? n[1]:"";})), t;}(t);return function(e, t){return (...r) =>{r = r.map((e =>Number(String(e).replace(/\D+$/g, ""))));let n = e.apply(null, r);return t.length ? Array.isArray(n) ? n.map((e =>e + t)):n + t:n;};}(e, r).apply(null, t);};} function Z(e){return (...t) =>{let r = t.map((e =>String(e).charCodeAt(0))), n = e.apply(null, r);return Array.isArray(n) ? n.map((e =>String.fromCharCode(e))):String.fromCharCode(n);};} let{last:B} = r();function J(e){const t = function(e){let t = function(e){let t = String(e), r = [], n = "";for (let e = 0;e<t.length;++e){let s = t[e];if (X[s]) if ("-" == s && "e" == t[e - 1]) n += s;else if (r.length || n.length || !/[+-]/.test(s)){let{type:e, value:t} = B(r) ||{};"operator" == e && !n.length && /[^()]/.test(s) && /[^()]/.test(t) ? n += s:(n.length && (r.push({type:"number", value:n}), n = ""), r.push({type:"operator", value:s}));} else n += s;else /\S/.test(s) && (n += s);} n.length && r.push({type:"number", value:n});return r;}(e);const r = [], n = [];for (let e = 0;e<t.length;++e){let{type:s, value:i} = t[e];if ("number" == s) n.push(i);else if ("operator" == s) if ("(" == i) r.push(i);else if (")" == i){for (;r.length && "(" != B(r);) n.push(r.pop());r.pop();} else{for (;r.length && X[B(r)]>= X[i];){let e = r.pop();/[()]/.test(e) || n.push(e);} r.push(i);}} for (;r.length;) n.push(r.pop());return n;}(e), r = [];for (;t.length;){let e = t.shift();if (/\d+/.test(e)) r.push(e);else{let t = r.pop(), n = r.pop();r.push(G(e, Number(n), Number(t)));}} return r[0];} const X ={"*":3, "/":3, "%":3, "+":2, "-":2, "(":1, ")":1};function G(e, t, r){switch (e){case "+":return t + r;case "-":return t - r;case "*":return t * r;case "/":return t / r;case "%":return t % r;}} const K ={};function Q(e, t){return (...r) =>{let n = e + r.join("-");return K[n] ? K[n]:K[n] = t.apply(null, r);};} const{last:Y, flat_map:ee} = r();function te(e){return (...t) =>e.apply(null, ee(t, (e =>String(e).startsWith("[") ? ne(e):e)));} function re(e, t){return{type:e, value:t};} const ne = Q("build_range", (e =>{let t = function(e){let t = String(e), r = [], n = [];if (!t.startsWith("[") || !t.endsWith("]")) return r;for (let e = 1;e<t.length - 1;++e){let s = t[e];if ("-" != s || "-" != t[e - 1]) if ("-" != s) if ("-" != Y(n)) n.length && r.push(re("char", n.pop())), n.push(s);else{n.pop();let e = n.pop();r.push(e ? re("range", [ e, s ]):re("char", s));} else n.push(s);} return n.length && r.push(re("char", n.pop())), r;}(e);return ee(t, (({type:e, value:t}) =>{if ("char" == e) return t;let [r, n] = t, s = !1;r>n && ([r, n] = [ n, r ], s = !0);let i = Z(L)(r, n);return s && i.reverse(), i;}));}));class se{constructor(e){this.prev = this.next = null, this.data = e;}} class ie{constructor(e = 20){this._limit = e, this._size = 0;} push(e){this._size>= this._limit && (this.root = this.root.next, this.root.prev = null);let t = new se(e);this.root ? (t.prev = this.tail, this.tail.next = t, this.tail = t):this.root = this.tail = t, this._size++;} last(e = 1){let t = this.tail;for (;--e && t.prev;) t = t.prev;return t.data;}} const{cos:le, sin:ue, sqrt:oe, pow:ae, PI:ce} = Math, pe = ce / 180;function he(e, t){"function" == typeof arguments[0] && (t = e, e ={}), t || (t = e =>[ le(e), ue(e) ]);let r = e.split || 120, n = e.scale || 1, s = pe * (e.start || 0), i = e.deg ? e.deg * pe:ce / (r / 2), l = [];for (let e = 0;e<r;++e){let r = s + i * e, [u, o] = t(r);l.push(50 * u * n + 50 + "% " + (50 * o * n + 50) + "%");} return e.type ?`polygon(${e.type}, ${l.join(",")})`:`polygon(${l.join(",")})`;} function fe(e, t, r){let n = pe * r;return [ e * le(n) - t * ue(n), t * le(n) + e * ue(n) ];} const de ={circle:() =>"circle(49%)", triangle:() =>he({split:3, start:-90}, (e =>[ 1.1 * le(e), 1.1 * ue(e) + .2 ])), rhombus:() =>he({split:4}), pentagon:() =>he({split:5, start:54}), hexgon:() =>he({split:6, start:30}), hexagon:() =>he({split:6, start:30}), heptagon:() =>he({split:7, start:-90}), octagon:() =>he({split:8, start:22.5}), star:() =>he({split:5, start:54, deg:144}), diamond:() =>"polygon(50% 5%, 80% 50%, 50% 95%, 20% 50%)", cross:() =>"polygon(\n 5% 35%, 35% 35%, 35% 5%, 65% 5%,\n 65% 35%, 95% 35%, 95% 65%, 65% 65%,\n 65% 95%, 35% 95%, 35% 65%, 5% 65%\n )", clover:(e = 3) =>(4 == (e = O(e, 3, 5)) && (e = 2), he({split:240}, (t =>{let r = le(e * t) * le(t), n = le(e * t) * ue(t);return 3 == e && (r -= .2), 2 == e && (r /= 1.1, n /= 1.1), [ r, n ];}))), hypocycloid(e = 3){let t = 1 - (e = O(e, 3, 6));return he({scale:1 / e}, (r =>{let n = t * le(r) + le(t * (r - ce)), s = t * ue(r) + ue(t * (r - ce));return 3 == e && (n = 1.1 * n - .6, s *= 1.1), [ n, s ];}));}, astroid:() =>de.hypocycloid(4), infinity:() =>he((e =>{let t = .7 * oe(2) * le(e), r = ae(ue(e), 2) + 1;return [ t / r, t * ue(e) / r ];})), heart:() =>he((e =>fe(1.2 * (.75 * ae(ue(e), 3)), 1.1 * (le(1 * e) * (13 / 18) - le(2 * e) * (5 / 18) - le(3 * e) / 18 - le(4 * e) / 18 + .2), 180))), bean:() =>he((e =>{let [t, r] = [ ae(ue(e), 3), ae(le(e), 3) ];return fe((t + r) * le(e) * 1.3 - .45, (t + r) * ue(e) * 1.3 - .45, -90);})), bicorn:() =>he((e =>fe(le(e), ae(ue(e), 2) / (2 + ue(e)) - .5, 180))), drop:() =>he((e =>fe(ue(e), (1 + ue(e)) * le(e) / 1.4, 90))), pear:() =>he((e =>[ ue(e), (1 + ue(e)) * le(e) / 1.4 ])), fish:() =>he((e =>[ le(e) - ae(ue(e), 2) / oe(2), ue(2 * e) / 2 ])), whale:() =>he({split:240}, (e =>{let t = 3.4 * (ae(ue(e), 2) - .5) * le(e);return fe(le(e) * t + .75, ue(e) * t * 1.2, 180);})), bud:(e = 3) =>(e = O(e, 3, 10), he({split:240}, (t =>[ (1 + .2 * le(e * t)) * le(t) * .8, (1 + .2 * le(e * t)) * ue(t) * .8 ]))), alien(...e){let [t = 1, r = 1, n = 1, s = 1, i = 1] = e.map((e =>O(e, 1, 9)));return he({split:480, type:"evenodd"}, (e =>[ .31 * (le(e * t) + le(e * n) + le(e * i)), .31 * (ue(e * r) + ue(e * s) + ue(e)) ]));}};function ge(e, t){return t ? /[,\uff0c]/.test(e):/[,\uff0c\s]/.test(e);} function me(e, t){for (;!e.end() && ge(e.curr(1), t);) e.next();} function ye(t, r = !1){const n = e(t), s = [], i = [];let l = "";for (;!n.end();){let e = n.curr();if (void 0 === e) break;"(" == e ? (l += e, i.push(e)):")" == e ? (l += e, i.length && i.pop()):i.length ? l += e:ge(e, r) ? (s.push(l), l = "", me(n, r)):l += e, n.next();} return l && s.push(l), s;} function ve(e){const{shuffle:t} = r(e),{pick:n, rand:s, unique_id:i} = function(e){function t(e, t, r){return e * (1 - r) + t * r;} return{lerp:t, rand:function(r = 0, n = r){return 1 == arguments.length && (1 == r ? r = 0:r<1 ? r /= 10:r = 1), t(r, n, e());}, pick:function(...t){let r = t.reduce(((e, t) =>e.concat(t)), []);return r[~~(e() * r.length)];}, unique_id:function(t = ""){return t + e().toString(32).substr(2);}};}(e), l ={index:({count:e}) =>t =>e, row:({y:e}) =>t =>e, col:({x:e}) =>t =>e, depth:({z:e}) =>t =>e, size:({grid:e}) =>t =>e.count, "size-row":({grid:e}) =>t =>e.y, "size-col":({grid:e}) =>t =>e.x, "size-depth":({grid:e}) =>t =>e.z, id:({x:e, y:t, z:r}) =>n =>H(e, t, r), n:({extra:e}) =>t =>e ? e[0]:"@n", N:({extra:e}) =>t =>e ? e[1]:"@N", repeat:u(""), multiple:u(","), "multiple-with-space":u(" "), pick:({context:e}) =>te(((...t) =>o(e, "last_pick", n(t)))), "pick-n"({context:e, extra:t, position:r}){let n = "pn-counter" + r;return te(((...r) =>{e[n] || (e[n] = 0), e[n] += 1;let s = r.length, [i] = t || [], l = r[((void 0 === i ? e[n]:i) - 1) % s];return o(e, "last_pick", l);}));}, "pick-d"({context:e, extra:r, position:n}){let s = "pd-counter" + n, i = "pd-values" + n;return te(((...n) =>{e[s] || (e[s] = 0), e[s] += 1, e[i] || (e[i] = t(n));let l = n.length, [u] = r || [], a = ((void 0 === u ? e[s]:u) - 1) % l, c = e[i][a];return o(e, "last_pick", c);}));}, "last-pick":({context:e}) =>(t = 1) =>{let r = e.last_pick;return r ? r.last(t):"";}, rand:({context:e}) =>(...t) =>{let r = (t.every(T) ? Z:V)(s).apply(null, t);return o(e, "last_rand", r);}, "rand-int":({context:e}) =>(...t) =>{let r = t.every(T) ? Z:V, n = parseInt(r(s).apply(null, t));return o(e, "last_rand", n);}, "last-rand":({context:e}) =>(t = 1) =>{let r = e.last_rand;return r ? r.last(t):"";}, stripe:() =>(...e) =>{let t, r = e.map(W), n = r.length, s = 0, i = [];if (!n) return "";r.forEach((e =>{let [t, r] = ye(e);void 0 !== r ? i.push(r):s += 1;}));let l = i.length ?`(100% - ${i.join(" - ")}) / ${s}`:"100% / " + n;return r.map(((e, r) =>{if (i.length){let [r, n] = ye(e);return t = (t ? t + " + ":"") + (void 0 !== n ? n:l),`${r} 0 calc(${t})`;} return`${e} 0 ${100 / n * (r + 1)}%`;})).join(",");}, calc:() =>e =>J(W(e)), hex:() =>e =>parseInt(W(e)).toString(16), svg:D((e =>{if (void 0 === e) return "";return U(F(W(e()).trim()));})), "svg-filter":D((e =>{if (void 0 === e) return "";let t = i("filter-");return U(F(W(e()).trim()).replace(/<filter([\s>])/,`<filter id="${t}"$1`), t);})), var:() =>e =>`var(${W(e)})`, shape:() =>memo("shape-function", ((e = "", ...t) =>(e = e.trim(), "function" == typeof de[e] ? de[e](t):"")))};function u(e){return D(((t, r) =>{if (!r || !t) return "";let n = O(W(t()), 0, 65536);return function(e, t){let r = [];for (let n = 0;n<e;++n) r.push(t(n));return r;}(n, (e =>W(r(e + 1, n)))).join(e);}));} function o(e, t, r){return e[t] || (e[t] = new ie), e[t].push(r), r;} return a = l, c ={m:"multiple", ms:"multiple-with-space", r:"rand", ri:"rand-int", lr:"last-rand", p:"pick", pn:"pick-n", pd:"pick-d", lp:"last-pick", rep:"repeat", i:"index", x:"col", y:"row", z:"depth", s:"size", sx:"size-col", sy:"size-row", sz:"size-depth", "size-x":"size-col", "size-y":"size-row", "size-z":"size-depth", multi:"multiple", "pick-by-turn":"pick-n", "max-row":"size-row", "max-col":"size-col", stripes:"stripe", strip:"stripe"}, Object.keys(c).forEach((e =>{a[e] = a[c[e]];})), a;var a, c;} let _e = [];function xe(e){if (!_e.length){let e = new Set;for (let t in document.head.style) t.startsWith("-") || e.add(t.replace(/[A-Z]/g, "-$&").toLowerCase());e.has("grid-gap") || e.add("grid-gap"), _e = Array.from(e);} return e && e.test ? _e.filter((t =>e.test(t))):_e;} function be(e){let t = new RegExp(`\\-?${e}\\-?`);return xe(t).map((e =>e.replace(t, ""))).reduce(((e, t) =>(e[t] = t, e)),{});} const ke = be("webkit"), $e = be("moz");function we(e, t){return ke[e] ?`-webkit-${t} ${t}`:$e[e] ?`-moz-${t} ${t}`:t;} const ze ={"4a0":[ 1682, 2378 ], "2a0":[ 1189, 1682 ], a0:[ 841, 1189 ], a1:[ 594, 841 ], a2:[ 420, 594 ], a3:[ 297, 420 ], a4:[ 210, 297 ], a5:[ 148, 210 ], a6:[ 105, 148 ], a7:[ 74, 105 ], a8:[ 52, 74 ], a9:[ 37, 52 ], a10:[ 26, 37 ], b0:[ 1e3, 1414 ], b1:[ 707, 1e3 ], b2:[ 500, 707 ], b3:[ 353, 500 ], b4:[ 250, 353 ], b5:[ 176, 250 ], b6:[ 125, 176 ], b7:[ 88, 125 ], b8:[ 62, 88 ], b9:[ 44, 62 ], b10:[ 31, 44 ], b11:[ 22, 32 ], b12:[ 16, 22 ], c0:[ 917, 1297 ], c1:[ 648, 917 ], c2:[ 458, 648 ], c3:[ 324, 458 ], c4:[ 229, 324 ], c5:[ 162, 229 ], c6:[ 114, 162 ], c7:[ 81, 114 ], c8:[ 57, 81 ], c9:[ 40, 57 ], c10:[ 28, 40 ], c11:[ 22, 32 ], c12:[ 16, 22 ], d0:[ 764, 1064 ], d1:[ 532, 760 ], d2:[ 380, 528 ], d3:[ 264, 376 ], d4:[ 188, 260 ], d5:[ 130, 184 ], d6:[ 92, 126 ], letter:[ 216, 279 ], legal:[ 216, 356 ], "junior-legal":[ 203, 127 ], ledger:[ 279, 432 ], tabloid:[ 279, 432 ], executive:[ 190, 254 ], postcard:[ 100, 148 ], "business-card":[ 54, 90 ], poster:[ 390, 540 ]}, Se ={portrait:"p", pt:"p", p:"p", landscape:"l", ls:"l", l:"l"};var je ={"@size"(e,{is_special_selector:t}){let [r, n = r] = ye(e);return ze[r] && ([r, n] = function(e, t){e = String(e).toLowerCase();let [r, n] = ze[e] || [];return "p" == Se[t] && ([n, r] = [ r, n ]), [ n, r ].map((e =>e + "mm"));}(r, n)),`\n width:${r};height:${n};${t ? "":`\n --internal-cell-width:${r};--internal-cell-height:${n};`}`;}, "@min-size"(e){let [t, r = t] = ye(e);return`min-width:${t};min-height:${r};`;}, "@max-size"(e){let [t, r = t] = ye(e);return`max-width:${t};max-height:${r};`;}, "@place-cell":(() =>{let e ={center:"50%", 0:"0%", left:"0%", right:"100%", top:"50%", bottom:"50%"}, t ={center:"50%", 0:"0%", top:"0%", bottom:"100%", left:"50%", right:"50%"};return r =>{let [n, s = "50%"] = ye(r);n = e[n] || n, s = t[s] || s;const i = "var(--internal-cell-width, 25%)", l = "var(--internal-cell-height, 25%)";return`\n position:absolute;left:${n};top:${s};width:${i};height:${l};margin-left:calc(${i} / -2) !important;margin-top:calc(${l} / -2) !important;grid-area:unset !important;`;};})(), "@grid"(e, t){let [r, ...n] = e.split("/").map((e =>e.trim()));return n = n.join(" / "),{grid:R(r), size:n ? this["@size"](n, t):""};}, "@shape":Q("shape-property", (e =>{let [t, ...r] = ye(e), n = "clip-path";return de[t] ? we(n,`${n}:${de[t].apply(null, r)};`) + "overflow:hidden;":"";})), "@use"(e){if (e.length>2) return e;}};function Ce(e, t, r){let n = function(e){return t =>String(e).replace(/(\d+)(n)/g, "$1*" + t).replace(/n/g, t);}(e);for (let e = 0;e<= r;++e) if (J(n(e)) == t) return !0;} const Ee ={even:e =>!(e % 2), odd:e =>!!(e % 2)};function Ae(e){return /^(even|odd)$/.test(e);} var Me = Object.getOwnPropertyNames(Math).reduce(((e, t) =>(e[t] = () =>(...e) =>(e = e.map(W), "number" == typeof Math[t] ? Math[t]:Math[t].apply(null, e.map(J))), e)),{});const Oe ={length:"0px", number:0, color:"black", url:"url()", image:"url()", integer:0, angle:"0deg", time:"0ms", resolution:"0dpi", percentage:"0%", "length-percentage":"0%", "transform-function":"translate(0)", "transform-list":"translate(0)", "custom-ident":"_"};let{join:Le, make_array:Te, remove_empty_values:Ne} = r();function De(e){return /^\:(host|doodle)/.test(e);} function He(e){return /^\:(container|parent)/.test(e);} function We(e){return De(e) || He(e);} class qe{constructor(e, t){this.tokens = e, this.rules ={}, this.props ={}, this.keyframes ={}, this.grid = null, this.is_grid_defined = !1, this.coords = [], this.reset(), this.Func = ve(t), this.Selector = function(e){return{at:({x:e, y:t}) =>(r, n) =>e == r && t == n, nth:({count:e, grid:t}) =>(...r) =>r.some((r =>Ae(r) ? Ee[r](e):Ce(r, e, t.count))), row:({y:e, grid:t}) =>(...r) =>r.some((r =>Ae(r) ? Ee[r](e):Ce(r, e, t.y))), col:({x:e, grid:t}) =>(...r) =>r.some((r =>Ae(r) ? Ee[r](e):Ce(r, e, t.x))), even:({count:e, grid:t, y:r}) =>n =>{if ("cross" === n && Ee.even(t.x)){let t = Ee.even(r) ? "odd":"even";return Ee[t](e);} return Ee.even(e);}, odd:({count:e, grid:t, y:r}) =>n =>{if ("cross" === n && Ee.even(t.x)){let t = Ee.even(r) ? "even":"odd";return Ee[t](e);} return Ee.odd(e);}, random:() =>(t = .5) =>(t>= 1 && t<= 0 && (t = .5), e()<t)};}(t), this.custom_properties ={};} reset(){this.styles ={host:"", container:"", cells:"", keyframes:""}, this.coords = [];for (let e in this.rules) e.startsWith("#c") && delete this.rules[e];} add_rule(e, t){let r = this.rules[e];r || (r = this.rules[e] = []), r.push.apply(r, Te(t));} pick_func(e){return this.Func[e] || Me[e];} apply_func(e, t, r){let n = e(...Te(t)), s = [];return r.forEach((e =>{e.cluster || "string" != typeof e.value ? "function" == typeof e ? s.push(e):e && e.value && s.push(e.value):s.push(...ye(e.value, !0));})), s = Ne(s), n(...Te(s));} compose_aname(...e){return e.join("-");} compose_selector({x:e, y:t, z:r}, n = ""){return`#${H(e, t, r)}${n}`;} compose_argument(e, t, r = []){let n = e.map((e =>{if ("text" == e.type) return e.value;if ("func" == e.type){let n = this.pick_func(e.name.substr(1));if (n){t.extra = r, t.position = e.position;let s = e.arguments.map((e =>n.lazy ? (...r) =>this.compose_argument(e, t, r):this.compose_argument(e, t, r)));return this.apply_func(n, t, s);}}}));return{cluster:e.cluster, value:n.length>= 2 ?{value:n.join("")}:n[0]};} compose_value(e, t){if (!e || !e.reduce) return "";return e.reduce(((e, r) =>{switch (r.type){case "text":e += r.value;break;case "func":{let n = r.name.substr(1), s = this.pick_func(n);if (s){t.position = r.position;let n = r.arguments.map((e =>s.lazy ? (...r) =>this.compose_argument(e, t, r):this.compose_argument(e, t))), i = this.apply_func(s, t, n);N(i) || (e += i);}}} return e;}), "");} compose_rule(e, t, r){let n = Object.assign({}, t), s = e.property, i = e.value.reduce(((e, t) =>{let r = this.compose_value(t, n);return r && e.push(r), e;}), []), l = i.join(", ");if (/^animation(\-name)?$/.test(s) && (this.props.has_animation = !0, n.count>1)){let{count:e} = n;switch (s){case "animation-name":l = i.map((t =>this.compose_aname(t, e))).join(", ");break;case "animation":l = i.map((t =>{let r = (t || "").split(/\s+/);return r[0] = this.compose_aname(r[0], e), r.join(" ");})).join(", ");}} "content" == s && (/["']|^none$|^(var|counter|counters|attr)\(/.test(l) || (l =`'${l}'`)), "transition" == s && (this.props.has_transition = !0);let u =`${s}:${l};`;if (u = we(s, u), "clip-path" == s && (u += ";overflow:hidden;"), "width" != s && "height" != s || We(r) || (u +=`--internal-cell-${s}:${l};`), /^\-\-/.test(s) && (this.custom_properties[s] = l), je[s]){let t = je[s](l,{is_special_selector:We(r)});switch (s){case "@grid":De(r) ? (this.grid = t.grid, u = t.size || ""):(u = "", this.is_grid_defined || (t = je[s](l,{is_special_selector:!0}), this.grid = t.grid, this.add_rule(":host", t.size || ""))), this.is_grid_defined = !0;break;case "@place-cell":De(r) || (u = t);break;case "@use":e.value.length && this.compose(n, e.value), u = je[s](e.value);break;default:u = t;}} return u;} compose(e, t, r){this.coords.push(e), (t || this.tokens).forEach(((t, n) =>{if (t.skip) return !1;if (r && this.grid) return !1;switch (t.type){case "rule":this.add_rule(this.compose_selector(e), this.compose_rule(t, e));break;case "pseudo":{t.selector.startsWith(":doodle") && (t.selector = t.selector.replace(/^\:+doodle/, ":host"));let r = We(t.selector);r && (t.skip = !0), t.selector.split(",").forEach((n =>{let s = t.styles.map((t =>this.compose_rule(t, e, n))), i = r ? n:this.compose_selector(e, n);this.add_rule(i, s);}));break;} case "cond":{let r = this.Selector[t.name.substr(1)];if (r){let n = t.arguments.map((t =>this.compose_argument(t, e)));this.apply_func(r, e, n) && this.compose(e, t.styles);} break;} case "keyframes":this.keyframes[t.name] || (this.keyframes[t.name] = e =>`\n ${Le(t.steps.map((t =>`\n ${t.name}{${Le(t.styles.map((t =>this.compose_rule(t, e))))}}`)))}`);}}));} output(){Object.keys(this.rules).forEach(((e, t) =>{if (He(e)) this.styles.container +=`\n .container{${Le(this.rules[e])}}`;else{let t = De(e) ? "host":"cells";this.styles[t] +=`\n ${e}{${Le(this.rules[e]).trim()}}`;}}));let e = Object.keys(this.keyframes);this.coords.forEach(((t, r) =>{e.forEach((e =>{let n = this.compose_aname(e, t.count);var s, i;this.styles.keyframes +=`\n ${s = 0 == r, i =`@keyframes ${e}{${this.keyframes[e](t)}}`, s ? "function" == typeof i ? i():i:""} @keyframes ${n}{${this.keyframes[e](t)}}`;}));}));let t = [];return Object.keys(this.custom_properties).forEach((e =>{let r = function(e){let t = String(e).substr(2).split("-")[0];if (void 0 !== Oe[t]) return{name:e, syntax:`<${t}>|<${t}>+ |<${t}>#`, initialValue:Oe[t], inherits:!1};}(e);r && t.push(r);})),{props:this.props, styles:this.styles, grid:this.grid, definitions:t};}} var Ie = window, Pe = Math, Re = [], Ue = 256, Fe = Pe.pow(Ue, 6), Ve = Pe.pow(2, 52), Ze = 2 * Ve, Be = 255;function Je(e, t, r){var n = [], s = Qe(Ke((t = 1 == t ?{entropy:!0}:t ||{}).entropy ? [ e, Ye(Re) ]:null == e ? function(){try{var e;return e = new Uint8Array(Ue), (Ie.crypto || Ie.msCrypto).getRandomValues(e), Ye(e);} catch (e){var t = Ie.navigator, r = t && t.plugins;return [ +new Date, Ie, r, Ie.screen, Ye(Re) ];}}():e, 3), n), i = new Xe(n), l = function(){for (var e = i.g(6), t = Fe, r = 0;e<Ve;) e = (e + r) * Ue, t *= Ue, r = i.g(1);for (;e>= Ze;) e /= 2, t /= 2, r>>>= 1;return (e + r) / t;};return l.int32 = function(){return 0 | i.g(4);}, l.quick = function(){return i.g(4) / 4294967296;}, l.double = l, Qe(Ye(i.S), Re), (t.pass || r || function(e, t, r, n){return n && (n.S && Ge(n, i), e.state = function(){return Ge(i,{});}), r ? (Pe.random = e, t):e;})(l, s, "global" in t ? t.global:this == Pe, t.state);} function Xe(e){var t, r = e.length, n = this, s = 0, i = n.i = n.j = 0, l = n.S = [];for (r || (e = [ r++ ]);s<Ue;) l[s] = s++;for (s = 0;s<Ue;s++) l[s] = l[i = Be & i + e[s % r] + (t = l[s])], l[i] = t;(n.g = function(e){for (var t, r = 0, s = n.i, i = n.j, l = n.S;e--;) t = l[s = Be & s + 1], r = r * Ue + l[Be & (l[s] = l[i = Be & i + t]) + (l[i] = t)];return n.i = s, n.j = i, r;})(Ue);} function Ge(e, t){return t.i = e.i, t.j = e.j, t.S = e.S.slice(), t;} function Ke(e, t){var r, n = [], s = typeof e;if (t && "object" == s) for (r in e) try{n.push(Ke(e[r], t - 1));} catch (e){} return n.length ? n:"string" == s ? e:e + "\0";} function Qe(e, t){for (var r, n = e + "", s = 0;s<n.length;) t[Be & s] = Be & (r ^= 19 * t[Be & s]) + n.charCodeAt(s++);return Ye(t);} function Ye(e){return String.fromCharCode.apply(0, e);} function et({x:e, y:t}){return`\n:host{grid-template-rows:repeat(${t}, 1fr);grid-template-columns:repeat(${e}, 1fr);}`;} function tt(e, t, r){let n = document.createElement("cell");return n.id = H(e, t, r), n;} Qe(Pe.random(), Re);class rt extends HTMLElement{constructor(){super(), this.doodle = this.attachShadow({mode:"open"}), this.extra ={get_variable:this.get_variable.bind(this)};} connectedCallback(e){/^(complete|interactive|loaded)$/.test(document.readyState) ? this.load(e):setTimeout((() =>this.load(e)));} update(e){let t = this.get_use();e || (e = this.innerHTML), this.innerHTML = e, this.grid_size || (this.grid_size = this.get_grid());let{x:r, y:n, z:s} = this.grid_size;const i = this.generate(M(t + e, this.extra));if (i.grid){let{x:e, y:t, z:l} = i.grid;if (r !== e || n !== t || s !== l) return Object.assign(this.grid_size, i.grid), this.build_grid(i, i.grid);Object.assign(this.grid_size, i.grid);} else{let i = this.get_grid(),{x:l, y:u, z:o} = i;if (r !== l || n !== u || s !== o) return Object.assign(this.grid_size, i), this.build_grid(this.generate(M(t + e, this.extra)), i);} this.set_style(".style-keyframes", i.styles.keyframes), i.props.has_animation && (this.set_style(".style-cells", ""), this.set_style(".style-container", "")), setTimeout((() =>{this.set_style(".style-container", et(this.grid_size) + i.styles.host + i.styles.container), this.set_style(".style-cells", i.styles.cells);}));} get grid(){return Object.assign({}, this.grid_size);} set grid(e){this.attr("grid", e), this.connectedCallback(!0);} get seed(){return this._seed_value;} set seed(e){this.attr("seed", e), this.update();} get use(){return this.attr("use");} set use(e){this.attr("use", e), this.connectedCallback(!0);} static get observedAttributes(){return [ "grid", "use", "seed" ];} attributeChangedCallback(e, t, r){if (t == r) return !1;[ "grid", "use", "seed" ].includes(e) && !N(t) && (this[e] = r);} get_grid(){return R(this.attr("grid"));} get_use(){let e = this.attr("use") || "";return e && (e =`@use:${e};`), e;} attr(e, t){return 1 === arguments.length ? this.getAttribute(e):2 === arguments.length ? (this.setAttribute(e, t), t):void 0;} generate(e){let t = this.get_grid(), r = this.attr("seed") || this.attr("data-seed");return N(r) && (r = Date.now()), r = String(r), this._seed_value = r, function(e, t, r){let n = new qe(e, r), s ={};n.compose({x:1, y:1, z:1, count:1, context:{}, grid:{x:1, y:1, z:1, count:1}}, null, !0);let{grid:i} = n.output();if (i && (t = i), n.reset(), 1 == t.z) for (let e = 1, r = 0;e<= t.y;++e) for (let i = 1;i<= t.x;++i) n.compose({x:i, y:e, z:1, count:++r, grid:t, context:s});else for (let e = 1, r = 0;e<= t.z;++e) n.compose({x:1, y:1, z:e, count:++r, grid:t, context:s});return n.output();}(e, t, Je(r));} load(e){let t = this.get_use();if (!this.innerHTML.trim() && !t) return !1;let r = M(t + this.innerHTML, this.extra), n = this.generate(r);this.grid_size = n.grid ? n.grid:this.get_grid(), this.build_grid(n, this.grid_size), e || this.hasAttribute("click-to-update") && this.addEventListener("click", (e =>this.update()));} get_variable(e){return getComputedStyle(this).getPropertyValue(e).trim().replace(/^\(|\)$/g, "");} build_grid(e, t){const{has_transition:r, has_animation:n} = e.props,{keyframes:s, host:i, container:l, cells:u} = e.styles, o = e.definitions;this.doodle.innerHTML =`\n<style>\n *{box-sizing:border-box;} *::after, *::before{box-sizing:inherit;}:host{display:block;visibility:visible;width:auto;height:auto;} .container{position:relative;width:100%;height:100%;display:grid;${xe(/grid/).map((e =>e + ":inherit;")).join("")}} .container cell:empty{position:relative;line-height:1;display:grid;place-items:center;} \n</style><style class="style-keyframes">${s}</style><style class="style-container">${et(t)} ${i} ${l}</style><style class="style-cells">${r || n ? "":u}</style><grid class="container"></grid>`, this.doodle.querySelector(".container").appendChild(function({x:e, y:t, z:r}){let n = document.createDocumentFragment();if (1 == r) for (let r = 1;r<= t;++r) for (let t = 1;t<= e;++t) n.appendChild(tt(t, r, 1));else{let e = null;for (let t = 1;t<= r;++t){let r = tt(1, 1, t);(e || n).appendChild(r), e = r;} e = null;} return n;}(t)), (r || n) && setTimeout((() =>{this.set_style(".style-cells", u);}), 50);try{o.forEach(CSS.registerProperty);} catch (e){}} set_style(e, t){const r = this.shadowRoot.querySelector(e);r && (r.styleSheet ? r.styleSheet.cssText = t:r.innerHTML = t);}} return customElements.get("css-doodle") || customElements.define("css-doodle", rt), function(e, ...t){let r = e.reduce(((e, r, n) =>{return e + r + (null != (s = t[n]) ? s:"");var s;}), ""), n = document.createElement("css-doodle");return n.update && n.update(r), n;};}));