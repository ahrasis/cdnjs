var text=require("../static").text,utils=require("../utils"),isTag=utils.isTag,domEach=utils.domEach,hasOwn=Object.prototype.hasOwnProperty,camelCase=utils.camelCase,cssCase=utils.cssCase,rspace=/\s+/,dataAttrPrefix="data-",primitives={null:null,true:!0,false:!1},rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,getAttr=function(t,e){if(t&&isTag(t))return t.attribs||(t.attribs={}),e?hasOwn.call(t.attribs,e)?rboolean.test(e)?e:t.attribs[e]:"option"===t.name&&"value"===e?text(t.children):"input"!==t.name||"radio"!==t.attribs.type&&"checkbox"!==t.attribs.type||"value"!==e?void 0:"on":t.attribs},setAttr=function(t,e,a){null===a?removeAttribute(t,e):t.attribs[e]=a+""};exports.attr=function(s,r){return"object"==typeof s||void 0!==r?domEach(this,"function"==typeof r?function(t,e){setAttr(e,s,r.call(e,t,e.attribs[s]))}:function(t,a){isTag(a)&&("object"==typeof s?Object.keys(s).forEach(function(t){var e=s[t];setAttr(a,t,e)}):setAttr(a,s,r))}):getAttr(this[0],s)};var getProp=function(t,e){if(t&&isTag(t))return e in t?t[e]:rboolean.test(e)?void 0!==getAttr(t,e):getAttr(t,e)},setProp=function(t,e,a){t[e]=rboolean.test(e)?!!a:a};exports.prop=function(s,r){var e,a=0;if("string"==typeof s&&void 0===r){switch(s){case"style":e=this.css(),Object.keys(e).forEach(function(t){e[a++]=t}),e.length=a;break;case"tagName":case"nodeName":e=this[0].name.toUpperCase();break;case"outerHTML":e=this.clone().wrap("<container />").parent().html();break;default:e=getProp(this[0],s)}return e}if("object"==typeof s||void 0!==r)return domEach(this,"function"==typeof r?function(t,e){setProp(e,s,r.call(e,t,getProp(e,s)))}:function(t,a){isTag(a)&&("object"==typeof s?Object.keys(s).forEach(function(t){var e=s[t];setProp(a,t,e)}):setProp(a,s,r))})};var setData=function(t,e,a){if(t.data||(t.data={}),"object"==typeof e)return Object.assign(t.data,e);"string"==typeof e&&void 0!==a&&(t.data[e]=a)},readData=function(t,e){for(var a,s,r,i,n=1===arguments.length,o=n?(a=Object.keys(t.attribs).filter(function(t){return t.slice(0,dataAttrPrefix.length)===dataAttrPrefix})).map(function(t){return camelCase(t.slice(dataAttrPrefix.length))}):(a=[dataAttrPrefix+cssCase(e)],[e]),c=0,l=a.length;c<l;++c)if(s=a[c],r=o[c],hasOwn.call(t.attribs,s)&&!hasOwn.call(t.data,r)){if(i=t.attribs[s],hasOwn.call(primitives,i))i=primitives[i];else if(i===String(Number(i)))i=Number(i);else if(rbrace.test(i))try{i=JSON.parse(i)}catch(t){}t.data[r]=i}return n?t.data:i};exports.data=function(a,s){var t=this[0];if(t&&isTag(t))return t.data||(t.data={}),a?"object"==typeof a||void 0!==s?(domEach(this,function(t,e){setData(e,a,s)}),this):hasOwn.call(t.data,a)?t.data[a]:readData(t,a):readData(t)},exports.val=function(t){var e=0===arguments.length,a=this[0];if(a)switch(a.name){case"textarea":return this.text(t);case"input":return"radio"===this.attr("type")?e?this.attr("value"):(this.attr("value",t),this):this.attr("value",t);case"select":var s,a=this.find("option:selected");if(void 0===a)return;if(e)return s=a.attr("value"),hasOwn.call(this.attr(),"multiple")&&(s=[],domEach(a,function(t,e){s.push(getAttr(e,"value"))})),s;if(!hasOwn.call(this.attr(),"multiple")&&"object"==typeof t)return this;"object"!=typeof t&&(t=[t]),this.find("option").removeAttr("selected");for(var r=0;r<t.length;r++)this.find('option[value="'+t[r]+'"]').attr("selected","");return this;case"option":return e?this.attr("value"):(this.attr("value",t),this)}};var removeAttribute=function(t,e){t.attribs&&hasOwn.call(t.attribs,e)&&delete t.attribs[e]},splitNames=function(t){return t?t.trim().split(rspace):[]};exports.removeAttr=function(t){for(var a=splitNames(t),s=0;s<a.length;s++)domEach(this,function(t,e){removeAttribute(e,a[s])});return this},exports.hasClass=function(r){return this.toArray().some(function(t){var e,t=t.attribs,a=t&&t.class,s=-1;if(a&&r.length)for(;-1<(s=a.indexOf(r,s+1));)if(e=s+r.length,(0===s||rspace.test(a[s-1]))&&(e===a.length||rspace.test(a[e])))return!0})},exports.addClass=function(s){if("function"==typeof s)return domEach(this,function(t,e){var a=e.attribs.class||"";exports.addClass.call([e],s.call(e,t,a))});if(!s||"string"!=typeof s)return this;for(var t=s.split(rspace),e=this.length,a=0;a<e;a++)if(isTag(this[a])){var r,i,n=getAttr(this[a],"class");if(n){i=" "+n+" ",r=t.length;for(var o=0;o<r;o++){var c=t[o]+" ";i.indexOf(" "+c)<0&&(i+=c)}setAttr(this[a],"class",i.trim())}else setAttr(this[a],"class",t.join(" ").trim())}return this},exports.removeClass=function(a){var n,o,c;return"function"==typeof a?domEach(this,function(t,e){exports.removeClass.call([e],a.call(e,t,e.attribs.class||""))}):(n=splitNames(a),o=n.length,c=0===arguments.length,domEach(this,function(t,e){if(isTag(e))if(c)e.attribs.class="";else{for(var a,s,r=splitNames(e.attribs.class),i=0;i<o;i++)0<=(a=r.indexOf(n[i]))&&(r.splice(a,1),s=!0,i--);s&&(e.attribs.class=r.join(" "))}}))},exports.toggleClass=function(a,s){if("function"==typeof a)return domEach(this,function(t,e){exports.toggleClass.call([e],a.call(e,t,e.attribs.class||"",s),s)});if(!a||"string"!=typeof a)return this;for(var t,e,r=a.split(rspace),i=r.length,n="boolean"==typeof s?s?1:-1:0,o=this.length,c=0;c<o;c++)if(isTag(this[c])){t=splitNames(this[c].attribs.class);for(var l=0;l<i;l++)e=t.indexOf(r[l]),0<=n&&e<0?t.push(r[l]):n<=0&&0<=e&&t.splice(e,1);this[c].attribs.class=t.join(" ")}return this},exports.is=function(t){return!!t&&0<this.filter(t).length};