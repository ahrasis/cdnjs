var htmlparser=require("htmlparser2"),parse5=require("parse5"),htmlparser2Adapter=require("parse5-htmlparser2-tree-adapter"),domhandler=require("domhandler"),DomUtils=htmlparser.DomUtils;function parseWithParse5(e,r,t){return(t?parse5.parse:parse5.parseFragment)(e,{treeAdapter:htmlparser2Adapter,sourceCodeLocationInfo:r.sourceCodeLocationInfo})}exports=module.exports=function(e,r,t){var a;return"undefined"!=typeof Buffer&&Buffer.isBuffer(e)&&(e=e.toString()),"string"==typeof e?r.xmlMode||r._useHtmlParser2?htmlparser.parseDocument(e,r):parseWithParse5(e,r,t):"object"==typeof e&&null!=e&&"root"===e.type?e:(a=new domhandler.Document(e),e.forEach(function(e){e.parent=a}),a)},exports.update=function(e,r){Array.isArray(e)||(e=[e]),r?r.children=e:r=null;for(var t=0;t<e.length;t++){var a=e[t];a.parent&&a.parent.children!==e&&DomUtils.removeElement(a),r?(a.prev=e[t-1]||null,a.next=e[t+1]||null):a.prev=a.next=null,a.parent=r}return r};