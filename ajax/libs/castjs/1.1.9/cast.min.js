"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var Castjs=function(){function n(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,n),!window.chrome)return console.warn("Castjs: Casting is not supported in this browser");"object"===_typeof(e)&&(r=e,e=null),this.receiver=e||"CC1AD845",this.joinpolicy=r.joinpolicy||"tab_and_origin_scoped",this.language=r.language||null,this.resume=r.resume||!0,this.available=!1,this.session=null,this.device=null,this.player=null,this.controller=null,this.events={},this.template={source:null,poster:null,title:null,description:null,subtitles:[],volume:1,muted:!1,paused:!1,progress:0,time:"00:00:00",duration:"00:00:00",state:"disconnected"},this.media=Object.assign({},this.template);var i=setInterval(function(){window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(i),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:t.receiver,autoJoinPolicy:t.joinpolicy,language:t.language,resumeSavedSession:t.resume}),t.player=new cast.framework.RemotePlayer,t.controller=new cast.framework.RemotePlayerController(t.player),t.controller.addEventListener("isConnectedChanged",t.controller_isConnectedChanged.bind(t)),t.controller.addEventListener("currentTimeChanged",t.controller_currentTimeChanged.bind(t)),t.controller.addEventListener("durationChanged",t.controller_durationChanged.bind(t)),t.controller.addEventListener("volumeLevelChanged",t.controller_volumeLevelChanged.bind(t)),t.controller.addEventListener("isMutedChanged",t.controller_isMutedChanged.bind(t)),t.controller.addEventListener("isPausedChanged",t.controller_isPausedChanged.bind(t)),t.controller.addEventListener("playerStateChanged",t.controller_playerStateChanged.bind(t)),t.available=!0,t.trigger("available"))},250)}function e(e){return t.apply(this,arguments)}var t;return _createClass(n,[{key:"controller_isConnectedChanged",value:function(){var r=this;setTimeout(function(){if(r.session=r.player.isConnected,r.session&&r.player.isMediaLoaded){for(var e in r.device=cast.framework.CastContext.getInstance().getCurrentSession().getCastDevice().friendlyName,r.media={source:r.player.mediaInfo.contentId,poster:r.player.imageUrl||null,title:r.player.title||null,description:r.player.mediaInfo.metadata.subtitle||null,subtitles:[],progress:r.controller.getSeekPosition(r.player.currentTime,r.player.duration),time:r.controller.getFormattedTime(r.player.currentTime),duration:r.controller.getFormattedTime(r.player.duration),volume:r.player.volumeLevel,muted:r.player.isMuted,paused:r.player.isPaused,state:r.player.playerState.toLowerCase()},r.player.mediaInfo.tracks)"TEXT"===r.player.mediaInfo.tracks[e].type&&r.media.subtitles.push({label:r.player.mediaInfo.tracks[e].name,src:r.player.mediaInfo.tracks[e].trackContentId});var t=cast.framework.CastContext.getInstance().getCurrentSession().getSessionObj().media[0].activeTrackIds;t.length&&r.media.subtitles[t[0]]&&(r.media.subtitles[t[0]].active=!0),r.trigger("session")}})}},{key:"controller_currentTimeChanged",value:function(){this.media.progress=this.controller.getSeekPosition(this.player.currentTime,this.player.duration),this.media.time=this.controller.getFormattedTime(this.player.currentTime),this.media.duration=this.controller.getFormattedTime(this.player.duration),this.trigger("time",{progress:this.media.progress,time:this.media.time,duration:this.media.duration}),100<=this.media.progress&&(this.trigger("end"),this.disconnect())}},{key:"controller_durationChanged",value:function(){this.media.duration=this.player.duration}},{key:"controller_volumeLevelChanged",value:function(){this.media.volume=this.player.volumeLevel,this.trigger("volume",this.media.volume)}},{key:"controller_isMutedChanged",value:function(){this.media.muted=this.player.isMuted,this.trigger("muted",this.media.muted)}},{key:"controller_isPausedChanged",value:function(){this.media.paused=this.player.isPaused,this.trigger("pause",this.media.paused)}},{key:"controller_playerStateChanged",value:function(){this.media.state=this.player.playerState.toLowerCase(),"idle"===this.media.state&&(this.media.state="disconnected"),this.trigger("state",this.media.state)}},{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"off",value:function(e,t){if(!e)return this.events={};if(this.events[e]){if(void 0===t)return this.events[e]=[];for(var r in this.events[e])if(this.events[e][r]===t){this.events[e].splice(r,1);break}}}},{key:"trigger",value:function(e,t){for(var r in this.events[e])this.events[e][r](t);for(var r in this.events.any)this.events.any[r](e)}},{key:"cast",value:(t=function(e){var a=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e)return this.trigger("error","No media source specified.");for(var r in t.source=e,t)t.hasOwnProperty(r)&&(this.media[r]=t[r]);cast.framework.CastContext.getInstance().requestSession().then(function(){if(!cast.framework.CastContext.getInstance().getCurrentSession())return a.trigger("error","Could not connect with the cast device");var e=new chrome.cast.media.MediaInfo(a.media.source);if(e.metadata=new chrome.cast.media.GenericMediaMetadata,a.media.subtitles.length){e.textTrackStyle=new chrome.cast.media.TextTrackStyle,e.textTrackStyle.fontFamily="Arial",e.textTrackStyle.foregroundColor="#FFFFFF",e.textTrackStyle.backgroundColor="#00000000",e.textTrackStyle.fontScale="1.1",e.textTrackStyle.edgeColor="#00000099",e.textTrackStyle.edgeType="DROP_SHADOW";var t=[];for(var r in a.media.subtitles){var i=new chrome.cast.media.Track(r,"TEXT");i.trackContentId=a.media.subtitles[r].src,i.trackContentType="text/vtt",i.subtype="CAPTIONS",i.name=a.media.subtitles[r].label,t.push(i)}e.tracks=t}e.metadata.images=[{url:a.media.poster}],e.metadata.title=a.media.title,e.metadata.subtitle=a.media.description;var n=new chrome.cast.media.LoadRequest(e);if(n.currentTime=a.media.time,n.autoplay=!a.media.paused,a.media.subtitles.length)for(var r in a.media.subtitles)if(a.media.subtitles[r].active){n.activeTrackIds=[r];break}cast.framework.CastContext.getInstance().getCurrentSession().loadMedia(n).then(function(){return a.device=cast.framework.CastContext.getInstance().getCurrentSession().getCastDevice().friendlyName,a.trigger("session"),a},function(e){return a.trigger("error",e),a})},function(e){return a.trigger("error",e),a})},e.toString=function(){return t.toString()},e)},{key:"seek",value:function(e){return this.player.currentTime=this.controller.getSeekTime(e,this.player.duration),this.controller.seek(),this}},{key:"volume",value:function(e){return this.player.volumeLevel=e,this.controller.setVolumeLevel(),this}},{key:"play",value:function(){return this.media.paused&&this.controller.playOrPause(),this}},{key:"pause",value:function(){return this.media.paused||this.controller.playOrPause(),this}},{key:"mute",value:function(e){return!0===e&&!1===this.media.muted?this.controller.muteOrUnmute():!1===e&&!0===this.media.muted&&this.controller.muteOrUnmute(),this}},{key:"subtitle",value:function(e){var t=new chrome.cast.media.EditTracksInfoRequest([e]);for(var r in cast.framework.CastContext.getInstance().getCurrentSession().getSessionObj().media[0].editTracksInfo(t,null,null),this.media.subtitles)delete this.media.subtitles[r].active,r===e&&(this.media.subtitles[r].active=!0);return this}},{key:"disconnect",value:function(){return cast.framework.CastContext.getInstance().endCurrentSession(!0),this.controller.stop(),this.media=Object.assign({},this.template),this.session=!1,this.media.state="disconnected",this.trigger("disconnected"),this}}]),n}();
