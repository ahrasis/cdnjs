// ZzFX - Zuper Zmall Zound Zynth
// MIT License - Copyright 2019 Frank Force
// https://github.com/KilledByAPixel/ZzFX

"use strict";class _ZZFX{constructor(){this.x=this.CreateAudioContext(),this.volume=.3,this.sampleRate=44100,this.samples=0}Play(t){var a=t&&"object"==typeof t?this.SoundToArray(t):arguments;return a=this.BuildSamples(...a),this.PlaySamples(a)}PlaySamples(t){const a=this.x.createBuffer(1,t.length,this.sampleRate),n=this.x.createBufferSource();return a.getChannelData(0).set(t),n.buffer=a,n.connect(this.x.destination),n.start(),this.samples=t,n}BuildSamples(t=1,a=.05,n=220,e=0,r=0,o=.1,h=0,s=1,d=0,m=0,u=0,i=0,M=0,l=0,c=0,p=0,f=0,S=1,x=0){const y=2*Math.PI;var B=this.sampleRate;const C=d*=500*y/B**2,Z=(0<c?1:-1)*y/4;a=n*=(1+a*(2*Math.random()-1))*y/B,m*=500*y/B**3,c*=y/B,u*=y/B,i*=B,M*=B,B=(e=99+e*B|0)+(x=x*B|0)+(r=r*B|0)+(o=o*B|0)+(f=f*B|0);let b=[],v=0,A=0,P=0,F=1,R=0,T=0,X=0;for(;P<B;b[P++]=X)++T>100*p&&(T=0,X=v*n*Math.sin(A*c-Z),X=(0<(X=h?1<h?2<h?3<h?Math.sin((X%y)**3):Math.max(Math.min(Math.tan(X),1),-1):1-(2*X/y%2+2)%2:1-4*Math.abs(Math.round(X/y)-X/y):Math.sin(X))?1:-1)*Math.abs(X)**s,X*=t*this.volume*(P<e?P/e:P<e+x?1-(P-e)/x*(1-S):P<e+x+r?S:P<B-f?(1-(B-P+o)/o)*S:0),X=f?X/2+(f>P?0:(P<B-f?1:(P-B)/f)*b[P-f]/2):X),v+=1+l*(2*Math.random()-1),A+=1+l*(2*Math.random()-1),n+=d+=m,F&&++F>i&&(n+=u,a+=u,F=0),M&&++R>M&&(n=a,d=C,R=1,F=F||1);return b}BuildRandomSound(){const t=Math.random()**3,a=Math.random()**3,n=Math.random()**3,e=Math.random()**3,r=t+e+a+n;return this.BuildSound(1,.05,2e3*Math.random()**2,t,a,n,5*Math.random()|0,3*Math.random()**2,(.5>Math.random())*Math.random()**3*99*(.5>Math.random()?1:-1),(.5>Math.random())*Math.random()**3*99*(.5>Math.random()?1:-1),(.5>Math.random())*Math.random()**2*1e3*(.5>Math.random()?1:-1),Math.random()**2*r,(.5>Math.random())*Math.random()*r,(.5>Math.random())*Math.random()**4,(.5>Math.random())*Math.random()**3*9*(.5>Math.random()?1:-1),(.5>Math.random())*Math.random()**4,(.5>Math.random())*Math.random()**3/2,1-(.5>Math.random())*Math.random(),e)}BuildSound(t=1,a=.05,n=220,e=0,r=0,o=.1,h=0,s=1,d=0,m=0,u=0,i=0,M=0,l=0,c=0,p=0,f=0,S=1,x=0){return{volume:t,randomness:a,frequency:n,attack:e,sustain:r,release:o,shape:h,shapeCurve:s,slide:d,deltaSlide:m,pitchJump:u,pitchJumpTime:i,repeatTime:M,noise:l,modulation:c,bitCrush:p,delay:f,sustainVolume:S,decay:x}}GetNote(t=440,a=0){return t*2**(a/12)}SoundToArray(t){const a=this.BuildSound(),n=[];for(const e in a)n.push(t[e]);return n}CreateAudioContext(){const t=new(AudioContext||webkitAudioContext);return t.a=t.createBufferSource,t.createBufferSource=((a=t.a())=>(a.start=a.start||a.noteOn,a.stop=a.stop||a.noteOff,a)),t}}const ZZFX=new _ZZFX;function zzfx(){return ZZFX.Play(...arguments)}