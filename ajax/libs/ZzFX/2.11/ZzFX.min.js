// ZzFX - Zuper Zmall Zound Zynth - MIT License - Copyright 2019 Frank Force
"use strict";class _ZZFX{constructor(){this.x=this.CreateAudioContext(),this.volume=.3,this.sampleRate=44100,this.samples=0}Play(t){var a=t&&"object"==typeof t?this.SoundToArray(t):arguments;return a=this.BuildSamples(...a),this.PlaySamples(a)}PlaySamples(t){const a=this.x.createBuffer(1,t.length,this.sampleRate),n=this.x.createBufferSource();return a.getChannelData(0).set(t),n.buffer=a,n.connect(this.x.destination),n.start(),this.samples=t,n}BuildSamples(t=1,a=.05,n=220,e=0,r=0,o=.1,h=0,s=1,d=0,m=0,i=0,u=0,M=0,l=0,c=0,p=0,f=0){const S=2*Math.PI;var x=this.sampleRate;const B=d*=500*S/x**2,y=(0<c?1:-1)*S/4;a=n*=(1+a*(2*Math.random()-1))*S/x,e=99+e*x|0,r=r*x|0,o=o*x|0,f=f*x|0,m*=500*S/x**3,c*=S/x,i*=S/x,u*=x,M*=x,x=Math.max(1,Math.min(e+r+o+f,10*x));let C=[],Z=0,b=0,v=0,A=1,P=0,F=0,R=0;for(;v<x;C[v++]=R)++F>100*p&&(F=0,R=Z*n*Math.sin(b*c-y),R=(0<(R=h?1<h?2<h?3<h?Math.sin((R%S)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/S%2+2)%2:1-4*Math.abs(Math.round(R/S)-R/S):Math.sin(R))?1:-1)*Math.abs(R)**s,R*=t*this.volume*(v<e?v/e:v<e+r?1:v<x-f?1-(v-e-r)/o:0),R=f?R/2+(f>v?0:(v<x-f?1:(v-x)/f)*C[v-f]/2):R),Z+=1+l*(2*Math.random()-1),b+=1+l*(2*Math.random()-1),n+=d+=m,A&&++A>u&&(n+=i,a+=i,A=0),M&&++P>M&&(n=a,d=B,P=1,A=A||1);return C}BuildRandomSound(){const t=Math.random()**3,a=Math.random()**3,n=Math.random()**3,e=t+a+n;return this.BuildSound(1,.05,2e3*Math.random()**2,t,a,n,5*Math.random()|0,3*Math.random()**2,(.5>Math.random())*Math.random()**3*99*(.5>Math.random()?1:-1),(.5>Math.random())*Math.random()**3*99*(.5>Math.random()?1:-1),(.5>Math.random())*Math.random()**2*1e3*(.5>Math.random()?1:-1),Math.random()**2*e,(.5>Math.random())*Math.random()*e,(.5>Math.random())*Math.random()**4,(.5>Math.random())*Math.random()**3*9*(.5>Math.random()?1:-1),(.5>Math.random())*Math.random()**4,(.5>Math.random())*Math.random()**3/2)}BuildSound(t=1,a=.05,n=220,e=0,r=0,o=.1,h=0,s=1,d=0,m=0,i=0,u=0,M=0,l=0,c=0,p=0,f=0){return{volume:t,randomness:a,frequency:n,attack:e,sustain:r,release:o,shape:h,shapeCurve:s,slide:d,deltaSlide:m,pitchJump:i,pitchJumpTime:u,repeatTime:M,noise:l,modulation:c,bitCrush:p,delay:f}}GetNote(t=440,a=0){return t*2**(a/12)}SoundToArray(t){const a=this.BuildSound(),n=[];for(const e in a)n.push(t[e]);return n}CreateAudioContext(){const t=new(AudioContext||webkitAudioContext);return t.a=t.createBufferSource,t.createBufferSource=((a=t.a())=>(a.start=a.start||a.noteOn,a.stop=a.stop||a.noteOff,a)),t}}const ZZFX=new _ZZFX;function zzfx(){return ZZFX.Play(...arguments)}