"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_reactCssThemr=require("react-css-themr"),_dissoc=require("ramda/src/dissoc"),_dissoc2=_interopRequireDefault(_dissoc),_identifiers=require("../identifiers.js"),_events=require("../utils/events"),_events2=_interopRequireDefault(_events),_prefixer=require("../utils/prefixer"),_prefixer2=_interopRequireDefault(_prefixer);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _objectWithoutProperties(e,t){var r,i={};for(r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r]);return i}var defaults={centered:!1,className:"",multiple:!0,passthrough:!0,spread:2,theme:{}},rippleFactory=function(e){var e=_extends({},defaults,0<arguments.length&&void 0!==e?e:{}),t=e.centered,r=e.className,i=e.multiple,c=e.passthrough,p=e.spread,s=e.theme,a=_objectWithoutProperties(e,["centered","className","multiple","passthrough","spread","theme"]);return function(l){var e=(_inherits(n,_react.Component),_createClass(n,[{key:"componentDidUpdate",value:function(e,t){Object.keys(t.ripples).length<Object.keys(this.state.ripples).length&&this.addRippleRemoveEventListener(this.getLastKey())}},{key:"componentWillUnmount",value:function(){var t=this;Object.keys(this.state.ripples).forEach(function(e){t.state.ripples[e].endRipple()})}},{key:"addRippleRemoveEventListener",value:function(r){var i=this;_events2.default.addEventListenerOnTransitionEnded(this.refs[r],function e(t){"opacity"===t.propertyName&&(i.props.onRippleEnded&&i.props.onRippleEnded(t),_events2.default.removeEventListenerOnTransitionEnded(i.refs[r],e),i.setState({ripples:(0,_dissoc2.default)(r,i.state.ripples)}))})}},{key:"animateRipple",value:function(e,t,r){var i,p,n,s,a=this;this.rippleShouldTrigger(r)&&(i=a.getDescriptor(e,t),p=i.top,e=i.left,t=i.width,i=0===Object.keys(a.state.ripples).length,n=a.props.rippleMultiple||i?a.getNextKey():a.getLastKey(),t={active:!1,restarting:!0,top:p,left:e,width:t,endRipple:a.addRippleDeactivateEventListener(r,n)},s={active:!0,restarting:!1},t=_extends({},a.state.ripples,_defineProperty({},n,t)),a.setState({ripples:t},function(){a.refs[n]&&a.refs[n].offsetWidth,a.setState({ripples:_extends({},a.state.ripples,_defineProperty({},n,Object.assign({},a.state.ripples[n],s)))})}))}},{key:"rippleShouldTrigger",value:function(e){var t=!!e||!this.touchCache;return this.touchCache=e,t}},{key:"getDescriptor",value:function(e,t){var r=_reactDom2.default.findDOMNode(this).getBoundingClientRect(),i=r.left,p=r.top,n=r.height,s=r.width,a=this.props,r=a.rippleCentered;return{left:r?0:e-i-s/2,top:r?0:t-p-n/2,width:s*a.rippleSpread}}},{key:"getNextKey",value:function(){return this.currentCount=this.currentCount?this.currentCount+1:1,"ripple"+this.currentCount}},{key:"getLastKey",value:function(){return"ripple"+this.currentCount}},{key:"addRippleDeactivateEventListener",value:function(e,t){e=e?"touchend":"mouseup",t=this.createRippleDeactivateCallback(e,t);return document.addEventListener(e,t),t}},{key:"createRippleDeactivateCallback",value:function(t,r){var i=this;return function e(){document.removeEventListener(t,e),i.setState({ripples:_extends({},i.state.ripples,_defineProperty({},r,Object.assign({},i.state.ripples[r],{active:!1})))})}}},{key:"renderRipple",value:function(e,t,r){var i=r.active,p=r.left,n=r.restarting,s=r.top,r=r.width,p="translate3d("+(-r/2+p)+"px, "+(-r/2+s)+"px, 0) scale("+(n?0:1)+")",t=(0,_classnames3.default)(this.props.theme.ripple,(_defineProperty(s={},this.props.theme.rippleActive,i),_defineProperty(s,this.props.theme.rippleRestarting,n),s),t);return _react2.default.createElement("span",_extends({key:e,"data-react-toolbox":"ripple",className:this.props.theme.rippleWrapper},a),_react2.default.createElement("span",{role:"ripple",ref:e,className:t,style:(0,_prefixer2.default)({transform:p},{width:r,height:r})}))}},{key:"render",value:function(){var t=this,e=this.props,r=e.children,i=e.disabled,p=e.ripple,n=(e.onRippleEnded,e.rippleCentered,e.rippleClassName),s=(e.rippleMultiple,e.rippleSpread,e.theme),a=_objectWithoutProperties(e,["children","disabled","ripple","onRippleEnded","rippleCentered","rippleClassName","rippleMultiple","rippleSpread","theme"]),o=this.state.ripples,e=Object.keys(o).map(function(e){return t.renderRipple(e,n,o[e])}),a=_extends({onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart},a),a=c?_extends({},a,{theme:s,disabled:i}):a;return p?_react2.default.createElement(l,a,[r,e]):_react2.default.createElement(l,a,r)}}]),n);function n(){var e,r;_classCallCheck(this,n);for(var t=arguments.length,i=Array(t),p=0;p<t;p++)i[p]=arguments[p];return(e=r=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(i)))).state={ripples:{}},r.handleMouseDown=function(e){var t;r.props.onMouseDown&&r.props.onMouseDown(e),r.props.disabled||(e=(t=_events2.default.getMousePosition(e)).x,t=t.y,r.animateRipple(e,t,!1))},r.handleTouchStart=function(e){var t;r.props.onTouchStart&&r.props.onTouchStart(e),r.props.disabled||(e=(t=_events2.default.getTouchPosition(e)).x,t=t.y,r.animateRipple(e,t,!0))},_possibleConstructorReturn(r,e)}return e.propTypes={children:_react.PropTypes.any,disabled:_react.PropTypes.bool,onRippleEnded:_react.PropTypes.func,ripple:_react.PropTypes.bool,rippleCentered:_react.PropTypes.bool,rippleClassName:_react.PropTypes.string,rippleMultiple:_react.PropTypes.bool,rippleSpread:_react.PropTypes.number,theme:_react.PropTypes.shape({ripple:_react.PropTypes.string,rippleActive:_react.PropTypes.string,rippleRestarting:_react.PropTypes.string,rippleWrapper:_react.PropTypes.string})},e.defaultProps={disabled:!1,ripple:!0,rippleCentered:t,rippleClassName:r,rippleMultiple:i,rippleSpread:p},(0,_reactCssThemr.themr)(_identifiers.RIPPLE,s)(e)}};exports.default=rippleFactory;