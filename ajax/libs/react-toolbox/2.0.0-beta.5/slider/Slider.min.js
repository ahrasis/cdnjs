"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Slider=exports.sliderFactory=void 0;var _createClass=function(){function n(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_reactCssThemr=require("react-css-themr"),_utils=require("../utils/utils"),_identifiers=require("../identifiers.js"),_events=require("../utils/events.js"),_events2=_interopRequireDefault(_events),_ProgressBar=require("../progress_bar/ProgressBar.js"),_ProgressBar2=_interopRequireDefault(_ProgressBar),_Input=require("../input/Input.js"),_Input2=_interopRequireDefault(_Input);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var factory=function(n,t){var e=(_inherits(a,_react.Component),_createClass(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),this.handleResize()}},{key:"componentWillReceiveProps",value:function(e){this.state.inputFocused&&this.props.value!==e.value&&this.setState({inputValue:this.valueForInput(e.value)})}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.inputFocused||!t.inputFocused}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),_events2.default.removeEventsFromDocument(this.getMouseEventMap()),_events2.default.removeEventsFromDocument(this.getTouchEventMap()),_events2.default.removeEventsFromDocument(this.getKeyboardEvents())}},{key:"addToValue",value:function(e){var t=this.state.inputFocused?parseFloat(this.state.inputValue):this.props.value;(t=this.trimValue(t+e))!==this.props.value&&this.props.onChange(t)}},{key:"getInput",value:function(){return this.refs.input&&this.refs.input.getWrappedInstance?this.refs.input.getWrappedInstance():this.refs.input}},{key:"getKeyboardEvents",value:function(){return{keydown:this.handleKeyDown}}},{key:"getMouseEventMap",value:function(){return{mousemove:this.handleMouseMove,mouseup:this.handleMouseUp}}},{key:"getTouchEventMap",value:function(){return{touchmove:this.handleTouchMove,touchend:this.handleTouchEnd}}},{key:"end",value:function(e){_events2.default.removeEventsFromDocument(e),this.setState({pressed:!1})}},{key:"knobOffset",value:function(){var e=this.props,t=e.max,e=e.min;return 100*(this.state.sliderLength*(this.props.value-e)/(t-e))/this.state.sliderLength}},{key:"move",value:function(e){e=this.positionToValue(e);e!==this.props.value&&this.props.onChange(e)}},{key:"positionToValue",value:function(e){var t=this.state,s=t.sliderStart,n=t.sliderLength,r=this.props,a=r.max,t=r.min,r=r.step,a=(e.x-s)/n*(a-t);return this.trimValue(Math.round(a/r)*r+t)}},{key:"start",value:function(e){var t=this;this.handleResize(null,function(){t.setState({pressed:!0}),t.props.onChange(t.positionToValue(e))})}},{key:"stepDecimals",value:function(){return(this.props.step.toString().split(".")[1]||[]).length}},{key:"trimValue",value:function(e){return e<this.props.min?this.props.min:e>this.props.max?this.props.max:(0,_utils.round)(e,this.stepDecimals())}},{key:"valueForInput",value:function(e){var t=this.stepDecimals();return 0<t?e.toFixed(t):e.toString()}},{key:"renderSnaps",value:function(){var t=this;if(this.props.snaps)return _react2.default.createElement("div",{ref:"snaps",className:this.props.theme.snaps},(0,_utils.range)(0,(this.props.max-this.props.min)/this.props.step).map(function(e){return _react2.default.createElement("div",{key:"span-"+e,className:t.props.theme.snap})}))}},{key:"renderInput",value:function(){if(this.props.editable){var e=this.state.inputFocused?this.state.inputValue:this.valueForInput(this.props.value);return _react2.default.createElement(t,{ref:"input",className:this.props.theme.input,disabled:this.props.disabled,onFocus:this.handleInputFocus,onChange:this.handleInputChange,onBlur:this.handleInputBlur,value:e})}}},{key:"render",value:function(){var e=this.props.theme,t={left:this.knobOffset()+"%"},s=(0,_classnames3.default)(e.slider,(_defineProperty(s={},e.editable,this.props.editable),_defineProperty(s,e.disabled,this.props.disabled),_defineProperty(s,e.pinned,this.props.pinned),_defineProperty(s,e.pressed,this.state.pressed),_defineProperty(s,e.ring,this.props.value===this.props.min),s),this.props.className);return _react2.default.createElement("div",{className:s,disabled:this.props.disabled,"data-react-toolbox":"slider",onBlur:this.handleSliderBlur,onFocus:this.handleSliderFocus,style:this.props.style,tabIndex:"0"},_react2.default.createElement("div",{ref:"slider",className:e.container,onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart},_react2.default.createElement("div",{ref:"knob",className:e.knob,onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart,style:t},_react2.default.createElement("div",{className:e.innerknob,"data-value":parseInt(this.props.value)})),_react2.default.createElement("div",{className:e.progress},_react2.default.createElement(n,{disabled:this.props.disabled,ref:"progressbar",className:e.innerprogress,max:this.props.max,min:this.props.min,mode:"determinate",value:this.props.value}),this.renderSnaps())),this.renderInput())}}]),a);function a(){var e,r;_classCallCheck(this,a);for(var t=arguments.length,s=Array(t),n=0;n<t;n++)s[n]=arguments[n];return(e=r=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(s)))).state={inputFocused:!1,inputValue:null,sliderLength:0,sliderStart:0},r.handleInputFocus=function(){r.setState({inputFocused:!0,inputValue:r.valueForInput(r.props.value)})},r.handleInputChange=function(e){r.setState({inputValue:e})},r.handleInputBlur=function(e){var t=r.state.inputValue||0;r.setState({inputFocused:!1,inputValue:null},function(){r.props.onChange(r.trimValue(t),e)})},r.handleKeyDown=function(e){-1!==[13,27].indexOf(e.keyCode)&&r.getInput().blur(),38===e.keyCode&&r.addToValue(r.props.step),40===e.keyCode&&r.addToValue(-r.props.step)},r.handleMouseDown=function(e){r.state.inputFocused&&r.getInput().blur(),_events2.default.addEventsToDocument(r.getMouseEventMap()),r.start(_events2.default.getMousePosition(e)),_events2.default.pauseEvent(e)},r.handleMouseMove=function(e){_events2.default.pauseEvent(e),r.move(_events2.default.getMousePosition(e))},r.handleMouseUp=function(){r.end(r.getMouseEventMap())},r.handleResize=function(e,t){var s=_reactDom2.default.findDOMNode(r.refs.progressbar).getBoundingClientRect(),n=s.left,s=s.right,t=t||function(){};r.setState({sliderStart:n,sliderLength:s-n},t)},r.handleSliderBlur=function(){_events2.default.removeEventsFromDocument(r.getKeyboardEvents())},r.handleSliderFocus=function(){_events2.default.addEventsToDocument(r.getKeyboardEvents())},r.handleTouchEnd=function(){r.end(r.getTouchEventMap())},r.handleTouchMove=function(e){r.move(_events2.default.getTouchPosition(e))},r.handleTouchStart=function(e){r.state.inputFocused&&r.getInput().blur(),r.start(_events2.default.getTouchPosition(e)),_events2.default.addEventsToDocument(r.getTouchEventMap()),_events2.default.pauseEvent(e)},_possibleConstructorReturn(r,e)}return e.propTypes={className:_react.PropTypes.string,disabled:_react.PropTypes.bool,editable:_react.PropTypes.bool,max:_react.PropTypes.number,min:_react.PropTypes.number,onChange:_react.PropTypes.func,pinned:_react.PropTypes.bool,snaps:_react.PropTypes.bool,step:_react.PropTypes.number,style:_react.PropTypes.object,theme:_react.PropTypes.shape({container:_react.PropTypes.string,editable:_react.PropTypes.string,innerknob:_react.PropTypes.string,innerprogress:_react.PropTypes.string,input:_react.PropTypes.string,knob:_react.PropTypes.string,pinned:_react.PropTypes.string,pressed:_react.PropTypes.string,progress:_react.PropTypes.string,ring:_react.PropTypes.string,slider:_react.PropTypes.string,snap:_react.PropTypes.string,snaps:_react.PropTypes.string}),value:_react.PropTypes.number},e.defaultProps={className:"",editable:!1,max:100,min:0,pinned:!1,snaps:!1,step:.01,value:0},e},Slider=factory(_ProgressBar2.default,_Input2.default);exports.default=(0,_reactCssThemr.themr)(_identifiers.SLIDER)(Slider),exports.sliderFactory=factory,exports.Slider=Slider;