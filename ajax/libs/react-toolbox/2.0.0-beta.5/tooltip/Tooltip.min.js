"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,i=arguments[t];for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_Portal=require("../hoc/Portal"),_Portal2=_interopRequireDefault(_Portal),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_reactCssThemr=require("react-css-themr"),_utils=require("../utils/utils"),_identifiers=require("../identifiers.js"),_events=require("../utils/events"),_events2=_interopRequireDefault(_events);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _objectWithoutProperties(e,t){var o,i={};for(o in e)0<=t.indexOf(o)||Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=e[o]);return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var POSITION={BOTTOM:"bottom",HORIZONTAL:"horizontal",LEFT:"left",RIGHT:"right",TOP:"top",VERTICAL:"vertical"},defaults={className:"",delay:0,hideOnClick:!0,passthrough:!0,showOnClick:!1,position:POSITION.VERTICAL,theme:{}},tooltipFactory=function(e){var e=_extends({},defaults,0<arguments.length&&void 0!==e?e:{}),t=e.className,o=e.delay,i=e.hideOnClick,r=e.showOnClick,f=e.passthrough,s=e.position,a=e.theme;return function(u){var e=(_inherits(n,_react.Component),_createClass(n,[{key:"componentWillUnmount",value:function(){this.refs.tooltip&&_events2.default.removeEventListenerOnTransitionEnded(this.refs.tooltip,this.onTransformEnd),this.timeout&&clearTimeout(this.timeout)}},{key:"activate",value:function(e){var t=this,o=e.top,i=e.left,e=e.position;this.timeout&&clearTimeout(this.timeout),this.setState({visible:!0,position:e}),this.timeout=setTimeout(function(){t.setState({active:!0,top:o,left:i})},this.props.tooltipDelay)}},{key:"deactivate",value:function(){this.timeout&&clearTimeout(this.timeout),this.state.active?(_events2.default.addEventListenerOnTransitionEnded(this.refs.tooltip,this.onTransformEnd),this.setState({active:!1})):this.state.visible&&this.setState({visible:!1})}},{key:"getPosition",value:function(e){var t=this.props.tooltipPosition;if(t===POSITION.HORIZONTAL){var o=e.getBoundingClientRect(),i=(0,_utils.getViewport)().width;return o.left<i/2-o.width/2?POSITION.RIGHT:POSITION.LEFT}if(t!==POSITION.VERTICAL)return t;t=e.getBoundingClientRect(),e=(0,_utils.getViewport)().height;return t.top<e/2-t.height/2?POSITION.BOTTOM:POSITION.TOP}},{key:"calculatePosition",value:function(e){var t=this.getPosition(e),o=e.getBoundingClientRect(),i=o.top,r=o.left,n=o.height,s=o.width,e=window.scrollX||window.pageXOffset,o=window.scrollY||window.pageYOffset;return t===POSITION.BOTTOM?{top:i+n+o,left:r+s/2+e,position:t}:t===POSITION.TOP?{top:i+o,left:r+s/2+e,position:t}:t===POSITION.LEFT?{top:i+n/2+o,left:r+e,position:t}:t===POSITION.RIGHT?{top:i+n/2+o,left:r+s+e,position:t}:void 0}},{key:"render",value:function(){var e=this.state,t=e.active,o=e.left,i=e.top,r=e.position,n=e.visible,s="tooltip"+(r.charAt(0).toUpperCase()+r.slice(1)),a=this.props,l=a.children,p=a.className,c=a.theme,e=(a.onClick,a.onMouseEnter,a.onMouseLeave,a.tooltip),r=(a.tooltipDelay,a.tooltipHideOnClick,a.tooltipPosition,a.tooltipShowOnClick,_objectWithoutProperties(a,["children","className","theme","onClick","onMouseEnter","onMouseLeave","tooltip","tooltipDelay","tooltipHideOnClick","tooltipPosition","tooltipShowOnClick"])),a=(0,_classnames3.default)(c.tooltip,(_defineProperty(a={},c.tooltipActive,t),_defineProperty(a,c[s],c[s]),a)),p=_extends({},r,{className:p,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave}),p="string"!=typeof u&&f?_extends({},p,{theme:c}):p;return _react2.default.createElement(u,p,l,n&&_react2.default.createElement(_Portal2.default,null,_react2.default.createElement("span",{ref:"tooltip",className:a,"data-react-toolbox":"tooltip",style:{top:i,left:o}},_react2.default.createElement("span",{className:c.tooltipInner},e))))}}]),n);function n(){var e,t;_classCallCheck(this,n);for(var o=arguments.length,i=Array(o),r=0;r<o;r++)i[r]=arguments[r];return(e=t=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(i)))).state={active:!1,position:t.props.tooltipPosition,visible:!1},t.onTransformEnd=function(e){"transform"===e.propertyName&&(_events2.default.removeEventListenerOnTransitionEnded(t.refs.tooltip,t.onTransformEnd),t.setState({visible:!1}))},t.handleMouseEnter=function(e){t.activate(t.calculatePosition(e.currentTarget)),t.props.onMouseEnter&&t.props.onMouseEnter(e)},t.handleMouseLeave=function(e){t.deactivate(),t.props.onMouseLeave&&t.props.onMouseLeave(e)},t.handleClick=function(e){t.props.tooltipHideOnClick&&t.state.active&&t.deactivate(),t.props.tooltipShowOnClick&&!t.state.active&&t.activate(t.calculatePosition(e.currentTarget)),t.props.onClick&&t.props.onClick(e)},_possibleConstructorReturn(t,e)}return e.propTypes={children:_react.PropTypes.any,className:_react.PropTypes.string,onClick:_react.PropTypes.func,onMouseEnter:_react.PropTypes.func,onMouseLeave:_react.PropTypes.func,theme:_react.PropTypes.shape({tooltip:_react.PropTypes.string,tooltipActive:_react.PropTypes.string,tooltipWrapper:_react.PropTypes.string}),tooltip:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.node]),tooltipDelay:_react.PropTypes.number,tooltipHideOnClick:_react.PropTypes.bool,tooltipPosition:_react.PropTypes.oneOf(Object.keys(POSITION).map(function(e){return POSITION[e]})),tooltipShowOnClick:_react.PropTypes.bool},e.defaultProps={className:t,tooltipDelay:o,tooltipHideOnClick:i,tooltipPosition:s,tooltipShowOnClick:r},(0,_reactCssThemr.themr)(_identifiers.TOOLTIP,a)(e)}};exports.default=tooltipFactory;