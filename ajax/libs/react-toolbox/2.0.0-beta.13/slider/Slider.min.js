"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Slider=exports.sliderFactory=void 0;var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_reactStyleProptype=require("react-style-proptype"),_reactStyleProptype2=_interopRequireDefault(_reactStyleProptype),_reactCssThemr=require("react-css-themr"),_utils=require("../utils/utils"),_identifiers=require("../identifiers"),_events=require("../utils/events"),_events2=_interopRequireDefault(_events),_ProgressBar=require("../progress_bar/ProgressBar"),_ProgressBar2=_interopRequireDefault(_ProgressBar),_Input=require("../input/Input"),_Input2=_interopRequireDefault(_Input);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var KEYS={ENTER:"Enter",ESC:"Escape",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown"},factory=function(s,e){var t=(_inherits(o,_react.Component),_createClass(o,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),this.handleResize()}},{key:"componentWillReceiveProps",value:function(e){this.state.inputFocused&&this.props.value!==e.value&&this.setState({inputValue:this.valueForInput(e.value)})}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.inputFocused||!t.inputFocused}},{key:"componentWillUpdate",value:function(e,t){t.pressed!==this.state.pressed&&(t.pressed?this.props.onDragStart():this.props.onDragStop())}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),_events2.default.removeEventsFromDocument(this.getMouseEventMap()),_events2.default.removeEventsFromDocument(this.getTouchEventMap()),_events2.default.removeEventsFromDocument(this.getKeyboardEvents())}},{key:"getKeyboardEvents",value:function(){return{keydown:this.handleKeyDown}}},{key:"getMouseEventMap",value:function(){return{mousemove:this.handleMouseMove,mouseup:this.handleMouseUp}}},{key:"getTouchEventMap",value:function(){return{touchmove:this.handleTouchMove,touchend:this.handleTouchEnd}}},{key:"addToValue",value:function(e){var t=this.state.inputFocused?parseFloat(this.state.inputValue):this.props.value;(t=this.trimValue(t+e))!==this.props.value&&this.props.onChange(t)}},{key:"end",value:function(e){_events2.default.removeEventsFromDocument(e),this.setState({pressed:!1})}},{key:"knobOffset",value:function(){var e=this.props,t=e.max,n=e.min;return(e.value-n)/(t-n)*100}},{key:"move",value:function(e){e=this.positionToValue(e);e!==this.props.value&&this.props.onChange(e)}},{key:"positionToValue",value:function(e){var t=this.state,n=t.sliderStart,r=t.sliderLength,s=this.props,o=s.max,t=s.min,s=s.step,o=(e.x-n)/r*(o-t);return this.trimValue(Math.round(o/s)*s+t)}},{key:"start",value:function(e){var t=this;this.handleResize(null,function(){t.setState({pressed:!0}),t.props.onChange(t.positionToValue(e))})}},{key:"stepDecimals",value:function(){return(this.props.step.toString().split(".")[1]||[]).length}},{key:"trimValue",value:function(e){return e<this.props.min?this.props.min:e>this.props.max?this.props.max:(0,_utils.round)(e,this.stepDecimals())}},{key:"valueForInput",value:function(e){var t=this.stepDecimals();return 0<t?e.toFixed(t):e.toString()}},{key:"renderSnaps",value:function(){var t=this;if(this.props.snaps)return _react2.default.createElement("div",{className:this.props.theme.snaps},(0,_utils.range)(0,(this.props.max-this.props.min)/this.props.step).map(function(e){return _react2.default.createElement("div",{key:"span-"+e,className:t.props.theme.snap})}))}},{key:"renderInput",value:function(){var t=this;if(this.props.editable)return _react2.default.createElement(e,{innerRef:function(e){t.inputNode=e},className:this.props.theme.input,disabled:this.props.disabled,onFocus:this.handleInputFocus,onChange:this.handleInputChange,onBlur:this.handleInputBlur,value:this.state.inputFocused?this.state.inputValue:this.valueForInput(this.props.value)})}},{key:"render",value:function(){var t=this,e=this.props.theme,n={left:this.knobOffset()+"%"},r=(0,_classnames3.default)(e.slider,(_defineProperty(r={},e.editable,this.props.editable),_defineProperty(r,e.disabled,this.props.disabled),_defineProperty(r,e.pinned,this.props.pinned),_defineProperty(r,e.pressed,this.state.pressed),_defineProperty(r,e.ring,this.props.value===this.props.min),r),this.props.className);return _react2.default.createElement("div",{className:r,disabled:this.props.disabled,"data-react-toolbox":"slider",onBlur:this.handleSliderBlur,onFocus:this.handleSliderFocus,style:this.props.style,tabIndex:"0"},_react2.default.createElement("div",{ref:function(e){t.sliderNode=e},className:e.container,onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart},_react2.default.createElement("div",{ref:function(e){t.knobNode=e},className:e.knob,onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart,style:n},_react2.default.createElement("div",{className:e.innerknob,"data-value":parseInt(this.props.value,10)})),_react2.default.createElement("div",{className:e.progress},_react2.default.createElement(s,{disabled:this.props.disabled,ref:function(e){t.progressbarNode=e},className:e.innerprogress,max:this.props.max,min:this.props.min,mode:"determinate",value:this.props.value,buffer:this.props.buffer}),this.renderSnaps())),this.renderInput())}}]),o);function o(){var e,u;_classCallCheck(this,o);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=u=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(n)))).state={inputFocused:!1,inputValue:null,sliderLength:0,sliderStart:0},u.handleInputFocus=function(){u.setState({inputFocused:!0,inputValue:u.valueForInput(u.props.value)})},u.handleInputChange=function(e){u.setState({inputValue:e})},u.handleInputBlur=function(e){var t=u.state.inputValue||0;u.setState({inputFocused:!1,inputValue:null},function(){u.props.onChange(u.trimValue(t),e)})},u.handleKeyDown=function(e){var t=u.props,n=t.disabled,r=t.step,s=KEYS.ARROW_DOWN,o=KEYS.ARROW_UP,a=KEYS.ENTER,t=KEYS.ESC;n||([a,t].includes(e.code)&&u.inputNode.blur(),e.code===o&&u.addToValue(r),e.code===s&&u.addToValue(-r))},u.handleMouseDown=function(e){u.state.inputFocused&&u.inputNode.blur(),_events2.default.addEventsToDocument(u.getMouseEventMap()),u.start(_events2.default.getMousePosition(e)),_events2.default.pauseEvent(e)},u.handleMouseMove=function(e){_events2.default.pauseEvent(e),u.move(_events2.default.getMousePosition(e))},u.handleMouseUp=function(){u.end(u.getMouseEventMap())},u.handleResize=function(e,t){var n=_reactDom2.default.findDOMNode(u.progressbarNode).getBoundingClientRect(),r=n.left,n=n.right,t=t||function(){};u.setState({sliderStart:r,sliderLength:n-r},t)},u.handleSliderBlur=function(){_events2.default.removeEventsFromDocument(u.getKeyboardEvents())},u.handleSliderFocus=function(){_events2.default.addEventsToDocument(u.getKeyboardEvents())},u.handleTouchEnd=function(){u.end(u.getTouchEventMap())},u.handleTouchMove=function(e){u.move(_events2.default.getTouchPosition(e))},u.handleTouchStart=function(e){u.state.inputFocused&&u.inputNode.blur(),u.start(_events2.default.getTouchPosition(e)),_events2.default.addEventsToDocument(u.getTouchEventMap()),_events2.default.pauseEvent(e)},_possibleConstructorReturn(u,e)}return t.propTypes={buffer:_propTypes2.default.number,className:_propTypes2.default.string,disabled:_propTypes2.default.bool,editable:_propTypes2.default.bool,max:_propTypes2.default.number,min:_propTypes2.default.number,onChange:_propTypes2.default.func,onDragStart:_propTypes2.default.func,onDragStop:_propTypes2.default.func,pinned:_propTypes2.default.bool,snaps:_propTypes2.default.bool,step:_propTypes2.default.number,style:_reactStyleProptype2.default,theme:_propTypes2.default.shape({container:_propTypes2.default.string,editable:_propTypes2.default.string,innerknob:_propTypes2.default.string,innerprogress:_propTypes2.default.string,input:_propTypes2.default.string,knob:_propTypes2.default.string,pinned:_propTypes2.default.string,pressed:_propTypes2.default.string,progress:_propTypes2.default.string,ring:_propTypes2.default.string,slider:_propTypes2.default.string,snap:_propTypes2.default.string,snaps:_propTypes2.default.string}),value:_propTypes2.default.number},t.defaultProps={buffer:0,className:"",editable:!1,max:100,min:0,onDragStart:function(){},onDragStop:function(){},pinned:!1,snaps:!1,step:.01,value:0},t},Slider=factory(_ProgressBar2.default,_Input2.default);exports.default=(0,_reactCssThemr.themr)(_identifiers.SLIDER)(Slider),exports.sliderFactory=factory,exports.Slider=Slider;