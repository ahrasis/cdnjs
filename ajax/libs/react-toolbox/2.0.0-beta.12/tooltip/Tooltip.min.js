"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,i=arguments[t];for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_reactCssThemr=require("react-css-themr"),_Portal=require("../hoc/Portal"),_Portal2=_interopRequireDefault(_Portal),_utils=require("../utils/utils"),_identifiers=require("../identifiers"),_events=require("../utils/events"),_events2=_interopRequireDefault(_events);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _objectWithoutProperties(e,t){var o,i={};for(o in e)0<=t.indexOf(o)||Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=e[o]);return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var POSITION={BOTTOM:"bottom",HORIZONTAL:"horizontal",LEFT:"left",RIGHT:"right",TOP:"top",VERTICAL:"vertical"},defaults={className:"",delay:0,hideOnClick:!0,passthrough:!0,showOnClick:!1,position:POSITION.VERTICAL,theme:{}},tooltipFactory=function(e){var e=_extends({},defaults,0<arguments.length&&void 0!==e?e:{}),t=e.className,o=e.delay,i=e.hideOnClick,n=e.showOnClick,d=e.passthrough,s=e.position,a=e.theme;return function(f){var e=(_inherits(r,_react.Component),_createClass(r,[{key:"componentWillUnmount",value:function(){this.tooltipNode&&_events2.default.removeEventListenerOnTransitionEnded(this.tooltipNode,this.onTransformEnd),this.timeout&&clearTimeout(this.timeout)}},{key:"getPosition",value:function(e){var t=this.props.tooltipPosition;if(t===POSITION.HORIZONTAL){var o=e.getBoundingClientRect(),i=(0,_utils.getViewport)().width;return o.left<i/2-o.width/2?POSITION.RIGHT:POSITION.LEFT}if(t!==POSITION.VERTICAL)return t;t=e.getBoundingClientRect(),e=(0,_utils.getViewport)().height;return t.top<e/2-t.height/2?POSITION.BOTTOM:POSITION.TOP}},{key:"activate",value:function(e){var t=this,o=e.top,i=e.left,e=e.position;this.timeout&&clearTimeout(this.timeout),this.setState({visible:!0,position:e}),this.timeout=setTimeout(function(){t.setState({active:!0,top:o,left:i})},this.props.tooltipDelay)}},{key:"deactivate",value:function(){this.timeout&&clearTimeout(this.timeout),this.state.active?(_events2.default.addEventListenerOnTransitionEnded(this.tooltipNode,this.onTransformEnd),this.setState({active:!1})):this.state.visible&&this.setState({visible:!1})}},{key:"calculatePosition",value:function(e){var t=this.getPosition(e),o=e.getBoundingClientRect(),i=o.top,n=o.left,r=o.height,s=o.width,e=window.scrollX||window.pageXOffset,o=window.scrollY||window.pageYOffset;return t===POSITION.BOTTOM?{top:i+r+o,left:n+s/2+e,position:t}:t===POSITION.TOP?{top:i+o,left:n+s/2+e,position:t}:t===POSITION.LEFT?{top:i+r/2+o,left:n+e,position:t}:t===POSITION.RIGHT?{top:i+r/2+o,left:n+s+e,position:t}:void 0}},{key:"render",value:function(){var t=this,e=this.state,o=e.active,i=e.left,n=e.top,r=e.position,s=e.visible,a="tooltip"+(r.charAt(0).toUpperCase()+r.slice(1)),l=this.props,p=l.children,u=l.className,c=l.theme,e=(l.onClick,l.onMouseEnter,l.onMouseLeave,l.tooltip),r=(l.tooltipDelay,l.tooltipHideOnClick,l.tooltipPosition,l.tooltipShowOnClick,_objectWithoutProperties(l,["children","className","theme","onClick","onMouseEnter","onMouseLeave","tooltip","tooltipDelay","tooltipHideOnClick","tooltipPosition","tooltipShowOnClick"])),l=(0,_classnames3.default)(c.tooltip,(_defineProperty(l={},c.tooltipActive,o),_defineProperty(l,c[a],c[a]),l)),u=_extends({},r,{className:u,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave}),u="string"!=typeof f&&d?_extends({},u,{theme:c}):u;return _react2.default.createElement(f,u,p,s&&_react2.default.createElement(_Portal2.default,null,_react2.default.createElement("span",{ref:function(e){t.tooltipNode=e},className:l,"data-react-toolbox":"tooltip",style:{top:n,left:i}},_react2.default.createElement("span",{className:c.tooltipInner},e))))}}]),r);function r(){var e,t;_classCallCheck(this,r);for(var o=arguments.length,i=Array(o),n=0;n<o;n++)i[n]=arguments[n];return(e=t=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(i)))).state={active:!1,position:t.props.tooltipPosition,visible:!1},t.onTransformEnd=function(e){"transform"===e.propertyName&&(_events2.default.removeEventListenerOnTransitionEnded(t.tooltipNode,t.onTransformEnd),t.setState({visible:!1}))},t.handleMouseEnter=function(e){t.activate(t.calculatePosition(e.currentTarget)),t.props.onMouseEnter&&t.props.onMouseEnter(e)},t.handleMouseLeave=function(e){t.deactivate(),t.props.onMouseLeave&&t.props.onMouseLeave(e)},t.handleClick=function(e){t.props.tooltipHideOnClick&&t.state.active&&t.deactivate(),t.props.tooltipShowOnClick&&!t.state.active&&t.activate(t.calculatePosition(e.currentTarget)),t.props.onClick&&t.props.onClick(e)},_possibleConstructorReturn(t,e)}return e.propTypes={children:_propTypes2.default.node,className:_propTypes2.default.string,onClick:_propTypes2.default.func,onMouseEnter:_propTypes2.default.func,onMouseLeave:_propTypes2.default.func,theme:_propTypes2.default.shape({tooltip:_propTypes2.default.string,tooltipActive:_propTypes2.default.string,tooltipWrapper:_propTypes2.default.string}),tooltip:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.node]),tooltipDelay:_propTypes2.default.number,tooltipHideOnClick:_propTypes2.default.bool,tooltipPosition:_propTypes2.default.oneOf(Object.keys(POSITION).map(function(e){return POSITION[e]})),tooltipShowOnClick:_propTypes2.default.bool},e.defaultProps={className:t,tooltipDelay:o,tooltipHideOnClick:i,tooltipPosition:s,tooltipShowOnClick:n},(0,_reactCssThemr.themr)(_identifiers.TOOLTIP,a)(e)}};exports.default=tooltipFactory;