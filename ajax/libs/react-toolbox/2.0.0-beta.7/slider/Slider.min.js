"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Slider=exports.sliderFactory=void 0;var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_reactStyleProptype=require("react-style-proptype"),_reactStyleProptype2=_interopRequireDefault(_reactStyleProptype),_reactCssThemr=require("react-css-themr"),_utils=require("../utils/utils"),_identifiers=require("../identifiers"),_events=require("../utils/events"),_events2=_interopRequireDefault(_events),_ProgressBar=require("../progress_bar/ProgressBar"),_ProgressBar2=_interopRequireDefault(_ProgressBar),_Input=require("../input/Input"),_Input2=_interopRequireDefault(_Input);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var factory=function(s,e){var t=(_inherits(o,_react.Component),_createClass(o,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),this.handleResize()}},{key:"componentWillReceiveProps",value:function(e){this.state.inputFocused&&this.props.value!==e.value&&this.setState({inputValue:this.valueForInput(e.value)})}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.inputFocused||!t.inputFocused}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),_events2.default.removeEventsFromDocument(this.getMouseEventMap()),_events2.default.removeEventsFromDocument(this.getTouchEventMap()),_events2.default.removeEventsFromDocument(this.getKeyboardEvents())}},{key:"getInput",value:function(){return this.inputNode&&this.inputNode.getWrappedInstance?this.inputNode.getWrappedInstance():this.inputNode}},{key:"getKeyboardEvents",value:function(){return{keydown:this.handleKeyDown}}},{key:"getMouseEventMap",value:function(){return{mousemove:this.handleMouseMove,mouseup:this.handleMouseUp}}},{key:"getTouchEventMap",value:function(){return{touchmove:this.handleTouchMove,touchend:this.handleTouchEnd}}},{key:"addToValue",value:function(e){var t=this.state.inputFocused?parseFloat(this.state.inputValue):this.props.value;(t=this.trimValue(t+e))!==this.props.value&&this.props.onChange(t)}},{key:"end",value:function(e){_events2.default.removeEventsFromDocument(e),this.setState({pressed:!1})}},{key:"knobOffset",value:function(){var e=this.props,t=e.max,n=e.min;return(e.value-n)/(t-n)*100}},{key:"move",value:function(e){e=this.positionToValue(e);e!==this.props.value&&this.props.onChange(e)}},{key:"positionToValue",value:function(e){var t=this.state,n=t.sliderStart,r=t.sliderLength,s=this.props,o=s.max,t=s.min,s=s.step,o=(e.x-n)/r*(o-t);return this.trimValue(Math.round(o/s)*s+t)}},{key:"start",value:function(e){var t=this;this.handleResize(null,function(){t.setState({pressed:!0}),t.props.onChange(t.positionToValue(e))})}},{key:"stepDecimals",value:function(){return(this.props.step.toString().split(".")[1]||[]).length}},{key:"trimValue",value:function(e){return e<this.props.min?this.props.min:e>this.props.max?this.props.max:(0,_utils.round)(e,this.stepDecimals())}},{key:"valueForInput",value:function(e){var t=this.stepDecimals();return 0<t?e.toFixed(t):e.toString()}},{key:"renderSnaps",value:function(){var t=this;if(this.props.snaps)return _react2.default.createElement("div",{className:this.props.theme.snaps},(0,_utils.range)(0,(this.props.max-this.props.min)/this.props.step).map(function(e){return _react2.default.createElement("div",{key:"span-"+e,className:t.props.theme.snap})}))}},{key:"renderInput",value:function(){var t=this;if(this.props.editable)return _react2.default.createElement(e,{ref:function(e){t.inputNode=e},className:this.props.theme.input,disabled:this.props.disabled,onFocus:this.handleInputFocus,onChange:this.handleInputChange,onBlur:this.handleInputBlur,value:this.state.inputFocused?this.state.inputValue:this.valueForInput(this.props.value)})}},{key:"render",value:function(){var t=this,e=this.props.theme,n={left:this.knobOffset()+"%"},r=(0,_classnames3.default)(e.slider,(_defineProperty(r={},e.editable,this.props.editable),_defineProperty(r,e.disabled,this.props.disabled),_defineProperty(r,e.pinned,this.props.pinned),_defineProperty(r,e.pressed,this.state.pressed),_defineProperty(r,e.ring,this.props.value===this.props.min),r),this.props.className);return _react2.default.createElement("div",{className:r,disabled:this.props.disabled,"data-react-toolbox":"slider",onBlur:this.handleSliderBlur,onFocus:this.handleSliderFocus,style:this.props.style,tabIndex:"0"},_react2.default.createElement("div",{ref:function(e){t.sliderNode=e},className:e.container,onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart},_react2.default.createElement("div",{ref:function(e){t.knobNode=e},className:e.knob,onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart,style:n},_react2.default.createElement("div",{className:e.innerknob,"data-value":parseInt(this.props.value,10)})),_react2.default.createElement("div",{className:e.progress},_react2.default.createElement(s,{disabled:this.props.disabled,ref:function(e){t.progressbarNode=e},className:e.innerprogress,max:this.props.max,min:this.props.min,mode:"determinate",value:this.props.value}),this.renderSnaps())),this.renderInput())}}]),o);function o(){var e,s;_classCallCheck(this,o);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=s=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(n)))).state={inputFocused:!1,inputValue:null,sliderLength:0,sliderStart:0},s.handleInputFocus=function(){s.setState({inputFocused:!0,inputValue:s.valueForInput(s.props.value)})},s.handleInputChange=function(e){s.setState({inputValue:e})},s.handleInputBlur=function(e){var t=s.state.inputValue||0;s.setState({inputFocused:!1,inputValue:null},function(){s.props.onChange(s.trimValue(t),e)})},s.handleKeyDown=function(e){-1!==[13,27].indexOf(e.keyCode)&&s.getInput().blur(),38===e.keyCode&&s.addToValue(s.props.step),40===e.keyCode&&s.addToValue(-s.props.step)},s.handleMouseDown=function(e){s.state.inputFocused&&s.getInput().blur(),_events2.default.addEventsToDocument(s.getMouseEventMap()),s.start(_events2.default.getMousePosition(e)),_events2.default.pauseEvent(e)},s.handleMouseMove=function(e){_events2.default.pauseEvent(e),s.move(_events2.default.getMousePosition(e))},s.handleMouseUp=function(){s.end(s.getMouseEventMap())},s.handleResize=function(e,t){var n=_reactDom2.default.findDOMNode(s.progressbarNode).getBoundingClientRect(),r=n.left,n=n.right,t=t||function(){};s.setState({sliderStart:r,sliderLength:n-r},t)},s.handleSliderBlur=function(){_events2.default.removeEventsFromDocument(s.getKeyboardEvents())},s.handleSliderFocus=function(){_events2.default.addEventsToDocument(s.getKeyboardEvents())},s.handleTouchEnd=function(){s.end(s.getTouchEventMap())},s.handleTouchMove=function(e){s.move(_events2.default.getTouchPosition(e))},s.handleTouchStart=function(e){s.state.inputFocused&&s.getInput().blur(),s.start(_events2.default.getTouchPosition(e)),_events2.default.addEventsToDocument(s.getTouchEventMap()),_events2.default.pauseEvent(e)},_possibleConstructorReturn(s,e)}return t.propTypes={className:_react.PropTypes.string,disabled:_react.PropTypes.bool,editable:_react.PropTypes.bool,max:_react.PropTypes.number,min:_react.PropTypes.number,onChange:_react.PropTypes.func,pinned:_react.PropTypes.bool,snaps:_react.PropTypes.bool,step:_react.PropTypes.number,style:_reactStyleProptype2.default,theme:_react.PropTypes.shape({container:_react.PropTypes.string,editable:_react.PropTypes.string,innerknob:_react.PropTypes.string,innerprogress:_react.PropTypes.string,input:_react.PropTypes.string,knob:_react.PropTypes.string,pinned:_react.PropTypes.string,pressed:_react.PropTypes.string,progress:_react.PropTypes.string,ring:_react.PropTypes.string,slider:_react.PropTypes.string,snap:_react.PropTypes.string,snaps:_react.PropTypes.string}),value:_react.PropTypes.number},t.defaultProps={className:"",editable:!1,max:100,min:0,pinned:!1,snaps:!1,step:.01,value:0},t},Slider=factory(_ProgressBar2.default,_Input2.default);exports.default=(0,_reactCssThemr.themr)(_identifiers.SLIDER)(Slider),exports.sliderFactory=factory,exports.Slider=Slider;