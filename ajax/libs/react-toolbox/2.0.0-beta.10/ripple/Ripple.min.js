"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function p(e,t){for(var r=0;r<t.length;r++){var p=t[r];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(e,p.key,p)}}return function(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),e}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,p=arguments[t];for(r in p)Object.prototype.hasOwnProperty.call(p,r)&&(e[r]=p[r])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_reactCssThemr=require("react-css-themr"),_dissoc=require("ramda/src/dissoc"),_dissoc2=_interopRequireDefault(_dissoc),_identifiers=require("../identifiers"),_events=require("../utils/events"),_events2=_interopRequireDefault(_events),_prefixer=require("../utils/prefixer"),_prefixer2=_interopRequireDefault(_prefixer);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _objectWithoutProperties(e,t){var r,p={};for(r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(p[r]=e[r]);return p}var defaults={centered:!1,className:"",multiple:!0,passthrough:!0,spread:2,theme:{}},rippleFactory=function(e){var e=_extends({},defaults,0<arguments.length&&void 0!==e?e:{}),t=e.centered,r=e.className,p=e.multiple,u=e.passthrough,i=e.spread,s=e.theme,a=_objectWithoutProperties(e,["centered","className","multiple","passthrough","spread","theme"]);return function(l){var e=(_inherits(n,_react.Component),_createClass(n,[{key:"componentDidUpdate",value:function(e,t){Object.keys(t.ripples).length<Object.keys(this.state.ripples).length&&this.addRippleRemoveEventListener(this.getLastKey())}},{key:"componentWillUnmount",value:function(){var t=this;Object.keys(this.state.ripples).forEach(function(e){t.state.ripples[e].endRipple()})}},{key:"getDescriptor",value:function(e,t){var r=_reactDom2.default.findDOMNode(this).getBoundingClientRect(),p=r.left,i=r.top,n=r.height,s=r.width,o=this.props,r=o.rippleCentered;return{left:r?0:e-p-s/2,top:r?0:t-i-n/2,width:s*o.rippleSpread}}},{key:"getNextKey",value:function(){return this.currentCount=this.currentCount?this.currentCount+1:1,"ripple"+this.currentCount}},{key:"getLastKey",value:function(){return"ripple"+this.currentCount}},{key:"rippleShouldTrigger",value:function(e){var t=!!e||!this.touchCache;return this.touchCache=e,t}},{key:"animateRipple",value:function(e,t,r){var p,i,n,s,o=this;this.rippleShouldTrigger(r)&&(p=(i=this.getDescriptor(e,t)).top,e=i.left,t=i.width,i=0===Object.keys(this.state.ripples).length,n=this.props.rippleMultiple||i?this.getNextKey():this.getLastKey(),r={active:!1,restarting:!0,top:p,left:e,width:t,endRipple:this.addRippleDeactivateEventListener(r,n)},s={active:!0,restarting:!1},r=_extends({},this.state.ripples,_defineProperty({},n,r)),this.setState({ripples:r},function(){o.rippleNodes[n]&&o.rippleNodes[n].offsetWidth,o.setState({ripples:_extends({},o.state.ripples,_defineProperty({},n,Object.assign({},o.state.ripples[n],s)))})}))}},{key:"addRippleRemoveEventListener",value:function(r){var p=this,e=this.rippleNodes[r];_events2.default.addEventListenerOnTransitionEnded(e,function e(t){"opacity"===t.propertyName&&(p.props.onRippleEnded&&p.props.onRippleEnded(t),_events2.default.removeEventListenerOnTransitionEnded(p.rippleNodes[r],e),delete p.rippleNodes[r],p.setState({ripples:(0,_dissoc2.default)(r,p.state.ripples)}))})}},{key:"addRippleDeactivateEventListener",value:function(e,t){e=e?"touchend":"mouseup",t=this.createRippleDeactivateCallback(e,t);return document.addEventListener(e,t),t}},{key:"createRippleDeactivateCallback",value:function(t,r){var p=this;return function e(){document.removeEventListener(t,e),p.setState({ripples:_extends({},p.state.ripples,_defineProperty({},r,Object.assign({},p.state.ripples[r],{active:!1})))})}}},{key:"renderRipple",value:function(t,e,r){var p=this,i=r.active,n=r.left,s=r.restarting,o=r.top,r=r.width,n="translate3d("+(-r/2+n)+"px, "+(-r/2+o)+"px, 0) scale("+(s?0:1)+")",e=(0,_classnames3.default)(this.props.theme.ripple,(_defineProperty(o={},this.props.theme.rippleActive,i),_defineProperty(o,this.props.theme.rippleRestarting,s),o),e);return _react2.default.createElement("span",_extends({key:t,"data-react-toolbox":"ripple",className:this.props.theme.rippleWrapper},a),_react2.default.createElement("span",{className:e,ref:function(e){e&&(p.rippleNodes[t]=e)},style:(0,_prefixer2.default)({transform:n},{width:r,height:r})}))}},{key:"render",value:function(){var t=this,e=this.props,r=e.children,p=e.disabled,i=e.ripple,n=(e.onRippleEnded,e.rippleCentered,e.rippleClassName),s=(e.rippleMultiple,e.rippleSpread,e.theme),o=_objectWithoutProperties(e,["children","disabled","ripple","onRippleEnded","rippleCentered","rippleClassName","rippleMultiple","rippleSpread","theme"]),a=this.state.ripples,e=Object.keys(a).map(function(e){return t.renderRipple(e,n,a[e])}),o=_extends({onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart},o),o=u?_extends({},o,{theme:s,disabled:p}):o;return i?_react2.default.createElement(l,o,[r,e]):_react2.default.createElement(l,o,r)}}]),n);function n(){var e,r;_classCallCheck(this,n);for(var t=arguments.length,p=Array(t),i=0;i<t;i++)p[i]=arguments[i];return(e=r=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(p)))).state={ripples:{}},r.rippleNodes={},r.doRipple=function(){return!r.props.disabled&&r.props.ripple},r.handleMouseDown=function(e){var t;r.props.onMouseDown&&r.props.onMouseDown(e),r.doRipple()&&(e=(t=_events2.default.getMousePosition(e)).x,t=t.y,r.animateRipple(e,t,!1))},r.handleTouchStart=function(e){var t;r.props.onTouchStart&&r.props.onTouchStart(e),r.doRipple()&&(e=(t=_events2.default.getTouchPosition(e)).x,t=t.y,r.animateRipple(e,t,!0))},_possibleConstructorReturn(r,e)}return e.propTypes={children:_propTypes2.default.node,disabled:_propTypes2.default.bool,onMouseDown:_propTypes2.default.func,onRippleEnded:_propTypes2.default.func,onTouchStart:_propTypes2.default.func,ripple:_propTypes2.default.bool,rippleCentered:_propTypes2.default.bool,rippleClassName:_propTypes2.default.string,rippleMultiple:_propTypes2.default.bool,rippleSpread:_propTypes2.default.number,theme:_propTypes2.default.shape({ripple:_propTypes2.default.string,rippleActive:_propTypes2.default.string,rippleRestarting:_propTypes2.default.string,rippleWrapper:_propTypes2.default.string})},e.defaultProps={disabled:!1,ripple:!0,rippleCentered:t,rippleClassName:r,rippleMultiple:p,rippleSpread:i},(0,_reactCssThemr.themr)(_identifiers.RIPPLE,s)(e)}};exports.default=rippleFactory;