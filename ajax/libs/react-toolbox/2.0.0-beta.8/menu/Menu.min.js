"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Menu=exports.menuFactory=void 0;var _createClass=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_reactCssThemr=require("react-css-themr"),_identifiers=require("../identifiers"),_utils=require("../utils"),_utils2=require("../utils/utils"),_MenuItem=require("./MenuItem"),_MenuItem2=_interopRequireDefault(_MenuItem);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var POSITION={AUTO:"auto",STATIC:"static",TOP_LEFT:"topLeft",TOP_RIGHT:"topRight",BOTTOM_LEFT:"bottomLeft",BOTTOM_RIGHT:"bottomRight"},factory=function(i){var e=(_inherits(n,_react.Component),_createClass(n,[{key:"componentDidMount",value:function(){var o=this;this.positionTimeoutHandle=setTimeout(function(){var e=o.menuNode.getBoundingClientRect(),t=e.width,i=e.height,e=o.props.position===POSITION.AUTO?o.calculatePosition():o.props.position;o.setState({position:e,width:t,height:i})})}},{key:"componentWillReceiveProps",value:function(e){var t,i=this;this.props.position!==e.position&&(t=e.position===POSITION.AUTO?this.calculatePosition():e.position,this.setState({position:t})),this.props.active||!e.active||this.state.active||(e.position===POSITION.AUTO?(t=this.calculatePosition(),this.state.position!==t?this.setState({position:t,active:!1},function(){i.activateTimeoutHandle=setTimeout(function(){i.show()},20)}):this.show()):this.show()),this.props.active&&!e.active&&this.state.active&&this.hide()}},{key:"componentWillUpdate",value:function(e,t){!this.state.active&&t.active&&_utils.events.addEventsToDocument({click:this.handleDocumentClick,touchstart:this.handleDocumentClick})}},{key:"componentDidUpdate",value:function(e,t){t.active&&!this.state.active?(this.props.onHide&&this.props.onHide(),_utils.events.removeEventsFromDocument({click:this.handleDocumentClick,touchstart:this.handleDocumentClick})):!t.active&&this.state.active&&this.props.onShow&&this.props.onShow()}},{key:"componentWillUnmount",value:function(){this.state.active&&_utils.events.removeEventsFromDocument({click:this.handleDocumentClick,touchstart:this.handleDocumentClick}),clearTimeout(this.positionTimeoutHandle),clearTimeout(this.activateTimeoutHandle)}},{key:"getMenuStyle",value:function(){var e=this.state,t=e.width,i=e.height,e=e.position;if(e!==POSITION.STATIC){if(this.state.active)return{clip:"rect(0 "+t+"px "+i+"px 0)"};if(e===POSITION.TOP_RIGHT)return{clip:"rect(0 "+t+"px 0 "+t+"px)"};if(e===POSITION.BOTTOM_RIGHT)return{clip:"rect("+i+"px "+t+"px "+i+"px "+t+"px)"};if(e===POSITION.BOTTOM_LEFT)return{clip:"rect("+i+"px 0 "+i+"px 0)"};if(e===POSITION.TOP_LEFT)return{clip:"rect(0 0 0 0)"}}}},{key:"getRootStyle",value:function(){return this.state.position!==POSITION.STATIC?{width:this.state.width,height:this.state.height}:void 0}},{key:"calculatePosition",value:function(){var e=_reactDom2.default.findDOMNode(this).parentNode;if(e){var t=e.getBoundingClientRect(),i=t.top,o=t.left,r=t.height,e=t.width,t=(0,_utils2.getViewport)();return(i<t.height/2-r/2?"top":"bottom")+(o<t.width/2-e/2?"Left":"Right")}}},{key:"show",value:function(){var e=this.menuNode.getBoundingClientRect(),t=e.width,e=e.height;this.setState({active:!0,width:t,height:e})}},{key:"hide",value:function(){this.setState({active:!1})}},{key:"renderItems",value:function(){var t=this;return _react2.default.Children.map(this.props.children,function(e){return e&&(e.type===i?_react2.default.cloneElement(e,{ripple:e.props.ripple||t.props.ripple,selected:void 0!==e.props.value&&t.props.selectable&&e.props.value===t.props.selected,onClick:t.handleSelect.bind(t,e)}):_react2.default.cloneElement(e))})}},{key:"render",value:function(){var t=this,e=this.props.theme,i={width:this.state.width,height:this.state.height},o=(0,_classnames3.default)([e.menu,e[this.state.position]],(_defineProperty(o={},e.active,this.state.active),_defineProperty(o,e.rippled,this.state.rippled),o),this.props.className);return _react2.default.createElement("div",{"data-react-toolbox":"menu",className:o,style:this.getRootStyle()},this.props.outline?_react2.default.createElement("div",{className:e.outline,style:i}):null,_react2.default.createElement("ul",{ref:function(e){t.menuNode=e},className:e.menuInner,style:this.getMenuStyle()},this.renderItems()))}}]),n);function n(){var e,r;_classCallCheck(this,n);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=r=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(i)))).state={active:r.props.active,rippled:!1},r.handleDocumentClick=function(e){r.state.active&&!_utils.events.targetIsDescendant(e,_reactDom2.default.findDOMNode(r))&&r.setState({active:!1,rippled:!1})},r.handleSelect=function(e,t){var e=e.props,i=e.value,o=e.onClick;o&&t.persist(),r.setState({active:!1,rippled:r.props.ripple},function(){o&&o(t),r.props.onSelect&&r.props.onSelect(i)})},_possibleConstructorReturn(r,e)}return e.propTypes={active:_react.PropTypes.bool,children:_react.PropTypes.node,className:_react.PropTypes.string,onHide:_react.PropTypes.func,onSelect:_react.PropTypes.func,onShow:_react.PropTypes.func,outline:_react.PropTypes.bool,position:_react.PropTypes.oneOf(Object.keys(POSITION).map(function(e){return POSITION[e]})),ripple:_react.PropTypes.bool,selectable:_react.PropTypes.bool,selected:_react.PropTypes.node,theme:_react.PropTypes.shape({active:_react.PropTypes.string,bottomLeft:_react.PropTypes.string,bottomRight:_react.PropTypes.string,menu:_react.PropTypes.string,menuInner:_react.PropTypes.string,outline:_react.PropTypes.string,rippled:_react.PropTypes.string,static:_react.PropTypes.string,topLeft:_react.PropTypes.string,topRight:_react.PropTypes.string})},e.defaultProps={active:!1,outline:!0,position:POSITION.STATIC,ripple:!0,selectable:!0},e},Menu=factory(_MenuItem2.default);exports.default=(0,_reactCssThemr.themr)(_identifiers.MENU)(Menu),exports.menuFactory=factory,exports.Menu=Menu;