"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.eventMixin=exports.eventHook=void 0;const uberproto_1=__importDefault(require("uberproto")),events_1=require("events");function eventHook(){return function(e){const{app:t,service:n,method:o,event:i,type:r,result:s}=e,v=null===i?i:t.eventMappings[o],p=n._hookEvents&&-1!==n._hookEvents.indexOf(v);if(v&&p&&"error"!==r){(Array.isArray(s)?s:[s]).forEach(t=>n.emit(v,t,e))}}}function eventMixin(e){if(e._serviceEvents)return;const t=this,n="function"==typeof e.on&&"function"==typeof e.emit;"function"!=typeof e.mixin||n||e.mixin(events_1.EventEmitter.prototype),Object.defineProperties(e,{_serviceEvents:{value:Array.isArray(e.events)?e.events.slice():[]},_hookEvents:{value:[]}}),Object.keys(t.eventMappings).forEach(n=>{const o=t.eventMappings[n],i=-1!==e._serviceEvents.indexOf(o);"function"!=typeof e[n]||i||(e._serviceEvents.push(o),e._hookEvents.push(o))})}function default_1(){return function(e){Object.assign(e,{eventMappings:{create:"created",update:"updated",remove:"removed",patch:"patched"}}),e.hooks({finally:eventHook()}),uberproto_1.default.mixin(events_1.EventEmitter.prototype,e),e.mixins.push(eventMixin)}}exports.eventHook=eventHook,exports.eventMixin=eventMixin,exports.default=default_1;