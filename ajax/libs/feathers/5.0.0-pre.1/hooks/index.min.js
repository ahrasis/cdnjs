"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.activateHooks=void 0;const hookCommons=__importStar(require("./commons")),hooks_1=require("@feathersjs/hooks"),base_1=require("./base"),baseHooks=[base_1.assignArguments,base_1.validate],{getHooks:getHooks,enableHooks:enableHooks,ACTIVATE_HOOKS:ACTIVATE_HOOKS,finallyWrapper:finallyWrapper,errorWrapper:errorWrapper,wrap:wrap}=hookCommons;function getMiddlewareOptions(e,t,o){const r=t.methods[o];return{params:r,defaults:r.find(e=>"params"===e)?{params:{}}:null,props:{app:e,service:t,type:"before",get path(){return t&&e&&e.services?Object.keys(e.services).find(o=>e.services[o]===t):null}}}}function getCollector(e,t,o){return function(){const r=this._parent&&this._parent.getMiddleware();let s;s=r&&this._middleware?r.concat(this._middleware):r||this._middleware||[];const n={async:getHooks(e,t,"async",o),before:getHooks(e,t,"before",o),after:getHooks(e,t,"after",o,!0),error:getHooks(e,t,"error",o,!0),finally:getHooks(e,t,"finally",o,!0)};return[...finallyWrapper(n.finally),...errorWrapper(n.error),...baseHooks,...s,...wrap(n)]}}function withHooks(e,t,o){const r=o.reduce((o,r)=>{if("function"!=typeof t[r])return o;const s=hooks_1.middleware([],getMiddlewareOptions(e,t,r));return s.getMiddleware=getCollector(e,t,r),o[r]=s,o},{});hooks_1.hooks(t,r)}function mixinMethod(){const e=Array.from(arguments),t=(!0===e[e.length-1]||e[e.length-1]instanceof hooks_1.HookContext)&&e.pop(),o=t instanceof hooks_1.HookContext?t:this._super.createContext();return this._super.call(this,...e,o).then(()=>t?o:o.result).catch(()=>void 0!==o.error&&void 0===o.result?Promise.reject(t?o:o.error):t?o:o.result)}const hookMixin=exports.hookMixin=function(e){if("function"==typeof e.hooks)return;e.methods=Object.getOwnPropertyNames(e).filter(t=>"function"==typeof e[t]&&e[t][ACTIVATE_HOOKS]).reduce((t,o)=>(t[o]=e[o][ACTIVATE_HOOKS],t),e.methods||{}),Object.assign(e.methods,{find:["params"],get:["id","params"],create:["data","params"],update:["id","data","params"],patch:["id","data","params"],remove:["id","params"]});const t=Object.keys(e.methods);withHooks(this,e,t);const o=t.reduce((t,o)=>"function"!=typeof e[o]?t:(t[o]=mixinMethod,t),{});enableHooks(e,t,this.hookTypes),e.mixin(o)};function default_1(){return function(e){Object.assign(e,{hookTypes:["async","before","after","error","finally"]}),enableHooks(e,e.methods,e.hookTypes),e.mixins.push(hookMixin)}}function activateHooks(e){return t=>(Object.defineProperty(t,ACTIVATE_HOOKS,{value:e}),t)}exports.default=default_1,exports.activateHooks=activateHooks;