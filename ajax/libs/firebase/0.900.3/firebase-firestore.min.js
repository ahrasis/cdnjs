!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i="FirebaseError",r=function(t){function e(n,s,r){var a=t.call(this,s)||this;return a.code=n,a.customData=r,a.name=i,Object.setPrototypeOf(a,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,o.prototype.create),a}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",h=this.serviceName+": "+a+" ("+i+").";return new r(i,h,s)},t}();var a,h,u=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(h||(h={}));var f={debug:h.DEBUG,verbose:h.VERBOSE,info:h.INFO,warn:h.WARN,error:h.ERROR,silent:h.SILENT},d=h.INFO,p=((a={})[h.DEBUG]="log",a[h.VERBOSE]="log",a[h.INFO]="info",a[h.WARN]="warn",a[h.ERROR]="error",a),g=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var i=(new Date).toISOString(),r=p[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[r].apply(console,l(["["+i+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in h))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.DEBUG],t)),this._logHandler.apply(this,l([this,h.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.VERBOSE],t)),this._logHandler.apply(this,l([this,h.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.INFO],t)),this._logHandler.apply(this,l([this,h.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.WARN],t)),this._logHandler.apply(this,l([this,h.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.ERROR],t)),this._logHandler.apply(this,l([this,h.ERROR],t))},t}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=E||{},I=b||self;function T(){}function _(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var N="closure_uid_"+(1e9*Math.random()>>>0),x=0;function S(t,e,n){return t.call.apply(t.bind,arguments)}function k(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function D(t,e,n){return(D=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?S:k).apply(null,arguments)}function R(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function C(){return Date.now()}function O(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}function L(){this.j=this.j,this.i=this.i}L.prototype.j=!1,L.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,N)&&t[N]||(t[N]=++x)})(this)},L.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var P=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var s=t.length,i="string"==typeof t?t.split(""):t,r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function V(t){return Array.prototype.concat.apply([],arguments)}function M(t){var e=t.length;if(0<e){for(var n=Array(e),s=0;s<e;s++)n[s]=t[s];return n}return[]}function q(t){return/^[\s\xa0]*$/.test(t)}var F,$=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function j(t,e){return-1!=t.indexOf(e)}function B(t,e){return t<e?-1:t>e?1:0}t:{var G=I.navigator;if(G){var z=G.userAgent;if(z){F=z;break t}}F=""}function K(t,e,n){for(var s in t)e.call(n,t[s],s,t)}function H(t){var e={};for(var n in t)e[n]=t[n];return e}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function W(t,e){for(var n,s,i=1;i<arguments.length;i++){for(n in s=arguments[i])t[n]=s[n];for(var r=0;r<X.length;r++)n=X[r],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Y(t){return Y[" "](t),t}Y[" "]=T;var Q,J,Z=j(F,"Opera"),tt=j(F,"Trident")||j(F,"MSIE"),et=j(F,"Edge"),nt=et||tt,st=j(F,"Gecko")&&!(j(F.toLowerCase(),"webkit")&&!j(F,"Edge"))&&!(j(F,"Trident")||j(F,"MSIE"))&&!j(F,"Edge"),it=j(F.toLowerCase(),"webkit")&&!j(F,"Edge");function rt(){var t=I.document;return t?t.documentMode:void 0}t:{var ot="",at=(J=F,st?/rv:([^\);]+)(\)|;)/.exec(J):et?/Edge\/([\d\.]+)/.exec(J):tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(J):it?/WebKit\/(\S+)/.exec(J):Z?/(?:Version)[ \/]?(\S+)/.exec(J):void 0);if(at&&(ot=at?at[1]:""),tt){var ht=rt();if(null!=ht&&ht>parseFloat(ot)){Q=String(ht);break t}}Q=ot}var ut,ct={};function lt(t){return function(t,e){var n=ct;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=$(String(Q)).split("."),s=$(String(t)).split("."),i=Math.max(n.length,s.length),r=0;0==e&&r<i;r++){var o=n[r]||"",a=s[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=B(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||B(0==o[2].length,0==a[2].length)||B(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(I.document&&tt){var ft=rt();ut=ft||(parseInt(Q,10)||void 0)}else ut=void 0;var dt=ut,pt=!tt||9<=Number(dt),gt=tt&&!lt("9"),mt=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{I.addEventListener("test",T,e),I.removeEventListener("test",T,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(st){t:{try{Y(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:vt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}yt.prototype.b=function(){this.defaultPrevented=!0},O(wt,yt);var vt={2:"touch",3:"pen",4:"mouse"};wt.prototype.b=function(){wt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var bt="closure_listenable_"+(1e6*Math.random()|0),Et=0;function It(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Tt(t){this.src=t,this.a={},this.b=0}function _t(t,e){var n=e.type;if(n in t.a){var s,i=t.a[n],r=P(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(It(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.Y&&r.listener==e&&r.capture==!!n&&r.ca==s)return i}return-1}Tt.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.a[r])||(t=this.a[r]=[],this.b++);var o=At(t,e,s,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ca=i,this.key=++Et,this.Y=this.Z=!1}(e,this.src,r,!!s,i)).Z=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),xt={};function St(t,e,n,s,i){if(s&&s.once)return function t(e,n,s,i,r){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);return null}s=Ut(s);return e&&e[bt]?e.wa(n,s,A(i)?!!i.capture:!!i,r):kt(e,n,s,!0,i,r)}(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)St(t,e[r],n,s,i);return null}return n=Ut(n),t&&t[bt]?t.va(e,n,A(s)?!!s.capture:!!s,i):kt(t,e,n,!1,s,i)}function kt(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=A(i)?!!i.capture:!!i;if(o&&!pt)return null;var a=Lt(t);if(a||(t[Nt]=a=new Tt(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){var t=Ot,e=pt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)mt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function Dt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[bt])_t(e.c,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Rt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Lt(e))?(_t(n,t),0==n.b&&(n.src=null,e[Nt]=null)):It(t)}}}function Rt(t){return t in xt?xt[t]:xt[t]="on"+t}function Ct(t,e){var n=t.listener,s=t.ca||t.src;return t.Z&&Dt(t),n.call(s,e)}function Ot(t,e){if(t.Y)return!0;if(!pt){if(!e)t:{e=["window","event"];for(var n=I,s=0;s<e.length;s++)if(null==(n=n[e[s]])){e=null;break t}e=n}return Ct(t,e=new wt(e,this))}return Ct(t,new wt(e,this))}function Lt(t){return(t=t[Nt])instanceof Tt?t:null}var Pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==typeof t?t:(t[Pt]||(t[Pt]=function(e){return t.handleEvent(e)}),t[Pt])}function Vt(){L.call(this),this.c=new Tt(this),this.J=this,this.C=null}function Mt(t,e){var n,s=t.C;if(s)for(n=[];s;s=s.C)n.push(s);if(t=t.J,s=e.type||e,"string"==typeof e)e=new yt(e,t);else if(e instanceof yt)e.target=e.target||t;else{var i=e;W(e=new yt(s,t),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.a=n[r];i=qt(o,s,!0,e)&&i}if(i=qt(o=e.a=t,s,!0,e)&&i,i=qt(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)i=qt(o=e.a=n[r],s,!1,e)&&i}function qt(t,e,n,s){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.Y&&o.capture==n){var a=o.listener,h=o.ca||o.src;o.Z&&_t(t.c,o),i=!1!==a.call(h,s)&&i}}return i&&!s.defaultPrevented}O(Vt,L),Vt.prototype[bt]=!0,(v=Vt.prototype).addEventListener=function(t,e,n,s){St(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){!function t(e,n,s,i,r){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);else i=A(i)?!!i.capture:!!i,s=Ut(s),e&&e[bt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(s=At(o=e.a[n],s,i,r))&&(It(o[s]),Array.prototype.splice.call(o,s,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Lt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,s,i,r)),(s=-1<e?n[e]:null)&&Dt(s))}(this,t,e,n,s)},v.G=function(){if(Vt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],s=0;s<n.length;s++)It(n[s]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,s){return this.c.add(String(t),e,!1,n,s)},v.wa=function(t,e,n,s){return this.c.add(String(t),e,!0,n,s)};var Ft=I.JSON.stringify;function $t(){this.b=this.a=null}var jt,Bt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new zt},function(t){t.reset()});function Gt(){var t=Wt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function zt(){this.next=this.b=this.a=null}function Kt(t){I.setTimeout(function(){throw t},0)}function Ht(t,e){jt||function(){var t=I.Promise.resolve(void 0);jt=function(){t.then(Yt)}}(),Xt||(jt(),Xt=!0),Wt.add(t,e)}$t.prototype.add=function(t,e){var n=Bt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},zt.prototype.reset=function(){this.next=this.b=this.a=null};var Xt=!1,Wt=new $t;function Yt(){for(var t;t=Gt();){try{t.a.call(t.b)}catch(t){Kt(t)}var e=Bt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Xt=!1}function Qt(t,e){Vt.call(this),this.b=t||1,this.a=e||I,this.f=D(this.Za,this),this.g=C()}function Jt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==typeof t)n&&(t=D(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=D(t.handleEvent,t)}return 2147483647<Number(e)?-1:I.setTimeout(t,e||0)}O(Qt,Vt),(v=Qt.prototype).aa=!1,v.M=null,v.Za=function(){if(this.aa){var t=C()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Mt(this,"tick"),this.aa&&(Jt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=C())},v.G=function(){Qt.X.G.call(this),Jt(this),delete this.a};var te=function(t){function e(e,n){var s=t.call(this)||this;return s.g=e,s.h=n,s.b=null,s.c=!1,s.a=null,s}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(I.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(L);function ee(t){L.call(this),this.b=t,this.a={}}O(ee,L);var ne=[];function se(t,e,n,s){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var r=St(e,n[i],s||t.handleEvent,!1,t.b||t);if(!r)break;t.a[r.key]=r}}function ie(t){K(t.a,function(t,e){this.a.hasOwnProperty(e)&&Dt(t)},t),t.a={}}function re(){this.a=!0}function oe(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ee.prototype.G=function(){ee.X.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},re.prototype.info=function(){};var ae={},he=null;function ue(){return he=he||new Vt}function ce(t){yt.call(this,ae.Fa,t)}function le(t){var e=ue();Mt(e,new ce(e,t))}function fe(t,e){yt.call(this,ae.STAT_EVENT,t),this.stat=e}function de(t){var e=ue();Mt(e,new fe(e,t))}function pe(t){yt.call(this,ae.Ga,t)}function ge(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){t()},e)}ae.Fa="serverreachability",O(ce,yt),ae.STAT_EVENT="statevent",O(fe,yt),ae.Ga="timingevent",O(pe,yt);var me={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},ye={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function we(){}function ve(t){var e;return(e=t.a)||(e=t.a={}),e}function be(){}we.prototype.a=null;var Ee,Ie={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Te(){yt.call(this,"d")}function _e(){yt.call(this,"c")}function Ae(){}function Ne(t,e,n,s){this.g=t,this.c=e,this.f=n,this.S=s||1,this.J=new ee(this),this.P=xe,t=nt?125:void 0,this.R=new Qt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}O(Te,yt),O(_e,yt),O(Ae,we),Ee=new Ae;var xe=45e3,Se={},ke={};function De(t,e,n){t.H=1,t.i=Je(Ke(e)),t.j=n,t.I=!0,Re(t,null)}function Re(t,e){t.u=C(),Le(t),t.l=Ke(t.i);var n=t.l,s=t.S;Array.isArray(s)||(s=[String(s)]),fn(n.b,"t",s),t.D=0,t.a=rs(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(D(t.Ca,t,t.a),t.O)),se(t.J,t.a,"readystatechange",t.Xa),e=t.B?H(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),le(1),function(t,e,n,s,i,r){t.info(function(){if(t.a)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var u=a[h].split("=");if(1<u.length){var c=u[0];u=u[1];var l=c.split("_");o=2<=l.length&&"type"==l[1]?o+(c+"=")+u+"&":o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.S,t.j)}function Ce(t,e,n){for(var s=!0;!t.A&&t.D<n.length;){var i=Oe(t,n);if(i==ke){4==e&&(t.h=4,de(14),s=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(i==Se){t.h=4,de(15),oe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}oe(t.c,t.f,i,null),qe(t,i)}4==e&&0==n.length&&(t.h=1,de(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(e),e.F=!0,de(11))):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Me(t),Ve(t))}function Oe(t,e){var n=t.D,s=e.indexOf("\n",n);return-1==s?ke:(n=Number(e.substring(n,s)),isNaN(n)?Se:(s+=1)+n>e.length?ke:(e=e.substr(s,n),t.D=s+n,e))}function Le(t){t.T=C()+t.P,Pe(t,t.P)}function Pe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ge(D(t.Va,t),e)}function Ue(t){t.o&&(I.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||ts(t.g,t)}function Me(t){Ue(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Jt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function qe(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||vn(n.b,t)))if(n.I=t.N,!t.C&&vn(n.b,t)&&3==n.v){try{var s=n.ka.a.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Zn(n),jn(n)}Yn(n),de(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ge(D(n.Sa,n),6e3));if(1>=wn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else ns(n,11)}else if((t.C||n.a==t)&&Zn(n),!q(e))for(e=s=n.ka.a.parse(e),s=0;s<e.length;s++)if(i=e[s],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var r=i[3];null!=r&&(n.ha=r,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var h=1.5*a;n.D=h,n.c.info("backChannelRequestTimeoutMs_="+h)}h=n;var u=t.a;if(u){var c=u.a?u.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var l=h.b;!l.a&&(j(c,"spdy")||j(c,"quic")||j(c,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(bn(l,l.b),l.b=null))}if(h.A){var f=u.a?u.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(h.na=f,Qe(h.B,h.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=C()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((h=n).la=is(h,h.C?h.ga:null,h.fa),d.C){En(h.b,d);var p=d,g=h.D;g&&p.setTimeout(g),p.o&&(Ue(p),Le(p)),h.a=d}else Wn(h);0<n.g.length&&zn(n)}else"stop"!=i[0]&&"close"!=i[0]||ns(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ns(n,7):$n(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);le(4)}catch(t){}}function Fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_(t)||"string"==typeof t)U(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(_(t)||"string"==typeof t){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;i=(s=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(_(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t)).length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function $e(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof $e)for(n=t.L(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var s=t.a[e];Be(t.b,s)&&(t.a[n++]=s),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Be(i,s=t.a[e])||(t.a[n++]=s,i[s]=1),e++;t.a.length=n}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ne.prototype).setTimeout=function(t){this.P=t},v.Xa=function(t){t=t.target;var e=this.F;e&&3==Vn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Vn(this.a),n=this.a.ua(),s=this.a.W();if(!(3>e||3==e&&!nt&&!this.a.$())){this.A||4!=e||7==n||le(8==n||0>=s?3:2),Ue(this);var i=this.a.W();this.N=i;var r=this.a.$();if(this.b=200==i,function(t,e,n,s,i,r,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,de(12),Me(this),Ve(this);break t}oe(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,qe(this,h)}this.I?(Ce(this,e,r),nt&&this.b&&3==e&&(se(this.J,this.R,"tick",this.Wa),this.R.start())):(oe(this.c,this.f,r,null),qe(this,r)),4==e&&Me(this),this.b&&!this.A&&(4==e?ts(this.g,this):(this.b=!1,Le(this)))}else 400==i&&0<r.indexOf("Unknown SID")?(this.h=3,de(12)):(this.h=0,de(13)),Me(this),Ve(this)}}}catch(t){}},v.Wa=function(){if(this.a){var t=Vn(this.a),e=this.a.$();this.D<e.length&&(Ue(this),Ce(this,t,e),this.b&&4!=t&&Le(this))}},v.cancel=function(){this.A=!0,Me(this)},v.Va=function(){this.o=null;var t=C();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(le(3),de(17)),Me(this),this.h=2,Ve(this)):Pe(this,this.T-t)},(v=$e.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return je(this),this.a.concat()},v.get=function(t,e){return Be(this.b,t)?this.b[t]:e},v.set=function(t,e){Be(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};var Ge=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ze(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof ze){this.a=void 0!==e?e:t.a,He(this,t.f),this.j=t.j,Xe(this,t.c),We(this,t.h),this.g=t.g,e=t.b;var n=new hn;n.c=e.c,e.a&&(n.a=new $e(e.a),n.b=e.b),Ye(this,n),this.i=t.i}else t&&(n=String(t).match(Ge))?(this.a=!!e,He(this,n[1]||"",!0),this.j=Ze(n[2]||""),Xe(this,n[3]||"",!0),We(this,n[4]),this.g=Ze(n[5]||"",!0),Ye(this,n[6]||"",!0),this.i=Ze(n[7]||"")):(this.a=!!e,this.b=new hn(null,this.a))}function Ke(t){return new ze(t)}function He(t,e,n){t.f=n?Ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Xe(t,e,n){t.c=n?Ze(e,!0):e}function We(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ye(t,e,n){e instanceof hn?(t.b=e,function(t,e){e&&!t.f&&(un(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),fn(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=tn(e,on)),t.b=new hn(e,t.a))}function Qe(t,e,n){t.b.set(e,n)}function Je(t){return Qe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^C()).toString(36)),t}function Ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,en),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function en(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push(tn(e,nn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(tn(e,nn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(tn(n,"/"==n.charAt(0)?rn:sn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",tn(n,an)),t.join("")};var nn=/[#\/\?@]/g,sn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,an=/#/g;function hn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function un(t){t.a||(t.a=new $e,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function cn(t,e){un(t),e=dn(t,e),Be(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Be((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function ln(t,e){return un(t),e=dn(t,e),Be(t.a.b,e)}function fn(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(dn(t,e),M(n)),t.b+=n.length)}function dn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(v=hn.prototype).add=function(t,e){un(this),this.c=null,t=dn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){un(this),this.a.forEach(function(n,s){U(n,function(n){t.call(e,n,s,this)},this)},this)},v.L=function(){un(this);for(var t=this.a.K(),e=this.a.L(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n},v.K=function(t){un(this);var e=[];if("string"==typeof t)ln(this,t)&&(e=V(e,this.a.get(dn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=V(e,t[n])}return e},v.set=function(t,e){return un(this),this.c=null,ln(this,t=dn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.K(s);for(var r=0;r<s.length;r++){var o=i;""!==s[r]&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.c=t.join("&")};var pn=function(){return function(t,e){this.b=t,this.a=e}}();function gn(t){this.g=t||mn,I.PerformanceNavigationTiming?t=0<(t=I.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(I.ia&&I.ia.ya&&I.ia.ya()&&I.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var mn=10;function yn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function wn(t){return t.b?1:t.a?t.a.size:0}function vn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function bn(t,e){t.a?t.a.add(e):t.b=e}function En(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function In(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var s=t.c;try{for(var i=w(t.a.values()),r=i.next();!r.done;r=i.next()){var o=r.value;s=s.concat(o.s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return s}return M(t.c)}function Tn(){}function _n(t,e,n){var s=n||"";try{Fe(t,function(t,n){var i=t;A(t)&&(i=Ft(t)),e.push(s+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function An(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}gn.prototype.cancel=function(){var t,e;if(this.c=In(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),s=n.next();!s.done;s=n.next()){s.value.cancel()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Tn.prototype.stringify=function(t){return I.JSON.stringify(t,void 0)},Tn.prototype.parse=function(t){return I.JSON.parse(t,void 0)};var Nn=I.JSON.parse;function xn(t){Vt.call(this),this.headers=new $e,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Sn,this.D=this.F=!1}O(xn,Vt);var Sn="",kn=/^https?$/i,Dn=["POST","PUT"];function Rn(t){return"content-type"==t.toLowerCase()}function Cn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,On(t),Pn(t)}function On(t){t.u||(t.u=!0,Mt(t,"complete"),Mt(t,"error"))}function Ln(t){if(t.b&&void 0!==E&&(!t.s[1]||4!=Vn(t)||2!=t.W()))if(t.l&&4==Vn(t))Zt(t.za,0,t);else if(Mt(t,"readystatechange"),4==Vn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if(!(e=s)){var i;if(i=0===n){var r=String(t.B).match(Ge)[1]||null;if(!r&&I.self&&I.self.location){var o=I.self.location.protocol;r=o.substr(0,o.length-1)}i=!kn.test(r?r.toLowerCase():"")}e=i}if(e)Mt(t,"complete"),Mt(t,"success");else{t.h=6;try{var a=2<Vn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",On(t)}}finally{Pn(t)}}}function Pn(t,e){if(t.a){Un(t);var n=t.a,s=t.s[0]?T:null;t.a=null,t.s=null,e||Mt(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function Un(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(I.clearTimeout(t.m),t.m=null)}function Vn(t){return t.a?t.a.readyState:0}function Mn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){var e="";return K(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Qe(t,e,n))}function qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Fn(t){this.pa=0,this.g=[],this.c=new re,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=qn("baseRetryDelayMs",5e3,t),this.Ra=qn("retryDelaySeedMs",1e4,t),this.Ma=qn("forwardChannelMaxRetries",2,t),this.ma=qn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new gn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new Tn},this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function $n(t){if(Bn(t),3==t.v){var e=t.R++,n=Ke(t.B);Qe(n,"SID",t.J),Qe(n,"RID",e),Qe(n,"TYPE","terminate"),Hn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Je(Ke(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(e.i.toString(),"")),!n&&I.Image&&((new Image).src=e.i,n=!0),n||(e.a=rs(e.g,null),e.a.ba(e.i)),e.u=C(),Le(e)}ss(t)}function jn(t){t.a&&(Qn(t),t.a.cancel(),t.a=null)}function Bn(t){jn(t),t.j&&(I.clearTimeout(t.j),t.j=null),Zn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&I.clearTimeout(t.h),t.h=null)}function Gn(t,e){t.g.push(new pn(t.Oa++,e)),3==t.v&&zn(t)}function zn(t){yn(t.b)||t.h||(t.h=!0,Ht(t.Ba,t),t.u=0)}function Kn(t,e){var n;n=e?e.f:t.R++;var s=Ke(t.B);Qe(s,"SID",t.J),Qe(s,"RID",n),Qe(s,"AID",t.P),Hn(t,s),t.i&&t.l&&Mn(s,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Xn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),bn(t.b,n),De(n,s,e)}function Hn(t,e){t.f&&Fe({},function(t,n){Qe(e,n,t)})}function Xn(t,e,n){n=Math.min(t.g.length,n);var s=t.f?D(t.f.Ja,t.f,t):null;t:for(var i=t.g,r=-1;;){var o=["count="+n];-1==r?0<n?(r=i[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var a=!0,h=0;h<n;h++){var u=i[h].b,c=i[h].a;if(0>(u-=r))r=Math.max(0,i[h].b-100),a=!1;else try{_n(c,o,"req"+u+"_")}catch(t){s&&s(c)}}if(a){s=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,s}function Wn(t){t.a||t.j||(t.T=1,Ht(t.Aa,t),t.o=0)}function Yn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ge(D(t.Aa,t),es(t,t.o)),t.o++,!0)}function Qn(t){null!=t.s&&(I.clearTimeout(t.s),t.s=null)}function Jn(t){t.a=new Ne(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ke(t.la);Qe(e,"RID","rpc"),Qe(e,"SID",t.J),Qe(e,"CI",t.H?"0":"1"),Qe(e,"AID",t.P),Hn(t,e),Qe(e,"TYPE","xmlhttp"),t.i&&t.l&&Mn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Je(Ke(e)),n.j=null,n.I=!0,Re(n,t)}function Zn(t){null!=t.m&&(I.clearTimeout(t.m),t.m=null)}function ts(t,e){var n=null;if(t.a==e){Zn(t),Qn(t),t.a=null;var s=2}else{if(!vn(t.b,e))return;n=e.s,En(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==s){n=e.j?e.j.length:0,e=C()-e.u;var i=t.u;Mt(s=ue(),new pe(s,n,e,i)),zn(t)}else Wn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==s&&function(t,e){return!(wn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=ge(D(t.Ba,t,e),es(t,t.u)),t.u++,0)))}(t,e)||2==s&&Yn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ns(t,5);break;case 4:ns(t,10);break;case 3:ns(t,6);break;default:ns(t,2)}}function es(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function ns(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var s=D(t.Ya,t);n||(n=new ze("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||He(n,"https"),Je(n)),function(t,e){var n=new re;if(I.Image){var s=new Image;s.onload=R(An,n,s,"TestLoadImage: loaded",!0,e),s.onerror=R(An,n,s,"TestLoadImage: error",!1,e),s.onabort=R(An,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=R(An,n,s,"TestLoadImage: timeout",!1,e),I.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(n.toString(),s)}else de(2);t.v=0,t.f&&t.f.ra(e),ss(t),Bn(t)}function ss(t){t.v=0,t.I=-1,t.f&&(0==In(t.b).length&&0==t.g.length||(t.b.c.length=0,M(t.g),t.g.length=0),t.f.qa())}function is(t,e,n){var s=function(t){return t instanceof ze?Ke(t):new ze(t,void 0)}(n);if(""!=s.c)e&&Xe(s,e+"."+s.c),We(s,s.h);else{var i=I.location;s=function(t,e,n,s){var i=new ze(null,void 0);return t&&He(i,t),e&&Xe(i,e),n&&We(i,n),s&&(i.g=s),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&K(t.V,function(t,e){Qe(s,e,t)}),e=t.A,n=t.na,e&&n&&Qe(s,e,n),Qe(s,"VER",t.ha),Hn(t,s),s}function rs(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new xn(t.Na)).F=t.C,e}function os(){}function as(){if(tt&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function hs(t,e){Vt.call(this),this.a=new Fn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!q(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new ls(this)}function us(t){Te.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cs(){_e.call(this),this.status=1}function ls(t){this.a=t}(v=xn.prototype).ba=function(t,e,n,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ve(this.H):ve(Ee),this.a.onreadystatechange=D(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Cn(this,t)}t=n||"";var i=new $e(this.headers);s&&Fe(s,function(t,e){i.set(e,t)}),s=function(t){t:{for(var e=Rn,n=t.length,s="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=I.FormData&&t instanceof I.FormData,!(0<=P(Dn,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Un(this),0<this.o&&((this.D=function(t){return tt&&lt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=D(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Cn(this,t)}},v.xa=function(){void 0!==E&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Mt(this,"timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Mt(this,"complete"),Mt(this,"abort"),Pn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Pn(this,!0)),xn.X.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?Ln(this):this.Ua())},v.Ua=function(){Ln(this)},v.W=function(){try{return 2<Vn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Nn(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Fn.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),s=this.l;if(this.O&&(s?W(s=H(s),this.O):s=this.O),null===this.i&&(n.B=s),this.da)t:{for(var i=e=0;i<this.g.length;i++){var r=this.g[i];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Xn(this,n,e),Qe(i=Ke(this.B),"RID",t),Qe(i,"CVER",22),this.A&&Qe(i,"X-HTTP-Session-Id",this.A),Hn(this,i),this.i&&s&&Mn(i,this.i,s),bn(this.b,n),this.Ia&&Qe(i,"TYPE","init"),this.da?(Qe(i,"$req",e),Qe(i,"SID","null"),n.U=!0,De(n,i,null)):De(n,i,e),this.v=2}}else 3==this.v&&(t?Kn(this,t):0==this.g.length||yn(this.b)||Kn(this))},v.Aa=function(){if(this.j=null,Jn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ge(D(this.Ta,this),t)}},v.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,de(10),jn(this),Jn(this))},v.Sa=function(){null!=this.m&&(this.m=null,jn(this),Yn(this),de(19))},v.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),de(2)):(this.c.info("Failed to ping google.com"),de(1))},(v=os.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ja=function(){},as.prototype.a=function(t,e){return new hs(t,e)},O(hs,Vt),hs.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;de(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=is(t,null,t.fa),zn(t)},hs.prototype.close=function(){$n(this.a)},hs.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Gn(this.a,e)}else this.l?((e={}).__data__=Ft(t),Gn(this.a,e)):Gn(this.a,t)},hs.prototype.G=function(){this.a.f=null,delete this.f,$n(this.a),delete this.a,hs.X.G.call(this)},O(us,Te),O(cs,_e),O(ls,os),ls.prototype.ta=function(){Mt(this.a,"a")},ls.prototype.sa=function(t){Mt(this.a,new us(t))},ls.prototype.ra=function(t){Mt(this.a,new cs(t))},ls.prototype.qa=function(){Mt(this.a,"b")},as.prototype.createWebChannel=as.prototype.a,hs.prototype.send=hs.prototype.h,hs.prototype.open=hs.prototype.g,hs.prototype.close=hs.prototype.close,me.NO_ERROR=0,me.TIMEOUT=8,me.HTTP_ERROR=6,ye.COMPLETE="complete",be.EventType=Ie,Ie.OPEN="a",Ie.CLOSE="b",Ie.ERROR="c",Ie.MESSAGE="d",Vt.prototype.listen=Vt.prototype.va,xn.prototype.listenOnce=xn.prototype.wa,xn.prototype.getLastError=xn.prototype.Qa,xn.prototype.getLastErrorCode=xn.prototype.ua,xn.prototype.getStatus=xn.prototype.W,xn.prototype.getResponseJson=xn.prototype.Pa,xn.prototype.getResponseText=xn.prototype.$,xn.prototype.send=xn.prototype.ba;var fs=function(){return new as},ds=function(){return ue()},ps=me,gs=ye,ms=ae,ys={gb:0,jb:1,kb:2,Db:3,Ib:4,Fb:5,Gb:6,Eb:7,Cb:8,Hb:9,PROXY:10,NOPROXY:11,Ab:12,wb:13,xb:14,vb:15,yb:16,zb:17,bb:18,ab:19,cb:20},ws=be,vs=xn;class bs{constructor(t){this.uid=t}t(){return null!=this.uid}i(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}bs.UNAUTHENTICATED=new bs(null),bs.o=new bs("google-credentials-uid"),bs.u=new bs("first-party-uid");const Es=new m("@firebase/firestore");function Is(){return Es.logLevel}function Ts(t,...e){if(Es.logLevel<=h.DEBUG){const n=e.map(Ns);Es.debug("Firestore (8.1.2): "+t,...n)}}function _s(t,...e){if(Es.logLevel<=h.ERROR){const n=e.map(Ns);Es.error("Firestore (8.1.2): "+t,...n)}}function As(t,...e){if(Es.logLevel<=h.WARN){const n=e.map(Ns);Es.warn("Firestore (8.1.2): "+t,...n)}}function Ns(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function xs(t="Unexpected state"){const e="FIRESTORE (8.1.2) INTERNAL ASSERTION FAILED: "+t;throw _s(e),new Error(e)}function Ss(t,e){t||xs()}function ks(t,e){return t}const Ds={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Rs extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Cs{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization="Bearer "+t}}class Os{constructor(){this.l=null}getToken(){return Promise.resolve(null)}_(){}T(t){this.l=t,t(bs.UNAUTHENTICATED)}I(){this.l=null}}class Ls{constructor(t){this.A=null,this.currentUser=bs.UNAUTHENTICATED,this.m=!1,this.R=0,this.l=null,this.forceRefresh=!1,this.A=(()=>{this.R++,this.currentUser=this.P(),this.m=!0,this.l&&this.l(this.currentUser)}),this.R=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.A):(this.A(null),t.get().then(t=>{this.auth=t,this.A&&this.auth.addAuthTokenListener(this.A)},()=>{}))}getToken(){const t=this.R,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.R!==t?(Ts("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Ss("string"==typeof e.accessToken),new Cs(e.accessToken,this.currentUser)):null):Promise.resolve(null)}_(){this.forceRefresh=!0}T(t){this.l=t,this.m&&t(this.currentUser)}I(){this.auth&&this.auth.removeAuthTokenListener(this.A),this.A=null,this.l=null}P(){const t=this.auth&&this.auth.getUid();return Ss(null===t||"string"==typeof t),new bs(t)}}class Ps{constructor(t,e){this.V=t,this.g=e,this.type="FirstParty",this.user=bs.u}get h(){const t={"X-Goog-AuthUser":this.g},e=this.V.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t}}class Us{constructor(t,e){this.V=t,this.g=e}getToken(){return Promise.resolve(new Ps(this.V,this.g))}T(t){t(bs.u)}I(){}_(){}}class Vs{constructor(t,e,n,s,i,r){this.p=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=i,this.v=r}}class Ms{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get S(){return"(default)"===this.database}isEqual(t){return t instanceof Ms&&t.projectId===this.projectId&&t.database===this.database}}class qs{D(t){}C(){}}class Fs{constructor(){this.N=(()=>this.k()),this.O=(()=>this.M()),this.F=[],this.$()}D(t){this.F.push(t)}C(){window.removeEventListener("online",this.N),window.removeEventListener("offline",this.O)}$(){window.addEventListener("online",this.N),window.addEventListener("offline",this.O)}k(){Ts("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.F)t(0)}M(){Ts("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.F)t(1)}static L(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}function $s(t){return null==t}function js(t){return 0===t&&1/t==-1/0}function Bs(t){return"number"==typeof t&&Number.isInteger(t)&&!js(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const Gs={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};var zs,Ks;function Hs(t){switch(t){case Ds.OK:return xs();case Ds.CANCELLED:case Ds.UNKNOWN:case Ds.DEADLINE_EXCEEDED:case Ds.RESOURCE_EXHAUSTED:case Ds.INTERNAL:case Ds.UNAVAILABLE:case Ds.UNAUTHENTICATED:return!1;case Ds.INVALID_ARGUMENT:case Ds.NOT_FOUND:case Ds.ALREADY_EXISTS:case Ds.PERMISSION_DENIED:case Ds.FAILED_PRECONDITION:case Ds.ABORTED:case Ds.OUT_OF_RANGE:case Ds.UNIMPLEMENTED:case Ds.DATA_LOSS:return!0;default:return xs()}}function Xs(t){if(void 0===t)return _s("GRPC error has no .code"),Ds.UNKNOWN;switch(t){case zs.OK:return Ds.OK;case zs.CANCELLED:return Ds.CANCELLED;case zs.UNKNOWN:return Ds.UNKNOWN;case zs.DEADLINE_EXCEEDED:return Ds.DEADLINE_EXCEEDED;case zs.RESOURCE_EXHAUSTED:return Ds.RESOURCE_EXHAUSTED;case zs.INTERNAL:return Ds.INTERNAL;case zs.UNAVAILABLE:return Ds.UNAVAILABLE;case zs.UNAUTHENTICATED:return Ds.UNAUTHENTICATED;case zs.INVALID_ARGUMENT:return Ds.INVALID_ARGUMENT;case zs.NOT_FOUND:return Ds.NOT_FOUND;case zs.ALREADY_EXISTS:return Ds.ALREADY_EXISTS;case zs.PERMISSION_DENIED:return Ds.PERMISSION_DENIED;case zs.FAILED_PRECONDITION:return Ds.FAILED_PRECONDITION;case zs.ABORTED:return Ds.ABORTED;case zs.OUT_OF_RANGE:return Ds.OUT_OF_RANGE;case zs.UNIMPLEMENTED:return Ds.UNIMPLEMENTED;case zs.DATA_LOSS:return Ds.DATA_LOSS;default:return xs()}}(Ks=zs||(zs={}))[Ks.OK=0]="OK",Ks[Ks.CANCELLED=1]="CANCELLED",Ks[Ks.UNKNOWN=2]="UNKNOWN",Ks[Ks.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ks[Ks.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ks[Ks.NOT_FOUND=5]="NOT_FOUND",Ks[Ks.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ks[Ks.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ks[Ks.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ks[Ks.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ks[Ks.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ks[Ks.ABORTED=10]="ABORTED",Ks[Ks.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ks[Ks.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ks[Ks.INTERNAL=13]="INTERNAL",Ks[Ks.UNAVAILABLE=14]="UNAVAILABLE",Ks[Ks.DATA_LOSS=15]="DATA_LOSS";class Ws{constructor(t){this.B=t.B,this.q=t.q}U(t){this.K=t}W(t){this.j=t}onMessage(t){this.G=t}close(){this.q()}send(t){this.B(t)}H(){this.K()}J(t){this.j(t)}Y(t){this.G(t)}}class Ys{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Qs extends class{constructor(t){this.X=t,this.p=t.p;const e=t.ssl?"https":"http";this.Z=e+"://"+t.host,this.tt="projects/"+this.p.projectId+"/databases/"+this.p.database+"/documents"}et(t,e,n,s){const i=this.nt(t,e);Ts("RestConnection","Sending: ",i,n);const r={};return this.st(r,s),this.it(t,i,r,n).then(t=>(Ts("RestConnection","Received: ",t),t),e=>{throw As("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})}rt(t,e,n,s){return this.et(t,e,n,s)}st(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.1.2",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}nt(t,e){const n=Gs[t];return`${this.Z}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.v=t.v}it(t,e,n,s){return new Promise((i,r)=>{const o=new vs;o.listenOnce(gs.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case ps.NO_ERROR:const e=o.getResponseJson();Ts("Connection","XHR received:",JSON.stringify(e)),i(e);break;case ps.TIMEOUT:Ts("Connection",'RPC "'+t+'" timed out'),r(new Rs(Ds.DEADLINE_EXCEEDED,"Request time out"));break;case ps.HTTP_ERROR:const n=o.getStatus();if(Ts("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Ds).indexOf(e)>=0?e:Ds.UNKNOWN}(t.status);r(new Rs(e,t.message))}else r(new Rs(Ds.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Rs(Ds.UNAVAILABLE,"Connection failed."));break;default:xs()}}finally{Ts("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(s);o.send(e,"POST",a,n,15)})}ot(t,e){const n=[this.Z,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=fs(),r=ds(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.p.projectId}/databases/${this.p.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.v};var a,h;this.st(o.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product||s().indexOf("Electron/")>=0||((h=s()).indexOf("MSIE ")>=0||h.indexOf("Trident/")>=0)||s().indexOf("MSAppHost/")>=0||"object"==typeof(a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==a.id||(o.httpHeadersOverwriteParam="$httpHeaders");const u=n.join("");Ts("Connection","Creating WebChannel: "+u,o);const c=i.createWebChannel(u,o);let l=!1,f=!1;const d=new Ws({B:t=>{f?Ts("Connection","Not sending because WebChannel is closed:",t):(l||(Ts("Connection","Opening WebChannel transport."),c.open(),l=!0),Ts("Connection","WebChannel sending:",t),c.send(t))},q:()=>c.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(c,ws.EventType.OPEN,()=>{f||Ts("Connection","WebChannel transport opened.")}),p(c,ws.EventType.CLOSE,()=>{f||(f=!0,Ts("Connection","WebChannel transport closed"),d.J())}),p(c,ws.EventType.ERROR,t=>{f||(f=!0,As("Connection","WebChannel transport errored:",t),d.J(new Rs(Ds.UNAVAILABLE,"The operation could not be completed")))}),p(c,ws.EventType.MESSAGE,t=>{var e;if(!f){const n=t.data[0];Ss(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){Ts("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=zs[t];if(void 0!==e)return Xs(e)}(t),n=i.message;void 0===e&&(e=Ds.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),f=!0,d.J(new Rs(e,n)),c.close()}else Ts("Connection","WebChannel received:",n),d.Y(n)}}),p(r,ms.STAT_EVENT,t=>{t.stat===ys.PROXY?Ts("Connection","Detected buffering proxy"):t.stat===ys.NOPROXY&&Ts("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.H()},0),d}}function Js(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Zs{static ct(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=Js(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function ti(t,e){return t<e?-1:t>e?1:0}function ei(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}function ni(t){return t+"\0"}class si{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Rs(Ds.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Rs(Ds.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Rs(Ds.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Rs(Ds.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return si.fromMillis(Date.now())}static fromDate(t){return si.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new si(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}ut(t){return this.seconds===t.seconds?ti(this.nanoseconds,t.nanoseconds):ti(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ii{constructor(t){this.timestamp=t}static at(t){return new ii(t)}static min(){return new ii(new si(0,0))}ht(t){return this.timestamp.ut(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}lt(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}_t(){return this.timestamp}}class ri{constructor(t,e,n){void 0===e?e=0:e>t.length&&xs(),void 0===n?n=t.length-e:n>t.length-e&&xs(),this.segments=t,this.offset=e,this.ft=n}get length(){return this.ft}isEqual(t){return 0===ri.dt(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ri?t.forEach(t=>{e.push(t)}):e.push(t),this.wt(e)}limit(){return this.offset+this.length}Et(t){return t=void 0===t?1:t,this.wt(this.segments,this.offset+t,this.length-t)}Tt(){return this.wt(this.segments,this.offset,this.length-1)}It(){return this.segments[this.offset]}At(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}Rt(){return 0===this.length}Pt(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}Vt(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}gt(){return this.segments.slice(this.offset,this.limit())}static dt(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class oi extends ri{wt(t,e,n){return new oi(t,e,n)}yt(){return this.gt().join("/")}toString(){return this.yt()}static vt(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Rs(Ds.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new oi(e)}static bt(){return new oi([])}}const ai=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class hi extends ri{wt(t,e,n){return new hi(t,e,n)}static St(t){return ai.test(t)}yt(){return this.gt().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),hi.St(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.yt()}Dt(){return 1===this.length&&"__name__"===this.get(0)}static Ct(){return new hi(["__name__"])}static Nt(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Rs(Ds.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Rs(Ds.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Rs(Ds.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new Rs(Ds.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new hi(e)}static bt(){return new hi([])}}class ui{constructor(t){this.path=t}static xt(t){return new ui(oi.vt(t))}static kt(t){return new ui(oi.vt(t).Et(5))}Ot(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===oi.dt(this.path,t.path)}toString(){return this.path.toString()}static dt(t,e){return oi.dt(t.path,e.path)}static Mt(t){return t.length%2==0}static Ft(t){return new ui(new oi(t.slice()))}}function ci(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function li(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function fi(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class di{constructor(t){this.fields=t,t.sort(hi.dt)}$t(t){for(const e of this.fields)if(e.Pt(t))return!0;return!1}isEqual(t){return ei(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class pi{constructor(t){this.Lt=t}static fromBase64String(t){const e=atob(t);return new pi(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new pi(e)}toBase64(){return t=this.Lt,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.Lt)}Bt(){return 2*this.Lt.length}ht(t){return ti(this.Lt,t.Lt)}isEqual(t){return this.Lt===t.Lt}}pi.qt=new pi("");const gi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mi(t){if(Ss(!!t),"string"==typeof t){let e=0;const n=gi.exec(t);if(Ss(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:yi(t.seconds),nanos:yi(t.nanos)}}function yi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function wi(t){return"string"==typeof t?pi.fromBase64String(t):pi.fromUint8Array(t)}function vi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function bi(t){const e=mi(t.mapValue.fields.__local_write_time__.timestampValue);return new si(e.seconds,e.nanos)}function Ei(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?vi(t)?4:10:xs()}function Ii(t,e){const n=Ei(t);if(n!==Ei(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return bi(t).isEqual(bi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=mi(t.timestampValue),s=mi(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return wi(t.bytesValue).isEqual(wi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return yi(t.geoPointValue.latitude)===yi(e.geoPointValue.latitude)&&yi(t.geoPointValue.longitude)===yi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return yi(t.integerValue)===yi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=yi(t.doubleValue),s=yi(e.doubleValue);return n===s?js(n)===js(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return ei(t.arrayValue.values||[],e.arrayValue.values||[],Ii);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(ci(n)!==ci(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Ii(n[t],s[t])))return!1;return!0}(t,e);default:return xs()}}function Ti(t,e){return void 0!==(t.values||[]).find(t=>Ii(t,e))}function _i(t,e){const n=Ei(t),s=Ei(e);if(n!==s)return ti(n,s);switch(n){case 0:return 0;case 1:return ti(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=yi(t.integerValue||t.doubleValue),s=yi(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Ai(t.timestampValue,e.timestampValue);case 4:return Ai(bi(t),bi(e));case 5:return ti(t.stringValue,e.stringValue);case 6:return function(t,e){const n=wi(t),s=wi(e);return n.ht(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=ti(n[t],s[t]);if(0!==e)return e}return ti(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ti(yi(t.latitude),yi(e.latitude));return 0!==n?n:ti(yi(t.longitude),yi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=_i(n[t],s[t]);if(e)return e}return ti(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=ti(s[t],r[t]);if(0!==e)return e;const o=_i(n[s[t]],i[r[t]]);if(0!==o)return o}return ti(s.length,r.length)}(t.mapValue,e.mapValue);default:throw xs()}}function Ai(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ti(t,e);const n=mi(t),s=mi(e),i=ti(n.seconds,s.seconds);return 0!==i?i:ti(n.nanos,s.nanos)}function Ni(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=mi(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?wi(e.bytesValue).toBase64():"referenceValue"in e?(s=e.referenceValue,ui.kt(s).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=t(i);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const r of n)i?i=!1:s+=",",s+=`${r}:${t(e.fields[r])}`;return s+"}"}(e.mapValue):xs();var n,s}(t)}function xi(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.yt()}`}}function Si(t){return!!t&&"integerValue"in t}function ki(t){return!!t&&"arrayValue"in t}function Di(t){return!!t&&"nullValue"in t}function Ri(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ci(t){return!!t&&"mapValue"in t}class Oi{constructor(t){this.proto=t}static empty(){return new Oi({mapValue:{}})}field(t){if(t.Rt())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ci(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.At()])||null}}isEqual(t){return Ii(this.proto,t.proto)}}class Li{constructor(t=Oi.empty()){this.Ut=t,this.Kt=new Map}set(t,e){return this.Qt(t,e),this}delete(t){return this.Qt(t,null),this}Qt(t,e){let n=this.Kt;for(let e=0;e<t.length-1;++e){const s=t.get(e);let i=n.get(s);i instanceof Map?n=i:i&&10===Ei(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(s,i),n=i):(i=new Map,n.set(s,i),n=i)}n.set(t.At(),e)}Wt(){const t=this.jt(hi.bt(),this.Kt);return null!=t?new Oi(t):this.Ut}jt(t,e){let n=!1;const s=this.Ut.field(t),i=Ci(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const r=this.jt(t.child(s),e);null!=r&&(i[s]=r,n=!0)}else null!==e?(i[s]=e,n=!0):i.hasOwnProperty(s)&&(delete i[s],n=!0)}),n?{mapValue:{fields:i}}:null}}function Pi(t){const e=[];return li(t.fields||{},(t,n)=>{const s=new hi([t]);if(Ci(n)){const t=Pi(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)}),new di(e)}class Ui{constructor(t,e){this.key=t,this.version=e}}class Vi extends Ui{constructor(t,e,n,s){super(t,e),this.Gt=n,this.zt=!!s.zt,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.Gt.field(t)}data(){return this.Gt}Ht(){return this.Gt.proto}isEqual(t){return t instanceof Vi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.zt===t.zt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Gt.isEqual(t.Gt)}toString(){return`Document(${this.key}, ${this.version}, ${this.Gt.toString()}, {hasLocalMutations: ${this.zt}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.zt||this.hasCommittedMutations}}class Mi extends Ui{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof Mi&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class qi extends Ui{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof qi&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class Fi{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.Jt=null}}function $i(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Fi(t,e,n,s,i,r,o)}function ji(t){const e=ks(t);if(null===e.Jt){let t=e.path.yt();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.yt()+t.op.toString()+Ni(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.yt()+t.dir})(t)).join(","),$s(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=er(e.startAt)),e.endAt&&(t+="|ub:",t+=er(e.endAt)),e.Jt=t}return e.Jt}function Bi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!sr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!Ii(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!rr(t.startAt,e.startAt)&&rr(t.endAt,e.endAt)}function Gi(t){return ui.Mt(t.path)&&null===t.collectionGroup&&0===t.filters.length}class zi extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.Dt()?"in"===e||"not-in"===e?this.Yt(t,e,n):new Ki(t,e,n):"array-contains"===e?new Yi(t,n):"in"===e?new Qi(t,n):"not-in"===e?new Ji(t,n):"array-contains-any"===e?new Zi(t,n):new zi(t,e,n)}static Yt(t,e,n){return"in"===e?new Hi(t,n):new Xi(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.Xt(_i(e,this.value)):null!==e&&Ei(this.value)===Ei(e)&&this.Xt(_i(e,this.value))}Xt(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return xs()}}Zt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Ki extends zi{constructor(t,e,n){super(t,e,n),this.key=ui.kt(n.referenceValue)}matches(t){const e=ui.dt(t.key,this.key);return this.Xt(e)}}class Hi extends zi{constructor(t,e){super(t,"in",e),this.keys=Wi("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Xi extends zi{constructor(t,e){super(t,"not-in",e),this.keys=Wi("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Wi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>ui.kt(t.referenceValue))}class Yi extends zi{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return ki(e)&&Ti(e.arrayValue,this.value)}}class Qi extends zi{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&Ti(this.value.arrayValue,e)}}class Ji extends zi{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ti(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.field(this.field);return null!==e&&!Ti(this.value.arrayValue,e)}}class Zi extends zi{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!ki(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Ti(this.value.arrayValue,t))}}class tr{constructor(t,e){this.position=t,this.before=e}}function er(t){return`${t.before?"b":"a"}:${t.position.map(t=>Ni(t)).join(",")}`}class nr{constructor(t,e="asc"){this.field=t,this.dir=e}}function sr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ir(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.Dt()?ui.dt(ui.kt(o.referenceValue),n.key):_i(o,n.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function rr(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ii(t.position[n],e.position[n]))return!1;return!0}class or{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.te=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.ee=null,this.ne=null,this.startAt,this.endAt}}function ar(t,e,n,s,i,r,o,a){return new or(t,e,n,s,i,r,o,a)}function hr(t){return new or(t)}function ur(t){return!$s(t.limit)&&"F"===t.limitType}function cr(t){return!$s(t.limit)&&"L"===t.limitType}function lr(t){return t.te.length>0?t.te[0].field:null}function fr(t){for(const e of t.filters)if(e.Zt())return e.field;return null}function dr(t){return null!==t.collectionGroup}function pr(t){const e=ks(t);if(null===e.ee){e.ee=[];const t=fr(e),n=lr(e);if(null!==t&&null===n)t.Dt()||e.ee.push(new nr(t)),e.ee.push(new nr(hi.Ct(),"asc"));else{let t=!1;for(const n of e.te)e.ee.push(n),n.field.Dt()&&(t=!0);if(!t){const t=e.te.length>0?e.te[e.te.length-1].dir:"asc";e.ee.push(new nr(hi.Ct(),t))}}}return e.ee}function gr(t){const e=ks(t);if(!e.ne)if("F"===e.limitType)e.ne=$i(e.path,e.collectionGroup,pr(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of pr(e)){const e="desc"===n.dir?"asc":"desc";t.push(new nr(n.field,e))}const n=e.endAt?new tr(e.endAt.position,!e.endAt.before):null,s=e.startAt?new tr(e.startAt.position,!e.startAt.before):null;e.ne=$i(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.ne}function mr(t,e,n){return new or(t.path,t.collectionGroup,t.te.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function yr(t,e){return Bi(gr(t),gr(e))&&t.limitType===e.limitType}function wr(t){return`${ji(gr(t))}|lt:${t.limitType}`}function vr(t){return`Query(target=${function(t){let e=t.path.yt();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.yt()} ${e.op} ${Ni(e.value)}`;var e}).join(", ")}]`),$s(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.yt()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+er(t.startAt)),t.endAt&&(e+=", endAt: "+er(t.endAt)),`Target(${e})`}(gr(t))}; limitType=${t.limitType})`}function br(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.Ot(t.collectionGroup)&&t.path.Pt(n):ui.Mt(t.path)?t.path.isEqual(n):t.path.Vt(n)}(t,e)&&function(t,e){for(const n of t.te)if(!n.field.Dt()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!ir(t.startAt,pr(t),e))&&(!t.endAt||!ir(t.endAt,pr(t),e))}(t,e)}function Er(t){return(e,n)=>{let s=!1;for(const i of pr(t)){const t=Ir(i,e,n);if(0!==t)return t;s=s||i.field.Dt()}return 0}}function Ir(t,e,n){const s=t.field.Dt()?ui.dt(e.key,n.key):function(t,e,n){const s=e.field(t),i=n.field(t);return null!==s&&null!==i?_i(s,i):xs()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return xs()}}class Tr{constructor(t,e,n,s,i=ii.min(),r=ii.min(),o=pi.qt){this.target=t,this.targetId=e,this.se=n,this.sequenceNumber=s,this.ie=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}re(t){return new Tr(this.target,this.targetId,this.se,t,this.ie,this.lastLimboFreeSnapshotVersion,this.resumeToken)}oe(t,e){return new Tr(this.target,this.targetId,this.se,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}ce(t){return new Tr(this.target,this.targetId,this.se,this.sequenceNumber,this.ie,t,this.resumeToken)}}function _r(t,e){if(t.ue){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:js(e)?"-0":e}}function Ar(t){return{integerValue:""+t}}function Nr(t,e){return Bs(e)?Ar(e):_r(t,e)}class xr{constructor(){this.ae=void 0}}function Sr(t,e,n){return t instanceof Rr?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Cr?Or(t,e):t instanceof Lr?Pr(t,e):function(t,e){const n=Dr(t,e),s=Vr(n)+Vr(t.he);return Si(n)&&Si(t.he)?Ar(s):_r(t.le,s)}(t,e)}function kr(t,e,n){return t instanceof Cr?Or(t,e):t instanceof Lr?Pr(t,e):n}function Dr(t,e){return t instanceof Ur?Si(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Rr extends xr{}class Cr extends xr{constructor(t){super(),this.elements=t}}function Or(t,e){const n=Mr(e);for(const e of t.elements)n.some(t=>Ii(t,e))||n.push(e);return{arrayValue:{values:n}}}class Lr extends xr{constructor(t){super(),this.elements=t}}function Pr(t,e){let n=Mr(e);for(const e of t.elements)n=n.filter(t=>!Ii(t,e));return{arrayValue:{values:n}}}class Ur extends xr{constructor(t,e){super(),this.le=t,this.he=e}}function Vr(t){return yi(t.integerValue||t.doubleValue)}function Mr(t){return ki(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class qr{constructor(t,e){this.field=t,this.transform=e}}class Fr{constructor(t,e){this.version=t,this.transformResults=e}}class $r{constructor(t,e){this.updateTime=t,this.exists=e}static _e(){return new $r}static exists(t){return new $r(void 0,t)}static updateTime(t){return new $r(t)}get fe(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function jr(t,e){return void 0!==t.updateTime?e instanceof Vi&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Vi}class Br{}function Gr(t,e,n){return t instanceof Wr?function(t,e,n){let s=t.value;if(n.transformResults){const i=Jr(t.fieldTransforms,e,n.transformResults);s=to(t.fieldTransforms,s,i)}return new Vi(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):t instanceof Yr?function(t,e,n){if(!jr(t.de,e))return new qi(t.key,n.version);const s=Qr(t,e,n.transformResults?Jr(t.fieldTransforms,e,n.transformResults):[]);return new Vi(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new Mi(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function zr(t,e,n,s){return t instanceof Wr?function(t,e,n,s){if(!jr(t.de,e))return e;let i=t.value;if(t.fieldTransforms){const r=Zr(t.fieldTransforms,n,e,s);i=to(t.fieldTransforms,i,r)}const r=Xr(e);return new Vi(t.key,r,i,{zt:!0})}(t,e,s,n):t instanceof Yr?function(t,e,n,s){if(!jr(t.de,e))return e;const i=Xr(e),r=Qr(t,e,Zr(t.fieldTransforms,n,e,s));return new Vi(t.key,i,r,{zt:!0})}(t,e,s,n):function(t,e){return jr(t.de,e)?new Mi(t.key,ii.min()):e}(t,e)}function Kr(t,e){return void 0!==t.fieldTransforms?function(t,e){let n=null;for(const s of t){const t=e instanceof Vi?e.field(s.field):void 0,i=Dr(s.transform,t||null);null!=i&&(n=null==n?(new Li).set(s.field,i):n.set(s.field,i))}return n?n.Wt():null}(t.fieldTransforms,e):null}function Hr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.de.isEqual(e.de)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ei(t,e,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Cr&&e instanceof Cr||t instanceof Lr&&e instanceof Lr?ei(t.elements,e.elements,Ii):t instanceof Ur&&e instanceof Ur?Ii(t.he,e.he):t instanceof Rr&&e instanceof Rr}(t.transform,e.transform)})(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.we.isEqual(e.we))}function Xr(t){return t instanceof Vi?t.version:ii.min()}class Wr extends Br{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.de=n,this.fieldTransforms=s,this.type=0}}class Yr extends Br{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.we=n,this.de=s,this.fieldTransforms=i,this.type=1}}function Qr(t,e,n){let s;return s=e instanceof Vi?e.data():Oi.empty(),s=function(t,e){const n=new Li(s);return t.we.fields.forEach(e=>{if(!e.Rt()){const s=t.data.field(e);null!==s?n.set(e,s):n.delete(e)}}),n.Wt()}(t),s=to(t.fieldTransforms,s,n)}function Jr(t,e,n){const s=[];Ss(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform;let a=null;e instanceof Vi&&(a=e.field(r.field)),s.push(kr(o,a,n[i]))}return s}function Zr(t,e,n,s){const i=[];for(const r of t){const t=r.transform;let o=null;n instanceof Vi&&(o=n.field(r.field)),null===o&&s instanceof Vi&&(o=s.field(r.field)),i.push(Sr(t,o,e))}return i}function to(t,e,n){const s=new Li(e);for(let e=0;e<t.length;e++){const i=t[e];s.set(i.field,n[e])}return s.Wt()}class eo extends Br{constructor(t,e){super(),this.key=t,this.de=e,this.type=2,this.fieldTransforms=[]}}class no extends Br{constructor(t,e){super(),this.key=t,this.de=e,this.type=3,this.fieldTransforms=[]}}class so{constructor(t){this.count=t}}class io{constructor(t,e){this.dt=t,this.root=e||oo.EMPTY}Ee(t,e){return new io(this.dt,this.root.Ee(t,e,this.dt).copy(null,null,oo.Te,null,null))}remove(t){return new io(this.dt,this.root.remove(t,this.dt).copy(null,null,oo.Te,null,null))}get(t){let e=this.root;for(;!e.Rt();){const n=this.dt(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.Rt();){const s=this.dt(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}Rt(){return this.root.Rt()}get size(){return this.root.size}Ie(){return this.root.Ie()}Ae(){return this.root.Ae()}me(t){return this.root.me(t)}forEach(t){this.me((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.me((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}Re(t){return this.root.Re(t)}Pe(){return new ro(this.root,null,this.dt,!1)}Ve(t){return new ro(this.root,t,this.dt,!1)}ge(){return new ro(this.root,null,this.dt,!0)}ye(t){return new ro(this.root,t,this.dt,!0)}}class ro{constructor(t,e,n,s){this.pe=s,this.ve=[];let i=1;for(;!t.Rt();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.pe?t.left:t.right;else{if(0===i){this.ve.push(t);break}this.ve.push(t),t=this.pe?t.right:t.left}}be(){let t=this.ve.pop();const e={key:t.key,value:t.value};if(this.pe)for(t=t.left;!t.Rt();)this.ve.push(t),t=t.right;else for(t=t.right;!t.Rt();)this.ve.push(t),t=t.left;return e}Se(){return this.ve.length>0}De(){if(0===this.ve.length)return null;const t=this.ve[this.ve.length-1];return{key:t.key,value:t.value}}}class oo{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:oo.RED,this.left=null!=s?s:oo.EMPTY,this.right=null!=i?i:oo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new oo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}Rt(){return!1}me(t){return this.left.me(t)||t(this.key,this.value)||this.right.me(t)}Re(t){return this.right.Re(t)||t(this.key,this.value)||this.left.Re(t)}min(){return this.left.Rt()?this:this.left.min()}Ie(){return this.min().key}Ae(){return this.right.Rt()?this.key:this.right.Ae()}Ee(t,e,n){let s=this;const i=n(t,s.key);return(s=i<0?s.copy(null,null,null,s.left.Ee(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.Ee(t,e,n))).Ce()}Ne(){if(this.left.Rt())return oo.EMPTY;let t=this;return t.left.xe()||t.left.left.xe()||(t=t.ke()),(t=t.copy(null,null,null,t.left.Ne(),null)).Ce()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.Rt()||s.left.xe()||s.left.left.xe()||(s=s.ke()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.xe()&&(s=s.Oe()),s.right.Rt()||s.right.xe()||s.right.left.xe()||(s=s.Me()),0===e(t,s.key)){if(s.right.Rt())return oo.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.Ne())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.Ce()}xe(){return this.color}Ce(){let t=this;return t.right.xe()&&!t.left.xe()&&(t=t.Fe()),t.left.xe()&&t.left.left.xe()&&(t=t.Oe()),t.left.xe()&&t.right.xe()&&(t=t.$e()),t}ke(){let t=this.$e();return t.right.left.xe()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Oe())).Fe()).$e()),t}Me(){let t=this.$e();return t.left.left.xe()&&(t=(t=t.Oe()).$e()),t}Fe(){const t=this.copy(null,null,oo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}Oe(){const t=this.copy(null,null,oo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}$e(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Le(){const t=this.Be();return Math.pow(2,t)<=this.size+1}Be(){if(this.xe()&&this.left.xe())throw xs();if(this.right.xe())throw xs();const t=this.left.Be();if(t!==this.right.Be())throw xs();return t+(this.xe()?0:1)}}oo.EMPTY=null,oo.RED=!0,oo.Te=!1,oo.EMPTY=new class{constructor(){this.size=0}get key(){throw xs()}get value(){throw xs()}get color(){throw xs()}get left(){throw xs()}get right(){throw xs()}copy(t,e,n,s,i){return this}Ee(t,e,n){return new oo(t,e)}remove(t,e){return this}Rt(){return!0}me(t){return!1}Re(t){return!1}Ie(){return null}Ae(){return null}xe(){return!1}Le(){return!0}Be(){return 0}};class ao{constructor(t){this.dt=t,this.data=new io(this.dt)}has(t){return null!==this.data.get(t)}first(){return this.data.Ie()}last(){return this.data.Ae()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.me((e,n)=>(t(e),!1))}qe(t,e){const n=this.data.Ve(t[0]);for(;n.Se();){const s=n.be();if(this.dt(s.key,t[1])>=0)return;e(s.key)}}Ue(t,e){let n;for(n=void 0!==e?this.data.Ve(e):this.data.Pe();n.Se();)if(!t(n.be().key))return}Ke(t){const e=this.data.Ve(t);return e.Se()?e.be().key:null}Pe(){return new ho(this.data.Pe())}Ve(t){return new ho(this.data.Ve(t))}add(t){return this.copy(this.data.remove(t).Ee(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}Rt(){return this.data.Rt()}Qe(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof ao))return!1;if(this.size!==t.size)return!1;const e=this.data.Pe(),n=t.data.Pe();for(;e.Se();){const t=e.be().key,s=n.be().key;if(0!==this.dt(t,s))return!1}return!0}gt(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new ao(this.dt);return e.data=t,e}}class ho{constructor(t){this.We=t}be(){return this.We.be().key}Se(){return this.We.Se()}}const uo=new io(ui.dt);function co(){return uo}function lo(){return co()}const fo=new io(ui.dt);function po(){return fo}const go=new io(ui.dt),mo=new ao(ui.dt);function yo(...t){let e=mo;for(const n of t)e=e.add(n);return e}const wo=new ao(ti);function vo(){return wo}class bo{constructor(t){this.dt=t?(e,n)=>t(e,n)||ui.dt(e.key,n.key):(t,e)=>ui.dt(t.key,e.key),this.je=po(),this.Ge=new io(this.dt)}static ze(t){return new bo(t.dt)}has(t){return null!=this.je.get(t)}get(t){return this.je.get(t)}first(){return this.Ge.Ie()}last(){return this.Ge.Ae()}Rt(){return this.Ge.Rt()}indexOf(t){const e=this.je.get(t);return e?this.Ge.indexOf(e):-1}get size(){return this.Ge.size}forEach(t){this.Ge.me((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.je.Ee(t.key,t),e.Ge.Ee(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.je.remove(t),this.Ge.remove(e)):this}isEqual(t){if(!(t instanceof bo))return!1;if(this.size!==t.size)return!1;const e=this.Ge.Pe(),n=t.Ge.Pe();for(;e.Se();){const t=e.be().key,s=n.be().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new bo;return n.dt=this.dt,n.je=t,n.Ge=e,n}}class Eo{constructor(){this.He=new io(ui.dt)}track(t){const e=t.doc.key,n=this.He.get(e);n?0!==t.type&&3===n.type?this.He=this.He.Ee(e,t):3===t.type&&1!==n.type?this.He=this.He.Ee(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.He=this.He.Ee(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.He=this.He.Ee(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.He=this.He.remove(e):1===t.type&&2===n.type?this.He=this.He.Ee(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.He=this.He.Ee(e,{type:2,doc:t.doc}):xs():this.He=this.He.Ee(e,t)}Je(){const t=[];return this.He.me((e,n)=>{t.push(n)}),t}}class Io{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.Ye=n,this.docChanges=s,this.Xe=i,this.fromCache=r,this.Ze=o,this.tn=a}static en(t,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Io(t,e,bo.ze(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.Xe.Rt()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.Ze===t.Ze&&this.Xe.isEqual(t.Xe)&&yr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ye.isEqual(t.Ye)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class To{constructor(t,e,n,s,i){this.ie=t,this.nn=e,this.sn=n,this.rn=s,this.on=i}static cn(t,e){const n=new Map;return n.set(t,_o.un(t,e)),new To(ii.min(),n,vo(),co(),yo())}}class _o{constructor(t,e,n,s,i){this.resumeToken=t,this.an=e,this.hn=n,this.ln=s,this._n=i}static un(t,e){return new _o(pi.qt,e,yo(),yo(),yo())}}class Ao{constructor(t,e,n,s){this.fn=t,this.removedTargetIds=e,this.key=n,this.dn=s}}class No{constructor(t,e){this.targetId=t,this.wn=e}}class xo{constructor(t,e,n=pi.qt,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class So{constructor(){this.En=0,this.Tn=Ro(),this.In=pi.qt,this.An=!1,this.mn=!0}get an(){return this.An}get resumeToken(){return this.In}get Rn(){return 0!==this.En}get Pn(){return this.mn}Vn(t){t.Bt()>0&&(this.mn=!0,this.In=t)}gn(){let t=yo(),e=yo(),n=yo();return this.Tn.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:xs()}}),new _o(this.In,this.An,t,e,n)}yn(){this.mn=!1,this.Tn=Ro()}pn(t,e){this.mn=!0,this.Tn=this.Tn.Ee(t,e)}vn(t){this.mn=!0,this.Tn=this.Tn.remove(t)}bn(){this.En+=1}Sn(){this.En-=1}Dn(){this.mn=!0,this.An=!0}}class ko{constructor(t){this.Cn=t,this.Nn=new Map,this.xn=co(),this.kn=Do(),this.On=new ao(ti)}Mn(t){for(const e of t.fn)t.dn instanceof Vi?this.Fn(e,t.dn):t.dn instanceof Mi&&this.$n(e,t.key,t.dn);for(const e of t.removedTargetIds)this.$n(e,t.key,t.dn)}Ln(t){this.Bn(t,e=>{const n=this.qn(e);switch(t.state){case 0:this.Un(e)&&n.Vn(t.resumeToken);break;case 1:n.Sn(),n.Rn||n.yn(),n.Vn(t.resumeToken);break;case 2:n.Sn(),n.Rn||this.removeTarget(e);break;case 3:this.Un(e)&&(n.Dn(),n.Vn(t.resumeToken));break;case 4:this.Un(e)&&(this.Kn(e),n.Vn(t.resumeToken));break;default:xs()}})}Bn(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Nn.forEach((t,n)=>{this.Un(n)&&e(n)})}Qn(t){const e=t.targetId,n=t.wn.count,s=this.Wn(e);if(s){const t=s.target;if(Gi(t))if(0===n){const n=new ui(t.path);this.$n(e,n,new Mi(n,ii.min()))}else Ss(1===n);else this.jn(e)!==n&&(this.Kn(e),this.On=this.On.add(e))}}Gn(t){const e=new Map;this.Nn.forEach((n,s)=>{const i=this.Wn(s);if(i){if(n.an&&Gi(i.target)){const e=new ui(i.target.path);null!==this.xn.get(e)||this.zn(s,e)||this.$n(s,e,new Mi(e,t))}n.Pn&&(e.set(s,n.gn()),n.yn())}});let n=yo();this.kn.forEach((t,e)=>{let s=!0;e.Ue(t=>{const e=this.Wn(t);return!e||2===e.se||(s=!1,!1)}),s&&(n=n.add(t))});const s=new To(t,e,this.On,this.xn,n);return this.xn=co(),this.kn=Do(),this.On=new ao(ti),s}Fn(t,e){if(!this.Un(t))return;const n=this.zn(t,e.key)?2:0;this.qn(t).pn(e.key,n),this.xn=this.xn.Ee(e.key,e),this.kn=this.kn.Ee(e.key,this.Hn(e.key).add(t))}$n(t,e,n){if(!this.Un(t))return;const s=this.qn(t);this.zn(t,e)?s.pn(e,1):s.vn(e),this.kn=this.kn.Ee(e,this.Hn(e).delete(t)),n&&(this.xn=this.xn.Ee(e,n))}removeTarget(t){this.Nn.delete(t)}jn(t){const e=this.qn(t).gn();return this.Cn.Jn(t).size+e.hn.size-e._n.size}bn(t){this.qn(t).bn()}qn(t){let e=this.Nn.get(t);return e||(e=new So,this.Nn.set(t,e)),e}Hn(t){let e=this.kn.get(t);return e||(e=new ao(ti),this.kn=this.kn.Ee(t,e)),e}Un(t){const e=null!==this.Wn(t);return e||Ts("WatchChangeAggregator","Detected inactive target",t),e}Wn(t){const e=this.Nn.get(t);return e&&e.Rn?null:this.Cn.Yn(t)}Kn(t){this.Nn.set(t,new So),this.Cn.Jn(t).forEach(e=>{this.$n(t,e,null)})}zn(t,e){return this.Cn.Jn(t).has(e)}}function Do(){return new io(ui.dt)}function Ro(){return new io(ui.dt)}const Co={asc:"ASCENDING",desc:"DESCENDING"},Oo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Lo{constructor(t,e){this.p=t,this.ue=e}}function Po(t,e){return t.ue?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Uo(t,e){return t.ue?e.toBase64():e.toUint8Array()}function Vo(t){return Ss(!!t),ii.at(function(t){const e=mi(t);return new si(e.seconds,e.nanos)}(t))}function Mo(t,e){return function(t){return new oi(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).yt()}function qo(t){const e=oi.vt(t);return Ss(na(e)),e}function Fo(t,e){return Mo(t.p,e.path)}function $o(t,e){const n=qo(e);if(n.get(1)!==t.p.projectId)throw new Rs(Ds.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.p.projectId);if(n.get(3)!==t.p.database)throw new Rs(Ds.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.p.database);return new ui(zo(n))}function jo(t,e){return Mo(t.p,e)}function Bo(t){const e=qo(t);return 4===e.length?oi.bt():zo(e)}function Go(t){return new oi(["projects",t.p.projectId,"databases",t.p.database]).yt()}function zo(t){return Ss(t.length>4&&"documents"===t.get(4)),t.Et(5)}function Ko(t,e,n){return{name:Fo(t,e),fields:n.proto.mapValue.fields}}function Ho(t,e){let n;if(e instanceof Wr)n={update:Ko(t,e.key,e.value)};else if(e instanceof eo)n={delete:Fo(t,e.key)};else if(e instanceof Yr)n={update:Ko(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.yt())),{fieldPaths:e}}(e.we)};else{if(!(e instanceof no))return xs();n={verify:Fo(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Rr)return{fieldPath:e.field.yt(),setToServerValue:"REQUEST_TIME"};if(n instanceof Cr)return{fieldPath:e.field.yt(),appendMissingElements:{values:n.elements}};if(n instanceof Lr)return{fieldPath:e.field.yt(),removeAllFromArray:{values:n.elements}};if(n instanceof Ur)return{fieldPath:e.field.yt(),increment:n.he};throw xs()})(0,t))),e.de.fe||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return Po(t,e._t())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:xs()}(t,e.de)),n}function Xo(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?$r.updateTime(Vo(t.updateTime)):void 0!==t.exists?$r.exists(t.exists):$r._e()}(e.currentDocument):$r._e(),s=e.updateTransforms?e.updateTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)Ss("REQUEST_TIME"===e.setToServerValue),n=new Rr;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Cr(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Lr(t)}else"increment"in e?n=new Ur(t,e.increment):xs();const s=hi.Nt(e.fieldPath);return new qr(s,n)})(t,e)):[];if(e.update){e.update.name;const i=$o(t,e.update.name),r=new Oi({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new di(e.map(t=>hi.Nt(t)))}(e.updateMask);return new Yr(i,r,t,n,s)}return new Wr(i,r,n,s)}if(e.delete){const s=$o(t,e.delete);return new eo(s,n)}if(e.verify){const s=$o(t,e.verify);return new no(s,n)}return xs()}function Wo(t,e){return{documents:[jo(t,e.path)]}}function Yo(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=jo(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=jo(t,s.Tt()),n.structuredQuery.from=[{collectionId:s.At()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Ri(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NAN"}};if(Di(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ri(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NOT_NAN"}};if(Di(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ta(t.field),op:function(t){return Oo[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:ta(t.field),direction:function(t){return Co[t]}(t.dir)}})(t))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.ue||$s(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Jo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Jo(e.endAt)),n}function Qo(t){let e=Bo(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){Ss(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=ea(t.unaryFilter.field);return zi.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=ea(t.unaryFilter.field);return zi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ea(t.unaryFilter.field);return zi.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=ea(t.unaryFilter.field);return zi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return xs()}}(e)]:void 0!==e.fieldFilter?[function(t){return zi.create(ea(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return xs()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):xs():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new nr(ea(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return $s(e="object"==typeof t?t.value:t)?null:e}(n.limit));let h=null;n.startAt&&(h=Zo(n.startAt));let u=null;return n.endAt&&(u=Zo(n.endAt)),ar(e,i,o,r,a,"F",h,u)}function Jo(t){return{before:t.before,values:t.position}}function Zo(t){const e=!!t.before,n=t.values||[];return new tr(n,e)}function ta(t){return{fieldPath:t.yt()}}function ea(t){return hi.Nt(t.fieldPath)}function na(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function sa(t){return new Lo(t,!0)}class ia{constructor(t){this.Xn=null,this.Zn=null,this.result=void 0,this.error=void 0,this.ts=!1,this.es=!1,t(t=>{this.ts=!0,this.result=t,this.Xn&&this.Xn(t)},t=>{this.ts=!0,this.error=t,this.Zn&&this.Zn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.es&&xs(),this.es=!0,this.ts?this.error?this.ns(e,this.error):this.ss(t,this.result):new ia((n,s)=>{this.Xn=(e=>{this.ss(t,e).next(n,s)}),this.Zn=(t=>{this.ns(e,t).next(n,s)})})}rs(){return new Promise((t,e)=>{this.next(t,e)})}os(t){try{const e=t();return e instanceof ia?e:ia.resolve(e)}catch(t){return ia.reject(t)}}ss(t,e){return t?this.os(()=>t(e)):ia.resolve(e)}ns(t,e){return t?this.os(()=>t(e)):ia.reject(e)}static resolve(t){return new ia((e,n)=>{e(t)})}static reject(t){return new ia((e,n)=>{n(t)})}static cs(t){return new ia((e,n)=>{let s=0,i=0,r=!1;t.forEach(t=>{++s,t.next(()=>{++i,r&&i===s&&e()},t=>n(t))}),r=!0,i===s&&e()})}static us(t){let e=ia.resolve(!1);for(const n of t)e=e.next(t=>t?ia.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.cs(n)}}class ra{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.hs=new Ys,this.transaction.oncomplete=(()=>{this.hs.resolve()}),this.transaction.onabort=(()=>{e.error?this.hs.reject(new ha(t,e.error)):this.hs.resolve()}),this.transaction.onerror=(e=>{const n=da(e.target.error);this.hs.reject(new ha(t,n))})}static open(t,e,n,s){try{return new ra(e,t.transaction(s,n))}catch(t){throw new ha(e,t)}}get ls(){return this.hs.promise}abort(t){t&&this.hs.reject(t),this.aborted||(Ts("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new ca(e)}}class oa{constructor(t,e,n){this.name=t,this.version=e,this._s=n,12.2===oa.fs(s())&&_s("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Ts("SimpleDb","Removing database:",t),la(window.indexedDB.deleteDatabase(t)).rs()}static L(){if("undefined"==typeof indexedDB)return!1;if(oa.ds())return!0;const t=s(),e=oa.fs(t),n=0<e&&e<10,i=oa.ws(t),r=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static ds(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Es)}static Ts(t,e){return t.store(e)}static fs(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static ws(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Is(t){return this.db||(Ts("SimpleDb","Opening database:",this.name),this.db=await new Promise((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=(t=>{const n=t.target.result;e(n)}),s.onblocked=(()=>{n(new ha(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),s.onerror=(e=>{const s=e.target.error;"VersionError"===s.name?n(new Rs(Ds.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new ha(t,s))}),s.onupgradeneeded=(t=>{Ts("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this._s.As(e,s.transaction,t.oldVersion,this.version).next(()=>{Ts("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.Rs&&(this.db.onversionchange=(t=>this.Rs(t))),this.db}Ps(t){this.Rs=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n,s){const i="readonly"===e;for(;;){0;try{this.db=await this.Is(t);const e=ra.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).catch(t=>(e.abort(t),ia.reject(t))).rs();return r.catch(()=>{}),await e.ls,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(Ts("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class aa{constructor(t){this.Vs=t,this.gs=!1,this.ys=null}get ts(){return this.gs}get ps(){return this.ys}set cursor(t){this.Vs=t}done(){this.gs=!0}vs(t){this.ys=t}delete(){return la(this.Vs.delete())}}class ha extends Rs{constructor(t,e){super(Ds.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function ua(t){return"IndexedDbTransactionError"===t.name}class ca{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Ts("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Ts("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),la(n)}add(t){return Ts("SimpleDb","ADD",this.store.name,t,t),la(this.store.add(t))}get(t){return la(this.store.get(t)).next(e=>(void 0===e&&(e=null),Ts("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return Ts("SimpleDb","DELETE",this.store.name,t),la(this.store.delete(t))}count(){return Ts("SimpleDb","COUNT",this.store.name),la(this.store.count())}bs(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.Ss(n,(t,e)=>{s.push(e)}).next(()=>s)}Ds(t,e){Ts("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.Cs=!1;const s=this.cursor(n);return this.Ss(s,(t,e,n)=>n.delete())}Ns(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.Ss(s,e)}xs(t){const e=this.cursor({});return new ia((n,s)=>{e.onerror=(t=>{const e=da(t.target.error);s(e)}),e.onsuccess=(e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()})})}Ss(t,e){const n=[];return new ia((s,i)=>{t.onerror=(t=>{i(t.target.error)}),t.onsuccess=(t=>{const i=t.target.result;if(!i)return void s();const r=new aa(i),o=e(i.primaryKey,i.value,r);if(o instanceof ia){const t=o.catch(t=>(r.done(),ia.reject(t)));n.push(t)}r.ts?s():null===r.ps?i.continue():i.continue(r.ps)})}).next(()=>ia.cs(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Cs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function la(t){return new ia((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=da(t.target.error);n(e)})})}let fa=!1;function da(t){const e=oa.fs(s());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Rs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return fa||(fa=!0,setTimeout(()=>{throw t},0)),t}}return t}class pa{constructor(t,e,n,s,i){this.ks=t,this.Os=e,this.Ms=n,this.op=s,this.Fs=i,this.$s=new Ys,this.then=this.$s.promise.then.bind(this.$s.promise),this.$s.promise.catch(t=>{})}static Ls(t,e,n,s,i){const r=Date.now()+n,o=new pa(t,e,r,s,i);return o.start(n),o}start(t){this.Bs=setTimeout(()=>this.qs(),t)}Us(){return this.qs()}cancel(t){null!==this.Bs&&(this.clearTimeout(),this.$s.reject(new Rs(Ds.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}qs(){this.ks.Ks(()=>null!==this.Bs?(this.clearTimeout(),this.op().then(t=>this.$s.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Bs&&(this.Fs(this),clearTimeout(this.Bs),this.Bs=null)}}function ga(t,e){if(_s("AsyncQueue",`${e}: ${t}`),ua(t))return new Rs(Ds.UNAVAILABLE,`${e}: ${t}`);throw t}class ma{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Qs=t,this.Os=e,this.Ws=n,this.js=s,this.Gs=i,this.zs=0,this.Hs=null,this.Js=Date.now(),this.reset()}reset(){this.zs=0}Ys(){this.zs=this.Gs}Xs(t){this.cancel();const e=Math.floor(this.zs+this.Zs()),n=Math.max(0,Date.now()-this.Js),s=Math.max(0,e-n);s>0&&Ts("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.zs} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Hs=this.Qs.ti(this.Os,s,()=>(this.Js=Date.now(),t())),this.zs*=this.js,this.zs<this.Ws&&(this.zs=this.Ws),this.zs>this.Gs&&(this.zs=this.Gs)}ei(){null!==this.Hs&&(this.Hs.Us(),this.Hs=null)}cancel(){null!==this.Hs&&(this.Hs.cancel(),this.Hs=null)}Zs(){return(Math.random()-.5)*this.zs}}class ya{constructor(t,e,n,s,i,r){this.Qs=t,this.ni=n,this.si=s,this.ii=i,this.listener=r,this.state=0,this.ri=0,this.oi=null,this.stream=null,this.ci=new ma(t,e)}ui(){return 1===this.state||2===this.state||4===this.state}ai(){return 2===this.state}start(){3!==this.state?this.auth():this.hi()}async stop(){this.ui()&&await this.close(0)}li(){this.state=0,this.ci.reset()}_i(){this.ai()&&null===this.oi&&(this.oi=this.Qs.ti(this.ni,6e4,()=>this.fi()))}di(t){this.wi(),this.stream.send(t)}async fi(){if(this.ai())return this.close(0)}wi(){this.oi&&(this.oi.cancel(),this.oi=null)}async close(t,e){this.wi(),this.ci.cancel(),this.ri++,3!==t?this.ci.reset():e&&e.code===Ds.RESOURCE_EXHAUSTED?(_s(e.toString()),_s("Using maximum backoff delay to prevent overloading the backend."),this.ci.Ys()):e&&e.code===Ds.UNAUTHENTICATED&&this.ii._(),null!==this.stream&&(this.Ei(),this.stream.close(),this.stream=null),this.state=t,await this.listener.W(e)}Ei(){}auth(){this.state=1;const t=this.Ti(this.ri),e=this.ri;this.ii.getToken().then(t=>{this.ri===e&&this.Ii(t)},e=>{t(()=>{const t=new Rs(Ds.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ai(t)})})}Ii(t){const e=this.Ti(this.ri);this.stream=this.mi(t),this.stream.U(()=>{e(()=>(this.state=2,this.listener.U()))}),this.stream.W(t=>{e(()=>this.Ai(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}hi(){this.state=4,this.ci.Xs(async()=>{this.state=0,this.start()})}Ai(t){return Ts("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}Ti(t){return e=>{this.Qs.Ks(()=>this.ri===t?e():(Ts("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class wa extends ya{constructor(t,e,n,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.le=s}mi(t){return this.si.ot("Listen",t)}onMessage(t){this.ci.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:xs()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.ue?(Ss(void 0===e||"string"==typeof e),pi.fromBase64String(e||"")):(Ss(void 0===e||e instanceof Uint8Array),pi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Ds.UNKNOWN:Xs(t.code);return new Rs(e,t.message||"")}(o);n=new xo(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=$o(t,s.document.name),r=Vo(s.document.updateTime),o=new Oi({mapValue:{fields:s.document.fields}}),a=new Vi(i,r,o,{}),h=s.targetIds||[],u=s.removedTargetIds||[];n=new Ao(h,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=$o(t,s.document),r=s.readTime?Vo(s.readTime):ii.min(),o=new Mi(i,r),a=s.removedTargetIds||[];n=new Ao([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=$o(t,s.document),r=s.removedTargetIds||[];n=new Ao([],r,i,null)}else{if(!("filter"in e))return xs();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new so(s),r=t.targetId;n=new No(r,i)}}return n}(this.le,t),n=function(t){if(!("targetChange"in t))return ii.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ii.min():e.readTime?Vo(e.readTime):ii.min()}(t);return this.listener.Ri(e,n)}Pi(t){const e={};e.database=Go(this.le),e.addTarget=function(t,e){let n;const s=e.target;return(n=Gi(s)?{documents:Wo(t,s)}:{query:Yo(t,s)}).targetId=e.targetId,e.resumeToken.Bt()>0?n.resumeToken=Uo(t,e.resumeToken):e.ie.ht(ii.min())>0&&(n.readTime=Po(t,e.ie._t())),n}(this.le,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return xs()}}(0,e.se);return null==n?null:{"goog-listen-tags":n}}(this.le,t);n&&(e.labels=n),this.di(e)}Vi(t){const e={};e.database=Go(this.le),e.removeTarget=t,this.di(e)}}class va extends ya{constructor(t,e,n,s,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.le=s,this.gi=!1}get yi(){return this.gi}start(){this.gi=!1,this.lastStreamToken=void 0,super.start()}Ei(){this.gi&&this.pi([])}mi(t){return this.si.ot("Write",t)}onMessage(t){if(Ss(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gi){this.ci.reset();const e=function(t,e){return t&&t.length>0?(Ss(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?Vo(t.updateTime):Vo(e);n.isEqual(ii.min())&&(n=Vo(e));let s=null;return t.transformResults&&t.transformResults.length>0&&(s=t.transformResults),new Fr(n,s)})(t,e))):[]}(t.writeResults,t.commitTime),n=Vo(t.commitTime);return this.listener.vi(n,e)}return Ss(!t.writeResults||0===t.writeResults.length),this.gi=!0,this.listener.bi()}Si(){const t={};t.database=Go(this.le),this.di(t)}pi(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>Ho(this.le,t))};this.di(e)}}class ba extends class{}{constructor(t,e,n){super(),this.credentials=t,this.si=e,this.le=n,this.Di=!1}Ci(){if(this.Di)throw new Rs(Ds.FAILED_PRECONDITION,"The client has already been terminated.")}et(t,e,n){return this.Ci(),this.credentials.getToken().then(s=>this.si.et(t,e,n,s)).catch(t=>{throw t.code===Ds.UNAUTHENTICATED&&this.credentials._(),t})}rt(t,e,n){return this.Ci(),this.credentials.getToken().then(s=>this.si.rt(t,e,n,s)).catch(t=>{throw t.code===Ds.UNAUTHENTICATED&&this.credentials._(),t})}terminate(){this.Di=!1}}const Ea="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ia{constructor(){this.Ni=[]}xi(t){this.Ni.push(t)}ki(){this.Ni.forEach(t=>t())}}const Ta={Oi:!1,Mi:0,Fi:0,$i:0};class _a{constructor(t,e,n){this.Li=t,this.Bi=e,this.qi=n}static Ui(t){return new _a(t,_a.Ki,_a.Qi)}}_a.Ki=10,_a.Qi=1e3,_a.Wi=new _a(41943040,_a.Ki,_a.Qi),_a.ji=new _a(-1,0,0);class Aa{constructor(t,e){this.previousValue=t,e&&(e.Gi=(t=>this.zi(t)),this.Hi=(t=>e.Ji(t)))}zi(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.Hi&&this.Hi(t),t}}async function Na(t){if(t.code!==Ds.FAILED_PRECONDITION||t.message!==Ea)throw t;Ts("LocalStore","Unexpectedly lost primary lease")}Aa.Yi=-1;class xa{constructor(t,e,n,s){this.batchId=t,this.Xi=e,this.baseMutations=n,this.mutations=s}Zi(t,e,n){const s=n.tr;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(t)&&(e=Gr(i,e,s[n]))}return e}er(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=zr(n,e,e,this.Xi));const n=e;for(const s of this.mutations)s.key.isEqual(t)&&(e=zr(s,e,n,this.Xi));return e}nr(t){let e=t;return this.mutations.forEach(n=>{const s=this.er(n.key,t.get(n.key));s&&(e=e.Ee(n.key,s))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),yo())}isEqual(t){return this.batchId===t.batchId&&ei(this.mutations,t.mutations,(t,e)=>Hr(t,e))&&ei(this.baseMutations,t.baseMutations,(t,e)=>Hr(t,e))}}class Sa{constructor(t,e,n,s){this.batch=t,this.sr=e,this.tr=n,this.ir=s}static from(t,e,n){Ss(t.mutations.length===n.length);let s=go;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.Ee(i[t].key,n[t].version);return new Sa(t,e,n,s)}}class ka{constructor(t,e){this.rr=t,this.cr=e,this.ur={}}get(t){const e=this.rr(t),n=this.ur[e];if(void 0!==n)for(const[e,s]of n)if(this.cr(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.rr(t),s=this.ur[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.cr(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.ur[n]=[[t,e]]}delete(t){const e=this.rr(t),n=this.ur[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.cr(n[s][0],t))return 1===n.length?delete this.ur[e]:n.splice(s,1),!0;return!1}forEach(t){li(this.ur,(e,n)=>{for(const[e,s]of n)t(e,s)})}Rt(){return fi(this.ur)}}class Da{constructor(){this.ar=new ka(t=>t.toString(),(t,e)=>t.isEqual(e)),this.hr=!1}lr(t){const e=this.ar.get(t);return e?e.readTime:ii.min()}_r(t,e){this.dr(),this.ar.set(t.key,{wr:t,readTime:e})}Er(t,e=null){this.dr(),this.ar.set(t,{wr:null,readTime:e})}Tr(t,e){this.dr();const n=this.ar.get(e);return void 0!==n?ia.resolve(n.wr):this.Ir(t,e)}getEntries(t,e){return this.Ar(t,e)}apply(t){return this.dr(),this.hr=!0,this.mr(t)}dr(){}}function Ra([t,e],[n,s]){const i=ti(t,n);return 0===i?ti(e,s):i}class Ca{constructor(t){this.Rr=t,this.buffer=new ao(Ra),this.Pr=0}Vr(){return++this.Pr}gr(t){const e=[t,this.Vr()];if(this.buffer.size<this.Rr)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Ra(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Oa{constructor(t,e){this.yr=t,this.ks=e,this.pr=!1,this.vr=null}start(t){-1!==this.yr.params.Li&&this.br(t)}stop(){this.vr&&(this.vr.cancel(),this.vr=null)}get Sr(){return null!==this.vr}br(t){const e=this.pr?3e5:6e4;Ts("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.vr=this.ks.ti("lru_garbage_collection",e,async()=>{this.vr=null,this.pr=!0;try{await t.Dr(this.yr)}catch(t){ua(t)?Ts("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Na(t)}await this.br(t)})}}class La{constructor(t,e){this.Cr=t,this.params=e}Nr(t,e){return this.Cr.kr(t).next(t=>Math.floor(e/100*t))}Or(t,e){if(0===e)return ia.resolve(Aa.Yi);const n=new Ca(e);return this.Cr.Bn(t,t=>n.gr(t.sequenceNumber)).next(()=>this.Cr.Mr(t,t=>n.gr(t))).next(()=>n.maxValue)}Fr(t,e,n){return this.Cr.Fr(t,e,n)}$r(t,e){return this.Cr.$r(t,e)}Lr(t,e){return-1===this.params.Li?(Ts("LruGarbageCollector","Garbage collection skipped; disabled"),ia.resolve(Ta)):this.Br(t).next(n=>n<this.params.Li?(Ts("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Li),Ta):this.qr(t,e))}Br(t){return this.Cr.Br(t)}qr(t,e){let n,s,i,r,o,a,u;const c=Date.now();return this.Nr(t,this.params.Bi).next(e=>(e>this.params.qi?(Ts("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.qi} from `+e),s=this.params.qi):s=e,r=Date.now(),this.Or(t,s))).next(s=>(n=s,o=Date.now(),this.Fr(t,n,e))).next(e=>(i=e,a=Date.now(),this.$r(t,n))).next(t=>(u=Date.now(),Is()<=h.DEBUG&&Ts("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-c}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-c}ms`),ia.resolve({Oi:!0,Mi:s,Fi:i,$i:t})))}}function Pa(t,e,n){if(!n)throw new Rs(Ds.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Ua(t){if(!ui.Mt(t))throw new Rs(Ds.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Va(t){if(ui.Mt(t))throw new Rs(Ds.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Ma(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":xs()}function qa(t,e){if("_delegate"in t&&(t=t.Ur),!(t instanceof e)){if(e.name===t.constructor.name)throw new Rs(Ds.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ma(t);throw new Rs(Ds.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Fa(t,e){if(e<=0)throw new Rs(Ds.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class $a{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Rs(Ds.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Rs(Ds.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,function(t,e,n,s){if(!0===e&&!0===s)throw new Rs(Ds.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties}}const ja=new Map;class Ba{constructor(t,e){this.Kr="(lite)",this.Qr=new $a({}),this.Wr=!1,t instanceof Ms?(this.jr=t,this.Gr=new Os):(this.zr=t,this.jr=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Rs(Ds.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ms(t.options.projectId)}(t),this.Gr=new Ls(e))}get app(){if(!this.zr)throw new Rs(Ds.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.zr}get Hr(){return this.Wr}get Jr(){return void 0!==this.Yr}Xr(t){if(this.Wr)throw new Rs(Ds.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.Qr=new $a(t),void 0!==t.credentials&&(this.Gr=function(t){if(!t)return new Os;switch(t.type){case"gapi":const e=t.client;return Ss(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Us(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Rs(Ds.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}Zr(){return this.Qr}eo(){return this.Wr=!0,this.Qr}_delete(){return this.Yr||(this.Yr=this.no()),this.Yr}no(){return function(t){const e=ja.get(t);e&&(Ts("ComponentProvider","Removing Datastore"),ja.delete(t),e.terminate())}(this),Promise.resolve()}}function Ga(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Ka(e)),e=za(t.get(n),e);return Ka(e)}function za(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function Ka(t){return t+""}function Ha(t){const e=t.length;if(Ss(e>=2),2===e)return Ss(""===t.charAt(0)&&""===t.charAt(1)),oi.bt();const n=e-2,s=[];let i="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>r)&&xs(),t.charAt(e+1)){case"":const r=t.substring(n,e);let o;0===i.length?o=r:(o=i+=r,i=""),s.push(o);break;case"":i+=t.substring(n,e),i+="\0";break;case"":i+=t.substring(n,e+1);break;default:xs()}n=e+2}return new oi(s)}class Xa{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Wa{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Wa.store="owner",Wa.key="owner";class Ya{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Ya.store="mutationQueues",Ya.keyPath="userId";class Qa{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}Qa.store="mutations",Qa.keyPath="batchId",Qa.userMutationsIndex="userMutationsIndex",Qa.userMutationsKeyPath=["userId","batchId"];class Ja{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,Ga(e)]}static key(t,e,n){return[t,Ga(e),n]}}Ja.store="documentMutations",Ja.PLACEHOLDER=new Ja;class Za{constructor(t,e){this.path=t,this.readTime=e}}class th{constructor(t,e){this.path=t,this.version=e}}class eh{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}eh.store="remoteDocuments",eh.readTimeIndex="readTimeIndex",eh.readTimeIndexPath="readTime",eh.collectionReadTimeIndex="collectionReadTimeIndex",eh.collectionReadTimeIndexPath=["parentPath","readTime"];class nh{constructor(t){this.byteSize=t}}nh.store="remoteDocumentGlobal",nh.key="remoteDocumentGlobalKey";class sh{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}sh.store="targets",sh.keyPath="targetId",sh.queryTargetsIndexName="queryTargetsIndex",sh.queryTargetsKeyPath=["canonicalId","targetId"];class ih{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}ih.store="targetDocuments",ih.keyPath=["targetId","path"],ih.documentTargetsIndex="documentTargetsIndex",ih.documentTargetsKeyPath=["path","targetId"];class rh{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}rh.key="targetGlobalKey",rh.store="targetGlobal";class oh{constructor(t,e){this.collectionId=t,this.parent=e}}oh.store="collectionParents",oh.keyPath=["collectionId","parent"];class ah{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}ah.store="clientMetadata",ah.keyPath="clientId";class hh{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}hh.store="bundles",hh.keyPath="bundleId";class uh{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}uh.store="namedQueries",uh.keyPath="name";const ch=[...[...[...[...[Ya.store,Qa.store,Ja.store,eh.store,sh.store,Wa.store,rh.store,ih.store],ah.store],nh.store],oh.store],hh.store,uh.store];class lh extends Ia{constructor(t,e){super(),this.so=t,this.io=e}}function fh(t,e){const n=ks(t);return oa.Ts(n.so,e)}class dh{constructor(t){this.ro=t}}function ph(t,e){if(e.document)return function(t,e,n){const s=$o(t,e.name),i=Vo(e.updateTime),r=new Oi({mapValue:{fields:e.fields}});return new Vi(s,i,r,{hasCommittedMutations:!!n})}(t.ro,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=ui.Ft(e.noDocument.path),n=vh(e.noDocument.readTime);return new Mi(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=ui.Ft(e.unknownDocument.path),n=vh(e.unknownDocument.version);return new qi(t,n)}return xs()}function gh(t,e,n){const s=mh(n),i=e.key.path.Tt().gt();if(e instanceof Vi){const n=function(t,e){return{name:Fo(t,e.key),fields:e.Ht().mapValue.fields,updateTime:Po(t,e.version._t())}}(t.ro,e),r=e.hasCommittedMutations;return new eh(null,null,n,r,s,i)}if(e instanceof Mi){const t=e.key.path.gt(),n=wh(e.version),r=e.hasCommittedMutations;return new eh(null,new Za(t,n),null,r,s,i)}if(e instanceof qi){const t=e.key.path.gt(),n=wh(e.version);return new eh(new th(t,n),null,null,!0,s,i)}return xs()}function mh(t){const e=t._t();return[e.seconds,e.nanoseconds]}function yh(t){const e=new si(t[0],t[1]);return ii.at(e)}function wh(t){const e=t._t();return new Xa(e.seconds,e.nanoseconds)}function vh(t){const e=new si(t.seconds,t.nanoseconds);return ii.at(e)}function bh(t,e){const n=(e.baseMutations||[]).map(e=>Xo(t.ro,e));for(let t=e.mutations.length-1;t>=0;--t){const n=e.mutations[t];void 0!==(null==n?void 0:n.transform)&&(e.mutations[t-1].updateTransforms=n.transform.fieldTransforms,e.mutations.splice(t,1),--t)}const s=e.mutations.map(e=>Xo(t.ro,e)),i=si.fromMillis(e.localWriteTimeMs);return new xa(e.batchId,i,n,s)}function Eh(t){const e=vh(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?vh(t.lastLimboFreeSnapshotVersion):ii.min();let s;var i;return void 0!==t.query.documents?(Ss(1===(i=t.query).documents.length),s=gr(hr(Bo(i.documents[0])))):s=function(t){return gr(Qo(t))}(t.query),new Tr(s,t.targetId,0,t.lastListenSequenceNumber,e,n,pi.fromBase64String(t.resumeToken))}function Ih(t,e){const n=wh(e.ie),s=wh(e.lastLimboFreeSnapshotVersion);let i;i=Gi(e.target)?Wo(t.ro,e.target):Yo(t.ro,e.target);const r=e.resumeToken.toBase64();return new sh(e.targetId,ji(e.target),n,r,e.sequenceNumber,s,i)}function Th(t){const e=Qo({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?mr(e,e.limit,"L"):e}class _h{oo(t,e){return Ah(t).get(e).next(t=>{if(t)return{id:(e=t).bundleId,createTime:vh(e.createTime),version:e.version};var e})}co(t,e){return Ah(t).put({bundleId:(n=e).id,createTime:wh(Vo(n.createTime)),version:n.version});var n}uo(t,e){return Nh(t).get(e).next(t=>{if(t)return{name:(e=t).name,query:Th(e.bundledQuery),readTime:vh(e.readTime)};var e})}ao(t,e){return Nh(t).put(function(t){return{name:t.name,readTime:wh(Vo(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Ah(t){return fh(t,hh.store)}function Nh(t){return fh(t,uh.store)}class xh{constructor(){this.ho=new Sh}lo(t,e){return this.ho.add(e),ia.resolve()}_o(t,e){return ia.resolve(this.ho.getEntries(e))}}class Sh{constructor(){this.index={}}add(t){const e=t.At(),n=t.Tt(),s=this.index[e]||new ao(oi.dt),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.At(),n=t.Tt(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new ao(oi.dt)).gt()}}class kh{constructor(){this.fo=new Sh}lo(t,e){if(!this.fo.has(e)){const n=e.At(),s=e.Tt();t.xi(()=>{this.fo.add(e)});const i={collectionId:n,parent:Ga(s)};return Dh(t).put(i)}return ia.resolve()}_o(t,e){const n=[],s=IDBKeyRange.bound([e,""],[ni(e),""],!1,!0);return Dh(t).bs(s).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(Ha(s.parent))}return n})}}function Dh(t){return fh(t,oh.store)}function Rh(t,e,n){const s=t.store(Qa.store),i=t.store(Ja.store),r=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=s.Ns({range:o},(t,e,n)=>(a++,n.delete()));r.push(h.next(()=>{Ss(1===a)}));const u=[];for(const t of n.mutations){const s=Ja.key(e,t.key.path,n.batchId);r.push(i.delete(s)),u.push(t.key)}return ia.cs(r).next(()=>u)}function Ch(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw xs();e=t.noDocument}return JSON.stringify(e).length}class Oh{constructor(t,e,n,s){this.userId=t,this.le=e,this.wo=n,this.Eo=s,this.To={}}static Io(t,e,n,s){Ss(""!==t.uid);const i=t.t()?t.uid:"";return new Oh(i,e,n,s)}Ao(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ph(t).Ns({index:Qa.userMutationsIndex,range:n},(t,n,s)=>{e=!1,s.done()}).next(()=>e)}mo(t,e,n,s){const i=Uh(t),r=Ph(t);return r.add({}).next(o=>{Ss("number"==typeof o);const a=new xa(o,e,n,s),h=function(t,e,n){const s=n.baseMutations.map(e=>Ho(t.ro,e)),i=n.mutations.map(e=>Ho(t.ro,e));return new Qa(e,n.batchId,n.Xi.toMillis(),s,i)}(this.le,this.userId,a),u=[];let c=new ao((t,e)=>ti(t.yt(),e.yt()));for(const t of s){const e=Ja.key(this.userId,t.key.path,o);c=c.add(t.key.path.Tt()),u.push(r.put(h)),u.push(i.put(e,Ja.PLACEHOLDER))}return c.forEach(e=>{u.push(this.wo.lo(t,e))}),t.xi(()=>{this.To[o]=a.keys()}),ia.cs(u).next(()=>a)})}Ro(t,e){return Ph(t).get(e).next(t=>t?(Ss(t.userId===this.userId),bh(this.le,t)):null)}Po(t,e){return this.To[e]?ia.resolve(this.To[e]):this.Ro(t,e).next(t=>{if(t){const n=t.keys();return this.To[e]=n,n}return null})}Vo(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Ph(t).Ns({index:Qa.userMutationsIndex,range:s},(t,e,s)=>{e.userId===this.userId&&(Ss(e.batchId>=n),i=bh(this.le,e)),s.done()}).next(()=>i)}yo(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ph(t).Ns({index:Qa.userMutationsIndex,range:e,reverse:!0},(t,e,s)=>{n=e.batchId,s.done()}).next(()=>n)}po(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ph(t).bs(Qa.userMutationsIndex,e).next(t=>t.map(t=>bh(this.le,t)))}vo(t,e){const n=Ja.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Uh(t).Ns({range:s},(n,s,r)=>{const[o,a,h]=n,u=Ha(a);if(o===this.userId&&e.path.isEqual(u))return Ph(t).get(h).next(t=>{if(!t)throw xs();Ss(t.userId===this.userId),i.push(bh(this.le,t))});r.done()}).next(()=>i)}bo(t,e){let n=new ao(ti);const s=[];return e.forEach(e=>{const i=Ja.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=Uh(t).Ns({range:r},(t,s,i)=>{const[r,o,a]=t,h=Ha(o);r===this.userId&&e.path.isEqual(h)?n=n.add(a):i.done()});s.push(o)}),ia.cs(s).next(()=>this.So(t,n))}Do(t,e){const n=e.path,s=n.length+1,i=Ja.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new ao(ti);return Uh(t).Ns({range:r},(t,e,i)=>{const[r,a,h]=t,u=Ha(a);r===this.userId&&n.Pt(u)?u.length===s&&(o=o.add(h)):i.done()}).next(()=>this.So(t,o))}So(t,e){const n=[],s=[];return e.forEach(e=>{s.push(Ph(t).get(e).next(t=>{if(null===t)throw xs();Ss(t.userId===this.userId),n.push(bh(this.le,t))}))}),ia.cs(s).next(()=>n)}Co(t,e){return Rh(t.so,this.userId,e).next(n=>(t.xi(()=>{this.No(e.batchId)}),ia.forEach(n,e=>this.Eo.xo(t,e))))}No(t){delete this.To[t]}ko(t){return this.Ao(t).next(e=>{if(!e)return ia.resolve();const n=IDBKeyRange.lowerBound(Ja.prefixForUser(this.userId)),s=[];return Uh(t).Ns({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=Ha(t[1]);s.push(e)}else n.done()}).next(()=>{Ss(0===s.length)})})}Oo(t,e){return Lh(t,this.userId,e)}Mo(t){return Vh(t).get(this.userId).next(t=>t||new Ya(this.userId,-1,""))}}function Lh(t,e,n){const s=Ja.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return Uh(t).Ns({range:r,Cs:!0},(t,n,s)=>{const[r,a,h]=t;r===e&&a===i&&(o=!0),s.done()}).next(()=>o)}function Ph(t){return fh(t,Qa.store)}function Uh(t){return fh(t,Ja.store)}function Vh(t){return fh(t,Ya.store)}class Mh{constructor(t){this.Fo=t}next(){return this.Fo+=2,this.Fo}static $o(){return new Mh(0)}static Lo(){return new Mh(-1)}}class qh{constructor(t,e){this.Eo=t,this.le=e}Bo(t){return this.qo(t).next(e=>{const n=new Mh(e.highestTargetId);return e.highestTargetId=n.next(),this.Uo(t,e).next(()=>e.highestTargetId)})}Ko(t){return this.qo(t).next(t=>ii.at(new si(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}Qo(t){return this.qo(t).next(t=>t.highestListenSequenceNumber)}Wo(t,e,n){return this.qo(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n._t()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Uo(t,s)))}jo(t,e){return this.Go(t,e).next(()=>this.qo(t).next(n=>(n.targetCount+=1,this.zo(e,n),this.Uo(t,n))))}Ho(t,e){return this.Go(t,e)}Jo(t,e){return this.Yo(t,e.targetId).next(()=>Fh(t).delete(e.targetId)).next(()=>this.qo(t)).next(e=>(Ss(e.targetCount>0),e.targetCount-=1,this.Uo(t,e)))}Fr(t,e,n){let s=0;const i=[];return Fh(t).Ns((r,o)=>{const a=Eh(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,i.push(this.Jo(t,a)))}).next(()=>ia.cs(i)).next(()=>s)}Bn(t,e){return Fh(t).Ns((t,n)=>{const s=Eh(n);e(s)})}qo(t){return $h(t).get(rh.key).next(t=>(Ss(null!==t),t))}Uo(t,e){return $h(t).put(rh.key,e)}Go(t,e){return Fh(t).put(Ih(this.le,e))}zo(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}Xo(t){return this.qo(t).next(t=>t.targetCount)}Zo(t,e){const n=ji(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Fh(t).Ns({range:s,index:sh.queryTargetsIndexName},(t,n,s)=>{const r=Eh(n);Bi(e,r.target)&&(i=r,s.done())}).next(()=>i)}tc(t,e,n){const s=[],i=jh(t);return e.forEach(e=>{const r=Ga(e.path);s.push(i.put(new ih(n,r))),s.push(this.Eo.ec(t,n,e))}),ia.cs(s)}nc(t,e,n){const s=jh(t);return ia.forEach(e,e=>{const i=Ga(e.path);return ia.cs([s.delete([n,i]),this.Eo.sc(t,n,e)])})}Yo(t,e){const n=jh(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}ic(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=jh(t);let i=yo();return s.Ns({range:n,Cs:!0},(t,e,n)=>{const s=Ha(t[1]),r=new ui(s);i=i.add(r)}).next(()=>i)}Oo(t,e){const n=Ga(e.path),s=IDBKeyRange.bound([n],[ni(n)],!1,!0);let i=0;return jh(t).Ns({index:ih.documentTargetsIndex,Cs:!0,range:s},([t,e],n,s)=>{0!==t&&(i++,s.done())}).next(()=>i>0)}Yn(t,e){return Fh(t).get(e).next(t=>t?Eh(t):null)}}function Fh(t){return fh(t,sh.store)}function $h(t){return fh(t,rh.store)}function jh(t){return fh(t,ih.store)}class Bh{constructor(t,e){this.db=t,this.yr=function(t,e){return new La(t,e)}(this,e)}kr(t){const e=this.rc(t);return this.db.oc().Xo(t).next(t=>e.next(e=>t+e))}rc(t){let e=0;return this.Mr(t,t=>{e++}).next(()=>e)}Bn(t,e){return this.db.oc().Bn(t,e)}Mr(t,e){return this.cc(t,(t,n)=>e(n))}ec(t,e,n){return Gh(t,n)}sc(t,e,n){return Gh(t,n)}Fr(t,e,n){return this.db.oc().Fr(t,e,n)}xo(t,e){return Gh(t,e)}uc(t,e){return function(t,e){let n=!1;return Vh(t).xs(s=>Lh(t,s,e).next(t=>(t&&(n=!0),ia.resolve(!t)))).next(()=>n)}(t,e)}$r(t,e){const n=this.db.hc().ac(),s=[];let i=0;return this.cc(t,(r,o)=>{if(o<=e){const e=this.uc(t,r).next(e=>{if(!e)return i++,n.Tr(t,r).next(()=>(n.Er(r),jh(t).delete([0,Ga(r.path)])))});s.push(e)}}).next(()=>ia.cs(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.re(t.io);return this.db.oc().Ho(t,n)}lc(t,e){return Gh(t,e)}cc(t,e){const n=jh(t);let s,i=Aa.Yi;return n.Ns({index:ih.documentTargetsIndex},([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==Aa.Yi&&e(new ui(Ha(s)),i),i=o,s=r):i=Aa.Yi}).next(()=>{i!==Aa.Yi&&e(new ui(Ha(s)),i)})}Br(t){return this.db.hc()._c(t)}}function Gh(t,e){return jh(t).put(function(t,e){return new ih(0,Ga(t.path),e)}(e,t.io))}class zh{constructor(t,e){this.le=t,this.wo=e}_r(t,e,n){return Xh(t).put(Wh(e),n)}Er(t,e){const n=Xh(t),s=Wh(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.fc(t,n)))}Tr(t,e){return Xh(t).get(Wh(e)).next(t=>this.dc(t))}wc(t,e){return Xh(t).get(Wh(e)).next(t=>{const e=this.dc(t);return e?{wr:e,size:Ch(t)}:null})}getEntries(t,e){let n=lo();return this.Ec(t,e,(t,e)=>{const s=this.dc(e);n=n.Ee(t,s)}).next(()=>n)}Tc(t,e){let n=lo(),s=new io(ui.dt);return this.Ec(t,e,(t,e)=>{const i=this.dc(e);i?(n=n.Ee(t,i),s=s.Ee(t,Ch(e))):(n=n.Ee(t,null),s=s.Ee(t,0))}).next(()=>({Ic:n,Ac:s}))}Ec(t,e,n){if(e.Rt())return ia.resolve();const s=IDBKeyRange.bound(e.first().path.gt(),e.last().path.gt()),i=e.Pe();let r=i.be();return Xh(t).Ns({range:s},(t,e,s)=>{const o=ui.Ft(t);for(;r&&ui.dt(r,o)<0;)n(r,null),r=i.be();r&&r.isEqual(o)&&(n(r,e),r=i.Se()?i.be():null),r?s.vs(r.path.gt()):s.done()}).next(()=>{for(;r;)n(r,null),r=i.Se()?i.be():null})}mc(t,e,n){let s=po();const i=e.path.length+1,r={};if(n.isEqual(ii.min())){const t=e.path.gt();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.gt(),s=mh(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=eh.collectionReadTimeIndex}return Xh(t).Ns(r,(t,n,r)=>{if(t.length!==i)return;const o=ph(this.le,n);e.path.Pt(o.key.path)?o instanceof Vi&&br(e,o)&&(s=s.Ee(o.key,o)):r.done()}).next(()=>s)}ac(t){return new Kh(this,!!t&&t.Rc)}_c(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return Hh(t).get(nh.key).next(t=>(Ss(!!t),t))}fc(t,e){return Hh(t).put(nh.key,e)}dc(t){if(t){const e=ph(this.le,t);return e instanceof Mi&&e.version.isEqual(ii.min())?null:e}return null}}class Kh extends Da{constructor(t,e){super(),this.Pc=t,this.Rc=e,this.Vc=new ka(t=>t.toString(),(t,e)=>t.isEqual(e))}mr(t){const e=[];let n=0,s=new ao((t,e)=>ti(t.yt(),e.yt()));return this.ar.forEach((i,r)=>{const o=this.Vc.get(i);if(r.wr){const a=gh(this.Pc.le,r.wr,this.lr(i));s=s.add(i.path.Tt());const h=Ch(a);n+=h-o,e.push(this.Pc._r(t,i,a))}else if(n-=o,this.Rc){const n=gh(this.Pc.le,new Mi(i,ii.min()),this.lr(i));e.push(this.Pc._r(t,i,n))}else e.push(this.Pc.Er(t,i))}),s.forEach(n=>{e.push(this.Pc.wo.lo(t,n))}),e.push(this.Pc.updateMetadata(t,n)),ia.cs(e)}Ir(t,e){return this.Pc.wc(t,e).next(t=>null===t?(this.Vc.set(e,0),null):(this.Vc.set(e,t.size),t.wr))}Ar(t,e){return this.Pc.Tc(t,e).next(({Ic:t,Ac:e})=>(e.forEach((t,e)=>{this.Vc.set(t,e)}),t))}}function Hh(t){return fh(t,nh.store)}function Xh(t){return fh(t,eh.store)}function Wh(t){return t.path.gt()}class Yh{constructor(t){this.le=t}As(t,e,n,s){Ss(n<s&&n>=0&&s<=11);const i=new ra("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore(Wa.store)}(t),function(t){t.createObjectStore(Ya.store,{keyPath:Ya.keyPath}),t.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ja.store)}(t),Qh(t),function(t){t.createObjectStore(eh.store)}(t));let r=ia.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(ih.store),t.deleteObjectStore(sh.store),t.deleteObjectStore(rh.store)}(t),Qh(t)),r=r.next(()=>(function(t){const e=i.store(rh.store),n=new rh(0,0,ii.min()._t(),0);return e.put(rh.key,n)})())),n<4&&s>=4&&(0!==n&&(r=r.next(()=>(function(t,e){return e.store(Qa.store).bs().next(n=>{t.deleteObjectStore(Qa.store),t.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0});const s=e.store(Qa.store),i=n.map(t=>s.put(t));return ia.cs(i)})})(t,i))),r=r.next(()=>{!function(t){t.createObjectStore(ah.store,{keyPath:ah.keyPath})}(t)})),n<5&&s>=5&&(r=r.next(()=>this.gc(i))),n<6&&s>=6&&(r=r.next(()=>((function(t){t.createObjectStore(nh.store)})(t),this.yc(i)))),n<7&&s>=7&&(r=r.next(()=>this.vc(i))),n<8&&s>=8&&(r=r.next(()=>this.bc(t,i))),n<9&&s>=9&&(r=r.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(eh.store);e.createIndex(eh.readTimeIndex,eh.readTimeIndexPath,{unique:!1}),e.createIndex(eh.collectionReadTimeIndex,eh.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&s>=10&&(r=r.next(()=>this.Sc(i))),n<11&&s>=11&&(r=r.next(()=>{!function(t){t.createObjectStore(hh.store,{keyPath:hh.keyPath})}(t),function(t){t.createObjectStore(uh.store,{keyPath:uh.keyPath})}(t)})),r}yc(t){let e=0;return t.store(eh.store).Ns((t,n)=>{e+=Ch(n)}).next(()=>{const n=new nh(e);return t.store(nh.store).put(nh.key,n)})}gc(t){const e=t.store(Ya.store),n=t.store(Qa.store);return e.bs().next(e=>ia.forEach(e,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.bs(Qa.userMutationsIndex,s).next(n=>ia.forEach(n,n=>{Ss(n.userId===e.userId);const s=bh(this.le,n);return Rh(t,e.userId,s).next(()=>{})}))}))}vc(t){const e=t.store(ih.store),n=t.store(eh.store);return t.store(rh.store).get(rh.key).next(t=>{const s=[];return n.Ns((n,i)=>{const r=new oi(n),o=function(t){return[0,Ga(r)]}();s.push(e.get(o).next(n=>n?ia.resolve():(n=>e.put(new ih(0,Ga(n),t.highestListenSequenceNumber)))(r)))}).next(()=>ia.cs(s))})}bc(t,e){t.createObjectStore(oh.store,{keyPath:oh.keyPath});const n=e.store(oh.store),s=new Sh,i=t=>{if(s.add(t)){const e=t.At(),s=t.Tt();return n.put({collectionId:e,parent:Ga(s)})}};return e.store(eh.store).Ns({Cs:!0},(t,e)=>{const n=new oi(t);return i(n.Tt())}).next(()=>e.store(Ja.store).Ns({Cs:!0},([t,e,n],s)=>{const r=Ha(e);return i(r.Tt())}))}Sc(t){const e=t.store(sh.store);return e.Ns((t,n)=>{const s=Eh(n),i=Ih(this.le,s);return e.put(i)})}}function Qh(t){t.createObjectStore(ih.store,{keyPath:ih.keyPath}).createIndex(ih.documentTargetsIndex,ih.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(sh.store,{keyPath:sh.keyPath}).createIndex(sh.queryTargetsIndexName,sh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(rh.store)}const Jh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Zh{constructor(t,e,n,s,i,r,o,a,h,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Qs=i,this.window=r,this.document=o,this.Dc=h,this.Cc=u,this.Nc=null,this.xc=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kc=null,this.inForeground=!1,this.Oc=null,this.Mc=null,this.Fc=Number.NEGATIVE_INFINITY,this.$c=(t=>Promise.resolve()),!Zh.L())throw new Rs(Ds.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Eo=new Bh(this,s),this.Lc=e+"main",this.le=new dh(a),this.Bc=new oa(this.Lc,11,new Yh(this.le)),this.qc=new qh(this.Eo,this.le),this.wo=new kh,this.Uc=function(t,e){return new zh(t,e)}(this.le,this.wo),this.Kc=new _h,this.window&&this.window.localStorage?this.Qc=this.window.localStorage:(this.Qc=null,!1===u&&_s("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wc().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Rs(Ds.FAILED_PRECONDITION,Jh);return this.jc(),this.Gc(),this.zc(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.qc.Qo(t))}).then(t=>{this.Nc=new Aa(t,this.Dc)}).then(()=>{this.xc=!0}).catch(t=>(this.Bc&&this.Bc.close(),Promise.reject(t)))}Hc(t){return this.$c=(async e=>{if(this.Sr)return t(e)}),t(this.isPrimary)}Jc(t){this.Bc.Ps(async e=>{null===e.newVersion&&await t()})}Yc(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Qs.Ks(async()=>{this.Sr&&await this.Wc()}))}Wc(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>eu(t).put(new ah(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Xc(t).next(t=>{t||(this.isPrimary=!1,this.Qs.Zc(()=>this.$c(!1)))})}).next(()=>this.tu(t)).next(e=>this.isPrimary&&!e?this.eu(t).next(()=>!1):!!e&&this.nu(t).next(()=>!0))).catch(t=>{if(ua(t))return Ts("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Ts("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Qs.Zc(()=>this.$c(t)),this.isPrimary=t})}Xc(t){return tu(t).get(Wa.key).next(t=>ia.resolve(this.su(t)))}iu(t){return eu(t).delete(this.clientId)}async ru(){if(this.isPrimary&&!this.ou(this.Fc,18e5)){this.Fc=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=fh(t,ah.store);return e.bs().next(t=>{const n=this.cu(t,18e5),s=t.filter(t=>-1===n.indexOf(t));return ia.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if(this.Qc)for(const e of t)this.Qc.removeItem(this.uu(e.clientId))}}zc(){this.Mc=this.Qs.ti("client_metadata_refresh",4e3,()=>this.Wc().then(()=>this.ru()).then(()=>this.zc()))}su(t){return!!t&&t.ownerId===this.clientId}tu(t){return this.Cc?ia.resolve(!0):tu(t).get(Wa.key).next(e=>{if(null!==e&&this.ou(e.leaseTimestampMs,5e3)&&!this.au(e.ownerId)){if(this.su(e)&&this.networkEnabled)return!0;if(!this.su(e)){if(!e.allowTabSynchronization)throw new Rs(Ds.FAILED_PRECONDITION,Jh);return!1}}return!(!this.networkEnabled||!this.inForeground)||eu(t).bs().next(t=>void 0===this.cu(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&Ts("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async C(){this.xc=!1,this.hu(),this.Mc&&(this.Mc.cancel(),this.Mc=null),this.lu(),this._u(),await this.Bc.runTransaction("shutdown","readwrite",[Wa.store,ah.store],t=>{const e=new lh(t,Aa.Yi);return this.eu(e).next(()=>this.iu(e))}),this.Bc.close(),this.fu()}cu(t,e){return t.filter(t=>this.ou(t.updateTimeMs,e)&&!this.au(t.clientId))}du(){return this.runTransaction("getActiveClients","readonly",t=>eu(t).bs().next(t=>this.cu(t,18e5).map(t=>t.clientId)))}get Sr(){return this.xc}wu(t){return Oh.Io(t,this.le,this.wo,this.Eo)}oc(){return this.qc}hc(){return this.Uc}Eu(){return this.wo}Tu(){return this.Kc}runTransaction(t,e,n){Ts("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.Bc.runTransaction(t,s,ch,s=>(i=new lh(s,this.Nc?this.Nc.next():Aa.Yi),"readwrite-primary"===e?this.Xc(i).next(t=>!!t||this.tu(i)).next(e=>{if(!e)throw _s(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Qs.Zc(()=>this.$c(!1)),new Rs(Ds.FAILED_PRECONDITION,Ea);return n(i)}).next(t=>this.nu(i).next(()=>t)):this.Iu(i).next(()=>n(i)))).then(t=>(i.ki(),t))}Iu(t){return tu(t).get(Wa.key).next(t=>{if(null!==t&&this.ou(t.leaseTimestampMs,5e3)&&!this.au(t.ownerId)&&!this.su(t)&&!(this.Cc||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Rs(Ds.FAILED_PRECONDITION,Jh)})}nu(t){const e=new Wa(this.clientId,this.allowTabSynchronization,Date.now());return tu(t).put(Wa.key,e)}static L(){return oa.L()}eu(t){const e=tu(t);return e.get(Wa.key).next(t=>this.su(t)?(Ts("IndexedDbPersistence","Releasing primary lease."),e.delete(Wa.key)):ia.resolve())}ou(t,e){const n=Date.now();return!(t<n-e||t>n&&(_s(`Detected an update time that is in the future: ${t} > ${n}`),1))}jc(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Oc=(()=>{this.Qs.Ks(()=>(this.inForeground="visible"===this.document.visibilityState,this.Wc()))}),this.document.addEventListener("visibilitychange",this.Oc),this.inForeground="visible"===this.document.visibilityState)}lu(){this.Oc&&(this.document.removeEventListener("visibilitychange",this.Oc),this.Oc=null)}Gc(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.kc=(()=>{this.hu(),this.Qs.Ks(()=>this.C())}),this.window.addEventListener("unload",this.kc))}_u(){this.kc&&(this.window.removeEventListener("unload",this.kc),this.kc=null)}au(t){var e;try{const n=null!==(null===(e=this.Qc)||void 0===e?void 0:e.getItem(this.uu(t)));return Ts("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return _s("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}hu(){if(this.Qc)try{this.Qc.setItem(this.uu(this.clientId),String(Date.now()))}catch(t){_s("Failed to set zombie client id.",t)}}fu(){if(this.Qc)try{this.Qc.removeItem(this.uu(this.clientId))}catch(t){}}uu(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function tu(t){return fh(t,Wa.store)}function eu(t){return fh(t,ah.store)}function nu(t,e){let n=t.projectId;return t.S||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class su{constructor(t,e,n){this.Uc=t,this.Au=e,this.wo=n}mu(t,e){return this.Au.vo(t,e).next(n=>this.Ru(t,e,n))}Ru(t,e,n){return this.Uc.Tr(t,e).next(t=>{for(const s of n)t=s.er(e,t);return t})}Pu(t,e,n){let s=lo();return e.forEach((t,e)=>{for(const s of n)e=s.er(t,e);s=s.Ee(t,e)}),s}Vu(t,e){return this.Uc.getEntries(t,e).next(e=>this.gu(t,e))}gu(t,e){return this.Au.bo(t,e).next(n=>{const s=this.Pu(t,e,n);let i=co();return s.forEach((t,e)=>{e||(e=new Mi(t,ii.min())),i=i.Ee(t,e)}),i})}mc(t,e,n){return function(t){return ui.Mt(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.yu(t,e.path):dr(e)?this.pu(t,e,n):this.vu(t,e,n)}yu(t,e){return this.mu(t,new ui(e)).next(t=>{let e=po();return t instanceof Vi&&(e=e.Ee(t.key,t)),e})}pu(t,e,n){const s=e.collectionGroup;let i=po();return this.wo._o(t,s).next(r=>ia.forEach(r,r=>{const o=function(t,e){return new or(e,null,t.te.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.vu(t,o,n).next(t=>{t.forEach((t,e)=>{i=i.Ee(t,e)})})}).next(()=>i))}vu(t,e,n){let s,i;return this.Uc.mc(t,e,n).next(n=>(s=n,this.Au.Do(t,e))).next(e=>(i=e,this.bu(t,i,s).next(t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key,i=s.get(n),r=zr(e,i,i,t.Xi);s=r instanceof Vi?s.Ee(n,r):s.remove(n)}}))).next(()=>(s.forEach((t,n)=>{br(e,n)||(s=s.remove(t))}),s))}bu(t,e,n){let s=yo();for(const t of e)for(const e of t.mutations)e instanceof Yr&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.Uc.getEntries(t,s).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof Vi&&(i=i.Ee(t,e))}),i))}}class iu{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Su=n,this.Du=s}static Cu(t,e){let n=yo(),s=yo();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new iu(t,e.fromCache,n,s)}}class ru{Nu(t){this.xu=t}mc(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.te.length||1===t.te.length&&t.te[0].field.Dt())}(e)||n.isEqual(ii.min())?this.ku(t,e):this.xu.Vu(t,s).next(i=>{const r=this.Ou(e,i);return(ur(e)||cr(e))&&this.Mu(e.limitType,r,s,n)?this.ku(t,e):(Is()<=h.DEBUG&&Ts("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),vr(e)),this.xu.mc(t,e,n).next(t=>(r.forEach(e=>{t=t.Ee(e.key,e)}),t)))})}Ou(t,e){let n=new ao(Er(t));return e.forEach((e,s)=>{s instanceof Vi&&br(t,s)&&(n=n.add(s))}),n}Mu(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.ht(s)>0)}ku(t,e){return Is()<=h.DEBUG&&Ts("QueryEngine","Using full collection scan to execute query:",vr(e)),this.xu.mc(t,e,ii.min())}}class ou{constructor(t,e,n,s){this.persistence=t,this.Fu=e,this.le=s,this.$u=new io(ti),this.Lu=new ka(t=>ji(t),Bi),this.Bu=ii.min(),this.Au=t.wu(n),this.qu=t.hc(),this.qc=t.oc(),this.Uu=new su(this.qu,this.Au,this.persistence.Eu()),this.Kc=t.Tu(),this.Fu.Nu(this.Uu)}Dr(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.Lr(e,this.$u))}}function au(t,e,n,s){return new ou(t,e,n,s)}async function hu(t,e){const n=ks(t);let s=n.Au,i=n.Uu;const r=await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.Au.po(t).next(o=>(r=o,s=n.persistence.wu(e),i=new su(n.qu,s,n.persistence.Eu()),s.po(t))).next(e=>{const n=[],s=[];let o=yo();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.Vu(t,o).next(t=>({Ku:t,Qu:n,Wu:s}))})});return n.Au=s,n.Uu=i,n.Fu.Nu(n.Uu),r}function uu(t){const e=ks(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qc.Ko(t))}function cu(t,e){const n=ks(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.Au.Vo(t,e)))}function lu(t,e){const n=ks(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let s;return n.qc.Zo(t,e).next(i=>i?(s=i,ia.resolve(s)):n.qc.Bo(t).next(i=>(s=new Tr(e,i,0,t.io),n.qc.jo(t,s).next(()=>s))))}).then(t=>{const s=n.$u.get(t.targetId);return(null===s||t.ie.ht(s.ie)>0)&&(n.$u=n.$u.Ee(t.targetId,t),n.Lu.set(e,t.targetId)),t})}async function fu(t,e,n){const s=ks(t),i=s.$u.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,t=>s.persistence.Eo.removeTarget(t,i))}catch(t){if(!ua(t))throw t;Ts("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.$u=s.$u.remove(e),s.Lu.delete(i.target)}function du(t,e,n){const s=ks(t);let i=ii.min(),r=yo();return s.persistence.runTransaction("Execute query","readonly",t=>(function(t,e,n){const s=ks(t),i=s.Lu.get(n);return void 0!==i?ia.resolve(s.$u.get(i)):s.qc.Zo(e,n)})(s,t,gr(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.qc.ic(t,e.targetId).next(t=>{r=t})}).next(()=>s.Fu.mc(t,e,n?i:ii.min(),n?r:yo())).next(t=>({documents:t,ju:r})))}function pu(t,e){const n=ks(t),s=ks(n.qc),i=n.$u.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",t=>s.Yn(t,e).next(t=>t?t.target:null))}function gu(t){const e=ks(t);return e.persistence.runTransaction("Get new document changes","readonly",t=>(function(t,e,n){const s=ks(t);let i=co(),r=mh(n);const o=Xh(e),a=IDBKeyRange.lowerBound(r,!0);return o.Ns({index:eh.readTimeIndex,range:a},(t,e)=>{const n=ph(s.le,e);i=i.Ee(n.key,n),r=e.readTime}).next(()=>({Gu:i,readTime:yh(r)}))})(e.qu,t,e.Bu)).then(({Gu:t,readTime:n})=>(e.Bu=n,t))}class mu{constructor(t){this.le=t,this.zu=new Map,this.Hu=new Map}oo(t,e){return ia.resolve(this.zu.get(e))}co(t,e){var n;return this.zu.set(e.id,{id:(n=e).id,version:n.version,createTime:Vo(n.createTime)}),ia.resolve()}uo(t,e){return ia.resolve(this.Hu.get(e))}ao(t,e){var n;return this.Hu.set(e.name,{name:(n=e).name,query:Th(n.bundledQuery),readTime:Vo(n.readTime)}),ia.resolve()}}class yu{constructor(){this.Ju=new ao(wu.Yu),this.Xu=new ao(wu.Zu)}Rt(){return this.Ju.Rt()}ec(t,e){const n=new wu(t,e);this.Ju=this.Ju.add(n),this.Xu=this.Xu.add(n)}ta(t,e){t.forEach(t=>this.ec(t,e))}sc(t,e){this.ea(new wu(t,e))}na(t,e){t.forEach(t=>this.sc(t,e))}sa(t){const e=new ui(new oi([])),n=new wu(e,t),s=new wu(e,t+1),i=[];return this.Xu.qe([n,s],t=>{this.ea(t),i.push(t.key)}),i}ia(){this.Ju.forEach(t=>this.ea(t))}ea(t){this.Ju=this.Ju.delete(t),this.Xu=this.Xu.delete(t)}ra(t){const e=new ui(new oi([])),n=new wu(e,t),s=new wu(e,t+1);let i=yo();return this.Xu.qe([n,s],t=>{i=i.add(t.key)}),i}Oo(t){const e=new wu(t,0),n=this.Ju.Ke(e);return null!==n&&t.isEqual(n.key)}}class wu{constructor(t,e){this.key=t,this.oa=e}static Yu(t,e){return ui.dt(t.key,e.key)||ti(t.oa,e.oa)}static Zu(t,e){return ti(t.oa,e.oa)||ui.dt(t.key,e.key)}}class vu{constructor(t,e){this.wo=t,this.Eo=e,this.Au=[],this.ca=1,this.ua=new ao(wu.Yu)}Ao(t){return ia.resolve(0===this.Au.length)}mo(t,e,n,s){const i=this.ca;this.ca++,this.Au.length>0&&this.Au[this.Au.length-1];const r=new xa(i,e,n,s);this.Au.push(r);for(const e of s)this.ua=this.ua.add(new wu(e.key,i)),this.wo.lo(t,e.key.path.Tt());return ia.resolve(r)}Ro(t,e){return ia.resolve(this.aa(e))}Vo(t,e){const n=e+1,s=this.ha(n),i=s<0?0:s;return ia.resolve(this.Au.length>i?this.Au[i]:null)}yo(){return ia.resolve(0===this.Au.length?-1:this.ca-1)}po(t){return ia.resolve(this.Au.slice())}vo(t,e){const n=new wu(e,0),s=new wu(e,Number.POSITIVE_INFINITY),i=[];return this.ua.qe([n,s],t=>{const e=this.aa(t.oa);i.push(e)}),ia.resolve(i)}bo(t,e){let n=new ao(ti);return e.forEach(t=>{const e=new wu(t,0),s=new wu(t,Number.POSITIVE_INFINITY);this.ua.qe([e,s],t=>{n=n.add(t.oa)})}),ia.resolve(this.la(n))}Do(t,e){const n=e.path,s=n.length+1;let i=n;ui.Mt(i)||(i=i.child(""));const r=new wu(new ui(i),0);let o=new ao(ti);return this.ua.Ue(t=>{const e=t.key.path;return!!n.Pt(e)&&(e.length===s&&(o=o.add(t.oa)),!0)},r),ia.resolve(this.la(o))}la(t){const e=[];return t.forEach(t=>{const n=this.aa(t);null!==n&&e.push(n)}),e}Co(t,e){Ss(0===this._a(e.batchId,"removed")),this.Au.shift();let n=this.ua;return ia.forEach(e.mutations,s=>{const i=new wu(s.key,e.batchId);return n=n.delete(i),this.Eo.xo(t,s.key)}).next(()=>{this.ua=n})}No(t){}Oo(t,e){const n=new wu(e,0),s=this.ua.Ke(n);return ia.resolve(e.isEqual(s&&s.key))}ko(t){return this.Au.length,ia.resolve()}_a(t,e){return this.ha(t)}ha(t){return 0===this.Au.length?0:t-this.Au[0].batchId}aa(t){const e=this.ha(t);return e<0||e>=this.Au.length?null:this.Au[e]}}class bu{constructor(t,e){this.wo=t,this.fa=e,this.docs=new io(ui.dt),this.size=0}_r(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.fa(e);return this.docs=this.docs.Ee(s,{wr:e,size:o,readTime:n}),this.size+=o-r,this.wo.lo(t,s.path.Tt())}Er(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}Tr(t,e){const n=this.docs.get(e);return ia.resolve(n?n.wr:null)}getEntries(t,e){let n=lo();return e.forEach(t=>{const e=this.docs.get(t);n=n.Ee(t,e?e.wr:null)}),ia.resolve(n)}mc(t,e,n){let s=po();const i=new ui(e.path.child("")),r=this.docs.Ve(i);for(;r.Se();){const{key:t,value:{wr:i,readTime:o}}=r.be();if(!e.path.Pt(t.path))break;o.ht(n)<=0||i instanceof Vi&&br(e,i)&&(s=s.Ee(i.key,i))}return ia.resolve(s)}da(t,e){return ia.forEach(this.docs,t=>e(t))}ac(t){return new Eu(this)}_c(t){return ia.resolve(this.size)}}class Eu extends Da{constructor(t){super(),this.Pc=t}mr(t){const e=[];return this.ar.forEach((n,s)=>{s&&s.wr?e.push(this.Pc._r(t,s.wr,this.lr(n))):this.Pc.Er(n)}),ia.cs(e)}Ir(t,e){return this.Pc.Tr(t,e)}Ar(t,e){return this.Pc.getEntries(t,e)}}class Iu{constructor(t){this.persistence=t,this.wa=new ka(t=>ji(t),Bi),this.lastRemoteSnapshotVersion=ii.min(),this.highestTargetId=0,this.Ea=0,this.Ta=new yu,this.targetCount=0,this.Ia=Mh.$o()}Bn(t,e){return this.wa.forEach((t,n)=>e(n)),ia.resolve()}Ko(t){return ia.resolve(this.lastRemoteSnapshotVersion)}Qo(t){return ia.resolve(this.Ea)}Bo(t){return this.highestTargetId=this.Ia.next(),ia.resolve(this.highestTargetId)}Wo(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ea&&(this.Ea=e),ia.resolve()}Go(t){this.wa.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ia=new Mh(e),this.highestTargetId=e),t.sequenceNumber>this.Ea&&(this.Ea=t.sequenceNumber)}jo(t,e){return this.Go(e),this.targetCount+=1,ia.resolve()}Ho(t,e){return this.Go(e),ia.resolve()}Jo(t,e){return this.wa.delete(e.target),this.Ta.sa(e.targetId),this.targetCount-=1,ia.resolve()}Fr(t,e,n){let s=0;const i=[];return this.wa.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.wa.delete(r),i.push(this.Yo(t,o.targetId)),s++)}),ia.cs(i).next(()=>s)}Xo(t){return ia.resolve(this.targetCount)}Zo(t,e){const n=this.wa.get(e)||null;return ia.resolve(n)}tc(t,e,n){return this.Ta.ta(e,n),ia.resolve()}nc(t,e,n){this.Ta.na(e,n);const s=this.persistence.Eo,i=[];return s&&e.forEach(e=>{i.push(s.xo(t,e))}),ia.cs(i)}Yo(t,e){return this.Ta.sa(e),ia.resolve()}ic(t,e){const n=this.Ta.ra(e);return ia.resolve(n)}Oo(t,e){return ia.resolve(this.Ta.Oo(e))}}class Tu{constructor(t,e){this.Aa={},this.Nc=new Aa(0),this.xc=!1,this.xc=!0,this.Eo=t(this),this.qc=new Iu(this),this.wo=new xh,this.Uc=function(t,e){return new bu(t,e)}(this.wo,t=>this.Eo.ma(t)),this.le=new dh(e),this.Kc=new mu(this.le)}start(){return Promise.resolve()}C(){return this.xc=!1,Promise.resolve()}get Sr(){return this.xc}Jc(){}Yc(){}Eu(){return this.wo}wu(t){let e=this.Aa[t.i()];return e||(e=new vu(this.wo,this.Eo),this.Aa[t.i()]=e),e}oc(){return this.qc}hc(){return this.Uc}Tu(){return this.Kc}runTransaction(t,e,n){Ts("MemoryPersistence","Starting transaction:",t);const s=new _u(this.Nc.next());return this.Eo.Ra(),n(s).next(t=>this.Eo.Pa(s).next(()=>t)).rs().then(t=>(s.ki(),t))}Va(t,e){return ia.us(Object.values(this.Aa).map(n=>()=>n.Oo(t,e)))}}class _u extends Ia{constructor(t){super(),this.io=t}}class Au{constructor(t){this.persistence=t,this.ga=new yu,this.ya=null}static pa(t){return new Au(t)}get va(){if(this.ya)return this.ya;throw xs()}ec(t,e,n){return this.ga.ec(n,e),this.va.delete(n.toString()),ia.resolve()}sc(t,e,n){return this.ga.sc(n,e),this.va.add(n.toString()),ia.resolve()}xo(t,e){return this.va.add(e.toString()),ia.resolve()}removeTarget(t,e){this.ga.sa(e.targetId).forEach(t=>this.va.add(t.toString()));const n=this.persistence.oc();return n.ic(t,e.targetId).next(t=>{t.forEach(t=>this.va.add(t.toString()))}).next(()=>n.Jo(t,e))}Ra(){this.ya=new Set}Pa(t){const e=this.persistence.hc().ac();return ia.forEach(this.va,n=>{const s=ui.xt(n);return this.ba(t,s).next(t=>{t||e.Er(s)})}).next(()=>(this.ya=null,e.apply(t)))}lc(t,e){return this.ba(t,e).next(t=>{t?this.va.delete(e.toString()):this.va.add(e.toString())})}ma(t){return 0}ba(t,e){return ia.us([()=>ia.resolve(this.ga.Oo(e)),()=>this.persistence.oc().Oo(t,e),()=>this.persistence.Va(t,e)])}}function Nu(t,e){return`firestore_clients_${t}_${e}`}function xu(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.t()&&(s+="_"+e.uid),s}function Su(t,e){return`firestore_targets_${t}_${e}`}class ku{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Sa(t,e,n){const s=JSON.parse(n);let i="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error),r=void 0;return i&&s.error&&((i="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(r=new Rs(s.error.code,s.error.message))),i?new ku(t,e,s.state,r):(_s("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Da(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Du{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Sa(t,e){const n=JSON.parse(e);let s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return s&&n.error&&((s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Rs(n.error.code,n.error.message))),s?new Du(t,n.state,i):(_s("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Da(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Ru{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Sa(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=vo();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Bs(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new Ru(t,i):(_s("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Cu{constructor(t,e){this.clientId=t,this.onlineState=e}static Sa(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Cu(e.clientId,e.onlineState):(_s("SharedClientState","Failed to parse online state: "+t),null)}}class Ou{constructor(){this.activeTargetIds=vo()}Ca(t){this.activeTargetIds=this.activeTargetIds.add(t)}Na(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Da(){const t={activeTargetIds:this.activeTargetIds.gt(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Lu{constructor(t,e,n,s,i){this.window=t,this.Qs=e,this.persistenceKey=n,this.xa=s,this.ka=null,this.Oa=null,this.Gi=null,this.Ma=this.Fa.bind(this),this.$a=new io(ti),this.Sr=!1,this.La=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ba=Nu(this.persistenceKey,this.xa),this.qa=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.$a=this.$a.Ee(this.xa,new Ou),this.Ua=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.Ka=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.Qa=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.Wa=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.ja=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Ma)}static L(t){return!(!t||!t.localStorage)}async start(){const t=await this.ka.du();for(const e of t){if(e===this.xa)continue;const t=this.getItem(Nu(this.persistenceKey,e));if(t){const n=Ru.Sa(e,t);n&&(this.$a=this.$a.Ee(n.clientId,n))}}this.Ga();const e=this.storage.getItem(this.Wa);if(e){const t=this.za(e);t&&this.Ha(t)}for(const t of this.La)this.Fa(t);this.La=[],this.window.addEventListener("unload",()=>this.C()),this.Sr=!0}Ji(t){this.setItem(this.qa,JSON.stringify(t))}Ja(){return this.Ya(this.$a)}Xa(t){let e=!1;return this.$a.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}Za(t){this.th(t,"pending")}eh(t,e,n){this.th(t,e,n),this.nh(t)}sh(t){let e="not-current";if(this.Xa(t)){const n=this.storage.getItem(Su(this.persistenceKey,t));if(n){const s=Du.Sa(t,n);s&&(e=s.state)}}return this.ih.Ca(t),this.Ga(),e}rh(t){this.ih.Na(t),this.Ga()}oh(t){return this.ih.activeTargetIds.has(t)}uh(t){this.removeItem(Su(this.persistenceKey,t))}ah(t,e,n){this.hh(t,e,n)}lh(t,e,n){e.forEach(t=>{this.nh(t)}),this.currentUser=t,n.forEach(t=>{this.Za(t)})}_h(t){this.fh(t)}dh(){this.wh()}C(){this.Sr&&(this.window.removeEventListener("storage",this.Ma),this.removeItem(this.Ba),this.Sr=!1)}getItem(t){const e=this.storage.getItem(t);return Ts("SharedClientState","READ",t,e),e}setItem(t,e){Ts("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){Ts("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Fa(t){const e=t;if(e.storageArea===this.storage){if(Ts("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ba)return void _s("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Qs.Zc(async()=>{if(this.Sr){if(null!==e.key)if(this.Ua.test(e.key)){if(null==e.newValue){const t=this.Eh(e.key);return this.Th(t,null)}{const t=this.Ih(e.key,e.newValue);if(t)return this.Th(t.clientId,t)}}else if(this.Ka.test(e.key)){if(null!==e.newValue){const t=this.Ah(e.key,e.newValue);if(t)return this.mh(t)}}else if(this.Qa.test(e.key)){if(null!==e.newValue){const t=this.Rh(e.key,e.newValue);if(t)return this.Ph(t)}}else if(e.key===this.Wa){if(null!==e.newValue){const t=this.za(e.newValue);if(t)return this.Ha(t)}}else if(e.key===this.qa){const t=function(t){let e=Aa.Yi;if(null!=t)try{const n=JSON.parse(t);Ss("number"==typeof n),e=n}catch(t){_s("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Aa.Yi&&this.Gi(t)}else if(e.key===this.ja)return this.ka.Vh()}else this.La.push(e)})}}get ih(){return this.$a.get(this.xa)}Ga(){this.setItem(this.Ba,this.ih.Da())}th(t,e,n){const s=new ku(this.currentUser,t,e,n),i=xu(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Da())}nh(t){const e=xu(this.persistenceKey,this.currentUser,t);this.removeItem(e)}fh(t){const e={clientId:this.xa,onlineState:t};this.storage.setItem(this.Wa,JSON.stringify(e))}hh(t,e,n){const s=Su(this.persistenceKey,t),i=new Du(t,e,n);this.setItem(s,i.Da())}wh(){this.setItem(this.ja,"value-not-used")}Eh(t){const e=this.Ua.exec(t);return e?e[1]:null}Ih(t,e){const n=this.Eh(t);return Ru.Sa(n,e)}Ah(t,e){const n=this.Ka.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ku.Sa(new bs(i),s,e)}Rh(t,e){const n=this.Qa.exec(t),s=Number(n[1]);return Du.Sa(s,e)}za(t){return Cu.Sa(t)}async mh(t){if(t.user.uid===this.currentUser.uid)return this.ka.gh(t.batchId,t.state,t.error);Ts("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}Ph(t){return this.ka.yh(t.targetId,t.state,t.error)}Th(t,e){const n=e?this.$a.Ee(t,e):this.$a.remove(t),s=this.Ya(this.$a),i=this.Ya(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.ka.ph(r,o).then(()=>{this.$a=n})}Ha(t){this.$a.get(t.clientId)&&this.Oa(t.onlineState)}Ya(t){let e=vo();return t.forEach((t,n)=>{e=e.Qe(n.activeTargetIds)}),e}}class Pu{constructor(){this.bh=new Ou,this.Sh={},this.Oa=null,this.Gi=null}Za(t){}eh(t,e,n){}sh(t){return this.bh.Ca(t),this.Sh[t]||"not-current"}ah(t,e,n){this.Sh[t]=e}rh(t){this.bh.Na(t)}oh(t){return this.bh.activeTargetIds.has(t)}uh(t){delete this.Sh[t]}Ja(){return this.bh.activeTargetIds}Xa(t){return this.bh.activeTargetIds.has(t)}start(){return this.bh=new Ou,Promise.resolve()}lh(t,e,n){}_h(t){}C(){}Ji(t){}dh(){}}function Uu(){return"undefined"!=typeof window?window:null}function Vu(){return"undefined"!=typeof document?document:null}class Mu{constructor(t,e){this.ks=t,this.Oa=e,this.state="Unknown",this.Dh=0,this.Ch=null,this.Nh=!0}xh(){0===this.Dh&&(this.kh("Unknown"),this.Ch=this.ks.ti("online_state_timeout",1e4,()=>(this.Ch=null,this.Oh("Backend didn't respond within 10 seconds."),this.kh("Offline"),Promise.resolve())))}Mh(t){"Online"===this.state?this.kh("Unknown"):(this.Dh++,this.Dh>=1&&(this.Fh(),this.Oh("Connection failed 1 times. Most recent error: "+t.toString()),this.kh("Offline")))}set(t){this.Fh(),this.Dh=0,"Online"===t&&(this.Nh=!1),this.kh(t)}kh(t){t!==this.state&&(this.state=t,this.Oa(t))}Oh(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Nh?(_s(e),this.Nh=!1):Ts("OnlineStateTracker",e)}Fh(){null!==this.Ch&&(this.Ch.cancel(),this.Ch=null)}}class qu{constructor(t,e,n,s,i){this.$h=t,this.Lh=e,this.ks=n,this.Bh={},this.qh=[],this.Uh=new Map,this.Kh=new Set,this.Qh=[],this.Wh=i,this.Wh.D(t=>{n.Ks(async()=>{Xu(this)&&(Ts("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=ks(t);e.Kh.add(4),await $u(e),e.jh.set("Unknown"),e.Kh.delete(4),await Fu(e)}(this))})}),this.jh=new Mu(n,s)}}async function Fu(t){if(Xu(t))for(const e of t.Qh)await e(!0)}async function $u(t){for(const e of t.Qh)await e(!1)}function ju(t,e){const n=ks(t);n.Uh.has(e.targetId)||(n.Uh.set(e.targetId,e),Hu(n)?Ku(n):ic(n).ai()&&Gu(n,e))}function Bu(t,e){const n=ks(t),s=ic(n);n.Uh.delete(e),s.ai()&&zu(n,e),0===n.Uh.size&&(s.ai()?s._i():Xu(n)&&n.jh.set("Unknown"))}function Gu(t,e){t.Gh.bn(e.targetId),ic(t).Pi(e)}function zu(t,e){t.Gh.bn(e),ic(t).Vi(e)}function Ku(t){t.Gh=new ko({Jn:e=>t.Bh.Jn(e),Yn:e=>t.Uh.get(e)||null}),ic(t).start(),t.jh.xh()}function Hu(t){return Xu(t)&&!ic(t).ui()&&t.Uh.size>0}function Xu(t){return 0===ks(t).Kh.size}function Wu(t){t.Gh=void 0}async function Yu(t,e,n){if(!ua(e))throw e;t.Kh.add(1),await $u(t),t.jh.set("Offline"),n||(n=(()=>uu(t.$h))),t.ks.Zc(async()=>{Ts("RemoteStore","Retrying IndexedDB access"),await n(),t.Kh.delete(1),await Fu(t)})}function Qu(t,e){return e().catch(n=>Yu(t,n,e))}async function Ju(t){const e=ks(t),n=rc(e);let s=e.qh.length>0?e.qh[e.qh.length-1].batchId:-1;for(;Zu(e);)try{const i=await cu(e.$h,s);if(null===i){0===e.qh.length&&n._i();break}s=i.batchId,tc(e,i)}catch(t){await Yu(e,t)}ec(e)&&nc(e)}function Zu(t){return Xu(t)&&t.qh.length<10}function tc(t,e){t.qh.push(e);const n=rc(t);n.ai()&&n.yi&&n.pi(e.mutations)}function ec(t){return Xu(t)&&!rc(t).ui()&&t.qh.length>0}function nc(t){rc(t).start()}async function sc(t,e){const n=ks(t);e?(n.Kh.delete(2),await Fu(n)):e||(n.Kh.add(2),await $u(n),n.jh.set("Unknown"))}function ic(t){return t.Xh||(t.Xh=function(t,e,n){const s=ks(t);return s.Ci(),new wa(e,s.si,s.credentials,s.le,n)}(t.Lh,t.ks,{U:async function(t){t.Uh.forEach((e,n)=>{Gu(t,e)})}.bind(null,t),W:async function(t,e){Wu(t),Hu(t)?(t.jh.Mh(e),Ku(t)):t.jh.set("Unknown")}.bind(null,t),Ri:async function(t,e,n){if(t.jh.set("Online"),e instanceof xo&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Uh.has(s)&&(await t.Bh.zh(s,n),t.Uh.delete(s),t.Gh.removeTarget(s))}(t,e)}catch(n){Ts("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Yu(t,n)}else if(e instanceof Ao?t.Gh.Mn(e):e instanceof No?t.Gh.Qn(e):t.Gh.Ln(e),!n.isEqual(ii.min()))try{const s=await uu(t.$h);n.ht(s)>=0&&await function(t,e){const n=t.Gh.Gn(e);return n.nn.forEach((n,s)=>{if(n.resumeToken.Bt()>0){const i=t.Uh.get(s);i&&t.Uh.set(s,i.oe(n.resumeToken,e))}}),n.sn.forEach(e=>{const n=t.Uh.get(e);if(!n)return;t.Uh.set(e,n.oe(pi.qt,n.ie)),zu(t,e);const s=new Tr(n.target,e,1,n.sequenceNumber);Gu(t,s)}),t.Bh.Hh(n)}(t,n)}catch(e){Ts("RemoteStore","Failed to raise snapshot:",e),await Yu(t,e)}}.bind(null,t)}),t.Qh.push(async e=>{e?(t.Xh.li(),Hu(t)?Ku(t):t.jh.set("Unknown")):(await t.Xh.stop(),Wu(t))})),t.Xh}function rc(t){return t.Zh||(t.Zh=function(t,e,n){const s=ks(t);return s.Ci(),new va(e,s.si,s.credentials,s.le,n)}(t.Lh,t.ks,{U:async function(t){rc(t).Si()}.bind(null,t),W:async function(t,e){e&&rc(t).yi&&await async function(t,e){if(Hs(n=e.code)&&n!==Ds.ABORTED){const n=t.qh.shift();rc(t).li(),await Qu(t,()=>t.Bh.Yh(n.batchId,e)),await Ju(t)}var n}(t,e),ec(t)&&nc(t)}.bind(null,t),bi:async function(t){const e=rc(t);for(const n of t.qh)e.pi(n.mutations)}.bind(null,t),vi:async function(t,e,n){const s=t.qh.shift(),i=Sa.from(s,e,n);await Qu(t,()=>t.Bh.Jh(i)),await Ju(t)}.bind(null,t)}),t.Qh.push(async e=>{e?(t.Zh.li(),await Ju(t)):(await t.Zh.stop(),t.qh.length>0&&(Ts("RemoteStore",`Stopping write stream with ${t.qh.length} pending writes`),t.qh=[]))})),t.Zh}class oc{constructor(){this.tl=void 0,this.listeners=[]}}class ac{constructor(){this.queries=new ka(t=>wr(t),yr),this.onlineState="Unknown",this.el=new Set}}async function hc(t,e){const n=ks(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new oc),i)try{r.tl=await n.nl(s)}catch(t){const n=ga(t,`Initialization of query '${vr(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.sl(n.onlineState),r.tl&&e.il(r.tl)&&cc(n)}async function uc(t,e){const n=ks(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.rl(s)}function cc(t){t.el.forEach(t=>{t.next()})}class lc{constructor(t,e,n){this.query=t,this.ol=e,this.cl=!1,this.ul=null,this.onlineState="Unknown",this.options=n||{}}il(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Io(t.query,t.docs,t.Ye,e,t.Xe,t.fromCache,t.Ze,!0)}let e=!1;return this.cl?this.al(t)&&(this.ol.next(t),e=!0):this.hl(t,this.onlineState)&&(this.ll(t),e=!0),this.ul=t,e}onError(t){this.ol.error(t)}sl(t){this.onlineState=t;let e=!1;return this.ul&&!this.cl&&this.hl(this.ul,t)&&(this.ll(this.ul),e=!0),e}hl(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options._l&&n||t.docs.Rt()&&"Offline"!==e)}al(t){if(t.docChanges.length>0)return!0;const e=this.ul&&this.ul.hasPendingWrites!==t.hasPendingWrites;return!(!t.Ze&&!e)&&!0===this.options.includeMetadataChanges}ll(t){t=Io.en(t.query,t.docs,t.Xe,t.fromCache),this.cl=!0,this.ol.next(t)}}class fc{constructor(t){this.key=t}}class dc{constructor(t){this.key=t}}class pc{constructor(t,e){this.query=t,this.fl=e,this.dl=null,this.an=!1,this.wl=yo(),this.Xe=yo(),this.El=Er(t),this.Tl=new bo(this.El)}get Il(){return this.fl}Al(t,e){const n=e?e.ml:new Eo,s=e?e.Tl:this.Tl;let i=e?e.Xe:this.Xe,r=s,o=!1;const a=ur(this.query)&&s.size===this.query.limit?s.last():null,h=cr(this.query)&&s.size===this.query.limit?s.first():null;if(t.me((t,e)=>{const u=s.get(t);let c=e instanceof Vi?e:null;c&&(c=br(this.query,c)?c:null);const l=!!u&&this.Xe.has(u.key),f=!!c&&(c.zt||this.Xe.has(c.key)&&c.hasCommittedMutations);let d=!1;u&&c?u.data().isEqual(c.data())?l!==f&&(n.track({type:3,doc:c}),d=!0):this.Rl(u,c)||(n.track({type:2,doc:c}),d=!0,(a&&this.El(c,a)>0||h&&this.El(c,h)<0)&&(o=!0)):!u&&c?(n.track({type:0,doc:c}),d=!0):u&&!c&&(n.track({type:1,doc:u}),d=!0,(a||h)&&(o=!0)),d&&(c?(r=r.add(c),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),ur(this.query)||cr(this.query))for(;r.size>this.query.limit;){const t=ur(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Tl:r,ml:n,Mu:o,Xe:i}}Rl(t,e){return t.zt&&e.hasCommittedMutations&&!e.zt}mr(t,e,n){const s=this.Tl;this.Tl=t.Tl,this.Xe=t.Xe;const i=t.ml.Je();i.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xs()}};return n(t)-n(e)})(t.type,e.type)||this.El(t.doc,e.doc)),this.Pl(n);const r=e?this.Vl():[],o=0===this.wl.size&&this.an?1:0,a=o!==this.dl;return this.dl=o,0!==i.length||a?{snapshot:new Io(this.query,t.Tl,s,i,t.Xe,0===o,a,!1),gl:r}:{gl:r}}sl(t){return this.an&&"Offline"===t?(this.an=!1,this.mr({Tl:this.Tl,ml:new Eo,Xe:this.Xe,Mu:!1},!1)):{gl:[]}}yl(t){return!this.fl.has(t)&&!!this.Tl.has(t)&&!this.Tl.get(t).zt}Pl(t){t&&(t.hn.forEach(t=>this.fl=this.fl.add(t)),t.ln.forEach(t=>{}),t._n.forEach(t=>this.fl=this.fl.delete(t)),this.an=t.an)}Vl(){if(!this.an)return[];const t=this.wl;this.wl=yo(),this.Tl.forEach(t=>{this.yl(t.key)&&(this.wl=this.wl.add(t.key))});const e=[];return t.forEach(t=>{this.wl.has(t)||e.push(new dc(t))}),this.wl.forEach(n=>{t.has(n)||e.push(new fc(n))}),e}pl(t){this.fl=t.ju,this.wl=yo();const e=this.Al(t.documents);return this.mr(e,!0)}vl(){return Io.en(this.query,this.Tl,this.Xe,0===this.dl)}}class gc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class mc{constructor(t){this.key=t,this.bl=!1}}class yc{constructor(t,e,n,s,i,r){this.$h=t,this.Sl=e,this.Dl=n,this.Cl=s,this.currentUser=i,this.Nl=r,this.xl={},this.kl=new ka(t=>wr(t),yr),this.Ol=new Map,this.Ml=[],this.Fl=new io(ui.dt),this.$l=new Map,this.Ll=new yu,this.Bl={},this.ql=new Map,this.Ul=Mh.Lo(),this.onlineState="Unknown",this.Kl=void 0}get Ql(){return!0===this.Kl}}async function wc(t,e,n,s){t.Wl=((e,n,s)=>(async function(t,e,n,s){let i=e.view.Al(n);i.Mu&&(i=await du(t.$h,e.query,!1).then(({documents:t})=>e.view.Al(t,i)));const r=s&&s.nn.get(e.targetId),o=e.view.mr(i,t.Ql,r);return Nc(t,e.targetId,o.gl),o.snapshot})(t,e,n,s));const i=await du(t.$h,e,!0),r=new pc(e,i.ju),o=r.Al(i.documents),a=_o.un(n,s&&"Offline"!==t.onlineState),h=r.mr(o,t.Ql,a);Nc(t,n,h.gl);const u=new gc(e,n,r);return t.kl.set(e,u),t.Ol.has(n)?t.Ol.get(n).push(e):t.Ol.set(n,[e]),h.snapshot}async function vc(t,e){const n=ks(t);try{const s=await function(t,e){const n=ks(t),s=e.ie;let i=n.$u;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const r=n.qu.ac({Rc:!0});i=n.$u;const o=[];e.nn.forEach((e,r)=>{const a=i.get(r);if(!a)return;o.push(n.qc.nc(t,e._n,r).next(()=>n.qc.tc(t,e.hn,r)));const h=e.resumeToken;if(h.Bt()>0){const u=a.oe(h,s).re(t.io);i=i.Ee(r,u),function(t,e,n){return Ss(e.resumeToken.Bt()>0),0===t.resumeToken.Bt()||e.ie.lt()-t.ie.lt()>=3e8||n.hn.size+n.ln.size+n._n.size>0}(a,u,e)&&o.push(n.qc.Ho(t,u))}});let a=co();if(e.rn.forEach((s,i)=>{e.on.has(s)&&o.push(n.persistence.Eo.lc(t,s))}),o.push(function(t,e,n,s,i){let r=yo();return n.forEach(t=>r=r.add(t)),e.getEntries(t,r).next(t=>{let i=co();return n.forEach((n,r)=>{const o=t.get(n),a=s;r instanceof Mi&&r.version.isEqual(ii.min())?(e.Er(n,a),i=i.Ee(n,r)):null==o||r.version.ht(o.version)>0||0===r.version.ht(o.version)&&o.hasPendingWrites?(e._r(r,a),i=i.Ee(n,r)):Ts("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)}),i})}(t,r,e.rn,s).next(t=>{a=t})),!s.isEqual(ii.min())){const e=n.qc.Ko(t).next(e=>n.qc.Wo(t,t.io,s));o.push(e)}return ia.cs(o).next(()=>r.apply(t)).next(()=>n.Uu.gu(t,a))}).then(t=>(n.$u=i,t))}(n.$h,e);e.nn.forEach((t,e)=>{const s=n.$l.get(e);s&&(Ss(t.hn.size+t.ln.size+t._n.size<=1),t.hn.size>0?s.bl=!0:t.ln.size>0?Ss(s.bl):t._n.size>0&&(Ss(s.bl),s.bl=!1))}),await kc(n,s,e)}catch(t){await Na(t)}}function bc(t,e,n){const s=ks(t);if(s.Ql&&0===n||!s.Ql&&1===n){const t=[];s.kl.forEach((n,s)=>{const i=s.view.sl(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=ks(t);n.onlineState=e;let s=!1;n.queries.forEach((t,n)=>{for(const t of n.listeners)t.sl(e)&&(s=!0)}),s&&cc(n)}(s.Dl,e),t.length&&s.xl.Ri(t),s.onlineState=e,s.Ql&&s.Cl._h(e)}}async function Ec(t,e){const n=ks(t),s=e.batch.batchId;try{const i=await function(t,e){const n=ks(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const s=e.batch.keys(),i=n.qu.ac({Rc:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=ia.resolve();return r.forEach(t=>{o=o.next(()=>s.Tr(e,t)).next(e=>{let r=e;const o=n.ir.get(t);Ss(null!==o),(!r||r.version.ht(o)<0)&&(r=i.Zi(t,r,n))&&s._r(r,n.sr)})}),o.next(()=>t.Au.Co(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.Au.ko(t)).next(()=>n.Uu.Vu(t,s))})}(n.$h,e);Tc(n,s,null),Ic(n,s),n.Cl.eh(s,"acknowledged"),await kc(n,i)}catch(t){await Na(t)}}function Ic(t,e){(t.ql.get(e)||[]).forEach(t=>{t.resolve()}),t.ql.delete(e)}function Tc(t,e,n){const s=ks(t);let i=s.Bl[s.currentUser.i()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.Bl[s.currentUser.i()]=i}}function _c(t,e,n=null){t.Cl.rh(e);for(const s of t.Ol.get(e))t.kl.delete(s),n&&t.xl.jl(s,n);t.Ol.delete(e),t.Ql&&t.Ll.sa(e).forEach(e=>{t.Ll.Oo(e)||Ac(t,e)})}function Ac(t,e){const n=t.Fl.get(e);null!==n&&(Bu(t.Sl,n),t.Fl=t.Fl.remove(e),t.$l.delete(n),Sc(t))}function Nc(t,e,n){for(const s of n)s instanceof fc?(t.Ll.ec(s.key,e),xc(t,s)):s instanceof dc?(Ts("SyncEngine","Document no longer in limbo: "+s.key),t.Ll.sc(s.key,e),t.Ll.Oo(s.key)||Ac(t,s.key)):xs()}function xc(t,e){const n=e.key;t.Fl.get(n)||(Ts("SyncEngine","New document in limbo: "+n),t.Ml.push(n),Sc(t))}function Sc(t){for(;t.Ml.length>0&&t.Fl.size<t.Nl;){const e=t.Ml.shift(),n=t.Ul.next();t.$l.set(n,new mc(e)),t.Fl=t.Fl.Ee(e,n),ju(t.Sl,new Tr(gr(hr(e.path)),n,2,Aa.Yi))}}async function kc(t,e,n){const s=ks(t),i=[],r=[],o=[];s.kl.Rt()||(s.kl.forEach((t,a)=>{o.push(s.Wl(a,e,n).then(t=>{if(t){s.Ql&&s.Cl.ah(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=iu.Cu(a.targetId,t);r.push(e)}}))}),await Promise.all(o),s.xl.Ri(i),await async function(t,e){const n=ks(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>ia.forEach(e,e=>ia.forEach(e.Su,s=>n.persistence.Eo.ec(t,e.targetId,s)).next(()=>ia.forEach(e.Du,s=>n.persistence.Eo.sc(t,e.targetId,s)))))}catch(t){if(!ua(t))throw t;Ts("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.$u.get(e),s=t.ie,i=t.ce(s);n.$u=n.$u.Ee(e,i)}}}(s.$h,r))}async function Dc(t,e){const n=ks(t),s=await du(n.$h,e.query,!0),i=e.view.pl(s);return n.Ql&&Nc(n,e.targetId,i.gl),i}async function Rc(t,e,n){const s=ks(t),i=[],r=[];for(const t of e){let e;const n=s.Ol.get(t);if(n&&0!==n.length){e=await lu(s.$h,gr(n[0]));for(const t of n){const e=s.kl.get(t),n=await Dc(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await pu(s.$h,t);e=await lu(s.$h,n),await wc(s,Cc(n),t,!1)}i.push(e)}return s.xl.Ri(r),i}function Cc(t){return ar(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Oc(t){const e=ks(t);return e.Sl.Bh.Hh=vc.bind(null,e),e.Sl.Bh.Jn=function(t,e){const n=ks(t),s=n.$l.get(e);if(s&&s.bl)return yo().add(s.key);{let t=yo();const s=n.Ol.get(e);if(!s)return t;for(const e of s){const s=n.kl.get(e);t=t.Qe(s.view.Il)}return t}}.bind(null,e),e.Sl.Bh.zh=async function(t,e,n){const s=ks(t);s.Cl.ah(e,"rejected",n);const i=s.$l.get(e),r=i&&i.key;if(r){let t=new io(ui.dt);t=t.Ee(r,new Mi(r,ii.min()));const n=yo().add(r),i=new To(ii.min(),new Map,new ao(ti),t,n);await vc(s,i),s.Fl=s.Fl.remove(r),s.$l.delete(e),Sc(s)}else await fu(s.$h,e,!1).then(()=>_c(s,e,n)).catch(Na)}.bind(null,e),e.xl.Ri=function(t,e){const n=ks(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.il(t)&&(s=!0);i.tl=t}}s&&cc(n)}.bind(null,e.Dl),e.xl.jl=function(t,e,n){const s=ks(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}.bind(null,e.Dl),e}function Lc(t){const e=ks(t);return e.Sl.Bh.Jh=Ec.bind(null,e),e.Sl.Bh.Yh=async function(t,e,n){const s=ks(t);try{const t=await function(t,e){const n=ks(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let s;return n.Au.Ro(t,e).next(e=>(Ss(null!==e),s=e.keys(),n.Au.Co(t,e))).next(()=>n.Au.ko(t)).next(()=>n.Uu.Vu(t,s))})}(s.$h,e);Tc(s,e,n),Ic(s,e),s.Cl.eh(e,"rejected",n),await kc(s,t)}catch(n){await Na(n)}}.bind(null,e),e}class Pc{constructor(){this.synchronizeTabs=!1}async initialize(t){this.le=sa(t.X.p),this.Cl=this.Gl(t),this.persistence=this.zl(t),await this.persistence.start(),this.Hl=this.Jl(t),this.$h=this.Yl(t)}Jl(t){return null}Yl(t){return au(this.persistence,new ru,t.Xl,this.le)}zl(t){return new Tu(Au.pa,this.le)}Gl(t){return new Pu}async terminate(){this.Hl&&this.Hl.stop(),await this.Cl.C(),await this.persistence.C()}}class Uc extends Pc{constructor(t,e,n){super(),this.Zl=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=ks(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>(function(t){const e=Xh(t);let n=ii.min();return e.Ns({index:eh.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=yh(e.readTime)),s.done()}).next(()=>n)})(t)).then(t=>{e.Bu=t})}(this.$h),await this.Zl.initialize(this,t),await Lc(this.Zl.ka),await Ju(this.Zl.Sl)}Yl(t){return au(this.persistence,new ru,t.Xl,this.le)}Jl(t){const e=this.persistence.Eo.yr;return new Oa(e,t.ks)}zl(t){const e=nu(t.X.p,t.X.persistenceKey),n=void 0!==this.cacheSizeBytes?_a.Ui(this.cacheSizeBytes):_a.Wi;return new Zh(this.synchronizeTabs,e,t.clientId,n,t.ks,Uu(),Vu(),this.le,this.Cl,!!this.forceOwnership)}Gl(t){return new Pu}}class Vc extends Uc{constructor(t,e){super(t,e,!1),this.Zl=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Zl.ka;this.Cl instanceof Lu&&(this.Cl.ka={gh:async function(t,e,n,s){const i=ks(t),r=await function(t,e){const n=ks(t),s=ks(n.Au);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Po(t,e).next(e=>e?n.Uu.Vu(t,e):ia.resolve(null)))}(i.$h,e);null!==r?("pending"===n?await Ju(i.Sl):"acknowledged"===n||"rejected"===n?(Tc(i,e,s||null),Ic(i,e),function(t,e){ks(ks(t).Au).No(e)}(i.$h,e)):xs(),await kc(i,r)):Ts("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),yh:async function(t,e,n,s){const i=ks(t);if(i.Kl)Ts("SyncEngine","Ignoring unexpected query state notification.");else if(i.Ol.has(e))switch(n){case"current":case"not-current":{const t=await gu(i.$h),s=To.cn(e,"current"===n);await kc(i,t,s);break}case"rejected":await fu(i.$h,e,!0),_c(i,e,s);break;default:xs()}}.bind(null,e),ph:async function(t,e,n){const s=Oc(t);if(s.Kl){for(const t of e){if(s.Ol.has(t)){Ts("SyncEngine","Adding an already active target "+t);continue}const e=await pu(s.$h,t),n=await lu(s.$h,e);await wc(s,Cc(e),n.targetId,!1),ju(s.Sl,n)}for(const t of n)s.Ol.has(t)&&await fu(s.$h,t,!1).then(()=>{Bu(s.Sl,t),_c(s,t)}).catch(Na)}}.bind(null,e),du:function(t){return ks(ks(ks(t).$h).persistence).du()}.bind(null,e),Vh:async function(t){const e=ks(t);return gu(e.$h).then(t=>kc(e,t))}.bind(null,e)},await this.Cl.start()),await this.persistence.Hc(async t=>{await async function(t,e){const n=ks(t);if(Oc(n),Lc(n),!0===e&&!0!==n.Kl){const t=n.Cl.Ja(),e=await Rc(n,t.gt());n.Kl=!0,await sc(n.Sl,!0);for(const t of e)ju(n.Sl,t)}else if(!1===e&&!1!==n.Kl){const t=[];let e=Promise.resolve();n.Ol.forEach((s,i)=>{n.Cl.oh(i)?t.push(i):e=e.then(()=>(_c(n,i),fu(n.$h,i,!0))),Bu(n.Sl,i)}),await e,await Rc(n,t),function(t){const e=ks(n);e.$l.forEach((t,n)=>{Bu(e.Sl,n)}),e.Ll.ia(),e.$l=new Map,e.Fl=new io(ui.dt)}(),n.Kl=!1,await sc(n.Sl,!1)}}(this.Zl.ka,t),this.Hl&&(t&&!this.Hl.Sr?this.Hl.start(this.$h):t||this.Hl.stop())})}Gl(t){const e=Uu();if(!Lu.L(e))throw new Rs(Ds.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=nu(t.X.p,t.X.persistenceKey);return new Lu(e,t.ks,n,t.clientId,t.Xl)}}class Mc{async initialize(t,e){this.$h||(this.$h=t.$h,this.Cl=t.Cl,this.Lh=this.t_(e),this.Sl=this.e_(e),this.Dl=this.n_(e),this.ka=this.s_(e,!t.synchronizeTabs),this.Cl.Oa=(t=>bc(this.ka,t,1)),this.Sl.Bh.i_=async function(t,e){const n=ks(t);if(!n.currentUser.isEqual(e)){Ts("SyncEngine","User change. New user:",e.i());const t=await hu(n.$h,e);n.currentUser=e,function(t,e){t.ql.forEach(t=>{t.forEach(t=>{t.reject(new Rs(Ds.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.ql.clear()}(n),n.Cl.lh(e,t.Qu,t.Wu),await kc(n,t.Ku)}}.bind(null,this.ka),await sc(this.Sl,this.ka.Ql))}n_(t){return new ac}t_(t){const e=sa(t.X.p),n=(s=t.X,new Qs(s));var s;return function(t,e,n){return new ba(t,e,n)}(t.credentials,n,e)}e_(t){return e=this.$h,n=this.Lh,s=t.ks,i=(t=>bc(this.ka,t,0)),r=Fs.L()?new Fs:new qs,new qu(e,n,s,i,r);var e,n,s,i,r}s_(t,e){return function(t,e,n,s,i,r,o){const a=new yc(t,e,n,s,i,r);return o&&(a.Kl=!0),a}(this.$h,this.Sl,this.Dl,this.Cl,t.Xl,t.Nl,e)}terminate(){return async function(t){const e=ks(t);Ts("RemoteStore","RemoteStore shutting down."),e.Kh.add(5),await $u(e),e.Wh.C(),e.jh.set("Unknown")}(this.Sl)}}class qc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.r_(this.observer.next,t)}error(t){this.observer.error?this.r_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}o_(){this.muted=!0}r_(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Fc{constructor(t){this.c_=t}static fromBase64String(t){try{return new Fc(pi.fromBase64String(t))}catch(t){throw new Rs(Ds.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Fc(pi.fromUint8Array(t))}toBase64(){return this.c_.toBase64()}toUint8Array(){return this.c_.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.c_.isEqual(t.c_)}}class $c{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Rs(Ds.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.u_=new hi(t)}isEqual(t){return this.u_.isEqual(t.u_)}}class jc{constructor(t){this._methodName=t}}class Bc{constructor(t){this.Ur=t}}class Gc{constructor(t,e,n){this.a_=e,this.h_=n,this.type="document",this.firestore=t}get l_(){return this.h_.path}get id(){return this.h_.path.At()}get path(){return this.h_.path.yt()}get parent(){return new Kc(this.firestore,this.a_,this.h_.path.Tt())}withConverter(t){return new Gc(this.firestore,t,this.h_)}}class zc{constructor(t,e,n){this.a_=e,this.__=n,this.type="query",this.firestore=t}withConverter(t){return new zc(this.firestore,t,this.__)}}class Kc extends zc{constructor(t,e,n){super(t,e,hr(n)),this.firestore=t,this.l_=n,this.type="collection"}get id(){return this.__.path.At()}get path(){return this.__.path.yt()}get parent(){const t=this.l_.Tt();return t.Rt()?null:new Gc(this.firestore,null,new ui(t))}withConverter(t){return new Kc(this.firestore,t,this.l_)}}function Hc(t,e,...n){if(t instanceof Bc&&(t=t.Ur),1===arguments.length&&(e=Zs.ct()),Pa("doc","path",e),t instanceof Ba){const s=oi.vt(e,...n);return Ua(s),new Gc(t,null,new ui(s))}{if(!(t instanceof Gc||t instanceof Kc))throw new Rs(Ds.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t.l_.child(oi.vt(e,...n));return Ua(s),new Gc(t.firestore,t instanceof Kc?t.a_:null,new ui(s))}}function Xc(t,e){return t instanceof Bc&&(t=t.Ur),e instanceof Bc&&(e=e.Ur),t instanceof zc&&e instanceof zc&&t.firestore===e.firestore&&yr(t.__,e.__)&&t.a_===e.a_}class Wc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Rs(Ds.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Rs(Ds.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.f_=t,this.d_=e}get latitude(){return this.f_}get longitude(){return this.d_}isEqual(t){return this.f_===t.f_&&this.d_===t.d_}toJSON(){return{latitude:this.f_,longitude:this.d_}}ut(t){return ti(this.f_,t.f_)||ti(this.d_,t.d_)}}const Yc=/^__.*__$/;class Qc{constructor(t,e,n){this.data=t,this.we=e,this.fieldTransforms=n}w_(t,e){return null!==this.we?new Yr(t,this.data,this.we,e,this.fieldTransforms):new Wr(t,this.data,e,this.fieldTransforms)}}class Jc{constructor(t,e,n){this.data=t,this.we=e,this.fieldTransforms=n}w_(t,e){return new Yr(t,this.data,this.we,e,this.fieldTransforms)}}function Zc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xs()}}class tl{constructor(t,e,n,s,i,r){this.settings=t,this.p=e,this.le=n,this.ignoreUndefinedProperties=s,void 0===i&&this.E_(),this.fieldTransforms=i||[],this.we=r||[]}get path(){return this.settings.path}get T_(){return this.settings.T_}I_(t){return new tl(Object.assign(Object.assign({},this.settings),t),this.p,this.le,this.ignoreUndefinedProperties,this.fieldTransforms,this.we)}A_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.I_({path:n,m_:!1});return s.R_(t),s}P_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.I_({path:n,m_:!1});return s.E_(),s}V_(t){return this.I_({path:void 0,m_:!0})}g_(t){return bl(t,this.settings.methodName,this.settings.y_||!1,this.path,this.settings.p_)}contains(t){return void 0!==this.we.find(e=>t.Pt(e))||void 0!==this.fieldTransforms.find(e=>t.Pt(e.field))}E_(){if(this.path)for(let t=0;t<this.path.length;t++)this.R_(this.path.get(t))}R_(t){if(0===t.length)throw this.g_("Document fields must not be empty");if(Zc(this.T_)&&Yc.test(t))throw this.g_('Document fields cannot begin and end with "__"')}}class el{constructor(t,e,n){this.p=t,this.ignoreUndefinedProperties=e,this.le=n||sa(t)}v_(t,e,n,s=!1){return new tl({T_:t,methodName:e,p_:n,path:hi.bt(),m_:!1,y_:s},this.p,this.le,this.ignoreUndefinedProperties)}}function nl(t){const e=t.eo(),n=sa(t.jr);return new el(t.jr,!!e.ignoreUndefinedProperties,n)}function sl(t,e,n,s,i,r={}){const o=t.v_(r.merge||r.mergeFields?2:0,e,n,i);ml("Data must be an object, but it was:",o,s);const a=pl(s,o);let h,u;if(r.merge)h=new di(o.we),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=yl(e,s,n);if(!o.contains(i))throw new Rs(Ds.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);El(t,i)||t.push(i)}h=new di(t),u=o.fieldTransforms.filter(t=>h.$t(t.field))}else h=null,u=o.fieldTransforms;return new Qc(new Oi(a),h,u)}class il extends jc{b_(t){if(2!==t.T_)throw 1===t.T_?t.g_(this._methodName+"() can only appear at the top level of your update data"):t.g_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.we.push(t.path),null}isEqual(t){return t instanceof il}}function rl(t,e,n){return new tl({T_:3,p_:e.settings.p_,methodName:t._methodName,m_:n},e.p,e.le,e.ignoreUndefinedProperties)}class ol extends jc{b_(t){return new qr(t.path,new Rr)}isEqual(t){return t instanceof ol}}class al extends jc{constructor(t,e){super(t),this.S_=e}b_(t){const e=rl(this,t,!0),n=this.S_.map(t=>dl(t,e)),s=new Cr(n);return new qr(t.path,s)}isEqual(t){return this===t}}class hl extends jc{constructor(t,e){super(t),this.S_=e}b_(t){const e=rl(this,t,!0),n=this.S_.map(t=>dl(t,e)),s=new Lr(n);return new qr(t.path,s)}isEqual(t){return this===t}}class ul extends jc{constructor(t,e){super(t),this.D_=e}b_(t){const e=new Ur(t.le,Nr(t.le,this.D_));return new qr(t.path,e)}isEqual(t){return this===t}}function cl(t,e,n,s){const i=t.v_(1,e,n);ml("Data must be an object, but it was:",i,s);const r=[],o=new Li;li(s,(t,s)=>{const a=vl(e,t,n);s instanceof Bc&&(s=s.Ur);const h=i.P_(a);if(s instanceof il)r.push(a);else{const t=dl(s,h);null!=t&&(r.push(a),o.set(a,t))}});const a=new di(r);return new Jc(o.Wt(),a,i.fieldTransforms)}function ll(t,e,n,s,i,r){const o=t.v_(1,e,n),a=[yl(e,s,n)],h=[i];if(r.length%2!=0)throw new Rs(Ds.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(yl(e,r[t])),h.push(r[t+1]);const u=[],c=new Li;for(let t=a.length-1;t>=0;--t)if(!El(u,a[t])){const e=a[t];let n=h[t];n instanceof Bc&&(n=n.Ur);const s=o.P_(e);if(n instanceof il)u.push(e);else{const t=dl(n,s);null!=t&&(u.push(e),c.set(e,t))}}const l=new di(u);return new Jc(c.Wt(),l,o.fieldTransforms)}function fl(t,e,n,s=!1){return dl(n,t.v_(s?4:3,e))}function dl(t,e){if(t instanceof Bc&&(t=t.Ur),gl(t))return ml("Unsupported field value:",e,t),pl(t,e);if(t instanceof jc)return function(t,e){if(!Zc(e.T_))throw e.g_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.g_(t._methodName+"() is not currently supported inside arrays");const n=t.b_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.we.push(e.path),t instanceof Array){if(e.settings.m_&&4!==e.T_)throw e.g_("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=dl(i,e.V_(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof Bc&&(t=t.Ur),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Nr(e.le,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=si.fromDate(t);return{timestampValue:Po(e.le,n)}}if(t instanceof si){const n=new si(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Po(e.le,n)}}if(t instanceof Wc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Fc)return{bytesValue:Uo(e.le,t.c_)};if(t instanceof Gc){const n=e.p,s=t.firestore.jr;if(!s.isEqual(n))throw e.g_(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Mo(t.firestore.jr||e.p,t.h_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.g_("Unsupported field value: "+Ma(t))}(t,e)}function pl(t,e){const n={};return fi(t)?e.path&&e.path.length>0&&e.we.push(e.path):li(t,(t,s)=>{const i=dl(s,e.A_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function gl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof si||t instanceof Wc||t instanceof Fc||t instanceof Gc||t instanceof jc)}function ml(t,e,n){if(!gl(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=Ma(n);throw"an object"===s?e.g_(t+" a custom object"):e.g_(t+" "+s)}}function yl(t,e,n){if(e instanceof Bc&&(e=e.Ur),e instanceof $c)return e.u_;if("string"==typeof e)return vl(t,e);throw bl("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const wl=new RegExp("[~\\*/\\[\\]]");function vl(t,e,n){if(e.search(wl)>=0)throw bl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new $c(...e.split(".")).u_}catch(s){throw bl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function bl(t,e,n,s,i){const r=s&&!s.Rt(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(r||o)&&(h+=" (found",r&&(h+=" in field "+s),o&&(h+=" in document "+i),h+=")"),new Rs(Ds.INVALID_ARGUMENT,a+t+h)}function El(t,e){return t.some(t=>t.isEqual(e))}class Il{constructor(t){this.Lh=t,this.C_=new Map,this.mutations=[],this.N_=!1,this.x_=null,this.k_=new Set}async O_(t){if(this.M_(),this.mutations.length>0)throw new Rs(Ds.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=ks(t),s=Go(n.le)+"/documents",i={documents:e.map(t=>Fo(n.le,t))},r=await n.rt("BatchGetDocuments",s,i),o=new Map;r.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){Ss(!!e.found),e.found.name,e.found.updateTime;const n=$o(t,e.found.name),s=Vo(e.found.updateTime),i=new Oi({mapValue:{fields:e.found.fields}});return new Vi(n,s,i,{})}(t,e):"missing"in e?function(t,e){Ss(!!e.missing),Ss(!!e.readTime);const n=$o(t,e.missing),s=Vo(e.readTime);return new Mi(n,s)}(t,e):xs()}(n.le,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());Ss(!!e),a.push(e)}),a}(this.Lh,t);return e.forEach(t=>{t instanceof Mi||t instanceof Vi?this.F_(t):xs()}),e}set(t,e){this.write(e.w_(t,this.de(t))),this.k_.add(t.toString())}update(t,e){try{this.write(e.w_(t,this.L_(t)))}catch(t){this.x_=t}this.k_.add(t.toString())}delete(t){this.write(new eo(t,this.de(t))),this.k_.add(t.toString())}async commit(){if(this.M_(),this.x_)throw this.x_;const t=this.C_;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=ui.xt(e);this.mutations.push(new no(n,this.de(n)))}),await async function(t,e){const n=ks(t),s=Go(n.le)+"/documents",i={writes:e.map(t=>Ho(n.le,t))};await n.et("Commit",s,i)}(this.Lh,this.mutations),this.N_=!0}F_(t){let e;if(t instanceof Vi)e=t.version;else{if(!(t instanceof Mi))throw xs();e=ii.min()}const n=this.C_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Rs(Ds.ABORTED,"Document version changed between two reads.")}else this.C_.set(t.key.toString(),e)}de(t){const e=this.C_.get(t.toString());return!this.k_.has(t.toString())&&e?$r.updateTime(e):$r._e()}L_(t){const e=this.C_.get(t.toString());if(!this.k_.has(t.toString())&&e){if(e.isEqual(ii.min()))throw new Rs(Ds.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $r.updateTime(e)}return $r.exists(!0)}write(t){this.M_(),this.mutations.push(t)}M_(){}}class Tl{constructor(t,e,n,s){this.ks=t,this.Lh=e,this.updateFunction=n,this.$s=s,this.B_=5,this.ci=new ma(this.ks,"transaction_retry")}run(){this.q_()}q_(){this.ci.Xs(async()=>{const t=new Il(this.Lh),e=this.U_(t);e&&e.then(e=>{this.ks.Ks(()=>t.commit().then(()=>{this.$s.resolve(e)}).catch(t=>{this.K_(t)}))}).catch(t=>{this.K_(t)})})}U_(t){try{const e=this.updateFunction(t);return!$s(e)&&e.catch&&e.then?e:(this.$s.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.$s.reject(t),null}}K_(t){this.B_>0&&this.Q_(t)?(this.B_-=1,this.ks.Ks(()=>(this.q_(),Promise.resolve()))):this.$s.reject(t)}Q_(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!Hs(e)}return!1}}class _l{constructor(t,e,n){this.credentials=t,this.ks=e,this.X=n,this.user=bs.UNAUTHENTICATED,this.clientId=Zs.ct(),this.W_=(()=>{}),this.m=new Ys,this.credentials.T(t=>{Ts("FirestoreClient","Received user=",t.uid),this.user.isEqual(t)||(this.user=t,this.W_(t)),this.m.resolve()})}async getConfiguration(){return await this.m.promise,{ks:this.ks,X:this.X,clientId:this.clientId,credentials:this.credentials,Xl:this.user,Nl:100}}j_(t){this.W_=t,this.m.promise.then(()=>this.W_(this.user))}G_(){if(this.ks.z_)throw new Rs(Ds.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.ks.H_();const t=new Ys;return this.ks.J_(async()=>{try{this.Y_&&await this.Y_.terminate(),this.X_&&await this.X_.terminate(),this.credentials.I(),t.resolve()}catch(e){const n=ga(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function Al(t,e){t.ks.Z_(),Ts("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n),t.j_(n=>t.ks.Zc(async()=>{await hu(e.$h,n)})),e.persistence.Jc(()=>t.terminate()),t.X_=e}async function Nl(t,e){t.ks.Z_();const n=await xl(t);Ts("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.j_(n=>t.ks.Zc(()=>(async function(t,e){const n=ks(t);n.ks.Z_(),Ts("RemoteStore","RemoteStore received new credentials");const s=Xu(n);n.Kh.add(3),await $u(n),s&&n.jh.set("Unknown"),await n.Bh.i_(e),n.Kh.delete(3),await Fu(n)})(e.Sl,n))),t.Y_=e}async function xl(t){return t.X_||(Ts("FirestoreClient","Using default OfflineComponentProvider"),await Al(t,new Pc)),t.X_}async function Sl(t){return t.Y_||(Ts("FirestoreClient","Using default OnlineComponentProvider"),await Nl(t,new Mc)),t.Y_}function kl(t){return xl(t).then(t=>t.persistence)}function Dl(t){return xl(t).then(t=>t.$h)}function Rl(t){return Sl(t).then(t=>t.Sl)}function Cl(t){return Sl(t).then(t=>t.ka)}async function Ol(t){const e=await Sl(t),n=e.Dl;return n.nl=async function(t,e){const n=Oc(t);let s,i;const r=n.kl.get(e);if(r)s=r.targetId,n.Cl.sh(s),i=r.view.vl();else{const t=await lu(n.$h,gr(e)),r=n.Cl.sh(t.targetId);s=t.targetId,i=await wc(n,e,s,"current"===r),n.Ql&&ju(n.Sl,t)}return i}.bind(null,e.ka),n.rl=async function(t,e){const n=ks(t),s=n.kl.get(e),i=n.Ol.get(s.targetId);if(i.length>1)return n.Ol.set(s.targetId,i.filter(t=>!yr(t,e))),void n.kl.delete(e);n.Ql?(n.Cl.rh(s.targetId),n.Cl.Xa(s.targetId)||await fu(n.$h,s.targetId,!1).then(()=>{n.Cl.uh(s.targetId),Bu(n.Sl,s.targetId),_c(n,s.targetId)}).catch(Na)):(_c(n,s.targetId),await fu(n.$h,s.targetId,!0))}.bind(null,e.ka),n}function Ll(t,e,n={}){const s=new Ys;return t.ks.Ks(async()=>(function(t,e,n,s,i){const r=new qc({next:r=>{e.Ks(()=>uc(t,o));const a=r.docs.has(n);!a&&r.fromCache?i.reject(new Rs(Ds.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&s&&"server"===s.source?i.reject(new Rs(Ds.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new lc(hr(n.path),r,{includeMetadataChanges:!0,_l:!0});return hc(t,o)})(await Ol(t),t.ks,e,n,s)),s.promise}function Pl(t,e,n={}){const s=new Ys;return t.ks.Ks(async()=>(function(t,e,n,s,i){const r=new qc({next:n=>{e.Ks(()=>uc(t,o)),n.fromCache&&"server"===s.source?i.reject(new Rs(Ds.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new lc(n,r,{includeMetadataChanges:!0,_l:!0});return hc(t,o)})(await Ol(t),t.ks,e,n,s)),s.promise}class Ul{constructor(){this.tf=Promise.resolve(),this.ef=[],this.nf=!1,this.sf=[],this.rf=null,this.cf=!1,this.uf=[],this.ci=new ma(this,"async_queue_retry"),this.af=(()=>{const t=Vu();t&&Ts("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ci.ei()});const t=Vu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.af)}get z_(){return this.nf}Ks(t){this.enqueue(t)}J_(t){this.hf(),this.lf(t)}H_(){if(!this.nf){this.nf=!0;const t=Vu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.af)}}enqueue(t){return this.hf(),this.nf?new Promise(t=>{}):this.lf(t)}Zc(t){this.Ks(()=>(this.ef.push(t),this._f()))}async _f(){if(0!==this.ef.length){try{await this.ef[0](),this.ef.shift(),this.ci.reset()}catch(t){if(!ua(t))throw t;Ts("AsyncQueue","Operation failed with retryable error: "+t)}this.ef.length>0&&this.ci.Xs(()=>this._f())}}lf(t){const e=this.tf.then(()=>(this.cf=!0,t().catch(t=>{throw this.rf=t,this.cf=!1,_s("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.cf=!1,t))));return this.tf=e,e}ti(t,e,n){this.hf(),this.uf.indexOf(t)>-1&&(e=0);const s=pa.Ls(this,t,e,n,t=>this.ff(t));return this.sf.push(s),s}hf(){this.rf&&xs()}Z_(){}async df(){let t;do{t=this.tf,await t}while(t!==this.tf)}wf(t){for(const e of this.sf)if(e.Os===t)return!0;return!1}Ef(t){return this.df().then(()=>{this.sf.sort((t,e)=>t.Ms-e.Ms);for(const e of this.sf)if(e.Us(),"all"!==t&&e.Os===t)break;return this.df()})}Tf(t){this.uf.push(t)}ff(t){const e=this.sf.indexOf(t);this.sf.splice(e,1)}}class Vl extends Ba{constructor(t,e){super(t,e),this.If=new Ul,this.Kr="name"in t?t.name:"[DEFAULT]"}no(){return this.Af||ql(this),this.Af.terminate()}}function Ml(t){return t.Af||ql(t),t.Af.G_(),t.Af}function ql(t){const e=t.eo(),n=function(t,e,n){return new Vs(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.jr,t.Kr,e);t.Af=new _l(t.Gr,t.If,n)}function Fl(t,e,n){const s=new Ys;return t.ks.enqueue(async()=>{try{await Al(t,n),await Nl(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===Ds.FAILED_PRECONDITION||t.code===Ds.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}}).then(()=>s.promise)}function $l(t){if(t.Hr||t.Jr)throw new Rs(Ds.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class jl{mf(t,e="none"){switch(Ei(t)){case 0:return null;case 1:return t.booleanValue;case 2:return yi(t.integerValue||t.doubleValue);case 3:return this.Rf(t.timestampValue);case 4:return this.Pf(t,e);case 5:return t.stringValue;case 6:return this.Vf(wi(t.bytesValue));case 7:return this.gf(t.referenceValue);case 8:return this.yf(t.geoPointValue);case 9:return this.pf(t.arrayValue,e);case 10:return this.vf(t.mapValue,e);default:throw xs()}}vf(t,e){const n={};return li(t.fields||{},(t,s)=>{n[t]=this.mf(s,e)}),n}yf(t){return new Wc(yi(t.latitude),yi(t.longitude))}pf(t,e){return(t.values||[]).map(t=>this.mf(t,e))}Pf(t,e){switch(e){case"previous":const n=function t(e){const n=e.mapValue.fields.__previous_value__;return vi(n)?t(n):n}(t);return null==n?null:this.mf(n,e);case"estimate":return this.Rf(bi(t));default:return null}}Rf(t){const e=mi(t);return new si(e.seconds,e.nanos)}bf(t,e){const n=oi.vt(t);Ss(na(n));const s=new Ms(n.get(1),n.get(3)),i=new ui(n.Et(5));return s.isEqual(e)||_s(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class Bl{constructor(t,e,n,s,i){this.Sf=t,this.Df=e,this.h_=n,this.Cf=s,this.a_=i}get id(){return this.h_.path.At()}get ref(){return new Gc(this.Sf,this.a_,this.h_)}exists(){return null!==this.Cf}data(){if(this.Cf){if(this.a_){const t=new Gl(this.Sf,this.Df,this.h_,this.Cf,null);return this.a_.fromFirestore(t)}return this.Df.mf(this.Cf.Ht())}}get(t){if(this.Cf){const e=this.Cf.data().field(zl("DocumentSnapshot.get",t));if(null!==e)return this.Df.mf(e)}}}class Gl extends Bl{data(){return super.data()}}function zl(t,e){return"string"==typeof e?vl(t,e):e instanceof Bc?e.Ur.u_:e.u_}class Kl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Hl extends Bl{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this.Sf=t,this.Nf=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this.Cf){if(this.a_){const e=new Xl(this.Sf,this.Df,this.h_,this.Cf,this.metadata,null);return this.a_.fromFirestore(e,t)}return this.Df.mf(this.Cf.Ht(),t.serverTimestamps)}}get(t,e={}){if(this.Cf){const n=this.Cf.data().field(zl("DocumentSnapshot.get",t));if(null!==n)return this.Df.mf(n,e.serverTimestamps)}}}class Xl extends Hl{data(t={}){return super.data(t)}}class Wl{constructor(t,e,n,s){this.Sf=t,this.Df=e,this.xf=s,this.metadata=new Kl(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.xf.docs.size}get empty(){return 0===this.size}forEach(t,e){this.xf.docs.forEach(n=>{t.call(e,new Xl(this.Sf,this.Df,n.key,n,new Kl(this.xf.Xe.has(n.key),this.xf.fromCache),this.query.a_))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.xf.tn)throw new Rs(Ds.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.kf&&this.Of===e||(this.kf=function(t,e){if(t.xf.Ye.Rt()){let e,n=0;return t.xf.docChanges.map(s=>{const i=new Xl(t.Sf,t.Df,s.doc.key,s.doc,new Kl(t.xf.Xe.has(s.doc.key),t.xf.fromCache),t.query.a_);return e=s.doc,{type:"added",doc:i,oldIndex:-1,newIndex:n++}})}{let n=t.xf.Ye;return t.xf.docChanges.filter(t=>e||3!==t.type).map(e=>{const s=new Xl(t.Sf,t.Df,e.doc.key,e.doc,new Kl(t.xf.Xe.has(e.doc.key),t.xf.fromCache),t.query.a_);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(r=(n=n.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xs()}}(e.type),doc:s,oldIndex:i,newIndex:r}})}}(this,e),this.Of=e),this.kf}}function Yl(t){if(cr(t)&&0===t.te.length)throw new Rs(Ds.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ql{}class Jl extends Ql{constructor(t,e,n){super(),this.Ff=t,this.$f=e,this.Lf=n,this.type="where"}Mf(t){const e=nl(t.firestore),n=function(t,e,n,s,i,r,o){let a;if(i.Dt()){if("array-contains"===r||"array-contains-any"===r)throw new Rs(Ds.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on FieldPath.documentId().`);if("in"===r||"not-in"===r){of(o,r);const e=[];for(const n of o)e.push(rf(s,t,n));a={arrayValue:{values:e}}}else a=rf(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||of(o,r),a=fl(n,"where",o,"in"===r||"not-in"===r);const h=zi.create(i,r,a);return function(t,e){if(e.Zt()){const n=fr(t);if(null!==n&&!n.isEqual(e.field))throw new Rs(Ds.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=lr(t);null!==s&&af(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new Rs(Ds.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Rs(Ds.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,h),h}(t.__,0,e,t.firestore.jr,this.Ff,this.$f,this.Lf);return new zc(t.firestore,t.a_,function(t,e){const n=t.filters.concat([e]);return new or(t.path,t.collectionGroup,t.te.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.__,n))}}class Zl extends Ql{constructor(t,e){super(),this.Ff=t,this.Bf=e,this.type="orderBy"}Mf(t){const e=function(t,e,n){if(null!==t.startAt)throw new Rs(Ds.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Rs(Ds.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new nr(e,n);return function(t,e){if(null===lr(t)){const n=fr(t);null!==n&&af(t,n,e.field)}}(t,s),s}(t.__,this.Ff,this.Bf);return new zc(t.firestore,t.a_,function(t,e){const n=t.te.concat([e]);return new or(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.__,e))}}class tf extends Ql{constructor(t,e,n){super(),this.type=t,this.qf=e,this.Uf=n}Mf(t){return new zc(t.firestore,t.a_,mr(t.__,this.qf,this.Uf))}}class ef extends Ql{constructor(t,e,n){super(),this.type=t,this.Kf=e,this.Qf=n}Mf(t){const e=sf(t,this.type,this.Kf,this.Qf);return new zc(t.firestore,t.a_,function(t,e){return new or(t.path,t.collectionGroup,t.te.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.__,e))}}class nf extends Ql{constructor(t,e,n){super(),this.type=t,this.Kf=e,this.Qf=n}Mf(t){const e=sf(t,this.type,this.Kf,this.Qf);return new zc(t.firestore,t.a_,function(t,e){return new or(t.path,t.collectionGroup,t.te.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.__,e))}}function sf(t,e,n,s){if(n[0]instanceof Bc&&(n[0]=n[0].Ur),n[0]instanceof Bl)return function(t,e,n,s,i){if(!s)throw new Rs(Ds.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const r=[];for(const n of pr(t))if(n.field.Dt())r.push(xi(e,s.key));else{const t=s.field(n.field);if(vi(t))throw new Rs(Ds.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.yt();throw new Rs(Ds.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new tr(r,i)}(t.__,t.firestore.jr,e,n[0].Cf,s);{const i=nl(t.firestore);return function(t,e,n,s,i,r){const o=t.te;if(i.length>o.length)throw new Rs(Ds.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let r=0;r<i.length;r++){const h=i[r];if(o[r].field.Dt()){if("string"!=typeof h)throw new Rs(Ds.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!dr(t)&&-1!==h.indexOf("/"))throw new Rs(Ds.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const n=t.path.child(oi.vt(h));if(!ui.Mt(n))throw new Rs(Ds.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new ui(n);a.push(xi(e,i))}else{const t=fl(n,s,h);a.push(t)}}return new tr(a,r)}(t.__,t.firestore.jr,i,e,n,s)}}function rf(t,e,n){if(n instanceof Bc&&(n=n.Ur),"string"==typeof n){if(""===n)throw new Rs(Ds.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!dr(e)&&-1!==n.indexOf("/"))throw new Rs(Ds.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(oi.vt(n));if(!ui.Mt(s))throw new Rs(Ds.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return xi(t,new ui(s))}if(n instanceof Gc)return xi(t,n.h_);throw new Rs(Ds.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ma(n)+".")}function of(t,e){if(!Array.isArray(t)||0===t.length)throw new Rs(Ds.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Rs(Ds.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function af(t,e,n){if(!n.isEqual(e))throw new Rs(Ds.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function hf(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class uf extends jl{constructor(t){super(),this.firestore=t}Vf(t){return new Fc(t)}gf(t){const e=this.bf(t,this.firestore.jr);return new Gc(this.firestore,null,e)}}class cf{constructor(t,e){this.Sf=t,this.Wf=e,this.jf=[],this.Gf=!1,this.zf=nl(t)}set(t,e,n){this.Hf();const s=lf(t,this.Sf),i=hf(s.a_,e,n),r=sl(this.zf,"WriteBatch.set",s.h_,i,null!==s.a_,n);return this.jf.push(r.w_(s.h_,$r._e())),this}update(t,e,n,...s){this.Hf();const i=lf(t,this.Sf);let r;return e instanceof Bc&&(e=e.Ur),r="string"==typeof e||e instanceof $c?ll(this.zf,"WriteBatch.update",i.h_,e,n,s):cl(this.zf,"WriteBatch.update",i.h_,e),this.jf.push(r.w_(i.h_,$r.exists(!0))),this}delete(t){this.Hf();const e=lf(t,this.Sf);return this.jf=this.jf.concat(new eo(e.h_,$r._e())),this}commit(){return this.Hf(),this.Gf=!0,this.jf.length>0?this.Wf(this.jf):Promise.resolve()}Hf(){if(this.Gf)throw new Rs(Ds.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function lf(t,e){if(t instanceof Bc&&(t=t.Ur),t.firestore!==e)throw new Rs(Ds.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function ff(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class df extends jl{constructor(t){super(),this.firestore=t}Vf(t){return new Fc(t)}gf(t){const e=this.bf(t,this.firestore.jr);return new Gc(this.firestore,null,e)}}function pf(t,e){return function(t,e){const n=new Ys;return t.ks.Ks(async()=>(async function(t,e,n){const s=Lc(t);try{const i=await function(t,e){const n=ks(t),s=si.now(),i=e.reduce((t,e)=>t.add(e.key),yo());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.Uu.Vu(t,i).next(i=>{r=i;const o=[];for(const t of e){const e=Kr(t,r.get(t.key));null!=e&&o.push(new Yr(t.key,e,Pi(e.proto.mapValue),$r.exists(!0)))}return n.Au.mo(t,s,o,e)})).then(t=>{const e=t.nr(r);return{batchId:t.batchId,ar:e}})}(s.$h,e);s.Cl.Za(i.batchId),function(t,e,n){let s=t.Bl[t.currentUser.i()];s||(s=new io(ti)),s=s.Ee(e,n),t.Bl[t.currentUser.i()]=s}(s,i.batchId,n),await kc(s,i.ar),await Ju(s.Sl)}catch(t){const e=ga(t,"Failed to persist write");n.reject(e)}})(await Cl(t),e,n)),n.promise}(Ml(t),e)}function gf(t,e,n){const s=n.docs.get(e.h_),i=new df(t);return new Hl(t,i,e.h_,s,new Kl(n.hasPendingWrites,n.fromCache),e.a_)}class mf extends class{constructor(t,e){this.Sf=t,this.Jf=e,this.zf=nl(t)}get(t){const e=lf(t,this.Sf),n=new uf(this.Sf);return this.Jf.O_([e.h_]).then(t=>{if(!t||1!==t.length)return xs();const s=t[0];if(s instanceof Mi)return new Bl(this.Sf,n,e.h_,null,e.a_);if(s instanceof Vi)return new Bl(this.Sf,n,s.key,s,e.a_);throw xs()})}set(t,e,n){const s=lf(t,this.Sf),i=hf(s.a_,e,n),r=sl(this.zf,"Transaction.set",s.h_,i,null!==s.a_,n);return this.Jf.set(s.h_,r),this}update(t,e,n,...s){const i=lf(t,this.Sf);let r;return e instanceof Bc&&(e=e.Ur),r="string"==typeof e||e instanceof $c?ll(this.zf,"Transaction.update",i.h_,e,n,s):cl(this.zf,"Transaction.update",i.h_,e),this.Jf.update(i.h_,r),this}delete(t){const e=lf(t,this.Sf);return this.Jf.delete(e.h_),this}}{constructor(t,e){super(t,e),this.Sf=t}get(t){const e=lf(t,this.Sf),n=new df(this.Sf);return super.get(t).then(t=>new Hl(this.Sf,n,e.h_,t.Cf,new Kl(!1,!1),e.a_))}}e._registerComponent(new c("firestore-exp",t=>((t,e)=>new Vl(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.900","node"),t.Bytes=Fc,t.CACHE_SIZE_UNLIMITED=-1,t.CollectionReference=Kc,t.DocumentReference=Gc,t.DocumentSnapshot=Hl,t.FieldPath=$c,t.FieldValue=jc,t.FirebaseFirestore=Vl,t.FirestoreError=Rs,t.GeoPoint=Wc,t.Query=zc,t.QueryConstraint=Ql,t.QueryDocumentSnapshot=Xl,t.QuerySnapshot=Wl,t.SnapshotMetadata=Kl,t.Timestamp=si,t.Transaction=mf,t.WriteBatch=cf,t.addDoc=function(t,e){const n=qa(t.firestore,Vl),s=Hc(t),i=hf(t.a_,e);return pf(n,[sl(nl(t.firestore),"addDoc",s.h_,i,null!==t.a_,{}).w_(s.h_,$r.exists(!1))]).then(()=>s)},t.arrayRemove=function(...t){return new hl("arrayRemove",t)},t.arrayUnion=function(...t){return new al("arrayUnion",t)},t.clearIndexedDbPersistence=function(t){if(t.Hr&&!t.Jr)throw new Rs(Ds.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ys;return t.If.J_(async()=>{try{await async function(t){if(!oa.L())return Promise.resolve();const e=t+"main";await oa.delete(e)}(nu(t.jr,t.Kr)),e.resolve()}catch(t){e.reject(t)}}),e.promise},t.collection=function(t,e,...n){if(t instanceof Bc&&(t=t.Ur),Pa("collection","path",e),t instanceof Ba){const s=oi.vt(e,...n);return Va(s),new Kc(t,null,s)}{if(!(t instanceof Gc||t instanceof Kc))throw new Rs(Ds.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=oi.vt(t.path,...n).child(oi.vt(e));return Va(s),new Kc(t.firestore,null,s)}},t.collectionGroup=function(t,e){if(t=qa(t,Ba),Pa("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Rs(Ds.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new zc(t,null,function(t){return new or(oi.bt(),t)}(e))},t.deleteDoc=function(t){return pf(qa(t.firestore,Vl),[new eo(t.h_,$r._e())])},t.deleteField=function(){return new il("deleteField")},t.disableNetwork=function(t){return function(t){return t.ks.enqueue(async()=>{const e=await kl(t),n=await Rl(t);return e.Yc(!1),async function(t){const e=ks(n);e.Kh.add(0),await $u(e),e.jh.set("Offline")}()})}(Ml(t=qa(t,Vl)))},t.doc=Hc,t.documentId=function(){return new $c("__name__")},t.enableIndexedDbPersistence=function(t,e){$l(t=qa(t,Vl));const n=Ml(t),s=t.eo(),i=new Mc;return Fl(n,i,new Uc(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))},t.enableMultiTabIndexedDbPersistence=function(t){$l(t=qa(t,Vl));const e=Ml(t),n=t.eo(),s=new Mc;return Fl(e,s,new Vc(s,n.cacheSizeBytes))},t.enableNetwork=function(t){return function(t){return t.ks.enqueue(async()=>{const e=await kl(t),n=await Rl(t);return e.Yc(!0),function(t){const e=ks(n);return e.Kh.delete(0),Fu(e)}()})}(Ml(t=qa(t,Vl)))},t.endAt=function(...t){return new nf("endAt",t,!1)},t.endBefore=function(...t){return new nf("endBefore",t,!0)},t.getDoc=function(t){const e=qa((t=qa(t,Gc)).firestore,Vl);return Ll(Ml(e),t.h_).then(n=>gf(e,t,n))},t.getDocFromCache=function(t){const e=qa((t=qa(t,Gc)).firestore,Vl),n=Ml(e),s=new df(e);return function(t,e){const n=new Ys;return t.ks.Ks(async()=>(async function(t,e,n){try{const s=await function(t,e){const n=ks(t);return n.persistence.runTransaction("read document","readonly",t=>n.Uu.mu(t,e))}(t,e);s instanceof Vi?n.resolve(s):s instanceof Mi?n.resolve(null):n.reject(new Rs(Ds.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=ga(t,`Failed to get document '${e} from cache`);n.reject(s)}})(await Dl(t),e,n)),n.promise}(n,t.h_).then(n=>new Hl(e,s,t.h_,n,new Kl(n instanceof Vi&&n.zt,!0),t.a_))},t.getDocFromServer=function(t){const e=qa((t=qa(t,Gc)).firestore,Vl);return Ll(Ml(e),t.h_,{source:"server"}).then(n=>gf(e,t,n))},t.getDocs=function(t){const e=qa((t=qa(t,zc)).firestore,Vl),n=Ml(e),s=new df(e);return Yl(t.__),Pl(n,t.__).then(n=>new Wl(e,s,t,n))},t.getDocsFromCache=function(t){const e=qa((t=qa(t,zc)).firestore,Vl),n=Ml(e),s=new df(e);return function(t,e){const n=new Ys;return t.ks.Ks(async()=>(async function(t,e,n){try{const s=await du(t,e,!0),i=new pc(e,s.ju),r=i.Al(s.documents),o=i.mr(r,!1);n.resolve(o.snapshot)}catch(t){const s=ga(t,`Failed to execute query '${e} against cache`);n.reject(s)}})(await Dl(t),e,n)),n.promise}(n,t.__).then(n=>new Wl(e,s,t,n))},t.getDocsFromServer=function(t){const e=qa((t=qa(t,zc)).firestore,Vl),n=Ml(e),s=new df(e);return Pl(n,t.__,{source:"server"}).then(n=>new Wl(e,s,t,n))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new ul("increment",t)},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&-1!==n.cacheSizeBytes&&n.cacheSizeBytes<1048576)throw new Rs(Ds.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return s.Xr(n),s},t.limit=function(t){return Fa("limit",t),new tf("limit",t,"F")},t.limitToLast=function(t){return Fa("limitToLast",t),new tf("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,s,i;t instanceof Bc&&(t=t.Ur);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||ff(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(ff(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let h,u,c;if(t instanceof Gc)u=qa(t.firestore,Vl),c=hr(t.h_.path),h={next:n=>{e[o]&&e[o](gf(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=qa(t,zc);u=qa(n.firestore,Vl),c=n.__;const s=new df(u);h={next:t=>{e[o]&&e[o](new Wl(u,s,n,t))},error:e[o+1],complete:e[o+2]},Yl(t.__)}return function(t,e,n,s){const i=new qc(h),r=new lc(e,i,n);return t.ks.Ks(async()=>hc(await Ol(t),r)),()=>{i.o_(),t.ks.Ks(async()=>uc(await Ol(t),r))}}(Ml(u),c,a)},t.onSnapshotsInSync=function(t,e){return function(t,e){const n=new qc(e);return t.ks.Ks(async()=>(function(t,e){ks(t).el.add(e),e.next()})(await Ol(t),n)),()=>{n.o_(),t.ks.Ks(async()=>(function(t,e){ks(t).el.delete(e)})(await Ol(t),n))}}(Ml(t=qa(t,Vl)),ff(e)?e:{next:e})},t.orderBy=function(t,e="asc"){const n=e,s=zl("orderBy",t);return new Zl(s,n)},t.query=function(t,...e){for(const n of e)t=n.Mf(t);return t},t.queryEqual=Xc,t.refEqual=function(t,e){return t instanceof Bc&&(t=t.Ur),e instanceof Bc&&(e=e.Ur),(t instanceof Gc||t instanceof Kc)&&(e instanceof Gc||e instanceof Kc)&&t.firestore===e.firestore&&t.path===e.path&&t.a_===e.a_},t.runTransaction=function(t,e){return function(t,e){const n=new Ys;return t.ks.Ks(async()=>{const s=await function(t){return Sl(t).then(t=>t.Lh)}(t);new Tl(t.ks,s,e,n).run()}),n.promise}(Ml(t),n=>e(new mf(t,n)))},t.serverTimestamp=function(){return new ol("serverTimestamp")},t.setDoc=function(t,e,n){const s=qa((t=qa(t,Gc)).firestore,Vl),i=hf(t.a_,e,n);return pf(s,[sl(nl(s),"setDoc",t.h_,i,null!==t.a_,n).w_(t.h_,$r._e())])},t.setLogLevel=function(t){Es.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof Hl&&e instanceof Hl?t.Sf===e.Sf&&t.h_.isEqual(e.h_)&&(null===t.Cf?null===e.Cf:t.Cf.isEqual(e.Cf))&&t.a_===e.a_:t instanceof Wl&&e instanceof Wl&&t.Sf===e.Sf&&Xc(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.xf.isEqual(e.xf)},t.startAfter=function(...t){return new ef("startAfter",t,!1)},t.startAt=function(...t){return new ef("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),t._delete()},t.updateDoc=function(t,e,n,...s){const i=qa((t=qa(t,Gc)).firestore,Vl),r=nl(i);let o;return e instanceof Bc&&(e=e.Ur),pf(i,[(o="string"==typeof e||e instanceof $c?ll(r,"updateDoc",t.h_,e,n,s):cl(r,"updateDoc",t.h_,e)).w_(t.h_,$r.exists(!0))])},t.waitForPendingWrites=function(t){return function(t){const e=new Ys;return t.ks.Ks(async()=>(async function(t,e){const n=ks(t);Xu(n.Sl)||Ts("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await function(t){const e=ks(n.$h);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.Au.yo(t))}();if(-1===s)return void e.resolve();const i=n.ql.get(s)||[];i.push(e),n.ql.set(s,i)}catch(t){const n=ga(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}})(await Cl(t),e)),e.promise}(Ml(t=qa(t,Vl)))},t.where=function(t,e,n){const s=e,i=zl("where",t);return new Jl(i,s,n)},t.writeBatch=function(t){return Ml(t=qa(t,Vl)),new cf(t,e=>pf(t,e))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});