!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i="FirebaseError",r=function(t){function e(n,s,r){var a=t.call(this,s)||this;return a.code=n,a.customData=r,a.name=i,Object.setPrototypeOf(a,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,o.prototype.create),a}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(h,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",u=this.serviceName+": "+a+" ("+i+").";return new r(i,u,s)},t}();var a,u,h=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(u||(u={}));var f={debug:u.DEBUG,verbose:u.VERBOSE,info:u.INFO,warn:u.WARN,error:u.ERROR,silent:u.SILENT},d=u.INFO,p=((a={})[u.DEBUG]="log",a[u.VERBOSE]="log",a[u.INFO]="info",a[u.WARN]="warn",a[u.ERROR]="error",a),g=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var i=(new Date).toISOString(),r=p[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[r].apply(console,l(["["+i+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in u))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.DEBUG],t)),this._logHandler.apply(this,l([this,u.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.VERBOSE],t)),this._logHandler.apply(this,l([this,u.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.INFO],t)),this._logHandler.apply(this,l([this,u.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.WARN],t)),this._logHandler.apply(this,l([this,u.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.ERROR],t)),this._logHandler.apply(this,l([this,u.ERROR],t))},t}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},I=I||{},E=b||self;function _(){}function T(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var N="closure_uid_"+(1e9*Math.random()>>>0),k=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function D(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function S(t,e,n){return(S=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:D).apply(null,arguments)}function O(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function R(){return Date.now()}function C(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}function L(){this.j=this.j,this.i=this.i}L.prototype.j=!1,L.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,N)&&t[N]||(t[N]=++k)})(this)},L.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var P=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},V=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var s=t.length,i="string"==typeof t?t.split(""):t,r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function M(t){return Array.prototype.concat.apply([],arguments)}function U(t){var e=t.length;if(0<e){for(var n=Array(e),s=0;s<e;s++)n[s]=t[s];return n}return[]}function q(t){return/^[\s\xa0]*$/.test(t)}var F,B=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function j(t,e){return-1!=t.indexOf(e)}function z(t,e){return t<e?-1:t>e?1:0}t:{var $=E.navigator;if($){var G=$.userAgent;if(G){F=G;break t}}F=""}function H(t,e,n){for(var s in t)e.call(n,t[s],s,t)}function K(t){var e={};for(var n in t)e[n]=t[n];return e}var W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,s,i=1;i<arguments.length;i++){for(n in s=arguments[i])t[n]=s[n];for(var r=0;r<W.length;r++)n=W[r],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function X(t){return X[" "](t),t}X[" "]=_;var Q,J,Z=j(F,"Opera"),tt=j(F,"Trident")||j(F,"MSIE"),et=j(F,"Edge"),nt=et||tt,st=j(F,"Gecko")&&!(j(F.toLowerCase(),"webkit")&&!j(F,"Edge"))&&!(j(F,"Trident")||j(F,"MSIE"))&&!j(F,"Edge"),it=j(F.toLowerCase(),"webkit")&&!j(F,"Edge");function rt(){var t=E.document;return t?t.documentMode:void 0}t:{var ot="",at=(J=F,st?/rv:([^\);]+)(\)|;)/.exec(J):et?/Edge\/([\d\.]+)/.exec(J):tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(J):it?/WebKit\/(\S+)/.exec(J):Z?/(?:Version)[ \/]?(\S+)/.exec(J):void 0);if(at&&(ot=at?at[1]:""),tt){var ut=rt();if(null!=ut&&ut>parseFloat(ot)){Q=String(ut);break t}}Q=ot}var ht,ct={};function lt(t){return function(t,e){var n=ct;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=B(String(Q)).split("."),s=B(String(t)).split("."),i=Math.max(n.length,s.length),r=0;0==e&&r<i;r++){var o=n[r]||"",a=s[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=z(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||z(0==o[2].length,0==a[2].length)||z(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(E.document&&tt){var ft=rt();ht=ft||(parseInt(Q,10)||void 0)}else ht=void 0;var dt=ht,pt=!tt||9<=Number(dt),gt=tt&&!lt("9"),mt=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{E.addEventListener("test",_,e),E.removeEventListener("test",_,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(st){t:{try{X(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:vt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}yt.prototype.b=function(){this.defaultPrevented=!0},C(wt,yt);var vt={2:"touch",3:"pen",4:"mouse"};wt.prototype.b=function(){wt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var bt="closure_listenable_"+(1e6*Math.random()|0),It=0;function Et(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function _t(t){this.src=t,this.a={},this.b=0}function Tt(t,e){var n=e.type;if(n in t.a){var s,i=t.a[n],r=P(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(Et(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.Y&&r.listener==e&&r.capture==!!n&&r.ca==s)return i}return-1}_t.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.a[r])||(t=this.a[r]=[],this.b++);var o=At(t,e,s,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ca=i,this.key=++It,this.Y=this.Z=!1}(e,this.src,r,!!s,i)).Z=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),kt={};function xt(t,e,n,s,i){if(s&&s.once)return function t(e,n,s,i,r){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);return null}s=Vt(s);return e&&e[bt]?e.wa(n,s,A(i)?!!i.capture:!!i,r):Dt(e,n,s,!0,i,r)}(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)xt(t,e[r],n,s,i);return null}return n=Vt(n),t&&t[bt]?t.va(e,n,A(s)?!!s.capture:!!s,i):Dt(t,e,n,!1,s,i)}function Dt(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=A(i)?!!i.capture:!!i;if(o&&!pt)return null;var a=Lt(t);if(a||(t[Nt]=a=new _t(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){var t=Ct,e=pt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)mt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Ot(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function St(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[bt])Tt(e.c,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Ot(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Lt(e))?(Tt(n,t),0==n.b&&(n.src=null,e[Nt]=null)):Et(t)}}}function Ot(t){return t in kt?kt[t]:kt[t]="on"+t}function Rt(t,e){var n=t.listener,s=t.ca||t.src;return t.Z&&St(t),n.call(s,e)}function Ct(t,e){if(t.Y)return!0;if(!pt){if(!e)t:{e=["window","event"];for(var n=E,s=0;s<e.length;s++)if(null==(n=n[e[s]])){e=null;break t}e=n}return Rt(t,e=new wt(e,this))}return Rt(t,new wt(e,this))}function Lt(t){return(t=t[Nt])instanceof _t?t:null}var Pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vt(t){return"function"==typeof t?t:(t[Pt]||(t[Pt]=function(e){return t.handleEvent(e)}),t[Pt])}function Mt(){L.call(this),this.c=new _t(this),this.J=this,this.C=null}function Ut(t,e){var n,s=t.C;if(s)for(n=[];s;s=s.C)n.push(s);if(t=t.J,s=e.type||e,"string"==typeof e)e=new yt(e,t);else if(e instanceof yt)e.target=e.target||t;else{var i=e;Y(e=new yt(s,t),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.a=n[r];i=qt(o,s,!0,e)&&i}if(i=qt(o=e.a=t,s,!0,e)&&i,i=qt(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)i=qt(o=e.a=n[r],s,!1,e)&&i}function qt(t,e,n,s){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.Y&&o.capture==n){var a=o.listener,u=o.ca||o.src;o.Z&&Tt(t.c,o),i=!1!==a.call(u,s)&&i}}return i&&!s.defaultPrevented}C(Mt,L),Mt.prototype[bt]=!0,(v=Mt.prototype).addEventListener=function(t,e,n,s){xt(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){!function t(e,n,s,i,r){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);else i=A(i)?!!i.capture:!!i,s=Vt(s),e&&e[bt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(s=At(o=e.a[n],s,i,r))&&(Et(o[s]),Array.prototype.splice.call(o,s,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Lt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,s,i,r)),(s=-1<e?n[e]:null)&&St(s))}(this,t,e,n,s)},v.G=function(){if(Mt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],s=0;s<n.length;s++)Et(n[s]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,s){return this.c.add(String(t),e,!1,n,s)},v.wa=function(t,e,n,s){return this.c.add(String(t),e,!0,n,s)};var Ft=E.JSON.stringify;function Bt(){this.b=this.a=null}var jt,zt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new Gt},function(t){t.reset()});function $t(){var t=Yt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Gt(){this.next=this.b=this.a=null}function Ht(t){E.setTimeout(function(){throw t},0)}function Kt(t,e){jt||function(){var t=E.Promise.resolve(void 0);jt=function(){t.then(Xt)}}(),Wt||(jt(),Wt=!0),Yt.add(t,e)}Bt.prototype.add=function(t,e){var n=zt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Gt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Gt.prototype.reset=function(){this.next=this.b=this.a=null};var Wt=!1,Yt=new Bt;function Xt(){for(var t;t=$t();){try{t.a.call(t.b)}catch(t){Ht(t)}var e=zt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Wt=!1}function Qt(t,e){Mt.call(this),this.b=t||1,this.a=e||E,this.f=S(this.Za,this),this.g=R()}function Jt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==typeof t)n&&(t=S(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=S(t.handleEvent,t)}return 2147483647<Number(e)?-1:E.setTimeout(t,e||0)}C(Qt,Mt),(v=Qt.prototype).aa=!1,v.M=null,v.Za=function(){if(this.aa){var t=R()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ut(this,"tick"),this.aa&&(Jt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=R())},v.G=function(){Qt.X.G.call(this),Jt(this),delete this.a};var te=function(t){function e(e,n){var s=t.call(this)||this;return s.g=e,s.h=n,s.b=null,s.c=!1,s.a=null,s}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(E.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(L);function ee(t){L.call(this),this.b=t,this.a={}}C(ee,L);var ne=[];function se(t,e,n,s){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var r=xt(e,n[i],s||t.handleEvent,!1,t.b||t);if(!r)break;t.a[r.key]=r}}function ie(t){H(t.a,function(t,e){this.a.hasOwnProperty(e)&&St(t)},t),t.a={}}function re(){this.a=!0}function oe(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ee.prototype.G=function(){ee.X.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},re.prototype.info=function(){};var ae={},ue=null;function he(){return ue=ue||new Mt}function ce(t){yt.call(this,ae.Fa,t)}function le(t){var e=he();Ut(e,new ce(e,t))}function fe(t,e){yt.call(this,ae.STAT_EVENT,t),this.stat=e}function de(t){var e=he();Ut(e,new fe(e,t))}function pe(t){yt.call(this,ae.Ga,t)}function ge(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){t()},e)}ae.Fa="serverreachability",C(ce,yt),ae.STAT_EVENT="statevent",C(fe,yt),ae.Ga="timingevent",C(pe,yt);var me={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},ye={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function we(){}function ve(t){var e;return(e=t.a)||(e=t.a={}),e}function be(){}we.prototype.a=null;var Ie,Ee={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function _e(){yt.call(this,"d")}function Te(){yt.call(this,"c")}function Ae(){}function Ne(t,e,n,s){this.g=t,this.c=e,this.f=n,this.S=s||1,this.J=new ee(this),this.P=ke,t=nt?125:void 0,this.R=new Qt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}C(_e,yt),C(Te,yt),C(Ae,we),Ie=new Ae;var ke=45e3,xe={},De={};function Se(t,e,n){t.H=1,t.i=Je(He(e)),t.j=n,t.I=!0,Oe(t,null)}function Oe(t,e){t.u=R(),Le(t),t.l=He(t.i);var n=t.l,s=t.S;Array.isArray(s)||(s=[String(s)]),fn(n.b,"t",s),t.D=0,t.a=rs(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(S(t.Ca,t,t.a),t.O)),se(t.J,t.a,"readystatechange",t.Xa),e=t.B?K(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),le(1),function(t,e,n,s,i,r){t.info(function(){if(t.a)if(r)for(var o="",a=r.split("&"),u=0;u<a.length;u++){var h=a[u].split("=");if(1<h.length){var c=h[0];h=h[1];var l=c.split("_");o=2<=l.length&&"type"==l[1]?o+(c+"=")+h+"&":o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.S,t.j)}function Re(t,e,n){for(var s=!0;!t.A&&t.D<n.length;){var i=Ce(t,n);if(i==De){4==e&&(t.h=4,de(14),s=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(i==xe){t.h=4,de(15),oe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}oe(t.c,t.f,i,null),qe(t,i)}4==e&&0==n.length&&(t.h=1,de(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(e),e.F=!0,de(11))):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Ue(t),Me(t))}function Ce(t,e){var n=t.D,s=e.indexOf("\n",n);return-1==s?De:(n=Number(e.substring(n,s)),isNaN(n)?xe:(s+=1)+n>e.length?De:(e=e.substr(s,n),t.D=s+n,e))}function Le(t){t.T=R()+t.P,Pe(t,t.P)}function Pe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ge(S(t.Va,t),e)}function Ve(t){t.o&&(E.clearTimeout(t.o),t.o=null)}function Me(t){0==t.g.v||t.A||ts(t.g,t)}function Ue(t){Ve(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Jt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function qe(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||vn(n.b,t)))if(n.I=t.N,!t.C&&vn(n.b,t)&&3==n.v){try{var s=n.ka.a.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Zn(n),jn(n)}Xn(n),de(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ge(S(n.Sa,n),6e3));if(1>=wn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else ns(n,11)}else if((t.C||n.a==t)&&Zn(n),!q(e))for(e=s=n.ka.a.parse(e),s=0;s<e.length;s++)if(i=e[s],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var r=i[3];null!=r&&(n.ha=r,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var h=t.a;if(h){var c=h.a?h.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var l=u.b;!l.a&&(j(c,"spdy")||j(c,"quic")||j(c,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(bn(l,l.b),l.b=null))}if(u.A){var f=h.a?h.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Qe(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=R()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=is(u,u.C?u.ga:null,u.fa),d.C){In(u.b,d);var p=d,g=u.D;g&&p.setTimeout(g),p.o&&(Ve(p),Le(p)),u.a=d}else Yn(u);0<n.g.length&&Gn(n)}else"stop"!=i[0]&&"close"!=i[0]||ns(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ns(n,7):Bn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);le(4)}catch(t){}}function Fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(T(t)||"string"==typeof t)V(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(T(t)||"string"==typeof t){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;i=(s=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(T(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t)).length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function Be(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof Be)for(n=t.L(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var s=t.a[e];ze(t.b,s)&&(t.a[n++]=s),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)ze(i,s=t.a[e])||(t.a[n++]=s,i[s]=1),e++;t.a.length=n}}function ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ne.prototype).setTimeout=function(t){this.P=t},v.Xa=function(t){t=t.target;var e=this.F;e&&3==Mn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Mn(this.a),n=this.a.ua(),s=this.a.W();if(!(3>e||3==e&&!nt&&!this.a.$())){this.A||4!=e||7==n||le(8==n||0>=s?3:2),Ve(this);var i=this.a.W();this.N=i;var r=this.a.$();if(this.b=200==i,function(t,e,n,s,i,r,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.h=3,de(12),Ue(this),Me(this);break t}oe(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,qe(this,u)}this.I?(Re(this,e,r),nt&&this.b&&3==e&&(se(this.J,this.R,"tick",this.Wa),this.R.start())):(oe(this.c,this.f,r,null),qe(this,r)),4==e&&Ue(this),this.b&&!this.A&&(4==e?ts(this.g,this):(this.b=!1,Le(this)))}else 400==i&&0<r.indexOf("Unknown SID")?(this.h=3,de(12)):(this.h=0,de(13)),Ue(this),Me(this)}}}catch(t){}},v.Wa=function(){if(this.a){var t=Mn(this.a),e=this.a.$();this.D<e.length&&(Ve(this),Re(this,t,e),this.b&&4!=t&&Le(this))}},v.cancel=function(){this.A=!0,Ue(this)},v.Va=function(){this.o=null;var t=R();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(le(3),de(17)),Ue(this),this.h=2,Me(this)):Pe(this,this.T-t)},(v=Be.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return je(this),this.a.concat()},v.get=function(t,e){return ze(this.b,t)?this.b[t]:e},v.set=function(t,e){ze(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};var $e=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ge(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ge){this.a=void 0!==e?e:t.a,Ke(this,t.f),this.j=t.j,We(this,t.c),Ye(this,t.h),this.g=t.g,e=t.b;var n=new un;n.c=e.c,e.a&&(n.a=new Be(e.a),n.b=e.b),Xe(this,n),this.i=t.i}else t&&(n=String(t).match($e))?(this.a=!!e,Ke(this,n[1]||"",!0),this.j=Ze(n[2]||""),We(this,n[3]||"",!0),Ye(this,n[4]),this.g=Ze(n[5]||"",!0),Xe(this,n[6]||"",!0),this.i=Ze(n[7]||"")):(this.a=!!e,this.b=new un(null,this.a))}function He(t){return new Ge(t)}function Ke(t,e,n){t.f=n?Ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function We(t,e,n){t.c=n?Ze(e,!0):e}function Ye(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Xe(t,e,n){e instanceof un?(t.b=e,function(t,e){e&&!t.f&&(hn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),fn(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=tn(e,on)),t.b=new un(e,t.a))}function Qe(t,e,n){t.b.set(e,n)}function Je(t){return Qe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^R()).toString(36)),t}function Ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,en),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function en(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ge.prototype.toString=function(){var t=[],e=this.f;e&&t.push(tn(e,nn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(tn(e,nn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(tn(n,"/"==n.charAt(0)?rn:sn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",tn(n,an)),t.join("")};var nn=/[#\/\?@]/g,sn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,an=/#/g;function un(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function hn(t){t.a||(t.a=new Be,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function cn(t,e){hn(t),e=dn(t,e),ze(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,ze((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function ln(t,e){return hn(t),e=dn(t,e),ze(t.a.b,e)}function fn(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(dn(t,e),U(n)),t.b+=n.length)}function dn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(v=un.prototype).add=function(t,e){hn(this),this.c=null,t=dn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){hn(this),this.a.forEach(function(n,s){V(n,function(n){t.call(e,n,s,this)},this)},this)},v.L=function(){hn(this);for(var t=this.a.K(),e=this.a.L(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n},v.K=function(t){hn(this);var e=[];if("string"==typeof t)ln(this,t)&&(e=M(e,this.a.get(dn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=M(e,t[n])}return e},v.set=function(t,e){return hn(this),this.c=null,ln(this,t=dn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.K(s);for(var r=0;r<s.length;r++){var o=i;""!==s[r]&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.c=t.join("&")};var pn=function(){return function(t,e){this.b=t,this.a=e}}();function gn(t){this.g=t||mn,E.PerformanceNavigationTiming?t=0<(t=E.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(E.ia&&E.ia.ya&&E.ia.ya()&&E.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var mn=10;function yn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function wn(t){return t.b?1:t.a?t.a.size:0}function vn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function bn(t,e){t.a?t.a.add(e):t.b=e}function In(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function En(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var s=t.c;try{for(var i=w(t.a.values()),r=i.next();!r.done;r=i.next()){var o=r.value;s=s.concat(o.s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return s}return U(t.c)}function _n(){}function Tn(t,e,n){var s=n||"";try{Fe(t,function(t,n){var i=t;A(t)&&(i=Ft(t)),e.push(s+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function An(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}gn.prototype.cancel=function(){var t,e;if(this.c=En(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),s=n.next();!s.done;s=n.next()){s.value.cancel()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},_n.prototype.stringify=function(t){return E.JSON.stringify(t,void 0)},_n.prototype.parse=function(t){return E.JSON.parse(t,void 0)};var Nn=E.JSON.parse;function kn(t){Mt.call(this),this.headers=new Be,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=xn,this.D=this.F=!1}C(kn,Mt);var xn="",Dn=/^https?$/i,Sn=["POST","PUT"];function On(t){return"content-type"==t.toLowerCase()}function Rn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),Pn(t)}function Cn(t){t.u||(t.u=!0,Ut(t,"complete"),Ut(t,"error"))}function Ln(t){if(t.b&&void 0!==I&&(!t.s[1]||4!=Mn(t)||2!=t.W()))if(t.l&&4==Mn(t))Zt(t.za,0,t);else if(Ut(t,"readystatechange"),4==Mn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if(!(e=s)){var i;if(i=0===n){var r=String(t.B).match($e)[1]||null;if(!r&&E.self&&E.self.location){var o=E.self.location.protocol;r=o.substr(0,o.length-1)}i=!Dn.test(r?r.toLowerCase():"")}e=i}if(e)Ut(t,"complete"),Ut(t,"success");else{t.h=6;try{var a=2<Mn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",Cn(t)}}finally{Pn(t)}}}function Pn(t,e){if(t.a){Vn(t);var n=t.a,s=t.s[0]?_:null;t.a=null,t.s=null,e||Ut(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function Vn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(E.clearTimeout(t.m),t.m=null)}function Mn(t){return t.a?t.a.readyState:0}function Un(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){var e="";return H(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Qe(t,e,n))}function qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Fn(t){this.pa=0,this.g=[],this.c=new re,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=qn("baseRetryDelayMs",5e3,t),this.Ra=qn("retryDelaySeedMs",1e4,t),this.Ma=qn("forwardChannelMaxRetries",2,t),this.ma=qn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new gn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new _n},this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Bn(t){if(zn(t),3==t.v){var e=t.R++,n=He(t.B);Qe(n,"SID",t.J),Qe(n,"RID",e),Qe(n,"TYPE","terminate"),Kn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Je(He(n)),n=!1,E.navigator&&E.navigator.sendBeacon&&(n=E.navigator.sendBeacon(e.i.toString(),"")),!n&&E.Image&&((new Image).src=e.i,n=!0),n||(e.a=rs(e.g,null),e.a.ba(e.i)),e.u=R(),Le(e)}ss(t)}function jn(t){t.a&&(Qn(t),t.a.cancel(),t.a=null)}function zn(t){jn(t),t.j&&(E.clearTimeout(t.j),t.j=null),Zn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&E.clearTimeout(t.h),t.h=null)}function $n(t,e){t.g.push(new pn(t.Oa++,e)),3==t.v&&Gn(t)}function Gn(t){yn(t.b)||t.h||(t.h=!0,Kt(t.Ba,t),t.u=0)}function Hn(t,e){var n;n=e?e.f:t.R++;var s=He(t.B);Qe(s,"SID",t.J),Qe(s,"RID",n),Qe(s,"AID",t.P),Kn(t,s),t.i&&t.l&&Un(s,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Wn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),bn(t.b,n),Se(n,s,e)}function Kn(t,e){t.f&&Fe({},function(t,n){Qe(e,n,t)})}function Wn(t,e,n){n=Math.min(t.g.length,n);var s=t.f?S(t.f.Ja,t.f,t):null;t:for(var i=t.g,r=-1;;){var o=["count="+n];-1==r?0<n?(r=i[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var a=!0,u=0;u<n;u++){var h=i[u].b,c=i[u].a;if(0>(h-=r))r=Math.max(0,i[u].b-100),a=!1;else try{Tn(c,o,"req"+h+"_")}catch(t){s&&s(c)}}if(a){s=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,s}function Yn(t){t.a||t.j||(t.T=1,Kt(t.Aa,t),t.o=0)}function Xn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ge(S(t.Aa,t),es(t,t.o)),t.o++,!0)}function Qn(t){null!=t.s&&(E.clearTimeout(t.s),t.s=null)}function Jn(t){t.a=new Ne(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=He(t.la);Qe(e,"RID","rpc"),Qe(e,"SID",t.J),Qe(e,"CI",t.H?"0":"1"),Qe(e,"AID",t.P),Kn(t,e),Qe(e,"TYPE","xmlhttp"),t.i&&t.l&&Un(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Je(He(e)),n.j=null,n.I=!0,Oe(n,t)}function Zn(t){null!=t.m&&(E.clearTimeout(t.m),t.m=null)}function ts(t,e){var n=null;if(t.a==e){Zn(t),Qn(t),t.a=null;var s=2}else{if(!vn(t.b,e))return;n=e.s,In(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==s){n=e.j?e.j.length:0,e=R()-e.u;var i=t.u;Ut(s=he(),new pe(s,n,e,i)),Gn(t)}else Yn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==s&&function(t,e){return!(wn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=ge(S(t.Ba,t,e),es(t,t.u)),t.u++,0)))}(t,e)||2==s&&Xn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ns(t,5);break;case 4:ns(t,10);break;case 3:ns(t,6);break;default:ns(t,2)}}function es(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function ns(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var s=S(t.Ya,t);n||(n=new Ge("//www.google.com/images/cleardot.gif"),E.location&&"http"==E.location.protocol||Ke(n,"https"),Je(n)),function(t,e){var n=new re;if(E.Image){var s=new Image;s.onload=O(An,n,s,"TestLoadImage: loaded",!0,e),s.onerror=O(An,n,s,"TestLoadImage: error",!1,e),s.onabort=O(An,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=O(An,n,s,"TestLoadImage: timeout",!1,e),E.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(n.toString(),s)}else de(2);t.v=0,t.f&&t.f.ra(e),ss(t),zn(t)}function ss(t){t.v=0,t.I=-1,t.f&&(0==En(t.b).length&&0==t.g.length||(t.b.c.length=0,U(t.g),t.g.length=0),t.f.qa())}function is(t,e,n){var s=function(t){return t instanceof Ge?He(t):new Ge(t,void 0)}(n);if(""!=s.c)e&&We(s,e+"."+s.c),Ye(s,s.h);else{var i=E.location;s=function(t,e,n,s){var i=new Ge(null,void 0);return t&&Ke(i,t),e&&We(i,e),n&&Ye(i,n),s&&(i.g=s),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&H(t.V,function(t,e){Qe(s,e,t)}),e=t.A,n=t.na,e&&n&&Qe(s,e,n),Qe(s,"VER",t.ha),Kn(t,s),s}function rs(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new kn(t.Na)).F=t.C,e}function os(){}function as(){if(tt&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function us(t,e){Mt.call(this),this.a=new Fn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!q(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new ls(this)}function hs(t){_e.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cs(){Te.call(this),this.status=1}function ls(t){this.a=t}(v=kn.prototype).ba=function(t,e,n,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ve(this.H):ve(Ie),this.a.onreadystatechange=S(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Rn(this,t)}t=n||"";var i=new Be(this.headers);s&&Fe(s,function(t,e){i.set(e,t)}),s=function(t){t:{for(var e=On,n=t.length,s="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=E.FormData&&t instanceof E.FormData,!(0<=P(Sn,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Vn(this),0<this.o&&((this.D=function(t){return tt&&lt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=S(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Rn(this,t)}},v.xa=function(){void 0!==I&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ut(this,"timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ut(this,"complete"),Ut(this,"abort"),Pn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Pn(this,!0)),kn.X.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?Ln(this):this.Ua())},v.Ua=function(){Ln(this)},v.W=function(){try{return 2<Mn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Nn(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Fn.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),s=this.l;if(this.O&&(s?Y(s=K(s),this.O):s=this.O),null===this.i&&(n.B=s),this.da)t:{for(var i=e=0;i<this.g.length;i++){var r=this.g[i];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Wn(this,n,e),Qe(i=He(this.B),"RID",t),Qe(i,"CVER",22),this.A&&Qe(i,"X-HTTP-Session-Id",this.A),Kn(this,i),this.i&&s&&Un(i,this.i,s),bn(this.b,n),this.Ia&&Qe(i,"TYPE","init"),this.da?(Qe(i,"$req",e),Qe(i,"SID","null"),n.U=!0,Se(n,i,null)):Se(n,i,e),this.v=2}}else 3==this.v&&(t?Hn(this,t):0==this.g.length||yn(this.b)||Hn(this))},v.Aa=function(){if(this.j=null,Jn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ge(S(this.Ta,this),t)}},v.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,de(10),jn(this),Jn(this))},v.Sa=function(){null!=this.m&&(this.m=null,jn(this),Xn(this),de(19))},v.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),de(2)):(this.c.info("Failed to ping google.com"),de(1))},(v=os.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ja=function(){},as.prototype.a=function(t,e){return new us(t,e)},C(us,Mt),us.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;de(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=is(t,null,t.fa),Gn(t)},us.prototype.close=function(){Bn(this.a)},us.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,$n(this.a,e)}else this.l?((e={}).__data__=Ft(t),$n(this.a,e)):$n(this.a,t)},us.prototype.G=function(){this.a.f=null,delete this.f,Bn(this.a),delete this.a,us.X.G.call(this)},C(hs,_e),C(cs,Te),C(ls,os),ls.prototype.ta=function(){Ut(this.a,"a")},ls.prototype.sa=function(t){Ut(this.a,new hs(t))},ls.prototype.ra=function(t){Ut(this.a,new cs(t))},ls.prototype.qa=function(){Ut(this.a,"b")},as.prototype.createWebChannel=as.prototype.a,us.prototype.send=us.prototype.h,us.prototype.open=us.prototype.g,us.prototype.close=us.prototype.close,me.NO_ERROR=0,me.TIMEOUT=8,me.HTTP_ERROR=6,ye.COMPLETE="complete",be.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Mt.prototype.listen=Mt.prototype.va,kn.prototype.listenOnce=kn.prototype.wa,kn.prototype.getLastError=kn.prototype.Qa,kn.prototype.getLastErrorCode=kn.prototype.ua,kn.prototype.getStatus=kn.prototype.W,kn.prototype.getResponseJson=kn.prototype.Pa,kn.prototype.getResponseText=kn.prototype.$,kn.prototype.send=kn.prototype.ba;var fs=function(){return new as},ds=function(){return he()},ps=me,gs=ye,ms=ae,ys={gb:0,jb:1,kb:2,Db:3,Ib:4,Fb:5,Gb:6,Eb:7,Cb:8,Hb:9,PROXY:10,NOPROXY:11,Ab:12,wb:13,xb:14,vb:15,yb:16,zb:17,bb:18,ab:19,cb:20},ws=be,vs=kn;class bs{constructor(t){this.uid=t}t(){return null!=this.uid}i(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}bs.UNAUTHENTICATED=new bs(null),bs.o=new bs("google-credentials-uid"),bs.u=new bs("first-party-uid");const Is=new m("@firebase/firestore");function Es(){return Is.logLevel}function _s(t,...e){if(Is.logLevel<=u.DEBUG){const n=e.map(Ns);Is.debug("Firestore (8.1.1): "+t,...n)}}function Ts(t,...e){if(Is.logLevel<=u.ERROR){const n=e.map(Ns);Is.error("Firestore (8.1.1): "+t,...n)}}function As(t,...e){if(Is.logLevel<=u.WARN){const n=e.map(Ns);Is.warn("Firestore (8.1.1): "+t,...n)}}function Ns(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function ks(t="Unexpected state"){const e="FIRESTORE (8.1.1) INTERNAL ASSERTION FAILED: "+t;throw Ts(e),new Error(e)}function xs(t,e){t||ks()}function Ds(t,e){return t}const Ss={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Os extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Rs{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization="Bearer "+t}}class Cs{constructor(){this.l=null}getToken(){return Promise.resolve(null)}_(){}T(t){this.l=t,t(bs.UNAUTHENTICATED)}I(){this.l=null}}class Ls{constructor(t){this.m=null,this.currentUser=bs.UNAUTHENTICATED,this.A=!1,this.R=0,this.l=null,this.forceRefresh=!1,this.m=(()=>{this.R++,this.currentUser=this.P(),this.A=!0,this.l&&this.l(this.currentUser)}),this.R=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.m):(this.m(null),t.get().then(t=>{this.auth=t,this.m&&this.auth.addAuthTokenListener(this.m)},()=>{}))}getToken(){const t=this.R,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.R!==t?(_s("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(xs("string"==typeof e.accessToken),new Rs(e.accessToken,this.currentUser)):null):Promise.resolve(null)}_(){this.forceRefresh=!0}T(t){this.l=t,this.A&&t(this.currentUser)}I(){this.auth&&this.auth.removeAuthTokenListener(this.m),this.m=null,this.l=null}P(){const t=this.auth&&this.auth.getUid();return xs(null===t||"string"==typeof t),new bs(t)}}class Ps{constructor(t,e){this.V=t,this.g=e,this.type="FirstParty",this.user=bs.u}get h(){const t={"X-Goog-AuthUser":this.g},e=this.V.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t}}class Vs{constructor(t,e){this.V=t,this.g=e}getToken(){return Promise.resolve(new Ps(this.V,this.g))}T(t){t(bs.u)}I(){}_(){}}function Ms(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Us{static p(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=Ms(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function qs(t,e){return t<e?-1:t>e?1:0}function Fs(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}function Bs(t){return t+"\0"}class js{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Os(Ss.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Os(Ss.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Os(Ss.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Os(Ss.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return js.fromMillis(Date.now())}static fromDate(t){return js.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new js(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}v(t){return this.seconds===t.seconds?qs(this.nanoseconds,t.nanoseconds):qs(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class zs{constructor(t){this.timestamp=t}static S(t){return new zs(t)}static min(){return new zs(new js(0,0))}D(t){return this.timestamp.v(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}C(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}N(){return this.timestamp}}class $s{constructor(t,e,n){void 0===e?e=0:e>t.length&&ks(),void 0===n?n=t.length-e:n>t.length-e&&ks(),this.segments=t,this.offset=e,this.M=n}get length(){return this.M}isEqual(t){return 0===$s.k(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof $s?t.forEach(t=>{e.push(t)}):e.push(t),this.O(e)}limit(){return this.offset+this.length}F(t){return t=void 0===t?1:t,this.O(this.segments,this.offset+t,this.length-t)}$(){return this.O(this.segments,this.offset,this.length-1)}L(){return this.segments[this.offset]}B(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}q(){return 0===this.length}U(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}K(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}W(){return this.segments.slice(this.offset,this.limit())}static k(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Gs extends $s{O(t,e,n){return new Gs(t,e,n)}j(){return this.W().join("/")}toString(){return this.j()}static G(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Os(Ss.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new Gs(e)}static H(){return new Gs([])}}const Hs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ks extends $s{O(t,e,n){return new Ks(t,e,n)}static J(t){return Hs.test(t)}j(){return this.W().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ks.J(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.j()}Y(){return 1===this.length&&"__name__"===this.get(0)}static X(){return new Ks(["__name__"])}static Z(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Os(Ss.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Os(Ss.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Os(Ss.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new Os(Ss.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Ks(e)}static H(){return new Ks([])}}class Ws{constructor(t){this.path=t}static tt(t){return new Ws(Gs.G(t))}static et(t){return new Ws(Gs.G(t).F(5))}nt(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Gs.k(this.path,t.path)}toString(){return this.path.toString()}static k(t,e){return Gs.k(t.path,e.path)}static st(t){return t.length%2==0}static it(t){return new Ws(new Gs(t.slice()))}}class Ys{constructor(t,e,n,s,i,r){this.rt=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=i,this.ot=r}}class Xs{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get ct(){return"(default)"===this.database}isEqual(t){return t instanceof Xs&&t.projectId===this.projectId&&t.database===this.database}}function Qs(t){return null==t}function Js(t){return 0===t&&1/t==-1/0}function Zs(t){return"number"==typeof t&&Number.isInteger(t)&&!Js(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class ti{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.ut=null}}function ei(t,e=null,n=[],s=[],i=null,r=null,o=null){return new ti(t,e,n,s,i,r,o)}function ni(t){const e=Ds(t);if(null===e.ut){let t=e.path.j();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.j()+t.op.toString()+Xi(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.j()+t.dir})(t)).join(","),Qs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Go(e.startAt)),e.endAt&&(t+="|ub:",t+=Go(e.endAt)),e.ut=t}return e.ut}function si(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Xo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!Hi(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ko(t.startAt,e.startAt)&&Ko(t.endAt,e.endAt)}function ii(t){return Ws.st(t.path)&&null===t.collectionGroup&&0===t.filters.length}class ri{constructor(t){this.at=t}static fromBase64String(t){const e=atob(t);return new ri(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ri(e)}toBase64(){return t=this.at,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.at)}ht(){return 2*this.at.length}D(t){return qs(this.at,t.at)}isEqual(t){return this.at===t.at}}ri.lt=new ri("");class oi{constructor(t,e,n,s,i=zs.min(),r=zs.min(),o=ri.lt){this.target=t,this.targetId=e,this._t=n,this.sequenceNumber=s,this.ft=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}dt(t){return new oi(this.target,this.targetId,this._t,t,this.ft,this.lastLimboFreeSnapshotVersion,this.resumeToken)}wt(t,e){return new oi(this.target,this.targetId,this._t,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}Et(t){return new oi(this.target,this.targetId,this._t,this.sequenceNumber,this.ft,t,this.resumeToken)}}class ai{constructor(t){this.count=t}}var ui,hi;function ci(t){switch(t){case Ss.OK:return ks();case Ss.CANCELLED:case Ss.UNKNOWN:case Ss.DEADLINE_EXCEEDED:case Ss.RESOURCE_EXHAUSTED:case Ss.INTERNAL:case Ss.UNAVAILABLE:case Ss.UNAUTHENTICATED:return!1;case Ss.INVALID_ARGUMENT:case Ss.NOT_FOUND:case Ss.ALREADY_EXISTS:case Ss.PERMISSION_DENIED:case Ss.FAILED_PRECONDITION:case Ss.ABORTED:case Ss.OUT_OF_RANGE:case Ss.UNIMPLEMENTED:case Ss.DATA_LOSS:return!0;default:return ks()}}function li(t){if(void 0===t)return Ts("GRPC error has no .code"),Ss.UNKNOWN;switch(t){case ui.OK:return Ss.OK;case ui.CANCELLED:return Ss.CANCELLED;case ui.UNKNOWN:return Ss.UNKNOWN;case ui.DEADLINE_EXCEEDED:return Ss.DEADLINE_EXCEEDED;case ui.RESOURCE_EXHAUSTED:return Ss.RESOURCE_EXHAUSTED;case ui.INTERNAL:return Ss.INTERNAL;case ui.UNAVAILABLE:return Ss.UNAVAILABLE;case ui.UNAUTHENTICATED:return Ss.UNAUTHENTICATED;case ui.INVALID_ARGUMENT:return Ss.INVALID_ARGUMENT;case ui.NOT_FOUND:return Ss.NOT_FOUND;case ui.ALREADY_EXISTS:return Ss.ALREADY_EXISTS;case ui.PERMISSION_DENIED:return Ss.PERMISSION_DENIED;case ui.FAILED_PRECONDITION:return Ss.FAILED_PRECONDITION;case ui.ABORTED:return Ss.ABORTED;case ui.OUT_OF_RANGE:return Ss.OUT_OF_RANGE;case ui.UNIMPLEMENTED:return Ss.UNIMPLEMENTED;case ui.DATA_LOSS:return Ss.DATA_LOSS;default:return ks()}}(hi=ui||(ui={}))[hi.OK=0]="OK",hi[hi.CANCELLED=1]="CANCELLED",hi[hi.UNKNOWN=2]="UNKNOWN",hi[hi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",hi[hi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",hi[hi.NOT_FOUND=5]="NOT_FOUND",hi[hi.ALREADY_EXISTS=6]="ALREADY_EXISTS",hi[hi.PERMISSION_DENIED=7]="PERMISSION_DENIED",hi[hi.UNAUTHENTICATED=16]="UNAUTHENTICATED",hi[hi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",hi[hi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",hi[hi.ABORTED=10]="ABORTED",hi[hi.OUT_OF_RANGE=11]="OUT_OF_RANGE",hi[hi.UNIMPLEMENTED=12]="UNIMPLEMENTED",hi[hi.INTERNAL=13]="INTERNAL",hi[hi.UNAVAILABLE=14]="UNAVAILABLE",hi[hi.DATA_LOSS=15]="DATA_LOSS";class fi{constructor(t,e){this.k=t,this.root=e||pi.EMPTY}Tt(t,e){return new fi(this.k,this.root.Tt(t,e,this.k).copy(null,null,pi.It,null,null))}remove(t){return new fi(this.k,this.root.remove(t,this.k).copy(null,null,pi.It,null,null))}get(t){let e=this.root;for(;!e.q();){const n=this.k(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.q();){const s=this.k(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}q(){return this.root.q()}get size(){return this.root.size}At(){return this.root.At()}Rt(){return this.root.Rt()}Pt(t){return this.root.Pt(t)}forEach(t){this.Pt((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.Pt((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}Vt(t){return this.root.Vt(t)}gt(){return new di(this.root,null,this.k,!1)}yt(t){return new di(this.root,t,this.k,!1)}bt(){return new di(this.root,null,this.k,!0)}vt(t){return new di(this.root,t,this.k,!0)}}class di{constructor(t,e,n,s){this.St=s,this.Dt=[];let i=1;for(;!t.q();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.St?t.left:t.right;else{if(0===i){this.Dt.push(t);break}this.Dt.push(t),t=this.St?t.right:t.left}}Ct(){let t=this.Dt.pop();const e={key:t.key,value:t.value};if(this.St)for(t=t.left;!t.q();)this.Dt.push(t),t=t.right;else for(t=t.right;!t.q();)this.Dt.push(t),t=t.left;return e}Nt(){return this.Dt.length>0}xt(){if(0===this.Dt.length)return null;const t=this.Dt[this.Dt.length-1];return{key:t.key,value:t.value}}}class pi{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:pi.RED,this.left=null!=s?s:pi.EMPTY,this.right=null!=i?i:pi.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new pi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}q(){return!1}Pt(t){return this.left.Pt(t)||t(this.key,this.value)||this.right.Pt(t)}Vt(t){return this.right.Vt(t)||t(this.key,this.value)||this.left.Vt(t)}min(){return this.left.q()?this:this.left.min()}At(){return this.min().key}Rt(){return this.right.q()?this.key:this.right.Rt()}Tt(t,e,n){let s=this;const i=n(t,s.key);return(s=i<0?s.copy(null,null,null,s.left.Tt(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.Tt(t,e,n))).Mt()}kt(){if(this.left.q())return pi.EMPTY;let t=this;return t.left.Ot()||t.left.left.Ot()||(t=t.Ft()),(t=t.copy(null,null,null,t.left.kt(),null)).Mt()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.q()||s.left.Ot()||s.left.left.Ot()||(s=s.Ft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.Ot()&&(s=s.$t()),s.right.q()||s.right.Ot()||s.right.left.Ot()||(s=s.Lt()),0===e(t,s.key)){if(s.right.q())return pi.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.kt())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.Mt()}Ot(){return this.color}Mt(){let t=this;return t.right.Ot()&&!t.left.Ot()&&(t=t.Bt()),t.left.Ot()&&t.left.left.Ot()&&(t=t.$t()),t.left.Ot()&&t.right.Ot()&&(t=t.qt()),t}Ft(){let t=this.qt();return t.right.left.Ot()&&(t=(t=(t=t.copy(null,null,null,null,t.right.$t())).Bt()).qt()),t}Lt(){let t=this.qt();return t.left.left.Ot()&&(t=(t=t.$t()).qt()),t}Bt(){const t=this.copy(null,null,pi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}$t(){const t=this.copy(null,null,pi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}qt(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Ut(){const t=this.Kt();return Math.pow(2,t)<=this.size+1}Kt(){if(this.Ot()&&this.left.Ot())throw ks();if(this.right.Ot())throw ks();const t=this.left.Kt();if(t!==this.right.Kt())throw ks();return t+(this.Ot()?0:1)}}pi.EMPTY=null,pi.RED=!0,pi.It=!1,pi.EMPTY=new class{constructor(){this.size=0}get key(){throw ks()}get value(){throw ks()}get color(){throw ks()}get left(){throw ks()}get right(){throw ks()}copy(t,e,n,s,i){return this}Tt(t,e,n){return new pi(t,e)}remove(t,e){return this}q(){return!0}Pt(t){return!1}Vt(t){return!1}At(){return null}Rt(){return null}Ot(){return!1}Ut(){return!0}Kt(){return 0}};class gi{constructor(t){this.k=t,this.data=new fi(this.k)}has(t){return null!==this.data.get(t)}first(){return this.data.At()}last(){return this.data.Rt()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.Pt((e,n)=>(t(e),!1))}Qt(t,e){const n=this.data.yt(t[0]);for(;n.Nt();){const s=n.Ct();if(this.k(s.key,t[1])>=0)return;e(s.key)}}Wt(t,e){let n;for(n=void 0!==e?this.data.yt(e):this.data.gt();n.Nt();)if(!t(n.Ct().key))return}jt(t){const e=this.data.yt(t);return e.Nt()?e.Ct().key:null}gt(){return new mi(this.data.gt())}yt(t){return new mi(this.data.yt(t))}add(t){return this.copy(this.data.remove(t).Tt(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}q(){return this.data.q()}Gt(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof gi))return!1;if(this.size!==t.size)return!1;const e=this.data.gt(),n=t.data.gt();for(;e.Nt();){const t=e.Ct().key,s=n.Ct().key;if(0!==this.k(t,s))return!1}return!0}W(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new gi(this.k);return e.data=t,e}}class mi{constructor(t){this.zt=t}Ct(){return this.zt.Ct().key}Nt(){return this.zt.Nt()}}const yi=new fi(Ws.k);function wi(){return yi}function vi(){return wi()}const bi=new fi(Ws.k);function Ii(){return bi}const Ei=new fi(Ws.k),_i=new gi(Ws.k);function Ti(...t){let e=_i;for(const n of t)e=e.add(n);return e}const Ai=new gi(qs);function Ni(){return Ai}class ki{constructor(t){this.k=t?(e,n)=>t(e,n)||Ws.k(e.key,n.key):(t,e)=>Ws.k(t.key,e.key),this.Ht=Ii(),this.Jt=new fi(this.k)}static Yt(t){return new ki(t.k)}has(t){return null!=this.Ht.get(t)}get(t){return this.Ht.get(t)}first(){return this.Jt.At()}last(){return this.Jt.Rt()}q(){return this.Jt.q()}indexOf(t){const e=this.Ht.get(t);return e?this.Jt.indexOf(e):-1}get size(){return this.Jt.size}forEach(t){this.Jt.Pt((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.Ht.Tt(t.key,t),e.Jt.Tt(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.Ht.remove(t),this.Jt.remove(e)):this}isEqual(t){if(!(t instanceof ki))return!1;if(this.size!==t.size)return!1;const e=this.Jt.gt(),n=t.Jt.gt();for(;e.Nt();){const t=e.Ct().key,s=n.Ct().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new ki;return n.k=this.k,n.Ht=t,n.Jt=e,n}}class xi{constructor(){this.Xt=new fi(Ws.k)}track(t){const e=t.doc.key,n=this.Xt.get(e);n?0!==t.type&&3===n.type?this.Xt=this.Xt.Tt(e,t):3===t.type&&1!==n.type?this.Xt=this.Xt.Tt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Xt=this.Xt.Tt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Xt=this.Xt.Tt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Xt=this.Xt.remove(e):1===t.type&&2===n.type?this.Xt=this.Xt.Tt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Xt=this.Xt.Tt(e,{type:2,doc:t.doc}):ks():this.Xt=this.Xt.Tt(e,t)}Zt(){const t=[];return this.Xt.Pt((e,n)=>{t.push(n)}),t}}class Di{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.te=n,this.docChanges=s,this.ee=i,this.fromCache=r,this.ne=o,this.se=a}static ie(t,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Di(t,e,ki.Yt(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.ee.q()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.ne===t.ne&&this.ee.isEqual(t.ee)&&So(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.te.isEqual(t.te)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Si{constructor(t,e,n,s,i){this.ft=t,this.re=e,this.oe=n,this.ce=s,this.ue=i}static ae(t,e){const n=new Map;return n.set(t,Oi.he(t,e)),new Si(zs.min(),n,Ni(),wi(),Ti())}}class Oi{constructor(t,e,n,s,i){this.resumeToken=t,this.le=e,this._e=n,this.fe=s,this.de=i}static he(t,e){return new Oi(ri.lt,e,Ti(),Ti(),Ti())}}class Ri{constructor(t,e,n,s){this.we=t,this.removedTargetIds=e,this.key=n,this.Ee=s}}class Ci{constructor(t,e){this.targetId=t,this.Te=e}}class Li{constructor(t,e,n=ri.lt,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Pi{constructor(){this.Ie=0,this.me=Ui(),this.Ae=ri.lt,this.Re=!1,this.Pe=!0}get le(){return this.Re}get resumeToken(){return this.Ae}get Ve(){return 0!==this.Ie}get ge(){return this.Pe}ye(t){t.ht()>0&&(this.Pe=!0,this.Ae=t)}pe(){let t=Ti(),e=Ti(),n=Ti();return this.me.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:ks()}}),new Oi(this.Ae,this.Re,t,e,n)}be(){this.Pe=!1,this.me=Ui()}ve(t,e){this.Pe=!0,this.me=this.me.Tt(t,e)}Se(t){this.Pe=!0,this.me=this.me.remove(t)}De(){this.Ie+=1}Ce(){this.Ie-=1}Ne(){this.Pe=!0,this.Re=!0}}class Vi{constructor(t){this.xe=t,this.Me=new Map,this.ke=wi(),this.Oe=Mi(),this.Fe=new gi(qs)}$e(t){for(const e of t.we)t.Ee instanceof mo?this.Le(e,t.Ee):t.Ee instanceof yo&&this.Be(e,t.key,t.Ee);for(const e of t.removedTargetIds)this.Be(e,t.key,t.Ee)}qe(t){this.Ue(t,e=>{const n=this.Ke(e);switch(t.state){case 0:this.Qe(e)&&n.ye(t.resumeToken);break;case 1:n.Ce(),n.Ve||n.be(),n.ye(t.resumeToken);break;case 2:n.Ce(),n.Ve||this.removeTarget(e);break;case 3:this.Qe(e)&&(n.Ne(),n.ye(t.resumeToken));break;case 4:this.Qe(e)&&(this.We(e),n.ye(t.resumeToken));break;default:ks()}})}Ue(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Me.forEach((t,n)=>{this.Qe(n)&&e(n)})}je(t){const e=t.targetId,n=t.Te.count,s=this.Ge(e);if(s){const t=s.target;if(ii(t))if(0===n){const n=new Ws(t.path);this.Be(e,n,new yo(n,zs.min()))}else xs(1===n);else this.ze(e)!==n&&(this.We(e),this.Fe=this.Fe.add(e))}}He(t){const e=new Map;this.Me.forEach((n,s)=>{const i=this.Ge(s);if(i){if(n.le&&ii(i.target)){const e=new Ws(i.target.path);null!==this.ke.get(e)||this.Je(s,e)||this.Be(s,e,new yo(e,t))}n.ge&&(e.set(s,n.pe()),n.be())}});let n=Ti();this.Oe.forEach((t,e)=>{let s=!0;e.Wt(t=>{const e=this.Ge(t);return!e||2===e._t||(s=!1,!1)}),s&&(n=n.add(t))});const s=new Si(t,e,this.Fe,this.ke,n);return this.ke=wi(),this.Oe=Mi(),this.Fe=new gi(qs),s}Le(t,e){if(!this.Qe(t))return;const n=this.Je(t,e.key)?2:0;this.Ke(t).ve(e.key,n),this.ke=this.ke.Tt(e.key,e),this.Oe=this.Oe.Tt(e.key,this.Ye(e.key).add(t))}Be(t,e,n){if(!this.Qe(t))return;const s=this.Ke(t);this.Je(t,e)?s.ve(e,1):s.Se(e),this.Oe=this.Oe.Tt(e,this.Ye(e).delete(t)),n&&(this.ke=this.ke.Tt(e,n))}removeTarget(t){this.Me.delete(t)}ze(t){const e=this.Ke(t).pe();return this.xe.Xe(t).size+e._e.size-e.de.size}De(t){this.Ke(t).De()}Ke(t){let e=this.Me.get(t);return e||(e=new Pi,this.Me.set(t,e)),e}Ye(t){let e=this.Oe.get(t);return e||(e=new gi(qs),this.Oe=this.Oe.Tt(t,e)),e}Qe(t){const e=null!==this.Ge(t);return e||_s("WatchChangeAggregator","Detected inactive target",t),e}Ge(t){const e=this.Me.get(t);return e&&e.Ve?null:this.xe.Ze(t)}We(t){this.Me.set(t,new Pi),this.xe.Xe(t).forEach(e=>{this.Be(t,e,null)})}Je(t,e){return this.xe.Xe(t).has(e)}}function Mi(){return new fi(Ws.k)}function Ui(){return new fi(Ws.k)}function qi(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Fi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Bi(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ji(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function zi(t){const e=Qi(t.mapValue.fields.__local_write_time__.timestampValue);return new js(e.seconds,e.nanos)}const $i=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ji(t)?4:10:ks()}function Hi(t,e){const n=Gi(t);if(n!==Gi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return zi(t).isEqual(zi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Qi(t.timestampValue),s=Qi(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Zi(t.bytesValue).isEqual(Zi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ji(t.geoPointValue.latitude)===Ji(e.geoPointValue.latitude)&&Ji(t.geoPointValue.longitude)===Ji(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ji(t.integerValue)===Ji(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ji(t.doubleValue),s=Ji(e.doubleValue);return n===s?Js(n)===Js(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Fs(t.arrayValue.values||[],e.arrayValue.values||[],Hi);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(qi(n)!==qi(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Hi(n[t],s[t])))return!1;return!0}(t,e);default:return ks()}}function Ki(t,e){return void 0!==(t.values||[]).find(t=>Hi(t,e))}function Wi(t,e){const n=Gi(t),s=Gi(e);if(n!==s)return qs(n,s);switch(n){case 0:return 0;case 1:return qs(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ji(t.integerValue||t.doubleValue),s=Ji(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Yi(t.timestampValue,e.timestampValue);case 4:return Yi(zi(t),zi(e));case 5:return qs(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Zi(t),s=Zi(e);return n.D(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=qs(n[t],s[t]);if(0!==e)return e}return qs(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=qs(Ji(t.latitude),Ji(e.latitude));return 0!==n?n:qs(Ji(t.longitude),Ji(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Wi(n[t],s[t]);if(e)return e}return qs(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=qs(s[t],r[t]);if(0!==e)return e;const o=Wi(n[s[t]],i[r[t]]);if(0!==o)return o}return qs(s.length,r.length)}(t.mapValue,e.mapValue);default:throw ks()}}function Yi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return qs(t,e);const n=Qi(t),s=Qi(e),i=qs(n.seconds,s.seconds);return 0!==i?i:qs(n.nanos,s.nanos)}function Xi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=Qi(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Zi(e.bytesValue).toBase64():"referenceValue"in e?(s=e.referenceValue,Ws.et(s).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=t(i);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const r of n)i?i=!1:s+=",",s+=`${r}:${t(e.fields[r])}`;return s+"}"}(e.mapValue):ks();var n,s}(t)}function Qi(t){if(xs(!!t),"string"==typeof t){let e=0;const n=$i.exec(t);if(xs(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ji(t.seconds),nanos:Ji(t.nanos)}}function Ji(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Zi(t){return"string"==typeof t?ri.fromBase64String(t):ri.fromUint8Array(t)}function tr(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.j()}`}}function er(t){return!!t&&"integerValue"in t}function nr(t){return!!t&&"arrayValue"in t}function sr(t){return!!t&&"nullValue"in t}function ir(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function rr(t){return!!t&&"mapValue"in t}const or={asc:"ASCENDING",desc:"DESCENDING"},ar={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ur{constructor(t,e){this.rt=t,this.tn=e}}function hr(t){return{integerValue:""+t}}function cr(t,e){if(t.tn){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Js(e)?"-0":e}}function lr(t,e){return Zs(e)?hr(e):cr(t,e)}function fr(t,e){return t.tn?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function dr(t,e){return t.tn?e.toBase64():e.toUint8Array()}function pr(t){return xs(!!t),zs.S(function(t){const e=Qi(t);return new js(e.seconds,e.nanos)}(t))}function gr(t,e){return function(t){return new Gs(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).j()}function mr(t){const e=Gs.G(t);return xs(Cr(e)),e}function yr(t,e){return gr(t.rt,e.path)}function wr(t,e){const n=mr(e);if(n.get(1)!==t.rt.projectId)throw new Os(Ss.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.rt.projectId);if(n.get(3)!==t.rt.database)throw new Os(Ss.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.rt.database);return new Ws(Er(n))}function vr(t,e){return gr(t.rt,e)}function br(t){const e=mr(t);return 4===e.length?Gs.H():Er(e)}function Ir(t){return new Gs(["projects",t.rt.projectId,"databases",t.rt.database]).j()}function Er(t){return xs(t.length>4&&"documents"===t.get(4)),t.F(5)}function _r(t,e,n){return{name:yr(t,e),fields:n.proto.mapValue.fields}}function Tr(t,e){let n;if(e instanceof so)n={update:_r(t,e.key,e.value)};else if(e instanceof ho)n={delete:yr(t,e.key)};else if(e instanceof io)n={update:_r(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.j())),{fieldPaths:e}}(e.en)};else if(e instanceof oo)n={transform:{document:yr(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Ur)return{fieldPath:e.field.j(),setToServerValue:"REQUEST_TIME"};if(n instanceof qr)return{fieldPath:e.field.j(),appendMissingElements:{values:n.elements}};if(n instanceof Br)return{fieldPath:e.field.j(),removeAllFromArray:{values:n.elements}};if(n instanceof zr)return{fieldPath:e.field.j(),increment:n.nn};throw ks()})(0,t))}};else{if(!(e instanceof co))return ks();n={verify:yr(t,e.key)}}return e.rn.sn||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return fr(t,e.N())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:ks()}(t,e.rn)),n}function Ar(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Yr.updateTime(pr(t.updateTime)):void 0!==t.exists?Yr.exists(t.exists):Yr.on()}(e.currentDocument):Yr.on();if(e.update){e.update.name;const s=wr(t,e.update.name),i=new lo({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Hr(e.map(t=>Ks.Z(t)))}(e.updateMask);return new io(s,i,t,n)}return new so(s,i,n)}if(e.delete){const s=wr(t,e.delete);return new ho(s,n)}if(e.transform){const s=wr(t,e.transform.document),i=e.transform.fieldTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)xs("REQUEST_TIME"===e.setToServerValue),n=new Ur;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new qr(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Br(t)}else"increment"in e?n=new zr(t,e.increment):ks();const s=Ks.Z(e.fieldPath);return new Kr(s,n)})(t,e));return xs(!0===n.exists),new oo(s,i)}if(e.verify){const s=wr(t,e.verify);return new co(s,n)}return ks()}function Nr(t,e){return{documents:[vr(t,e.path)]}}function kr(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=vr(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=vr(t,s.$()),n.structuredQuery.from=[{collectionId:s.B()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(ir(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NAN"}};if(sr(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ir(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NOT_NAN"}};if(sr(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Or(t.field),op:function(t){return ar[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:Or(t.field),direction:function(t){return or[t]}(t.dir)}})(t))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.tn||Qs(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Dr(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Dr(e.endAt)),n}function xr(t){let e=br(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){xs(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Rr(t.unaryFilter.field);return Po.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Rr(t.unaryFilter.field);return Po.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Rr(t.unaryFilter.field);return Po.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Rr(t.unaryFilter.field);return Po.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return ks()}}(e)]:void 0!==e.fieldFilter?[function(t){return Po.create(Rr(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return ks()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):ks():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new Wo(Rr(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return Qs(e="object"==typeof t?t.value:t)?null:e}(n.limit));let u=null;n.startAt&&(u=Sr(n.startAt));let h=null;return n.endAt&&(h=Sr(n.endAt)),bo(e,i,o,r,a,"F",u,h)}function Dr(t){return{before:t.before,values:t.position}}function Sr(t){const e=!!t.before,n=t.values||[];return new $o(n,e)}function Or(t){return{fieldPath:t.j()}}function Rr(t){return Ks.Z(t.fieldPath)}function Cr(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Lr{constructor(){this.cn=void 0}}function Pr(t,e,n){return t instanceof Ur?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof qr?Fr(t,e):t instanceof Br?jr(t,e):function(t,e){const n=Mr(t,e),s=$r(n)+$r(t.nn);return er(n)&&er(t.nn)?hr(s):cr(t.serializer,s)}(t,e)}function Vr(t,e,n){return t instanceof qr?Fr(t,e):t instanceof Br?jr(t,e):n}function Mr(t,e){return t instanceof zr?er(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Ur extends Lr{}class qr extends Lr{constructor(t){super(),this.elements=t}}function Fr(t,e){const n=Gr(e);for(const e of t.elements)n.some(t=>Hi(t,e))||n.push(e);return{arrayValue:{values:n}}}class Br extends Lr{constructor(t){super(),this.elements=t}}function jr(t,e){let n=Gr(e);for(const e of t.elements)n=n.filter(t=>!Hi(t,e));return{arrayValue:{values:n}}}class zr extends Lr{constructor(t,e){super(),this.serializer=t,this.nn=e}}function $r(t){return Ji(t.integerValue||t.doubleValue)}function Gr(t){return nr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Hr{constructor(t){this.fields=t,t.sort(Ks.k)}un(t){for(const e of this.fields)if(e.U(t))return!0;return!1}isEqual(t){return Fs(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class Kr{constructor(t,e){this.field=t,this.transform=e}}class Wr{constructor(t,e){this.version=t,this.transformResults=e}}class Yr{constructor(t,e){this.updateTime=t,this.exists=e}static on(){return new Yr}static exists(t){return new Yr(void 0,t)}static updateTime(t){return new Yr(t)}get sn(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Xr(t,e){return void 0!==t.updateTime?e instanceof mo&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof mo}class Qr{}function Jr(t,e,n){return t instanceof so?function(t,e,n){return new mo(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof io?function(t,e,n){if(!Xr(t.rn,e))return new wo(t.key,n.version);const s=ro(t,e);return new mo(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):t instanceof oo?function(t,e,n){if(xs(null!=n.transformResults),!Xr(t.rn,e))return new wo(t.key,n.version);const s=ao(t,e),i=function(t,e,n){const s=[];xs(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform;let a=null;e instanceof mo&&(a=e.field(r.field)),s.push(Vr(o,a,n[i]))}return s}(t.fieldTransforms,e,n.transformResults),r=n.version,o=uo(t,s.data(),i);return new mo(t.key,r,o,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new yo(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Zr(t,e,n,s){return t instanceof so?function(t,e){if(!Xr(t.rn,e))return e;const n=no(e);return new mo(t.key,n,t.value,{an:!0})}(t,e):t instanceof io?function(t,e){if(!Xr(t.rn,e))return e;const n=no(e),s=ro(t,e);return new mo(t.key,n,s,{an:!0})}(t,e):t instanceof oo?function(t,e,n,s){if(!Xr(t.rn,e))return e;const i=ao(t,e),r=function(t,e,n,s){const i=[];for(const r of t){const t=r.transform;let o=null;n instanceof mo&&(o=n.field(r.field)),null===o&&s instanceof mo&&(o=s.field(r.field)),i.push(Pr(t,o,e))}return i}(t.fieldTransforms,n,e,s),o=uo(t,i.data(),r);return new mo(t.key,i.version,o,{an:!0})}(t,e,s,n):function(t,e){return Xr(t.rn,e)?new yo(t.key,zs.min()):e}(t,e)}function to(t,e){return t instanceof oo?function(t,e){let n=null;for(const s of t.fieldTransforms){const t=e instanceof mo?e.field(s.field):void 0,i=Mr(s.transform,t||null);null!=i&&(n=null==n?(new fo).set(s.field,i):n.set(s.field,i))}return n?n.hn():null}(t,e):null}function eo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.rn.isEqual(e.rn)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.en.isEqual(e.en):2!==t.type||Fs(t.fieldTransforms,t.fieldTransforms,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof qr&&e instanceof qr||t instanceof Br&&e instanceof Br?Fs(t.elements,e.elements,Hi):t instanceof zr&&e instanceof zr?Hi(t.nn,e.nn):t instanceof Ur&&e instanceof Ur}(t.transform,e.transform)})(t,e)))}function no(t){return t instanceof mo?t.version:zs.min()}class so extends Qr{constructor(t,e,n){super(),this.key=t,this.value=e,this.rn=n,this.type=0}}class io extends Qr{constructor(t,e,n,s){super(),this.key=t,this.data=e,this.en=n,this.rn=s,this.type=1}}function ro(t,e){let n;return function(t,e){const n=new fo(e);return t.en.fields.forEach(e=>{if(!e.q()){const s=t.data.field(e);null!==s?n.set(e,s):n.delete(e)}}),n.hn()}(t,n=e instanceof mo?e.data():lo.empty())}class oo extends Qr{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.rn=Yr.exists(!0)}}function ao(t,e){return e}function uo(t,e,n){const s=new fo(e);for(let e=0;e<t.fieldTransforms.length;e++){const i=t.fieldTransforms[e];s.set(i.field,n[e])}return s.hn()}class ho extends Qr{constructor(t,e){super(),this.key=t,this.rn=e,this.type=3}}class co extends Qr{constructor(t,e){super(),this.key=t,this.rn=e,this.type=4}}class lo{constructor(t){this.proto=t}static empty(){return new lo({mapValue:{}})}field(t){if(t.q())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!rr(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.B()])||null}}isEqual(t){return Hi(this.proto,t.proto)}}class fo{constructor(t=lo.empty()){this.ln=t,this._n=new Map}set(t,e){return this.fn(t,e),this}delete(t){return this.fn(t,null),this}fn(t,e){let n=this._n;for(let e=0;e<t.length-1;++e){const s=t.get(e);let i=n.get(s);i instanceof Map?n=i:i&&10===Gi(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(s,i),n=i):(i=new Map,n.set(s,i),n=i)}n.set(t.B(),e)}hn(){const t=this.dn(Ks.H(),this._n);return null!=t?new lo(t):this.ln}dn(t,e){let n=!1;const s=this.ln.field(t),i=rr(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const r=this.dn(t.child(s),e);null!=r&&(i[s]=r,n=!0)}else null!==e?(i[s]=e,n=!0):i.hasOwnProperty(s)&&(delete i[s],n=!0)}),n?{mapValue:{fields:i}}:null}}function po(t){const e=[];return Fi(t.fields||{},(t,n)=>{const s=new Ks([t]);if(rr(n)){const t=po(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)}),new Hr(e)}class go{constructor(t,e){this.key=t,this.version=e}}class mo extends go{constructor(t,e,n,s){super(t,e),this.wn=n,this.an=!!s.an,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.wn.field(t)}data(){return this.wn}En(){return this.wn.proto}isEqual(t){return t instanceof mo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.an===t.an&&this.hasCommittedMutations===t.hasCommittedMutations&&this.wn.isEqual(t.wn)}toString(){return`Document(${this.key}, ${this.version}, ${this.wn.toString()}, {hasLocalMutations: ${this.an}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.an||this.hasCommittedMutations}}class yo extends go{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof yo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class wo extends go{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof wo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class vo{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.Tn=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.In=null,this.mn=null,this.startAt,this.endAt}}function bo(t,e,n,s,i,r,o,a){return new vo(t,e,n,s,i,r,o,a)}function Io(t){return new vo(t)}function Eo(t){return!Qs(t.limit)&&"F"===t.limitType}function _o(t){return!Qs(t.limit)&&"L"===t.limitType}function To(t){return t.Tn.length>0?t.Tn[0].field:null}function Ao(t){for(const e of t.filters)if(e.An())return e.field;return null}function No(t){return null!==t.collectionGroup}function ko(t){const e=Ds(t);if(null===e.In){e.In=[];const t=Ao(e),n=To(e);if(null!==t&&null===n)t.Y()||e.In.push(new Wo(t)),e.In.push(new Wo(Ks.X(),"asc"));else{let t=!1;for(const n of e.Tn)e.In.push(n),n.field.Y()&&(t=!0);if(!t){const t=e.Tn.length>0?e.Tn[e.Tn.length-1].dir:"asc";e.In.push(new Wo(Ks.X(),t))}}}return e.In}function xo(t){const e=Ds(t);if(!e.mn)if("F"===e.limitType)e.mn=ei(e.path,e.collectionGroup,ko(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of ko(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Wo(n.field,e))}const n=e.endAt?new $o(e.endAt.position,!e.endAt.before):null,s=e.startAt?new $o(e.startAt.position,!e.startAt.before):null;e.mn=ei(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.mn}function Do(t,e,n){return new vo(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function So(t,e){return si(xo(t),xo(e))&&t.limitType===e.limitType}function Oo(t){return`${ni(xo(t))}|lt:${t.limitType}`}function Ro(t){return`Query(target=${function(t){let e=t.path.j();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.j()} ${e.op} ${Xi(e.value)}`;var e}).join(", ")}]`),Qs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.j()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Go(t.startAt)),t.endAt&&(e+=", endAt: "+Go(t.endAt)),`Target(${e})`}(xo(t))}; limitType=${t.limitType})`}function Co(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.nt(t.collectionGroup)&&t.path.U(n):Ws.st(t.path)?t.path.isEqual(n):t.path.K(n)}(t,e)&&function(t,e){for(const n of t.Tn)if(!n.field.Y()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ho(t.startAt,ko(t),e))&&(!t.endAt||!Ho(t.endAt,ko(t),e))}(t,e)}function Lo(t){return(e,n)=>{let s=!1;for(const i of ko(t)){const t=Yo(i,e,n);if(0!==t)return t;s=s||i.field.Y()}return 0}}class Po extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.Y()?"in"===e||"not-in"===e?this.Rn(t,e,n):new Vo(t,e,n):"array-contains"===e?new Fo(t,n):"in"===e?new Bo(t,n):"not-in"===e?new jo(t,n):"array-contains-any"===e?new zo(t,n):new Po(t,e,n)}static Rn(t,e,n){return"in"===e?new Mo(t,n):new Uo(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.Pn(Wi(e,this.value)):null!==e&&Gi(this.value)===Gi(e)&&this.Pn(Wi(e,this.value))}Pn(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ks()}}An(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Vo extends Po{constructor(t,e,n){super(t,e,n),this.key=Ws.et(n.referenceValue)}matches(t){const e=Ws.k(t.key,this.key);return this.Pn(e)}}class Mo extends Po{constructor(t,e){super(t,"in",e),this.keys=qo("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Uo extends Po{constructor(t,e){super(t,"not-in",e),this.keys=qo("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function qo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>Ws.et(t.referenceValue))}class Fo extends Po{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return nr(e)&&Ki(e.arrayValue,this.value)}}class Bo extends Po{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&Ki(this.value.arrayValue,e)}}class jo extends Po{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ki(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.field(this.field);return null!==e&&!Ki(this.value.arrayValue,e)}}class zo extends Po{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!nr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Ki(this.value.arrayValue,t))}}class $o{constructor(t,e){this.position=t,this.before=e}}function Go(t){return`${t.before?"b":"a"}:${t.position.map(t=>Xi(t)).join(",")}`}function Ho(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.Y()?Ws.k(Ws.et(o.referenceValue),n.key):Wi(o,n.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Ko(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Hi(t.position[n],e.position[n]))return!1;return!0}class Wo{constructor(t,e="asc"){this.field=t,this.dir=e}}function Yo(t,e,n){const s=t.field.Y()?Ws.k(e.key,n.key):function(t,e,n){const s=e.field(t),i=n.field(t);return null!==s&&null!==i?Wi(s,i):ks()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return ks()}}function Xo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Qo{constructor(t,e,n,s){this.batchId=t,this.Vn=e,this.baseMutations=n,this.mutations=s}gn(t,e,n){const s=n.yn;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(t)&&(e=Jr(i,e,s[n]))}return e}pn(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Zr(n,e,e,this.Vn));const n=e;for(const s of this.mutations)s.key.isEqual(t)&&(e=Zr(s,e,n,this.Vn));return e}bn(t){let e=t;return this.mutations.forEach(n=>{const s=this.pn(n.key,t.get(n.key));s&&(e=e.Tt(n.key,s))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),Ti())}isEqual(t){return this.batchId===t.batchId&&Fs(this.mutations,t.mutations,(t,e)=>eo(t,e))&&Fs(this.baseMutations,t.baseMutations,(t,e)=>eo(t,e))}}class Jo{constructor(t,e,n,s){this.batch=t,this.vn=e,this.yn=n,this.Sn=s}static from(t,e,n){xs(t.mutations.length===n.length);let s=Ei;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.Tt(i[t].key,n[t].version);return new Jo(t,e,n,s)}}class Zo{constructor(t,e){this.Dn=t,this.Cn=e,this.Nn={}}get(t){const e=this.Dn(t),n=this.Nn[e];if(void 0!==n)for(const[e,s]of n)if(this.Cn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.Dn(t),s=this.Nn[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.Cn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.Nn[n]=[[t,e]]}delete(t){const e=this.Dn(t),n=this.Nn[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.Cn(n[s][0],t))return 1===n.length?delete this.Nn[e]:n.splice(s,1),!0;return!1}forEach(t){Fi(this.Nn,(e,n)=>{for(const[e,s]of n)t(e,s)})}q(){return Bi(this.Nn)}}class ta{constructor(t){this.xn=null,this.Mn=null,this.result=void 0,this.error=void 0,this.kn=!1,this.On=!1,t(t=>{this.kn=!0,this.result=t,this.xn&&this.xn(t)},t=>{this.kn=!0,this.error=t,this.Mn&&this.Mn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.On&&ks(),this.On=!0,this.kn?this.error?this.Fn(e,this.error):this.$n(t,this.result):new ta((n,s)=>{this.xn=(e=>{this.$n(t,e).next(n,s)}),this.Mn=(t=>{this.Fn(e,t).next(n,s)})})}Ln(){return new Promise((t,e)=>{this.next(t,e)})}Bn(t){try{const e=t();return e instanceof ta?e:ta.resolve(e)}catch(t){return ta.reject(t)}}$n(t,e){return t?this.Bn(()=>t(e)):ta.resolve(e)}Fn(t,e){return t?this.Bn(()=>t(e)):ta.reject(e)}static resolve(t){return new ta((e,n)=>{e(t)})}static reject(t){return new ta((e,n)=>{n(t)})}static qn(t){return new ta((e,n)=>{let s=0,i=0,r=!1;t.forEach(t=>{++s,t.next(()=>{++i,r&&i===s&&e()},t=>n(t))}),r=!0,i===s&&e()})}static Un(t){let e=ta.resolve(!1);for(const n of t)e=e.next(t=>t?ta.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.qn(n)}}class ea{constructor(){this.Kn=new Zo(t=>t.toString(),(t,e)=>t.isEqual(e)),this.Qn=!1}Wn(t){const e=this.Kn.get(t);return e?e.readTime:zs.min()}jn(t,e){this.Gn(),this.Kn.set(t.key,{zn:t,readTime:e})}Hn(t,e=null){this.Gn(),this.Kn.set(t,{zn:null,readTime:e})}Jn(t,e){this.Gn();const n=this.Kn.get(e);return void 0!==n?ta.resolve(n.zn):this.Yn(t,e)}getEntries(t,e){return this.Xn(t,e)}apply(t){return this.Gn(),this.Qn=!0,this.Zn(t)}Gn(){}}class na{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}function sa(t){return new ur(t,!0)}function ia(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}const ra="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oa{constructor(){this.ts=[]}es(t){this.ts.push(t)}ns(){this.ts.forEach(t=>t())}}class aa{constructor(t,e,n){this.ss=t,this.rs=e,this.os=n}cs(t,e){return this.rs.us(t,e).next(n=>this.hs(t,e,n))}hs(t,e,n){return this.ss.Jn(t,e).next(t=>{for(const s of n)t=s.pn(e,t);return t})}ls(t,e,n){let s=vi();return e.forEach((t,e)=>{for(const s of n)e=s.pn(t,e);s=s.Tt(t,e)}),s}_s(t,e){return this.ss.getEntries(t,e).next(e=>this.fs(t,e))}fs(t,e){return this.rs.ds(t,e).next(n=>{const s=this.ls(t,e,n);let i=wi();return s.forEach((t,e)=>{e||(e=new yo(t,zs.min())),i=i.Tt(t,e)}),i})}ws(t,e,n){return function(t){return Ws.st(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Es(t,e.path):No(e)?this.Ts(t,e,n):this.Is(t,e,n)}Es(t,e){return this.cs(t,new Ws(e)).next(t=>{let e=Ii();return t instanceof mo&&(e=e.Tt(t.key,t)),e})}Ts(t,e,n){const s=e.collectionGroup;let i=Ii();return this.os.As(t,s).next(r=>ta.forEach(r,r=>{const o=function(t,e){return new vo(e,null,t.Tn.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.Is(t,o,n).next(t=>{t.forEach((t,e)=>{i=i.Tt(t,e)})})}).next(()=>i))}Is(t,e,n){let s,i;return this.ss.ws(t,e,n).next(n=>(s=n,this.rs.Rs(t,e))).next(e=>(i=e,this.Ps(t,i,s).next(t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key,i=s.get(n),r=Zr(e,i,i,t.Vn);s=r instanceof mo?s.Tt(n,r):s.remove(n)}}))).next(()=>(s.forEach((t,n)=>{Co(e,n)||(s=s.remove(t))}),s))}Ps(t,e,n){let s=Ti();for(const t of e)for(const e of t.mutations)e instanceof io&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.ss.getEntries(t,s).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof mo&&(i=i.Tt(t,e))}),i))}}class ua{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Vs=n,this.gs=s}static ys(t,e){let n=Ti(),s=Ti();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new ua(t,e.fromCache,n,s)}}class ha{constructor(t,e){this.previousValue=t,e&&(e.ps=(t=>this.bs(t)),this.vs=(t=>e.Ss(t)))}bs(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.vs&&this.vs(t),t}}ha.Ds=-1;class ca{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Cs=t,this.Ns=e,this.xs=n,this.Ms=s,this.ks=i,this.Os=0,this.Fs=null,this.$s=Date.now(),this.reset()}reset(){this.Os=0}Ls(){this.Os=this.ks}Bs(t){this.cancel();const e=Math.floor(this.Os+this.qs()),n=Math.max(0,Date.now()-this.$s),s=Math.max(0,e-n);s>0&&_s("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Os} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Fs=this.Cs.Us(this.Ns,s,()=>(this.$s=Date.now(),t())),this.Os*=this.Ms,this.Os<this.xs&&(this.Os=this.xs),this.Os>this.ks&&(this.Os=this.ks)}Ks(){null!==this.Fs&&(this.Fs.Qs(),this.Fs=null)}cancel(){null!==this.Fs&&(this.Fs.cancel(),this.Fs=null)}qs(){return(Math.random()-.5)*this.Os}}class la{constructor(t,e,n){this.name=t,this.version=e,this.Ws=n,12.2===la.js(s())&&Ts("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return _s("SimpleDb","Removing database:",t),ya(window.indexedDB.deleteDatabase(t)).Ln()}static Gs(){if("undefined"==typeof indexedDB)return!1;if(la.zs())return!0;const t=s(),e=la.js(t),n=0<e&&e<10,i=la.Hs(t),r=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static zs(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Js)}static Ys(t,e){return t.store(e)}static js(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Hs(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Xs(t){return this.db||(_s("SimpleDb","Opening database:",this.name),this.db=await new Promise((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=(t=>{const n=t.target.result;e(n)}),s.onblocked=(()=>{n(new da(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),s.onerror=(e=>{const s=e.target.error;"VersionError"===s.name?n(new Os(Ss.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new da(t,s))}),s.onupgradeneeded=(t=>{_s("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.Ws.createOrUpgrade(e,s.transaction,t.oldVersion,this.version).next(()=>{_s("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.Zs&&(this.db.onversionchange=(t=>this.Zs(t))),this.db}ti(t){this.Zs=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n,s){const i="readonly"===e;for(;;){0;try{this.db=await this.Xs(t);const e=ga.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).catch(t=>(e.abort(t),ta.reject(t))).Ln();return r.catch(()=>{}),await e.ei,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(_s("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class fa{constructor(t){this.ni=t,this.si=!1,this.ii=null}get kn(){return this.si}get ri(){return this.ii}set cursor(t){this.ni=t}done(){this.si=!0}oi(t){this.ii=t}delete(){return ya(this.ni.delete())}}class da extends Os{constructor(t,e){super(Ss.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function pa(t){return"IndexedDbTransactionError"===t.name}class ga{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.ci=new na,this.transaction.oncomplete=(()=>{this.ci.resolve()}),this.transaction.onabort=(()=>{e.error?this.ci.reject(new da(t,e.error)):this.ci.resolve()}),this.transaction.onerror=(e=>{const n=va(e.target.error);this.ci.reject(new da(t,n))})}static open(t,e,n,s){try{return new ga(e,t.transaction(s,n))}catch(t){throw new da(e,t)}}get ei(){return this.ci.promise}abort(t){t&&this.ci.reject(t),this.aborted||(_s("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new ma(e)}}class ma{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(_s("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(_s("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ya(n)}add(t){return _s("SimpleDb","ADD",this.store.name,t,t),ya(this.store.add(t))}get(t){return ya(this.store.get(t)).next(e=>(void 0===e&&(e=null),_s("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return _s("SimpleDb","DELETE",this.store.name,t),ya(this.store.delete(t))}count(){return _s("SimpleDb","COUNT",this.store.name),ya(this.store.count())}ui(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.ai(n,(t,e)=>{s.push(e)}).next(()=>s)}hi(t,e){_s("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.li=!1;const s=this.cursor(n);return this.ai(s,(t,e,n)=>n.delete())}_i(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.ai(s,e)}fi(t){const e=this.cursor({});return new ta((n,s)=>{e.onerror=(t=>{const e=va(t.target.error);s(e)}),e.onsuccess=(e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()})})}ai(t,e){const n=[];return new ta((s,i)=>{t.onerror=(t=>{i(t.target.error)}),t.onsuccess=(t=>{const i=t.target.result;if(!i)return void s();const r=new fa(i),o=e(i.primaryKey,i.value,r);if(o instanceof ta){const t=o.catch(t=>(r.done(),ta.reject(t)));n.push(t)}r.kn?s():null===r.ri?i.continue():i.continue(r.ri)})}).next(()=>ta.qn(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.li?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ya(t){return new ta((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=va(t.target.error);n(e)})})}let wa=!1;function va(t){const e=la.js(s());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Os("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wa||(wa=!0,setTimeout(()=>{throw t},0)),t}}return t}function ba(){return"undefined"!=typeof window?window:null}function Ia(){return"undefined"!=typeof document?document:null}class Ea{constructor(t,e,n,s,i){this.di=t,this.Ns=e,this.wi=n,this.op=s,this.Ei=i,this.Ti=new na,this.then=this.Ti.promise.then.bind(this.Ti.promise),this.Ti.promise.catch(t=>{})}static Ii(t,e,n,s,i){const r=Date.now()+n,o=new Ea(t,e,r,s,i);return o.start(n),o}start(t){this.mi=setTimeout(()=>this.Ai(),t)}Qs(){return this.Ai()}cancel(t){null!==this.mi&&(this.clearTimeout(),this.Ti.reject(new Os(Ss.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}Ai(){this.di.Ri(()=>null!==this.mi?(this.clearTimeout(),this.op().then(t=>this.Ti.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.mi&&(this.Ei(this),clearTimeout(this.mi),this.mi=null)}}class _a{constructor(){this.Pi=Promise.resolve(),this.Vi=[],this.gi=!1,this.yi=[],this.pi=null,this.bi=!1,this.vi=[],this.Si=new ca(this,"async_queue_retry"),this.Di=(()=>{const t=Ia();t&&_s("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Si.Ks()});const t=Ia();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Di)}get Ci(){return this.gi}Ri(t){this.enqueue(t)}Ni(t){this.xi(),this.Mi(t)}ki(){if(!this.gi){this.gi=!0;const t=Ia();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Di)}}enqueue(t){return this.xi(),this.gi?new Promise(t=>{}):this.Mi(t)}Oi(t){this.Ri(()=>(this.Vi.push(t),this.Fi()))}async Fi(){if(0!==this.Vi.length){try{await this.Vi[0](),this.Vi.shift(),this.Si.reset()}catch(t){if(!pa(t))throw t;_s("AsyncQueue","Operation failed with retryable error: "+t)}this.Vi.length>0&&this.Si.Bs(()=>this.Fi())}}Mi(t){const e=this.Pi.then(()=>(this.bi=!0,t().catch(t=>{throw this.pi=t,this.bi=!1,Ts("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.bi=!1,t))));return this.Pi=e,e}Us(t,e,n){this.xi(),this.vi.indexOf(t)>-1&&(e=0);const s=Ea.Ii(this,t,e,n,t=>this.$i(t));return this.yi.push(s),s}xi(){this.pi&&ks()}Li(){}async Bi(){let t;do{t=this.Pi,await t}while(t!==this.Pi)}qi(t){for(const e of this.yi)if(e.Ns===t)return!0;return!1}Ui(t){return this.Bi().then(()=>{this.yi.sort((t,e)=>t.wi-e.wi);for(const e of this.yi)if(e.Qs(),"all"!==t&&e.Ns===t)break;return this.Bi()})}Ki(t){this.vi.push(t)}$i(t){const e=this.yi.indexOf(t);this.yi.splice(e,1)}}function Ta(t,e){if(Ts("AsyncQueue",`${e}: ${t}`),pa(t))return new Os(Ss.UNAVAILABLE,`${e}: ${t}`);throw t}function Aa([t,e],[n,s]){const i=qs(t,n);return 0===i?qs(e,s):i}class Na{constructor(t){this.Qi=t,this.buffer=new gi(Aa),this.Wi=0}ji(){return++this.Wi}Gi(t){const e=[t,this.ji()];if(this.buffer.size<this.Qi)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Aa(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}const ka={zi:!1,Hi:0,Ji:0,Yi:0};class xa{constructor(t,e,n){this.Xi=t,this.Zi=e,this.tr=n}static er(t){return new xa(t,xa.nr,xa.sr)}}xa.nr=10,xa.sr=1e3,xa.ir=new xa(41943040,xa.nr,xa.sr),xa.rr=new xa(-1,0,0);class Da{constructor(t,e){this.cr=t,this.di=e,this.ur=!1,this.ar=null}start(t){-1!==this.cr.params.Xi&&this.hr(t)}stop(){this.ar&&(this.ar.cancel(),this.ar=null)}get lr(){return null!==this.ar}hr(t){const e=this.ur?3e5:6e4;_s("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ar=this.di.Us("lru_garbage_collection",e,async()=>{this.ar=null,this.ur=!0;try{await t._r(this.cr)}catch(t){pa(t)?_s("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await th(t)}await this.hr(t)})}}class Sa{constructor(t,e){this.dr=t,this.params=e}wr(t,e){return this.dr.Er(t).next(t=>Math.floor(e/100*t))}Tr(t,e){if(0===e)return ta.resolve(ha.Ds);const n=new Na(e);return this.dr.Ue(t,t=>n.Gi(t.sequenceNumber)).next(()=>this.dr.Ir(t,t=>n.Gi(t))).next(()=>n.maxValue)}mr(t,e,n){return this.dr.mr(t,e,n)}Ar(t,e){return this.dr.Ar(t,e)}Rr(t,e){return-1===this.params.Xi?(_s("LruGarbageCollector","Garbage collection skipped; disabled"),ta.resolve(ka)):this.Pr(t).next(n=>n<this.params.Xi?(_s("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Xi),ka):this.Vr(t,e))}Pr(t){return this.dr.Pr(t)}Vr(t,e){let n,s,i,r,o,a,h;const c=Date.now();return this.wr(t,this.params.Zi).next(e=>(e>this.params.tr?(_s("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.tr} from `+e),s=this.params.tr):s=e,r=Date.now(),this.Tr(t,s))).next(s=>(n=s,o=Date.now(),this.mr(t,n,e))).next(e=>(i=e,a=Date.now(),this.Ar(t,n))).next(t=>(h=Date.now(),Es()<=u.DEBUG&&_s("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-c}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(h-a)+"ms\n"+`Total Duration: ${h-c}ms`),ta.resolve({zi:!0,Hi:s,Ji:i,Yi:t})))}}class Oa{gr(t){this.yr=t}ws(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.Tn.length||1===t.Tn.length&&t.Tn[0].field.Y())}(e)||n.isEqual(zs.min())?this.pr(t,e):this.yr._s(t,s).next(i=>{const r=this.br(e,i);return(Eo(e)||_o(e))&&this.vr(e.limitType,r,s,n)?this.pr(t,e):(Es()<=u.DEBUG&&_s("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ro(e)),this.yr.ws(t,e,n).next(t=>(r.forEach(e=>{t=t.Tt(e.key,e)}),t)))})}br(t,e){let n=new gi(Lo(t));return e.forEach((e,s)=>{s instanceof mo&&Co(t,s)&&(n=n.add(s))}),n}vr(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.D(s)>0)}pr(t,e){return Es()<=u.DEBUG&&_s("QueryEngine","Using full collection scan to execute query:",Ro(e)),this.yr.ws(t,e,zs.min())}}function Ra(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=La(e)),e=Ca(t.get(n),e);return La(e)}function Ca(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function La(t){return t+""}function Pa(t){const e=t.length;if(xs(e>=2),2===e)return xs(""===t.charAt(0)&&""===t.charAt(1)),Gs.H();const n=e-2,s=[];let i="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>r)&&ks(),t.charAt(e+1)){case"":const r=t.substring(n,e);let o;0===i.length?o=r:(o=i+=r,i=""),s.push(o);break;case"":i+=t.substring(n,e),i+="\0";break;case"":i+=t.substring(n,e+1);break;default:ks()}n=e+2}return new Gs(s)}class Va{constructor(t){this.Sr=t}}function Ma(t,e){if(e.document)return function(t,e,n){const s=wr(t,e.name),i=pr(e.updateTime),r=new lo({mapValue:{fields:e.fields}});return new mo(s,i,r,{hasCommittedMutations:!!n})}(t.Sr,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=Ws.it(e.noDocument.path),n=ja(e.noDocument.readTime);return new yo(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=Ws.it(e.unknownDocument.path),n=ja(e.unknownDocument.version);return new wo(t,n)}return ks()}function Ua(t,e,n){const s=qa(n),i=e.key.path.$().W();if(e instanceof mo){const n=function(t,e){return{name:yr(t,e.key),fields:e.En().mapValue.fields,updateTime:fr(t,e.version.N())}}(t.Sr,e),r=e.hasCommittedMutations;return new gu(null,null,n,r,s,i)}if(e instanceof yo){const t=e.key.path.W(),n=Ba(e.version),r=e.hasCommittedMutations;return new gu(null,new du(t,n),null,r,s,i)}if(e instanceof wo){const t=e.key.path.W(),n=Ba(e.version);return new gu(new pu(t,n),null,null,!0,s,i)}return ks()}function qa(t){const e=t.N();return[e.seconds,e.nanoseconds]}function Fa(t){const e=new js(t[0],t[1]);return zs.S(e)}function Ba(t){const e=t.N();return new uu(e.seconds,e.nanoseconds)}function ja(t){const e=new js(t.seconds,t.nanoseconds);return zs.S(e)}function za(t,e){const n=(e.baseMutations||[]).map(e=>Ar(t.Sr,e)),s=e.mutations.map(e=>Ar(t.Sr,e)),i=js.fromMillis(e.localWriteTimeMs);return new Qo(e.batchId,i,n,s)}function $a(t){const e=ja(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ja(t.lastLimboFreeSnapshotVersion):zs.min();let s;var i;return void 0!==t.query.documents?(xs(1===(i=t.query).documents.length),s=xo(Io(br(i.documents[0])))):s=function(t){return xo(xr(t))}(t.query),new oi(s,t.targetId,0,t.lastListenSequenceNumber,e,n,ri.fromBase64String(t.resumeToken))}function Ga(t,e){const n=Ba(e.ft),s=Ba(e.lastLimboFreeSnapshotVersion);let i;i=ii(e.target)?Nr(t.Sr,e.target):kr(t.Sr,e.target);const r=e.resumeToken.toBase64();return new yu(e.targetId,ni(e.target),n,r,e.sequenceNumber,s,i)}function Ha(t){const e=xr({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Do(e,e.limit,"L"):e}class Ka{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.os=n,this.Dr=s,this.Cr={}}static Nr(t,e,n,s){xs(""!==t.uid);const i=t.t()?t.uid:"";return new Ka(i,e,n,s)}Mr(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xa(t)._i({index:lu.userMutationsIndex,range:n},(t,n,s)=>{e=!1,s.done()}).next(()=>e)}kr(t,e,n,s){const i=Qa(t),r=Xa(t);return r.add({}).next(o=>{xs("number"==typeof o);const a=new Qo(o,e,n,s),u=function(t,e,n){const s=n.baseMutations.map(e=>Tr(t.Sr,e)),i=n.mutations.map(e=>Tr(t.Sr,e));return new lu(e,n.batchId,n.Vn.toMillis(),s,i)}(this.serializer,this.userId,a),h=[];let c=new gi((t,e)=>qs(t.j(),e.j()));for(const t of s){const e=fu.key(this.userId,t.key.path,o);c=c.add(t.key.path.$()),h.push(r.put(u)),h.push(i.put(e,fu.PLACEHOLDER))}return c.forEach(e=>{h.push(this.os.Or(t,e))}),t.es(()=>{this.Cr[o]=a.keys()}),ta.qn(h).next(()=>a)})}Fr(t,e){return Xa(t).get(e).next(t=>t?(xs(t.userId===this.userId),za(this.serializer,t)):null)}$r(t,e){return this.Cr[e]?ta.resolve(this.Cr[e]):this.Fr(t,e).next(t=>{if(t){const n=t.keys();return this.Cr[e]=n,n}return null})}Lr(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Xa(t)._i({index:lu.userMutationsIndex,range:s},(t,e,s)=>{e.userId===this.userId&&(xs(e.batchId>=n),i=za(this.serializer,e)),s.done()}).next(()=>i)}Br(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Xa(t)._i({index:lu.userMutationsIndex,range:e,reverse:!0},(t,e,s)=>{n=e.batchId,s.done()}).next(()=>n)}qr(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xa(t).ui(lu.userMutationsIndex,e).next(t=>t.map(t=>za(this.serializer,t)))}us(t,e){const n=fu.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Qa(t)._i({range:s},(n,s,r)=>{const[o,a,u]=n,h=Pa(a);if(o===this.userId&&e.path.isEqual(h))return Xa(t).get(u).next(t=>{if(!t)throw ks();xs(t.userId===this.userId),i.push(za(this.serializer,t))});r.done()}).next(()=>i)}ds(t,e){let n=new gi(qs);const s=[];return e.forEach(e=>{const i=fu.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=Qa(t)._i({range:r},(t,s,i)=>{const[r,o,a]=t,u=Pa(o);r===this.userId&&e.path.isEqual(u)?n=n.add(a):i.done()});s.push(o)}),ta.qn(s).next(()=>this.Ur(t,n))}Rs(t,e){const n=e.path,s=n.length+1,i=fu.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new gi(qs);return Qa(t)._i({range:r},(t,e,i)=>{const[r,a,u]=t,h=Pa(a);r===this.userId&&n.U(h)?h.length===s&&(o=o.add(u)):i.done()}).next(()=>this.Ur(t,o))}Ur(t,e){const n=[],s=[];return e.forEach(e=>{s.push(Xa(t).get(e).next(t=>{if(null===t)throw ks();xs(t.userId===this.userId),n.push(za(this.serializer,t))}))}),ta.qn(s).next(()=>n)}Kr(t,e){return Ya(t.Qr,this.userId,e).next(n=>(t.es(()=>{this.Wr(e.batchId)}),ta.forEach(n,e=>this.Dr.jr(t,e))))}Wr(t){delete this.Cr[t]}Gr(t){return this.Mr(t).next(e=>{if(!e)return ta.resolve();const n=IDBKeyRange.lowerBound(fu.prefixForUser(this.userId)),s=[];return Qa(t)._i({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=Pa(t[1]);s.push(e)}else n.done()}).next(()=>{xs(0===s.length)})})}zr(t,e){return Wa(t,this.userId,e)}Hr(t){return Ja(t).get(this.userId).next(t=>t||new cu(this.userId,-1,""))}}function Wa(t,e,n){const s=fu.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return Qa(t)._i({range:r,li:!0},(t,n,s)=>{const[r,a,u]=t;r===e&&a===i&&(o=!0),s.done()}).next(()=>o)}function Ya(t,e,n){const s=t.store(lu.store),i=t.store(fu.store),r=[],o=IDBKeyRange.only(n.batchId);let a=0;const u=s._i({range:o},(t,e,n)=>(a++,n.delete()));r.push(u.next(()=>{xs(1===a)}));const h=[];for(const t of n.mutations){const s=fu.key(e,t.key.path,n.batchId);r.push(i.delete(s)),h.push(t.key)}return ta.qn(r).next(()=>h)}function Xa(t){return Uu.Ys(t,lu.store)}function Qa(t){return Uu.Ys(t,fu.store)}function Ja(t){return Uu.Ys(t,cu.store)}class Za{constructor(t,e){this.serializer=t,this.os=e}jn(t,e,n){return nu(t).put(su(e),n)}Hn(t,e){const n=nu(t),s=su(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Jr(t,n)))}Jn(t,e){return nu(t).get(su(e)).next(t=>this.Yr(t))}Xr(t,e){return nu(t).get(su(e)).next(t=>{const e=this.Yr(t);return e?{zn:e,size:iu(t)}:null})}getEntries(t,e){let n=vi();return this.Zr(t,e,(t,e)=>{const s=this.Yr(e);n=n.Tt(t,s)}).next(()=>n)}eo(t,e){let n=vi(),s=new fi(Ws.k);return this.Zr(t,e,(t,e)=>{const i=this.Yr(e);i?(n=n.Tt(t,i),s=s.Tt(t,iu(e))):(n=n.Tt(t,null),s=s.Tt(t,0))}).next(()=>({no:n,so:s}))}Zr(t,e,n){if(e.q())return ta.resolve();const s=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),i=e.gt();let r=i.Ct();return nu(t)._i({range:s},(t,e,s)=>{const o=Ws.it(t);for(;r&&Ws.k(r,o)<0;)n(r,null),r=i.Ct();r&&r.isEqual(o)&&(n(r,e),r=i.Nt()?i.Ct():null),r?s.oi(r.path.W()):s.done()}).next(()=>{for(;r;)n(r,null),r=i.Nt()?i.Ct():null})}ws(t,e,n){let s=Ii();const i=e.path.length+1,r={};if(n.isEqual(zs.min())){const t=e.path.W();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.W(),s=qa(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=gu.collectionReadTimeIndex}return nu(t)._i(r,(t,n,r)=>{if(t.length!==i)return;const o=Ma(this.serializer,n);e.path.U(o.key.path)?o instanceof mo&&Co(e,o)&&(s=s.Tt(o.key,o)):r.done()}).next(()=>s)}io(t){return new tu(this,!!t&&t.ro)}oo(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return eu(t).get(mu.key).next(t=>(xs(!!t),t))}Jr(t,e){return eu(t).put(mu.key,e)}Yr(t){if(t){const e=Ma(this.serializer,t);return e instanceof yo&&e.version.isEqual(zs.min())?null:e}return null}}class tu extends ea{constructor(t,e){super(),this.co=t,this.ro=e,this.uo=new Zo(t=>t.toString(),(t,e)=>t.isEqual(e))}Zn(t){const e=[];let n=0,s=new gi((t,e)=>qs(t.j(),e.j()));return this.Kn.forEach((i,r)=>{const o=this.uo.get(i);if(r.zn){const a=Ua(this.co.serializer,r.zn,this.Wn(i));s=s.add(i.path.$());const u=iu(a);n+=u-o,e.push(this.co.jn(t,i,a))}else if(n-=o,this.ro){const n=Ua(this.co.serializer,new yo(i,zs.min()),this.Wn(i));e.push(this.co.jn(t,i,n))}else e.push(this.co.Hn(t,i))}),s.forEach(n=>{e.push(this.co.os.Or(t,n))}),e.push(this.co.updateMetadata(t,n)),ta.qn(e)}Yn(t,e){return this.co.Xr(t,e).next(t=>null===t?(this.uo.set(e,0),null):(this.uo.set(e,t.size),t.zn))}Xn(t,e){return this.co.eo(t,e).next(({no:t,so:e})=>(e.forEach((t,e)=>{this.uo.set(t,e)}),t))}}function eu(t){return Uu.Ys(t,mu.store)}function nu(t){return Uu.Ys(t,gu.store)}function su(t){return t.path.W()}function iu(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ks();e=t.noDocument}return JSON.stringify(e).length}class ru{constructor(){this.ao=new ou}Or(t,e){return this.ao.add(e),ta.resolve()}As(t,e){return ta.resolve(this.ao.getEntries(e))}}class ou{constructor(){this.index={}}add(t){const e=t.B(),n=t.$(),s=this.index[e]||new gi(Gs.k),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.B(),n=t.$(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new gi(Gs.k)).W()}}class au{constructor(t){this.serializer=t}createOrUpgrade(t,e,n,s){xs(n<s&&n>=0&&s<=11);const i=new ga("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore(hu.store)}(t),function(t){t.createObjectStore(cu.store,{keyPath:cu.keyPath}),t.createObjectStore(lu.store,{keyPath:lu.keyPath,autoIncrement:!0}).createIndex(lu.userMutationsIndex,lu.userMutationsKeyPath,{unique:!0}),t.createObjectStore(fu.store)}(t),Iu(t),function(t){t.createObjectStore(gu.store)}(t));let r=ta.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(wu.store),t.deleteObjectStore(yu.store),t.deleteObjectStore(vu.store)}(t),Iu(t)),r=r.next(()=>(function(t){const e=i.store(vu.store),n=new vu(0,0,zs.min().N(),0);return e.put(vu.key,n)})())),n<4&&s>=4&&(0!==n&&(r=r.next(()=>(function(t,e){return e.store(lu.store).ui().next(n=>{t.deleteObjectStore(lu.store),t.createObjectStore(lu.store,{keyPath:lu.keyPath,autoIncrement:!0}).createIndex(lu.userMutationsIndex,lu.userMutationsKeyPath,{unique:!0});const s=e.store(lu.store),i=n.map(t=>s.put(t));return ta.qn(i)})})(t,i))),r=r.next(()=>{!function(t){t.createObjectStore(Eu.store,{keyPath:Eu.keyPath})}(t)})),n<5&&s>=5&&(r=r.next(()=>this.removeAcknowledgedMutations(i))),n<6&&s>=6&&(r=r.next(()=>((function(t){t.createObjectStore(mu.store)})(t),this.addDocumentGlobal(i)))),n<7&&s>=7&&(r=r.next(()=>this.ensureSequenceNumbers(i))),n<8&&s>=8&&(r=r.next(()=>this.createCollectionParentIndex(t,i))),n<9&&s>=9&&(r=r.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(gu.store);e.createIndex(gu.readTimeIndex,gu.readTimeIndexPath,{unique:!1}),e.createIndex(gu.collectionReadTimeIndex,gu.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&s>=10&&(r=r.next(()=>this.rewriteCanonicalIds(i))),n<11&&s>=11&&(r=r.next(()=>{!function(t){t.createObjectStore(_u.store,{keyPath:_u.keyPath})}(t),function(t){t.createObjectStore(Tu.store,{keyPath:Tu.keyPath})}(t)})),r}addDocumentGlobal(t){let e=0;return t.store(gu.store)._i((t,n)=>{e+=iu(n)}).next(()=>{const n=new mu(e);return t.store(mu.store).put(mu.key,n)})}removeAcknowledgedMutations(t){const e=t.store(cu.store),n=t.store(lu.store);return e.ui().next(e=>ta.forEach(e,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.ui(lu.userMutationsIndex,s).next(n=>ta.forEach(n,n=>{xs(n.userId===e.userId);const s=za(this.serializer,n);return Ya(t,e.userId,s).next(()=>{})}))}))}ensureSequenceNumbers(t){const e=t.store(wu.store),n=t.store(gu.store);return t.store(vu.store).get(vu.key).next(t=>{const s=[];return n._i((n,i)=>{const r=new Gs(n),o=function(t){return[0,Ra(r)]}();s.push(e.get(o).next(n=>n?ta.resolve():(n=>e.put(new wu(0,Ra(n),t.highestListenSequenceNumber)))(r)))}).next(()=>ta.qn(s))})}createCollectionParentIndex(t,e){t.createObjectStore(bu.store,{keyPath:bu.keyPath});const n=e.store(bu.store),s=new ou,i=t=>{if(s.add(t)){const e=t.B(),s=t.$();return n.put({collectionId:e,parent:Ra(s)})}};return e.store(gu.store)._i({li:!0},(t,e)=>{const n=new Gs(t);return i(n.$())}).next(()=>e.store(fu.store)._i({li:!0},([t,e,n],s)=>{const r=Pa(e);return i(r.$())}))}rewriteCanonicalIds(t){const e=t.store(yu.store);return e._i((t,n)=>{const s=$a(n),i=Ga(this.serializer,s);return e.put(i)})}}class uu{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class hu{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}hu.store="owner",hu.key="owner";class cu{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}cu.store="mutationQueues",cu.keyPath="userId";class lu{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}lu.store="mutations",lu.keyPath="batchId",lu.userMutationsIndex="userMutationsIndex",lu.userMutationsKeyPath=["userId","batchId"];class fu{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,Ra(e)]}static key(t,e,n){return[t,Ra(e),n]}}fu.store="documentMutations",fu.PLACEHOLDER=new fu;class du{constructor(t,e){this.path=t,this.readTime=e}}class pu{constructor(t,e){this.path=t,this.version=e}}class gu{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}gu.store="remoteDocuments",gu.readTimeIndex="readTimeIndex",gu.readTimeIndexPath="readTime",gu.collectionReadTimeIndex="collectionReadTimeIndex",gu.collectionReadTimeIndexPath=["parentPath","readTime"];class mu{constructor(t){this.byteSize=t}}mu.store="remoteDocumentGlobal",mu.key="remoteDocumentGlobalKey";class yu{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}yu.store="targets",yu.keyPath="targetId",yu.queryTargetsIndexName="queryTargetsIndex",yu.queryTargetsKeyPath=["canonicalId","targetId"];class wu{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}wu.store="targetDocuments",wu.keyPath=["targetId","path"],wu.documentTargetsIndex="documentTargetsIndex",wu.documentTargetsKeyPath=["path","targetId"];class vu{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}vu.key="targetGlobalKey",vu.store="targetGlobal";class bu{constructor(t,e){this.collectionId=t,this.parent=e}}function Iu(t){t.createObjectStore(wu.store,{keyPath:wu.keyPath}).createIndex(wu.documentTargetsIndex,wu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(yu.store,{keyPath:yu.keyPath}).createIndex(yu.queryTargetsIndexName,yu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(vu.store)}bu.store="collectionParents",bu.keyPath=["collectionId","parent"];class Eu{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}Eu.store="clientMetadata",Eu.keyPath="clientId";class _u{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}_u.store="bundles",_u.keyPath="bundleId";class Tu{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Tu.store="namedQueries",Tu.keyPath="name";const Au=[...[...[...[...[cu.store,lu.store,fu.store,gu.store,yu.store,hu.store,vu.store,wu.store],Eu.store],mu.store],bu.store],_u.store,Tu.store];class Nu{constructor(t){this.serializer=t}ho(t,e){return ku(t).get(e).next(t=>{if(t)return{id:(e=t).bundleId,createTime:ja(e.createTime),version:e.version};var e})}lo(t,e){return ku(t).put({bundleId:(n=e).id,createTime:Ba(pr(n.createTime)),version:n.version});var n}_o(t,e){return xu(t).get(e).next(t=>{if(t)return{name:(e=t).name,query:Ha(e.bundledQuery),readTime:ja(e.readTime)};var e})}fo(t,e){return xu(t).put(function(t){return{name:t.name,readTime:Ba(pr(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function ku(t){return Uu.Ys(t,_u.store)}function xu(t){return Uu.Ys(t,Tu.store)}class Du{constructor(){this.wo=new ou}Or(t,e){if(!this.wo.has(e)){const n=e.B(),s=e.$();t.es(()=>{this.wo.add(e)});const i={collectionId:n,parent:Ra(s)};return Su(t).put(i)}return ta.resolve()}As(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Bs(e),""],!1,!0);return Su(t).ui(s).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(Pa(s.parent))}return n})}}function Su(t){return Uu.Ys(t,bu.store)}class Ou{constructor(t){this.Eo=t}next(){return this.Eo+=2,this.Eo}static To(){return new Ou(0)}static Io(){return new Ou(-1)}}class Ru{constructor(t,e){this.Dr=t,this.serializer=e}mo(t){return this.Ao(t).next(e=>{const n=new Ou(e.highestTargetId);return e.highestTargetId=n.next(),this.Ro(t,e).next(()=>e.highestTargetId)})}Po(t){return this.Ao(t).next(t=>zs.S(new js(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}Vo(t){return this.Ao(t).next(t=>t.highestListenSequenceNumber)}yo(t,e,n){return this.Ao(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.N()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Ro(t,s)))}po(t,e){return this.bo(t,e).next(()=>this.Ao(t).next(n=>(n.targetCount+=1,this.vo(e,n),this.Ro(t,n))))}So(t,e){return this.bo(t,e)}Do(t,e){return this.Co(t,e.targetId).next(()=>Cu(t).delete(e.targetId)).next(()=>this.Ao(t)).next(e=>(xs(e.targetCount>0),e.targetCount-=1,this.Ro(t,e)))}mr(t,e,n){let s=0;const i=[];return Cu(t)._i((r,o)=>{const a=$a(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,i.push(this.Do(t,a)))}).next(()=>ta.qn(i)).next(()=>s)}Ue(t,e){return Cu(t)._i((t,n)=>{const s=$a(n);e(s)})}Ao(t){return Lu(t).get(vu.key).next(t=>(xs(null!==t),t))}Ro(t,e){return Lu(t).put(vu.key,e)}bo(t,e){return Cu(t).put(Ga(this.serializer,e))}vo(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}No(t){return this.Ao(t).next(t=>t.targetCount)}xo(t,e){const n=ni(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Cu(t)._i({range:s,index:yu.queryTargetsIndexName},(t,n,s)=>{const r=$a(n);si(e,r.target)&&(i=r,s.done())}).next(()=>i)}Mo(t,e,n){const s=[],i=Pu(t);return e.forEach(e=>{const r=Ra(e.path);s.push(i.put(new wu(n,r))),s.push(this.Dr.ko(t,n,e))}),ta.qn(s)}Oo(t,e,n){const s=Pu(t);return ta.forEach(e,e=>{const i=Ra(e.path);return ta.qn([s.delete([n,i]),this.Dr.Fo(t,n,e)])})}Co(t,e){const n=Pu(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}$o(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=Pu(t);let i=Ti();return s._i({range:n,li:!0},(t,e,n)=>{const s=Pa(t[1]),r=new Ws(s);i=i.add(r)}).next(()=>i)}zr(t,e){const n=Ra(e.path),s=IDBKeyRange.bound([n],[Bs(n)],!1,!0);let i=0;return Pu(t)._i({index:wu.documentTargetsIndex,li:!0,range:s},([t,e],n,s)=>{0!==t&&(i++,s.done())}).next(()=>i>0)}Ze(t,e){return Cu(t).get(e).next(t=>t?$a(t):null)}}function Cu(t){return Uu.Ys(t,yu.store)}function Lu(t){return Uu.Ys(t,vu.store)}function Pu(t){return Uu.Ys(t,wu.store)}const Vu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Mu extends oa{constructor(t,e){super(),this.Qr=t,this.Lo=e}}class Uu{constructor(t,e,n,s,i,r,o,a,u,h){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Cs=i,this.window=r,this.document=o,this.Bo=u,this.qo=h,this.Uo=null,this.Ko=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Qo=null,this.inForeground=!1,this.Wo=null,this.jo=null,this.Go=Number.NEGATIVE_INFINITY,this.zo=(t=>Promise.resolve()),!Uu.Gs())throw new Os(Ss.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Dr=new Bu(this,s),this.Ho=e+"main",this.serializer=new Va(a),this.Jo=new la(this.Ho,11,new au(this.serializer)),this.Yo=new Ru(this.Dr,this.serializer),this.os=new Du,this.ss=function(t,e){return new Za(t,e)}(this.serializer,this.os),this.Xo=new Nu(this.serializer),this.window&&this.window.localStorage?this.Zo=this.window.localStorage:(this.Zo=null,!1===h&&Ts("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}static Ys(t,e){if(t instanceof Mu)return la.Ys(t.Qr,e);throw ks()}start(){return this.tc().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Os(Ss.FAILED_PRECONDITION,Vu);return this.ec(),this.nc(),this.sc(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Yo.Vo(t))}).then(t=>{this.Uo=new ha(t,this.Bo)}).then(()=>{this.Ko=!0}).catch(t=>(this.Jo&&this.Jo.close(),Promise.reject(t)))}ic(t){return this.zo=(async e=>{if(this.lr)return t(e)}),t(this.isPrimary)}rc(t){this.Jo.ti(async e=>{null===e.newVersion&&await t()})}oc(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Cs.Ri(async()=>{this.lr&&await this.tc()}))}tc(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Fu(t).put(new Eu(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.cc(t).next(t=>{t||(this.isPrimary=!1,this.Cs.Oi(()=>this.zo(!1)))})}).next(()=>this.uc(t)).next(e=>this.isPrimary&&!e?this.ac(t).next(()=>!1):!!e&&this.hc(t).next(()=>!0))).catch(t=>{if(pa(t))return _s("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return _s("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Cs.Oi(()=>this.zo(t)),this.isPrimary=t})}cc(t){return qu(t).get(hu.key).next(t=>ta.resolve(this.lc(t)))}_c(t){return Fu(t).delete(this.clientId)}async fc(){if(this.isPrimary&&!this.dc(this.Go,18e5)){this.Go=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=Uu.Ys(t,Eu.store);return e.ui().next(t=>{const n=this.wc(t,18e5),s=t.filter(t=>-1===n.indexOf(t));return ta.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if(this.Zo)for(const e of t)this.Zo.removeItem(this.Ec(e.clientId))}}sc(){this.jo=this.Cs.Us("client_metadata_refresh",4e3,()=>this.tc().then(()=>this.fc()).then(()=>this.sc()))}lc(t){return!!t&&t.ownerId===this.clientId}uc(t){return this.qo?ta.resolve(!0):qu(t).get(hu.key).next(e=>{if(null!==e&&this.dc(e.leaseTimestampMs,5e3)&&!this.Tc(e.ownerId)){if(this.lc(e)&&this.networkEnabled)return!0;if(!this.lc(e)){if(!e.allowTabSynchronization)throw new Os(Ss.FAILED_PRECONDITION,Vu);return!1}}return!(!this.networkEnabled||!this.inForeground)||Fu(t).ui().next(t=>void 0===this.wc(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&_s("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async Ic(){this.Ko=!1,this.mc(),this.jo&&(this.jo.cancel(),this.jo=null),this.Ac(),this.Rc(),await this.Jo.runTransaction("shutdown","readwrite",[hu.store,Eu.store],t=>{const e=new Mu(t,ha.Ds);return this.ac(e).next(()=>this._c(e))}),this.Jo.close(),this.Pc()}wc(t,e){return t.filter(t=>this.dc(t.updateTimeMs,e)&&!this.Tc(t.clientId))}Vc(){return this.runTransaction("getActiveClients","readonly",t=>Fu(t).ui().next(t=>this.wc(t,18e5).map(t=>t.clientId)))}get lr(){return this.Ko}gc(t){return Ka.Nr(t,this.serializer,this.os,this.Dr)}yc(){return this.Yo}bc(){return this.ss}vc(){return this.os}Sc(){return this.Xo}runTransaction(t,e,n){_s("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.Jo.runTransaction(t,s,Au,s=>(i=new Mu(s,this.Uo?this.Uo.next():ha.Ds),"readwrite-primary"===e?this.cc(i).next(t=>!!t||this.uc(i)).next(e=>{if(!e)throw Ts(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Cs.Oi(()=>this.zo(!1)),new Os(Ss.FAILED_PRECONDITION,ra);return n(i)}).next(t=>this.hc(i).next(()=>t)):this.Dc(i).next(()=>n(i)))).then(t=>(i.ns(),t))}Dc(t){return qu(t).get(hu.key).next(t=>{if(null!==t&&this.dc(t.leaseTimestampMs,5e3)&&!this.Tc(t.ownerId)&&!this.lc(t)&&!(this.qo||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Os(Ss.FAILED_PRECONDITION,Vu)})}hc(t){const e=new hu(this.clientId,this.allowTabSynchronization,Date.now());return qu(t).put(hu.key,e)}static Gs(){return la.Gs()}ac(t){const e=qu(t);return e.get(hu.key).next(t=>this.lc(t)?(_s("IndexedDbPersistence","Releasing primary lease."),e.delete(hu.key)):ta.resolve())}dc(t,e){const n=Date.now();return!(t<n-e||t>n&&(Ts(`Detected an update time that is in the future: ${t} > ${n}`),1))}ec(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Wo=(()=>{this.Cs.Ri(()=>(this.inForeground="visible"===this.document.visibilityState,this.tc()))}),this.document.addEventListener("visibilitychange",this.Wo),this.inForeground="visible"===this.document.visibilityState)}Ac(){this.Wo&&(this.document.removeEventListener("visibilitychange",this.Wo),this.Wo=null)}nc(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Qo=(()=>{this.mc(),this.Cs.Ri(()=>this.Ic())}),this.window.addEventListener("unload",this.Qo))}Rc(){this.Qo&&(this.window.removeEventListener("unload",this.Qo),this.Qo=null)}Tc(t){var e;try{const n=null!==(null===(e=this.Zo)||void 0===e?void 0:e.getItem(this.Ec(t)));return _s("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Ts("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}mc(){if(this.Zo)try{this.Zo.setItem(this.Ec(this.clientId),String(Date.now()))}catch(t){Ts("Failed to set zombie client id.",t)}}Pc(){if(this.Zo)try{this.Zo.removeItem(this.Ec(this.clientId))}catch(t){}}Ec(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function qu(t){return Uu.Ys(t,hu.store)}function Fu(t){return Uu.Ys(t,Eu.store)}class Bu{constructor(t,e){this.db=t,this.cr=new Sa(this,e)}Er(t){const e=this.Cc(t);return this.db.yc().No(t).next(t=>e.next(e=>t+e))}Cc(t){let e=0;return this.Ir(t,t=>{e++}).next(()=>e)}Ue(t,e){return this.db.yc().Ue(t,e)}Ir(t,e){return this.Nc(t,(t,n)=>e(n))}ko(t,e,n){return ju(t,n)}Fo(t,e,n){return ju(t,n)}mr(t,e,n){return this.db.yc().mr(t,e,n)}jr(t,e){return ju(t,e)}xc(t,e){return function(t,e){let n=!1;return Ja(t).fi(s=>Wa(t,s,e).next(t=>(t&&(n=!0),ta.resolve(!t)))).next(()=>n)}(t,e)}Ar(t,e){const n=this.db.bc().io(),s=[];let i=0;return this.Nc(t,(r,o)=>{if(o<=e){const e=this.xc(t,r).next(e=>{if(!e)return i++,n.Jn(t,r).next(()=>(n.Hn(r),Pu(t).delete([0,Ra(r.path)])))});s.push(e)}}).next(()=>ta.qn(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.dt(t.Lo);return this.db.yc().So(t,n)}Mc(t,e){return ju(t,e)}Nc(t,e){const n=Pu(t);let s,i=ha.Ds;return n._i({index:wu.documentTargetsIndex},([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==ha.Ds&&e(new Ws(Pa(s)),i),i=o,s=r):i=ha.Ds}).next(()=>{i!==ha.Ds&&e(new Ws(Pa(s)),i)})}Pr(t){return this.db.bc().oo(t)}}function ju(t,e){return Pu(t).put(function(t,e){return new wu(0,Ra(t.path),e)}(e,t.Lo))}function zu(t,e){let n=t.projectId;return t.ct||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class $u{constructor(t,e,n,s){this.persistence=t,this.kc=e,this.serializer=s,this.Oc=new fi(qs),this.Fc=new Zo(t=>ni(t),si),this.$c=zs.min(),this.rs=t.gc(n),this.Lc=t.bc(),this.Yo=t.yc(),this.Bc=new aa(this.Lc,this.rs,this.persistence.vc()),this.Xo=t.Sc(),this.kc.gr(this.Bc)}_r(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.Rr(e,this.Oc))}}function Gu(t,e,n,s){return new $u(t,e,n,s)}async function Hu(t,e){const n=Ds(t);let s=n.rs,i=n.Bc;const r=await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.rs.qr(t).next(o=>(r=o,s=n.persistence.gc(e),i=new aa(n.Lc,s,n.persistence.vc()),s.qr(t))).next(e=>{const n=[],s=[];let o=Ti();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i._s(t,o).next(t=>({qc:t,Uc:n,Kc:s}))})});return n.rs=s,n.Bc=i,n.kc.gr(n.Bc),r}function Ku(t){const e=Ds(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Yo.Po(t))}function Wu(t,e){const n=Ds(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.rs.Lr(t,e)))}function Yu(t,e){const n=Ds(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let s;return n.Yo.xo(t,e).next(i=>i?(s=i,ta.resolve(s)):n.Yo.mo(t).next(i=>(s=new oi(e,i,0,t.Lo),n.Yo.po(t,s).next(()=>s))))}).then(t=>{const s=n.Oc.get(t.targetId);return(null===s||t.ft.D(s.ft)>0)&&(n.Oc=n.Oc.Tt(t.targetId,t),n.Fc.set(e,t.targetId)),t})}async function Xu(t,e,n){const s=Ds(t),i=s.Oc.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,t=>s.persistence.Dr.removeTarget(t,i))}catch(t){if(!pa(t))throw t;_s("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Oc=s.Oc.remove(e),s.Fc.delete(i.target)}function Qu(t,e,n){const s=Ds(t);let i=zs.min(),r=Ti();return s.persistence.runTransaction("Execute query","readonly",t=>(function(t,e,n){const s=Ds(t),i=s.Fc.get(n);return void 0!==i?ta.resolve(s.Oc.get(i)):s.Yo.xo(e,n)})(s,t,xo(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Yo.$o(t,e.targetId).next(t=>{r=t})}).next(()=>s.kc.ws(t,e,n?i:zs.min(),n?r:Ti())).next(t=>({documents:t,Qc:r})))}function Ju(t,e){const n=Ds(t),s=Ds(n.Yo),i=n.Oc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",t=>s.Ze(t,e).next(t=>t?t.target:null))}function Zu(t){const e=Ds(t);return e.persistence.runTransaction("Get new document changes","readonly",t=>(function(t,e,n){const s=Ds(t);let i=wi(),r=qa(n);const o=nu(e),a=IDBKeyRange.lowerBound(r,!0);return o._i({index:gu.readTimeIndex,range:a},(t,e)=>{const n=Ma(s.serializer,e);i=i.Tt(n.key,n),r=e.readTime}).next(()=>({Wc:i,readTime:Fa(r)}))})(e.Lc,t,e.$c)).then(({Wc:t,readTime:n})=>(e.$c=n,t))}async function th(t){if(t.code!==Ss.FAILED_PRECONDITION||t.message!==ra)throw t;_s("LocalStore","Unexpectedly lost primary lease")}class eh{constructor(t,e,n,s,i,r){this.Cs=t,this.jc=n,this.Gc=s,this.zc=i,this.listener=r,this.state=0,this.Hc=0,this.Jc=null,this.stream=null,this.Si=new ca(t,e)}Yc(){return 1===this.state||2===this.state||4===this.state}Xc(){return 2===this.state}start(){3!==this.state?this.auth():this.Zc()}async stop(){this.Yc()&&await this.close(0)}tu(){this.state=0,this.Si.reset()}eu(){this.Xc()&&null===this.Jc&&(this.Jc=this.Cs.Us(this.jc,6e4,()=>this.nu()))}su(t){this.iu(),this.stream.send(t)}async nu(){if(this.Xc())return this.close(0)}iu(){this.Jc&&(this.Jc.cancel(),this.Jc=null)}async close(t,e){this.iu(),this.Si.cancel(),this.Hc++,3!==t?this.Si.reset():e&&e.code===Ss.RESOURCE_EXHAUSTED?(Ts(e.toString()),Ts("Using maximum backoff delay to prevent overloading the backend."),this.Si.Ls()):e&&e.code===Ss.UNAUTHENTICATED&&this.zc._(),null!==this.stream&&(this.ru(),this.stream.close(),this.stream=null),this.state=t,await this.listener.ou(e)}ru(){}auth(){this.state=1;const t=this.cu(this.Hc),e=this.Hc;this.zc.getToken().then(t=>{this.Hc===e&&this.uu(t)},e=>{t(()=>{const t=new Os(Ss.UNKNOWN,"Fetching auth token failed: "+e.message);return this.au(t)})})}uu(t){const e=this.cu(this.Hc);this.stream=this.hu(t),this.stream.lu(()=>{e(()=>(this.state=2,this.listener.lu()))}),this.stream.ou(t=>{e(()=>this.au(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}Zc(){this.state=4,this.Si.Bs(async()=>{this.state=0,this.start()})}au(t){return _s("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}cu(t){return e=>{this.Cs.Ri(()=>this.Hc===t?e():(_s("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class nh extends eh{constructor(t,e,n,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.serializer=s}hu(t){return this.Gc._u("Listen",t)}onMessage(t){this.Si.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:ks()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.tn?(xs(void 0===e||"string"==typeof e),ri.fromBase64String(e||"")):(xs(void 0===e||e instanceof Uint8Array),ri.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Ss.UNKNOWN:li(t.code);return new Os(e,t.message||"")}(o);n=new Li(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=wr(t,s.document.name),r=pr(s.document.updateTime),o=new lo({mapValue:{fields:s.document.fields}}),a=new mo(i,r,o,{}),u=s.targetIds||[],h=s.removedTargetIds||[];n=new Ri(u,h,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=wr(t,s.document),r=s.readTime?pr(s.readTime):zs.min(),o=new yo(i,r),a=s.removedTargetIds||[];n=new Ri([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=wr(t,s.document),r=s.removedTargetIds||[];n=new Ri([],r,i,null)}else{if(!("filter"in e))return ks();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new ai(s),r=t.targetId;n=new Ci(r,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return zs.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?zs.min():e.readTime?pr(e.readTime):zs.min()}(t);return this.listener.fu(e,n)}du(t){const e={};e.database=Ir(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;return(n=ii(s)?{documents:Nr(t,s)}:{query:kr(t,s)}).targetId=e.targetId,e.resumeToken.ht()>0?n.resumeToken=dr(t,e.resumeToken):e.ft.D(zs.min())>0&&(n.readTime=fr(t,e.ft.N())),n}(this.serializer,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ks()}}(0,e._t);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.su(e)}wu(t){const e={};e.database=Ir(this.serializer),e.removeTarget=t,this.su(e)}}class sh extends eh{constructor(t,e,n,s,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.serializer=s,this.Eu=!1}get Tu(){return this.Eu}start(){this.Eu=!1,this.lastStreamToken=void 0,super.start()}ru(){this.Eu&&this.Iu([])}hu(t){return this.Gc._u("Write",t)}onMessage(t){if(xs(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Eu){this.Si.reset();const e=function(t,e){return t&&t.length>0?(xs(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?pr(t.updateTime):pr(e);n.isEqual(zs.min())&&(n=pr(e));let s=null;return t.transformResults&&t.transformResults.length>0&&(s=t.transformResults),new Wr(n,s)})(t,e))):[]}(t.writeResults,t.commitTime),n=pr(t.commitTime);return this.listener.mu(n,e)}return xs(!t.writeResults||0===t.writeResults.length),this.Eu=!0,this.listener.Au()}Ru(){const t={};t.database=Ir(this.serializer),this.su(t)}Iu(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>Tr(this.serializer,t))};this.su(e)}}class ih extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Gc=e,this.serializer=n,this.Pu=!1}Vu(){if(this.Pu)throw new Os(Ss.FAILED_PRECONDITION,"The client has already been terminated.")}gu(t,e,n){return this.Vu(),this.credentials.getToken().then(s=>this.Gc.gu(t,e,n,s)).catch(t=>{throw t.code===Ss.UNAUTHENTICATED&&this.credentials._(),t})}yu(t,e,n){return this.Vu(),this.credentials.getToken().then(s=>this.Gc.yu(t,e,n,s)).catch(t=>{throw t.code===Ss.UNAUTHENTICATED&&this.credentials._(),t})}terminate(){this.Pu=!1}}class rh{constructor(t,e){this.di=t,this.pu=e,this.state="Unknown",this.bu=0,this.vu=null,this.Su=!0}Du(){0===this.bu&&(this.Cu("Unknown"),this.vu=this.di.Us("online_state_timeout",1e4,()=>(this.vu=null,this.Nu("Backend didn't respond within 10 seconds."),this.Cu("Offline"),Promise.resolve())))}xu(t){"Online"===this.state?this.Cu("Unknown"):(this.bu++,this.bu>=1&&(this.Mu(),this.Nu("Connection failed 1 times. Most recent error: "+t.toString()),this.Cu("Offline")))}set(t){this.Mu(),this.bu=0,"Online"===t&&(this.Su=!1),this.Cu(t)}Cu(t){t!==this.state&&(this.state=t,this.pu(t))}Nu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Su?(Ts(e),this.Su=!1):_s("OnlineStateTracker",e)}Mu(){null!==this.vu&&(this.vu.cancel(),this.vu=null)}}class oh{constructor(t,e,n,s,i){this.ku=t,this.Ou=e,this.di=n,this.Fu={},this.$u=[],this.Lu=new Map,this.Bu=new Set,this.qu=[],this.Uu=i,this.Uu.Ku(t=>{n.Ri(async()=>{gh(this)&&(_s("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Ds(t);e.Bu.add(4),await uh(e),e.Qu.set("Unknown"),e.Bu.delete(4),await ah(e)}(this))})}),this.Qu=new rh(n,s)}}async function ah(t){if(gh(t))for(const e of t.qu)await e(!0)}async function uh(t){for(const e of t.qu)await e(!1)}function hh(t,e){const n=Ds(t);n.Lu.has(e.targetId)||(n.Lu.set(e.targetId,e),ph(n)?dh(n):Ah(n).Xc()&&lh(n,e))}function ch(t,e){const n=Ds(t),s=Ah(n);n.Lu.delete(e),s.Xc()&&fh(n,e),0===n.Lu.size&&(s.Xc()?s.eu():gh(n)&&n.Qu.set("Unknown"))}function lh(t,e){t.Wu.De(e.targetId),Ah(t).du(e)}function fh(t,e){t.Wu.De(e),Ah(t).wu(e)}function dh(t){t.Wu=new Vi({Xe:e=>t.Fu.Xe(e),Ze:e=>t.Lu.get(e)||null}),Ah(t).start(),t.Qu.Du()}function ph(t){return gh(t)&&!Ah(t).Yc()&&t.Lu.size>0}function gh(t){return 0===Ds(t).Bu.size}function mh(t){t.Wu=void 0}async function yh(t,e,n){if(!pa(e))throw e;t.Bu.add(1),await uh(t),t.Qu.set("Offline"),n||(n=(()=>Ku(t.ku))),t.di.Oi(async()=>{_s("RemoteStore","Retrying IndexedDB access"),await n(),t.Bu.delete(1),await ah(t)})}function wh(t,e){return e().catch(n=>yh(t,n,e))}async function vh(t){const e=Ds(t),n=Nh(e);let s=e.$u.length>0?e.$u[e.$u.length-1].batchId:-1;for(;bh(e);)try{const i=await Wu(e.ku,s);if(null===i){0===e.$u.length&&n.eu();break}s=i.batchId,Ih(e,i)}catch(t){await yh(e,t)}Eh(e)&&_h(e)}function bh(t){return gh(t)&&t.$u.length<10}function Ih(t,e){t.$u.push(e);const n=Nh(t);n.Xc()&&n.Tu&&n.Iu(e.mutations)}function Eh(t){return gh(t)&&!Nh(t).Yc()&&t.$u.length>0}function _h(t){Nh(t).start()}async function Th(t,e){const n=Ds(t);e?(n.Bu.delete(2),await ah(n)):e||(n.Bu.add(2),await uh(n),n.Qu.set("Unknown"))}function Ah(t){return t.Ju||(t.Ju=function(t,e,n){const s=Ds(t);return s.Vu(),new nh(e,s.Gc,s.credentials,s.serializer,n)}(t.Ou,t.di,{lu:async function(t){t.Lu.forEach((e,n)=>{lh(t,e)})}.bind(null,t),ou:async function(t,e){mh(t),ph(t)?(t.Qu.xu(e),dh(t)):t.Qu.set("Unknown")}.bind(null,t),fu:async function(t,e,n){if(t.Qu.set("Online"),e instanceof Li&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Lu.has(s)&&(await t.Fu.ju(s,n),t.Lu.delete(s),t.Wu.removeTarget(s))}(t,e)}catch(n){_s("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await yh(t,n)}else if(e instanceof Ri?t.Wu.$e(e):e instanceof Ci?t.Wu.je(e):t.Wu.qe(e),!n.isEqual(zs.min()))try{const s=await Ku(t.ku);n.D(s)>=0&&await function(t,e){const n=t.Wu.He(e);return n.re.forEach((n,s)=>{if(n.resumeToken.ht()>0){const i=t.Lu.get(s);i&&t.Lu.set(s,i.wt(n.resumeToken,e))}}),n.oe.forEach(e=>{const n=t.Lu.get(e);if(!n)return;t.Lu.set(e,n.wt(ri.lt,n.ft)),fh(t,e);const s=new oi(n.target,e,1,n.sequenceNumber);lh(t,s)}),t.Fu.Gu(n)}(t,n)}catch(e){_s("RemoteStore","Failed to raise snapshot:",e),await yh(t,e)}}.bind(null,t)}),t.qu.push(async e=>{e?(t.Ju.tu(),ph(t)?dh(t):t.Qu.set("Unknown")):(await t.Ju.stop(),mh(t))})),t.Ju}function Nh(t){return t.Yu||(t.Yu=function(t,e,n){const s=Ds(t);return s.Vu(),new sh(e,s.Gc,s.credentials,s.serializer,n)}(t.Ou,t.di,{lu:async function(t){Nh(t).Ru()}.bind(null,t),ou:async function(t,e){e&&Nh(t).Tu&&await async function(t,e){if(ci(n=e.code)&&n!==Ss.ABORTED){const n=t.$u.shift();Nh(t).tu(),await wh(t,()=>t.Fu.Hu(n.batchId,e)),await vh(t)}var n}(t,e),Eh(t)&&_h(t)}.bind(null,t),Au:async function(t){const e=Nh(t);for(const n of t.$u)e.Iu(n.mutations)}.bind(null,t),mu:async function(t,e,n){const s=t.$u.shift(),i=Jo.from(s,e,n);await wh(t,()=>t.Fu.zu(i)),await vh(t)}.bind(null,t)}),t.qu.push(async e=>{e?(t.Yu.tu(),await vh(t)):(await t.Yu.stop(),t.$u.length>0&&(_s("RemoteStore",`Stopping write stream with ${t.$u.length} pending writes`),t.$u=[]))})),t.Yu}class kh{constructor(){this.Xu=void 0,this.listeners=[]}}class xh{constructor(){this.queries=new Zo(t=>Oo(t),So),this.onlineState="Unknown",this.Zu=new Set}}async function Dh(t,e){const n=Ds(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new kh),i)try{r.Xu=await n.ta(s)}catch(t){const n=Ta(t,`Initialization of query '${Ro(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.ea(n.onlineState),r.Xu&&e.na(r.Xu)&&Oh(n)}async function Sh(t,e){const n=Ds(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.sa(s)}function Oh(t){t.Zu.forEach(t=>{t.next()})}class Rh{constructor(t,e,n){this.query=t,this.ia=e,this.ra=!1,this.oa=null,this.onlineState="Unknown",this.options=n||{}}na(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Di(t.query,t.docs,t.te,e,t.ee,t.fromCache,t.ne,!0)}let e=!1;return this.ra?this.ca(t)&&(this.ia.next(t),e=!0):this.ua(t,this.onlineState)&&(this.aa(t),e=!0),this.oa=t,e}onError(t){this.ia.error(t)}ea(t){this.onlineState=t;let e=!1;return this.oa&&!this.ra&&this.ua(this.oa,t)&&(this.aa(this.oa),e=!0),e}ua(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.ha&&n||t.docs.q()&&"Offline"!==e)}ca(t){if(t.docChanges.length>0)return!0;const e=this.oa&&this.oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.ne&&!e)&&!0===this.options.includeMetadataChanges}aa(t){t=Di.ie(t.query,t.docs,t.ee,t.fromCache),this.ra=!0,this.ia.next(t)}}class Ch{constructor(){this.la=new gi(Lh._a),this.fa=new gi(Lh.da)}q(){return this.la.q()}ko(t,e){const n=new Lh(t,e);this.la=this.la.add(n),this.fa=this.fa.add(n)}wa(t,e){t.forEach(t=>this.ko(t,e))}Fo(t,e){this.Ea(new Lh(t,e))}Ta(t,e){t.forEach(t=>this.Fo(t,e))}Ia(t){const e=new Ws(new Gs([])),n=new Lh(e,t),s=new Lh(e,t+1),i=[];return this.fa.Qt([n,s],t=>{this.Ea(t),i.push(t.key)}),i}ma(){this.la.forEach(t=>this.Ea(t))}Ea(t){this.la=this.la.delete(t),this.fa=this.fa.delete(t)}Aa(t){const e=new Ws(new Gs([])),n=new Lh(e,t),s=new Lh(e,t+1);let i=Ti();return this.fa.Qt([n,s],t=>{i=i.add(t.key)}),i}zr(t){const e=new Lh(t,0),n=this.la.jt(e);return null!==n&&t.isEqual(n.key)}}class Lh{constructor(t,e){this.key=t,this.Ra=e}static _a(t,e){return Ws.k(t.key,e.key)||qs(t.Ra,e.Ra)}static da(t,e){return qs(t.Ra,e.Ra)||Ws.k(t.key,e.key)}}function Ph(t,e){return`firestore_clients_${t}_${e}`}function Vh(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.t()&&(s+="_"+e.uid),s}function Mh(t,e){return`firestore_targets_${t}_${e}`}class Uh{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Pa(t,e,n){const s=JSON.parse(n);let i="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error),r=void 0;return i&&s.error&&((i="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(r=new Os(s.error.code,s.error.message))),i?new Uh(t,e,s.state,r):(Ts("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Va(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class qh{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Pa(t,e){const n=JSON.parse(e);let s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return s&&n.error&&((s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Os(n.error.code,n.error.message))),s?new qh(t,n.state,i):(Ts("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Va(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Fh{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Pa(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=Ni();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Zs(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new Fh(t,i):(Ts("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Bh{constructor(t,e){this.clientId=t,this.onlineState=e}static Pa(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Bh(e.clientId,e.onlineState):(Ts("SharedClientState","Failed to parse online state: "+t),null)}}class jh{constructor(){this.activeTargetIds=Ni()}ga(t){this.activeTargetIds=this.activeTargetIds.add(t)}ya(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Va(){const t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class zh{constructor(t,e,n,s,i){this.window=t,this.Cs=e,this.persistenceKey=n,this.pa=s,this.ba=null,this.pu=null,this.ps=null,this.va=this.Sa.bind(this),this.Da=new fi(qs),this.lr=!1,this.Ca=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Na=Ph(this.persistenceKey,this.pa),this.xa=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Da=this.Da.Tt(this.pa,new jh),this.Ma=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.ka=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.Oa=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.Fa=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.$a=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.va)}static Gs(t){return!(!t||!t.localStorage)}async start(){const t=await this.ba.Vc();for(const e of t){if(e===this.pa)continue;const t=this.getItem(Ph(this.persistenceKey,e));if(t){const n=Fh.Pa(e,t);n&&(this.Da=this.Da.Tt(n.clientId,n))}}this.La();const e=this.storage.getItem(this.Fa);if(e){const t=this.Ba(e);t&&this.qa(t)}for(const t of this.Ca)this.Sa(t);this.Ca=[],this.window.addEventListener("unload",()=>this.Ic()),this.lr=!0}Ss(t){this.setItem(this.xa,JSON.stringify(t))}Ua(){return this.Ka(this.Da)}Qa(t){let e=!1;return this.Da.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}Wa(t){this.ja(t,"pending")}Ga(t,e,n){this.ja(t,e,n),this.za(t)}Ha(t){let e="not-current";if(this.Qa(t)){const n=this.storage.getItem(Mh(this.persistenceKey,t));if(n){const s=qh.Pa(t,n);s&&(e=s.state)}}return this.Ja.ga(t),this.La(),e}Ya(t){this.Ja.ya(t),this.La()}Xa(t){return this.Ja.activeTargetIds.has(t)}Za(t){this.removeItem(Mh(this.persistenceKey,t))}th(t,e,n){this.eh(t,e,n)}nh(t,e,n){e.forEach(t=>{this.za(t)}),this.currentUser=t,n.forEach(t=>{this.Wa(t)})}sh(t){this.ih(t)}rh(){this.oh()}Ic(){this.lr&&(this.window.removeEventListener("storage",this.va),this.removeItem(this.Na),this.lr=!1)}getItem(t){const e=this.storage.getItem(t);return _s("SharedClientState","READ",t,e),e}setItem(t,e){_s("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){_s("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Sa(t){const e=t;if(e.storageArea===this.storage){if(_s("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Na)return void Ts("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Cs.Oi(async()=>{if(this.lr){if(null!==e.key)if(this.Ma.test(e.key)){if(null==e.newValue){const t=this.uh(e.key);return this.ah(t,null)}{const t=this.hh(e.key,e.newValue);if(t)return this.ah(t.clientId,t)}}else if(this.ka.test(e.key)){if(null!==e.newValue){const t=this.lh(e.key,e.newValue);if(t)return this._h(t)}}else if(this.Oa.test(e.key)){if(null!==e.newValue){const t=this.fh(e.key,e.newValue);if(t)return this.dh(t)}}else if(e.key===this.Fa){if(null!==e.newValue){const t=this.Ba(e.newValue);if(t)return this.qa(t)}}else if(e.key===this.xa){const t=function(t){let e=ha.Ds;if(null!=t)try{const n=JSON.parse(t);xs("number"==typeof n),e=n}catch(t){Ts("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==ha.Ds&&this.ps(t)}else if(e.key===this.$a)return this.ba.wh()}else this.Ca.push(e)})}}get Ja(){return this.Da.get(this.pa)}La(){this.setItem(this.Na,this.Ja.Va())}ja(t,e,n){const s=new Uh(this.currentUser,t,e,n),i=Vh(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Va())}za(t){const e=Vh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}ih(t){const e={clientId:this.pa,onlineState:t};this.storage.setItem(this.Fa,JSON.stringify(e))}eh(t,e,n){const s=Mh(this.persistenceKey,t),i=new qh(t,e,n);this.setItem(s,i.Va())}oh(){this.setItem(this.$a,"value-not-used")}uh(t){const e=this.Ma.exec(t);return e?e[1]:null}hh(t,e){const n=this.uh(t);return Fh.Pa(n,e)}lh(t,e){const n=this.ka.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Uh.Pa(new bs(i),s,e)}fh(t,e){const n=this.Oa.exec(t),s=Number(n[1]);return qh.Pa(s,e)}Ba(t){return Bh.Pa(t)}async _h(t){if(t.user.uid===this.currentUser.uid)return this.ba.Eh(t.batchId,t.state,t.error);_s("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}dh(t){return this.ba.Th(t.targetId,t.state,t.error)}ah(t,e){const n=e?this.Da.Tt(t,e):this.Da.remove(t),s=this.Ka(this.Da),i=this.Ka(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.ba.Ih(r,o).then(()=>{this.Da=n})}qa(t){this.Da.get(t.clientId)&&this.pu(t.onlineState)}Ka(t){let e=Ni();return t.forEach((t,n)=>{e=e.Gt(n.activeTargetIds)}),e}}class $h{constructor(){this.mh=new jh,this.Ah={},this.pu=null,this.ps=null}Wa(t){}Ga(t,e,n){}Ha(t){return this.mh.ga(t),this.Ah[t]||"not-current"}th(t,e,n){this.Ah[t]=e}Ya(t){this.mh.ya(t)}Xa(t){return this.mh.activeTargetIds.has(t)}Za(t){delete this.Ah[t]}Ua(){return this.mh.activeTargetIds}Qa(t){return this.mh.activeTargetIds.has(t)}start(){return this.mh=new jh,Promise.resolve()}nh(t,e,n){}sh(t){}Ic(){}Ss(t){}rh(){}}class Gh{constructor(t){this.key=t}}class Hh{constructor(t){this.key=t}}class Kh{constructor(t,e){this.query=t,this.Rh=e,this.Ph=null,this.le=!1,this.Vh=Ti(),this.ee=Ti(),this.gh=Lo(t),this.yh=new ki(this.gh)}get ph(){return this.Rh}bh(t,e){const n=e?e.Sh:new xi,s=e?e.yh:this.yh;let i=e?e.ee:this.ee,r=s,o=!1;const a=Eo(this.query)&&s.size===this.query.limit?s.last():null,u=_o(this.query)&&s.size===this.query.limit?s.first():null;if(t.Pt((t,e)=>{const h=s.get(t);let c=e instanceof mo?e:null;c&&(c=Co(this.query,c)?c:null);const l=!!h&&this.ee.has(h.key),f=!!c&&(c.an||this.ee.has(c.key)&&c.hasCommittedMutations);let d=!1;h&&c?h.data().isEqual(c.data())?l!==f&&(n.track({type:3,doc:c}),d=!0):this.Dh(h,c)||(n.track({type:2,doc:c}),d=!0,(a&&this.gh(c,a)>0||u&&this.gh(c,u)<0)&&(o=!0)):!h&&c?(n.track({type:0,doc:c}),d=!0):h&&!c&&(n.track({type:1,doc:h}),d=!0,(a||u)&&(o=!0)),d&&(c?(r=r.add(c),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),Eo(this.query)||_o(this.query))for(;r.size>this.query.limit;){const t=Eo(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{yh:r,Sh:n,vr:o,ee:i}}Dh(t,e){return t.an&&e.hasCommittedMutations&&!e.an}Zn(t,e,n){const s=this.yh;this.yh=t.yh,this.ee=t.ee;const i=t.Sh.Zt();i.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ks()}};return n(t)-n(e)})(t.type,e.type)||this.gh(t.doc,e.doc)),this.Ch(n);const r=e?this.Nh():[],o=0===this.Vh.size&&this.le?1:0,a=o!==this.Ph;return this.Ph=o,0!==i.length||a?{snapshot:new Di(this.query,t.yh,s,i,t.ee,0===o,a,!1),xh:r}:{xh:r}}ea(t){return this.le&&"Offline"===t?(this.le=!1,this.Zn({yh:this.yh,Sh:new xi,ee:this.ee,vr:!1},!1)):{xh:[]}}Mh(t){return!this.Rh.has(t)&&!!this.yh.has(t)&&!this.yh.get(t).an}Ch(t){t&&(t._e.forEach(t=>this.Rh=this.Rh.add(t)),t.fe.forEach(t=>{}),t.de.forEach(t=>this.Rh=this.Rh.delete(t)),this.le=t.le)}Nh(){if(!this.le)return[];const t=this.Vh;this.Vh=Ti(),this.yh.forEach(t=>{this.Mh(t.key)&&(this.Vh=this.Vh.add(t.key))});const e=[];return t.forEach(t=>{this.Vh.has(t)||e.push(new Hh(t))}),this.Vh.forEach(n=>{t.has(n)||e.push(new Gh(n))}),e}kh(t){this.Rh=t.Qc,this.Vh=Ti();const e=this.bh(t.documents);return this.Zn(e,!0)}Oh(){return Di.ie(this.query,this.yh,this.ee,0===this.Ph)}}class Wh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Yh{constructor(t){this.key=t,this.Fh=!1}}class Xh{constructor(t,e,n,s,i,r){this.ku=t,this.$h=e,this.Lh=n,this.Bh=s,this.currentUser=i,this.qh=r,this.Uh={},this.Kh=new Zo(t=>Oo(t),So),this.Qh=new Map,this.Wh=[],this.jh=new fi(Ws.k),this.Gh=new Map,this.zh=new Ch,this.Hh={},this.Jh=new Map,this.Yh=Ou.Io(),this.onlineState="Unknown",this.Xh=void 0}get Zh(){return!0===this.Xh}}async function Qh(t,e,n,s){t.tl=((e,n,s)=>(async function(t,e,n,s){let i=e.view.bh(n);i.vr&&(i=await Qu(t.ku,e.query,!1).then(({documents:t})=>e.view.bh(t,i)));const r=s&&s.re.get(e.targetId),o=e.view.Zn(i,t.Zh,r);return rc(t,e.targetId,o.xh),o.snapshot})(t,e,n,s));const i=await Qu(t.ku,e,!0),r=new Kh(e,i.Qc),o=r.bh(i.documents),a=Oi.he(n,s&&"Offline"!==t.onlineState),u=r.Zn(o,t.Zh,a);rc(t,n,u.xh);const h=new Wh(e,n,r);return t.Kh.set(e,h),t.Qh.has(n)?t.Qh.get(n).push(e):t.Qh.set(n,[e]),u.snapshot}async function Jh(t,e){const n=Ds(t);try{const s=await function(t,e){const n=Ds(t),s=e.ft;let i=n.Oc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const r=n.Lc.io({ro:!0});i=n.Oc;const o=[];e.re.forEach((e,r)=>{const a=i.get(r);if(!a)return;o.push(n.Yo.Oo(t,e.de,r).next(()=>n.Yo.Mo(t,e._e,r)));const u=e.resumeToken;if(u.ht()>0){const h=a.wt(u,s).dt(t.Lo);i=i.Tt(r,h),function(t,e,n){return xs(e.resumeToken.ht()>0),0===t.resumeToken.ht()||e.ft.C()-t.ft.C()>=3e8||n._e.size+n.fe.size+n.de.size>0}(a,h,e)&&o.push(n.Yo.So(t,h))}});let a=wi();if(e.ce.forEach((s,i)=>{e.ue.has(s)&&o.push(n.persistence.Dr.Mc(t,s))}),o.push(function(t,e,n,s,i){let r=Ti();return n.forEach(t=>r=r.add(t)),e.getEntries(t,r).next(t=>{let i=wi();return n.forEach((n,r)=>{const o=t.get(n),a=s;r instanceof yo&&r.version.isEqual(zs.min())?(e.Hn(n,a),i=i.Tt(n,r)):null==o||r.version.D(o.version)>0||0===r.version.D(o.version)&&o.hasPendingWrites?(e.jn(r,a),i=i.Tt(n,r)):_s("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)}),i})}(t,r,e.ce,s).next(t=>{a=t})),!s.isEqual(zs.min())){const e=n.Yo.Po(t).next(e=>n.Yo.yo(t,t.Lo,s));o.push(e)}return ta.qn(o).next(()=>r.apply(t)).next(()=>n.Bc.fs(t,a))}).then(t=>(n.Oc=i,t))}(n.ku,e);e.re.forEach((t,e)=>{const s=n.Gh.get(e);s&&(xs(t._e.size+t.fe.size+t.de.size<=1),t._e.size>0?s.Fh=!0:t.fe.size>0?xs(s.Fh):t.de.size>0&&(xs(s.Fh),s.Fh=!1))}),await uc(n,s,e)}catch(t){await th(t)}}function Zh(t,e,n){const s=Ds(t);if(s.Zh&&0===n||!s.Zh&&1===n){const t=[];s.Kh.forEach((n,s)=>{const i=s.view.ea(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=Ds(t);n.onlineState=e;let s=!1;n.queries.forEach((t,n)=>{for(const t of n.listeners)t.ea(e)&&(s=!0)}),s&&Oh(n)}(s.Lh,e),t.length&&s.Uh.fu(t),s.onlineState=e,s.Zh&&s.Bh.sh(e)}}async function tc(t,e){const n=Ds(t),s=e.batch.batchId;try{const i=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const s=e.batch.keys(),i=n.Lc.io({ro:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=ta.resolve();return r.forEach(t=>{o=o.next(()=>s.Jn(e,t)).next(e=>{let r=e;const o=n.Sn.get(t);xs(null!==o),(!r||r.version.D(o)<0)&&(r=i.gn(t,r,n))&&s.jn(r,n.vn)})}),o.next(()=>t.rs.Kr(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.rs.Gr(t)).next(()=>n.Bc._s(t,s))})}(n.ku,e);nc(n,s,null),ec(n,s),n.Bh.Ga(s,"acknowledged"),await uc(n,i)}catch(t){await th(t)}}function ec(t,e){(t.Jh.get(e)||[]).forEach(t=>{t.resolve()}),t.Jh.delete(e)}function nc(t,e,n){const s=Ds(t);let i=s.Hh[s.currentUser.i()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.Hh[s.currentUser.i()]=i}}function sc(t,e,n=null){t.Bh.Ya(e);for(const s of t.Qh.get(e))t.Kh.delete(s),n&&t.Uh.el(s,n);t.Qh.delete(e),t.Zh&&t.zh.Ia(e).forEach(e=>{t.zh.zr(e)||ic(t,e)})}function ic(t,e){const n=t.jh.get(e);null!==n&&(ch(t.$h,n),t.jh=t.jh.remove(e),t.Gh.delete(n),ac(t))}function rc(t,e,n){for(const s of n)s instanceof Gh?(t.zh.ko(s.key,e),oc(t,s)):s instanceof Hh?(_s("SyncEngine","Document no longer in limbo: "+s.key),t.zh.Fo(s.key,e),t.zh.zr(s.key)||ic(t,s.key)):ks()}function oc(t,e){const n=e.key;t.jh.get(n)||(_s("SyncEngine","New document in limbo: "+n),t.Wh.push(n),ac(t))}function ac(t){for(;t.Wh.length>0&&t.jh.size<t.qh;){const e=t.Wh.shift(),n=t.Yh.next();t.Gh.set(n,new Yh(e)),t.jh=t.jh.Tt(e,n),hh(t.$h,new oi(xo(Io(e.path)),n,2,ha.Ds))}}async function uc(t,e,n){const s=Ds(t),i=[],r=[],o=[];s.Kh.q()||(s.Kh.forEach((t,a)=>{o.push(s.tl(a,e,n).then(t=>{if(t){s.Zh&&s.Bh.th(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=ua.ys(a.targetId,t);r.push(e)}}))}),await Promise.all(o),s.Uh.fu(i),await async function(t,e){const n=Ds(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>ta.forEach(e,e=>ta.forEach(e.Vs,s=>n.persistence.Dr.ko(t,e.targetId,s)).next(()=>ta.forEach(e.gs,s=>n.persistence.Dr.Fo(t,e.targetId,s)))))}catch(t){if(!pa(t))throw t;_s("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Oc.get(e),s=t.ft,i=t.Et(s);n.Oc=n.Oc.Tt(e,i)}}}(s.ku,r))}async function hc(t,e){const n=Ds(t),s=await Qu(n.ku,e.query,!0),i=e.view.kh(s);return n.Zh&&rc(n,e.targetId,i.xh),i}async function cc(t,e,n){const s=Ds(t),i=[],r=[];for(const t of e){let e;const n=s.Qh.get(t);if(n&&0!==n.length){e=await Yu(s.ku,xo(n[0]));for(const t of n){const e=s.Kh.get(t),n=await hc(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await Ju(s.ku,t);e=await Yu(s.ku,n),await Qh(s,lc(n),t,!1)}i.push(e)}return s.Uh.fu(r),i}function lc(t){return bo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function fc(t){const e=Ds(t);return e.$h.Fu.Gu=Jh.bind(null,e),e.$h.Fu.Xe=function(t,e){const n=Ds(t),s=n.Gh.get(e);if(s&&s.Fh)return Ti().add(s.key);{let t=Ti();const s=n.Qh.get(e);if(!s)return t;for(const e of s){const s=n.Kh.get(e);t=t.Gt(s.view.ph)}return t}}.bind(null,e),e.$h.Fu.ju=async function(t,e,n){const s=Ds(t);s.Bh.th(e,"rejected",n);const i=s.Gh.get(e),r=i&&i.key;if(r){let t=new fi(Ws.k);t=t.Tt(r,new yo(r,zs.min()));const n=Ti().add(r),i=new Si(zs.min(),new Map,new gi(qs),t,n);await Jh(s,i),s.jh=s.jh.remove(r),s.Gh.delete(e),ac(s)}else await Xu(s.ku,e,!1).then(()=>sc(s,e,n)).catch(th)}.bind(null,e),e.Uh.fu=function(t,e){const n=Ds(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.na(t)&&(s=!0);i.Xu=t}}s&&Oh(n)}.bind(null,e.Lh),e.Uh.el=function(t,e,n){const s=Ds(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}.bind(null,e.Lh),e}function dc(t){const e=Ds(t);return e.$h.Fu.zu=tc.bind(null,e),e.$h.Fu.Hu=async function(t,e,n){const s=Ds(t);try{const t=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let s;return n.rs.Fr(t,e).next(e=>(xs(null!==e),s=e.keys(),n.rs.Kr(t,e))).next(()=>n.rs.Gr(t)).next(()=>n.Bc._s(t,s))})}(s.ku,e);nc(s,e,n),ec(s,e),s.Bh.Ga(e,"rejected",n),await uc(s,t)}catch(n){await th(n)}}.bind(null,e),e}class pc{constructor(t,e){this.os=t,this.Dr=e,this.rs=[],this.nl=1,this.sl=new gi(Lh._a)}Mr(t){return ta.resolve(0===this.rs.length)}kr(t,e,n,s){const i=this.nl;this.nl++,this.rs.length>0&&this.rs[this.rs.length-1];const r=new Qo(i,e,n,s);this.rs.push(r);for(const e of s)this.sl=this.sl.add(new Lh(e.key,i)),this.os.Or(t,e.key.path.$());return ta.resolve(r)}Fr(t,e){return ta.resolve(this.il(e))}Lr(t,e){const n=e+1,s=this.rl(n),i=s<0?0:s;return ta.resolve(this.rs.length>i?this.rs[i]:null)}Br(){return ta.resolve(0===this.rs.length?-1:this.nl-1)}qr(t){return ta.resolve(this.rs.slice())}us(t,e){const n=new Lh(e,0),s=new Lh(e,Number.POSITIVE_INFINITY),i=[];return this.sl.Qt([n,s],t=>{const e=this.il(t.Ra);i.push(e)}),ta.resolve(i)}ds(t,e){let n=new gi(qs);return e.forEach(t=>{const e=new Lh(t,0),s=new Lh(t,Number.POSITIVE_INFINITY);this.sl.Qt([e,s],t=>{n=n.add(t.Ra)})}),ta.resolve(this.ol(n))}Rs(t,e){const n=e.path,s=n.length+1;let i=n;Ws.st(i)||(i=i.child(""));const r=new Lh(new Ws(i),0);let o=new gi(qs);return this.sl.Wt(t=>{const e=t.key.path;return!!n.U(e)&&(e.length===s&&(o=o.add(t.Ra)),!0)},r),ta.resolve(this.ol(o))}ol(t){const e=[];return t.forEach(t=>{const n=this.il(t);null!==n&&e.push(n)}),e}Kr(t,e){xs(0===this.cl(e.batchId,"removed")),this.rs.shift();let n=this.sl;return ta.forEach(e.mutations,s=>{const i=new Lh(s.key,e.batchId);return n=n.delete(i),this.Dr.jr(t,s.key)}).next(()=>{this.sl=n})}Wr(t){}zr(t,e){const n=new Lh(e,0),s=this.sl.jt(n);return ta.resolve(e.isEqual(s&&s.key))}Gr(t){return this.rs.length,ta.resolve()}cl(t,e){return this.rl(t)}rl(t){return 0===this.rs.length?0:t-this.rs[0].batchId}il(t){const e=this.rl(t);return e<0||e>=this.rs.length?null:this.rs[e]}}class gc{constructor(t,e){this.os=t,this.ul=e,this.docs=new fi(Ws.k),this.size=0}jn(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.ul(e);return this.docs=this.docs.Tt(s,{zn:e,size:o,readTime:n}),this.size+=o-r,this.os.Or(t,s.path.$())}Hn(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}Jn(t,e){const n=this.docs.get(e);return ta.resolve(n?n.zn:null)}getEntries(t,e){let n=vi();return e.forEach(t=>{const e=this.docs.get(t);n=n.Tt(t,e?e.zn:null)}),ta.resolve(n)}ws(t,e,n){let s=Ii();const i=new Ws(e.path.child("")),r=this.docs.yt(i);for(;r.Nt();){const{key:t,value:{zn:i,readTime:o}}=r.Ct();if(!e.path.U(t.path))break;o.D(n)<=0||i instanceof mo&&Co(e,i)&&(s=s.Tt(i.key,i))}return ta.resolve(s)}al(t,e){return ta.forEach(this.docs,t=>e(t))}io(t){return new mc(this)}oo(t){return ta.resolve(this.size)}}class mc extends ea{constructor(t){super(),this.co=t}Zn(t){const e=[];return this.Kn.forEach((n,s)=>{s&&s.zn?e.push(this.co.jn(t,s.zn,this.Wn(n))):this.co.Hn(n)}),ta.qn(e)}Yn(t,e){return this.co.Jn(t,e)}Xn(t,e){return this.co.getEntries(t,e)}}class yc{constructor(t){this.persistence=t,this.hl=new Zo(t=>ni(t),si),this.lastRemoteSnapshotVersion=zs.min(),this.highestTargetId=0,this.ll=0,this._l=new Ch,this.targetCount=0,this.fl=Ou.To()}Ue(t,e){return this.hl.forEach((t,n)=>e(n)),ta.resolve()}Po(t){return ta.resolve(this.lastRemoteSnapshotVersion)}Vo(t){return ta.resolve(this.ll)}mo(t){return this.highestTargetId=this.fl.next(),ta.resolve(this.highestTargetId)}yo(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ll&&(this.ll=e),ta.resolve()}bo(t){this.hl.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.fl=new Ou(e),this.highestTargetId=e),t.sequenceNumber>this.ll&&(this.ll=t.sequenceNumber)}po(t,e){return this.bo(e),this.targetCount+=1,ta.resolve()}So(t,e){return this.bo(e),ta.resolve()}Do(t,e){return this.hl.delete(e.target),this._l.Ia(e.targetId),this.targetCount-=1,ta.resolve()}mr(t,e,n){let s=0;const i=[];return this.hl.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.hl.delete(r),i.push(this.Co(t,o.targetId)),s++)}),ta.qn(i).next(()=>s)}No(t){return ta.resolve(this.targetCount)}xo(t,e){const n=this.hl.get(e)||null;return ta.resolve(n)}Mo(t,e,n){return this._l.wa(e,n),ta.resolve()}Oo(t,e,n){this._l.Ta(e,n);const s=this.persistence.Dr,i=[];return s&&e.forEach(e=>{i.push(s.jr(t,e))}),ta.qn(i)}Co(t,e){return this._l.Ia(e),ta.resolve()}$o(t,e){const n=this._l.Aa(e);return ta.resolve(n)}zr(t,e){return ta.resolve(this._l.zr(e))}}class wc{constructor(t){this.serializer=t,this.dl=new Map,this.wl=new Map}ho(t,e){return ta.resolve(this.dl.get(e))}lo(t,e){var n;return this.dl.set(e.id,{id:(n=e).id,version:n.version,createTime:pr(n.createTime)}),ta.resolve()}_o(t,e){return ta.resolve(this.wl.get(e))}fo(t,e){var n;return this.wl.set(e.name,{name:(n=e).name,query:Ha(n.bundledQuery),readTime:pr(n.readTime)}),ta.resolve()}}class vc{constructor(t,e){this.El={},this.Uo=new ha(0),this.Ko=!1,this.Ko=!0,this.Dr=t(this),this.Yo=new yc(this),this.os=new ru,this.ss=function(t,e){return new gc(t,e)}(this.os,t=>this.Dr.Tl(t)),this.serializer=new Va(e),this.Xo=new wc(this.serializer)}start(){return Promise.resolve()}Ic(){return this.Ko=!1,Promise.resolve()}get lr(){return this.Ko}rc(){}oc(){}vc(){return this.os}gc(t){let e=this.El[t.i()];return e||(e=new pc(this.os,this.Dr),this.El[t.i()]=e),e}yc(){return this.Yo}bc(){return this.ss}Sc(){return this.Xo}runTransaction(t,e,n){_s("MemoryPersistence","Starting transaction:",t);const s=new bc(this.Uo.next());return this.Dr.Il(),n(s).next(t=>this.Dr.ml(s).next(()=>t)).Ln().then(t=>(s.ns(),t))}Al(t,e){return ta.Un(Object.values(this.El).map(n=>()=>n.zr(t,e)))}}class bc extends oa{constructor(t){super(),this.Lo=t}}class Ic{constructor(t){this.persistence=t,this.Rl=new Ch,this.Pl=null}static Vl(t){return new Ic(t)}get gl(){if(this.Pl)return this.Pl;throw ks()}ko(t,e,n){return this.Rl.ko(n,e),this.gl.delete(n.toString()),ta.resolve()}Fo(t,e,n){return this.Rl.Fo(n,e),this.gl.add(n.toString()),ta.resolve()}jr(t,e){return this.gl.add(e.toString()),ta.resolve()}removeTarget(t,e){this.Rl.Ia(e.targetId).forEach(t=>this.gl.add(t.toString()));const n=this.persistence.yc();return n.$o(t,e.targetId).next(t=>{t.forEach(t=>this.gl.add(t.toString()))}).next(()=>n.Do(t,e))}Il(){this.Pl=new Set}ml(t){const e=this.persistence.bc().io();return ta.forEach(this.gl,n=>{const s=Ws.tt(n);return this.yl(t,s).next(t=>{t||e.Hn(s)})}).next(()=>(this.Pl=null,e.apply(t)))}Mc(t,e){return this.yl(t,e).next(t=>{t?this.gl.delete(e.toString()):this.gl.add(e.toString())})}Tl(t){return 0}yl(t,e){return ta.Un([()=>ta.resolve(this.Rl.zr(e)),()=>this.persistence.yc().zr(t,e),()=>this.persistence.Al(t,e)])}}class Ec{constructor(t){this.pl=t.pl,this.bl=t.bl}lu(t){this.vl=t}ou(t){this.Sl=t}onMessage(t){this.Dl=t}close(){this.bl()}send(t){this.pl(t)}Cl(){this.vl()}Nl(t){this.Sl(t)}xl(t){this.Dl(t)}}const _c={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Tc extends class{constructor(t){this.Ml=t,this.rt=t.rt;const e=t.ssl?"https":"http";this.kl=e+"://"+t.host,this.Ol="projects/"+this.rt.projectId+"/databases/"+this.rt.database+"/documents"}gu(t,e,n,s){const i=this.Fl(t,e);_s("RestConnection","Sending: ",i,n);const r={};return this.$l(r,s),this.Ll(t,i,r,n).then(t=>(_s("RestConnection","Received: ",t),t),e=>{throw As("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})}yu(t,e,n,s){return this.gu(t,e,n,s)}$l(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.1.1",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}Fl(t,e){const n=_c[t];return`${this.kl}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.ot=t.ot}Ll(t,e,n,s){return new Promise((i,r)=>{const o=new vs;o.listenOnce(gs.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case ps.NO_ERROR:const e=o.getResponseJson();_s("Connection","XHR received:",JSON.stringify(e)),i(e);break;case ps.TIMEOUT:_s("Connection",'RPC "'+t+'" timed out'),r(new Os(Ss.DEADLINE_EXCEEDED,"Request time out"));break;case ps.HTTP_ERROR:const n=o.getStatus();if(_s("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Ss).indexOf(e)>=0?e:Ss.UNKNOWN}(t.status);r(new Os(e,t.message))}else r(new Os(Ss.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Os(Ss.UNAVAILABLE,"Connection failed."));break;default:ks()}}finally{_s("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(s);o.send(e,"POST",a,n,15)})}_u(t,e){const n=[this.kl,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=fs(),r=ds(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.rt.projectId}/databases/${this.rt.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.ot};var a,u;this.$l(o.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product||s().indexOf("Electron/")>=0||((u=s()).indexOf("MSIE ")>=0||u.indexOf("Trident/")>=0)||s().indexOf("MSAppHost/")>=0||"object"==typeof(a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==a.id||(o.httpHeadersOverwriteParam="$httpHeaders");const h=n.join("");_s("Connection","Creating WebChannel: "+h,o);const c=i.createWebChannel(h,o);let l=!1,f=!1;const d=new Ec({pl:t=>{f?_s("Connection","Not sending because WebChannel is closed:",t):(l||(_s("Connection","Opening WebChannel transport."),c.open(),l=!0),_s("Connection","WebChannel sending:",t),c.send(t))},bl:()=>c.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(c,ws.EventType.OPEN,()=>{f||_s("Connection","WebChannel transport opened.")}),p(c,ws.EventType.CLOSE,()=>{f||(f=!0,_s("Connection","WebChannel transport closed"),d.Nl())}),p(c,ws.EventType.ERROR,t=>{f||(f=!0,As("Connection","WebChannel transport errored:",t),d.Nl(new Os(Ss.UNAVAILABLE,"The operation could not be completed")))}),p(c,ws.EventType.MESSAGE,t=>{var e;if(!f){const n=t.data[0];xs(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){_s("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=ui[t];if(void 0!==e)return li(e)}(t),n=i.message;void 0===e&&(e=Ss.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),f=!0,d.Nl(new Os(e,n)),c.close()}else _s("Connection","WebChannel received:",n),d.xl(n)}}),p(r,ms.STAT_EVENT,t=>{t.stat===ys.PROXY?_s("Connection","Detected buffering proxy"):t.stat===ys.NOPROXY&&_s("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.Cl()},0),d}}class Ac{constructor(){this.Bl=(()=>this.ql()),this.Ul=(()=>this.Kl()),this.Ql=[],this.Wl()}Ku(t){this.Ql.push(t)}Ic(){window.removeEventListener("online",this.Bl),window.removeEventListener("offline",this.Ul)}Wl(){window.addEventListener("online",this.Bl),window.addEventListener("offline",this.Ul)}ql(){_s("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Ql)t(0)}Kl(){_s("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Ql)t(1)}static Gs(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}class Nc{Ku(t){}Ic(){}}class kc{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=sa(t.Ml.rt),this.Bh=this.jl(t),this.persistence=this.Gl(t),await this.persistence.start(),this.zl=this.Hl(t),this.ku=this.Jl(t)}Hl(t){return null}Jl(t){return Gu(this.persistence,new Oa,t.Yl,this.serializer)}Gl(t){return new vc(Ic.Vl,this.serializer)}jl(t){return new $h}async terminate(){this.zl&&this.zl.stop(),await this.Bh.Ic(),await this.persistence.Ic()}}class xc extends kc{constructor(t,e,n){super(),this.Xl=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=Ds(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>(function(t){const e=nu(t);let n=zs.min();return e._i({index:gu.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=Fa(e.readTime)),s.done()}).next(()=>n)})(t)).then(t=>{e.$c=t})}(this.ku),await this.Xl.initialize(this,t),await dc(this.Xl.ba),await vh(this.Xl.$h)}Jl(t){return Gu(this.persistence,new Oa,t.Yl,this.serializer)}Hl(t){const e=this.persistence.Dr.cr;return new Da(e,t.di)}Gl(t){const e=zu(t.Ml.rt,t.Ml.persistenceKey),n=void 0!==this.cacheSizeBytes?xa.er(this.cacheSizeBytes):xa.ir;return new Uu(this.synchronizeTabs,e,t.clientId,n,t.di,ba(),Ia(),this.serializer,this.Bh,!!this.forceOwnership)}jl(t){return new $h}}class Dc extends xc{constructor(t,e){super(t,e,!1),this.Xl=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Xl.ba;this.Bh instanceof zh&&(this.Bh.ba={Eh:async function(t,e,n,s){const i=Ds(t),r=await function(t,e){const n=Ds(t),s=Ds(n.rs);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.$r(t,e).next(e=>e?n.Bc._s(t,e):ta.resolve(null)))}(i.ku,e);null!==r?("pending"===n?await vh(i.$h):"acknowledged"===n||"rejected"===n?(nc(i,e,s||null),ec(i,e),function(t,e){Ds(Ds(t).rs).Wr(e)}(i.ku,e)):ks(),await uc(i,r)):_s("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),Th:async function(t,e,n,s){const i=Ds(t);if(i.Xh)_s("SyncEngine","Ignoring unexpected query state notification.");else if(i.Qh.has(e))switch(n){case"current":case"not-current":{const t=await Zu(i.ku),s=Si.ae(e,"current"===n);await uc(i,t,s);break}case"rejected":await Xu(i.ku,e,!0),sc(i,e,s);break;default:ks()}}.bind(null,e),Ih:async function(t,e,n){const s=fc(t);if(s.Xh){for(const t of e){if(s.Qh.has(t)){_s("SyncEngine","Adding an already active target "+t);continue}const e=await Ju(s.ku,t),n=await Yu(s.ku,e);await Qh(s,lc(e),n.targetId,!1),hh(s.$h,n)}for(const t of n)s.Qh.has(t)&&await Xu(s.ku,t,!1).then(()=>{ch(s.$h,t),sc(s,t)}).catch(th)}}.bind(null,e),Vc:function(t){return Ds(Ds(Ds(t).ku).persistence).Vc()}.bind(null,e),wh:async function(t){const e=Ds(t);return Zu(e.ku).then(t=>uc(e,t))}.bind(null,e)},await this.Bh.start()),await this.persistence.ic(async t=>{await async function(t,e){const n=Ds(t);if(fc(n),dc(n),!0===e&&!0!==n.Xh){const t=n.Bh.Ua(),e=await cc(n,t.W());n.Xh=!0,await Th(n.$h,!0);for(const t of e)hh(n.$h,t)}else if(!1===e&&!1!==n.Xh){const t=[];let e=Promise.resolve();n.Qh.forEach((s,i)=>{n.Bh.Xa(i)?t.push(i):e=e.then(()=>(sc(n,i),Xu(n.ku,i,!0))),ch(n.$h,i)}),await e,await cc(n,t),function(t){const e=Ds(n);e.Gh.forEach((t,n)=>{ch(e.$h,n)}),e.zh.ma(),e.Gh=new Map,e.jh=new fi(Ws.k)}(),n.Xh=!1,await Th(n.$h,!1)}}(this.Xl.ba,t),this.zl&&(t&&!this.zl.lr?this.zl.start(this.ku):t||this.zl.stop())})}jl(t){const e=ba();if(!zh.Gs(e))throw new Os(Ss.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=zu(t.Ml.rt,t.Ml.persistenceKey);return new zh(e,t.di,n,t.clientId,t.Yl)}}class Sc{async initialize(t,e){this.ku||(this.ku=t.ku,this.Bh=t.Bh,this.Ou=this.Zl(e),this.$h=this.t_(e),this.Lh=this.e_(e),this.ba=this.n_(e,!t.synchronizeTabs),this.Bh.pu=(t=>Zh(this.ba,t,1)),this.$h.Fu.s_=async function(t,e){const n=Ds(t);if(!n.currentUser.isEqual(e)){_s("SyncEngine","User change. New user:",e.i());const t=await Hu(n.ku,e);n.currentUser=e,function(t,e){t.Jh.forEach(t=>{t.forEach(t=>{t.reject(new Os(Ss.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Jh.clear()}(n),n.Bh.nh(e,t.Uc,t.Kc),await uc(n,t.qc)}}.bind(null,this.ba),await Th(this.$h,this.ba.Zh))}e_(t){return new xh}Zl(t){const e=sa(t.Ml.rt),n=(s=t.Ml,new Tc(s));var s;return function(t,e,n){return new ih(t,e,n)}(t.credentials,n,e)}t_(t){return e=this.ku,n=this.Ou,s=t.di,i=(t=>Zh(this.ba,t,0)),r=Ac.Gs()?new Ac:new Nc,new oh(e,n,s,i,r);var e,n,s,i,r}n_(t,e){return function(t,e,n,s,i,r,o){const a=new Xh(t,e,n,s,i,r);return o&&(a.Xh=!0),a}(this.ku,this.$h,this.Lh,this.Bh,t.Yl,t.qh,e)}terminate(){return async function(t){const e=Ds(t);_s("RemoteStore","RemoteStore shutting down."),e.Bu.add(5),await uh(e),e.Uu.Ic(),e.Qu.set("Unknown")}(this.$h)}}class Oc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.i_(this.observer.next,t)}error(t){this.observer.error?this.i_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}r_(){this.muted=!0}i_(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}function Rc(t,e,n){if(!n)throw new Os(Ss.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Cc(t){if(!Ws.st(t))throw new Os(Ss.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Lc(t){if(Ws.st(t))throw new Os(Ss.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Pc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":ks()}function Vc(t,e){if("_delegate"in t&&(t=t.o_),!(t instanceof e)){if(e.name===t.constructor.name)throw new Os(Ss.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Pc(t);throw new Os(Ss.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Mc(t,e){if(e<=0)throw new Os(Ss.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Uc{constructor(t){this._methodName=t}}class qc extends Uc{c_(t){if(2!==t.u_)throw 1===t.u_?t.a_(this._methodName+"() can only appear at the top level of your update data"):t.a_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.en.push(t.path),null}isEqual(t){return t instanceof qc}}function Fc(t,e,n){return new Ml({u_:3,h_:e.settings.h_,methodName:t._methodName,l_:n},e.rt,e.serializer,e.ignoreUndefinedProperties)}class Bc extends Uc{c_(t){return new Kr(t.path,new Ur)}isEqual(t){return t instanceof Bc}}class jc extends Uc{constructor(t,e){super(t),this.__=e}c_(t){const e=Fc(this,t,!0),n=this.__.map(t=>zl(t,e)),s=new qr(n);return new Kr(t.path,s)}isEqual(t){return this===t}}class zc extends Uc{constructor(t,e){super(t),this.__=e}c_(t){const e=Fc(this,t,!0),n=this.__.map(t=>zl(t,e)),s=new Br(n);return new Kr(t.path,s)}isEqual(t){return this===t}}class $c extends Uc{constructor(t,e){super(t),this.f_=e}c_(t){const e=new zr(t.serializer,lr(t.serializer,this.f_));return new Kr(t.path,e)}isEqual(t){return this===t}}class Gc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Os(Ss.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Os(Ss.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.d_=t,this.w_=e}get latitude(){return this.d_}get longitude(){return this.w_}isEqual(t){return this.d_===t.d_&&this.w_===t.w_}toJSON(){return{latitude:this.d_,longitude:this.w_}}v(t){return qs(this.d_,t.d_)||qs(this.w_,t.w_)}}class Hc{constructor(t){this.E_=t}static fromBase64String(t){try{return new Hc(ri.fromBase64String(t))}catch(t){throw new Os(Ss.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Hc(ri.fromUint8Array(t))}toBase64(){return this.E_.toBase64()}toUint8Array(){return this.E_.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.E_.isEqual(t.E_)}}class Kc{constructor(t){this.o_=t}}const Wc=new Map;class Yc{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Os(Ss.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Os(Ss.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,function(t,e,n,s){if(!0===e&&!0===s)throw new Os(Ss.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties}}class Xc{constructor(t,e){this.T_="(lite)",this.I_=new Yc({}),this.m_=!1,t instanceof Xs?(this.A_=t,this.R_=new Cs):(this.P_=t,this.A_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Os(Ss.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xs(t.options.projectId)}(t),this.R_=new Ls(e))}get app(){if(!this.P_)throw new Os(Ss.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.P_}get V_(){return this.m_}get g_(){return void 0!==this.y_}p_(t){if(this.m_)throw new Os(Ss.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.I_=new Yc(t),void 0!==t.credentials&&(this.R_=function(t){if(!t)return new Cs;switch(t.type){case"gapi":const e=t.client;return xs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Vs(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Os(Ss.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}b_(){return this.I_}v_(){return this.m_=!0,this.I_}_delete(){return this.y_||(this.y_=this.S_()),this.y_}S_(){return function(t){const e=Wc.get(t);e&&(_s("ComponentProvider","Removing Datastore"),Wc.delete(t),e.terminate())}(this),Promise.resolve()}}class Qc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Os(Ss.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.D_=new Ks(t)}isEqual(t){return this.D_.isEqual(t.D_)}}class Jc extends fl{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this.C_=t,this.N_=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this.x_){if(this.M_){const e=new Zc(this.C_,this.k_,this.O_,this.x_,this.metadata,null);return this.M_.fromFirestore(e,t)}return this.k_.F_(this.x_.En(),t.serverTimestamps)}}get(t,e={}){if(this.x_){const n=this.x_.data().field(pl("DocumentSnapshot.get",t));if(null!==n)return this.k_.F_(n,e.serverTimestamps)}}}class Zc extends Jc{data(t={}){return super.data(t)}}class tl{constructor(t,e,n,s){this.C_=t,this.k_=e,this.L_=s,this.metadata=new hl(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.L_.docs.size}get empty(){return 0===this.size}forEach(t,e){this.L_.docs.forEach(n=>{t.call(e,new Zc(this.C_,this.k_,n.key,n,new hl(this.L_.ee.has(n.key),this.L_.fromCache),this.query.M_))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.L_.se)throw new Os(Ss.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.B_&&this.q_===e||(this.B_=function(t,e){if(t.L_.te.q()){let e,n=0;return t.L_.docChanges.map(s=>{const i=new Zc(t.C_,t.k_,s.doc.key,s.doc,new hl(t.L_.ee.has(s.doc.key),t.L_.fromCache),t.query.M_);return e=s.doc,{type:"added",doc:i,oldIndex:-1,newIndex:n++}})}{let n=t.L_.te;return t.L_.docChanges.filter(t=>e||3!==t.type).map(e=>{const s=new Zc(t.C_,t.k_,e.doc.key,e.doc,new hl(t.L_.ee.has(e.doc.key),t.L_.fromCache),t.query.M_);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(r=(n=n.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ks()}}(e.type),doc:s,oldIndex:i,newIndex:r}})}}(this,e),this.q_=e),this.B_}}class el extends ll{constructor(t){super(),this.firestore=t}U_(t){return new Hc(t)}K_(t){const e=this.Q_(t,this.firestore.A_);return new gl(this.firestore,null,e)}}function nl(t,e){return function(t,e){const n=new na;return t.di.Ri(async()=>(async function(t,e,n){const s=dc(t);try{const i=await function(t,e){const n=Ds(t),s=js.now(),i=e.reduce((t,e)=>t.add(e.key),Ti());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.Bc._s(t,i).next(i=>{r=i;const o=[];for(const t of e){const e=to(t,r.get(t.key));null!=e&&o.push(new io(t.key,e,po(e.proto.mapValue),Yr.exists(!0)))}return n.rs.kr(t,s,o,e)})).then(t=>{const e=t.bn(r);return{batchId:t.batchId,Kn:e}})}(s.ku,e);s.Bh.Wa(i.batchId),function(t,e,n){let s=t.Hh[t.currentUser.i()];s||(s=new fi(qs)),s=s.Tt(e,n),t.Hh[t.currentUser.i()]=s}(s,i.batchId,n),await uc(s,i.Kn),await vh(s.$h)}catch(t){const e=Ta(t,"Failed to persist write");n.reject(e)}})(await hf(t),e,n)),n.promise}(al(t),e)}function sl(t,e,n){const s=n.docs.get(e.O_),i=new el(t);return new Jc(t,i,e.O_,s,new hl(n.hasPendingWrites,n.fromCache),e.M_)}class il{constructor(t,e){this.C_=t,this.G_=e,this.z_=[],this.H_=!1,this.J_=Rl(t)}set(t,e,n){this.Y_();const s=rl(t,this.C_),i=cl(s.M_,e,n),r=ql(this.J_,"WriteBatch.set",s.O_,i,null!==s.M_,n);return this.z_=this.z_.concat(r.j_(s.O_,Yr.on())),this}update(t,e,n,...s){this.Y_();const i=rl(t,this.C_);let r;return e instanceof Kc&&(e=e.o_),r="string"==typeof e||e instanceof Qc?Bl(this.J_,"WriteBatch.update",i.O_,e,n,s):Fl(this.J_,"WriteBatch.update",i.O_,e),this.z_=this.z_.concat(r.j_(i.O_,Yr.exists(!0))),this}delete(t){this.Y_();const e=rl(t,this.C_);return this.z_=this.z_.concat(new ho(e.O_,Yr.on())),this}commit(){return this.Y_(),this.H_=!0,this.z_.length>0?this.G_(this.z_):Promise.resolve()}Y_(){if(this.H_)throw new Os(Ss.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function rl(t,e){if(t instanceof Kc&&(t=t.o_),t.firestore!==e)throw new Os(Ss.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class ol extends class{constructor(t,e){this.C_=t,this.X_=e,this.J_=Rl(t)}get(t){const e=rl(t,this.C_),n=new Sl(this.C_);return this.X_.Z_([e.O_]).then(t=>{if(!t||1!==t.length)return ks();const s=t[0];if(s instanceof yo)return new fl(this.C_,n,e.O_,null,e.M_);if(s instanceof mo)return new fl(this.C_,n,s.key,s,e.M_);throw ks()})}set(t,e,n){const s=rl(t,this.C_),i=cl(s.M_,e,n),r=ql(this.J_,"Transaction.set",s.O_,i,null!==s.M_,n);return this.X_.set(s.O_,r),this}update(t,e,n,...s){const i=rl(t,this.C_);let r;return e instanceof Kc&&(e=e.o_),r="string"==typeof e||e instanceof Qc?Bl(this.J_,"Transaction.update",i.O_,e,n,s):Fl(this.J_,"Transaction.update",i.O_,e),this.X_.update(i.O_,r),this}delete(t){const e=rl(t,this.C_);return this.X_.delete(e.O_),this}}{constructor(t,e){super(t,e),this.C_=t}get(t){const e=rl(t,this.C_),n=new el(this.C_);return super.get(t).then(t=>new Jc(this.C_,n,e.O_,t.x_,new hl(!1,!1),e.M_))}}function al(t){return t.tf||ul(t),t.tf.ef(),t.tf}function ul(t){const e=t.v_(),n=function(t,e,n){return new Ys(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.A_,t.T_,e);t.tf=new tf(t.R_,t.nf,n)}class hl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}function cl(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class ll{F_(t,e="none"){switch(Gi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ji(t.integerValue||t.doubleValue);case 3:return this.sf(t.timestampValue);case 4:return this.rf(t,e);case 5:return t.stringValue;case 6:return this.U_(Zi(t.bytesValue));case 7:return this.K_(t.referenceValue);case 8:return this.cf(t.geoPointValue);case 9:return this.uf(t.arrayValue,e);case 10:return this.af(t.mapValue,e);default:throw ks()}}af(t,e){const n={};return Fi(t.fields||{},(t,s)=>{n[t]=this.F_(s,e)}),n}cf(t){return new Gc(Ji(t.latitude),Ji(t.longitude))}uf(t,e){return(t.values||[]).map(t=>this.F_(t,e))}rf(t,e){switch(e){case"previous":const n=function t(e){const n=e.mapValue.fields.__previous_value__;return ji(n)?t(n):n}(t);return null==n?null:this.F_(n,e);case"estimate":return this.sf(zi(t));default:return null}}sf(t){const e=Qi(t);return new js(e.seconds,e.nanos)}Q_(t,e){const n=Gs.G(t);xs(Cr(n));const s=new Xs(n.get(1),n.get(3)),i=new Ws(n.F(5));return s.isEqual(e)||Ts(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class fl{constructor(t,e,n,s,i){this.C_=t,this.k_=e,this.O_=n,this.x_=s,this.M_=i}get id(){return this.O_.path.B()}get ref(){return new gl(this.C_,this.M_,this.O_)}exists(){return null!==this.x_}data(){if(this.x_){if(this.M_){const t=new dl(this.C_,this.k_,this.O_,this.x_,null);return this.M_.fromFirestore(t)}return this.k_.F_(this.x_.En())}}get(t){if(this.x_){const e=this.x_.data().field(pl("DocumentSnapshot.get",t));if(null!==e)return this.k_.F_(e)}}}class dl extends fl{data(){return super.data()}}function pl(t,e){return"string"==typeof e?Yl(t,e):e instanceof Kc?e.o_.D_:e.D_}class gl{constructor(t,e,n){this.M_=e,this.O_=n,this.type="document",this.firestore=t}get hf(){return this.O_.path}get id(){return this.O_.path.B()}get path(){return this.O_.path.j()}get parent(){return new xl(this.firestore,this.M_,this.O_.path.$())}withConverter(t){return new gl(this.firestore,t,this.O_)}}class ml{constructor(t,e,n){this.M_=e,this.W_=n,this.type="query",this.firestore=t}withConverter(t){return new ml(this.firestore,t,this.W_)}}class yl{}class wl extends yl{constructor(t,e,n){super(),this._f=t,this.ff=e,this.df=n,this.type="where"}lf(t){const e=Rl(t.firestore),n=function(t,e,n,s,i,r,o){let a;if(i.Y()){if("array-contains"===r||"array-contains-any"===r)throw new Os(Ss.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on FieldPath.documentId().`);if("in"===r||"not-in"===r){Al(o,r);const e=[];for(const n of o)e.push(Tl(s,t,n));a={arrayValue:{values:e}}}else a=Tl(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||Al(o,r),a=jl(n,"where",o,"in"===r||"not-in"===r);const u=Po.create(i,r,a);return function(t,e){if(e.An()){const n=Ao(t);if(null!==n&&!n.isEqual(e.field))throw new Os(Ss.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=To(t);null!==s&&Nl(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new Os(Ss.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Os(Ss.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t.W_,0,e,t.firestore.A_,this._f,this.ff,this.df);return new ml(t.firestore,t.M_,function(t,e){const n=t.filters.concat([e]);return new vo(t.path,t.collectionGroup,t.Tn.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.W_,n))}}class vl extends yl{constructor(t,e){super(),this._f=t,this.wf=e,this.type="orderBy"}lf(t){const e=function(t,e,n){if(null!==t.startAt)throw new Os(Ss.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Os(Ss.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Wo(e,n);return function(t,e){if(null===To(t)){const n=Ao(t);null!==n&&Nl(t,n,e.field)}}(t,s),s}(t.W_,this._f,this.wf);return new ml(t.firestore,t.M_,function(t,e){const n=t.Tn.concat([e]);return new vo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.W_,e))}}class bl extends yl{constructor(t,e,n){super(),this.type=t,this.Ef=e,this.Tf=n}lf(t){return new ml(t.firestore,t.M_,Do(t.W_,this.Ef,this.Tf))}}class Il extends yl{constructor(t,e,n){super(),this.type=t,this.If=e,this.mf=n}lf(t){const e=_l(t,this.type,this.If,this.mf);return new ml(t.firestore,t.M_,function(t,e){return new vo(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.W_,e))}}class El extends yl{constructor(t,e,n){super(),this.type=t,this.If=e,this.mf=n}lf(t){const e=_l(t,this.type,this.If,this.mf);return new ml(t.firestore,t.M_,function(t,e){return new vo(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.W_,e))}}function _l(t,e,n,s){if(n[0]instanceof Kc&&(n[0]=n[0].o_),n[0]instanceof fl)return function(t,e,n,s,i){if(!s)throw new Os(Ss.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const r=[];for(const n of ko(t))if(n.field.Y())r.push(tr(e,s.key));else{const t=s.field(n.field);if(ji(t))throw new Os(Ss.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.j();throw new Os(Ss.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new $o(r,i)}(t.W_,t.firestore.A_,e,n[0].x_,s);{const i=Rl(t.firestore);return function(t,e,n,s,i,r){const o=t.Tn;if(i.length>o.length)throw new Os(Ss.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let r=0;r<i.length;r++){const u=i[r];if(o[r].field.Y()){if("string"!=typeof u)throw new Os(Ss.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof u}`);if(!No(t)&&-1!==u.indexOf("/"))throw new Os(Ss.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(Gs.G(u));if(!Ws.st(n))throw new Os(Ss.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Ws(n);a.push(tr(e,i))}else{const t=jl(n,s,u);a.push(t)}}return new $o(a,r)}(t.W_,t.firestore.A_,i,e,n,s)}}function Tl(t,e,n){if(n instanceof Kc&&(n=n.o_),"string"==typeof n){if(""===n)throw new Os(Ss.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!No(e)&&-1!==n.indexOf("/"))throw new Os(Ss.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Gs.G(n));if(!Ws.st(s))throw new Os(Ss.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return tr(t,new Ws(s))}if(n instanceof gl)return tr(t,n.O_);throw new Os(Ss.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Pc(n)+".")}function Al(t,e){if(!Array.isArray(t)||0===t.length)throw new Os(Ss.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Os(Ss.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Nl(t,e,n){if(!n.isEqual(e))throw new Os(Ss.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function kl(t){if(_o(t)&&0===t.Tn.length)throw new Os(Ss.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xl extends ml{constructor(t,e,n){super(t,e,Io(n)),this.firestore=t,this.hf=n,this.type="collection"}get id(){return this.W_.path.B()}get path(){return this.W_.path.j()}get parent(){const t=this.hf.$();return t.q()?null:new gl(this.firestore,null,new Ws(t))}withConverter(t){return new xl(this.firestore,t,this.hf)}}function Dl(t,e,...n){if(t instanceof Kc&&(t=t.o_),1===arguments.length&&(e=Us.p()),Rc("doc","path",e),t instanceof Xc){const s=Gs.G(e,...n);return Cc(s),new gl(t,null,new Ws(s))}{if(!(t instanceof gl||t instanceof xl))throw new Os(Ss.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t.hf.child(Gs.G(e,...n));return Cc(s),new gl(t.firestore,t instanceof xl?t.M_:null,new Ws(s))}}class Sl extends ll{constructor(t){super(),this.firestore=t}U_(t){return new Hc(t)}K_(t){const e=this.Q_(t,this.firestore.A_);return new gl(this.firestore,null,e)}}function Ol(t,e){return t instanceof Kc&&(t=t.o_),e instanceof Kc&&(e=e.o_),t instanceof ml&&e instanceof ml&&t.firestore===e.firestore&&So(t.W_,e.W_)&&t.M_===e.M_}function Rl(t){const e=t.v_(),n=sa(t.A_);return new Ul(t.A_,!!e.ignoreUndefinedProperties,n)}const Cl=/^__.*__$/;class Ll{constructor(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}j_(t,e){const n=[];return null!==this.en?n.push(new io(t,this.data,this.en,e)):n.push(new so(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new oo(t,this.fieldTransforms)),n}}class Pl{constructor(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}j_(t,e){const n=[new io(t,this.data,this.en,e)];return this.fieldTransforms.length>0&&n.push(new oo(t,this.fieldTransforms)),n}}function Vl(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ks()}}class Ml{constructor(t,e,n,s,i,r){this.settings=t,this.rt=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.Af(),this.fieldTransforms=i||[],this.en=r||[]}get path(){return this.settings.path}get u_(){return this.settings.u_}Rf(t){return new Ml(Object.assign(Object.assign({},this.settings),t),this.rt,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.en)}Pf(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Rf({path:n,l_:!1});return s.Vf(t),s}gf(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Rf({path:n,l_:!1});return s.Af(),s}yf(t){return this.Rf({path:void 0,l_:!0})}a_(t){return Xl(t,this.settings.methodName,this.settings.pf||!1,this.path,this.settings.h_)}contains(t){return void 0!==this.en.find(e=>t.U(e))||void 0!==this.fieldTransforms.find(e=>t.U(e.field))}Af(){if(this.path)for(let t=0;t<this.path.length;t++)this.Vf(this.path.get(t))}Vf(t){if(0===t.length)throw this.a_("Document fields must not be empty");if(Vl(this.u_)&&Cl.test(t))throw this.a_('Document fields cannot begin and end with "__"')}}class Ul{constructor(t,e,n){this.rt=t,this.ignoreUndefinedProperties=e,this.serializer=n||sa(t)}bf(t,e,n,s=!1){return new Ml({u_:t,methodName:e,h_:n,path:Ks.H(),l_:!1,pf:s},this.rt,this.serializer,this.ignoreUndefinedProperties)}}function ql(t,e,n,s,i,r={}){const o=t.bf(r.merge||r.mergeFields?2:0,e,n,i);Hl("Data must be an object, but it was:",o,s);const a=$l(s,o);let u,h;if(r.merge)u=new Hr(o.en),h=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=Kl(e,s,n);if(!o.contains(i))throw new Os(Ss.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ql(t,i)||t.push(i)}u=new Hr(t),h=o.fieldTransforms.filter(t=>u.un(t.field))}else u=null,h=o.fieldTransforms;return new Ll(new lo(a),u,h)}function Fl(t,e,n,s){const i=t.bf(1,e,n);Hl("Data must be an object, but it was:",i,s);const r=[],o=new fo;Fi(s,(t,s)=>{const a=Yl(e,t,n);s instanceof Kc&&(s=s.o_);const u=i.gf(a);if(s instanceof qc)r.push(a);else{const t=zl(s,u);null!=t&&(r.push(a),o.set(a,t))}});const a=new Hr(r);return new Pl(o.hn(),a,i.fieldTransforms)}function Bl(t,e,n,s,i,r){const o=t.bf(1,e,n),a=[Kl(e,s,n)],u=[i];if(r.length%2!=0)throw new Os(Ss.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(Kl(e,r[t])),u.push(r[t+1]);const h=[],c=new fo;for(let t=a.length-1;t>=0;--t)if(!Ql(h,a[t])){const e=a[t];let n=u[t];n instanceof Kc&&(n=n.o_);const s=o.gf(e);if(n instanceof qc)h.push(e);else{const t=zl(n,s);null!=t&&(h.push(e),c.set(e,t))}}const l=new Hr(h);return new Pl(c.hn(),l,o.fieldTransforms)}function jl(t,e,n,s=!1){return zl(n,t.bf(s?4:3,e))}function zl(t,e){if(t instanceof Kc&&(t=t.o_),Gl(t))return Hl("Unsupported field value:",e,t),$l(t,e);if(t instanceof Uc)return function(t,e){if(!Vl(e.u_))throw e.a_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.a_(t._methodName+"() is not currently supported inside arrays");const n=t.c_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.en.push(e.path),t instanceof Array){if(e.settings.l_&&4!==e.u_)throw e.a_("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=zl(i,e.yf(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof Kc&&(t=t.o_),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return lr(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=js.fromDate(t);return{timestampValue:fr(e.serializer,n)}}if(t instanceof js){const n=new js(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:fr(e.serializer,n)}}if(t instanceof Gc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Hc)return{bytesValue:dr(e.serializer,t.E_)};if(t instanceof gl){const n=e.rt,s=t.firestore.A_;if(!s.isEqual(n))throw e.a_(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:gr(t.firestore.A_||e.rt,t.O_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.a_("Unsupported field value: "+Pc(t))}(t,e)}function $l(t,e){const n={};return Bi(t)?e.path&&e.path.length>0&&e.en.push(e.path):Fi(t,(t,s)=>{const i=zl(s,e.Pf(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Gl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof js||t instanceof Gc||t instanceof Hc||t instanceof gl||t instanceof Uc)}function Hl(t,e,n){if(!Gl(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=Pc(n);throw"an object"===s?e.a_(t+" a custom object"):e.a_(t+" "+s)}}function Kl(t,e,n){if(e instanceof Kc&&(e=e.o_),e instanceof Qc)return e.D_;if("string"==typeof e)return Yl(t,e);throw Xl("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const Wl=new RegExp("[~\\*/\\[\\]]");function Yl(t,e,n){if(e.search(Wl)>=0)throw Xl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Qc(...e.split(".")).D_}catch(s){throw Xl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Xl(t,e,n,s,i){const r=s&&!s.q(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(r||o)&&(u+=" (found",r&&(u+=" in field "+s),o&&(u+=" in document "+i),u+=")"),new Os(Ss.INVALID_ARGUMENT,a+t+u)}function Ql(t,e){return t.some(t=>t.isEqual(e))}class Jl{constructor(t){this.Ou=t,this.vf=new Map,this.mutations=[],this.Sf=!1,this.Df=null,this.Cf=new Set}async Z_(t){if(this.Nf(),this.mutations.length>0)throw new Os(Ss.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Ds(t),s=Ir(n.serializer)+"/documents",i={documents:e.map(t=>yr(n.serializer,t))},r=await n.yu("BatchGetDocuments",s,i),o=new Map;r.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){xs(!!e.found),e.found.name,e.found.updateTime;const n=wr(t,e.found.name),s=pr(e.found.updateTime),i=new lo({mapValue:{fields:e.found.fields}});return new mo(n,s,i,{})}(t,e):"missing"in e?function(t,e){xs(!!e.missing),xs(!!e.readTime);const n=wr(t,e.missing),s=pr(e.readTime);return new yo(n,s)}(t,e):ks()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());xs(!!e),a.push(e)}),a}(this.Ou,t);return e.forEach(t=>{t instanceof yo||t instanceof mo?this.xf(t):ks()}),e}set(t,e){this.write(e.j_(t,this.rn(t))),this.Cf.add(t.toString())}update(t,e){try{this.write(e.j_(t,this.Mf(t)))}catch(t){this.Df=t}this.Cf.add(t.toString())}delete(t){this.write([new ho(t,this.rn(t))]),this.Cf.add(t.toString())}async commit(){if(this.Nf(),this.Df)throw this.Df;const t=this.vf;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=Ws.tt(e);this.mutations.push(new co(n,this.rn(n)))}),await async function(t,e){const n=Ds(t),s=Ir(n.serializer)+"/documents",i={writes:e.map(t=>Tr(n.serializer,t))};await n.gu("Commit",s,i)}(this.Ou,this.mutations),this.Sf=!0}xf(t){let e;if(t instanceof mo)e=t.version;else{if(!(t instanceof yo))throw ks();e=zs.min()}const n=this.vf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Os(Ss.ABORTED,"Document version changed between two reads.")}else this.vf.set(t.key.toString(),e)}rn(t){const e=this.vf.get(t.toString());return!this.Cf.has(t.toString())&&e?Yr.updateTime(e):Yr.on()}Mf(t){const e=this.vf.get(t.toString());if(!this.Cf.has(t.toString())&&e){if(e.isEqual(zs.min()))throw new Os(Ss.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Yr.updateTime(e)}return Yr.exists(!0)}write(t){this.Nf(),this.mutations=this.mutations.concat(t)}Nf(){}}class Zl{constructor(t,e,n,s){this.di=t,this.Ou=e,this.updateFunction=n,this.Ti=s,this.kf=5,this.Si=new ca(this.di,"transaction_retry")}run(){this.Of()}Of(){this.Si.Bs(async()=>{const t=new Jl(this.Ou),e=this.Ff(t);e&&e.then(e=>{this.di.Ri(()=>t.commit().then(()=>{this.Ti.resolve(e)}).catch(t=>{this.$f(t)}))}).catch(t=>{this.$f(t)})})}Ff(t){try{const e=this.updateFunction(t);return!Qs(e)&&e.catch&&e.then?e:(this.Ti.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ti.reject(t),null}}$f(t){this.kf>0&&this.Lf(t)?(this.kf-=1,this.di.Ri(()=>(this.Of(),Promise.resolve()))):this.Ti.reject(t)}Lf(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!ci(e)}return!1}}class tf{constructor(t,e,n){this.credentials=t,this.di=e,this.Ml=n,this.user=bs.UNAUTHENTICATED,this.clientId=Us.p(),this.Bf=(()=>{}),this.A=new na,this.credentials.T(t=>{_s("FirestoreClient","Received user=",t.uid),this.user.isEqual(t)||(this.user=t,this.Bf(t)),this.A.resolve()})}async getConfiguration(){return await this.A.promise,{di:this.di,Ml:this.Ml,clientId:this.clientId,credentials:this.credentials,Yl:this.user,qh:100}}qf(t){this.Bf=t,this.A.promise.then(()=>this.Bf(this.user))}ef(){if(this.di.Ci)throw new Os(Ss.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.di.ki();const t=new na;return this.di.Ni(async()=>{try{this.Uf&&await this.Uf.terminate(),this.Kf&&await this.Kf.terminate(),this.credentials.I(),t.resolve()}catch(e){const n=Ta(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function ef(t,e){t.di.Li(),_s("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n),t.qf(n=>t.di.Oi(async()=>{await Hu(e.ku,n)})),e.persistence.rc(()=>t.terminate()),t.Kf=e}async function nf(t,e){t.di.Li();const n=await sf(t);_s("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.qf(n=>t.di.Oi(()=>(async function(t,e){const n=Ds(t);n.di.Li(),_s("RemoteStore","RemoteStore received new credentials");const s=gh(n);n.Bu.add(3),await uh(n),s&&n.Qu.set("Unknown"),await n.Fu.s_(e),n.Bu.delete(3),await ah(n)})(e.$h,n))),t.Uf=e}async function sf(t){return t.Kf||(_s("FirestoreClient","Using default OfflineComponentProvider"),await ef(t,new kc)),t.Kf}async function rf(t){return t.Uf||(_s("FirestoreClient","Using default OnlineComponentProvider"),await nf(t,new Sc)),t.Uf}function of(t){return sf(t).then(t=>t.persistence)}function af(t){return sf(t).then(t=>t.ku)}function uf(t){return rf(t).then(t=>t.$h)}function hf(t){return rf(t).then(t=>t.ba)}async function cf(t){const e=await rf(t),n=e.Lh;return n.ta=async function(t,e){const n=fc(t);let s,i;const r=n.Kh.get(e);if(r)s=r.targetId,n.Bh.Ha(s),i=r.view.Oh();else{const t=await Yu(n.ku,xo(e)),r=n.Bh.Ha(t.targetId);s=t.targetId,i=await Qh(n,e,s,"current"===r),n.Zh&&hh(n.$h,t)}return i}.bind(null,e.ba),n.sa=async function(t,e){const n=Ds(t),s=n.Kh.get(e),i=n.Qh.get(s.targetId);if(i.length>1)return n.Qh.set(s.targetId,i.filter(t=>!So(t,e))),void n.Kh.delete(e);n.Zh?(n.Bh.Ya(s.targetId),n.Bh.Qa(s.targetId)||await Xu(n.ku,s.targetId,!1).then(()=>{n.Bh.Za(s.targetId),ch(n.$h,s.targetId),sc(n,s.targetId)}).catch(th)):(sc(n,s.targetId),await Xu(n.ku,s.targetId,!0))}.bind(null,e.ba),n}function lf(t,e,n={}){const s=new na;return t.di.Ri(async()=>(function(t,e,n,s,i){const r=new Oc({next:r=>{e.Ri(()=>Sh(t,o));const a=r.docs.has(n);!a&&r.fromCache?i.reject(new Os(Ss.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&s&&"server"===s.source?i.reject(new Os(Ss.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new Rh(Io(n.path),r,{includeMetadataChanges:!0,ha:!0});return Dh(t,o)})(await cf(t),t.di,e,n,s)),s.promise}function ff(t,e,n={}){const s=new na;return t.di.Ri(async()=>(function(t,e,n,s,i){const r=new Oc({next:n=>{e.Ri(()=>Sh(t,o)),n.fromCache&&"server"===s.source?i.reject(new Os(Ss.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Rh(n,r,{includeMetadataChanges:!0,ha:!0});return Dh(t,o)})(await cf(t),t.di,e,n,s)),s.promise}class df extends Xc{constructor(t,e){super(t,e),this.nf=new _a,this.T_="name"in t?t.name:"[DEFAULT]"}S_(){return this.tf||ul(this),this.tf.terminate()}}function pf(t,e,n){const s=new na;return t.di.enqueue(async()=>{try{await ef(t,n),await nf(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===Ss.FAILED_PRECONDITION||t.code===Ss.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}}).then(()=>s.promise)}function gf(t){if(t.V_||t.g_)throw new Os(Ss.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}e._registerComponent(new c("firestore-exp",t=>((t,e)=>new df(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.900","node"),t.Bytes=Hc,t.CACHE_SIZE_UNLIMITED=-1,t.CollectionReference=xl,t.DocumentReference=gl,t.DocumentSnapshot=Jc,t.FieldPath=Qc,t.FieldValue=Uc,t.FirebaseFirestore=df,t.FirestoreError=Os,t.GeoPoint=Gc,t.Query=ml,t.QueryConstraint=yl,t.QueryDocumentSnapshot=Zc,t.QuerySnapshot=tl,t.SnapshotMetadata=hl,t.Timestamp=js,t.Transaction=ol,t.WriteBatch=il,t.addDoc=function(t,e){const n=Vc(t.firestore,df),s=Dl(t),i=cl(t.M_,e);return nl(n,ql(Rl(t.firestore),"addDoc",s.O_,i,null!==t.M_,{}).j_(s.O_,Yr.exists(!1))).then(()=>s)},t.arrayRemove=function(...t){return new zc("arrayRemove",t)},t.arrayUnion=function(...t){return new jc("arrayUnion",t)},t.clearIndexedDbPersistence=function(t){if(t.V_&&!t.g_)throw new Os(Ss.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new na;return t.nf.Ni(async()=>{try{await async function(t){if(!la.Gs())return Promise.resolve();const e=t+"main";await la.delete(e)}(zu(t.A_,t.T_)),e.resolve()}catch(t){e.reject(t)}}),e.promise},t.collection=function(t,e,...n){if(t instanceof Kc&&(t=t.o_),Rc("collection","path",e),t instanceof Xc){const s=Gs.G(e,...n);return Lc(s),new xl(t,null,s)}{if(!(t instanceof gl||t instanceof xl))throw new Os(Ss.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=Gs.G(t.path,...n).child(Gs.G(e));return Lc(s),new xl(t.firestore,null,s)}},t.collectionGroup=function(t,e){if(t=Vc(t,Xc),Rc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Os(Ss.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ml(t,null,function(t){return new vo(Gs.H(),t)}(e))},t.deleteDoc=function(t){return nl(Vc(t.firestore,df),[new ho(t.O_,Yr.on())])},t.deleteField=function(){return new qc("deleteField")},t.disableNetwork=function(t){return function(t){return t.di.enqueue(async()=>{const e=await of(t),n=await uf(t);return e.oc(!1),async function(t){const e=Ds(n);e.Bu.add(0),await uh(e),e.Qu.set("Offline")}()})}(al(t=Vc(t,df)))},t.doc=Dl,t.documentId=function(){return new Qc("__name__")},t.enableIndexedDbPersistence=function(t,e){gf(t=Vc(t,df));const n=al(t),s=t.v_(),i=new Sc;return pf(n,i,new xc(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))},t.enableMultiTabIndexedDbPersistence=function(t){gf(t=Vc(t,df));const e=al(t),n=t.v_(),s=new Sc;return pf(e,s,new Dc(s,n.cacheSizeBytes))},t.enableNetwork=function(t){return function(t){return t.di.enqueue(async()=>{const e=await of(t),n=await uf(t);return e.oc(!0),function(t){const e=Ds(n);return e.Bu.delete(0),ah(e)}()})}(al(t=Vc(t,df)))},t.endAt=function(...t){return new El("endAt",t,!1)},t.endBefore=function(...t){return new El("endBefore",t,!0)},t.getDoc=function(t){const e=Vc((t=Vc(t,gl)).firestore,df);return lf(al(e),t.O_).then(n=>sl(e,t,n))},t.getDocFromCache=function(t){const e=Vc((t=Vc(t,gl)).firestore,df),n=al(e),s=new el(e);return function(t,e){const n=new na;return t.di.Ri(async()=>(async function(t,e,n){try{const s=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("read document","readonly",t=>n.Bc.cs(t,e))}(t,e);s instanceof mo?n.resolve(s):s instanceof yo?n.resolve(null):n.reject(new Os(Ss.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=Ta(t,`Failed to get document '${e} from cache`);n.reject(s)}})(await af(t),e,n)),n.promise}(n,t.O_).then(n=>new Jc(e,s,t.O_,n,new hl(n instanceof mo&&n.an,!0),t.M_))},t.getDocFromServer=function(t){const e=Vc((t=Vc(t,gl)).firestore,df);return lf(al(e),t.O_,{source:"server"}).then(n=>sl(e,t,n))},t.getDocs=function(t){const e=Vc((t=Vc(t,ml)).firestore,df),n=al(e),s=new el(e);return kl(t.W_),ff(n,t.W_).then(n=>new tl(e,s,t,n))},t.getDocsFromCache=function(t){const e=Vc((t=Vc(t,ml)).firestore,df),n=al(e),s=new el(e);return function(t,e){const n=new na;return t.di.Ri(async()=>(async function(t,e,n){try{const s=await Qu(t,e,!0),i=new Kh(e,s.Qc),r=i.bh(s.documents),o=i.Zn(r,!1);n.resolve(o.snapshot)}catch(t){const s=Ta(t,`Failed to execute query '${e} against cache`);n.reject(s)}})(await af(t),e,n)),n.promise}(n,t.W_).then(n=>new tl(e,s,t,n))},t.getDocsFromServer=function(t){const e=Vc((t=Vc(t,ml)).firestore,df),n=al(e),s=new el(e);return ff(n,t.W_,{source:"server"}).then(n=>new tl(e,s,t,n))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new $c("increment",t)},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&-1!==n.cacheSizeBytes&&n.cacheSizeBytes<1048576)throw new Os(Ss.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return s.p_(n),s},t.limit=function(t){return Mc("limit",t),new bl("limit",t,"F")},t.limitToLast=function(t){return Mc("limitToLast",t),new bl("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,s,i;t instanceof Kc&&(t=t.o_);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||ia(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(ia(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let u,h,c;if(t instanceof gl)h=Vc(t.firestore,df),c=Io(t.O_.path),u={next:n=>{e[o]&&e[o](sl(h,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Vc(t,ml);h=Vc(n.firestore,df),c=n.W_;const s=new el(h);u={next:t=>{e[o]&&e[o](new tl(h,s,n,t))},error:e[o+1],complete:e[o+2]},kl(t.W_)}return function(t,e,n,s){const i=new Oc(u),r=new Rh(e,i,n);return t.di.Ri(async()=>Dh(await cf(t),r)),()=>{i.r_(),t.di.Ri(async()=>Sh(await cf(t),r))}}(al(h),c,a)},t.onSnapshotsInSync=function(t,e){return function(t,e){const n=new Oc(e);return t.di.Ri(async()=>(function(t,e){Ds(t).Zu.add(e),e.next()})(await cf(t),n)),()=>{n.r_(),t.di.Ri(async()=>(function(t,e){Ds(t).Zu.delete(e)})(await cf(t),n))}}(al(t=Vc(t,df)),ia(e)?e:{next:e})},t.orderBy=function(t,e="asc"){const n=e,s=pl("orderBy",t);return new vl(s,n)},t.query=function(t,...e){for(const n of e)t=n.lf(t);return t},t.queryEqual=Ol,t.refEqual=function(t,e){return t instanceof Kc&&(t=t.o_),e instanceof Kc&&(e=e.o_),(t instanceof gl||t instanceof xl)&&(e instanceof gl||e instanceof xl)&&t.firestore===e.firestore&&t.path===e.path&&t.M_===e.M_},t.runTransaction=function(t,e){return function(t,e){const n=new na;return t.di.Ri(async()=>{const s=await function(t){return rf(t).then(t=>t.Ou)}(t);new Zl(t.di,s,e,n).run()}),n.promise}(al(t),n=>e(new ol(t,n)))},t.serverTimestamp=function(){return new Bc("serverTimestamp")},t.setDoc=function(t,e,n){const s=Vc((t=Vc(t,gl)).firestore,df),i=cl(t.M_,e,n);return nl(s,ql(Rl(s),"setDoc",t.O_,i,null!==t.M_,n).j_(t.O_,Yr.on()))},t.setLogLevel=function(t){Is.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof Jc&&e instanceof Jc?t.C_===e.C_&&t.O_.isEqual(e.O_)&&(null===t.x_?null===e.x_:t.x_.isEqual(e.x_))&&t.M_===e.M_:t instanceof tl&&e instanceof tl&&t.C_===e.C_&&Ol(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.L_.isEqual(e.L_)},t.startAfter=function(...t){return new Il("startAfter",t,!1)},t.startAt=function(...t){return new Il("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),t._delete()},t.updateDoc=function(t,e,n,...s){const i=Vc((t=Vc(t,gl)).firestore,df),r=Rl(i);let o;return e instanceof Kc&&(e=e.o_),nl(i,(o="string"==typeof e||e instanceof Qc?Bl(r,"updateDoc",t.O_,e,n,s):Fl(r,"updateDoc",t.O_,e)).j_(t.O_,Yr.exists(!0)))},t.waitForPendingWrites=function(t){return function(t){const e=new na;return t.di.Ri(async()=>(async function(t,e){const n=Ds(t);gh(n.$h)||_s("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await function(t){const e=Ds(n.ku);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.rs.Br(t))}();if(-1===s)return void e.resolve();const i=n.Jh.get(s)||[];i.push(e),n.Jh.set(s,i)}catch(t){const n=Ta(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}})(await hf(t),e)),e.promise}(al(t=Vc(t,df)))},t.where=function(t,e,n){const s=e,i=pl("where",t);return new wl(i,s,n)},t.writeBatch=function(t){return al(t=Vc(t,df)),new il(t,e=>nl(t,e))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});