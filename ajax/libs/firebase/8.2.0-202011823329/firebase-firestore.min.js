!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(rg){"use strict";try{(function(){var l,t,e=(t=rg)&&"object"==typeof t&&"default"in t?t:{default:t};function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=u[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(ge=l=l||{})[ge.DEBUG=0]="DEBUG",ge[ge.VERBOSE=1]="VERBOSE",ge[ge.INFO=2]="INFO",ge[ge.WARN=3]="WARN",ge[ge.ERROR=4]="ERROR",ge[ge.SILENT=5]="SILENT";var r={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},i=l.INFO,u=((me={})[l.DEBUG]="log",me[l.VERBOSE]="log",me[l.INFO]="info",me[l.WARN]="warn",me[l.ERROR]="error",me),o=(Object.defineProperty(a.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),a.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?r[t]:t},Object.defineProperty(a.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),a.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},a.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},a.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},a.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},a.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},a);function a(t){this.name=t,this._logLevel=i,this._logHandler=n,this._userLogHandler=null}var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function h(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function f(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,g="FirebaseError",m=(h(w,d=Error),w);function w(t,e,n){return(e=d.call(this,e)||this).code=t,e.customData=n,e.name=g,Object.setPrototypeOf(e,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,b.prototype.create),e}var b=(I.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=(t=this.errors[t])?(r=i,t.replace(E,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},I);function I(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g,_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function T(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=A||self;function S(){}function O(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function D(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var x="closure_uid_"+(1e9*Math.random()>>>0),k=0;function P(t,e,n){return t.call.apply(t.bind,arguments)}function R(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function L(t,e,n){return(L=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:R).apply(null,arguments)}function C(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function U(){return Date.now()}function V(t,o){function e(){}e.prototype=o.prototype,t.X=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Kb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function M(){this.j=this.j,this.i=this.i}M.prototype.j=!1,M.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&(Object.prototype.hasOwnProperty.call(this,x)&&this[x]||(this[x]=++k))},M.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var j=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function q(){return Array.prototype.concat.apply([],arguments)}function B(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function G(t){return/^[\s\xa0]*$/.test(t)}var z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function H(t,e){return-1!=t.indexOf(e)}function K(t,e){return t<e?-1:e<t?1:0}var W=N.navigator;function Q(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Y(t){var e,n={};for(e in t)n[e]=t[e];return n}ut=(W=W&&W.userAgent)?W:"";var J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function X(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<J.length;i++)e=J[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function $(t){return $[" "](t),t}$[" "]=S;var Z,tt=H(ut,"Opera"),et=H(ut,"Trident")||H(ut,"MSIE"),nt=H(ut,"Edge"),rt=nt||et,it=H(ut,"Gecko")&&!(H(ut.toLowerCase(),"webkit")&&!H(ut,"Edge"))&&!(H(ut,"Trident")||H(ut,"MSIE"))&&!H(ut,"Edge"),ot=H(ut.toLowerCase(),"webkit")&&!H(ut,"Edge");function st(){var t=N.document;return t?t.documentMode:void 0}var W="",ut=(ut=ut,it?/rv:([^\);]+)(\)|;)/.exec(ut):nt?/Edge\/([\d\.]+)/.exec(ut):et?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ut):ot?/WebKit\/(\S+)/.exec(ut):tt?/(?:Version)[ \/]?(\S+)/.exec(ut):void 0);ut&&(W=ut?ut[1]:""),Z=et&&null!=(ut=st())&&ut>parseFloat(W)?String(ut):W;var at={};function ct(u){return t=u,e=function(){for(var t=0,e=z(String(Z)).split("."),n=z(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=K(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||K(0==o[2].length,0==s[2].length)||K(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=at,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var ht=N.document&&et&&(st()||parseInt(Z,10))||void 0,ft=!et||9<=Number(ht),lt=et&&!ct("9"),pt=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{N.addEventListener("test",S,e),N.removeEventListener("test",S,e)}catch(t){}return t}();function dt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function yt(t,e){if(dt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(it){t:{try{$(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:vt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}dt.prototype.b=function(){this.defaultPrevented=!0},V(yt,dt);var vt={2:"touch",3:"pen",4:"mouse"};yt.prototype.b=function(){yt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,lt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var gt="closure_listenable_"+(1e6*Math.random()|0),mt=0;function wt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++mt,this.Y=this.Z=!1}function bt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function It(t){this.src=t,this.a={},this.b=0}function Et(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=j(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(bt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function _t(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}It.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=_t(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new wt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Tt="closure_lm_"+(1e6*Math.random()|0),At={};function Nt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Lt(r),e&&e[gt]?e.wa(n,r,D(i)?!!i.capture:!!i,o):St(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Nt(t,e[o],n,r,i);return null}return n=Lt(n),t&&t[gt]?t.va(e,n,D(r)?!!r.capture:!!r,i):St(t,e,n,!1,r,i)}function St(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=D(i)?!!i.capture:!!i;if(s&&!ft)return null;var u,a,c=Pt(t);if(c||(t[Tt]=c=new It(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=kt,r=a=ft?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)pt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Dt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ot(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[gt]?Et(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Dt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Pt(e))?(Et(n,t),0==n.b&&(n.src=null,e[Tt]=null)):bt(t)))}function Dt(t){return t in At?At[t]:At[t]="on"+t}function xt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ot(t),n.call(r,e)}function kt(t,e){if(t.Y)return!0;if(ft)return xt(t,new yt(e,this));if(!e)t:{e=["window","event"];for(var n=N,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return xt(t,e=new yt(e,this))}function Pt(t){return(t=t[Tt])instanceof It?t:null}var Rt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Lt(e){return"function"==typeof e?e:(e[Rt]||(e[Rt]=function(t){return e.handleEvent(t)}),e[Rt])}function Ct(){M.call(this),this.c=new It(this),(this.J=this).C=null}function Ut(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new dt(e,t):e instanceof dt?e.target=e.target||t:(s=e,X(e=new dt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Vt(o,r,!0,e)&&s;if(s=Vt(o=e.a=t,r,!0,e)&&s,s=Vt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Vt(o=e.a=n[i],r,!1,e)&&s}function Vt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&Et(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}V(Ct,M),Ct.prototype[gt]=!0,(ut=Ct.prototype).addEventListener=function(t,e,n,r){Nt(this,t,e,n,r)},ut.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=D(i)?!!i.capture:!!i,r=Lt(r),e&&e[gt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=_t(s=e.a[n],r,i,o))&&(bt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Pt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=_t(n,r,i,o)),(r=-1<e?n[e]:null)&&Ot(r))}(this,t,e,n,r)},ut.G=function(){if(Ct.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)bt(n[r]);delete e.a[t],e.b--}}this.C=null},ut.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},ut.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Mt=N.JSON.stringify;function jt(){this.b=this.a=null}var Ft,qt=(Bt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Bt(function(){return new Gt},function(t){t.reset()}));function Bt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Gt(){this.next=this.b=this.a=null}function zt(t,e){var n;Ft||(n=N.Promise.resolve(void 0),Ft=function(){n.then(Wt)}),Ht||(Ft(),Ht=!0),Kt.add(t,e)}jt.prototype.add=function(t,e){var n=qt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Gt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Ht=!(Gt.prototype.reset=function(){this.next=this.b=this.a=null}),Kt=new jt;function Wt(){for(var t,e;n=e=void 0,n=null,(e=Kt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){N.setTimeout(function(){throw t},0)}(t)}var n=qt;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}Ht=!1}function Qt(t,e){Ct.call(this),this.b=t||1,this.a=e||N,this.f=L(this.Za,this),this.g=U()}function Yt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Jt(t,e,n){if("function"==typeof t)n&&(t=L(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=L(t.handleEvent,t)}return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}V(Qt,Ct),(ut=Qt.prototype).aa=!1,ut.M=null,ut.Za=function(){var t;this.aa&&(0<(t=U()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ut(this,"tick"),this.aa&&(Yt(this),this.start())))},ut.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=U())},ut.G=function(){Qt.X.G.call(this),Yt(this),delete this.a};var Xt,$t,Zt=(_($t=ee,W=Xt=M),$t.prototype=null===W?Object.create(W):(te.prototype=W.prototype,new te),ee.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Jt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},ee.prototype.G=function(){Xt.prototype.G.call(this),this.a&&(N.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},ee);function te(){this.constructor=$t}function ee(t,e){var n=Xt.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function ne(t){M.call(this),this.b=t,this.a={}}V(ne,M);var re=[];function ie(t,e,n,r){Array.isArray(n)||(n&&(re[0]=n.toString()),n=re);for(var i=0;i<n.length;i++){var o=Nt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function oe(t){Q(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ot(t)},t),t.a={}}function se(){this.a=!0}function ue(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)&&"noop"!=(r=i[0])&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}return Mt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ne.prototype.G=function(){ne.X.G.call(this),oe(this)},ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},se.prototype.info=function(){};var ae={},ce=null;function he(){return ce=ce||new Ct}function fe(t){dt.call(this,ae.Fa,t)}function le(){var t=he();Ut(t,new fe(t))}function pe(t,e){dt.call(this,ae.STAT_EVENT,t),this.stat=e}function de(t){var e=he();Ut(e,new pe(e,t))}function ye(t){dt.call(this,ae.Ga,t)}function ve(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){t()},e)}ae.Fa="serverreachability",V(fe,dt),ae.STAT_EVENT="statevent",V(pe,dt),ae.Ga="timingevent",V(ye,dt);var ge={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},me={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function we(){}function be(t){var e;return(e=t.a)||(e=t.a={}),e}function Ie(){}we.prototype.a=null;var Ee,A={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function _e(){dt.call(this,"d")}function Te(){dt.call(this,"c")}function Ae(){}function Ne(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ne(this),this.P=Se,t=rt?125:void 0,this.R=new Qt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}V(_e,dt),V(Te,dt),V(Ae,we),Ee=new Ae;var Se=45e3,Oe={},De={};function xe(t,e,n){t.H=1,t.i=Xe(He(e)),t.j=n,t.I=!0,ke(t,null)}function ke(t,e){t.u=U(),Re(t),t.l=He(t.i);var s,u,a,c,h,f,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),fn(n.b,"t",r),t.D=0,t.a=ir(t.g,t.g.C?e:null),0<t.O&&(t.F=new Zt(L(t.Ca,t,t.a),t.O)),ie(t.J,t.a,"readystatechange",t.Xa),e=t.B?Y(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),le(),s=t.c,u=t.m,a=t.l,c=t.f,h=t.S,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Pe(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var u=(u=n,o=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?De:(i=Number(u.substring(i,o)),isNaN(i)?Oe:(o+=1)+i>u.length?De:(u=u.substr(o,i),r.D=o+i,u)));if(u==De){4==e&&(t.h=4,de(14),s=!1),ue(t.c,t.f,null,"[Incomplete Response]");break}if(u==Oe){t.h=4,de(15),ue(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}ue(t.c,t.f,u,null),Me(t,u)}4==e&&0==n.length&&(t.h=1,de(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Jn(e),e.F=!0,de(11))):(ue(t.c,t.f,n,"[Invalid Chunked Response]"),Ve(t),Ue(t))}function Re(t){t.T=U()+t.P,Le(t,t.P)}function Le(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ve(L(t.Va,t),e)}function Ce(t){t.o&&(N.clearTimeout(t.o),t.o=null)}function Ue(t){0==t.g.v||t.A||Zn(t.g,t)}function Ve(t){Ce(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Yt(t.R),oe(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Me(t,e){try{var n,r,i,o,s,u=t.g;if(0!=u.v&&(u.a==t||mn(u.b,t)))if(u.I=t.N,!t.C&&mn(u.b,t)&&3==u.v){try{var a=u.ka.a.parse(e)}catch(t){a=null}if(Array.isArray(a)&&3==a.length){var c=a;if(0==c[0]){t:if(!u.j){if(u.a){if(!(u.a.u+3e3<t.u))break t;$n(u),qn(u)}Yn(u),de(18)}}else u.oa=c[1],0<u.oa-u.P&&c[2]<37500&&u.H&&0==u.o&&!u.m&&(u.m=ve(L(u.Sa,u),6e3));if(gn(u.b)<=1&&u.ea){try{u.ea()}catch(t){}u.ea=void 0}}else er(u,11)}else if(!t.C&&u.a!=t||$n(u),!G(e))for(e=a=u.ka.a.parse(e),a=0;a<e.length;a++)c=e[a],u.P=c[0],c=c[1],2==u.v?"c"==c[0]?(u.J=c[1],u.ga=c[2],null!=(r=c[3])&&(u.ha=r,u.c.info("VER="+u.ha)),null!=(o=c[4])&&(u.pa=o,u.c.info("SVER="+u.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,u.D=n,u.c.info("backChannelRequestTimeoutMs_="+n)),n=u,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(H(r,"spdy")||H(r,"quic")||H(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(wn(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,Je(n.B,n.A,s))),u.v=3,u.f&&u.f.ta(),u.U&&(u.N=U()-t.u,u.c.info("Handshake RTT: "+u.N+"ms")),i=t,(n=u).la=rr(n,n.C?n.ga:null,n.fa),i.C?(bn(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Ce(o),Re(o)),n.a=i):Qn(n),0<u.g.length&&zn(u)):"stop"!=c[0]&&"close"!=c[0]||er(u,7):3==u.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?er(u,7):Fn(u):"noop"!=c[0]&&u.f&&u.f.sa(c),u.o=0);le()}catch(t){}}function je(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(O(t)||"string"==typeof t)F(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(O(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(O(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Fe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Be(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Be(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(ut=Ne.prototype).setTimeout=function(t){this.P=t},ut.Xa=function(t){t=t.target;var e=this.F;e&&3==Un(t)?e.f():this.Ca(t)},ut.Ca=function(t){try{if(t==this.a)t:{var e=Un(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!rt&&!this.a.$())){this.A||4!=e||7==n||le(),Ce(this);var i=this.a.W();if(this.N=i,n=this.a.$(),this.b=200==i,r=this.c,u=this.m,a=this.l,c=this.f,h=this.S,f=e,l=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+u+"\n"+a+"\n"+f+" "+l}),this.b){if(this.U&&!this.C){e:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.h=3,de(12),Ve(this),Ue(this);break t}ue(this.c,this.f,s,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Me(this,s)}this.I?(Pe(this,e,n),rt&&this.b&&3==e&&(ie(this.J,this.R,"tick",this.Wa),this.R.start())):(ue(this.c,this.f,n,null),Me(this,n)),4==e&&Ve(this),this.b&&!this.A&&(4==e?Zn(this.g,this):(this.b=!1,Re(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,de(12)):(this.h=0,de(13)),Ve(this),Ue(this)}}}catch(t){}var u,a,c,h,f,l},ut.Wa=function(){var t,e;this.a&&(t=Un(this.a),e=this.a.$(),this.D<e.length&&(Ce(this),Pe(this,t,e),this.b&&4!=t&&Re(this)))},ut.cancel=function(){this.A=!0,Ve(this)},ut.Va=function(){this.o=null;var t,e,n=U();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(le(),de(17)),Ve(this),this.h=2,Ue(this)):Le(this,this.T-n)},(ut=Fe.prototype).K=function(){qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},ut.L=function(){return qe(this),this.a.concat()},ut.get=function(t,e){return Be(this.b,t)?this.b[t]:e},ut.set=function(t,e){Be(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},ut.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ge=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ze(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof ze?(this.a=void 0!==e?e:t.a,Ke(this,t.f),this.j=t.j,We(this,t.c),Qe(this,t.h),this.g=t.g,e=t.b,(n=new un).c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Ye(this,n),this.i=t.i):t&&(n=String(t).match(Ge))?(this.a=!!e,Ke(this,n[1]||"",!0),this.j=$e(n[2]||""),We(this,n[3]||"",!0),Qe(this,n[4]),this.g=$e(n[5]||"",!0),Ye(this,n[6]||"",!0),this.i=$e(n[7]||"")):(this.a=!!e,this.b=new un(null,this.a))}function He(t){return new ze(t)}function Ke(t,e,n){t.f=n?$e(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function We(t,e,n){t.c=n?$e(e,!0):e}function Qe(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ye(t,e,n){var r,i;e instanceof un?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(an(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),fn(this,n,t))},r)),r.f=i):(n||(e=Ze(e,on)),t.b=new un(e,t.a))}function Je(t,e,n){t.b.set(e,n)}function Xe(t){return Je(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^U()).toString(36)),t}function $e(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,sn)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,sn=/#/g;function un(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function an(o){o.a||(o.a=new Fe,o.b=0,o.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",o.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(o.c))}function cn(t,e){an(t),e=ln(t,e),Be(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Be((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&qe(t)))}function hn(t,e){return an(t),e=ln(t,e),Be(t.a.b,e)}function fn(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(ln(t,e),B(n)),t.b+=n.length)}function ln(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(ut=un.prototype).add=function(t,e){an(this),this.c=null,t=ln(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},ut.forEach=function(n,r){an(this),this.a.forEach(function(t,e){F(t,function(t){n.call(r,t,e,this)},this)},this)},ut.L=function(){an(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},ut.K=function(t){an(this);var e=[];if("string"==typeof t)hn(this,t)&&(e=q(e,this.a.get(ln(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=q(e,t[n])}return e},ut.set=function(t,e){return an(this),this.c=null,hn(this,t=ln(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},ut.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},ut.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};function pn(t,e){this.b=t,this.a=e}function dn(t){this.g=t||yn,t=N.PerformanceNavigationTiming?0<(t=N.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(N.ia&&N.ia.ya&&N.ia.ya()&&N.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var yn=10;function vn(t){return t.b||t.a&&t.a.size>=t.f}function gn(t){return t.b?1:t.a?t.a.size:0}function mn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function bn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function In(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return B(t.c);var r=t.c;try{for(var i=T(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function En(){}function _n(){this.a=new En}function Tn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=In(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=T(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return N.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return N.JSON.parse(t,void 0)};var An=N.JSON.parse;function Nn(t){Ct.call(this),this.headers=new Fe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Sn,this.D=this.F=!1}V(Nn,Ct);var Sn="",On=/^https?$/i,Dn=["POST","PUT"];function xn(t){return"content-type"==t.toLowerCase()}function kn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Pn(t),Ln(t)}function Pn(t){t.u||(t.u=!0,Ut(t,"complete"),Ut(t,"error"))}function Rn(t){if(t.b&&(!t.s[1]||4!=Un(t)||2!=t.W()))if(t.l&&4==Un(t))Jt(t.za,0,t);else if(Ut(t,"readystatechange"),4==Un(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(Ge)[1]||null)&&N.self&&N.self.location&&(i=(r=N.self.location.protocol).substr(0,r.length-1)),n=!On.test(i?i.toLowerCase():"")),e=n),e)Ut(t,"complete"),Ut(t,"success");else{t.h=6;try{var u=2<Un(t)?t.a.statusText:""}catch(o){u=""}t.f=u+" ["+t.W()+"]",Pn(t)}}finally{Ln(t)}}}function Ln(t,e){if(t.a){Cn(t);var n=t.a,r=t.s[0]?S:null;t.a=null,t.s=null,e||Ut(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Cn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(N.clearTimeout(t.m),t.m=null)}function Un(t){return t.a?t.a.readyState:0}function Vn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Q(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Je(t,e,n))}function Mn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function jn(t){this.pa=0,this.g=[],this.c=new se,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Mn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Mn("baseRetryDelayMs",5e3,t),this.Ra=Mn("retryDelaySeedMs",1e4,t),this.Ma=Mn("forwardChannelMaxRetries",2,t),this.ma=Mn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new _n,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Fn(t){var e,n;Bn(t),3==t.v&&(e=t.R++,Je(n=He(t.B),"SID",t.J),Je(n,"RID",e),Je(n,"TYPE","terminate"),Kn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Xe(He(n)),n=!1,N.navigator&&N.navigator.sendBeacon&&(n=N.navigator.sendBeacon(e.i.toString(),"")),!n&&N.Image&&((new Image).src=e.i,n=!0),n||(e.a=ir(e.g,null),e.a.ba(e.i)),e.u=U(),Re(e)),nr(t)}function qn(t){t.a&&(Jn(t),t.a.cancel(),t.a=null)}function Bn(t){qn(t),t.j&&(N.clearTimeout(t.j),t.j=null),$n(t),t.b.cancel(),t.h&&("number"==typeof t.h&&N.clearTimeout(t.h),t.h=null)}function Gn(t,e){t.g.push(new pn(t.Oa++,e)),3==t.v&&zn(t)}function zn(t){vn(t.b)||t.h||(t.h=!0,zt(t.Ba,t),t.u=0)}function Hn(t,e){var n=e?e.f:t.R++,r=He(t.B);Je(r,"SID",t.J),Je(r,"RID",n),Je(r,"AID",t.P),Kn(t,r),t.i&&t.l&&Vn(r,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Wn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),xe(n,r,e)}function Kn(t,n){t.f&&je({},function(t,e){Je(n,e,t)})}function Wn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?L(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r){var i="req"+c+"_"||"";try{je(t,function(t,e){var n=t;D(t)&&(n=Mt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s)}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Qn(t){t.a||t.j||(t.T=1,zt(t.Aa,t),t.o=0)}function Yn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ve(L(t.Aa,t),tr(t,t.o)),t.o++,1)}function Jn(t){null!=t.s&&(N.clearTimeout(t.s),t.s=null)}function Xn(t){t.a=new Ne(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=He(t.la);Je(e,"RID","rpc"),Je(e,"SID",t.J),Je(e,"CI",t.H?"0":"1"),Je(e,"AID",t.P),Kn(t,e),Je(e,"TYPE","xmlhttp"),t.i&&t.l&&Vn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Xe(He(e)),n.j=null,n.I=!0,ke(n,t)}function $n(t){null!=t.m&&(N.clearTimeout(t.m),t.m=null)}function Zn(t,e){var n,r,i,o=null;if(t.a==e){$n(t),Jn(t),t.a=null;var s=2}else{if(!mn(t.b,e))return;o=e.s,bn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=U()-e.u,n=t.u,Ut(s=he(),new ye(s)),zn(t)):Qn(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,gn((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.La?0:r.Ma)||(r.h=ve(L(r.Ba,r,i),tr(r,r.u)),r.u++,0))))&&(2!=s||!Yn(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:er(t,5);break;case 4:er(t,10);break;case 3:er(t,6);break;default:er(t,2)}}function tr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function er(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=L(t.Ya,t),r||(r=new ze("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||Ke(r,"https"),Xe(r)),n=r.toString(),r=o,o=new se,N.Image?((i=new Image).onload=C(Tn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=C(Tn,o,i,"TestLoadImage: error",!1,r),i.onabort=C(Tn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=C(Tn,o,i,"TestLoadImage: timeout",!1,r),N.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):de(2),t.v=0,t.f&&t.f.ra(e),nr(t),Bn(t)}function nr(t){t.v=0,t.I=-1,t.f&&(0==In(t.b).length&&0==t.g.length||(t.b.c.length=0,B(t.g),t.g.length=0),t.f.qa())}function rr(t,e,n){var r,i,o,s,u,a=(s=n)instanceof ze?He(s):new ze(s,void 0);return""!=a.c?(e&&We(a,e+"."+a.c),Qe(a,a.h)):(r=(u=N.location).protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new ze(null,void 0),r&&Ke(u,r),i&&We(u,i),o&&Qe(u,o),s&&(u.g=s),a=u),t.V&&Q(t.V,function(t,e){Je(a,e,t)}),e=t.A,n=t.na,e&&n&&Je(a,e,n),Je(a,"VER",t.ha),Kn(t,a),a}function ir(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nn(t.Na)).F=t.C,e}function or(){}function sr(){if(et&&!(10<=Number(ht)))throw Error("Environmental error: no available transport.")}function ur(t,e){Ct.call(this),this.a=new jn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!G(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!G(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new hr(this)}function ar(t){_e.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){Te.call(this),this.status=1}function hr(t){this.a=t}(ut=Nn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?be(this.H):be(Ee),this.a.onreadystatechange=L(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void kn(this,t)}t=n||"";var i,o=new Fe(this.headers);r&&je(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=xn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=N.FormData&&t instanceof N.FormData,0<=j(Dn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Cn(this),0<this.o&&((this.D=(i=this.a,et&&ct(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=L(this.xa,this)):this.m=Jt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){kn(this,t)}},ut.xa=function(){this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ut(this,"timeout"),this.abort(8))},ut.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ut(this,"complete"),Ut(this,"abort"),Ln(this))},ut.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Ln(this,!0)),Nn.X.G.call(this)},ut.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Ua())},ut.Ua=function(){Rn(this)},ut.W=function(){try{return 2<Un(this)?this.a.status:-1}catch(t){return-1}},ut.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},ut.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),An(e)}},ut.ua=function(){return this.h},ut.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(ut=jn.prototype).ha=8,ut.v=1,ut.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),r=this.l;if(this.O&&(r?X(r=Y(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Wn(this,n,e),Je(i=He(this.B),"RID",t),Je(i,"CVER",22),this.A&&Je(i,"X-HTTP-Session-Id",this.A),Kn(this,i),this.i&&r&&Vn(i,this.i,r),wn(this.b,n),this.Ia&&Je(i,"TYPE","init"),this.da?(Je(i,"$req",e),Je(i,"SID","null"),n.U=!0,xe(n,i,null)):xe(n,i,e),this.v=2}}else 3==this.v&&(t?Hn(this,t):0==this.g.length||vn(this.b)||Hn(this))},ut.Aa=function(){var t;this.j=null,Xn(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=ve(L(this.Ta,this),t))},ut.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,de(10),qn(this),Xn(this))},ut.Sa=function(){null!=this.m&&(this.m=null,qn(this),Yn(this),de(19))},ut.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),de(2)):(this.c.info("Failed to ping google.com"),de(1))},(ut=or.prototype).ta=function(){},ut.sa=function(){},ut.ra=function(){},ut.qa=function(){},ut.Ja=function(){},sr.prototype.a=function(t,e){return new ur(t,e)},V(ur,Ct),ur.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;de(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=rr(t,null,t.fa),zn(t)},ur.prototype.close=function(){Fn(this.a)},ur.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,Gn(this.a,e)):this.l?((e={}).__data__=Mt(t),Gn(this.a,e)):Gn(this.a,t)},ur.prototype.G=function(){this.a.f=null,delete this.f,Fn(this.a),delete this.a,ur.X.G.call(this)},V(ar,_e),V(cr,Te),V(hr,or),hr.prototype.ta=function(){Ut(this.a,"a")},hr.prototype.sa=function(t){Ut(this.a,new ar(t))},hr.prototype.ra=function(t){Ut(this.a,new cr)},hr.prototype.qa=function(){Ut(this.a,"b")},sr.prototype.createWebChannel=sr.prototype.a,ur.prototype.send=ur.prototype.h,ur.prototype.open=ur.prototype.g,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",(Ie.EventType=A).OPEN="a",A.CLOSE="b",A.ERROR="c",A.MESSAGE="d",Ct.prototype.listen=Ct.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Qa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.W,Nn.prototype.getResponseJson=Nn.prototype.Pa,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var fr=he,lr=ge,pr=me,dr=ae,yr=Ie,vr=Nn,gr="8.2.0-202011823329",mr=new o("@firebase/firestore");function wr(){return mr.logLevel}function br(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];mr.logLevel<=l.DEBUG&&(e=n.map(_r),mr.debug.apply(mr,f(["Firestore ("+gr+"): "+t],e)))}function Ir(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];mr.logLevel<=l.ERROR&&(e=n.map(_r),mr.error.apply(mr,f(["Firestore ("+gr+"): "+t],e)))}function Er(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];mr.logLevel<=l.WARN&&(e=n.map(_r),mr.warn.apply(mr,f(["Firestore ("+gr+"): "+t],e)))}function _r(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Tr(t){throw void 0===t&&(t="Unexpected state"),Ir(t="FIRESTORE ("+gr+") INTERNAL ASSERTION FAILED: "+t),new Error(t)}function Ar(t){t||Tr()}var Nr=(Sr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(var n=0;n<40;n++)e[n]=Math.floor(256*Math.random());return e}(),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Sr);function Sr(){}function Or(t,e){return t<e?-1:e<t?1:0}function Dr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function xr(t){return t+"\0"}var kr=(Pr.fromBase64String=function(t){return new Pr(atob(t))},Pr.fromUint8Array=function(t){return new Pr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Pr.prototype.toBase64=function(){return t=this.i,btoa(t);var t},Pr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},Pr.prototype.o=function(){return 2*this.i.length},Pr.prototype.u=function(t){return Or(this.i,t.i)},Pr.prototype.isEqual=function(t){return this.i===t.i},Pr);function Pr(t){this.i=t}kr.h=new kr("");var Rr,Lr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Cr=(h(jr,Rr=Error),jr),Ur=(Mr.fromBase64String=function(t){try{return new Mr(kr.fromBase64String(t))}catch(t){throw new Cr(Lr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},Mr.fromUint8Array=function(t){return new Mr(kr.fromUint8Array(t))},Mr.prototype.toBase64=function(){return this.l.toBase64()},Mr.prototype.toUint8Array=function(){return this.l.toUint8Array()},Mr.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Mr.prototype.isEqual=function(t){return this.l.isEqual(t.l)},Mr),Vr=function(t){this._=t};function Mr(t){this.l=t}function jr(t,e){var n=this;return(n=Rr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Fr(){if("undefined"==typeof Uint8Array)throw new Cr(Lr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function qr(){if("undefined"==typeof atob)throw new Cr(Lr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Br,Gr=(h(Kr,Br=Vr),Kr.fromBase64String=function(t){return qr(),new Kr(Ur.fromBase64String(t))},Kr.fromUint8Array=function(t){return Fr(),new Kr(Ur.fromUint8Array(t))},Kr.prototype.toBase64=function(){return qr(),this._.toBase64()},Kr.prototype.toUint8Array=function(){return Fr(),this._.toUint8Array()},Kr.prototype.isEqual=function(t){return this._.isEqual(t._)},Kr.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Kr),zr=(Hr.prototype.T=function(){return null!=this.uid},Hr.prototype.I=function(){return this.T()?"uid:"+this.uid:"anonymous-user"},Hr.prototype.isEqual=function(t){return t.uid===this.uid},Hr);function Hr(t){this.uid=t}function Kr(){return null!==Br&&Br.apply(this,arguments)||this}function Wr(t,e){this.user=e,this.type="OAuth",this.R={},this.R.Authorization="Bearer "+t}zr.UNAUTHENTICATED=new zr(null),zr.m=new zr("google-credentials-uid"),zr.A=new zr("first-party-uid");var Qr=(ai.prototype.getToken=function(){return Promise.resolve(null)},ai.prototype.g=function(){},ai.prototype.V=function(t){(this.P=t)(zr.UNAUTHENTICATED)},ai.prototype.p=function(){this.P=null},ai),Yr=(ui.prototype.getToken=function(){var e=this,n=this.D,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.D!==n?(br("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Ar("string"==typeof t.accessToken),new Wr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},ui.prototype.g=function(){this.forceRefresh=!0},ui.prototype.V=function(t){this.P=t,this.S&&t(this.currentUser)},ui.prototype.p=function(){this.auth&&this.auth.removeAuthTokenListener(this.v),this.v=null,this.P=null},ui.prototype.C=function(){var t=this.auth&&this.auth.getUid();return Ar(null===t||"string"==typeof t),new zr(t)},ui),Jr=(Object.defineProperty(si.prototype,"R",{get:function(){var t={"X-Goog-AuthUser":this.F},e=this.N.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),si),Xr=(oi.prototype.getToken=function(){return Promise.resolve(new Jr(this.N,this.F))},oi.prototype.V=function(t){t(zr.A)},oi.prototype.p=function(){},oi.prototype.g=function(){},oi),$r=function(t,e,n,r,i,o){this.O=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.k=o},Zr=(Object.defineProperty(ii.prototype,"M",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),ii.prototype.isEqual=function(t){return t instanceof ii&&t.projectId===this.projectId&&t.database===this.database},ii),ti=(ri.prototype.$=function(t){},ri.prototype.L=function(){},ri),ei=(ni.prototype.$=function(t){this.W.push(t)},ni.prototype.L=function(){window.removeEventListener("online",this.B),window.removeEventListener("offline",this.U)},ni.prototype.j=function(){window.addEventListener("online",this.B),window.addEventListener("offline",this.U)},ni.prototype.q=function(){br("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.W;t<e.length;t++)(0,e[t])(0)},ni.prototype.K=function(){br("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.W;t<e.length;t++)(0,e[t])(1)},ni.G=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},ni);function ni(){var t=this;this.B=function(){return t.q()},this.U=function(){return t.K()},this.W=[],this.j()}function ri(){}function ii(t,e){this.projectId=t,this.database=e||"(default)"}function oi(t,e){this.N=t,this.F=e}function si(t,e){this.N=t,this.F=e,this.type="FirstParty",this.user=zr.A}function ui(t){var e=this;this.v=null,this.currentUser=zr.UNAUTHENTICATED,this.S=!1,this.D=0,this.P=null,this.forceRefresh=!1,this.v=function(){e.D++,e.currentUser=e.C(),e.S=!0,e.P&&e.P(e.currentUser)},this.D=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.v):(this.v(null),t.get().then(function(t){e.auth=t,e.v&&e.auth.addAuthTokenListener(e.v)},function(){}))}function ai(){this.P=null}function ci(t){return null==t}function hi(t){return 0===t&&1/t==-1/0}function fi(t){return"number"==typeof t&&Number.isInteger(t)&&!hi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var li,pi={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};function di(t){switch(t){case Lr.OK:return Tr(),0;case Lr.CANCELLED:case Lr.UNKNOWN:case Lr.DEADLINE_EXCEEDED:case Lr.RESOURCE_EXHAUSTED:case Lr.INTERNAL:case Lr.UNAVAILABLE:case Lr.UNAUTHENTICATED:return;case Lr.INVALID_ARGUMENT:case Lr.NOT_FOUND:case Lr.ALREADY_EXISTS:case Lr.PERMISSION_DENIED:case Lr.FAILED_PRECONDITION:case Lr.ABORTED:case Lr.OUT_OF_RANGE:case Lr.UNIMPLEMENTED:case Lr.DATA_LOSS:return 1;default:return Tr(),0}}function yi(t){if(void 0===t)return Ir("GRPC error has no .code"),Lr.UNKNOWN;switch(t){case li.OK:return Lr.OK;case li.CANCELLED:return Lr.CANCELLED;case li.UNKNOWN:return Lr.UNKNOWN;case li.DEADLINE_EXCEEDED:return Lr.DEADLINE_EXCEEDED;case li.RESOURCE_EXHAUSTED:return Lr.RESOURCE_EXHAUSTED;case li.INTERNAL:return Lr.INTERNAL;case li.UNAVAILABLE:return Lr.UNAVAILABLE;case li.UNAUTHENTICATED:return Lr.UNAUTHENTICATED;case li.INVALID_ARGUMENT:return Lr.INVALID_ARGUMENT;case li.NOT_FOUND:return Lr.NOT_FOUND;case li.ALREADY_EXISTS:return Lr.ALREADY_EXISTS;case li.PERMISSION_DENIED:return Lr.PERMISSION_DENIED;case li.FAILED_PRECONDITION:return Lr.FAILED_PRECONDITION;case li.ABORTED:return Lr.ABORTED;case li.OUT_OF_RANGE:return Lr.OUT_OF_RANGE;case li.UNIMPLEMENTED:return Lr.UNIMPLEMENTED;case li.DATA_LOSS:return Lr.DATA_LOSS;default:return Tr()}}(me=li={})[me.OK=0]="OK",me[me.CANCELLED=1]="CANCELLED",me[me.UNKNOWN=2]="UNKNOWN",me[me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",me[me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",me[me.NOT_FOUND=5]="NOT_FOUND",me[me.ALREADY_EXISTS=6]="ALREADY_EXISTS",me[me.PERMISSION_DENIED=7]="PERMISSION_DENIED",me[me.UNAUTHENTICATED=16]="UNAUTHENTICATED",me[me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",me[me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",me[me.ABORTED=10]="ABORTED",me[me.OUT_OF_RANGE=11]="OUT_OF_RANGE",me[me.UNIMPLEMENTED=12]="UNIMPLEMENTED",me[me.INTERNAL=13]="INTERNAL",me[me.UNAVAILABLE=14]="UNAVAILABLE",me[me.DATA_LOSS=15]="DATA_LOSS";var vi,gi,mi,wi=(Ui.prototype.Y=function(t){this.X=t},Ui.prototype.Z=function(t){this.tt=t},Ui.prototype.onMessage=function(t){this.et=t},Ui.prototype.close=function(){this.J()},Ui.prototype.send=function(t){this.H(t)},Ui.prototype.nt=function(){this.X()},Ui.prototype.st=function(t){this.tt(t)},Ui.prototype.it=function(t){this.et(t)},Ui),bi=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Ii=(Ci.prototype.at=function(e,t,n,r){var i=this.ut(e,t);return br("RestConnection","Sending: ",i,n),t={},this.ht(t,r),this.lt(e,i,t,n).then(function(t){return br("RestConnection","Received: ",t),t},function(t){throw Er("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Ci.prototype._t=function(t,e,n,r){return this.at(t,e,n,r)},Ci.prototype.ht=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.0-202011823329",t["Content-Type"]="text/plain",e)for(var n in e.R)e.R.hasOwnProperty(n)&&(t[n]=e.R[n])},Ci.prototype.ut=function(t,e){return t=pi[t],this.ot+"/v1/"+e+":"+t},h(Li,mi=Ci),Li.prototype.lt=function(o,e,s,u){return new Promise(function(n,r){var i=new vr;i.listenOnce(pr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case lr.NO_ERROR:var t=i.getResponseJson();br("Connection","XHR received:",JSON.stringify(t)),n(t);break;case lr.TIMEOUT:br("Connection",'RPC "'+o+'" timed out'),r(new Cr(Lr.DEADLINE_EXCEEDED,"Request time out"));break;case lr.HTTP_ERROR:var e=i.getStatus();br("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(Lr).indexOf(e)?e:Lr.UNKNOWN,r(new Cr(e,t.message))):r(new Cr(Lr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Cr(Lr.UNAVAILABLE,"Connection failed."));break;default:Tr()}}finally{br("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},Li.prototype.ft=function(t,e){var n,r=[this.ot,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new sr,o=fr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.O.projectId+"/databases/"+this.O.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.k};this.ht(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(n=p()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders"),br("Connection","Creating WebChannel: "+(r=r.join("")),t);var s=i.createWebChannel(r,t),u=!1,a=!1,c=new wi({H:function(t){a?br("Connection","Not sending because WebChannel is closed:",t):(u||(br("Connection","Opening WebChannel transport."),s.open(),u=!0),br("Connection","WebChannel sending:",t),s.send(t))},J:function(){return s.close()}});return(t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})})(s,yr.EventType.OPEN,function(){a||br("Connection","WebChannel transport opened.")}),t(s,yr.EventType.CLOSE,function(){a||(a=!0,br("Connection","WebChannel transport closed"),c.st())}),t(s,yr.EventType.ERROR,function(t){a||(a=!0,Er("Connection","WebChannel transport errored:",t),c.st(new Cr(Lr.UNAVAILABLE,"The operation could not be completed")))}),t(s,yr.EventType.MESSAGE,function(t){var e,n,r,i;a||(Ar(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(br("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=li[r];if(void 0!==t)return yi(t)}(),i=n.message,void 0===t&&(t=Lr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),a=!0,c.st(new Cr(t,i)),s.close()):(br("Connection","WebChannel received:",e),c.it(e)))}),t(o,dr.STAT_EVENT,function(t){10===t.stat?br("Connection","Detected buffering proxy"):11===t.stat&&br("Connection","Detected no buffering proxy")}),setTimeout(function(){c.nt()},0),c},Li),Ei=(Ri.now=function(){return Ri.fromMillis(Date.now())},Ri.fromDate=function(t){return Ri.fromMillis(t.getTime())},Ri.fromMillis=function(t){var e=Math.floor(t/1e3);return new Ri(e,1e6*(t-1e3*e))},Ri.prototype.toDate=function(){return new Date(this.toMillis())},Ri.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Ri.prototype.dt=function(t){return this.seconds===t.seconds?Or(this.nanoseconds,t.nanoseconds):Or(this.seconds,t.seconds)},Ri.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Ri.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Ri.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Ri.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Ri),_i=(Pi.wt=function(t){return new Pi(t)},Pi.min=function(){return new Pi(new Ei(0,0))},Pi.prototype.u=function(t){return this.timestamp.dt(t.timestamp)},Pi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Pi.prototype.Et=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Pi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Pi.prototype.Tt=function(){return this.timestamp},Pi),o=(Object.defineProperty(ki.prototype,"length",{get:function(){return this.It},enumerable:!1,configurable:!0}),ki.prototype.isEqual=function(t){return 0===ki.At(this,t)},ki.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ki?t.forEach(function(t){e.push(t)}):e.push(t),this.Rt(e)},ki.prototype.limit=function(){return this.offset+this.length},ki.prototype.Pt=function(t){return t=void 0===t?1:t,this.Rt(this.segments,this.offset+t,this.length-t)},ki.prototype.yt=function(){return this.Rt(this.segments,this.offset,this.length-1)},ki.prototype.gt=function(){return this.segments[this.offset]},ki.prototype.Vt=function(){return this.get(this.length-1)},ki.prototype.get=function(t){return this.segments[this.offset+t]},ki.prototype.bt=function(){return 0===this.length},ki.prototype.vt=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ki.prototype.St=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ki.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ki.prototype.Dt=function(){return this.segments.slice(this.offset,this.limit())},ki.At=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ki),Ti=(h(xi,gi=o),xi.prototype.Rt=function(t,e,n){return new xi(t,e,n)},xi.prototype.Ct=function(){return this.Dt().join("/")},xi.prototype.toString=function(){return this.Ct()},xi.xt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new xi(n)},xi.Nt=function(){return new xi([])},xi),Ai=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ni=(h(Di,vi=o),Di.prototype.Rt=function(t,e,n){return new Di(t,e,n)},Di.Ft=function(t){return Ai.test(t)},Di.prototype.Ct=function(){return this.Dt().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Di.Ft(t)||(t="`"+t+"`"),t}).join(".")},Di.prototype.toString=function(){return this.Ct()},Di.prototype.Ot=function(){return 1===this.length&&"__name__"===this.get(0)},Di.kt=function(){return new Di(["__name__"])},Di.Mt=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Cr(Lr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Cr(Lr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Cr(Lr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Di(e)},Di.Nt=function(){return new Di([])},Di),Si=(Oi.$t=function(t){return new Oi(Ti.xt(t))},Oi.Lt=function(t){return new Oi(Ti.xt(t).Pt(5))},Oi.prototype.Bt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Oi.prototype.isEqual=function(t){return null!==t&&0===Ti.At(this.path,t.path)},Oi.prototype.toString=function(){return this.path.toString()},Oi.At=function(t,e){return Ti.At(t.path,e.path)},Oi.qt=function(t){return t.length%2==0},Oi.Ut=function(t){return new Oi(new Ti(t.slice()))},Oi);function Oi(t){this.path=t}function Di(){return null!==vi&&vi.apply(this,arguments)||this}function xi(){return null!==gi&&gi.apply(this,arguments)||this}function ki(t,e,n){void 0===e?e=0:e>t.length&&Tr(),void 0===n?n=t.length-e:n>t.length-e&&Tr(),this.segments=t,this.offset=e,this.It=n}function Pi(t){this.timestamp=t}function Ri(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Cr(Lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Cr(Lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Cr(Lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Cr(Lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Li(t){var e=this;return(e=mi.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.k=t.k,e}function Ci(t){this.rt=t,this.O=t.O;var e=t.ssl?"https":"http";this.ot=e+"://"+t.host,this.ct="projects/"+this.O.projectId+"/databases/"+this.O.database+"/documents"}function Ui(t){this.H=t.H,this.J=t.J}function Vi(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Mi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ji(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Fi=(Bi.prototype.Qt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].vt(t))return!0;return!1},Bi.prototype.isEqual=function(t){return Dr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Bi),qi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bi(t){(this.fields=t).sort(Ni.At)}function Gi(t){if(Ar(!!t),"string"!=typeof t)return{seconds:zi(t.seconds),nanos:zi(t.nanos)};var e=0,n=qi.exec(t);return Ar(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n)),t=new Date(t),{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function zi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Hi(t){return"string"==typeof t?kr.fromBase64String(t):kr.fromUint8Array(t)}function Ki(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Wi(t){return t=Gi(t.mapValue.fields.__local_write_time__.timestampValue),new Ei(t.seconds,t.nanos)}function Qi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ki(t)?4:10:Tr()}function Yi(r,i){var t,e=Qi(r);if(e!==Qi(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Wi(r).isEqual(Wi(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Gi(r.timestampValue),t=Gi(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,Hi(r.bytesValue).isEqual(Hi(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,zi((t=r).geoPointValue.latitude)===zi(e.geoPointValue.latitude)&&zi(t.geoPointValue.longitude)===zi(e.geoPointValue.longitude);case 2:return t=i,"integerValue"in(e=r)&&"integerValue"in t?zi(e.integerValue)===zi(t.integerValue):"doubleValue"in e&&"doubleValue"in t&&((e=zi(e.doubleValue))===(t=zi(t.doubleValue))?hi(e)===hi(t):isNaN(e)&&isNaN(t));case 9:return Dr(r.arrayValue.values||[],i.arrayValue.values||[],Yi);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Vi(e)!==Vi(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!Yi(e[t],n[t])))return!1;return!0}();default:return Tr()}}function Ji(t,e){return void 0!==(t.values||[]).find(function(t){return Yi(t,e)})}function Xi(t,e){var n,r,i,o=Qi(t),s=Qi(e);if(o!==s)return Or(o,s);switch(o){case 0:return 0;case 1:return Or(t.booleanValue,e.booleanValue);case 2:return n=e,(r=zi(t.integerValue||t.doubleValue))<(n=zi(n.integerValue||n.doubleValue))?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return $i(t.timestampValue,e.timestampValue);case 4:return $i(Wi(t),Wi(e));case 5:return Or(t.stringValue,e.stringValue);case 6:return i=t.bytesValue,s=e.bytesValue,i=Hi(i),s=Hi(s),i.u(s);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Or(n[i],r[i]);if(0!==o)return o}return Or(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return o=t.geoPointValue,r=e.geoPointValue,0!==(n=Or(zi(o.latitude),zi(r.latitude)))?n:Or(zi(o.longitude),zi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Xi(n[i],r[i]);if(o)return o}return Or(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Or(r[s],o[s]);if(0!==u)return u;if(0!==(u=Xi(n[r[s]],i[o[s]])))return u}return Or(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Tr()}}function $i(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Or(t,e);var n=Gi(t),t=Gi(e);return 0!==(e=Or(n.seconds,t.seconds))?e:Or(n.nanos,t.nanos)}function Zi(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=Gi(t=i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?Hi(i.bytesValue).toBase64():"referenceValue"in i?(e=i.referenceValue,Si.Lt(e).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Tr();var t,e}(t)}function to(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.Ct()}}function eo(t){return t&&"integerValue"in t}function no(t){return!!t&&"arrayValue"in t}function ro(t){return t&&"nullValue"in t}function io(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function oo(t){return t&&"mapValue"in t}var so=(co.empty=function(){return new co({mapValue:{}})},co.prototype.field=function(t){if(t.bt())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!oo(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.Vt()])||null},co.prototype.isEqual=function(t){return Yi(this.proto,t.proto)},co),uo=(ao.prototype.set=function(t,e){return this.jt(t,e),this},ao.prototype.delete=function(t){return this.jt(t,null),this},ao.prototype.jt=function(t,e){for(var n=this.Wt,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===Qi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.Vt(),e)},ao.prototype.Gt=function(){var t=this.zt(Ni.Nt(),this.Wt);return null!=t?new so(t):this.Kt},ao.prototype.zt=function(r,t){var i=this,o=!1,e=this.Kt.field(r),s=oo(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.zt(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},ao);function ao(t){void 0===t&&(t=so.empty()),this.Kt=t,this.Wt=new Map}function co(t){this.proto=t}var ho,fo,lo,po=(h(bo,lo=me=function(t,e){this.key=t,this.version=e}),bo.prototype.field=function(t){return this.Ht.field(t)},bo.prototype.data=function(){return this.Ht},bo.prototype.Yt=function(){return this.Ht.proto},bo.prototype.isEqual=function(t){return t instanceof bo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Jt===t.Jt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ht.isEqual(t.Ht)},bo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ht.toString()+", {hasLocalMutations: "+this.Jt+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(bo.prototype,"hasPendingWrites",{get:function(){return this.Jt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),bo),yo=(h(wo,fo=me),wo.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(wo.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),wo.prototype.isEqual=function(t){return t instanceof wo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},wo),vo=(h(mo,ho=me),mo.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(mo.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),mo.prototype.isEqual=function(t){return t instanceof mo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},mo),go=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Xt=null};function mo(){return null!==ho&&ho.apply(this,arguments)||this}function wo(t,e,n){var r=this;return(r=fo.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function bo(t,e,n,r){var i=this;return(i=lo.call(this,t,e)||this).Ht=n,i.Jt=!!r.Jt,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Io(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new go(t,e,n,r,i,o,s)}function Eo(t){var e=t;return null===e.Xt&&(t=e.path.Ct(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return t.field.Ct()+t.op.toString()+Zi(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return t.field.Ct()+t.dir}).join(","),ci(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Xo(e.startAt)),e.endAt&&(t+="|ub:",t+=Xo(e.endAt)),e.Xt=t),e.Xt}function _o(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!Yi(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ts(t.startAt,e.startAt)&&ts(t.endAt,e.endAt)}function To(t){return Si.qt(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ao,No=(h(So,Ao=function(){}),So.create=function(t,e,n){return t.Ot()?"in"===e||"not-in"===e?this.Zt(t,e,n):new ko(t,e,n):"array-contains"===e?new Bo(t,n):"in"===e?new Go(t,n):"not-in"===e?new zo(t,n):"array-contains-any"===e?new Ho(t,n):new So(t,e,n)},So.Zt=function(t,e,n){return new("in"===e?Po:Ro)(t,n)},So.prototype.matches=function(t){return t=t.field(this.field),"!="===this.op?null!==t&&this.te(Xi(t,this.value)):null!==t&&Qi(this.value)===Qi(t)&&this.te(Xi(t,this.value))},So.prototype.te=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Tr()}},So.prototype.ee=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},So);function So(t,e,n){var r=this;return(r=Ao.call(this)||this).field=t,r.op=e,r.value=n,r}var Oo,Do,xo,ko=(h(Uo,xo=No),Uo.prototype.matches=function(t){return t=Si.At(t.key,this.key),this.te(t)},Uo),Po=(h(Co,Do=No),Co.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Co),Ro=(h(Lo,Oo=No),Lo.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Lo);function Lo(t,e){var n=this;return(n=Oo.call(this,t,"not-in",e)||this).keys=Vo(0,e),n}function Co(t,e){var n=this;return(n=Do.call(this,t,"in",e)||this).keys=Vo(0,e),n}function Uo(t,e,n){var r=this;return(r=xo.call(this,t,e,n)||this).key=Si.Lt(n.referenceValue),r}function Vo(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Si.Lt(t.referenceValue)})}var Mo,jo,Fo,qo,Bo=(h(Jo,qo=No),Jo.prototype.matches=function(t){return no(t=t.field(this.field))&&Ji(t.arrayValue,this.value)},Jo),Go=(h(Yo,Fo=No),Yo.prototype.matches=function(t){return null!==(t=t.field(this.field))&&Ji(this.value.arrayValue,t)},Yo),zo=(h(Qo,jo=No),Qo.prototype.matches=function(t){return!Ji(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(t=t.field(this.field))&&!Ji(this.value.arrayValue,t))},Qo),Ho=(h(Wo,Mo=No),Wo.prototype.matches=function(t){var e=this;return!(!no(t=t.field(this.field))||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return Ji(e.value.arrayValue,t)})},Wo),Ko=function(t,e){this.position=t,this.before=e};function Wo(t,e){return Mo.call(this,t,"array-contains-any",e)||this}function Qo(t,e){return jo.call(this,t,"not-in",e)||this}function Yo(t,e){return Fo.call(this,t,"in",e)||this}function Jo(t,e){return qo.call(this,t,"array-contains",e)||this}function Xo(t){return(t.before?"b":"a")+":"+t.position.map(Zi).join(",")}var $o=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Zo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.Ot()?Si.At(Si.Lt(s.referenceValue),n.key):Xi(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ts(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Yi(t.position[n],e.position[n]))return!1;return!0}var es=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.ne=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.se=null,this.ie=null,this.startAt,this.endAt};function ns(t,e,n,r,i,o,s,u){return new es(t,e,n,r,i,o,s,u)}function rs(t){return new es(t)}function is(t){return!ci(t.limit)&&"F"===t.limitType}function os(t){return!ci(t.limit)&&"L"===t.limitType}function ss(t){return 0<t.ne.length?t.ne[0].field:null}function us(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.ee())return r.field}return null}function as(t){return null!==t.collectionGroup}function cs(t){var e=t;if(null===e.se){e.se=[];var n=us(e),t=ss(e);if(null!==n&&null===t)n.Ot()||e.se.push(new $o(n)),e.se.push(new $o(Ni.kt(),"asc"));else{for(var r=!1,i=0,o=e.ne;i<o.length;i++){var s=o[i];e.se.push(s),s.field.Ot()&&(r=!0)}r||(n=0<e.ne.length?e.ne[e.ne.length-1].dir:"asc",e.se.push(new $o(Ni.kt(),n)))}}return e.se}function hs(t){var e=t;if(!e.ie)if("F"===e.limitType)e.ie=Io(e.path,e.collectionGroup,cs(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=cs(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new $o(o.field,s))}var u=e.endAt?new Ko(e.endAt.position,!e.endAt.before):null,t=e.startAt?new Ko(e.startAt.position,!e.startAt.before):null;e.ie=Io(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.ie}function fs(t,e,n){return new es(t.path,t.collectionGroup,t.ne.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ls(t,e){return _o(hs(t),hs(e))&&t.limitType===e.limitType}function ps(t){return Eo(hs(t))+"|lt:"+t.limitType}function ds(t){return"Query(target="+(n=(e=hs(t)).path.Ct(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return t.field.Ct()+" "+t.op+" "+Zi(t.value)}).join(", ")+"]"),ci(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return t.field.Ct()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Xo(e.startAt)),e.endAt&&(n+=", endAt: "+Xo(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function ys(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.Bt(e.collectionGroup)&&e.path.vt(n):Si.qt(e.path)?e.path.isEqual(n):e.path.St(n))&&function(t){for(var e=0,n=i.ne;e<n.length;e++){var r=n[e];if(!r.field.Ot()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||Zo(t.startAt,cs(t),n))&&(!t.endAt||!Zo(t.endAt,cs(t),n)));var e,n}function vs(u){return function(t,e){for(var n=!1,r=0,i=cs(u);r<i.length;r++){var o=i[r],s=function(t,e,n){var r,i;switch(n=t.field.Ot()?Si.At(e.key,n.key):(r=t.field,i=n,e=e.field(r),r=i.field(r),null!==e&&null!==r?Xi(e,r):Tr()),t.dir){case"asc":return n;case"desc":return-1*n;default:return Tr()}}(o,t,e);if(0!==s)return s;n=n||o.field.Ot()}return 0}}var gs=(ms.prototype.ce=function(t){return new ms(this.target,this.targetId,this.re,t,this.oe,this.lastLimboFreeSnapshotVersion,this.resumeToken)},ms.prototype.ae=function(t,e){return new ms(this.target,this.targetId,this.re,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},ms.prototype.ue=function(t){return new ms(this.target,this.targetId,this.re,this.sequenceNumber,this.oe,t,this.resumeToken)},ms);function ms(t,e,n,r,i,o,s){void 0===i&&(i=_i.min()),void 0===o&&(o=_i.min()),void 0===s&&(s=kr.h),this.target=t,this.targetId=e,this.re=n,this.sequenceNumber=r,this.oe=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function ws(t,e){if(t.he){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:hi(e)?"-0":e}}function bs(t){return{integerValue:""+t}}function Is(t,e){return fi(e)?bs(e):ws(t,e)}function Es(t,e){return t instanceof Cs?eo(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var _s,Ts,As=(h(Os,Ts=o=function(){this.le=void 0}),Os),Ns=(h(Ss,_s=o),Ss);function Ss(t){var e=this;return(e=_s.call(this)||this).elements=t,e}function Os(){return null!==Ts&&Ts.apply(this,arguments)||this}function Ds(t,e){for(var n=Ms(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return Yi(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var xs,ks=(h(Ps,xs=o),Ps);function Ps(t){var e=this;return(e=xs.call(this)||this).elements=t,e}function Rs(t,e){for(var n=Ms(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!Yi(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Ls,Cs=(h(Us,Ls=o),Us);function Us(t,e){var n=this;return(n=Ls.call(this)||this).fe=t,n._e=e,n}function Vs(t){return zi(t.integerValue||t.doubleValue)}function Ms(t){return no(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function js(t,e){this.version=t,this.transformResults=e}var Fs=function(t,e){this.field=t,this.transform=e},qs=(Bs.de=function(){return new Bs},Bs.exists=function(t){return new Bs(void 0,t)},Bs.updateTime=function(t){return new Bs(t)},Object.defineProperty(Bs.prototype,"we",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Bs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Bs);function Bs(t,e){this.updateTime=t,this.exists=e}function Gs(t,e){return void 0!==t.updateTime?e instanceof po&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof po}function zs(t,e,n,r){return t instanceof Ys?function(t,e,n,r){if(!Gs(t.Ee,e))return e;var i=t.value;return t.fieldTransforms&&(r=eu(t.fieldTransforms,n,e,r),i=nu(t.fieldTransforms,i,r)),e=Ks(e),new po(t.key,e,i,{Jt:!0})}(t,e,r,n):t instanceof Js?function(t,e,n,r){if(!Gs(t.Ee,e))return e;var i=Ks(e),r=Zs(t,e,eu(t.fieldTransforms,n,e,r));return new po(t.key,i,r,{Jt:!0})}(t,e,r,n):Gs(t.Ee,e)?new yo(t.key,_i.min()):e}function Hs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ee.isEqual(e.Ee)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Dr(n,r,function(t,e){return t.field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Ns&&e instanceof Ns||t instanceof ks&&e instanceof ks?Dr(t.elements,e.elements,Yi):t instanceof Cs&&e instanceof Cs?Yi(t._e,e._e):t instanceof As&&e instanceof As)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.Te.isEqual(e.Te));var n,r}function Ks(t){return t instanceof po?t.version:_i.min()}var Ws,Qs,Ys=(h($s,Qs=me=function(){}),$s),Js=(h(Xs,Ws=me),Xs);function Xs(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=Ws.call(this)||this).key=t,o.data=e,o.Te=n,o.Ee=r,o.fieldTransforms=i,o.type=1,o}function $s(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=Qs.call(this)||this).key=t,i.value=e,i.Ee=n,i.fieldTransforms=r,i.type=0,i}function Zs(t,e,n){var r,i,o=t;return e=e instanceof po?e.data():so.empty(),i=new uo(e),o.Te.fields.forEach(function(t){var e;t.bt()||(null!==(e=o.data.field(t))?i.set(t,e):i.delete(t))}),r=i.Gt(),nu(t.fieldTransforms,r,n)}function tu(t,e,n){var r=[];Ar(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof po&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof Ns?Ds(o,s):o instanceof ks?Rs(o,s):u))}return r}function eu(t,e,n,r){for(var i,o=[],s=0,u=t;s<u.length;s++){var a=u[s],c=a.transform,h=null;n instanceof po&&(h=n.field(a.field)),null===h&&r instanceof po&&(h=r.field(a.field)),o.push((i=h,a=e,h=void 0,c instanceof As?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},i&&(h.fields.__previous_value__=i),{mapValue:h}):c instanceof Ns?Ds(c,i):c instanceof ks?Rs(c,i):(i=Vs(c=Es(h=c,i))+Vs(h._e),eo(c)&&eo(h._e)?bs(i):ws(h.fe,i))))}return o}function nu(t,e,n){for(var r=new uo(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.Gt()}function ru(t){this.count=t}var iu,ou,su=(h(yu,ou=me),yu),uu=(h(du,iu=me),du),au=(pu.prototype.Ie=function(t,e){return new pu(this.At,this.root.Ie(t,e,this.At).copy(null,null,hu.me,null,null))},pu.prototype.remove=function(t){return new pu(this.At,this.root.remove(t,this.At).copy(null,null,hu.me,null,null))},pu.prototype.get=function(t){for(var e=this.root;!e.bt();){var n=this.At(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},pu.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.bt();){var r=this.At(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},pu.prototype.bt=function(){return this.root.bt()},Object.defineProperty(pu.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),pu.prototype.Ae=function(){return this.root.Ae()},pu.prototype.Re=function(){return this.root.Re()},pu.prototype.Pe=function(t){return this.root.Pe(t)},pu.prototype.forEach=function(n){this.Pe(function(t,e){return n(t,e),!1})},pu.prototype.toString=function(){var n=[];return this.Pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},pu.prototype.ye=function(t){return this.root.ye(t)},pu.prototype.ge=function(){return new cu(this.root,null,this.At,!1)},pu.prototype.Ve=function(t){return new cu(this.root,t,this.At,!1)},pu.prototype.pe=function(){return new cu(this.root,null,this.At,!0)},pu.prototype.be=function(t){return new cu(this.root,t,this.At,!0)},pu),cu=(lu.prototype.De=function(){var t=this.Se.pop(),e={key:t.key,value:t.value};if(this.ve)for(t=t.left;!t.bt();)this.Se.push(t),t=t.right;else for(t=t.right;!t.bt();)this.Se.push(t),t=t.left;return e},lu.prototype.Ce=function(){return 0<this.Se.length},lu.prototype.xe=function(){if(0===this.Se.length)return null;var t=this.Se[this.Se.length-1];return{key:t.key,value:t.value}},lu),hu=(fu.prototype.copy=function(t,e,n,r,i){return new fu(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},fu.prototype.bt=function(){return!1},fu.prototype.Pe=function(t){return this.left.Pe(t)||t(this.key,this.value)||this.right.Pe(t)},fu.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},fu.prototype.min=function(){return this.left.bt()?this:this.left.min()},fu.prototype.Ae=function(){return this.min().key},fu.prototype.Re=function(){return this.right.bt()?this.key:this.right.Re()},fu.prototype.Ie=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Ie(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Ie(t,e,n))).Ne()},fu.prototype.Fe=function(){if(this.left.bt())return fu.EMPTY;var t=this;return t.left.Oe()||t.left.left.Oe()||(t=t.ke()),(t=t.copy(null,null,null,t.left.Fe(),null)).Ne()},fu.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.bt()||r.left.Oe()||r.left.left.Oe()||(r=r.ke()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Oe()&&(r=r.Me()),r.right.bt()||r.right.Oe()||r.right.left.Oe()||(r=r.$e()),0===e(t,r.key)){if(r.right.bt())return fu.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Fe())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Ne()},fu.prototype.Oe=function(){return this.color},fu.prototype.Ne=function(){var t=this;return t.right.Oe()&&!t.left.Oe()&&(t=t.Le()),t.left.Oe()&&t.left.left.Oe()&&(t=t.Me()),t.left.Oe()&&t.right.Oe()&&(t=t.Be()),t},fu.prototype.ke=function(){var t=this.Be();return t.right.left.Oe()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Me())).Le()).Be()),t},fu.prototype.$e=function(){var t=this.Be();return t.left.left.Oe()&&(t=(t=t.Me()).Be()),t},fu.prototype.Le=function(){var t=this.copy(null,null,fu.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},fu.prototype.Me=function(){var t=this.copy(null,null,fu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},fu.prototype.Be=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},fu.prototype.qe=function(){var t=this.Ue();return Math.pow(2,t)<=this.size+1},fu.prototype.Ue=function(){if(this.Oe()&&this.left.Oe())throw Tr();if(this.right.Oe())throw Tr();var t=this.left.Ue();if(t!==this.right.Ue())throw Tr();return t+(this.Oe()?0:1)},fu);function fu(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:fu.RED,this.left=null!=r?r:fu.EMPTY,this.right=null!=i?i:fu.EMPTY,this.size=this.left.size+1+this.right.size}function lu(t,e,n,r){this.ve=r,this.Se=[];for(var i=1;!t.bt();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ve?t.left:t.right;else{if(0===i){this.Se.push(t);break}this.Se.push(t),t=this.ve?t.right:t.left}}function pu(t,e){this.At=t,this.root=e||hu.EMPTY}function du(t,e){var n=this;return(n=iu.call(this)||this).key=t,n.Ee=e,n.type=3,n.fieldTransforms=[],n}function yu(t,e){var n=this;return(n=ou.call(this)||this).key=t,n.Ee=e,n.type=2,n.fieldTransforms=[],n}function vu(){this.size=0}hu.EMPTY=null,hu.RED=!0,hu.me=!1,hu.EMPTY=(Object.defineProperty(vu.prototype,"key",{get:function(){throw Tr()},enumerable:!1,configurable:!0}),Object.defineProperty(vu.prototype,"value",{get:function(){throw Tr()},enumerable:!1,configurable:!0}),Object.defineProperty(vu.prototype,"color",{get:function(){throw Tr()},enumerable:!1,configurable:!0}),Object.defineProperty(vu.prototype,"left",{get:function(){throw Tr()},enumerable:!1,configurable:!0}),Object.defineProperty(vu.prototype,"right",{get:function(){throw Tr()},enumerable:!1,configurable:!0}),vu.prototype.copy=function(t,e,n,r,i){return this},vu.prototype.Ie=function(t,e,n){return new hu(t,e)},vu.prototype.remove=function(t,e){return this},vu.prototype.bt=function(){return!0},vu.prototype.Pe=function(t){return!1},vu.prototype.ye=function(t){return!1},vu.prototype.Ae=function(){return null},vu.prototype.Re=function(){return null},vu.prototype.Oe=function(){return!1},vu.prototype.qe=function(){return!0},vu.prototype.Ue=function(){return 0},new vu);var gu=(Iu.prototype.has=function(t){return null!==this.data.get(t)},Iu.prototype.first=function(){return this.data.Ae()},Iu.prototype.last=function(){return this.data.Re()},Object.defineProperty(Iu.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Iu.prototype.indexOf=function(t){return this.data.indexOf(t)},Iu.prototype.forEach=function(n){this.data.Pe(function(t,e){return n(t),!1})},Iu.prototype.Qe=function(t,e){for(var n=this.data.Ve(t[0]);n.Ce();){var r=n.De();if(0<=this.At(r.key,t[1]))return;e(r.key)}},Iu.prototype.Ke=function(t,e){for(var n=void 0!==e?this.data.Ve(e):this.data.ge();n.Ce();)if(!t(n.De().key))return},Iu.prototype.We=function(t){return(t=this.data.Ve(t)).Ce()?t.De().key:null},Iu.prototype.ge=function(){return new mu(this.data.ge())},Iu.prototype.Ve=function(t){return new mu(this.data.Ve(t))},Iu.prototype.add=function(t){return this.copy(this.data.remove(t).Ie(t,!0))},Iu.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Iu.prototype.bt=function(){return this.data.bt()},Iu.prototype.je=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Iu.prototype.isEqual=function(t){if(!(t instanceof Iu))return!1;if(this.size!==t.size)return!1;for(var e=this.data.ge(),n=t.data.ge();e.Ce();){var r=e.De().key,i=n.De().key;if(0!==this.At(r,i))return!1}return!0},Iu.prototype.Dt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Iu.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Iu.prototype.copy=function(t){var e=new Iu(this.At);return e.data=t,e},Iu),mu=(bu.prototype.De=function(){return this.Ge.De().key},bu.prototype.Ce=function(){return this.Ge.Ce()},bu),wu=new au(Si.At);function bu(t){this.Ge=t}function Iu(t){this.At=t,this.data=new au(this.At)}var Eu=new au(Si.At),_u=new au(Si.At),Tu=new gu(Si.At);function Au(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Tu,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Nu=new gu(Or),Su=(Gu.Je=function(t){return new Gu(t.At)},Gu.prototype.has=function(t){return null!=this.ze.get(t)},Gu.prototype.get=function(t){return this.ze.get(t)},Gu.prototype.first=function(){return this.He.Ae()},Gu.prototype.last=function(){return this.He.Re()},Gu.prototype.bt=function(){return this.He.bt()},Gu.prototype.indexOf=function(t){return(t=this.ze.get(t))?this.He.indexOf(t):-1},Object.defineProperty(Gu.prototype,"size",{get:function(){return this.He.size},enumerable:!1,configurable:!0}),Gu.prototype.forEach=function(n){this.He.Pe(function(t,e){return n(t),!1})},Gu.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.ze.Ie(t.key,t),e.He.Ie(t,null))},Gu.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.ze.remove(t),this.He.remove(e)):this},Gu.prototype.isEqual=function(t){if(!(t instanceof Gu))return!1;if(this.size!==t.size)return!1;for(var e=this.He.ge(),n=t.He.ge();e.Ce();){var r=e.De().key,i=n.De().key;if(!r.isEqual(i))return!1}return!0},Gu.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Gu.prototype.copy=function(t,e){var n=new Gu;return n.At=this.At,n.ze=t,n.He=e,n},Gu),Ou=(Bu.prototype.track=function(t){var e=t.doc.key,n=this.Ye.get(e);!n||0!==t.type&&3===n.type?this.Ye=this.Ye.Ie(e,t):3===t.type&&1!==n.type?this.Ye=this.Ye.Ie(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Ye=this.Ye.Ie(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Ye=this.Ye.Ie(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Ye=this.Ye.remove(e):1===t.type&&2===n.type?this.Ye=this.Ye.Ie(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Ye=this.Ye.Ie(e,{type:2,doc:t.doc}):Tr()},Bu.prototype.Xe=function(){var n=[];return this.Ye.Pe(function(t,e){n.push(e)}),n},Bu),Du=(qu.sn=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new qu(t,e,Su.Je(e),i,n,r,!0,!1)},Object.defineProperty(qu.prototype,"hasPendingWrites",{get:function(){return!this.tn.bt()},enumerable:!1,configurable:!0}),qu.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.en===t.en&&this.tn.isEqual(t.tn)&&ls(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ze.isEqual(t.Ze)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},qu),xu=(Fu.un=function(t,e){var n=new Map;return n.set(t,ku.hn(t,e)),new Fu(_i.min(),n,Nu,wu,Au())},Fu),ku=(ju.hn=function(t,e){return new ju(kr.h,e,Au(),Au(),Au())},ju),Pu=function(t,e,n,r){this.wn=t,this.removedTargetIds=e,this.key=n,this.En=r},Ru=function(t,e){this.targetId=t,this.Tn=e},Lu=function(t,e,n,r){void 0===n&&(n=kr.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Cu=(Object.defineProperty(Mu.prototype,"ln",{get:function(){return this.Rn},enumerable:!1,configurable:!0}),Object.defineProperty(Mu.prototype,"resumeToken",{get:function(){return this.An},enumerable:!1,configurable:!0}),Object.defineProperty(Mu.prototype,"yn",{get:function(){return 0!==this.In},enumerable:!1,configurable:!0}),Object.defineProperty(Mu.prototype,"gn",{get:function(){return this.Pn},enumerable:!1,configurable:!0}),Mu.prototype.Vn=function(t){0<t.o()&&(this.Pn=!0,this.An=t)},Mu.prototype.pn=function(){var n=Au(),r=Au(),i=Au();return this.mn.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Tr()}}),new ku(this.An,this.Rn,n,r,i)},Mu.prototype.bn=function(){this.Pn=!1,this.mn=Hu()},Mu.prototype.vn=function(t,e){this.Pn=!0,this.mn=this.mn.Ie(t,e)},Mu.prototype.Sn=function(t){this.Pn=!0,this.mn=this.mn.remove(t)},Mu.prototype.Dn=function(){this.In+=1},Mu.prototype.Cn=function(){--this.In},Mu.prototype.xn=function(){this.Pn=!0,this.Rn=!0},Mu),Uu=(Vu.prototype.$n=function(t){for(var e=0,n=t.wn;e<n.length;e++){var r=n[e];t.En instanceof po?this.Ln(r,t.En):t.En instanceof yo&&this.Bn(r,t.key,t.En)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.Bn(r,t.key,t.En)},Vu.prototype.qn=function(n){var r=this;this.Un(n,function(t){var e=r.Qn(t);switch(n.state){case 0:r.Kn(t)&&e.Vn(n.resumeToken);break;case 1:e.Cn(),e.yn||e.bn(),e.Vn(n.resumeToken);break;case 2:e.Cn(),e.yn||r.removeTarget(t);break;case 3:r.Kn(t)&&(e.xn(),e.Vn(n.resumeToken));break;case 4:r.Kn(t)&&(r.Wn(t),e.Vn(n.resumeToken));break;default:Tr()}})},Vu.prototype.Un=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Fn.forEach(function(t,e){r.Kn(e)&&n(e)})},Vu.prototype.jn=function(t){var e=t.targetId,n=t.Tn.count;(t=this.Gn(e))&&(To(t=t.target)?0===n?(t=new Si(t.path),this.Bn(e,t,new yo(t,_i.min()))):Ar(1===n):this.zn(e)!==n&&(this.Wn(e),this.Mn=this.Mn.add(e)))},Vu.prototype.Hn=function(r){var i=this,o=new Map;this.Fn.forEach(function(t,e){var n=i.Gn(e);n&&(t.ln&&To(n.target)&&(n=new Si(n.target.path),null!==i.On.get(n)||i.Jn(e,n)||i.Bn(e,n,new yo(n,r))),t.gn&&(o.set(e,t.pn()),t.bn()))});var s=Au();this.kn.forEach(function(t,e){var n=!0;e.Ke(function(t){return!(t=i.Gn(t))||2===t.re||(n=!1)}),n&&(s=s.add(t))});var t=new xu(r,o,this.Mn,this.On,s);return this.On=wu,this.kn=zu(),this.Mn=new gu(Or),t},Vu.prototype.Ln=function(t,e){var n;this.Kn(t)&&(n=this.Jn(t,e.key)?2:0,this.Qn(t).vn(e.key,n),this.On=this.On.Ie(e.key,e),this.kn=this.kn.Ie(e.key,this.Yn(e.key).add(t)))},Vu.prototype.Bn=function(t,e,n){var r;this.Kn(t)&&(r=this.Qn(t),this.Jn(t,e)?r.vn(e,1):r.Sn(e),this.kn=this.kn.Ie(e,this.Yn(e).delete(t)),n&&(this.On=this.On.Ie(e,n)))},Vu.prototype.removeTarget=function(t){this.Fn.delete(t)},Vu.prototype.zn=function(t){var e=this.Qn(t).pn();return this.Nn.Xn(t).size+e._n.size-e.dn.size},Vu.prototype.Dn=function(t){this.Qn(t).Dn()},Vu.prototype.Qn=function(t){var e=this.Fn.get(t);return e||(e=new Cu,this.Fn.set(t,e)),e},Vu.prototype.Yn=function(t){var e=this.kn.get(t);return e||(e=new gu(Or),this.kn=this.kn.Ie(t,e)),e},Vu.prototype.Kn=function(t){var e=null!==this.Gn(t);return e||br("WatchChangeAggregator","Detected inactive target",t),e},Vu.prototype.Gn=function(t){var e=this.Fn.get(t);return e&&e.yn?null:this.Nn.Zn(t)},Vu.prototype.Wn=function(e){var n=this;this.Fn.set(e,new Cu),this.Nn.Xn(e).forEach(function(t){n.Bn(e,t,null)})},Vu.prototype.Jn=function(t,e){return this.Nn.Xn(t).has(e)},Vu);function Vu(t){this.Nn=t,this.Fn=new Map,this.On=wu,this.kn=zu(),this.Mn=new gu(Or)}function Mu(){this.In=0,this.mn=Hu(),this.An=kr.h,this.Rn=!1,this.Pn=!0}function ju(t,e,n,r,i){this.resumeToken=t,this.ln=e,this._n=n,this.fn=r,this.dn=i}function Fu(t,e,n,r,i){this.oe=t,this.rn=e,this.on=n,this.cn=r,this.an=i}function qu(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ze=n,this.docChanges=r,this.tn=i,this.fromCache=o,this.en=s,this.nn=u}function Bu(){this.Ye=new au(Si.At)}function Gu(n){this.At=n?function(t,e){return n(t,e)||Si.At(t.key,e.key)}:function(t,e){return Si.At(t.key,e.key)},this.ze=Eu,this.He=new au(this.At)}function zu(){return new au(Si.At)}function Hu(){return new au(Si.At)}var Ku={asc:"ASCENDING",desc:"DESCENDING"},Wu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Qu=function(t,e){this.O=t,this.he=e};function Yu(t,e){return t.he?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ju(t,e){return t.he?e.toBase64():e.toUint8Array()}function Xu(t){return Ar(!!t),_i.wt((t=Gi(t),new Ei(t.seconds,t.nanos)))}function $u(t,e){return new Ti(["projects",t.projectId,"databases",t.database]).child("documents").child(e).Ct()}function Zu(t){return Ar(ga(t=Ti.xt(t))),t}function ta(t,e){return $u(t.O,e.path)}function ea(t,e){if((e=Zu(e)).get(1)!==t.O.projectId)throw new Cr(Lr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.O.projectId);if(e.get(3)!==t.O.database)throw new Cr(Lr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.O.database);return new Si(oa(e))}function na(t,e){return $u(t.O,e)}function ra(t){return 4===(t=Zu(t)).length?Ti.Nt():oa(t)}function ia(t){return new Ti(["projects",t.O.projectId,"databases",t.O.database]).Ct()}function oa(t){return Ar(4<t.length&&"documents"===t.get(4)),t.Pt(5)}function sa(t,e,n){return{name:ta(t,e),fields:n.proto.mapValue.fields}}function ua(t,e,n){var r=ea(t,e.name),t=Xu(e.updateTime),e=new so({mapValue:{fields:e.fields}});return new po(r,t,e,{hasCommittedMutations:!!n})}function aa(t,e){var n,r,i;if(e instanceof Ys)n={update:sa(t,e.key,e.value)};else if(e instanceof su)n={delete:ta(t,e.key)};else if(e instanceof Js)n={update:sa(t,e.key,e.data),updateMask:(i=e.Te,r=[],i.fields.forEach(function(t){return r.push(t.Ct())}),{fieldPaths:r})};else{if(!(e instanceof uu))return Tr();n={verify:ta(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof As)return{fieldPath:t.field.Ct(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ns)return{fieldPath:t.field.Ct(),appendMissingElements:{values:e.elements}};if(e instanceof ks)return{fieldPath:t.field.Ct(),removeAllFromArray:{values:e.elements}};if(e instanceof Cs)return{fieldPath:t.field.Ct(),increment:e._e};throw Tr()})),e.Ee.we||(n.currentDocument=void 0!==(i=e.Ee).updateTime?{updateTime:Yu(e=t,(t=i.updateTime).Tt())}:void 0!==i.exists?{exists:i.exists}:Tr()),n}function ca(i,t){var e=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?qs.updateTime(Xu(s.updateTime)):void 0!==s.exists?qs.exists(s.exists):qs.de():qs.de(),n=t.updateTransforms?t.updateTransforms.map(function(t){return e=i,r=null,"setToServerValue"in(t=t)?(Ar("REQUEST_TIME"===t.setToServerValue),r=new As):"appendMissingElements"in t?(n=t.appendMissingElements.values||[],r=new Ns(n)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new ks(n)):"increment"in t?r=new Cs(e,t.increment):Tr(),t=Ni.Mt(t.fieldPath),new Fs(t,r);var e,n,r}):[];if(t.update){t.update.name;var r=ea(i,t.update.name),o=new so({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(s=t.updateMask.fieldPaths||[],new Fi(s.map(function(t){return Ni.Mt(t)})));return new Js(r,o,s,e,n)}return new Ys(r,o,e,n)}return t.delete?(n=ea(i,t.delete),new su(n,e)):t.verify?(t=ea(i,t.verify),new uu(t,e)):Tr()}function ha(t,e){return{documents:[na(t,e.path)]}}function fa(t,e){var n={structuredQuery:{}},r=e.path;return null!==e.collectionGroup?(n.parent=na(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=na(t,r.yt()),n.structuredQuery.from=[{collectionId:r.Vt()}]),(r=function(t){if(0!==t.length)return 1===(t=t.map(function(t){if("=="===t.op){if(io(t.value))return{unaryFilter:{field:ya(t.field),op:"IS_NAN"}};if(ro(t.value))return{unaryFilter:{field:ya(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(io(t.value))return{unaryFilter:{field:ya(t.field),op:"IS_NOT_NAN"}};if(ro(t.value))return{unaryFilter:{field:ya(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ya(t.field),op:(e=t.op,Wu[e]),value:t.value}};var e})).length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(e.filters))&&(n.structuredQuery.where=r),(r=function(t){if(0!==t.length)return t.map(function(t){return{field:ya(t.field),direction:(t=t.dir,Ku[t])}})}(e.orderBy))&&(n.structuredQuery.orderBy=r),r=e.limit,null!==(r=t.he||ci(r)?r:{value:r})&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=pa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=pa(e.endAt)),n}function la(t){var e=ra(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Ar(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=va(t.unaryFilter.field);return No.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=va(t.unaryFilter.field);return No.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":return n=va(t.unaryFilter.field),No.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return t=va(t.unaryFilter.field),No.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Tr()}}(e)]:void 0!==e.fieldFilter?[(n=e,No.create(va(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Tr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Tr():[];var n}(n.where)),t=[],n.orderBy&&(t=n.orderBy.map(function(t){return new $o(va((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e})),r=null,n.limit&&(r=ci(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=da(n.startAt));var u=null;return n.endAt&&(u=da(n.endAt)),ns(e,i,t,o,r,"F",s,u)}function pa(t){return{before:t.before,values:t.position}}function da(t){var e=!!t.before,t=t.values||[];return new Ko(t,e)}function ya(t){return{fieldPath:t.Ct()}}function va(t){return Ni.Mt(t.fieldPath)}function ga(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function ma(t){return new Qu(t,!0)}var wa,ba=(Da.prototype.catch=function(t){return this.next(void 0,t)},Da.prototype.next=function(r,i){var o=this;return this.ss&&Tr(),this.ss=!0,this.ns?this.error?this.rs(i,this.error):this.os(r,this.result):new Da(function(e,n){o.ts=function(t){o.os(r,t).next(e,n)},o.es=function(t){o.rs(i,t).next(e,n)}})},Da.prototype.cs=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Da.prototype.us=function(t){try{var e=t();return e instanceof Da?e:Da.resolve(e)}catch(t){return Da.reject(t)}},Da.prototype.os=function(t,e){return t?this.us(function(){return t(e)}):Da.resolve(e)},Da.prototype.rs=function(t,e){return t?this.us(function(){return t(e)}):Da.reject(e)},Da.resolve=function(n){return new Da(function(t,e){t(n)})},Da.reject=function(n){return new Da(function(t,e){e(n)})},Da.hs=function(t){return new Da(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Da.ls=function(t){for(var n=Da.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Da.resolve(t):e()})}(r[e]);return n},Da.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.hs(i)},Da),Ia=(Oa.open=function(t,e,n,r){try{return new Oa(e,t.transaction(r,n))}catch(t){throw new Ta(e,t)}},Object.defineProperty(Oa.prototype,"fs",{get:function(){return this._s.promise},enumerable:!1,configurable:!0}),Oa.prototype.abort=function(t){t&&this._s.reject(t),this.aborted||(br("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Oa.prototype.store=function(t){return t=this.transaction.objectStore(t),new ka(t)},Oa),Ea=(Sa.delete=function(t){return br("SimpleDb","Removing database:",t),Ra(window.indexedDB.deleteDatabase(t)).cs()},Sa.G=function(){if("undefined"==typeof indexedDB)return!1;if(Sa.Es())return!0;var t=p(),e=0<(n=Sa.ws(t))&&n<10,n=0<(n=Sa.Ts(t))&&n<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||n)},Sa.Es=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Is)},Sa.As=function(t,e){return t.store(e)},Sa.ws=function(t){return t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1",Number(t)},Sa.Ts=function(t){return t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1",Number(t)},Sa.prototype.Rs=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(br("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result,e(t)},r.onblocked=function(){n(new Ta(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){"VersionError"===(t=t.target.error).name?n(new Cr(Lr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Ta(o,t))},r.onupgradeneeded=function(t){br("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.ds.Ps(e,r.transaction,t.oldVersion,i.version).next(function(){br("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.ys&&(this.db.onversionchange=function(t){return i.ys(t)}),this.db)]}})})},Sa.prototype.gs=function(e){this.ys=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Sa.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Rs(u)];case 2:return s.db=t.sent(),e=Ia.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),ba.reject(t)}).cs(),r={},n.catch(function(){}),[4,e.fs];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,br("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Sa.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Sa),_a=(Object.defineProperty(Na.prototype,"ns",{get:function(){return this.ps},enumerable:!1,configurable:!0}),Object.defineProperty(Na.prototype,"vs",{get:function(){return this.bs},enumerable:!1,configurable:!0}),Object.defineProperty(Na.prototype,"cursor",{set:function(t){this.Vs=t},enumerable:!1,configurable:!0}),Na.prototype.done=function(){this.ps=!0},Na.prototype.Ss=function(t){this.bs=t},Na.prototype.delete=function(){return Ra(this.Vs.delete())},Na),Ta=(h(Aa,wa=Cr),Aa);function Aa(t,e){var n=this;return(n=wa.call(this,Lr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function Na(t){this.Vs=t,this.ps=!1,this.bs=null}function Sa(t,e,n){this.name=t,this.version=e,this.ds=n,12.2===Sa.ws(p())&&Ir("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Oa(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this._s=new bi,this.transaction.oncomplete=function(){n._s.resolve()},this.transaction.onabort=function(){t.error?n._s.reject(new Ta(e,t.error)):n._s.resolve()},this.transaction.onerror=function(t){t=Ca(t.target.error),n._s.reject(new Ta(e,t))}}function Da(t){var e=this;this.ts=null,this.es=null,this.result=void 0,this.error=void 0,this.ns=!1,this.ss=!1,t(function(t){e.ns=!0,e.result=t,e.ts&&e.ts(t)},function(t){e.ns=!0,e.error=t,e.es&&e.es(t)})}function xa(t){return"IndexedDbTransactionError"===t.name}var ka=(Pa.prototype.put=function(t,e){return Ra(t=void 0!==e?(br("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(br("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Pa.prototype.add=function(t){return br("SimpleDb","ADD",this.store.name,t,t),Ra(this.store.add(t))},Pa.prototype.get=function(e){var n=this;return Ra(this.store.get(e)).next(function(t){return void 0===t&&(t=null),br("SimpleDb","GET",n.store.name,e,t),t})},Pa.prototype.delete=function(t){return br("SimpleDb","DELETE",this.store.name,t),Ra(this.store.delete(t))},Pa.prototype.count=function(){return br("SimpleDb","COUNT",this.store.name),Ra(this.store.count())},Pa.prototype.Ds=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.Cs(e,function(t,e){n.push(e)}).next(function(){return n})},Pa.prototype.xs=function(t,e){return br("SimpleDb","DELETE ALL",this.store.name),(e=this.options(t,e)).Ns=!1,e=this.cursor(e),this.Cs(e,function(t,e,n){return n.delete()})},Pa.prototype.Fs=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.Cs(n,e)},Pa.prototype.Os=function(r){var t=this.cursor({});return new ba(function(n,e){t.onerror=function(t){t=Ca(t.target.error),e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Pa.prototype.Cs=function(t,i){var o=[];return new ba(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new _a(n),(t=i(n.primaryKey,n.value,e))instanceof ba&&(t=t.catch(function(t){return e.done(),ba.reject(t)}),o.push(t)),e.ns?r():null===e.vs?n.continue():n.continue(e.vs)):r()}}).next(function(){return ba.hs(o)})},Pa.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Pa.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Pa);function Pa(t){this.store=t}function Ra(t){return new ba(function(e,n){t.onsuccess=function(t){t=t.target.result,e(t)},t.onerror=function(t){t=Ca(t.target.error),n(t)}})}var La=!1;function Ca(t){var e=Ea.ws(p());if(12.2<=e&&e<13&&(e="An internal error was encountered in the Indexed Database server",0<=t.message.indexOf(e))){var n=new Cr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return La||(La=!0,setTimeout(function(){throw n},0)),n}return t}var Ua=(Va.qs=function(t,e,n,r,i){return(i=new Va(t,e,Date.now()+n,r,i)).start(n),i},Va.prototype.start=function(t){var e=this;this.Us=setTimeout(function(){return e.Qs()},t)},Va.prototype.Ks=function(){return this.Qs()},Va.prototype.cancel=function(t){null!==this.Us&&(this.clearTimeout(),this.Bs.reject(new Cr(Lr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Va.prototype.Qs=function(){var e=this;this.ks.Ws(function(){return null!==e.Us?(e.clearTimeout(),e.op().then(function(t){return e.Bs.resolve(t)})):Promise.resolve()})},Va.prototype.clearTimeout=function(){null!==this.Us&&(this.Ls(this),clearTimeout(this.Us),this.Us=null)},Va);function Va(t,e,n,r,i){this.ks=t,this.Ms=e,this.$s=n,this.op=r,this.Ls=i,this.Bs=new bi,this.then=this.Bs.promise.then.bind(this.Bs.promise),this.Bs.promise.catch(function(t){})}function Ma(t,e){if(Ir("AsyncQueue",e+": "+t),xa(t))return new Cr(Lr.UNAVAILABLE,e+": "+t);throw t}var ja,Fa,qa,Ba=(ec.prototype.reset=function(){this.Js=0},ec.prototype.Zs=function(){this.Js=this.Hs},ec.prototype.ti=function(t){var e=this;this.cancel();var n=Math.floor(this.Js+this.ei()),r=Math.max(0,Date.now()-this.Xs),i=Math.max(0,n-r);0<i&&br("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Js+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ys=this.js.ni(this.Ms,i,function(){return e.Xs=Date.now(),t()}),this.Js*=this.zs,this.Js<this.Gs&&(this.Js=this.Gs),this.Js>this.Hs&&(this.Js=this.Hs)},ec.prototype.si=function(){null!==this.Ys&&(this.Ys.Ks(),this.Ys=null)},ec.prototype.cancel=function(){null!==this.Ys&&(this.Ys.cancel(),this.Ys=null)},ec.prototype.ei=function(){return(Math.random()-.5)*this.Js},ec),o=(tc.prototype.hi=function(){return 1===this.state||2===this.state||4===this.state},tc.prototype.li=function(){return 2===this.state},tc.prototype.start=function(){3!==this.state?this.auth():this._i()},tc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.hi()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},tc.prototype.fi=function(){this.state=0,this.ui.reset()},tc.prototype.di=function(){var t=this;this.li()&&null===this.ai&&(this.ai=this.js.ni(this.ii,6e4,function(){return t.wi()}))},tc.prototype.Ei=function(t){this.Ti(),this.stream.send(t)},tc.prototype.wi=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.li()?[2,this.close(0)]:[2]})})},tc.prototype.Ti=function(){this.ai&&(this.ai.cancel(),this.ai=null)},tc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Ti(),this.ui.cancel(),this.ci++,3!==e?this.ui.reset():n&&n.code===Lr.RESOURCE_EXHAUSTED?(Ir(n.toString()),Ir("Using maximum backoff delay to prevent overloading the backend."),this.ui.Zs()):n&&n.code===Lr.UNAUTHENTICATED&&this.oi.g(),null!==this.stream&&(this.Ii(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Z(n)];case 1:return t.sent(),[2]}})})},tc.prototype.Ii=function(){},tc.prototype.auth=function(){var n=this;this.state=1;var t=this.mi(this.ci),e=this.ci;this.oi.getToken().then(function(t){n.ci===e&&n.Ai(t)},function(e){t(function(){var t=new Cr(Lr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Ri(t)})})},tc.prototype.Ai=function(t){var e=this,n=this.mi(this.ci);this.stream=this.Pi(t),this.stream.Y(function(){n(function(){return e.state=2,e.listener.Y()})}),this.stream.Z(function(t){n(function(){return e.Ri(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},tc.prototype._i=function(){var t=this;this.state=4,this.ui.ti(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},tc.prototype.Ri=function(t){return br("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},tc.prototype.mi=function(e){var n=this;return function(t){n.js.Ws(function(){return n.ci===e?t():(br("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},tc),Ga=(h(Za,qa=o),Za.prototype.Pi=function(t){return this.ri.ft("Listen",t)},Za.prototype.onMessage=function(t){this.ui.reset();var e,n=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Tr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.he?(Ar(void 0===s||"string"==typeof s),kr.fromBase64String(s||"")):(Ar(void 0===s||s instanceof Uint8Array),kr.fromUint8Array(s||new Uint8Array))),o=(u=e.targetChange.cause)&&(a=void 0===(c=u).code?Lr.UNKNOWN:yi(c.code),new Cr(a,c.message||"")),s=new Lu(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime,r=ea(t,n.document.name),i=Xu(n.document.updateTime);var u=new so({mapValue:{fields:n.document.fields}}),a=(o=new po(r,i,u,{}),n.targetIds||[]),c=n.removedTargetIds||[],s=new Pu(a,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=ea(t,n.document),i=n.readTime?Xu(n.readTime):_i.min(),u=new yo(r,i),o=n.removedTargetIds||[],s=new Pu([],o,u.key,u);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=ea(t,n.document),i=n.removedTargetIds||[],s=new Pu([],i,r,null);else{if(!("filter"in e))return Tr();e.filter,(e=e.filter).targetId,r=new ru(n=e.count||0),i=e.targetId,s=new Ru(i,r)}return s}(this.fe,t),t=!("targetChange"in(e=t))||(e=e.targetChange).targetIds&&e.targetIds.length||!e.readTime?_i.min():Xu(e.readTime);return this.listener.yi(n,t)},Za.prototype.gi=function(t){var e,n,r,i,o={};o.database=ia(this.fe),o.addTarget=(e=this.fe,(r=To(r=(n=t).target)?{documents:ha(e,r)}:{query:fa(e,r)}).targetId=n.targetId,0<n.resumeToken.o()?r.resumeToken=Ju(e,n.resumeToken):0<n.oe.u(_i.min())&&(r.readTime=Yu(e,n.oe.Tt())),r),(t=(this.fe,i=t,null==(t=function(){switch(i.re){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Tr()}}())?null:{"goog-listen-tags":t}))&&(o.labels=t),this.Ei(o)},Za.prototype.Vi=function(t){var e={};e.database=ia(this.fe),e.removeTarget=t,this.Ei(e)},Za),za=(h($a,Fa=o),Object.defineProperty($a.prototype,"bi",{get:function(){return this.pi},enumerable:!1,configurable:!0}),$a.prototype.start=function(){this.pi=!1,this.lastStreamToken=void 0,Fa.prototype.start.call(this)},$a.prototype.Ii=function(){this.pi&&this.vi([])},$a.prototype.Pi=function(t){return this.ri.ft("Write",t)},$a.prototype.onMessage=function(t){if(Ar(!!t.streamToken),this.lastStreamToken=t.streamToken,this.pi){this.ui.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Ar(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?Xu(e.updateTime):Xu(n)).isEqual(_i.min())&&(t=Xu(n)),n=null,e.transformResults&&0<e.transformResults.length&&(n=e.transformResults),new js(t,n);var e,n})):[]),n=Xu(t.commitTime);return this.listener.Si(n,e)}var r;return Ar(!t.writeResults||0===t.writeResults.length),this.pi=!0,this.listener.Di()},$a.prototype.Ci=function(){var t={};t.database=ia(this.fe),this.Ei(t)},$a.prototype.vi=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return aa(e.fe,t)})};this.Ei(t)},$a),Ha=(h(Xa,ja=function(){}),Xa.prototype.Ni=function(){if(this.xi)throw new Cr(Lr.FAILED_PRECONDITION,"The client has already been terminated.")},Xa.prototype.at=function(e,n,r){var i=this;return this.Ni(),this.credentials.getToken().then(function(t){return i.ri.at(e,n,r,t)}).catch(function(t){throw t.code===Lr.UNAUTHENTICATED&&i.credentials.g(),t})},Xa.prototype._t=function(e,n,r){var i=this;return this.Ni(),this.credentials.getToken().then(function(t){return i.ri._t(e,n,r,t)}).catch(function(t){throw t.code===Lr.UNAUTHENTICATED&&i.credentials.g(),t})},Xa.prototype.terminate=function(){this.xi=!1},Xa),Ka="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",me=(Ja.prototype.Oi=function(t){this.Fi.push(t)},Ja.prototype.ki=function(){this.Fi.forEach(function(t){return t()})},Ja),Wa={Mi:!1,$i:0,Li:0,Bi:0},Qa=(Ya.Ki=function(t){return new Ya(t,Ya.Wi,Ya.ji)},Ya);function Ya(t,e,n){this.qi=t,this.Ui=e,this.Qi=n}function Ja(){this.Fi=[]}function Xa(t,e,n){var r=this;return(r=ja.call(this)||this).credentials=t,r.ri=e,r.fe=n,r.xi=!1,r}function $a(t,e,n,r,i){var o=this;return(o=Fa.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).fe=r,o.pi=!1,o}function Za(t,e,n,r,i){var o=this;return(o=qa.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).fe=r,o}function tc(t,e,n,r,i,o){this.js=t,this.ii=n,this.ri=r,this.oi=i,this.listener=o,this.state=0,this.ci=0,this.ai=null,this.stream=null,this.ui=new Ba(t,e)}function ec(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.js=t,this.Ms=e,this.Gs=n,this.zs=r,this.Hs=i,this.Js=0,this.Ys=null,this.Xs=Date.now(),this.reset()}Qa.Wi=10,Qa.ji=1e3,Qa.Gi=new Qa(41943040,Qa.Wi,Qa.ji),Qa.zi=new Qa(-1,0,0);var nc=(rc.prototype.Ji=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},rc.prototype.next=function(){var t=++this.previousValue;return this.Yi&&this.Yi(t),t},rc);function rc(t,e){var n=this;this.previousValue=t,e&&(e.Hi=function(t){return n.Ji(t)},this.Yi=function(t){return e.Xi(t)})}function ic(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Lr.FAILED_PRECONDITION||e.message!==Ka)throw e;return br("LocalStore","Unexpectedly lost primary lease"),[2]})})}function oc(t,e){this.progress=t,this.tr=e}nc.Zi=-1;var sc=(lc.prototype.nr=function(t,e,n){for(var r,i,o,s,u,a,c=n.sr,h=0;h<this.mutations.length;h++){var f=this.mutations[h];f.key.isEqual(t)&&(r=f,u=e,i=c[h],f=a=void 0,e=r instanceof Ys?(a=i,f=(o=r).value,a.transformResults&&(s=tu(o.fieldTransforms,u,a.transformResults),f=nu(o.fieldTransforms,f,s)),new po(o.key,a.version,f,{hasCommittedMutations:!0})):r instanceof Js?(a=u,f=i,Gs((u=r).Ee,a)?(a=Zs(u,a,f.transformResults?tu(u.fieldTransforms,a,f.transformResults):[]),new po(u.key,f.version,a,{hasCommittedMutations:!0})):new vo(u.key,f.version)):new yo(r.key,i.version,{hasCommittedMutations:!0}))}return e},lc.prototype.ir=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=zs(i,e,e,this.er))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=zs(a,e,o,this.er))}return e},lc.prototype.rr=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ir(t.key,n.get(t.key));e&&(i=i.Ie(t.key,e))}),i},lc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Au())},lc.prototype.isEqual=function(t){return this.batchId===t.batchId&&Dr(this.mutations,t.mutations,Hs)&&Dr(this.baseMutations,t.baseMutations,Hs)},lc),uc=(fc.from=function(t,e,n){Ar(t.mutations.length===n.length);for(var r=_u,i=t.mutations,o=0;o<i.length;o++)r=r.Ie(i[o].key,n[o].version);return new fc(t,e,n,r)},fc),ac=(hc.prototype.get=function(t){var e=this.ur(t);if(void 0!==(e=this.lr[e]))for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.hr(i,t))return o}},hc.prototype.has=function(t){return void 0!==this.get(t)},hc.prototype.set=function(t,e){var n=this.ur(t),r=this.lr[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.hr(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.lr[n]=[[t,e]]},hc.prototype.delete=function(t){var e=this.ur(t),n=this.lr[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.hr(n[r][0],t))return 1===n.length?delete this.lr[e]:n.splice(r,1),!0;return!1},hc.prototype.forEach=function(s){Mi(this.lr,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];s(i,o)}})},hc.prototype.bt=function(){return ji(this.lr)},hc),o=(cc.prototype.wr=function(t){return(t=this._r.get(t))?t.readTime:_i.min()},cc.prototype.Er=function(t,e){this.Tr(),this._r.set(t.key,{Ir:t,readTime:e})},cc.prototype.mr=function(t,e){void 0===e&&(e=null),this.Tr(),this._r.set(t,{Ir:null,readTime:e})},cc.prototype.Ar=function(t,e){this.Tr();var n=this._r.get(e);return void 0!==n?ba.resolve(n.Ir):this.Rr(t,e)},cc.prototype.getEntries=function(t,e){return this.Pr(t,e)},cc.prototype.apply=function(t){return this.Tr(),this.dr=!0,this.yr(t)},cc.prototype.Tr=function(){},cc);function cc(){this._r=new ac(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.dr=!1}function hc(t,e){this.ur=t,this.hr=e,this.lr={}}function fc(t,e,n,r){this.batch=t,this.cr=e,this.sr=n,this.ar=r}function lc(t,e,n,r){this.batchId=t,this.er=e,this.baseMutations=n,this.mutations=r}function pc(t,e){var n=t[0],r=t[1],t=e[0],e=e[1];return 0===(t=Or(n,t))?Or(r,e):t}var dc=(wc.prototype.pr=function(){return++this.Vr},wc.prototype.br=function(t){var e=[t,this.pr()];this.buffer.size<this.gr?this.buffer=this.buffer.add(e):pc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(wc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),wc),yc=(mc.prototype.start=function(t){-1!==this.vr.params.qi&&this.Cr(t)},mc.prototype.stop=function(){this.Dr&&(this.Dr.cancel(),this.Dr=null)},Object.defineProperty(mc.prototype,"Nr",{get:function(){return null!==this.Dr},enumerable:!1,configurable:!0}),mc.prototype.Cr=function(n){var t=this,e=this.Sr?3e5:6e4;br("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Dr=this.ks.ni("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Dr=null,this.Sr=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Fr(this.vr)];case 2:return t.sent(),[3,7];case 3:return xa(e=t.sent())?(br("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,ic(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Cr(n)];case 8:return t.sent(),[2]}})})})},mc),vc=(gc.prototype.kr=function(t,e){return this.Or.Mr(t).next(function(t){return Math.floor(e/100*t)})},gc.prototype.$r=function(t,e){var n=this;if(0===e)return ba.resolve(nc.Zi);var r=new dc(e);return this.Or.Un(t,function(t){return r.br(t.sequenceNumber)}).next(function(){return n.Or.Lr(t,function(t){return r.br(t)})}).next(function(){return r.maxValue})},gc.prototype.Br=function(t,e,n){return this.Or.Br(t,e,n)},gc.prototype.qr=function(t,e){return this.Or.qr(t,e)},gc.prototype.Ur=function(e,n){var r=this;return-1===this.params.qi?(br("LruGarbageCollector","Garbage collection skipped; disabled"),ba.resolve(Wa)):this.Qr(e).next(function(t){return t<r.params.qi?(br("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.qi),Wa):r.Kr(e,n)})},gc.prototype.Qr=function(t){return this.Or.Qr(t)},gc.prototype.Kr=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.kr(e,this.params.Ui).next(function(t){return i=t>h.params.Qi?(br("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Qi+" from "+t),h.params.Qi):t,s=Date.now(),h.$r(e,i)}).next(function(t){return r=t,u=Date.now(),h.Br(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.qr(e,r)}).next(function(t){return c=Date.now(),wr()<=l.DEBUG&&br("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),ba.resolve({Mi:!0,$i:i,Li:o,Bi:t})})},gc);function gc(t,e){this.Or=t,this.params=e}function mc(t,e){this.vr=t,this.ks=e,this.Sr=!1,this.Dr=null}function wc(t){this.gr=t,this.buffer=new gu(pc),this.Vr=0}function bc(t,e,n){if(!n)throw new Cr(Lr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Ic(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Ec(t,e,n,r){if(!0===e&&!0===r)throw new Cr(Lr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function _c(t){if(!Si.qt(t))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Tc(t){if(Si.qt(t))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Ac(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Tr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Nc(t,e){if("_delegate"in t&&(t=t._),t instanceof e)return t;if(e.name===t.constructor.name)throw new Cr(Lr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw t=Ac(t),new Cr(Lr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function Sc(t,e){if(e<=0)throw new Cr(Lr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Oc=(Pc.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Pc),Dc=new Map,xc=(Object.defineProperty(kc.prototype,"app",{get:function(){if(!this.Jr)throw new Cr(Lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Jr},enumerable:!1,configurable:!0}),Object.defineProperty(kc.prototype,"Yr",{get:function(){return this.Gr},enumerable:!1,configurable:!0}),Object.defineProperty(kc.prototype,"Xr",{get:function(){return void 0!==this.Zr},enumerable:!1,configurable:!0}),kc.prototype.eo=function(t){if(this.Gr)throw new Cr(Lr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.jr=new Oc(t),void 0!==t.credentials&&(this.Hr=function(t){if(!t)return new Qr;switch(t.type){case"gapi":var e=t.client;return Ar(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Xr(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Cr(Lr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},kc.prototype.no=function(){return this.jr},kc.prototype.so=function(){return this.Gr=!0,this.jr},kc.prototype._delete=function(){return this.Zr||(this.Zr=this.io()),this.Zr},kc.prototype.io=function(){return(t=Dc.get(this))&&(br("ComponentProvider","Removing Datastore"),Dc.delete(this),t.terminate()),Promise.resolve();var t},kc);function kc(t,e){this.Wr="(lite)",this.jr=new Oc({}),this.Gr=!1,t instanceof Zr?(this.zr=t,this.Hr=new Qr):(this.Jr=t,this.zr=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Cr(Lr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zr(t.options.projectId)}(t),this.Hr=new Yr(e))}function Pc(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Cr(Lr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Cr(Lr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Ec("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Rc(t){for(var o="",e=0;e<t.length;e++)0<o.length&&(o=Lc(o)),o=function(t){for(var e=o,n=t.length,r=0;r<n;r++){var i=t.charAt(r);switch(i){case"\0":e+="";break;case"":e+="";break;default:e+=i}}return e}(t.get(e));return Lc(o)}function Lc(t){return t+""}function Cc(t){var e=t.length;if(Ar(2<=e),2===e)return Ar(""===t.charAt(0)&&""===t.charAt(1)),Ti.Nt();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Tr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Tr()}o=s+2}return new Ti(r)}function Uc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Vc=function(t,e){this.seconds=t,this.nanoseconds=e};function Mc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}function jc(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}Uc.store="owner",Uc.key="owner",Mc.store="mutationQueues",Mc.keyPath="userId",jc.store="mutations",jc.keyPath="batchId",jc.userMutationsIndex="userMutationsIndex",jc.userMutationsKeyPath=["userId","batchId"];var Fc=(qc.prefixForUser=function(t){return[t]},qc.prefixForPath=function(t,e){return[t,Rc(e)]},qc.key=function(t,e,n){return[t,Rc(e),n]},qc);function qc(){}function Bc(t,e){this.path=t,this.readTime=e}function Gc(t,e){this.path=t,this.version=e}Fc.store="documentMutations",Fc.PLACEHOLDER=new Fc;var zc=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};function Hc(t){this.byteSize=t}function Kc(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}zc.store="remoteDocuments",zc.readTimeIndex="readTimeIndex",zc.readTimeIndexPath="readTime",zc.collectionReadTimeIndex="collectionReadTimeIndex",zc.collectionReadTimeIndexPath=["parentPath","readTime"],Hc.store="remoteDocumentGlobal",Hc.key="remoteDocumentGlobalKey",Kc.store="targets",Kc.keyPath="targetId",Kc.queryTargetsIndexName="queryTargetsIndex",Kc.queryTargetsKeyPath=["canonicalId","targetId"];var Wc=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};function Qc(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function Yc(t,e){this.collectionId=t,this.parent=e}function Jc(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}function Xc(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}function $c(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}Wc.store="targetDocuments",Wc.keyPath=["targetId","path"],Wc.documentTargetsIndex="documentTargetsIndex",Wc.documentTargetsKeyPath=["path","targetId"],Qc.key="targetGlobalKey",Qc.store="targetGlobal",Yc.store="collectionParents",Yc.keyPath=["collectionId","parent"],Jc.store="clientMetadata",Jc.keyPath="clientId",Xc.store="bundles",Xc.keyPath="bundleId",$c.store="namedQueries",$c.keyPath="name";var Zc,th=f(f(f(f([Mc.store,jc.store,Fc.store,zc.store,Kc.store,Uc.store,Qc.store,Wc.store],[Jc.store]),[Hc.store]),[Yc.store]),[Xc.store,$c.store]),eh=(h(nh,Zc=me),nh);function nh(t,e){var n=this;return(n=Zc.call(this)||this).ro=t,n.oo=e,n}function rh(t,e){return Ea.As(t.ro,e)}var ih=function(t){this.co=t};function oh(t,e){if(e.document)return ua(t.co,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Si.Ut(e.noDocument.path),r=hh(e.noDocument.readTime);return new yo(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}return e.unknownDocument?(n=Si.Ut(e.unknownDocument.path),r=hh(e.unknownDocument.version),new vo(n,r)):Tr()}function sh(t,e,n){var r=uh(n),n=e.key.path.yt().Dt();if(e instanceof po){var i={name:ta(o=t.co,(s=e).key),fields:s.Yt().mapValue.fields,updateTime:Yu(o,s.version.Tt())},o=e.hasCommittedMutations;return new zc(null,null,i,o,r,n)}if(e instanceof yo){var s=e.key.path.Dt(),i=ch(e.version),o=e.hasCommittedMutations;return new zc(null,new Bc(s,i),null,o,r,n)}return e instanceof vo?(o=e.key.path.Dt(),e=ch(e.version),new zc(new Gc(o,e),null,null,!0,r,n)):Tr()}function uh(t){return[(t=t.Tt()).seconds,t.nanoseconds]}function ah(t){return t=new Ei(t[0],t[1]),_i.wt(t)}function ch(t){return t=t.Tt(),new Vc(t.seconds,t.nanoseconds)}function hh(t){return t=new Ei(t.seconds,t.nanoseconds),_i.wt(t)}function fh(e,t){for(var n=(t.baseMutations||[]).map(function(t){return ca(e.co,t)}),r=t.mutations.length-1;0<=r;--r){var i=t.mutations[r];void 0!==(null==i?void 0:i.transform)&&(t.mutations[r-1].updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r,1),--r)}var o=t.mutations.map(function(t){return ca(e.co,t)}),s=Ei.fromMillis(t.localWriteTimeMs);return new sc(t.batchId,s,n,o)}function lh(t){var e=hh(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?hh(t.lastLimboFreeSnapshotVersion):_i.min(),r=void 0!==t.query.documents?(Ar(1===(r=t.query).documents.length),hs(rs(ra(r.documents[0])))):hs(la(t.query));return new gs(r,t.targetId,0,t.lastListenSequenceNumber,e,n,kr.fromBase64String(t.resumeToken))}function ph(t,e){var n=ch(e.oe),r=ch(e.lastLimboFreeSnapshotVersion),i=(To(e.target)?ha:fa)(t.co,e.target),t=e.resumeToken.toBase64();return new Kc(e.targetId,Eo(e.target),n,t,e.sequenceNumber,r,i)}function dh(t){var e=la({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?fs(e,e.limit,"L"):e}var yh=(vh.prototype.ao=function(t,e){return gh(t).get(e).next(function(t){if(t)return{id:t.bundleId,createTime:hh(t.createTime),version:t.version}})},vh.prototype.uo=function(t,e){return gh(t).put({bundleId:e.id,createTime:ch(Xu(e.createTime)),version:e.version})},vh.prototype.ho=function(t,e){return mh(t).get(e).next(function(t){if(t)return{name:t.name,query:dh(t.bundledQuery),readTime:hh(t.readTime)}})},vh.prototype.lo=function(t,e){return mh(t).put({name:e.name,readTime:ch(Xu(e.readTime)),bundledQuery:e.bundledQuery})},vh);function vh(){}function gh(t){return rh(t,Xc.store)}function mh(t){return rh(t,$c.store)}var wh=(Th.prototype.fo=function(t,e){return this._o.add(e),ba.resolve()},Th.prototype.wo=function(t,e){return ba.resolve(this._o.getEntries(e))},Th),bh=(_h.prototype.add=function(t){var e=t.Vt(),n=t.yt(),r=this.index[e]||new gu(Ti.At),t=!r.has(n);return this.index[e]=r.add(n),t},_h.prototype.has=function(t){var e=t.Vt(),t=t.yt();return(e=this.index[e])&&e.has(t)},_h.prototype.getEntries=function(t){return(this.index[t]||new gu(Ti.At)).Dt()},_h),Ih=(Eh.prototype.fo=function(t,e){var n=this;if(this.Eo.has(e))return ba.resolve();var r=e.Vt(),i=e.yt();return t.Oi(function(){n.Eo.add(e)}),i={collectionId:r,parent:Rc(i)},Ah(t).put(i)},Eh.prototype.wo=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[xr(i),""],!1,!0);return Ah(t).Ds(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Cc(r.parent))}return o})},Eh);function Eh(){this.Eo=new bh}function _h(){this.index={}}function Th(){this._o=new bh}function Ah(t){return rh(t,Yc.store)}function Nh(t,e,n){var r=t.store(jc.store),i=t.store(Fc.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.Fs({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Ar(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],f=Fc.key(e,h.key.path,n.batchId);o.push(i.delete(f)),u.push(h.key)}return ba.hs(o).next(function(){return u})}function Sh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Tr();e=t.noDocument}return JSON.stringify(e).length}var Oh=(Dh.Ao=function(t,e,n,r){return Ar(""!==t.uid),new Dh(t.T()?t.uid:"",e,n,r)},Dh.prototype.Ro=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return kh(t).Fs({index:jc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Dh.prototype.Po=function(d,y,v,g){var m=this,w=Ph(d),b=kh(d);return b.add({}).next(function(t){Ar("number"==typeof t);for(var e,n,r,i,o,s=new sc(t,y,v,g),u=(e=m.fe,n=m.userId,i=(r=s).baseMutations.map(function(t){return aa(e.co,t)}),o=r.mutations.map(function(t){return aa(e.co,t)}),new jc(n,r.batchId,r.er.toMillis(),i,o)),a=[],c=new gu(function(t,e){return Or(t.Ct(),e.Ct())}),h=0,f=g;h<f.length;h++){var l=f[h],p=Fc.key(m.userId,l.key.path,t),c=c.add(l.key.path.yt());a.push(b.put(u)),a.push(w.put(p,Fc.PLACEHOLDER))}return c.forEach(function(t){a.push(m.To.fo(d,t))}),d.Oi(function(){m.mo[t]=s.keys()}),ba.hs(a).next(function(){return s})})},Dh.prototype.yo=function(t,e){var n=this;return kh(t).get(e).next(function(t){return t?(Ar(t.userId===n.userId),fh(n.fe,t)):null})},Dh.prototype.Vo=function(t,e){var n=this;return this.mo[e]?ba.resolve(this.mo[e]):this.yo(t,e).next(function(t){return t?(t=t.keys(),n.mo[e]=t):null})},Dh.prototype.po=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return kh(t).Fs({index:jc.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Ar(e.batchId>=i),o=fh(r.fe,e)),n.done()}).next(function(){return o})},Dh.prototype.bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return kh(t).Fs({index:jc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Dh.prototype.vo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return kh(t).Ds(jc.userMutationsIndex,n).next(function(t){return t.map(function(t){return fh(e.fe,t)})})},Dh.prototype.So=function(o,s){var u=this,t=Fc.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return Ph(o).Fs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Cc(i);if(r===u.userId&&s.path.isEqual(i))return kh(o).get(t).next(function(t){if(!t)throw Tr();Ar(t.userId===u.userId),a.push(fh(u.fe,t))});n.done()}).next(function(){return a})},Dh.prototype.Do=function(e,t){var s=this,u=new gu(Or),n=[];return t.forEach(function(o){var t=Fc.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=Ph(e).Fs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Cc(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),ba.hs(n).next(function(){return s.Co(e,u)})},Dh.prototype.xo=function(t,e){var o=this,s=e.path,u=s.length+1,e=Fc.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new gu(Or);return Ph(t).Fs({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Cc(i);r===o.userId&&s.vt(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.Co(t,a)})},Dh.prototype.Co=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(kh(e).get(t).next(function(t){if(null===t)throw Tr();Ar(t.userId===n.userId),r.push(fh(n.fe,t))}))}),ba.hs(i).next(function(){return r})},Dh.prototype.No=function(e,n){var r=this;return Nh(e.ro,this.userId,n).next(function(t){return e.Oi(function(){r.Fo(n.batchId)}),ba.forEach(t,function(t){return r.Io.Oo(e,t)})})},Dh.prototype.Fo=function(t){delete this.mo[t]},Dh.prototype.ko=function(e){var i=this;return this.Ro(e).next(function(t){if(!t)return ba.resolve();var t=IDBKeyRange.lowerBound(Fc.prefixForUser(i.userId)),r=[];return Ph(e).Fs({range:t},function(t,e,n){t[0]===i.userId?(t=Cc(t[1]),r.push(t)):n.done()}).next(function(){Ar(0===r.length)})})},Dh.prototype.Mo=function(t,e){return xh(t,this.userId,e)},Dh.prototype.$o=function(t){var e=this;return Rh(t).get(this.userId).next(function(t){return t||new Mc(e.userId,-1,"")})},Dh);function Dh(t,e,n,r){this.userId=t,this.fe=e,this.To=n,this.Io=r,this.mo={}}function xh(t,o,e){var s=(e=Fc.prefixForPath(o,e.path))[1],e=IDBKeyRange.lowerBound(e),u=!1;return Ph(t).Fs({range:e,Ns:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function kh(t){return rh(t,jc.store)}function Ph(t){return rh(t,Fc.store)}function Rh(t){return rh(t,Mc.store)}var Lh=(Vh.prototype.next=function(){return this.Lo+=2,this.Lo},Vh.Bo=function(){return new Vh(0)},Vh.qo=function(){return new Vh(-1)},Vh),Ch=(Uh.prototype.Uo=function(n){var r=this;return this.Qo(n).next(function(t){var e=new Lh(t.highestTargetId);return t.highestTargetId=e.next(),r.Ko(n,t).next(function(){return t.highestTargetId})})},Uh.prototype.Wo=function(t){return this.Qo(t).next(function(t){return _i.wt(new Ei(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Uh.prototype.jo=function(t){return this.Qo(t).next(function(t){return t.highestListenSequenceNumber})},Uh.prototype.Go=function(e,n,r){var i=this;return this.Qo(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.Tt()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Ko(e,t)})},Uh.prototype.zo=function(e,n){var r=this;return this.Ho(e,n).next(function(){return r.Qo(e).next(function(t){return t.targetCount+=1,r.Jo(n,t),r.Ko(e,t)})})},Uh.prototype.Yo=function(t,e){return this.Ho(t,e)},Uh.prototype.Xo=function(e,t){var n=this;return this.Zo(e,t.targetId).next(function(){return Mh(e).delete(t.targetId)}).next(function(){return n.Qo(e)}).next(function(t){return Ar(0<t.targetCount),--t.targetCount,n.Ko(e,t)})},Uh.prototype.Br=function(n,r,i){var o=this,s=0,u=[];return Mh(n).Fs(function(t,e){(e=lh(e)).sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.Xo(n,e)))}).next(function(){return ba.hs(u)}).next(function(){return s})},Uh.prototype.Un=function(t,n){return Mh(t).Fs(function(t,e){e=lh(e),n(e)})},Uh.prototype.Qo=function(t){return jh(t).get(Qc.key).next(function(t){return Ar(null!==t),t})},Uh.prototype.Ko=function(t,e){return jh(t).put(Qc.key,e)},Uh.prototype.Ho=function(t,e){return Mh(t).put(ph(this.fe,e))},Uh.prototype.Jo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Uh.prototype.tc=function(t){return this.Qo(t).next(function(t){return t.targetCount})},Uh.prototype.ec=function(t,r){var e=Eo(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return Mh(t).Fs({range:e,index:Kc.queryTargetsIndexName},function(t,e,n){e=lh(e),_o(r,e.target)&&(i=e,n.done())}).next(function(){return i})},Uh.prototype.nc=function(n,t,r){var i=this,o=[],s=Fh(n);return t.forEach(function(t){var e=Rc(t.path);o.push(s.put(new Wc(r,e))),o.push(i.Io.sc(n,r,t))}),ba.hs(o)},Uh.prototype.ic=function(n,t,r){var i=this,o=Fh(n);return ba.forEach(t,function(t){var e=Rc(t.path);return ba.hs([o.delete([r,e]),i.Io.rc(n,r,t)])})},Uh.prototype.Zo=function(t,e){return t=Fh(t),e=IDBKeyRange.bound([e],[e+1],!1,!0),t.delete(e)},Uh.prototype.oc=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Fh(t),r=Au();return t.Fs({range:e,Ns:!0},function(t,e,n){t=Cc(t[1]),t=new Si(t),r=r.add(t)}).next(function(){return r})},Uh.prototype.Mo=function(t,e){var e=Rc(e.path),e=IDBKeyRange.bound([e],[xr(e)],!1,!0),i=0;return Fh(t).Fs({index:Wc.documentTargetsIndex,Ns:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Uh.prototype.Zn=function(t,e){return Mh(t).get(e).next(function(t){return t?lh(t):null})},Uh);function Uh(t,e){this.Io=t,this.fe=e}function Vh(t){this.Lo=t}function Mh(t){return rh(t,Kc.store)}function jh(t){return rh(t,Qc.store)}function Fh(t){return rh(t,Wc.store)}var qh=(Bh.prototype.Mr=function(t){var n=this.cc(t);return this.db.ac().tc(t).next(function(e){return n.next(function(t){return e+t})})},Bh.prototype.cc=function(t){var e=0;return this.Lr(t,function(t){e++}).next(function(){return e})},Bh.prototype.Un=function(t,e){return this.db.ac().Un(t,e)},Bh.prototype.Lr=function(t,n){return this.uc(t,function(t,e){return n(e)})},Bh.prototype.sc=function(t,e,n){return Gh(t,n)},Bh.prototype.rc=function(t,e,n){return Gh(t,n)},Bh.prototype.Br=function(t,e,n){return this.db.ac().Br(t,e,n)},Bh.prototype.Oo=Gh,Bh.prototype.hc=function(t,e){return r=e,i=!1,Rh(n=t).Os(function(t){return xh(n,t,r).next(function(t){return t&&(i=!0),ba.resolve(!t)})}).next(function(){return i});var n,r,i},Bh.prototype.qr=function(n,r){var i=this,o=this.db._c().lc(),s=[],u=0;return this.uc(n,function(e,t){t<=r&&(t=i.hc(n,e).next(function(t){if(!t)return u++,o.Ar(n,e).next(function(){return o.mr(e),Fh(n).delete([0,Rc(e.path)])})}),s.push(t))}).next(function(){return ba.hs(s)}).next(function(){return o.apply(n)}).next(function(){return u})},Bh.prototype.removeTarget=function(t,e){return e=e.ce(t.oo),this.db.ac().Yo(t,e)},Bh.prototype.fc=Gh,Bh.prototype.uc=function(t,r){var i,t=Fh(t),o=nc.Zi;return t.Fs({index:Wc.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==nc.Zi&&r(new Si(Cc(i)),o),o=e,i=t):o=nc.Zi}).next(function(){o!==nc.Zi&&r(new Si(Cc(i)),o)})},Bh.prototype.Qr=function(t){return this.db._c().dc(t)},Bh);function Bh(t,e){this.db=t,this.vr=new vc(this,e)}function Gh(t,e){return Fh(t).put((t=t.oo,new Wc(0,Rc(e.path),t)))}var zh,Hh=(Qh.prototype.Er=function(t,e,n){return Jh(t).put(Xh(e),n)},Qh.prototype.mr=function(t,e){return t=Jh(t),e=Xh(e),t.delete(e)},Qh.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.wc(e,t)})},Qh.prototype.Ar=function(t,e){var n=this;return Jh(t).get(Xh(e)).next(function(t){return n.Ec(t)})},Qh.prototype.Tc=function(t,e){var n=this;return Jh(t).get(Xh(e)).next(function(t){var e=n.Ec(t);return e?{Ir:e,size:Sh(t)}:null})},Qh.prototype.getEntries=function(t,e){var n=this,r=wu;return this.Ic(t,e,function(t,e){e=n.Ec(e),r=r.Ie(t,e)}).next(function(){return r})},Qh.prototype.mc=function(t,e){var r=this,i=wu,o=new au(Si.At);return this.Ic(t,e,function(t,e){var n=r.Ec(e);o=n?(i=i.Ie(t,n),o.Ie(t,Sh(e))):(i=i.Ie(t,null),o.Ie(t,0))}).next(function(){return{Ac:i,Rc:o}})},Qh.prototype.Ic=function(t,e,i){if(e.bt())return ba.resolve();var n=IDBKeyRange.bound(e.first().path.Dt(),e.last().path.Dt()),o=e.ge(),s=o.De();return Jh(t).Fs({range:n},function(t,e,n){for(var r=Si.Ut(t);s&&Si.At(s,r)<0;)i(s,null),s=o.De();s&&s.isEqual(r)&&(i(s,e),s=o.Ce()?o.De():null),s?n.Ss(s.path.Dt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.Ce()?o.De():null})},Qh.prototype.Pc=function(t,r,e){var n,i=this,o=Eu,s=r.path.length+1,u={};return e.isEqual(_i.min())?(n=r.path.Dt(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.Dt(),e=uh(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=zc.collectionReadTimeIndex),Jh(t).Fs(u,function(t,e,n){t.length===s&&(e=oh(i.fe,e),r.path.vt(e.key.path)?e instanceof po&&ys(r,e)&&(o=o.Ie(e.key,e)):n.done())}).next(function(){return o})},Qh.prototype.lc=function(t){return new Kh(this,!!t&&t.yc)},Qh.prototype.dc=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Qh.prototype.getMetadata=function(t){return Yh(t).get(Hc.key).next(function(t){return Ar(!!t),t})},Qh.prototype.wc=function(t,e){return Yh(t).put(Hc.key,e)},Qh.prototype.Ec=function(t){return!t||(t=oh(this.fe,t))instanceof yo&&t.version.isEqual(_i.min())?null:t},Qh),Kh=(h(Wh,zh=o),Wh.prototype.yr=function(i){var o=this,s=[],u=0,a=new gu(function(t,e){return Or(t.Ct(),e.Ct())});return this._r.forEach(function(t,e){var n,r=o.Vc.get(t);e.Ir?(n=sh(o.gc.fe,e.Ir,o.wr(t)),a=a.add(t.path.yt()),e=Sh(n),u+=e-r,s.push(o.gc.Er(i,t,n))):(u-=r,o.yc?(r=sh(o.gc.fe,new yo(t,_i.min()),o.wr(t)),s.push(o.gc.Er(i,t,r))):s.push(o.gc.mr(i,t)))}),a.forEach(function(t){s.push(o.gc.To.fo(i,t))}),s.push(this.gc.updateMetadata(i,u)),ba.hs(s)},Wh.prototype.Rr=function(t,e){var n=this;return this.gc.Tc(t,e).next(function(t){return null===t?(n.Vc.set(e,0),null):(n.Vc.set(e,t.size),t.Ir)})},Wh.prototype.Pr=function(t,e){var n=this;return this.gc.mc(t,e).next(function(t){var e=t.Ac;return t.Rc.forEach(function(t,e){n.Vc.set(t,e)}),e})},Wh);function Wh(t,e){var n=this;return(n=zh.call(this)||this).gc=t,n.yc=e,n.Vc=new ac(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function Qh(t,e){this.fe=t,this.To=e}function Yh(t){return rh(t,Hc.store)}function Jh(t){return rh(t,zc.store)}function Xh(t){return t.path.Dt()}var $h=(Zh.prototype.Ps=function(e,n,t,r){var i=this;Ar(t<r&&0<=t&&r<=11);var o=new Ia("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(Uc.store),(s=e).createObjectStore(Mc.store,{keyPath:Mc.keyPath}),s.createObjectStore(jc.store,{keyPath:jc.keyPath,autoIncrement:!0}).createIndex(jc.userMutationsIndex,jc.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Fc.store),tf(e),e.createObjectStore(zc.store));var s,u=ba.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(Wc.store),s.deleteObjectStore(Kc.store),s.deleteObjectStore(Qc.store),tf(e)),u=u.next(function(){return t=o.store(Qc.store),e=new Qc(0,0,_i.min().Tt(),0),t.put(Qc.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(jc.store).Ds().next(function(t){n.deleteObjectStore(jc.store),n.createObjectStore(jc.store,{keyPath:jc.keyPath,autoIncrement:!0}).createIndex(jc.userMutationsIndex,jc.userMutationsKeyPath,{unique:!0});var e=r.store(jc.store),t=t.map(function(t){return e.put(t)});return ba.hs(t)});var n,r})),u=u.next(function(){e.createObjectStore(Jc.store,{keyPath:Jc.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.bc(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore(Hc.store),i.vc(o)})),t<7&&7<=r&&(u=u.next(function(){return i.Sc(o)})),t<8&&8<=r&&(u=u.next(function(){return i.Dc(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(zc.store)).createIndex(zc.readTimeIndex,zc.readTimeIndexPath,{unique:!1}),t.createIndex(zc.collectionReadTimeIndex,zc.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.Cc(o)})),t<11&&11<=r&&(u=u.next(function(){e.createObjectStore(Xc.store,{keyPath:Xc.keyPath}),e.createObjectStore($c.store,{keyPath:$c.keyPath})})),u},Zh.prototype.vc=function(e){var n=0;return e.store(zc.store).Fs(function(t,e){n+=Sh(e)}).next(function(){var t=new Hc(n);return e.store(Hc.store).put(Hc.key,t)})},Zh.prototype.bc=function(n){var r=this,t=n.store(Mc.store),i=n.store(jc.store);return t.Ds().next(function(t){return ba.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.Ds(jc.userMutationsIndex,t).next(function(t){return ba.forEach(t,function(t){return Ar(t.userId===e.userId),t=fh(r.fe,t),Nh(n,e.userId,t).next(function(){})})})})})},Zh.prototype.Sc=function(t){var o=t.store(Wc.store),e=t.store(zc.store);return t.store(Qc.store).get(Qc.key).next(function(r){var i=[];return e.Fs(function(t,e){var n=new Ti(t),t=[0,Rc(n)];i.push(o.get(t).next(function(t){return t?ba.resolve():o.put(new Wc(0,Rc(n),r.highestListenSequenceNumber))}))}).next(function(){return ba.hs(i)})})},Zh.prototype.Dc=function(t,e){function r(t){if(i.add(t)){var e=t.Vt(),t=t.yt();return n.put({collectionId:e,parent:Rc(t)})}}t.createObjectStore(Yc.store,{keyPath:Yc.keyPath});var n=e.store(Yc.store),i=new bh;return e.store(zc.store).Fs({Ns:!0},function(t,e){return r((t=new Ti(t)).yt())}).next(function(){return e.store(Fc.store).Fs({Ns:!0},function(t,e){t[0];var n=t[1];return r((n=(t[2],Cc(n))).yt())})})},Zh.prototype.Cc=function(t){var n=this,r=t.store(Kc.store);return r.Fs(function(t,e){return e=lh(e),e=ph(n.fe,e),r.put(e)})},Zh);function Zh(t){this.fe=t}function tf(t){t.createObjectStore(Wc.store,{keyPath:Wc.keyPath}).createIndex(Wc.documentTargetsIndex,Wc.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Kc.store,{keyPath:Kc.keyPath}).createIndex(Kc.queryTargetsIndexName,Kc.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Qc.store)}var ef="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",nf=(rf.prototype.start=function(){var e=this;return this.Gc().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Cr(Lr.FAILED_PRECONDITION,ef);return e.zc(),e.Hc(),e.Jc(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Qc.jo(t)})}).then(function(t){e.Fc=new nc(t,e.xc)}).then(function(){e.Oc=!0}).catch(function(t){return e.Uc&&e.Uc.close(),Promise.reject(t)})},rf.prototype.Yc=function(n){var t=this;return this.Bc=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.Nr?[2,n(e)]:[2]})})},n(this.isPrimary)},rf.prototype.Xc=function(n){var t=this;this.Uc.gs(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},rf.prototype.Zc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.js.Ws(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Nr?[4,this.Gc()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},rf.prototype.Gc=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return sf(e).put(new Jc(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.ta(e).next(function(t){t||(n.isPrimary=!1,n.js.ea(function(){return n.Bc(!1)}))})}).next(function(){return n.na(e)}).next(function(t){return n.isPrimary&&!t?n.sa(e).next(function(){return!1}):!!t&&n.ia(e).next(function(){return!0})})}).catch(function(t){if(xa(t))return br("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return br("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.js.ea(function(){return n.Bc(t)}),n.isPrimary=t})},rf.prototype.ta=function(t){var e=this;return of(t).get(Uc.key).next(function(t){return ba.resolve(e.ra(t))})},rf.prototype.oa=function(t){return sf(t).delete(this.clientId)},rf.prototype.ca=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.aa(this.Lc,18e5)?[3,2]:(this.Lc=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=rh(t,Jc.store);return r.Ds().next(function(t){var e=o.ua(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return ba.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.jc)for(n=0,r=e;n<r.length;n++)i=r[n],this.jc.removeItem(this.ha(i.clientId));t.label=2;case 2:return[2]}})})},rf.prototype.Jc=function(){var t=this;this.$c=this.js.ni("client_metadata_refresh",4e3,function(){return t.Gc().then(function(){return t.ca()}).then(function(){return t.Jc()})})},rf.prototype.ra=function(t){return!!t&&t.ownerId===this.clientId},rf.prototype.na=function(e){var r=this;return this.Nc?ba.resolve(!0):of(e).get(Uc.key).next(function(t){if(null!==t&&r.aa(t.leaseTimestampMs,5e3)&&!r.la(t.ownerId)){if(r.ra(t)&&r.networkEnabled)return!0;if(!r.ra(t)){if(!t.allowTabSynchronization)throw new Cr(Lr.FAILED_PRECONDITION,ef);return!1}}return!(!r.networkEnabled||!r.inForeground)||sf(e).Ds().next(function(t){return void 0===r.ua(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&br("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},rf.prototype.L=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.Oc=!1,this._a(),this.$c&&(this.$c.cancel(),this.$c=null),this.fa(),this.da(),[4,this.Uc.runTransaction("shutdown","readwrite",[Uc.store,Jc.store],function(t){var e=new eh(t,nc.Zi);return n.sa(e).next(function(){return n.oa(e)})})];case 1:return t.sent(),this.Uc.close(),this.wa(),[2]}})})},rf.prototype.ua=function(t,e){var n=this;return t.filter(function(t){return n.aa(t.updateTimeMs,e)&&!n.la(t.clientId)})},rf.prototype.Ea=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return sf(t).Ds().next(function(t){return e.ua(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(rf.prototype,"Nr",{get:function(){return this.Oc},enumerable:!1,configurable:!0}),rf.prototype.Ta=function(t){return Oh.Ao(t,this.fe,this.To,this.Io)},rf.prototype.ac=function(){return this.Qc},rf.prototype._c=function(){return this.Kc},rf.prototype.Ia=function(){return this.To},rf.prototype.ma=function(){return this.Wc},rf.prototype.runTransaction=function(e,n,r){var i=this;br("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Uc.runTransaction(e,t,th,function(t){return o=new eh(t,i.Fc?i.Fc.next():nc.Zi),"readwrite-primary"===n?i.ta(o).next(function(t){return!!t||i.na(o)}).next(function(t){if(!t)throw Ir("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.js.ea(function(){return i.Bc(!1)}),new Cr(Lr.FAILED_PRECONDITION,Ka);return r(o)}).next(function(t){return i.ia(o).next(function(){return t})}):i.Aa(o).next(function(){return r(o)})}).then(function(t){return o.ki(),t})},rf.prototype.Aa=function(t){var e=this;return of(t).get(Uc.key).next(function(t){if(null!==t&&e.aa(t.leaseTimestampMs,5e3)&&!e.la(t.ownerId)&&!e.ra(t)&&!(e.Nc||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Cr(Lr.FAILED_PRECONDITION,ef)})},rf.prototype.ia=function(t){var e=new Uc(this.clientId,this.allowTabSynchronization,Date.now());return of(t).put(Uc.key,e)},rf.G=function(){return Ea.G()},rf.prototype.sa=function(t){var e=this,n=of(t);return n.get(Uc.key).next(function(t){return e.ra(t)?(br("IndexedDbPersistence","Releasing primary lease."),n.delete(Uc.key)):ba.resolve()})},rf.prototype.aa=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Ir("Detected an update time that is in the future: "+t+" > "+n),1))},rf.prototype.zc=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Mc=function(){t.js.Ws(function(){return t.inForeground="visible"===t.document.visibilityState,t.Gc()})},this.document.addEventListener("visibilitychange",this.Mc),this.inForeground="visible"===this.document.visibilityState)},rf.prototype.fa=function(){this.Mc&&(this.document.removeEventListener("visibilitychange",this.Mc),this.Mc=null)},rf.prototype.Hc=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.kc=function(){e._a(),e.js.Ws(function(){return e.L()})},this.window.addEventListener("unload",this.kc))},rf.prototype.da=function(){this.kc&&(this.window.removeEventListener("unload",this.kc),this.kc=null)},rf.prototype.la=function(t){try{var e=null!==(null===(e=this.jc)||void 0===e?void 0:e.getItem(this.ha(t)));return br("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Ir("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},rf.prototype._a=function(){if(this.jc)try{this.jc.setItem(this.ha(this.clientId),String(Date.now()))}catch(t){Ir("Failed to set zombie client id.",t)}},rf.prototype.wa=function(){if(this.jc)try{this.jc.removeItem(this.ha(this.clientId))}catch(t){}},rf.prototype.ha=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},rf);function rf(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.js=i,this.window=o,this.document=s,this.xc=a,this.Nc=c,this.Fc=null,this.Oc=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kc=null,this.inForeground=!1,this.Mc=null,this.$c=null,this.Lc=Number.NEGATIVE_INFINITY,this.Bc=function(t){return Promise.resolve()},!rf.G())throw new Cr(Lr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Io=new qh(this,r),this.qc=e+"main",this.fe=new ih(u),this.Uc=new Ea(this.qc,11,new $h(this.fe)),this.Qc=new Ch(this.Io,this.fe),this.To=new Ih,this.Kc=(e=this.fe,u=this.To,new Hh(e,u)),this.Wc=new yh,this.window&&this.window.localStorage?this.jc=this.window.localStorage:(this.jc=null,!1===c&&Ir("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function of(t){return rh(t,Uc.store)}function sf(t){return rh(t,Jc.store)}function uf(t,e){var n=t.projectId;return t.M||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var af=(yf.prototype.Pa=function(e,n){var r=this;return this.Ra.So(e,n).next(function(t){return r.ya(e,n,t)})},yf.prototype.ya=function(t,r,i){return this.Kc.Ar(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ir(r,t);return t})},yf.prototype.ga=function(t,e,i){var o=wu;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ir(t,e);o=o.Ie(t,e)}),o},yf.prototype.Va=function(e,t){var n=this;return this.Kc.getEntries(e,t).next(function(t){return n.pa(e,t)})},yf.prototype.pa=function(e,r){var i=this;return this.Ra.Do(e,r).next(function(t){var t=i.ga(e,r,t),n=wu;return t.forEach(function(t,e){e=e||new yo(t,_i.min()),n=n.Ie(t,e)}),n})},yf.prototype.Pc=function(t,e,n){return r=e,Si.qt(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.ba(t,e.path):as(e)?this.va(t,e,n):this.Sa(t,e,n);var r},yf.prototype.ba=function(t,e){return this.Pa(t,new Si(e)).next(function(t){var e=Eu;return t instanceof po&&(e=e.Ie(t.key,t)),e})},yf.prototype.va=function(n,r,i){var o=this,s=r.collectionGroup,u=Eu;return this.To.wo(n,s).next(function(t){return ba.forEach(t,function(t){var e=(e=r,t=t.child(s),new es(t,null,e.ne.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.Sa(n,e,i).next(function(t){t.forEach(function(t,e){u=u.Ie(t,e)})})}).next(function(){return u})})},yf.prototype.Sa=function(e,n,t){var a,c,r=this;return this.Kc.Pc(e,n,t).next(function(t){return a=t,r.Ra.xo(e,n)}).next(function(t){return c=t,r.Da(e,c,a).next(function(t){a=t;for(var e=0,n=c;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,s=zs(s,s=a.get(u),s,r.er);a=s instanceof po?a.Ie(u,s):a.remove(u)}})}).next(function(){return a.forEach(function(t,e){ys(n,e)||(a=a.remove(t))}),a})},yf.prototype.Da=function(t,e,n){for(var r=Au(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Js&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Kc.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof po&&(c=c.Ie(t,e))}),c})},yf),cf=(df.Na=function(t,e){for(var n=Au(),r=Au(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new df(t,e.fromCache,n,r)},df),hf=(pf.prototype.Fa=function(t){this.Oa=t},pf.prototype.Pc=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.ne.length||1===r.ne.length&&r.ne[0].field.Ot())||i.isEqual(_i.min())?this.ka(e,r):this.Oa.Va(e,o).next(function(t){var n=s.Ma(r,t);return(is(r)||os(r))&&s.$a(r.limitType,n,o,i)?s.ka(e,r):(wr()<=l.DEBUG&&br("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ds(r)),s.Oa.Pc(e,r,i).next(function(e){return n.forEach(function(t){e=e.Ie(t.key,t)}),e}))})},pf.prototype.Ma=function(n,t){var r=new gu(vs(n));return t.forEach(function(t,e){e instanceof po&&ys(n,e)&&(r=r.add(e))}),r},pf.prototype.$a=function(t,e,n,r){return n.size!==e.size||!!(e="F"===t?e.last():e.first())&&(e.hasPendingWrites||0<e.version.u(r))},pf.prototype.ka=function(t,e){return wr()<=l.DEBUG&&br("QueryEngine","Using full collection scan to execute query:",ds(e)),this.Oa.Pc(t,e,_i.min())},pf),ff=(lf.prototype.Fr=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Ur(t,n.Ba)})},lf);function lf(t,e,n,r){this.persistence=t,this.La=e,this.fe=r,this.Ba=new au(Or),this.qa=new ac(Eo,_o),this.Ua=_i.min(),this.Ra=t.Ta(n),this.Qa=t._c(),this.Qc=t.ac(),this.Ka=new af(this.Qa,this.Ra,this.persistence.Ia()),this.Wc=t.ma(),this.La.Fa(this.Ka)}function pf(){}function df(t,e,n,r){this.targetId=t,this.fromCache=e,this.Ca=n,this.xa=r}function yf(t,e,n){this.Kc=t,this.Ra=e,this.To=n}function vf(t,e,n,r){return new ff(t,e,n,r)}function gf(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ra,m=e.Ka,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Ra.vo(v).next(function(t){return g=t,n=e.persistence.Ta(o),m=new af(e.Qa,n,e.persistence.Ia()),n.vo(v)}).next(function(t){for(var e=[],n=[],r=Au(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Va(v,r).next(function(t){return{Wa:t,ja:e,Ga:n}})})})];case 1:return r=t.sent(),[2,(e.Ra=n,e.Ka=m,e.La.Fa(e.Ka),r)]}})})}function mf(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Qc.Wo(t)})}function wf(t,s,e,u,a){var n=Au();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=wu;return e.forEach(function(t,e){var n=i.get(t),r=(null==a?void 0:a.get(t))||u;e instanceof yo&&e.version.isEqual(_i.min())?(s.mr(t,r),o=o.Ie(t,e)):null==n||0<e.version.u(n.version)||0===e.version.u(n.version)&&n.hasPendingWrites?(s.Er(e,r),o=o.Ie(t,e)):br("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function bf(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Qc.ec(e,r).next(function(t){return t?(n=t,ba.resolve(n)):i.Qc.Uo(e).next(function(t){return n=new gs(r,t,0,e.oo),i.Qc.zo(e,n).next(function(){return n})})})}).then(function(t){var e=i.Ba.get(t.targetId);return(null===e||0<t.oe.u(e.oe))&&(i.Ba=i.Ba.Ie(t.targetId,t),i.qa.set(r,t.targetId)),t})}function If(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).Ba.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Io.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!xa(r=t.sent()))throw r;return br("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Ba=e.Ba.remove(o),e.qa.delete(n.target),[2]}})})}function Ef(t,o,s){var u=t,a=_i.min(),c=Au();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=hs(o),(void 0!==(t=(i=t).qa.get(r))?ba.resolve(i.Ba.get(t)):i.Qc.ec(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.Qc.oc(e,t.targetId).next(function(t){c=t})}).next(function(){return u.La.Pc(e,o,s?a:_i.min(),s?c:Au())}).next(function(t){return{documents:t,za:c}});var t,n,r,i})}function _f(t,e){var n=t,r=n.Qc;return(t=n.Ba.get(e))?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Zn(t,e).next(function(t){return t?t.target:null})})}function Tf(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Qa,n=t,t=s.Ua,r=e,i=wu,o=uh(t),t=Jh(n),n=IDBKeyRange.lowerBound(o,!0),t.Fs({index:zc.readTimeIndex,range:n},function(t,e){var n=oh(r.fe,e);i=i.Ie(n.key,n),o=e.readTime}).next(function(){return{tr:i,readTime:ah(o)}});var e,n,r,i,o}).then(function(t){var e=t.tr,t=t.readTime;return s.Ua=t,e})}var Af,Nf,Sf=(Kf.prototype.ao=function(t,e){return ba.resolve(this.Xa.get(e))},Kf.prototype.uo=function(t,e){return this.Xa.set(e.id,{id:e.id,version:e.version,createTime:Xu(e.createTime)}),ba.resolve()},Kf.prototype.ho=function(t,e){return ba.resolve(this.Za.get(e))},Kf.prototype.lo=function(t,e){return this.Za.set(e.name,{name:e.name,query:dh(e.bundledQuery),readTime:Xu(e.readTime)}),ba.resolve()},Kf),Of=(Hf.prototype.bt=function(){return this.tu.bt()},Hf.prototype.sc=function(t,e){e=new Df(t,e),this.tu=this.tu.add(e),this.nu=this.nu.add(e)},Hf.prototype.iu=function(t,e){var n=this;t.forEach(function(t){return n.sc(t,e)})},Hf.prototype.rc=function(t,e){this.ru(new Df(t,e))},Hf.prototype.ou=function(t,e){var n=this;t.forEach(function(t){return n.rc(t,e)})},Hf.prototype.cu=function(t){var e=this,n=new Si(new Ti([])),r=new Df(n,t),t=new Df(n,t+1),i=[];return this.nu.Qe([r,t],function(t){e.ru(t),i.push(t.key)}),i},Hf.prototype.au=function(){var e=this;this.tu.forEach(function(t){return e.ru(t)})},Hf.prototype.ru=function(t){this.tu=this.tu.delete(t),this.nu=this.nu.delete(t)},Hf.prototype.uu=function(t){var e=new Si(new Ti([])),n=new Df(e,t),t=new Df(e,t+1),r=Au();return this.nu.Qe([n,t],function(t){r=r.add(t.key)}),r},Hf.prototype.Mo=function(t){var e=new Df(t,0);return null!==(e=this.tu.We(e))&&t.isEqual(e.key)},Hf),Df=(zf.eu=function(t,e){return Si.At(t.key,e.key)||Or(t.hu,e.hu)},zf.su=function(t,e){return Or(t.hu,e.hu)||Si.At(t.key,e.key)},zf),xf=(Gf.prototype.Ro=function(t){return ba.resolve(0===this.Ra.length)},Gf.prototype.Po=function(t,e,n,r){var i=this.lu;this.lu++,0<this.Ra.length&&this.Ra[this.Ra.length-1],n=new sc(i,e,n,r),this.Ra.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this._u=this._u.add(new Df(u.key,i)),this.To.fo(t,u.key.path.yt())}return ba.resolve(n)},Gf.prototype.yo=function(t,e){return ba.resolve(this.fu(e))},Gf.prototype.po=function(t,e){return e+=1,e=(e=this.du(e))<0?0:e,ba.resolve(this.Ra.length>e?this.Ra[e]:null)},Gf.prototype.bo=function(){return ba.resolve(0===this.Ra.length?-1:this.lu-1)},Gf.prototype.vo=function(t){return ba.resolve(this.Ra.slice())},Gf.prototype.So=function(t,e){var n=this,r=new Df(e,0),e=new Df(e,Number.POSITIVE_INFINITY),i=[];return this._u.Qe([r,e],function(t){t=n.fu(t.hu),i.push(t)}),ba.resolve(i)},Gf.prototype.Do=function(t,e){var n=this,r=new gu(Or);return e.forEach(function(t){var e=new Df(t,0),t=new Df(t,Number.POSITIVE_INFINITY);n._u.Qe([e,t],function(t){r=r.add(t.hu)})}),ba.resolve(this.wu(r))},Gf.prototype.xo=function(t,e){var n=e.path,r=n.length+1,e=n;Si.qt(e)||(e=e.child(""));var e=new Df(new Si(e),0),i=new gu(Or);return this._u.Ke(function(t){var e=t.key.path;return!!n.vt(e)&&(e.length===r&&(i=i.add(t.hu)),!0)},e),ba.resolve(this.wu(i))},Gf.prototype.wu=function(t){var e=this,n=[];return t.forEach(function(t){null!==(t=e.fu(t))&&n.push(t)}),n},Gf.prototype.No=function(n,r){var i=this;Ar(0===this.Eu(r.batchId,"removed")),this.Ra.shift();var o=this._u;return ba.forEach(r.mutations,function(t){var e=new Df(t.key,r.batchId);return o=o.delete(e),i.Io.Oo(n,t.key)}).next(function(){i._u=o})},Gf.prototype.Fo=function(t){},Gf.prototype.Mo=function(t,e){var n=new Df(e,0),n=this._u.We(n);return ba.resolve(e.isEqual(n&&n.key))},Gf.prototype.ko=function(t){return this.Ra.length,ba.resolve()},Gf.prototype.Eu=function(t,e){return this.du(t)},Gf.prototype.du=function(t){return 0===this.Ra.length?0:t-this.Ra[0].batchId},Gf.prototype.fu=function(t){return(t=this.du(t))<0||t>=this.Ra.length?null:this.Ra[t]},Gf),kf=(Bf.prototype.Er=function(t,e,n){var r=e.key,i=(o=this.docs.get(r))?o.size:0,o=this.Tu(e);return this.docs=this.docs.Ie(r,{Ir:e,size:o,readTime:n}),this.size+=o-i,this.To.fo(t,r.path.yt())},Bf.prototype.mr=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Bf.prototype.Ar=function(t,e){return e=this.docs.get(e),ba.resolve(e?e.Ir:null)},Bf.prototype.getEntries=function(t,e){var n=this,r=wu;return e.forEach(function(t){var e=n.docs.get(t);r=r.Ie(t,e?e.Ir:null)}),ba.resolve(r)},Bf.prototype.Pc=function(t,e,n){for(var r=Eu,i=new Si(e.path.child("")),o=this.docs.Ve(i);o.Ce();){var s=(u=o.De()).key,u=(a=u.value).Ir,a=a.readTime;if(!e.path.vt(s.path))break;a.u(n)<=0||u instanceof po&&ys(e,u)&&(r=r.Ie(u.key,u))}return ba.resolve(r)},Bf.prototype.Iu=function(t,e){return ba.forEach(this.docs,function(t){return e(t)})},Bf.prototype.lc=function(t){return new Pf(this)},Bf.prototype.dc=function(t){return ba.resolve(this.size)},Bf),Pf=(h(qf,Nf=o),qf.prototype.yr=function(n){var r=this,i=[];return this._r.forEach(function(t,e){e&&e.Ir?i.push(r.gc.Er(n,e.Ir,r.wr(t))):r.gc.mr(t)}),ba.hs(i)},qf.prototype.Rr=function(t,e){return this.gc.Ar(t,e)},qf.prototype.Pr=function(t,e){return this.gc.getEntries(t,e)},qf),Rf=(Ff.prototype.Un=function(t,n){return this.mu.forEach(function(t,e){return n(e)}),ba.resolve()},Ff.prototype.Wo=function(t){return ba.resolve(this.lastRemoteSnapshotVersion)},Ff.prototype.jo=function(t){return ba.resolve(this.Au)},Ff.prototype.Uo=function(t){return this.highestTargetId=this.Pu.next(),ba.resolve(this.highestTargetId)},Ff.prototype.Go=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Au&&(this.Au=e),ba.resolve()},Ff.prototype.Ho=function(t){this.mu.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Pu=new Lh(e),this.highestTargetId=e),t.sequenceNumber>this.Au&&(this.Au=t.sequenceNumber)},Ff.prototype.zo=function(t,e){return this.Ho(e),this.targetCount+=1,ba.resolve()},Ff.prototype.Yo=function(t,e){return this.Ho(e),ba.resolve()},Ff.prototype.Xo=function(t,e){return this.mu.delete(e.target),this.Ru.cu(e.targetId),--this.targetCount,ba.resolve()},Ff.prototype.Br=function(n,r,i){var o=this,s=0,u=[];return this.mu.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.mu.delete(t),u.push(o.Zo(n,e.targetId)),s++)}),ba.hs(u).next(function(){return s})},Ff.prototype.tc=function(t){return ba.resolve(this.targetCount)},Ff.prototype.ec=function(t,e){return e=this.mu.get(e)||null,ba.resolve(e)},Ff.prototype.nc=function(t,e,n){return this.Ru.iu(e,n),ba.resolve()},Ff.prototype.ic=function(e,t,n){this.Ru.ou(t,n);var r=this.persistence.Io,i=[];return r&&t.forEach(function(t){i.push(r.Oo(e,t))}),ba.hs(i)},Ff.prototype.Zo=function(t,e){return this.Ru.cu(e),ba.resolve()},Ff.prototype.oc=function(t,e){return e=this.Ru.uu(e),ba.resolve(e)},Ff.prototype.Mo=function(t,e){return ba.resolve(this.Ru.Mo(e))},Ff),Lf=(jf.prototype.start=function(){return Promise.resolve()},jf.prototype.L=function(){return this.Oc=!1,Promise.resolve()},Object.defineProperty(jf.prototype,"Nr",{get:function(){return this.Oc},enumerable:!1,configurable:!0}),jf.prototype.Xc=function(){},jf.prototype.Zc=function(){},jf.prototype.Ia=function(){return this.To},jf.prototype.Ta=function(t){var e=this.yu[t.I()];return e||(e=new xf(this.To,this.Io),this.yu[t.I()]=e),e},jf.prototype.ac=function(){return this.Qc},jf.prototype._c=function(){return this.Kc},jf.prototype.ma=function(){return this.Wc},jf.prototype.runTransaction=function(t,e,n){var r=this;br("MemoryPersistence","Starting transaction:",t);var i=new Cf(this.Fc.next());return this.Io.Vu(),n(i).next(function(t){return r.Io.pu(i).next(function(){return t})}).cs().then(function(t){return i.ki(),t})},jf.prototype.bu=function(e,n){return ba.ls(Object.values(this.yu).map(function(t){return function(){return t.Mo(e,n)}}))},jf),Cf=(h(Mf,Af=me),Mf),Uf=(Vf.Du=function(t){return new Vf(t)},Object.defineProperty(Vf.prototype,"Cu",{get:function(){if(this.Su)return this.Su;throw Tr()},enumerable:!1,configurable:!0}),Vf.prototype.sc=function(t,e,n){return this.vu.sc(n,e),this.Cu.delete(n.toString()),ba.resolve()},Vf.prototype.rc=function(t,e,n){return this.vu.rc(n,e),this.Cu.add(n.toString()),ba.resolve()},Vf.prototype.Oo=function(t,e){return this.Cu.add(e.toString()),ba.resolve()},Vf.prototype.removeTarget=function(t,e){var n=this;this.vu.cu(e.targetId).forEach(function(t){return n.Cu.add(t.toString())});var r=this.persistence.ac();return r.oc(t,e.targetId).next(function(t){t.forEach(function(t){return n.Cu.add(t.toString())})}).next(function(){return r.Xo(t,e)})},Vf.prototype.Vu=function(){this.Su=new Set},Vf.prototype.pu=function(n){var r=this,i=this.persistence._c().lc();return ba.forEach(this.Cu,function(t){var e=Si.$t(t);return r.xu(n,e).next(function(t){t||i.mr(e)})}).next(function(){return r.Su=null,i.apply(n)})},Vf.prototype.fc=function(t,e){var n=this;return this.xu(t,e).next(function(t){t?n.Cu.delete(e.toString()):n.Cu.add(e.toString())})},Vf.prototype.gu=function(t){return 0},Vf.prototype.xu=function(t,e){var n=this;return ba.ls([function(){return ba.resolve(n.vu.Mo(e))},function(){return n.persistence.ac().Mo(t,e)},function(){return n.persistence.bu(t,e)}])},Vf);function Vf(t){this.persistence=t,this.vu=new Of,this.Su=null}function Mf(t){var e=this;return(e=Af.call(this)||this).oo=t,e}function jf(t,e){var n=this;this.yu={},this.Fc=new nc(0),this.Oc=!1,this.Oc=!0,this.Io=t(this),this.Qc=new Rf(this),this.To=new wh,this.Kc=(t=this.To,new kf(t,function(t){return n.Io.gu(t)})),this.fe=new ih(e),this.Wc=new Sf(this.fe)}function Ff(t){this.persistence=t,this.mu=new ac(Eo,_o),this.lastRemoteSnapshotVersion=_i.min(),this.highestTargetId=0,this.Au=0,this.Ru=new Of,this.targetCount=0,this.Pu=Lh.Bo()}function qf(t){var e=this;return(e=Nf.call(this)||this).gc=t,e}function Bf(t,e){this.To=t,this.Tu=e,this.docs=new au(Si.At),this.size=0}function Gf(t,e){this.To=t,this.Io=e,this.Ra=[],this.lu=1,this._u=new gu(Df.eu)}function zf(t,e){this.key=t,this.hu=e}function Hf(){this.tu=new gu(Df.eu),this.nu=new gu(Df.su)}function Kf(t){this.fe=t,this.Xa=new Map,this.Za=new Map}function Wf(t,e){return"firestore_clients_"+t+"_"+e}function Qf(t,e,n){return n="firestore_mutations_"+t+"_"+n,e.T()&&(n+="_"+e.uid),n}function Yf(t,e){return"firestore_targets_"+t+"_"+e}var Jf=(cl.Nu=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Cr(r.error.code,r.error.message)),i?new cl(t,e,r.state,o):(Ir("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},cl.prototype.Fu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},cl),Xf=(al.Nu=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Cr(n.error.code,n.error.message)),r?new al(t,n.state,i):(Ir("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},al.prototype.Fu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},al),$f=(ul.Nu=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Nu,o=0;r&&o<n.activeTargetIds.length;++o)r=fi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new ul(t,i):(Ir("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},ul),Zf=(sl.Nu=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new sl(e.clientId,e.onlineState):(Ir("SharedClientState","Failed to parse online state: "+t),null)},sl),tl=(ol.prototype.Ou=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},ol.prototype.ku=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},ol.prototype.Fu=function(){var t={activeTargetIds:this.activeTargetIds.Dt(),updateTimeMs:Date.now()};return JSON.stringify(t)},ol),el=(il.G=function(t){return!(!t||!t.localStorage)},il.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f=this;return v(this,function(t){switch(t.label){case 0:return[4,this.$u.Ea()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Mu&&(i=this.getItem(Wf(this.persistenceKey,r)))&&(o=$f.Nu(r,i))&&(this.Uu=this.Uu.Ie(o.clientId,o));for(this.Yu(),(s=this.storage.getItem(this.Hu))&&(u=this.Xu(s))&&this.Zu(u),a=0,c=this.Qu;a<c.length;a++)h=c[a],this.qu(h);return this.Qu=[],this.window.addEventListener("unload",function(){return f.L()}),this.Nr=!0,[2]}})})},il.prototype.Xi=function(t){this.setItem(this.Wu,JSON.stringify(t))},il.prototype.th=function(){return this.eh(this.Uu)},il.prototype.nh=function(n){var r=!1;return this.Uu.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},il.prototype.sh=function(t){this.ih(t,"pending")},il.prototype.rh=function(t,e,n){this.ih(t,e,n),this.oh(t)},il.prototype.ah=function(t){var e,n="not-current";return this.nh(t)&&(!(e=this.storage.getItem(Yf(this.persistenceKey,t)))||(e=Xf.Nu(t,e))&&(n=e.state)),this.uh.Ou(t),this.Yu(),n},il.prototype.hh=function(t){this.uh.ku(t),this.Yu()},il.prototype.lh=function(t){return this.uh.activeTargetIds.has(t)},il.prototype._h=function(t){this.removeItem(Yf(this.persistenceKey,t))},il.prototype.fh=function(t,e,n){this.dh(t,e,n)},il.prototype.wh=function(t,e,n){var r=this;e.forEach(function(t){r.oh(t)}),this.currentUser=t,n.forEach(function(t){r.sh(t)})},il.prototype.Eh=function(t){this.Th(t)},il.prototype.Ih=function(){this.mh()},il.prototype.L=function(){this.Nr&&(this.window.removeEventListener("storage",this.Bu),this.removeItem(this.Ku),this.Nr=!1)},il.prototype.getItem=function(t){var e=this.storage.getItem(t);return br("SharedClientState","READ",t,e),e},il.prototype.setItem=function(t,e){br("SharedClientState","SET",t,e),this.storage.setItem(t,e)},il.prototype.removeItem=function(t){br("SharedClientState","REMOVE",t),this.storage.removeItem(t)},il.prototype.qu=function(t){var e=this,o=t;o.storageArea===this.storage&&(br("SharedClientState","EVENT",o.key,o.newValue),o.key!==this.Ku?this.js.ea(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){if(this.Nr){if(null!==o.key)if(this.ju.test(o.key)){if(null==o.newValue)return e=this.Ah(o.key),[2,this.Rh(e,null)];if(e=this.Ph(o.key,o.newValue))return[2,this.Rh(e.clientId,e)]}else if(this.Gu.test(o.key)){if(null!==o.newValue&&(n=this.yh(o.key,o.newValue)))return[2,this.gh(n)]}else if(this.zu.test(o.key)){if(null!==o.newValue&&(r=this.Vh(o.key,o.newValue)))return[2,this.ph(r)]}else if(o.key===this.Hu){if(null!==o.newValue&&(i=this.Xu(o.newValue)))return[2,this.Zu(i)]}else if(o.key===this.Wu)(i=function(t){var e=nc.Zi;if(null!=t)try{var n=JSON.parse(t);Ar("number"==typeof n),e=n}catch(t){Ir("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==nc.Zi&&this.Hi(i);else if(o.key===this.Ju)return[2,this.$u.bh()]}else this.Qu.push(o);return[2]})})}):Ir("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(il.prototype,"uh",{get:function(){return this.Uu.get(this.Mu)},enumerable:!1,configurable:!0}),il.prototype.Yu=function(){this.setItem(this.Ku,this.uh.Fu())},il.prototype.ih=function(t,e,n){n=new Jf(this.currentUser,t,e,n),t=Qf(this.persistenceKey,this.currentUser,t),this.setItem(t,n.Fu())},il.prototype.oh=function(t){t=Qf(this.persistenceKey,this.currentUser,t),this.removeItem(t)},il.prototype.Th=function(t){t={clientId:this.Mu,onlineState:t},this.storage.setItem(this.Hu,JSON.stringify(t))},il.prototype.dh=function(t,e,n){var r=Yf(this.persistenceKey,t),n=new Xf(t,e,n);this.setItem(r,n.Fu())},il.prototype.mh=function(){this.setItem(this.Ju,"value-not-used")},il.prototype.Ah=function(t){return(t=this.ju.exec(t))?t[1]:null},il.prototype.Ph=function(t,e){return t=this.Ah(t),$f.Nu(t,e)},il.prototype.yh=function(t,e){var n=this.Gu.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Jf.Nu(new zr(n),t,e)},il.prototype.Vh=function(t,e){return t=this.zu.exec(t),t=Number(t[1]),Xf.Nu(t,e)},il.prototype.Xu=function(t){return Zf.Nu(t)},il.prototype.gh=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.$u.Sh(e.batchId,e.state,e.error)]:(br("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},il.prototype.ph=function(t){return this.$u.Dh(t.targetId,t.state,t.error)},il.prototype.Rh=function(t,e){var n=this,r=e?this.Uu.Ie(t,e):this.Uu.remove(t),i=this.eh(this.Uu),o=this.eh(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.$u.Ch(s,u).then(function(){n.Uu=r})},il.prototype.Zu=function(t){this.Uu.get(t.clientId)&&this.Lu(t.onlineState)},il.prototype.eh=function(t){var n=Nu;return t.forEach(function(t,e){n=n.je(e.activeTargetIds)}),n},il),nl=(rl.prototype.sh=function(t){},rl.prototype.rh=function(t,e,n){},rl.prototype.ah=function(t){return this.xh.Ou(t),this.Nh[t]||"not-current"},rl.prototype.fh=function(t,e,n){this.Nh[t]=e},rl.prototype.hh=function(t){this.xh.ku(t)},rl.prototype.lh=function(t){return this.xh.activeTargetIds.has(t)},rl.prototype._h=function(t){delete this.Nh[t]},rl.prototype.th=function(){return this.xh.activeTargetIds},rl.prototype.nh=function(t){return this.xh.activeTargetIds.has(t)},rl.prototype.start=function(){return this.xh=new tl,Promise.resolve()},rl.prototype.wh=function(t,e,n){},rl.prototype.Eh=function(t){},rl.prototype.L=function(){},rl.prototype.Xi=function(t){},rl.prototype.Ih=function(){},rl);function rl(){this.xh=new tl,this.Nh={},this.Lu=null,this.Hi=null}function il(t,e,n,r,i){this.window=t,this.js=e,this.persistenceKey=n,this.Mu=r,this.$u=null,this.Lu=null,this.Hi=null,this.Bu=this.qu.bind(this),this.Uu=new au(Or),this.Nr=!1,this.Qu=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.Ku=Wf(this.persistenceKey,this.Mu),this.Wu="firestore_sequence_number_"+this.persistenceKey,this.Uu=this.Uu.Ie(this.Mu,new tl),this.ju=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Gu=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.zu=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Hu="firestore_online_state_"+this.persistenceKey,this.Ju="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.Bu)}function ol(){this.activeTargetIds=Nu}function sl(t,e){this.clientId=t,this.onlineState=e}function ul(t,e){this.clientId=t,this.activeTargetIds=e}function al(t,e,n){this.targetId=t,this.state=e,this.error=n}function cl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function hl(){return"undefined"!=typeof window?window:null}function fl(){return"undefined"!=typeof document?document:null}function ll(t,e,n,r,i){var o=this;this.Uh=t,this.Qh=e,this.ks=n,this.Kh={},this.Wh=[],this.jh=new Map,this.Gh=new Set,this.zh=[],this.Hh=i,this.Hh.$(function(t){n.Ws(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return _l(this)?(br("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Gh.add(4),[4,vl(e)];case 1:return t.sent(),e.Jh.set("Unknown"),e.Gh.delete(4),[4,yl(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Jh=new pl(n,r)}var pl=(dl.prototype.Mh=function(){var t=this;0===this.Fh&&(this.$h("Unknown"),this.Oh=this.ks.ni("online_state_timeout",1e4,function(){return t.Oh=null,t.Lh("Backend didn't respond within 10 seconds."),t.$h("Offline"),Promise.resolve()}))},dl.prototype.Bh=function(t){"Online"===this.state?this.$h("Unknown"):(this.Fh++,1<=this.Fh&&(this.qh(),this.Lh("Connection failed 1 times. Most recent error: "+t.toString()),this.$h("Offline")))},dl.prototype.set=function(t){this.qh(),this.Fh=0,"Online"===t&&(this.kh=!1),this.$h(t)},dl.prototype.$h=function(t){t!==this.state&&(this.state=t,this.Lu(t))},dl.prototype.Lh=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.kh?(Ir(t),this.kh=!1):br("OnlineStateTracker",t)},dl.prototype.qh=function(){null!==this.Oh&&(this.Oh.cancel(),this.Oh=null)},dl);function dl(t,e){this.ks=t,this.Lu=e,this.state="Unknown",this.Fh=0,this.Oh=null,this.kh=!0}function yl(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!_l(r))return[3,4];e=0,n=r.zh,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function vl(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.zh,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function gl(t,e){t.jh.has(e.targetId)||(t.jh.set(e.targetId,e),El(t)?Il(t):kl(t).li()&&wl(t,e))}function ml(t,e){var n=t,t=kl(n);n.jh.delete(e),t.li()&&bl(n,e),0===n.jh.size&&(t.li()?t.di():_l(n)&&n.Jh.set("Unknown"))}function wl(t,e){t.Yh.Dn(e.targetId),kl(t).gi(e)}function bl(t,e){t.Yh.Dn(e),kl(t).Vi(e)}function Il(e){e.Yh=new Uu({Xn:function(t){return e.Kh.Xn(t)},Zn:function(t){return e.jh.get(t)||null}}),kl(e).start(),e.Jh.Mh()}function El(t){return _l(t)&&!kl(t).hi()&&0<t.jh.size}function _l(t){return 0===t.Gh.size}function Tl(t){t.Yh=void 0}function Al(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!xa(r))throw r;return n.Gh.add(1),[4,vl(n)];case 1:return t.sent(),n.Jh.set("Offline"),i=i||function(){return mf(n.Uh)},n.ks.ea(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return br("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Gh.delete(1),[4,yl(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Nl(e,n){return n().catch(function(t){return Al(e,t,n)})}function Sl(c){return y(this,void 0,void 0,function(){var o,s,u,a;return v(this,function(t){switch(t.label){case 0:s=Pl(o=c),u=0<o.Wh.length?o.Wh[o.Wh.length-1].batchId:-1,t.label=1;case 1:if(!(_l(o)&&o.Wh.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(n=o.Uh,r=u,(i=n).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===r&&(r=-1),i.Ra.po(t,r)}))];case 3:return null===(a=t.sent())?(0===o.Wh.length&&s.di(),[3,7]):(u=a.batchId,e=a,(n=o).Wh.push(e),(n=Pl(n)).li()&&n.bi&&n.vi(e.mutations),[3,6]);case 4:return a=t.sent(),[4,Al(o,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Ol(o)&&Dl(o),[2]}var e,n,r,i})})}function Ol(t){return _l(t)&&!Pl(t).hi()&&0<t.Wh.length}function Dl(t){Pl(t).start()}function xl(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Gh.delete(2),[4,yl(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Gh.add(2),[4,vl(e)]);case 3:t.sent(),e.Jh.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function kl(n){var t,e,r,i=this;return n.nl||(n.nl=(t=n.Qh,e=n.ks,r={Y:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.jh.forEach(function(t,e){wl(n,t)}),[2]})})}.bind(null,n),Z:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return Tl(e),El(e)?(e.Jh.Bh(n),Il(e)):e.Jh.set("Unknown"),[2]})})}.bind(null,n),yi:function(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Jh.set("Online"),!(u instanceof Lu&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.jh.has(i)?[4,o.Kh.Xh(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.jh.delete(i),o.Yh.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),br("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,Al(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof Pu?s.Yh.$n(u):u instanceof Ru?s.Yh.jn(u):s.Yh.qn(u),a.isEqual(_i.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,mf(s.Uh)];case 8:return o=t.sent(),0<=a.u(o)?[4,(i=a,(e=(r=s).Yh.Hn(i)).rn.forEach(function(t,e){var n;0<t.resumeToken.o()&&(n=r.jh.get(e))&&r.jh.set(e,n.ae(t.resumeToken,i))}),e.on.forEach(function(t){var e=r.jh.get(t);e&&(r.jh.set(t,e.ae(kr.h,e.oe)),bl(r,t),e=new gs(e.target,t,1,e.sequenceNumber),wl(r,e))}),r.Kh.Zh(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return br("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Al(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}.bind(null,n)},t.Ni(),new Ga(e,t.ri,t.credentials,t.fe,r)),n.zh.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.nl.fi(),El(n)?Il(n):n.Jh.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.nl.stop()];case 2:t.sent(),Tl(n),t.label=3;case 3:return[2]}})})})),n.nl}function Pl(n){var t,e,r,i=this;return n.sl||(n.sl=(t=n.Qh,e=n.ks,r={Y:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Pl(e).Ci(),[2]})})}.bind(null,n),Z:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&Pl(e).bi?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return di(n=i.code)&&n!==Lr.ABORTED?(e=r.Wh.shift(),Pl(r).fi(),[4,Nl(r,function(){return r.Kh.el(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Sl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Ol(e)&&Dl(e),[2]}})})}.bind(null,n),Di:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=Pl(o),n=0,r=o.Wh;n<r.length;n++)i=r[n],e.vi(i.mutations);return[2]})})}.bind(null,n),Si:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Wh.shift(),n=uc.from(e,i,o),[4,Nl(r,function(){return r.Kh.tl(n)})];case 1:return t.sent(),[4,Sl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.Ni(),new za(e,t.ri,t.credentials,t.fe,r)),n.zh.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.sl.fi(),[4,Sl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.sl.stop()];case 3:t.sent(),0<n.Wh.length&&(br("RemoteStore","Stopping write stream with "+n.Wh.length+" pending writes"),n.Wh=[]),t.label=4;case 4:return[2]}})})})),n.sl}function Rl(){this.queries=new ac(ps,ls),this.onlineState="Unknown",this.rl=new Set}var Ll=function(){this.il=void 0,this.listeners=[]};function Cl(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new Ll),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.ol(n)];case 2:return o.il=t.sent(),[3,4];case 3:return o=Ma(o=t.sent(),"Initialization of query '"+ds(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(u),u.cl(e.onlineState),i.il&&u.al(i.il)&&Vl(e),[2]}})})}function Ul(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.ul(n))]:[2]})})}function Vl(t){t.rl.forEach(function(t){t.next()})}var Ml=(Hl.prototype.al=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Du(t.query,t.docs,t.Ze,e,t.tn,t.fromCache,t.en,!0)}var o=!1;return this.ll?this.fl(t)&&(this.hl.next(t),o=!0):this.dl(t,this.onlineState)&&(this.wl(t),o=!0),this._l=t,o},Hl.prototype.onError=function(t){this.hl.error(t)},Hl.prototype.cl=function(t){this.onlineState=t;var e=!1;return this._l&&!this.ll&&this.dl(this._l,t)&&(this.wl(this._l),e=!0),e},Hl.prototype.dl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.El&&n||t.docs.bt()&&"Offline"!==e)},Hl.prototype.fl=function(t){if(0<t.docChanges.length)return!0;var e=this._l&&this._l.hasPendingWrites!==t.hasPendingWrites;return!(!t.en&&!e)&&!0===this.options.includeMetadataChanges},Hl.prototype.wl=function(t){t=Du.sn(t.query,t.docs,t.tn,t.fromCache),this.ll=!0,this.hl.next(t)},Hl),jl=(zl.prototype.Tl=function(){return"metadata"in this.payload},zl),Fl=(Gl.prototype.Ha=function(t){return ea(this.fe,t)},Gl.prototype.Ja=function(t){return t.metadata.exists?ua(this.fe,t.document,!1):new yo(this.Ha(t.metadata.name),this.Ya(t.metadata.readTime))},Gl.prototype.Ya=Xu,Gl),ql=(Bl.prototype.ml=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},Bl.prototype.Al=function(t){for(var e=new Map,n=new Fl(this.fe),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.Ha(o.metadata.name),u=0,a=o.metadata.queries;u<a.length;u++){var c=a[u],h=(e.get(c)||Au()).add(s);e.set(c,h)}}return e},Bl.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return[4,function(f,l,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,u,a,c,h;return v(this,function(t){switch(t.label){case 0:for(n=f,r=Au(),i=wu,o=_u,e=0,s=p;e<s.length;e++)u=s[e],a=l.Ha(u.metadata.name),u.document&&(r=r.add(a)),i=i.Ie(a,l.Ja(u)),o=o.Ie(a,l.Ya(u.metadata.readTime));return c=n.Qa.lc({yc:!0}),[4,bf(n,hs(rs(Ti.xt("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return wf(e,c,i,_i.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.Qc.Zo(e,h.targetId).next(function(){return n.Qc.nc(e,r,h.targetId)}).next(function(){return n.Ka.pa(e,t)})})})]}})})}(this.Uh,new Fl(this.fe),this.documents,this.Il.id)];case 1:e=t.sent(),n=this.Al(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Au()),y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return[4,bf(e,hs(dh(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=Xu(i.readTime);return 0<=n.oe.u(e)?r.Wc.lo(t,i):(e=n.ae(kr.h,e),r.Ba=r.Ba.Ie(e.targetId,e),r.Qc.Yo(t,e).next(function(){return r.Qc.Zo(t,n.targetId)}).next(function(){return r.Qc.nc(t,o,n.targetId)}).next(function(){return r.Wc.lo(t,i)}))})]}})})}(this.Uh,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new oc(Object.assign({},this.progress),e))]}})})},Bl);function Bl(t,e,n){this.Il=t,this.Uh=e,this.fe=n,this.queries=[],this.documents=[],this.progress=Kl(t)}function Gl(t){this.fe=t}function zl(t,e){this.payload=t,this.byteLength=e}function Hl(t,e,n){this.query=t,this.hl=e,this.ll=!1,this._l=null,this.onlineState="Unknown",this.options=n||{}}function Kl(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var Wl=function(t){this.key=t},Ql=function(t){this.key=t},Yl=(Object.defineProperty(tp.prototype,"pl",{get:function(){return this.Rl},enumerable:!1,configurable:!0}),tp.prototype.bl=function(t,e){var s=this,u=e?e.vl:new Ou,a=(e||this).Vl,c=(e||this).tn,h=a,f=!1,l=is(this.query)&&a.size===this.query.limit?a.last():null,p=os(this.query)&&a.size===this.query.limit?a.first():null;if(t.Pe(function(t,e){var n=a.get(t),r=(r=e instanceof po?e:null)&&(ys(s.query,r)?r:null),i=!!n&&s.tn.has(n.key),o=!!r&&(r.Jt||s.tn.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.Sl(n,r)||(u.track({type:2,doc:r}),e=!0,(l&&0<s.gl(r,l)||p&&s.gl(r,p)<0)&&(f=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(l||p)&&(f=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),is(this.query)||os(this.query))for(;h.size>this.query.limit;){var n=is(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{Vl:h,vl:u,$a:f,tn:c}},tp.prototype.Sl=function(t,e){return t.Jt&&e.hasCommittedMutations&&!e.Jt},tp.prototype.yr=function(t,e,n){var o=this,r=this.Vl;this.Vl=t.Vl,this.tn=t.tn;var i=t.vl.Xe();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.gl(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Tr()}}var r,i}),this.Dl(n);var s=e?this.Cl():[],e=(n=0===this.yl.size&&this.ln?1:0)!==this.Pl;return this.Pl=n,0!==i.length||e?{snapshot:new Du(this.query,t.Vl,r,i,t.tn,0==n,e,!1),xl:s}:{xl:s}},tp.prototype.cl=function(t){return this.ln&&"Offline"===t?(this.ln=!1,this.yr({Vl:this.Vl,vl:new Ou,tn:this.tn,$a:!1},!1)):{xl:[]}},tp.prototype.Nl=function(t){return!this.Rl.has(t)&&!!this.Vl.has(t)&&!this.Vl.get(t).Jt},tp.prototype.Dl=function(t){var e=this;t&&(t._n.forEach(function(t){return e.Rl=e.Rl.add(t)}),t.fn.forEach(function(t){}),t.dn.forEach(function(t){return e.Rl=e.Rl.delete(t)}),this.ln=t.ln)},tp.prototype.Cl=function(){var e=this;if(!this.ln)return[];var n=this.yl;this.yl=Au(),this.Vl.forEach(function(t){e.Nl(t.key)&&(e.yl=e.yl.add(t.key))});var r=[];return n.forEach(function(t){e.yl.has(t)||r.push(new Ql(t))}),this.yl.forEach(function(t){n.has(t)||r.push(new Wl(t))}),r},tp.prototype.Fl=function(t){return this.Rl=t.za,this.yl=Au(),t=this.bl(t.documents),this.yr(t,!0)},tp.prototype.Ol=function(){return Du.sn(this.query,this.Vl,this.tn,0===this.Pl)},tp),Jl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Xl=function(t){this.key=t,this.kl=!1},$l=(Object.defineProperty(Zl.prototype,"Xl",{get:function(){return!0===this.Yl},enumerable:!1,configurable:!0}),Zl);function Zl(t,e,n,r,i,o){this.Uh=t,this.Ml=e,this.$l=n,this.Ll=r,this.currentUser=i,this.Bl=o,this.ql={},this.Ul=new ac(ps,ls),this.Ql=new Map,this.Kl=[],this.Wl=new au(Si.At),this.jl=new Map,this.Gl=new Of,this.zl={},this.Hl=new Map,this.Jl=Lh.qo(),this.onlineState="Unknown",this.Yl=void 0}function tp(t,e){this.query=t,this.Rl=e,this.Pl=null,this.ln=!1,this.yl=Au(),this.tn=Au(),this.gl=vs(t),this.Vl=new Su(this.gl)}function ep(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Zl=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.bl(o)).$a?[4,Ef(r.Uh,i.query,!1).then(function(t){return t=t.documents,i.view.bl(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.rn.get(i.targetId),n=i.view.yr(e,r.Xl,n),[2,(hp(r,i.targetId,n.xl),n.snapshot)]}})})}(i,t,e,n)},[4,Ef(i.Uh,o,!0)];case 1:return n=t.sent(),r=new Yl(o,n.za),e=r.bl(n.documents),n=ku.hn(s,u&&"Offline"!==i.onlineState),n=r.yr(e,i.Xl,n),hp(i,s,n.xl),r=new Jl(o,s,r),[2,(i.Ul.set(o,r),i.Ql.has(s)?i.Ql.get(s).push(o):i.Ql.set(s,[o]),n.snapshot)]}})})}function np(l,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=vp(l),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.Uh,a=p,h=i,f=Ei.now(),o=a.reduce(function(t,e){return t.add(e.key)},Au()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Ka.Va(u,o).next(function(t){c=t;for(var e,n=[],r=0,i=a;r<i.length;r++){var o=i[r],s=(e=o,s=c.get(o.key),void 0!==e.fieldTransforms?function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof po?e.field(o.field):void 0;null!=(s=Es(o.transform,s||null))&&(n=(null==n?new uo:n).set(o.field,s))}return n?n.Gt():null}(e.fieldTransforms,s):null);null!=s&&n.push(new Js(o.key,s,function s(t){var u=[];return Mi(t.fields||{},function(t,e){var n=new Ni([t]);if(oo(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new Fi(u)}(s.proto.mapValue),qs.exists(!0)))}return h.Ra.Po(u,f,n,a)})}).then(function(t){var e=t.rr(c);return{batchId:t.batchId,_r:e}}))];case 2:return s=t.sent(),u.Ll.sh(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.zl[e.currentUser.I()])||new au(Or)).Ie(n,r),e.zl[e.currentUser.I()]=i,[4,lp(u,s._r)];case 3:return t.sent(),[4,Sl(u.Ml)];case 4:return t.sent(),[3,6];case 5:return u=Ma(u=t.sent(),"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,f,o})})}function rp(o,s){return y(this,void 0,void 0,function(){var n,i;return v(this,function(t){switch(t.label){case 0:n=o,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Uh,a=e,c=(r=s).oe,h=a.Ba,a.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=a.Qa.lc({yc:!0});h=a.Ba;var u=[];r.rn.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(u.push(a.Qc.ic(s,t.dn,e).next(function(){return a.Qc.nc(s,t._n,e)})),0<(i=t.resumeToken).o()&&(n=o.ae(i,c).ce(s.oo),h=h.Ie(e,n),r=o,i=t,Ar(0<(o=n).resumeToken.o()),(0===r.resumeToken.o()||3e8<=o.oe.Et()-r.oe.Et()||0<i._n.size+i.fn.size+i.dn.size)&&u.push(a.Qc.Yo(s,n))))});var e,n=wu;return r.cn.forEach(function(t,e){r.an.has(t)&&u.push(a.persistence.Io.fc(s,t))}),u.push(wf(s,t,r.cn,c,void 0).next(function(t){n=t})),c.isEqual(_i.min())||(e=a.Qc.Wo(s).next(function(t){return a.Qc.Go(s,s.oo,c)}),u.push(e)),ba.hs(u).next(function(){return t.apply(s)}).next(function(){return a.Ka.pa(s,n)})}).then(function(t){return a.Ba=h,t}))];case 2:return i=t.sent(),s.rn.forEach(function(t,e){(e=n.jl.get(e))&&(Ar(t._n.size+t.fn.size+t.dn.size<=1),0<t._n.size?e.kl=!0:0<t.fn.size?Ar(e.kl):0<t.dn.size&&(Ar(e.kl),e.kl=!1))}),[4,lp(n,i,s)];case 3:return t.sent(),[3,6];case 4:return[4,ic(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,a,c,h})})}function ip(t,n,e){var r;((t=t).Xl&&0===e||!t.Xl&&1===e)&&(r=[],t.Ul.forEach(function(t,e){(e=e.view.cl(n)).snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].cl(i)&&(o=!0)}),o&&Vl(t)}(t.$l,n),r.length&&t.ql.yi(r),t.onlineState=n,t.Xl&&t.Ll.Eh(n))}function op(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:_l((n=o).Ml)||br("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.Uh).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Ra.bo(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Hl.get(r)||[]).push(s),n.Hl.set(r,i),[3,4]);case 3:return i=Ma(i=t.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function sp(t,e){(t.Hl.get(e)||[]).forEach(function(t){t.resolve()}),t.Hl.delete(e)}function up(t,e,n){var r=t,i=r.zl[r.currentUser.I()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.zl[r.currentUser.I()]=i)}function ap(e,t,n){void 0===n&&(n=null),e.Ll.hh(t);for(var r=0,i=e.Ql.get(t);r<i.length;r++){var o=i[r];e.Ul.delete(o),n&&e.ql.t_(o,n)}e.Ql.delete(t),e.Xl&&e.Gl.cu(t).forEach(function(t){e.Gl.Mo(t)||cp(e,t)})}function cp(t,e){var n=t.Wl.get(e);null!==n&&(ml(t.Ml,n),t.Wl=t.Wl.remove(e),t.jl.delete(n),fp(t))}function hp(t,e,n){for(var r,i,o=0,s=n;o<s.length;o++){var u=s[o];u instanceof Wl?(t.Gl.sc(u.key,e),r=t,i=(i=u).key,r.Wl.get(i)||(br("SyncEngine","New document in limbo: "+i),r.Kl.push(i),fp(r))):u instanceof Ql?(br("SyncEngine","Document no longer in limbo: "+u.key),t.Gl.rc(u.key,e),t.Gl.Mo(u.key)||cp(t,u.key)):Tr()}}function fp(t){for(;0<t.Kl.length&&t.Wl.size<t.Bl;){var e=t.Kl.shift(),n=t.Jl.next();t.jl.set(n,new Xl(e)),t.Wl=t.Wl.Ie(e,n),gl(t.Ml,new gs(hs(rs(e.path)),n,2,nc.Zi))}}function lp(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Ul.bt()?[3,3]:(n.Ul.forEach(function(t,e){o.push(n.Zl(e,s,u).then(function(t){t&&(n.Xl&&n.Ll.fh(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=cf.Na(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.ql.yi(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return ba.forEach(c,function(e){return ba.forEach(e.Ca,function(t){return r.persistence.Io.sc(n,e.targetId,t)}).next(function(){return ba.forEach(e.xa,function(t){return r.persistence.Io.rc(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!xa(e=t.sent()))throw e;return br("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.Ba.get(o),u=s.oe,u=s.ue(u),r.Ba=r.Ba.Ie(o,u));return[2]}})})}(n.Uh,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function pp(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.Ql.get(s))&&0!==a.length?[4,bf(e.Uh,hs(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],f=e.Ul.get(f),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Ef((e=r).Uh,i.query,!0)];case 1:return n=t.sent(),n=i.view.Fl(n),[2,(e.Xl&&hp(e,i.targetId,n.xl),n)]}})})}(e,f)]):[3,6];case 4:(f=t.sent()).snapshot&&r.push(f.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,_f(e.Uh,s)];case 8:return l=t.sent(),[4,bf(e.Uh,l)];case 9:return u=t.sent(),[4,ep(e,dp(l),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.ql.yi(r),n)]}})})}function dp(t){return ns(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function yp(t){return t.Ml.Kh.Zh=rp.bind(null,t),t.Ml.Kh.Xn=function(t,e){var n=t;if((t=n.jl.get(e))&&t.kl)return Au().add(t.key);var r=Au();if(!(e=n.Ql.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Ul.get(s),r=r.je(s.view.pl);return r}.bind(null,t),t.Ml.Kh.Xh=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).Ll.fh(s,"rejected",u),i=e.jl.get(s),(n=i&&i.key)?(r=(r=new au(Si.At)).Ie(n,new yo(n,_i.min())),i=Au().add(n),i=new xu(_i.min(),new Map,new gu(Or),r,i),[4,rp(e,i)]):[3,2];case 1:return t.sent(),e.Wl=e.Wl.remove(n),e.jl.delete(s),fp(e),[3,4];case 2:return[4,If(e.Uh,s,!1).then(function(){return ap(e,s,u)}).catch(ic)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.ql.yi=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query;if(u=n.queries.get(u)){for(var a=0,c=u.listeners;a<c.length;a++)c[a].al(s)&&(r=!0);u.il=s}}r&&Vl(n)}.bind(null,t.$l),t.ql.t_=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.$l),t}function vp(t){return t.Ml.Kh.tl=function(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:n=o,r=s.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Uh,h=s,(f=e).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r,e=h.batch.keys(),n=f.Qa.lc({yc:!0}),i=f,o=t,s=n,u=(r=h).batch,a=u.keys(),c=ba.resolve();return a.forEach(function(n){c=c.next(function(){return s.Ar(o,n)}).next(function(t){var e=t;Ar(null!==(t=r.ar.get(n))),(!e||e.version.u(t)<0)&&(e=u.nr(n,e,r))&&s.Er(e,r.cr)})}),c.next(function(){return i.Ra.No(o,u)}).next(function(){return n.apply(t)}).next(function(){return f.Ra.ko(t)}).next(function(){return f.Ka.Va(t,e)})}))];case 2:return i=t.sent(),up(n,r,null),sp(n,r),n.Ll.rh(r,"acknowledged"),[4,lp(n,i)];case 3:return t.sent(),[3,6];case 4:return[4,ic(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,h,f})})}.bind(null,t),t.Ml.Kh.el=function(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Uh,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Ra.yo(e,r).next(function(t){return Ar(null!==t),n=t.keys(),i.Ra.No(e,t)}).next(function(){return i.Ra.ko(e)}).next(function(){return i.Ka.Va(e,n)})}))];case 2:return o=t.sent(),up(n,u,a),sp(n,u),n.Ll.rh(u,"rejected",a),[4,lp(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,ic(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,t),t}function gp(t,e,n){var r=t;(function(l,p,d){return y(this,void 0,void 0,function(){var u,a,c,h,f;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return u=t.sent(),[4,(r=l.Uh,o=r,s=Xu((i=u).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.Wc.ao(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.u(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d.e_({taskState:"Success",documentsLoaded:u.totalDocuments,bytesLoaded:u.totalBytes,totalDocuments:u.totalDocuments,totalBytes:u.totalBytes}))];case 4:return d.n_(Kl(u)),a=new ql(u,l.Uh,p.fe),[4,p.s_()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,a.ml(c)]:[3,10];case 7:return(h=t.sent())&&d.n_(h),[4,p.s_()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,a.complete()];case 11:return f=t.sent(),[4,lp(l,f.tr,void 0)];case 12:return t.sent(),[4,(r=l.Uh,e=u,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.Wc.uo(t,e)}))];case 13:return t.sent(),d.e_(f.progress),[3,15];case 14:return Er("SyncEngine","Loading bundle failed with "+(f=t.sent())),d.i_(f),[3,15];case 15:return[2]}var e,n,r,i,o,s})})})(r,e,n).then(function(){r.Ll.Ih()})}var mp,wp,bp=(Sp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.fe=ma(e.rt.O),this.Ll=this.r_(e),this.persistence=this.o_(e),[4,this.persistence.start()];case 1:return t.sent(),this.c_=this.a_(e),this.Uh=this.u_(e),[2]}})})},Sp.prototype.a_=function(t){return null},Sp.prototype.u_=function(t){return vf(this.persistence,new hf,t.h_,this.fe)},Sp.prototype.o_=function(t){return new Lf(Uf.Du,this.fe)},Sp.prototype.r_=function(t){return new nl},Sp.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.c_&&this.c_.stop(),[4,this.Ll.L()];case 1:return t.sent(),[4,this.persistence.L()];case 2:return t.sent(),[2]}})})},Sp),Ip=(h(Np,wp=bp),Np.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,wp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=Jh(t),r=_i.min(),t.Fs({index:zc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=ah(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.Ua=t})]})})}(this.Uh)];case 2:return t.sent(),[4,this.l_.initialize(this,e)];case 3:return t.sent(),[4,vp(this.l_.$u)];case 4:return t.sent(),[4,Sl(this.l_.Ml)];case 5:return t.sent(),[2]}})})},Np.prototype.u_=function(t){return vf(this.persistence,new hf,t.h_,this.fe)},Np.prototype.a_=function(t){var e=this.persistence.Io.vr;return new yc(e,t.ks)},Np.prototype.o_=function(t){var e=uf(t.rt.O,t.rt.persistenceKey),n=void 0!==this.cacheSizeBytes?Qa.Ki(this.cacheSizeBytes):Qa.Gi;return new nf(this.synchronizeTabs,e,t.clientId,n,t.ks,hl(),fl(),this.fe,this.Ll,!!this.forceOwnership)},Np.prototype.r_=function(t){return new nl},Np),Ep=(h(Ap,mp=Ip),Ap.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,mp.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.l_.$u,this.Ll instanceof el?(this.Ll.$u={Sh:function(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).Uh,n=a,i=(r=e).Ra,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Vo(e,n).next(function(t){return t?r.Ka.Va(e,t):ba.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,Sl(o.Ml)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(up(o,a,h||null),sp(o,a),o.Uh.Ra.Fo(a)):Tr(),t.label=4;case 4:return[4,lp(o,s)];case 5:return t.sent(),[3,7];case 6:br("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}.bind(null,e),Dh:function(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return(e=i).Yl?(br("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.Ql.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Tf(e.Uh)];case 3:return n=t.sent(),r=xu.un(o,"current"===s),[4,lp(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,If(e.Uh,o,!0)];case 6:return t.sent(),ap(e,o,u),[3,8];case 7:Tr(),t.label=8;case 8:return[2]}})})}.bind(null,e),Ch:function(c,h,f){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=yp(c)).Yl)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.Ql.has(r)?(br("SyncEngine","Adding an already active target "+r),[3,5]):[4,_f(n.Uh,r)]):[3,6];case 2:return i=t.sent(),[4,bf(n.Uh,i)];case 3:return o=t.sent(),[4,ep(n,dp(i),o.targetId,!1)];case 4:t.sent(),gl(n.Ml,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.Ql.has(e)?[4,If(n.Uh,e,!1).then(function(){ml(n.Ml,e),ap(n,e)}).catch(ic)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=f,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),Ea:function(t){return t.Uh.persistence.Ea()}.bind(null,e),bh:function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,Tf((e=n).Uh).then(function(t){return lp(e,t)})]})})}.bind(null,e)},[4,this.Ll.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.Yc(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,function(h,f){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return yp(r=h),vp(r),!0!==f||!0===r.Yl?[3,3]:(e=r.Ll.th(),[4,pp(r,e.Dt())]);case 1:return i=t.sent(),r.Yl=!0,[4,xl(r.Ml,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],gl(r.Ml,u);return[3,7];case 3:return!1!==f||!1===r.Yl?[3,7]:(a=[],c=Promise.resolve(),r.Ql.forEach(function(t,e){r.Ll.lh(e)?a.push(e):c=c.then(function(){return ap(r,e),If(r.Uh,e,!0)}),ml(r.Ml,e)}),[4,c]);case 4:return t.sent(),[4,pp(r,a)];case 5:return t.sent(),(n=r).jl.forEach(function(t,e){ml(n.Ml,e)}),n.Gl.au(),n.jl=new Map,n.Wl=new au(Si.At),r.Yl=!1,[4,xl(r.Ml,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}(this.l_.$u,e)];case 1:return t.sent(),this.c_&&(e&&!this.c_.Nr?this.c_.start(this.Uh):e||this.c_.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Ap.prototype.r_=function(t){var e=hl();if(!el.G(e))throw new Cr(Lr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=uf(t.rt.O,t.rt.persistenceKey);return new el(e,t.ks,n,t.clientId,t.h_)},Ap),_p=(Tp.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Uh?[3,2]:(this.Uh=n.Uh,this.Ll=n.Ll,this.Qh=this.__(r),this.Ml=this.f_(r),this.$l=this.d_(r),this.$u=this.w_(r,!n.synchronizeTabs),this.Ll.Lu=function(t){return ip(e.$u,t,1)},this.Ml.Kh.E_=function(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(br("SyncEngine","User change. New user:",o.I()),[4,gf(n.Uh,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Hl.forEach(function(t){t.forEach(function(t){t.reject(new Cr(Lr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Hl.clear(),n.Ll.wh(o,r.ja,r.Ga),[4,lp(n,r.Wa)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}.bind(null,this.$u),[4,xl(this.Ml,this.$u.Xl)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Tp.prototype.d_=function(t){return new Rl},Tp.prototype.__=function(t){var e=ma(t.rt.O),n=(n=t.rt,new Ii(n));return t=t.credentials,new Ha(t,n,e)},Tp.prototype.f_=function(t){var e=this;return new ll(this.Uh,this.Qh,t.ks,function(t){return ip(e.$u,t,0)},t=new(ei.G()?ei:ti))},Tp.prototype.w_=function(t,e){return n=this.Uh,r=this.Ml,i=this.$l,o=this.Ll,s=t.h_,t=t.Bl,e=e,t=new $l(n,r,i,o,s,t),e&&(t.Yl=!0),t;var n,r,i,o,s},Tp.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,br("RemoteStore","RemoteStore shutting down."),e.Gh.add(5),[4,vl(e)];case 1:return t.sent(),e.Hh.L(),e.Jh.set("Unknown"),[2]}})})}(this.Ml)},Tp);function Tp(){}function Ap(t,e){var n=this;return(n=mp.call(this,t,e,!1)||this).l_=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function Np(t,e,n){var r=this;return(r=wp.call(this)||this).l_=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function Sp(){this.synchronizeTabs=!1}function Op(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2]})})},releaseLock:function(){}}}var Dp,xp=(Bp.prototype.next=function(t){this.observer.next&&this.T_(this.observer.next,t)},Bp.prototype.error=function(t){this.observer.error?this.T_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Bp.prototype.I_=function(){this.muted=!0},Bp.prototype.T_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Bp),kp=(qp.prototype.close=function(){return this.m_.cancel()},qp.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2,this.metadata.promise]})})},qp.prototype.s_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.R_())]}})})},qp.prototype.R_=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.P_()];case 1:return null===(e=t.sent())?[2,null]:(r=this.A_.decode(e),n=Number(r),isNaN(n)&&this.y_("length string ("+r+") is not valid number"),[4,this.g_(n)]);case 2:return r=t.sent(),[2,new jl(JSON.parse(r),e.length+n)]}})})},qp.prototype.V_=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},qp.prototype.P_=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.V_()<0?[4,this.p_()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.V_())<0&&this.y_("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},qp.prototype.g_=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.p_()]:[3,3];case 1:t.sent()&&this.y_("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.A_.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},qp.prototype.y_=function(t){throw this.m_.cancel(),new Error("Invalid bundle format: "+t)},qp.prototype.p_=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.m_.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},qp),Pp=(Fp.prototype.isEqual=function(t){return this.b_.isEqual(t.b_)},Fp),Rp=function(t){this._methodName=t},Lp=(Object.defineProperty(jp.prototype,"D_",{get:function(){return this.S_.path},enumerable:!1,configurable:!0}),Object.defineProperty(jp.prototype,"id",{get:function(){return this.S_.path.Vt()},enumerable:!1,configurable:!0}),Object.defineProperty(jp.prototype,"path",{get:function(){return this.S_.path.Ct()},enumerable:!1,configurable:!0}),Object.defineProperty(jp.prototype,"parent",{get:function(){return new Up(this.firestore,this.v_,this.S_.path.yt())},enumerable:!1,configurable:!0}),jp.prototype.withConverter=function(t){return new jp(this.firestore,t,this.S_)},jp),Cp=(Mp.prototype.withConverter=function(t){return new Mp(this.firestore,t,this.C_)},Mp),Up=(h(Vp,Dp=Cp),Object.defineProperty(Vp.prototype,"id",{get:function(){return this.C_.path.Vt()},enumerable:!1,configurable:!0}),Object.defineProperty(Vp.prototype,"path",{get:function(){return this.C_.path.Ct()},enumerable:!1,configurable:!0}),Object.defineProperty(Vp.prototype,"parent",{get:function(){var t=this.D_.yt();return t.bt()?null:new Lp(this.firestore,null,new Si(t))},enumerable:!1,configurable:!0}),Vp.prototype.withConverter=function(t){return new Vp(this.firestore,t,this.D_)},Vp);function Vp(t,e,n){var r=this;return(r=Dp.call(this,t,e,rs(n))||this).firestore=t,r.D_=n,r.type="collection",r}function Mp(t,e,n){this.v_=e,this.C_=n,this.type="query",this.firestore=t}function jp(t,e,n){this.v_=e,this.S_=n,this.type="document",this.firestore=t}function Fp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.b_=new Ni(t)}function qp(t,e){var n=this;this.m_=t,this.fe=e,this.metadata=new bi,this.buffer=new Uint8Array,this.A_=new TextDecoder("utf-8"),this.R_().then(function(t){t&&t.Tl()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function Bp(t){this.observer=t,this.muted=!1}function Gp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof Vr&&(t=t._),bc("collection","path",e),t instanceof xc)return Tc(n=Ti.xt.apply(Ti,f([e],r))),new Up(t,null,n);if(!(t instanceof Lp||t instanceof Up))throw new Cr(Lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Tc(n=Ti.xt.apply(Ti,f([t.path],r)).child(Ti.xt(e))),new Up(t.firestore,null,n)}function zp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof Vr&&(t=t._),1===arguments.length&&(e=Nr.t()),bc("doc","path",e),t instanceof xc)return _c(n=Ti.xt.apply(Ti,f([e],r))),new Lp(t,null,new Si(n));if(!(t instanceof Lp||t instanceof Up))throw new Cr(Lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return _c(n=t.D_.child(Ti.xt.apply(Ti,f([e],r)))),new Lp(t.firestore,t instanceof Up?t.v_:null,new Si(n))}function Hp(t,e){return t instanceof Vr&&(t=t._),e instanceof Vr&&(e=e._),(t instanceof Lp||t instanceof Up)&&(e instanceof Lp||e instanceof Up)&&t.firestore===e.firestore&&t.path===e.path&&t.v_===e.v_}function Kp(t,e){return t instanceof Vr&&(t=t._),e instanceof Vr&&(e=e._),t instanceof Cp&&e instanceof Cp&&t.firestore===e.firestore&&ls(t.C_,e.C_)&&t.v_===e.v_}var Wp=(Object.defineProperty(Zp.prototype,"latitude",{get:function(){return this.x_},enumerable:!1,configurable:!0}),Object.defineProperty(Zp.prototype,"longitude",{get:function(){return this.N_},enumerable:!1,configurable:!0}),Zp.prototype.isEqual=function(t){return this.x_===t.x_&&this.N_===t.N_},Zp.prototype.toJSON=function(){return{latitude:this.x_,longitude:this.N_}},Zp.prototype.dt=function(t){return Or(this.x_,t.x_)||Or(this.N_,t.N_)},Zp),Qp=/^__.*__$/,Yp=($p.prototype.F_=function(t,e){return null!==this.Te?new Js(t,this.data,this.Te,e,this.fieldTransforms):new Ys(t,this.data,e,this.fieldTransforms)},$p),Jp=(Xp.prototype.F_=function(t,e){return new Js(t,this.data,this.Te,e,this.fieldTransforms)},Xp);function Xp(t,e,n){this.data=t,this.Te=e,this.fieldTransforms=n}function $p(t,e,n){this.data=t,this.Te=e,this.fieldTransforms=n}function Zp(t,e){if(!isFinite(t)||t<-90||90<t)throw new Cr(Lr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Cr(Lr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.x_=t,this.N_=e}function td(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Tr()}}var ed=(Object.defineProperty(id.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(id.prototype,"k_",{get:function(){return this.settings.k_},enumerable:!1,configurable:!0}),id.prototype.M_=function(t){return new id(Object.assign(Object.assign({},this.settings),t),this.O,this.fe,this.ignoreUndefinedProperties,this.fieldTransforms,this.Te)},id.prototype.L_=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t);return(e=this.M_({path:e,B_:!1})).q_(t),e},id.prototype.U_=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t);return(t=this.M_({path:t,B_:!1})).O_(),t},id.prototype.Q_=function(t){return this.M_({path:void 0,B_:!0})},id.prototype.K_=function(t){return Rd(t,this.settings.methodName,this.settings.W_||!1,this.path,this.settings.j_)},id.prototype.contains=function(e){return void 0!==this.Te.find(function(t){return e.vt(t)})||void 0!==this.fieldTransforms.find(function(t){return e.vt(t.field)})},id.prototype.O_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.q_(this.path.get(t))},id.prototype.q_=function(t){if(0===t.length)throw this.K_("Document fields must not be empty");if(td(this.k_)&&Qp.test(t))throw this.K_('Document fields cannot begin and end with "__"')},id),nd=(rd.prototype.G_=function(t,e,n,r){return void 0===r&&(r=!1),new ed({k_:t,methodName:e,j_:n,path:Ni.Nt(),B_:!1,W_:r},this.O,this.fe,this.ignoreUndefinedProperties)},rd);function rd(t,e,n){this.O=t,this.ignoreUndefinedProperties=e,this.fe=n||ma(t)}function id(t,e,n,r,i,o){this.settings=t,this.O=e,this.fe=n,this.ignoreUndefinedProperties=r,void 0===i&&this.O_(),this.fieldTransforms=i||[],this.Te=o||[]}function od(t){var e=t.so(),n=ma(t.zr);return new nd(t.zr,!!e.ignoreUndefinedProperties,n)}function sd(t,e,n,r,i,o){void 0===o&&(o={});var s=t.G_(o.merge||o.mergeFields?2:0,e,n,i);Dd("Data must be an object, but it was:",s,r);var u,a,r=Sd(r,s);if(o.merge)u=new Fi(s.Te),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,f=o.mergeFields;h<f.length;h++){var l=xd(e,f[h],n);if(!s.contains(l))throw new Cr(Lr.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");Ld(c,l)||c.push(l)}u=new Fi(c),a=s.fieldTransforms.filter(function(t){return u.Qt(t.field)})}else u=null,a=s.fieldTransforms;return new Yp(new so(r),u,a)}var ud,ad=(h(cd,ud=Rp),cd.prototype.z_=function(t){if(2!==t.k_)throw 1===t.k_?t.K_(this._methodName+"() can only appear at the top level of your update data"):t.K_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.Te.push(t.path),null},cd.prototype.isEqual=function(t){return t instanceof cd},cd);function cd(){return null!==ud&&ud.apply(this,arguments)||this}function hd(t,e,n){return new ed({k_:3,j_:e.settings.j_,methodName:t._methodName,B_:n},e.O,e.fe,e.ignoreUndefinedProperties)}var fd,ld,pd,dd,yd=(h(Ed,dd=Rp),Ed.prototype.z_=function(t){return new Fs(t.path,new As)},Ed.prototype.isEqual=function(t){return t instanceof Ed},Ed),vd=(h(Id,pd=Rp),Id.prototype.z_=function(t){var e=hd(this,t,!0),n=this.H_.map(function(t){return Nd(t,e)}),n=new Ns(n);return new Fs(t.path,n)},Id.prototype.isEqual=function(t){return this===t},Id),gd=(h(bd,ld=Rp),bd.prototype.z_=function(t){var e=hd(this,t,!0),n=this.H_.map(function(t){return Nd(t,e)}),n=new ks(n);return new Fs(t.path,n)},bd.prototype.isEqual=function(t){return this===t},bd),md=(h(wd,fd=Rp),wd.prototype.z_=function(t){var e=new Cs(t.fe,Is(t.fe,this.J_));return new Fs(t.path,e)},wd.prototype.isEqual=function(t){return this===t},wd);function wd(t,e){var n=this;return(n=fd.call(this,t)||this).J_=e,n}function bd(t,e){var n=this;return(n=ld.call(this,t)||this).H_=e,n}function Id(t,e){var n=this;return(n=pd.call(this,t)||this).H_=e,n}function Ed(){return null!==dd&&dd.apply(this,arguments)||this}function _d(t,r,i,e){var o=t.G_(1,r,i);Dd("Data must be an object, but it was:",o,e);var s=[],u=new uo;return Mi(e,function(t,e){var n=Pd(r,t,i);e instanceof Vr&&(e=e._),t=o.U_(n),e instanceof ad?s.push(n):null!=(t=Nd(e,t))&&(s.push(n),u.set(n,t))}),e=new Fi(s),new Jp(u.Gt(),e,o.fieldTransforms)}function Td(t,e,n,r,i,o){var s=t.G_(1,e,n),u=[xd(e,r,n)],a=[i];if(o.length%2!=0)throw new Cr(Lr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(xd(e,o[c])),a.push(o[c+1]);for(var h,f,l,p=[],d=new uo,y=u.length-1;0<=y;--y)Ld(p,u[y])||(h=u[y],(f=a[y])instanceof Vr&&(f=f._),l=s.U_(h),f instanceof ad?p.push(h):null!=(l=Nd(f,l))&&(p.push(h),d.set(h,l)));return i=new Fi(p),new Jp(d.Gt(),i,s.fieldTransforms)}function Ad(t,e,n,r){return void 0===r&&(r=!1),Nd(n,t.G_(r?4:3,e))}function Nd(s,t){if(s instanceof Vr&&(s=s._),Od(s))return Dd("Unsupported field value:",t,s),Sd(s,t);if(s instanceof Rp)return function(t,e){if(!td(e.k_))throw e.K_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.K_(t._methodName+"() is not currently supported inside arrays");(t=t.z_(e))&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.Te.push(t.path),s instanceof Array){if(t.settings.B_&&4!==t.k_)throw t.K_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Nd(i[r],t.Q_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(t instanceof Vr&&(t=t._),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Is(e.fe,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ei.fromDate(t);return{timestampValue:Yu(e.fe,n)}}if(t instanceof Ei)return n=new Ei(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Yu(e.fe,n)};if(t instanceof Wp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ur)return{bytesValue:Ju(e.fe,t.l)};if(t instanceof Lp){n=e.O;var r=t.firestore.zr;if(!r.isEqual(n))throw e.K_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:$u(t.firestore.zr||e.O,t.S_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.K_("Unsupported field value: "+Ac(t))}(s,t)}function Sd(t,n){var r={};return ji(t)?n.path&&0<n.path.length&&n.Te.push(n.path):Mi(t,function(t,e){null!=(e=Nd(e,n.L_(t)))&&(r[t]=e)}),{mapValue:{fields:r}}}function Od(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ei||t instanceof Wp||t instanceof Ur||t instanceof Lp||t instanceof Rp)}function Dd(t,e,n){if(!Od(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=Ac(n))?e.K_(t+" a custom object"):e.K_(t+" "+n);var r}function xd(t,e,n){if(e instanceof Vr&&(e=e._),e instanceof Pp)return e.b_;if("string"==typeof e)return Pd(t,e);throw Rd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var kd=new RegExp("[~\\*/\\[\\]]");function Pd(e,n,r){if(0<=n.search(kd))throw Rd("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(Pp.bind.apply(Pp,f([void 0],n.split("."))))).b_}catch(t){throw Rd("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Rd(t,e,n,r,i){var o=r&&!r.bt(),s=void 0!==i,e="Function "+e+"() called with invalid data";return n&&(e+=" (via `toFirestore()`)"),n="",(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Cr(Lr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Ld(t,e){return t.some(function(t){return t.isEqual(e)})}var Cd=(Fd.prototype.ef=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.nf(),0<this.mutations.length)throw new Cr(Lr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var r,e,n,i,o;return v(this,function(t){switch(t.label){case 0:return e=ia((r=s).fe)+"/documents",n={documents:u.map(function(t){return ta(r.fe,t)})},[4,r._t("BatchGetDocuments",e,n)];case 1:return n=t.sent(),i=new Map,n.forEach(function(t){var e,n,t=(n=r.fe,"found"in t?function(t,e){Ar(!!e.found),e.found.name,e.found.updateTime;var n=ea(t,e.found.name),t=Xu(e.found.updateTime),e=new so({mapValue:{fields:e.found.fields}});return new po(n,t,e,{})}(n,t):"missing"in t?(e=n,Ar(!!(n=t).missing),Ar(!!n.readTime),e=ea(e,n.missing),n=Xu(n.readTime),new yo(e,n)):Tr());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){Ar(!!(t=i.get(t.toString()))),o.push(t)}),o)]}})})}(this.Qh,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof yo||t instanceof po?n.sf(t):Tr()}),e)]}})})},Fd.prototype.set=function(t,e){this.write(e.F_(t,this.Ee(t))),this.tf.add(t.toString())},Fd.prototype.update=function(t,e){try{this.write(e.F_(t,this.rf(t)))}catch(t){this.Z_=t}this.tf.add(t.toString())},Fd.prototype.delete=function(t){this.write(new su(t,this.Ee(t))),this.tf.add(t.toString())},Fd.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.nf(),this.Z_)throw this.Z_;return e=this.Y_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Si.$t(e),n.mutations.push(new uu(e,n.Ee(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=ia((e=i).fe)+"/documents",r={writes:o.map(function(t){return aa(e.fe,t)})},[4,e.at("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.Qh,this.mutations)];case 1:return t.sent(),this.X_=!0,[2]}})})},Fd.prototype.sf=function(t){var e;if(t instanceof po)e=t.version;else{if(!(t instanceof yo))throw Tr();e=_i.min()}var n=this.Y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Cr(Lr.ABORTED,"Document version changed between two reads.")}else this.Y_.set(t.key.toString(),e)},Fd.prototype.Ee=function(t){var e=this.Y_.get(t.toString());return!this.tf.has(t.toString())&&e?qs.updateTime(e):qs.de()},Fd.prototype.rf=function(t){var e=this.Y_.get(t.toString());if(this.tf.has(t.toString())||!e)return qs.exists(!0);if(e.isEqual(_i.min()))throw new Cr(Lr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qs.updateTime(e)},Fd.prototype.write=function(t){this.nf(),this.mutations.push(t)},Fd.prototype.nf=function(){},Fd),Ud=(jd.prototype.run=function(){this.af()},jd.prototype.af=function(){var t=this;this.ui.ti(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Cd(this.Qh),(n=this.uf(e))&&n.then(function(t){r.ks.Ws(function(){return e.commit().then(function(){r.Bs.resolve(t)}).catch(function(t){r.hf(t)})})}).catch(function(t){r.hf(t)}),[2]})})})},jd.prototype.uf=function(t){try{var e=this.updateFunction(t);return!ci(e)&&e.catch&&e.then?e:(this.Bs.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Bs.reject(t),null}},jd.prototype.hf=function(t){var e=this;0<this.cf&&this.lf(t)?(--this.cf,this.ks.Ws(function(){return e.af(),Promise.resolve()})):this.Bs.reject(t)},jd.prototype.lf=function(t){return"FirebaseError"===t.name&&("aborted"===(t=t.code)||"failed-precondition"===t||!di(t))},jd),Vd=(Md.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.S.promise];case 1:return[2,(t.sent(),{ks:this.ks,rt:this.rt,clientId:this.clientId,credentials:this.credentials,h_:this.user,Bl:100})]}})})},Md.prototype.ff=function(t){var e=this;this._f=t,this.S.promise.then(function(){return e._f(e.user)})},Md.prototype.df=function(){if(this.ks.wf)throw new Cr(Lr.FAILED_PRECONDITION,"The client has already been terminated.")},Md.prototype.terminate=function(){var t=this;this.ks.Ef();var n=new bi;return this.ks.Tf(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.If?[4,this.If.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.mf?[4,this.mf.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.p(),n.resolve(),[3,6];case 5:return e=Ma(t.sent(),"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Md);function Md(t,e,n){var r=this;this.credentials=t,this.ks=e,this.rt=n,this.user=zr.UNAUTHENTICATED,this.clientId=Nr.t(),this._f=function(){},this.S=new bi,this.credentials.V(function(t){br("FirestoreClient","Received user=",t.uid),r.user.isEqual(t)||(r.user=t,r._f(t)),r.S.resolve()})}function jd(t,e,n,r){this.ks=t,this.Qh=e,this.updateFunction=n,this.Bs=r,this.cf=5,this.ui=new Ba(this.ks,"transaction_retry")}function Fd(t){this.Qh=t,this.Y_=new Map,this.mutations=[],this.X_=!1,this.Z_=null,this.tf=new Set}function qd(r,i){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return r.ks.Af(),br("FirestoreClient","Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return e=t.sent(),[4,i.initialize(e)];case 2:return t.sent(),r.ff(function(e){return r.ks.ea(function(){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,gf(i.Uh,e)];case 1:return t.sent(),[2]}})})})}),i.persistence.Xc(function(){return r.terminate()}),r.mf=i,[2]}})})}function Bd(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return r.ks.Af(),[4,Gd(r)];case 1:return e=t.sent(),br("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.ff(function(t){return r.ks.ea(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).ks.Af(),br("RemoteStore","RemoteStore received new credentials"),n=_l(e),e.Gh.add(3),[4,vl(e)];case 1:return t.sent(),n&&e.Jh.set("Unknown"),[4,e.Kh.E_(i)];case 2:return t.sent(),e.Gh.delete(3),[4,yl(e)];case 3:return t.sent(),[2]}})})}(i.Ml,t)})}),r.If=i,[2]}})})}function Gd(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.mf?[3,2]:(br("FirestoreClient","Using default OfflineComponentProvider"),[4,qd(e,new bp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.mf]}})})}function zd(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.If?[3,2]:(br("FirestoreClient","Using default OnlineComponentProvider"),[4,Bd(e,new _p)]);case 1:t.sent(),t.label=2;case 2:return[2,e.If]}})})}function Hd(t){return Gd(t).then(function(t){return t.persistence})}function Kd(t){return Gd(t).then(function(t){return t.Uh})}function Wd(t){return zd(t).then(function(t){return t.Ml})}function Qd(t){return zd(t).then(function(t){return t.$u})}function Yd(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,zd(r)];case 1:return e=t.sent(),[2,((n=e.$l).ol=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=yp(s),(o=e.Ul.get(u))?(n=o.targetId,e.Ll.ah(n),r=o.view.Ol(),[3,4]):[3,1];case 1:return[4,bf(e.Uh,hs(u))];case 2:return i=t.sent(),o=e.Ll.ah(i.targetId),n=i.targetId,[4,ep(e,u,n,"current"===o)];case 3:r=t.sent(),e.Xl&&gl(e.Ml,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.$u),n.ul=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ul.get(o),1<(r=e.Ql.get(n.targetId)).length?[2,(e.Ql.set(n.targetId,r.filter(function(t){return!ls(t,o)})),void e.Ul.delete(o))]:e.Xl?(e.Ll.hh(n.targetId),e.Ll.nh(n.targetId)?[3,2]:[4,If(e.Uh,n.targetId,!1).then(function(){e.Ll._h(n.targetId),ml(e.Ml,n.targetId),ap(e,n.targetId)}).catch(ic)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return ap(e,n.targetId),[4,If(e.Uh,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.$u),n)]}})})}function Jd(n,r,i){var t=this;void 0===i&&(i={});var o=new bi;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new xp({next:function(t){r.Ws(function(){return Ul(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Cr(Lr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Cr(Lr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new Ml(rs(i.path),t,{includeMetadataChanges:!0,El:!0});return Cl(n,u)},[4,Yd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.ks,r,i,o])]}})})}),o.promise}function Xd(n,r,i){var t=this;void 0===i&&(i={});var o=new bi;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new xp({next:function(t){n.Ws(function(){return Ul(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Cr(Lr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new Ml(t,o,{includeMetadataChanges:!0,El:!0});return Cl(e,s)},[4,Yd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.ks,r,i,o])]}})})}),o.promise}var $d,Zd=(Object.defineProperty(ny.prototype,"wf",{get:function(){return this.yf},enumerable:!1,configurable:!0}),ny.prototype.Ws=function(t){this.enqueue(t)},ny.prototype.Tf=function(t){this.Sf(),this.Df(t)},ny.prototype.Ef=function(){var t;this.yf||(this.yf=!0,(t=fl())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.vf))},ny.prototype.enqueue=function(t){return this.Sf(),this.yf?new Promise(function(t){}):this.Df(t)},ny.prototype.ea=function(t){var e=this;this.Ws(function(){return e.Pf.push(t),e.Cf()})},ny.prototype.Cf=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.Pf.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Pf[0]()];case 2:return t.sent(),this.Pf.shift(),this.ui.reset(),[3,4];case 3:if(!xa(e=t.sent()))throw e;return br("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Pf.length&&this.ui.ti(function(){return n.Cf()}),t.label=5;case 5:return[2]}})})},ny.prototype.Df=function(t){var r=this,e=this.Rf.then(function(){return r.pf=!0,t().catch(function(t){throw r.Vf=t,r.pf=!1,Ir("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.pf=!1,t})});return this.Rf=e},ny.prototype.ni=function(t,e,n){var r=this;return this.Sf(),-1<this.bf.indexOf(t)&&(e=0),n=Ua.qs(this,t,e,n,function(t){return r.xf(t)}),this.gf.push(n),n},ny.prototype.Sf=function(){this.Vf&&Tr()},ny.prototype.Af=function(){},ny.prototype.Nf=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Rf];case 1:t.sent(),t.label=2;case 2:if(e!==this.Rf)return[3,0];t.label=3;case 3:return[2]}})})},ny.prototype.Ff=function(t){for(var e=0,n=this.gf;e<n.length;e++)if(n[e].Ms===t)return!0;return!1},ny.prototype.Of=function(r){var i=this;return this.Nf().then(function(){i.gf.sort(function(t,e){return t.$s-e.$s});for(var t=0,e=i.gf;t<e.length;t++){var n=e[t];if(n.Ks(),"all"!==r&&n.Ms===r)break}return i.Nf()})},ny.prototype.kf=function(t){this.bf.push(t)},ny.prototype.xf=function(t){t=this.gf.indexOf(t),this.gf.splice(t,1)},ny),ty=(h(ey,$d=xc),ey.prototype.io=function(){return this.$f||iy(this),this.$f.terminate()},ey);function ey(t,e){var n=this;return(n=$d.call(this,t,e)||this).Mf=new Zd,n.Wr="name"in t?t.name:"[DEFAULT]",n}function ny(){var e=this;this.Rf=Promise.resolve(),this.Pf=[],this.yf=!1,this.gf=[],this.Vf=null,this.pf=!1,this.bf=[],this.ui=new Ba(this,"async_queue_retry"),this.vf=function(){var t=fl();t&&br("AsyncQueue","Visibility state changed to "+t.visibilityState),e.ui.si()};var t=fl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.vf)}function ry(t){return t.$f||iy(t),t.$f.df(),t.$f}function iy(t){var e,n,r=t.so(),r=(e=t.zr,n=t.Wr,new $r(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.$f=new Vd(t.Hr,t.Mf,r)}function oy(n,r,i){var t=this,o=new bi;return n.ks.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,qd(n,i)];case 1:return t.sent(),[4,Bd(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===Lr.FAILED_PRECONDITION||t.code===Lr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function sy(t){if(t.Yr||t.Xr)throw new Cr(Lr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var uy,o=(ly.prototype.Lf=function(t,e){switch(void 0===e&&(e="none"),Qi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zi(t.integerValue||t.doubleValue);case 3:return this.Bf(t.timestampValue);case 4:return this.qf(t,e);case 5:return t.stringValue;case 6:return this.Uf(Hi(t.bytesValue));case 7:return this.Qf(t.referenceValue);case 8:return this.Kf(t.geoPointValue);case 9:return this.Wf(t.arrayValue,e);case 10:return this.jf(t.mapValue,e);default:throw Tr()}},ly.prototype.jf=function(t,n){var r=this,i={};return Mi(t.fields||{},function(t,e){i[t]=r.Lf(e,n)}),i},ly.prototype.Kf=function(t){return new Wp(zi(t.latitude),zi(t.longitude))},ly.prototype.Wf=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.Lf(t,e)})},ly.prototype.qf=function(t,e){switch(e){case"previous":var n=function t(e){return Ki(e=e.mapValue.fields.__previous_value__)?t(e):e}(t);return null==n?null:this.Lf(n,e);case"estimate":return this.Bf(Wi(t));default:return null}},ly.prototype.Bf=function(t){return t=Gi(t),new Ei(t.seconds,t.nanos)},ly.prototype.Gf=function(t,e){var n=Ti.xt(t);return Ar(ga(n)),t=new Zr(n.get(1),n.get(3)),n=new Si(n.Pt(5)),t.isEqual(e)||Ir("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},ly),ay=(Object.defineProperty(fy.prototype,"id",{get:function(){return this.S_.path.Vt()},enumerable:!1,configurable:!0}),Object.defineProperty(fy.prototype,"ref",{get:function(){return new Lp(this.zf,this.v_,this.S_)},enumerable:!1,configurable:!0}),fy.prototype.exists=function(){return null!==this.Jf},fy.prototype.data=function(){if(this.Jf){if(this.v_){var t=new cy(this.zf,this.Hf,this.S_,this.Jf,null);return this.v_.fromFirestore(t)}return this.Hf.Lf(this.Jf.Yt())}},fy.prototype.get=function(t){if(this.Jf&&null!==(t=this.Jf.data().field(py("DocumentSnapshot.get",t))))return this.Hf.Lf(t)},fy),cy=(h(hy,uy=ay),hy.prototype.data=function(){return uy.prototype.data.call(this)},hy);function hy(){return null!==uy&&uy.apply(this,arguments)||this}function fy(t,e,n,r,i){this.zf=t,this.Hf=e,this.S_=n,this.Jf=r,this.v_=i}function ly(){}function py(t,e){return"string"==typeof e?Pd(t,e):(e instanceof Vr?e._:e).b_}function dy(t){if(os(t)&&0===t.ne.length)throw new Cr(Lr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function yy(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r].Yf(t);return t}var vy,gy,my,wy,by,Iy=(h(xy,by=me=function(){}),xy.prototype.Yf=function(t){var e=od(t.firestore),e=function(t,e,n,r,i,o){if(r.Ot()){if("array-contains"===i||"array-contains-any"===i)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Ry(o,i);for(var s=[],u=0,a=o;u<a.length;u++){var c=a[u];s.push(Py(n,t,c))}h={arrayValue:{values:s}}}else h=Py(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Ry(o,i),h=Ad(e,"where",o,"in"===i||"not-in"===i);var h=No.create(r,i,h);return function(t,e){if(e.ee()){var n=us(t);if(null!==n&&!n.isEqual(e.field))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");null!==(n=ss(t))&&Ly(0,e.field,n)}if(null!==(t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw t===e.op?new Cr(Lr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Cr(Lr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t.C_,e,t.firestore.zr,this.Xf,this.Zf,this.td);return new Cp(t.firestore,t.v_,(e=(t=t.C_).filters.concat([e]),new es(t.path,t.collectionGroup,t.ne.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},xy),Ey=(h(Dy,wy=me),Dy.prototype.Yf=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new $o(e,n);return e=r,null!==ss(n=t)||null!==(t=us(n))&&Ly(0,t,e.field),r}(t.C_,this.Xf,this.ed);return new Cp(t.firestore,t.v_,(e=(t=t.C_).ne.concat([e]),new es(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},Dy),_y=(h(Oy,my=me),Oy.prototype.Yf=function(t){return new Cp(t.firestore,t.v_,fs(t.C_,this.nd,this.sd))},Oy),Ty=(h(Sy,gy=me),Sy.prototype.Yf=function(t){var e=ky(t,this.type,this.rd,this.od);return new Cp(t.firestore,t.v_,(t=t.C_,new es(t.path,t.collectionGroup,t.ne.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},Sy),Ay=(h(Ny,vy=me),Ny.prototype.Yf=function(t){var e=ky(t,this.type,this.rd,this.od);return new Cp(t.firestore,t.v_,(t=t.C_,new es(t.path,t.collectionGroup,t.ne.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},Ny);function Ny(t,e,n){var r=this;return(r=vy.call(this)||this).type=t,r.rd=e,r.od=n,r}function Sy(t,e,n){var r=this;return(r=gy.call(this)||this).type=t,r.rd=e,r.od=n,r}function Oy(t,e,n){var r=this;return(r=my.call(this)||this).type=t,r.nd=e,r.sd=n,r}function Dy(t,e){var n=this;return(n=wy.call(this)||this).Xf=t,n.ed=e,n.type="orderBy",n}function xy(t,e,n){var r=this;return(r=by.call(this)||this).Xf=t,r.Zf=e,r.td=n,r.type="where",r}function ky(t,c,e,n){if(e[0]instanceof Vr&&(e[0]=e[0]._),e[0]instanceof ay)return function(t,e,n,r){if(!n)throw new Cr(Lr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=cs(t);o<s.length;o++){var u=s[o];if(u.field.Ot())i.push(to(e,n.key));else{var a=n.field(u.field);if(Ki(a))throw new Cr(Lr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a)throw u=u.field.Ct(),new Cr(Lr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.");i.push(a)}}return new Ko(i,r)}(t.C_,t.firestore.zr,e[0].Jf,n);var r=od(t.firestore);return function(t,e,n,r,i,o){var s=t.ne;if(i.length>s.length)throw new Cr(Lr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.Ot()){if("string"!=typeof c)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!as(t)&&-1!==c.indexOf("/"))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Ti.xt(c));if(!Si.qt(h))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Si(h),u.push(to(e,h))}else c=Ad(n,r,c),u.push(c)}return new Ko(u,o)}(t.C_,t.firestore.zr,r,c,e,n)}function Py(t,e,n){if(n instanceof Vr&&(n=n._),"string"==typeof n){if(""===n)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!as(e)&&-1!==n.indexOf("/"))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(e=e.path.child(Ti.xt(n)),!Si.qt(e))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return to(t,new Si(e))}if(n instanceof Lp)return to(t,n.S_);throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ac(n)+".")}function Ry(t,e){if(!Array.isArray(t)||0===t.length)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ly(t,e,n){if(!n.isEqual(e))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Cy(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Uy,Vy=(h(My,Uy=o),My.prototype.Uf=function(t){return new Ur(t)},My.prototype.Qf=function(t){return t=this.Gf(t,this.firestore.zr),new Lp(this.firestore,null,t)},My);function My(t){var e=this;return(e=Uy.call(this)||this).firestore=t,e}function jy(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Fy,qy,By=(Yy.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Yy),Gy=(h(Qy,qy=ay),Qy.prototype.exists=function(){return qy.prototype.exists.call(this)},Qy.prototype.data=function(t){if(void 0===t&&(t={}),this.Jf){if(this.v_){var e=new zy(this.zf,this.Hf,this.S_,this.Jf,this.metadata,null);return this.v_.fromFirestore(e,t)}return this.Hf.Lf(this.Jf.Yt(),t.serverTimestamps)}},Qy.prototype.get=function(t,e){if(void 0===e&&(e={}),this.Jf&&null!==(t=this.Jf.data().field(py("DocumentSnapshot.get",t))))return this.Hf.Lf(t,e.serverTimestamps)},Qy),zy=(h(Wy,Fy=Gy),Wy.prototype.data=function(t){return void 0===t&&(t={}),Fy.prototype.data.call(this,t)},Wy),Hy=(Object.defineProperty(Ky.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Ky.prototype,"size",{get:function(){return this.ud.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Ky.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Ky.prototype.forEach=function(e,n){var r=this;this.ud.docs.forEach(function(t){e.call(n,new zy(r.zf,r.Hf,t.key,t,new By(r.ud.tn.has(t.key),r.ud.fromCache),r.query.v_))})},Ky.prototype.docChanges=function(t){if(void 0===t&&(t={}),(t=!!t.includeMetadataChanges)&&this.ud.nn)throw new Cr(Lr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.hd&&this.ld===t||(this.hd=function(i,e){if(i.ud.Ze.bt()){var n=0;return i.ud.docChanges.map(function(t){var e=new zy(i.zf,i.Hf,t.doc.key,t.doc,new By(i.ud.tn.has(t.doc.key),i.ud.fromCache),i.query.v_);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i.ud.Ze;return i.ud.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new zy(i.zf,i.Hf,t.doc.key,t.doc,new By(i.ud.tn.has(t.doc.key),i.ud.fromCache),i.query.v_),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Tr()}}(),doc:e,oldIndex:n,newIndex:r}})}(this,t),this.ld=t),this.hd},Ky);function Ky(t,e,n,r){this.zf=t,this.Hf=e,this.ud=r,this.metadata=new By(r.hasPendingWrites,r.fromCache),this.query=n}function Wy(){return null!==Fy&&Fy.apply(this,arguments)||this}function Qy(t,e,n,r,i,o){var s=this;return(s=qy.call(this,t,e,n,r,o)||this).zf=t,s.ad=t,s.metadata=i,s}function Yy(t,e){this.hasPendingWrites=t,this.fromCache=e}function Jy(t,e){return t instanceof Gy&&e instanceof Gy?t.zf===e.zf&&t.S_.isEqual(e.S_)&&(null===t.Jf?null===e.Jf:t.Jf.isEqual(e.Jf))&&t.v_===e.v_:t instanceof Hy&&e instanceof Hy&&t.zf===e.zf&&Kp(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.ud.isEqual(e.ud)}var Xy,$y=(h(Zy,Xy=o),Zy.prototype.Uf=function(t){return new Ur(t)},Zy.prototype.Qf=function(t){return t=this.Gf(t,this.firestore.zr),new Lp(this.firestore,null,t)},Zy);function Zy(t){var e=this;return(e=Xy.call(this)||this).firestore=t,e}function tv(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Nc(t,Lp);var o=Nc(t.firestore,ty),s=od(o);return e instanceof Vr&&(e=e._),nv(o,[("string"==typeof e||e instanceof Pp?Td(s,"updateDoc",t.S_,e,n,r):_d(s,"updateDoc",t.S_,e)).F_(t.S_,qs.exists(!0))])}function ev(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e instanceof Vr&&(e=e._);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||jy(n[i])||(r=n[i],i++);var o,s,u,a,c,h,f={includeMetadataChanges:r.includeMetadataChanges};return jy(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof Lp?(u=Nc(e.firestore,ty),a=rs(e.S_.path),h={next:function(t){n[i]&&n[i](rv(u,e,t))},error:n[i+1],complete:n[i+2]}):(s=Nc(e,Cp),u=Nc(s.firestore,ty),a=s.C_,c=new $y(u),h={next:function(t){n[i]&&n[i](new Hy(u,c,s,t))},error:n[i+1],complete:n[i+2]},dy(e.C_)),function(n,t,e){var r=this,i=new xp(h),o=new Ml(t,i,e);return n.ks.Ws(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Cl,[4,Yd(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.I_(),n.ks.Ws(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Ul,[4,Yd(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(ry(u),a,f)}function nv(t,e){return function(n,r){var t=this,i=new bi;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=np,[4,Qd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(ry(t),e)}function rv(t,e,n){var r=n.docs.get(e.S_),i=new $y(t);return new Gy(t,i,e.S_,r,new By(n.hasPendingWrites,n.fromCache),e.v_)}var iv=(ov.prototype.set=function(t,e,n){return this.Ed(),e=Cy((t=sv(t,this.zf)).v_,e,n),n=sd(this.wd,"WriteBatch.set",t.S_,e,null!==t.v_,n),this.fd.push(n.F_(t.S_,qs.de())),this},ov.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this.Ed(),t=sv(t,this.zf),e instanceof Vr&&(e=e._),e="string"==typeof e||e instanceof Pp?Td(this.wd,"WriteBatch.update",t.S_,e,n,r):_d(this.wd,"WriteBatch.update",t.S_,e),this.fd.push(e.F_(t.S_,qs.exists(!0))),this},ov.prototype.delete=function(t){return this.Ed(),t=sv(t,this.zf),this.fd=this.fd.concat(new su(t.S_,qs.de())),this},ov.prototype.commit=function(){return this.Ed(),this.dd=!0,0<this.fd.length?this._d(this.fd):Promise.resolve()},ov.prototype.Ed=function(){if(this.dd)throw new Cr(Lr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},ov);function ov(t,e){this.zf=t,this._d=e,this.fd=[],this.dd=!1,this.wd=od(t)}function sv(t,e){if(t instanceof Vr&&(t=t._),t.firestore!==e)throw new Cr(Lr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var uv,av,cv,hv=(mv.prototype.get=function(t){var e=this,n=sv(t,this.zf),r=new Vy(this.zf);return this.Td.ef([n.S_]).then(function(t){if(!t||1!==t.length)return Tr();if((t=t[0])instanceof yo)return new ay(e.zf,r,n.S_,null,n.v_);if(t instanceof po)return new ay(e.zf,r,t.key,t,n.v_);throw Tr()})},mv.prototype.set=function(t,e,n){return e=Cy((t=sv(t,this.zf)).v_,e,n),n=sd(this.wd,"Transaction.set",t.S_,e,null!==t.v_,n),this.Td.set(t.S_,n),this},mv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t=sv(t,this.zf),e instanceof Vr&&(e=e._),e="string"==typeof e||e instanceof Pp?Td(this.wd,"Transaction.update",t.S_,e,n,r):_d(this.wd,"Transaction.update",t.S_,e),this.Td.update(t.S_,e),this},mv.prototype.delete=function(t){return t=sv(t,this.zf),this.Td.delete(t.S_),this},h(gv,cv=mv),gv.prototype.get=function(t){var e=this,n=sv(t,this.zf),r=new $y(this.zf);return cv.prototype.get.call(this,t).then(function(t){return new Gy(e.zf,r,n.S_,t.Jf,new By(!1,!1),n.v_)})},gv),fv=(vv.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){sy(t=Nc(t,ty));var n=ry(t),r=t.so();return oy(n,t=new _p,new Ip(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._,{forceOwnership:e})},vv.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){sy(t=Nc(t,ty));var e=ry(t),n=t.so();return oy(e,t=new _p,new Ep(t,n.cacheSizeBytes))}(t._)},vv.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n.Yr&&!n.Xr)throw new Cr(Lr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new bi;return n.Mf.Tf(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Ea.G()?(e=n+"main",[4,Ea.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(uf(n.zr,n.Wr))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t._)},vv),lv=(h(yv,av=Vr),Object.defineProperty(yv.prototype,"zr",{get:function(){return this._.zr},enumerable:!1,configurable:!0}),yv.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._.no()),t)).merge,this._.eo(t)},yv.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this._.no().host&&Er("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},yv.prototype.enableNetwork=function(){return function(r){var t=this;return r.ks.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Hd(r)];case 1:return e=t.sent(),[4,Wd(r)];case 2:return n=t.sent(),[2,(e.Zc(!0),(t=n).Gh.delete(0),yl(t))]}})})})}(ry(Nc(this._,ty)))},yv.prototype.disableNetwork=function(){return function(r){var t=this;return r.ks.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Hd(r)];case 1:return e=t.sent(),[4,Wd(r)];case 2:return n=t.sent(),[2,(e.Zc(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Gh.add(0),[4,vl(e)];case 1:return t.sent(),e.Jh.set("Offline"),[2]}})})}(n))]}})})})}(ry(Nc(this._,ty)))},yv.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Ec("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Id.enableMultiTabIndexedDbPersistence(this):this.Id.enableIndexedDbPersistence(this,n)},yv.prototype.clearPersistence=function(){return this.Id.clearIndexedDbPersistence(this)},yv.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._._delete()},yv.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new bi;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=op,[4,Qd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(ry(Nc(this._,ty)))},yv.prototype.onSnapshotsInSync=function(t){return function(n,t){var e=this,r=new xp(t);return n.ks.Ws(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.rl.add(e),e.next()},[4,Yd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.I_(),n.ks.Ws(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.rl.delete(e)},[4,Yd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(ry(Nc(this._,ty)),jy(t)?t:{next:t})},Object.defineProperty(yv.prototype,"app",{get:function(){if(!this.md)throw new Cr(Lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.md},enumerable:!1,configurable:!0}),yv.prototype.collection=function(t){try{return new Bv(this,Gp(this._,t))}catch(t){throw Ov(t,"collection()","Firestore.collection()")}},yv.prototype.doc=function(t){try{return new Tv(this,zp(this._,t))}catch(t){throw Ov(t,"doc()","Firestore.doc()")}},yv.prototype.collectionGroup=function(t){try{return new jv(this,function(t,e){if(t=Nc(t,xc),bc("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Cr(Lr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Cp(t,null,new es(Ti.Nt(),e))}(this._,t))}catch(t){throw Ov(t,"collectionGroup()","Firestore.collectionGroup()")}},yv.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new bi;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,zd(n).then(function(t){return t.Qh})];case 1:return e=t.sent(),new Ud(n.ks,e,r,i).run(),[2]}})})}),i.promise}(ry(n=this._),function(t){return t=new hv(n,t),e(new Ev(r,t))})},yv.prototype.batch=function(){var e=this;return ry(this._),new _v(new iv(this._,function(t){return nv(e._,t)}))},yv.prototype.loadBundle=function(t){throw new Cr(Lr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},yv.prototype.namedQuery=function(t){throw new Cr(Lr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},yv),pv=(h(dv,uv=o),dv.prototype.Uf=function(t){return new Gr(new Ur(t))},dv.prototype.Qf=function(t){return t=this.Gf(t,this.firestore.zr),Tv.Ad(t,this.firestore,null)},dv);function dv(t){var e=this;return(e=uv.call(this)||this).firestore=t,e}function yv(t,e,n){var r=this;return(r=av.call(this,e)||this).Id=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof Zr||(r.md=t),r}function vv(){}function gv(t,e){var n=this;return(n=cv.call(this,t,e)||this).zf=t,n}function mv(t,e){this.zf=t,this.Td=e,this.wd=od(t)}var wv,bv,Iv,Ev=(h(Sv,Iv=Vr),Sv.prototype.get=function(t){var e=this,t=Yv(t);return this._.get(t).then(function(t){return new Vv(e.zf,t)})},Sv.prototype.set=function(t,e,n){return t=Yv(t),n?(Ic("Transaction.set",n),this._.set(t,e,n)):this._.set(t,e),this},Sv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Yv(t);return 2===arguments.length?this._.update(o,e):(t=this._).update.apply(t,f([o,e,n],r)),this},Sv.prototype.delete=function(t){return t=Yv(t),this._.delete(t),this},Sv),_v=(h(Nv,bv=Vr),Nv.prototype.set=function(t,e,n){return t=Yv(t),n?(Ic("WriteBatch.set",n),this._.set(t,e,n)):this._.set(t,e),this},Nv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Yv(t);return 2===arguments.length?this._.update(o,e):(t=this._).update.apply(t,f([o,e,n],r)),this},Nv.prototype.delete=function(t){return t=Yv(t),this._.delete(t),this},Nv.prototype.commit=function(){return this._.commit()},Nv),Tv=(h(Av,wv=Vr),Av.Rd=function(t,e,n){if(t.length%2!=0)throw new Cr(Lr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.Ct()+" has "+t.length);return new Av(e,new Lp(e._,n,new Si(t)))},Av.Ad=function(t,e,n){return new Av(e,new Lp(e._,n,t))},Object.defineProperty(Av.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(Av.prototype,"parent",{get:function(){return new Bv(this.firestore,this._.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Av.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Av.prototype.collection=function(t){try{return new Bv(this.firestore,Gp(this._,t))}catch(t){throw Ov(t,"collection()","DocumentReference.collection()")}},Av.prototype.isEqual=function(t){return t instanceof Vr&&(t=t._),t instanceof Lp&&Hp(this._,t)},Av.prototype.set=function(t,e){e=Ic("DocumentReference.set",e);try{return function(t,e,n){t=Nc(t,Lp);var r=Nc(t.firestore,ty),e=Cy(t.v_,e,n);return nv(r,[sd(od(r),"setDoc",t.S_,e,null!==t.v_,n).F_(t.S_,qs.de())])}(this._,t,e)}catch(t){throw Ov(t,"setDoc()","DocumentReference.set()")}},Av.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?tv(this._,t):tv.apply(void 0,f([this._,t,e],n))}catch(t){throw Ov(t,"updateDoc()","DocumentReference.update()")}},Av.prototype.delete=function(){return nv(Nc((t=this._).firestore,ty),[new su(t.S_,qs.de())]);var t},Av.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Dv(t),i=xv(t,function(t){return new Vv(e.firestore,new Gy(e.firestore._,e.Hf,t.S_,t.Jf,t.metadata,e._.v_))});return ev(this._,r,i)},Av.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Nc(e,Lp);var n=Nc(e.firestore,ty),t=ry(n),r=new $y(n);return function(n,r){var t=this,i=new bi;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(o,s,u){return y(this,void 0,void 0,function(){var r,i;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Ka.Pa(t,e)}))];case 1:return(i=t.sent())instanceof po?u.resolve(i):i instanceof yo?u.resolve(null):u.reject(new Cr(Lr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=Ma(r,"Failed to get document '"+s+" from cache"),u.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,Kd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e.S_).then(function(t){return new Gy(n,r,e.S_,t,new By(t instanceof po&&t.Jt,!0),e.v_)})}:"server"===(null==t?void 0:t.source)?function(e){e=Nc(e,Lp);var n=Nc(e.firestore,ty);return Jd(ry(n),e.S_,{source:"server"}).then(function(t){return rv(n,e,t)})}:function(e){e=Nc(e,Lp);var n=Nc(e.firestore,ty);return Jd(ry(n),e.S_).then(function(t){return rv(n,e,t)})})(this._).then(function(t){return new Vv(e.firestore,new Gy(e.firestore._,e.Hf,t.S_,t.Jf,t.metadata,e._.v_))})},Av.prototype.withConverter=function(t){return new Av(this.firestore,this._.withConverter(t))},Av);function Av(t,e){var n=this;return(n=wv.call(this,e)||this).firestore=t,n.Hf=new pv(t),n}function Nv(){return null!==bv&&bv.apply(this,arguments)||this}function Sv(t,e){var n=this;return(n=Iv.call(this,e)||this).zf=t,n}function Ov(t,e,n){return t.message=t.message.replace(e,n),t}function Dv(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!jy(r))return r}return{}}function xv(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=jy(t[0])?t[0]:jy(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var kv,Pv,Rv,Lv,Cv,Uv,Vv=(h(Qv,Uv=Vr),Object.defineProperty(Qv.prototype,"ref",{get:function(){return new Tv(this.zf,this._.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(Qv.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(Qv.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Qv.prototype,"exists",{get:function(){return this._.exists()},enumerable:!1,configurable:!0}),Qv.prototype.data=function(t){return this._.data(t)},Qv.prototype.get=function(t,e){return this._.get(t,e)},Qv.prototype.isEqual=function(t){return Jy(this._,t._)},Qv),Mv=(h(Wv,Cv=Vv),Wv.prototype.data=function(t){return this._.data(t)},Wv),jv=(h(Kv,Lv=Vr),Kv.prototype.where=function(t,e,n){try{return new Kv(this.firestore,yy(this._,(r=n,i=e,o=py("where",t),new Iy(o,i,r))))}catch(t){throw Ov(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},Kv.prototype.orderBy=function(n,t){try{return new Kv(this.firestore,yy(this._,function(t){void 0===t&&(t="asc");var e=t,t=py("orderBy",n);return new Ey(t,e)}(t)))}catch(n){throw Ov(n,/(orderBy|where)\(\)/,"Query.$1()")}},Kv.prototype.limit=function(t){try{return new Kv(this.firestore,yy(this._,(Sc("limit",e=t),new _y("limit",e,"F"))))}catch(t){throw Ov(t,"limit()","Query.limit()")}var e},Kv.prototype.limitToLast=function(t){try{return new Kv(this.firestore,yy(this._,(Sc("limitToLast",e=t),new _y("limitToLast",e,"L"))))}catch(t){throw Ov(t,"limitToLast()","Query.limitToLast()")}var e},Kv.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Kv(this.firestore,yy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ty("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Ov(t,"startAt()","Query.startAt()")}},Kv.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Kv(this.firestore,yy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ty("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Ov(t,"startAfter()","Query.startAfter()")}},Kv.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Kv(this.firestore,yy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ay("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Ov(t,"endBefore()","Query.endBefore()")}},Kv.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Kv(this.firestore,yy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ay("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Ov(t,"endAt()","Query.endAt()")}},Kv.prototype.isEqual=function(t){return Kp(this._,t._)},Kv.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Nc(e,Cp);var n=Nc(e.firestore,ty),t=ry(n),r=new $y(n);return function(n,r){var t=this,i=new bi;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Ef(i,o,!0)];case 1:return r=t.sent(),e=new Yl(o,r.za),n=e.bl(r.documents),n=e.yr(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=Ma(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,Kd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e.C_).then(function(t){return new Hy(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=Nc(e,Cp);var n=Nc(e.firestore,ty),t=ry(n),r=new $y(n);return Xd(t,e.C_,{source:"server"}).then(function(t){return new Hy(n,r,e,t)})}:function(e){e=Nc(e,Cp);var n=Nc(e.firestore,ty),t=ry(n),r=new $y(n);return dy(e.C_),Xd(t,e.C_).then(function(t){return new Hy(n,r,e,t)})})(this._).then(function(t){return new qv(e.firestore,new Hy(e.firestore._,e.Hf,e._,t.ud))})},Kv.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Dv(t),i=xv(t,function(t){return new qv(e.firestore,new Hy(e.firestore._,e.Hf,e._,t.ud))});return ev(this._,r,i)},Kv.prototype.withConverter=function(t){return new Kv(this.firestore,this._.withConverter(t))},Kv),Fv=(h(Hv,Rv=Vr),Object.defineProperty(Hv.prototype,"type",{get:function(){return this._.type},enumerable:!1,configurable:!0}),Object.defineProperty(Hv.prototype,"doc",{get:function(){return new Mv(this.zf,this._.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Hv.prototype,"oldIndex",{get:function(){return this._.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Hv.prototype,"newIndex",{get:function(){return this._.newIndex},enumerable:!1,configurable:!0}),Hv),qv=(h(zv,Pv=Vr),Object.defineProperty(zv.prototype,"query",{get:function(){return new jv(this.zf,this._.query)},enumerable:!1,configurable:!0}),Object.defineProperty(zv.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(zv.prototype,"size",{get:function(){return this._.size},enumerable:!1,configurable:!0}),Object.defineProperty(zv.prototype,"empty",{get:function(){return this._.empty},enumerable:!1,configurable:!0}),Object.defineProperty(zv.prototype,"docs",{get:function(){var e=this;return this._.docs.map(function(t){return new Mv(e.zf,t)})},enumerable:!1,configurable:!0}),zv.prototype.docChanges=function(t){var e=this;return this._.docChanges(t).map(function(t){return new Fv(e.zf,t)})},zv.prototype.forEach=function(e,n){var r=this;this._.forEach(function(t){e.call(n,new Mv(r.zf,t))})},zv.prototype.isEqual=function(t){return Jy(this._,t._)},zv),Bv=(h(Gv,kv=jv),Object.defineProperty(Gv.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(Gv.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Object.defineProperty(Gv.prototype,"parent",{get:function(){var t=this._.parent;return t?new Tv(this.firestore,t):null},enumerable:!1,configurable:!0}),Gv.prototype.doc=function(t){try{return new Tv(this.firestore,void 0===t?zp(this._):zp(this._,t))}catch(t){throw Ov(t,"doc()","CollectionReference.doc()")}},Gv.prototype.add=function(t){var e,n=this,r=this._,i=t;return t=Nc(r.firestore,ty),e=zp(r),i=Cy(r.v_,i),nv(t,[sd(od(r.firestore),"addDoc",e.S_,i,null!==r.v_,{}).F_(e.S_,qs.exists(!1))]).then(function(){return e}).then(function(t){return new Tv(n.firestore,t)})},Gv.prototype.isEqual=function(t){return Hp(this._,t._)},Gv.prototype.withConverter=function(t){return new Gv(this.firestore,this._.withConverter(t))},Gv);function Gv(t,e){var n=this;return(n=kv.call(this,t,e)||this).firestore=t,n._=e,n}function zv(t,e){var n=this;return(n=Pv.call(this,e)||this).zf=t,n}function Hv(t,e){var n=this;return(n=Rv.call(this,e)||this).zf=t,n}function Kv(t,e){var n=this;return(n=Lv.call(this,e)||this).firestore=t,n.Hf=new pv(t),n}function Wv(){return null!==Cv&&Cv.apply(this,arguments)||this}function Qv(t,e){var n=this;return(n=Uv.call(this,e)||this).zf=t,n}function Yv(t){return t instanceof Vr&&(t=t._),Nc(t,Lp)}var Jv,Xv,me=(h(eg,Xv=Vr),eg.documentId=function(){return new eg(Ni.kt().Ct())},eg.prototype.isEqual=function(t){return t instanceof Vr&&(t=t._),t instanceof Pp&&this._.b_.isEqual(t.b_)},eg),o=(h(tg,Jv=Vr),tg.serverTimestamp=function(){var t=new yd("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new tg(t)},tg.delete=function(){var t=new ad("deleteField");return t._methodName="FieldValue.delete",new tg(t)},tg.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vd("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new tg(n)},tg.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gd("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new tg(n)},tg.increment=function(t){return(t=new md("increment",t))._methodName="FieldValue.increment",new tg(t)},tg.prototype.isEqual=function(t){return this._.isEqual(t._)},tg),$v=(Zv.prototype.onProgress=function(t,e,n){this.Pd={next:t,error:e,complete:n}},Zv.prototype.catch=function(t){return this.yd.promise.catch(t)},Zv.prototype.then=function(t,e){return this.yd.promise.then(t,e)},Zv.prototype.e_=function(t){this.n_(t),this.Pd.complete&&this.Pd.complete(),this.yd.resolve(t)},Zv.prototype.i_=function(t){this.gd.taskState="Error",this.Pd.next&&this.Pd.next(this.gd),this.Pd.error&&this.Pd.error(t),this.yd.reject(t)},Zv.prototype.n_=function(t){this.gd=t,this.Pd.next&&this.Pd.next(t)},Zv);function Zv(){this.Pd={},this.yd=new bi,this.gd={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function tg(){return null!==Jv&&Jv.apply(this,arguments)||this}function eg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Xv.call(this,new(Pp.bind.apply(Pp,f([void 0],t))))||this}ng.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},ng.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},ng.prototype.setServiceProps=function(t){return this.serviceProps=t,this},ge=ng;function ng(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}o={Firestore:lv,GeoPoint:Wp,Timestamp:Ei,Blob:Gr,Transaction:Ev,WriteBatch:_v,DocumentReference:Tv,DocumentSnapshot:Vv,Query:jv,QueryDocumentSnapshot:Mv,QuerySnapshot:qv,CollectionReference:Bv,FieldPath:me,FieldValue:o,setLogLevel:function(t){mr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(e=e.default).INTERNAL.registerComponent(new ge("firestore",function(t){var e=t.getProvider("app").getImmediate();return t=t.getProvider("auth-internal"),new lv(e,new ty(e,t),new fv)},"PUBLIC").setServiceProps(Object.assign({},o))),e.registerVersion("@firebase/firestore","2.1.0-202011823329"),lv.prototype.loadBundle=function(t){return e=this,s=t,t=new $v,function(n,t,r){var e,i=this,o=(e=s,t=ma(t),e=function(t){if(t instanceof Uint8Array)return Op(t,void 0);if(t instanceof ArrayBuffer)return Op(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new kp(e,t));n.ks.Ws(function(){return y(i,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=gp,[4,Qd(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(ry(e._),e.zr,t),t;var e,s},lv.prototype.namedQuery=function(t){return function(n,r){var t=this;return n.ks.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Wc.ho(t,e)})},[4,Kd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(ry((e=this)._),t).then(function(t){return t?new jv(e,new Cp(e._,null,t.query)):null});var e}}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});