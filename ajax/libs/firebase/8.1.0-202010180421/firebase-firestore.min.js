!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(jv){"use strict";try{(function(){var l,t,e=(t=jv)&&"object"==typeof t&&"default"in t?t:{default:t},r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function u(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=c[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,u(["["+i+"]  "+t.name+":"],n))}}(ge=l=l||{})[ge.DEBUG=0]="DEBUG",ge[ge.VERBOSE=1]="VERBOSE",ge[ge.INFO=2]="INFO",ge[ge.WARN=3]="WARN",ge[ge.ERROR=4]="ERROR",ge[ge.SILENT=5]="SILENT";var o={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},a=l.INFO,c=((me={})[l.DEBUG]="log",me[l.VERBOSE]="log",me[l.INFO]="info",me[l.WARN]="warn",me[l.ERROR]="error",me),h=(Object.defineProperty(f.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),f.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?o[t]:t},Object.defineProperty(f.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),f.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.DEBUG],t)),this._logHandler.apply(this,u([this,l.DEBUG],t))},f.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.VERBOSE],t)),this._logHandler.apply(this,u([this,l.VERBOSE],t))},f.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.INFO],t)),this._logHandler.apply(this,u([this,l.INFO],t))},f.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.WARN],t)),this._logHandler.apply(this,u([this,l.WARN],t))},f.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.ERROR],t)),this._logHandler.apply(this,u([this,l.ERROR],t))},f);function f(t){this.name=t,this._logLevel=a,this._logHandler=i,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,g="FirebaseError",m=(n(w,d=Error),w);function w(t,e,n){return(e=d.call(this,e)||this).code=t,e.customData=n,e.name=g,Object.setPrototypeOf(e,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,b.prototype.create),e}var b=(_.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=(t=this.errors[t])?(r=i,t.replace(I,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},_);function _(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I=/\{\$([^}]+)}/g,E=function(t,e){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function T(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=N||self;function O(){}function S(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function D(t){var e=S(t);return"array"==e||"object"==e&&"number"==typeof t.length}function x(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var k="closure_uid_"+(1e9*Math.random()>>>0),P=0;function R(t,e,n){return t.call.apply(t.bind,arguments)}function C(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function L(t,e,n){return(L=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?R:C).apply(null,arguments)}function V(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var M=Date.now;function U(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t}function j(){this.j=this.j,this.i=this.i}j.prototype.j=!1,j.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&(Object.prototype.hasOwnProperty.call(this,k)&&this[k]||(this[k]=++P))},j.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function G(t){return/^[\s\xa0]*$/.test(t)}var K=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function W(t,e){return-1!=t.indexOf(e)}function H(t,e){return t<e?-1:e<t?1:0}var Q=A.navigator;function Y(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function X(t){var e,n={};for(e in t)n[e]=t[e];return n}at=(Q=Q&&Q.userAgent)?Q:"";var J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<J.length;i++)e=J[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Z(t){return Z[" "](t),t}Z[" "]=O;var tt,et=W(at,"Opera"),nt=W(at,"Trident")||W(at,"MSIE"),rt=W(at,"Edge"),it=rt||nt,ot=W(at,"Gecko")&&!(W(at.toLowerCase(),"webkit")&&!W(at,"Edge"))&&!(W(at,"Trident")||W(at,"MSIE"))&&!W(at,"Edge"),st=W(at.toLowerCase(),"webkit")&&!W(at,"Edge");function ut(){var t=A.document;return t?t.documentMode:void 0}var Q="",at=(at=at,ot?/rv:([^\);]+)(\)|;)/.exec(at):rt?/Edge\/([\d\.]+)/.exec(at):nt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(at):st?/WebKit\/(\S+)/.exec(at):et?/(?:Version)[ \/]?(\S+)/.exec(at):void 0);at&&(Q=at?at[1]:""),tt=nt&&null!=(at=ut())&&at>parseFloat(Q)?String(at):Q;var ct={};function ht(u){return t=u,e=function(){for(var t=0,e=K(String(tt)).split("."),n=K(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=H(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||H(0==o[2].length,0==s[2].length)||H(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=ct,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var ft=A.document&&nt&&(ut()||parseInt(tt,10))||void 0,lt=!nt||9<=Number(ft),pt=nt&&!ht("9"),dt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",O,e),A.removeEventListener("test",O,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function vt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ot){t:{try{Z(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:gt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}yt.prototype.b=function(){this.defaultPrevented=!0},U(vt,yt);var gt={2:"touch",3:"pen",4:"mouse"};vt.prototype.b=function(){vt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,pt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var mt="closure_listenable_"+(1e6*Math.random()|0),wt=0;function bt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++wt,this.Y=this.Z=!1}function _t(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function It(t){this.src=t,this.a={},this.b=0}function Et(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=q(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(_t(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Tt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}It.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Tt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new bt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),At={};function Ot(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Lt(r),e&&e[mt]?e.wa(n,r,x(i)?!!i.capture:!!i,o):St(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ot(t,e[o],n,r,i);return null}return n=Lt(n),t&&t[mt]?t.va(e,n,x(r)?!!r.capture:!!r,i):St(t,e,n,!1,r,i)}function St(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=x(i)?!!i.capture:!!i;if(s&&!lt)return null;var u,a,c=Rt(t);if(c||(t[Nt]=c=new It(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=Pt,r=a=lt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)dt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(xt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Dt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[mt]?Et(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(xt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Rt(e))?(Et(n,t),0==n.b&&(n.src=null,e[Nt]=null)):_t(t)))}function xt(t){return t in At?At[t]:At[t]="on"+t}function kt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Dt(t),n.call(r,e)}function Pt(t,e){if(t.Y)return!0;if(lt)return kt(t,new vt(e,this));if(!e)t:{e=["window","event"];for(var n=A,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return kt(t,e=new vt(e,this))}function Rt(t){return(t=t[Nt])instanceof It?t:null}var Ct="__closure_events_fn_"+(1e9*Math.random()>>>0);function Lt(e){return"function"==S(e)?e:(e[Ct]||(e[Ct]=function(t){return e.handleEvent(t)}),e[Ct])}function Vt(){j.call(this),this.c=new It(this),(this.J=this).C=null}function Mt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new yt(e,t):e instanceof yt?e.target=e.target||t:(s=e,$(e=new yt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Ut(o,r,!0,e)&&s;if(s=Ut(o=e.a=t,r,!0,e)&&s,s=Ut(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Ut(o=e.a=n[i],r,!1,e)&&s}function Ut(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&Et(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}U(Vt,j),Vt.prototype[mt]=!0,(at=Vt.prototype).addEventListener=function(t,e,n,r){Ot(this,t,e,n,r)},at.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=x(i)?!!i.capture:!!i,r=Lt(r),e&&e[mt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Tt(s=e.a[n],r,i,o))&&(_t(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Rt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Tt(n,r,i,o)),(r=-1<e?n[e]:null)&&Dt(r))}(this,t,e,n,r)},at.G=function(){if(Vt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.C=null},at.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},at.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var jt=A.JSON.stringify;function qt(){this.b=this.a=null}var Ft,Bt=(zt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new zt(function(){return new Gt},function(t){t.reset()},100));function zt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Gt(){this.next=this.b=this.a=null}function Kt(t,e){var n;Ft||(n=A.Promise.resolve(void 0),Ft=function(){n.then(Qt)}),Wt||(Ft(),Wt=!0),Ht.add(t,e)}qt.prototype.add=function(t,e){var n=Bt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Gt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Wt=!(Gt.prototype.reset=function(){this.next=this.b=this.a=null}),Ht=new qt;function Qt(){for(var t,e;n=e=void 0,n=null,(e=Ht).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){A.setTimeout(function(){throw t},0)}(t)}var n=Bt;n.g(t),n.b<n.f&&(n.b++,t.next=n.a,n.a=t)}Wt=!1}function Yt(t,e){Vt.call(this),this.b=t||1,this.a=e||A,this.f=L(this.Xa,this),this.g=M()}function Xt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Jt(t,e,n){if("function"==S(t))n&&(t=L(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=L(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}U(Yt,Vt),(at=Yt.prototype).aa=!1,at.M=null,at.Xa=function(){var t;this.aa&&(0<(t=M()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Mt(this,"tick"),this.aa&&(Xt(this),this.start())))},at.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=M())},at.G=function(){Yt.X.G.call(this),Xt(this),delete this.a};var $t,Zt,te=(E(Zt=ne,Q=$t=j),Zt.prototype=null===Q?Object.create(Q):(ee.prototype=Q.prototype,new ee),ne.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Jt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},ne.prototype.G=function(){$t.prototype.G.call(this),this.a&&(A.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},ne);function ee(){this.constructor=Zt}function ne(t,e,n){var r=$t.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function re(t){j.call(this),this.b=t,this.a={}}U(re,j);var ie=[];function oe(t,e,n,r){Array.isArray(n)||(n&&(ie[0]=n.toString()),n=ie);for(var i=0;i<n.length;i++){var o=Ot(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function se(t){Y(t.a,function(t,e){this.a.hasOwnProperty(e)&&Dt(t)},t),t.a={}}function ue(){this.a=!0}function ae(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)&&"noop"!=(r=i[0])&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}return jt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}re.prototype.G=function(){re.X.G.call(this),se(this)},re.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ue.prototype.info=function(){};var ce=null;function he(){return ce=ce||new Vt}function fe(t){yt.call(this,"serverreachability",t)}function le(){var t=he();Mt(t,new fe(t))}function pe(t){yt.call(this,"statevent",t)}function de(){var t=he();Mt(t,new pe(t))}function ye(t){yt.call(this,"timingevent",t)}function ve(t,e){if("function"!=S(t))throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}U(fe,yt),U(pe,yt),U(ye,yt);var ge={NO_ERROR:0,Ya:1,fb:2,eb:3,ab:4,cb:5,gb:6,Da:7,TIMEOUT:8,jb:9},me={$a:"complete",nb:"success",Ea:"error",Da:"abort",lb:"ready",mb:"readystatechange",TIMEOUT:"timeout",hb:"incrementaldata",kb:"progress",bb:"downloadprogress",ob:"uploadprogress"};function we(){}function be(t){var e;return(e=t.a)||(e=t.a={}),e}function _e(){}we.prototype.a=null;var Ie,N={OPEN:"a",Za:"b",Ea:"c",ib:"d"};function Ee(){yt.call(this,"d")}function Te(){yt.call(this,"c")}function Ne(){}function Ae(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new re(this),this.P=Oe,t=it?125:void 0,this.R=new Yt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}U(Ee,yt),U(Te,yt),U(Ne,we),Ie=new Ne;var Oe=45e3,Se={},De={};function xe(t,e,n){t.H=1,t.i=Je(Ke(e)),t.j=n,t.I=!0,ke(t,null)}function ke(t,e){t.u=M(),Re(t),t.l=Ke(t.i);var s,u,a,c,h,f,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),fn(n.b,"t",r),t.D=0,t.a=ir(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(L(t.Ca,t,t.a),t.O)),oe(t.J,t.a,"readystatechange",t.Va),e=t.B?X(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),le(),s=t.c,u=t.m,a=t.l,c=t.f,h=t.S,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Pe(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var u=(u=n,o=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?De:(i=Number(u.substring(i,o)),isNaN(i)?Se:(o+=1)+i>u.length?De:(u=u.substr(o,i),r.D=o+i,u)));if(u==De){4==e&&(t.h=4,de(),s=!1),ae(t.c,t.f,null,"[Incomplete Response]");break}if(u==Se){t.h=4,de(),ae(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}ae(t.c,t.f,u,null),Ue(t,u)}4==e&&0==n.length&&(t.h=1,de(),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xn(e),e.F=!0,de())):(ae(t.c,t.f,n,"[Invalid Chunked Response]"),Me(t),Ve(t))}function Re(t){t.T=M()+t.P,Ce(t,t.P)}function Ce(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ve(L(t.Ta,t),e)}function Le(t){t.o&&(A.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||Zn(t.g,t)}function Me(t){Le(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Xt(t.R),se(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ue(t,e){try{var n,r,i,o,s,u=t.g;if(0!=u.v&&(u.a==t||mn(u.b,t)))if(u.I=t.N,!t.C&&mn(u.b,t)&&3==u.v){try{var a=u.ka.a.parse(e)}catch(t){a=null}if(Array.isArray(a)&&3==a.length){var c=a;if(0==c[0]){t:if(!u.j){if(u.a){if(!(u.a.u+3e3<t.u))break t;$n(u),Fn(u)}Yn(u),de()}}else u.oa=c[1],0<u.oa-u.P&&c[2]<37500&&u.H&&0==u.o&&!u.m&&(u.m=ve(L(u.Qa,u),6e3));if(gn(u.b)<=1&&u.ea){try{u.ea()}catch(t){}u.ea=void 0}}else er(u,11)}else if(!t.C&&u.a!=t||$n(u),!G(e))for(e=a=u.ka.a.parse(e),a=0;a<e.length;a++)c=e[a],u.P=c[0],c=c[1],2==u.v?"c"==c[0]?(u.J=c[1],u.ga=c[2],null!=(r=c[3])&&(u.ha=r,u.c.info("VER="+u.ha)),null!=(o=c[4])&&(u.pa=o,u.c.info("SVER="+u.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,u.D=n,u.c.info("backChannelRequestTimeoutMs_="+n)),n=u,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(W(r,"spdy")||W(r,"quic")||W(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(wn(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,Xe(n.B,n.A,s))),u.v=3,u.f&&u.f.ta(),u.U&&(u.N=M()-t.u,u.c.info("Handshake RTT: "+u.N+"ms")),i=t,(n=u).la=rr(n,n.C?n.ga:null,n.fa),i.C?(bn(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Le(o),Re(o)),n.a=i):Qn(n),0<u.g.length&&Gn(u)):"stop"!=c[0]&&"close"!=c[0]||er(u,7):3==u.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?er(u,7):qn(u):"noop"!=c[0]&&u.f&&u.f.sa(c),u.o=0);le()}catch(t){}}function je(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(D(t)||"string"==typeof t)F(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(D(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(D(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof qe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Fe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Be(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Be(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(at=Ae.prototype).setTimeout=function(t){this.P=t},at.Va=function(t){t=t.target;var e=this.F;e&&3==Vn(t)?e.f():this.Ca(t)},at.Ca=function(t){try{if(t==this.a)t:{var e=Vn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!it&&!this.a.$())){this.A||4!=e||7==n||le(),Le(this);var i=this.a.W();if(this.N=i,n=this.a.$(),this.b=200==i,r=this.c,u=this.m,a=this.l,c=this.f,h=this.S,f=e,l=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+u+"\n"+a+"\n"+f+" "+l}),this.b){if(this.U&&!this.C){e:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.h=3,de(),Me(this),Ve(this);break t}ae(this.c,this.f,s,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ue(this,s)}this.I?(Pe(this,e,n),it&&this.b&&3==e&&(oe(this.J,this.R,"tick",this.Ua),this.R.start())):(ae(this.c,this.f,n,null),Ue(this,n)),4==e&&Me(this),this.b&&!this.A&&(4==e?Zn(this.g,this):(this.b=!1,Re(this)))}else 400==i&&0<n.indexOf("Unknown SID")?this.h=3:this.h=0,de(),Me(this),Ve(this)}}}catch(t){}var u,a,c,h,f,l},at.Ua=function(){var t,e;this.a&&(t=Vn(this.a),e=this.a.$(),this.D<e.length&&(Le(this),Pe(this,t,e),this.b&&4!=t&&Re(this)))},at.cancel=function(){this.A=!0,Me(this)},at.Ta=function(){this.o=null;var t,e,n=M();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(le(),de()),Me(this),this.h=2,Ve(this)):Ce(this,this.T-n)},(at=qe.prototype).K=function(){Fe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},at.L=function(){return Fe(this),this.a.concat()},at.get=function(t,e){return Be(this.b,t)?this.b[t]:e},at.set=function(t,e){Be(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},at.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var ze=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ge(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ge?(this.a=void 0!==e?e:t.a,We(this,t.f),this.j=t.j,He(this,t.c),Qe(this,t.h),this.g=t.g,e=t.b,(n=new un).c=e.c,e.a&&(n.a=new qe(e.a),n.b=e.b),Ye(this,n),this.i=t.i):t&&(n=String(t).match(ze))?(this.a=!!e,We(this,n[1]||"",!0),this.j=$e(n[2]||""),He(this,n[3]||"",!0),Qe(this,n[4]),this.g=$e(n[5]||"",!0),Ye(this,n[6]||"",!0),this.i=$e(n[7]||"")):(this.a=!!e,this.b=new un(null,this.a))}function Ke(t){return new Ge(t)}function We(t,e,n){t.f=n?$e(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function He(t,e,n){t.c=n?$e(e,!0):e}function Qe(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ye(t,e,n){var r,i;e instanceof un?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(an(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),fn(this,n,t))},r)),r.f=i):(n||(e=Ze(e,on)),t.b=new un(e,t.a))}function Xe(t,e,n){t.b.set(e,n)}function Je(t){return Xe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^M()).toString(36)),t}function $e(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ge.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,sn)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,sn=/#/g;function un(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function an(o){o.a||(o.a=new qe,o.b=0,o.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",o.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(o.c))}function cn(t,e){an(t),e=ln(t,e),Be(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Be((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Fe(t)))}function hn(t,e){return an(t),e=ln(t,e),Be(t.a.b,e)}function fn(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(ln(t,e),z(n)),t.b+=n.length)}function ln(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function pn(t,e){this.b=t,this.a=e}function dn(t){this.g=t||yn,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ia&&A.ia.ya&&A.ia.ya()&&A.ia.ya().pb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(at=un.prototype).add=function(t,e){an(this),this.c=null,t=ln(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},at.forEach=function(n,r){an(this),this.a.forEach(function(t,e){F(t,function(t){n.call(r,t,e,this)},this)},this)},at.L=function(){an(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},at.K=function(t){an(this);var e=[];if("string"==typeof t)hn(this,t)&&(e=B(e,this.a.get(ln(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},at.set=function(t,e){return an(this),this.c=null,hn(this,t=ln(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},at.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},at.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var yn=10;function vn(t){return t.b||t.a&&t.a.size>=t.f}function gn(t){return t.b?1:t.a?t.a.size:0}function mn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function bn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function _n(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=T(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function In(){}function En(){this.a=new In}function Tn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=_n(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=T(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},In.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},In.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var Nn=A.JSON.parse;function An(t){Vt.call(this),this.headers=new qe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=On,this.D=this.F=!1}U(An,Vt);var On="",Sn=/^https?$/i,Dn=["POST","PUT"];function xn(t){return"content-type"==t.toLowerCase()}function kn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Pn(t),Cn(t)}function Pn(t){t.u||(t.u=!0,Mt(t,"complete"),Mt(t,"error"))}function Rn(t){if(t.b&&(!t.s[1]||4!=Vn(t)||2!=t.W()))if(t.l&&4==Vn(t))Jt(t.za,0,t);else if(Mt(t,"readystatechange"),4==Vn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(ze)[1]||null)&&A.self&&A.self.location&&(i=(r=A.self.location.protocol).substr(0,r.length-1)),n=!Sn.test(i?i.toLowerCase():"")),e=n),e)Mt(t,"complete"),Mt(t,"success");else{t.h=6;try{var u=2<Vn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.W()+"]",Pn(t)}}finally{Cn(t)}}}function Cn(t,e){if(t.a){Ln(t);var n=t.a,r=t.s[0]?O:null;t.a=null,t.s=null,e||Mt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Ln(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Vn(t){return t.a?t.a.readyState:0}function Mn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Y(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Xe(t,e,n))}function Un(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function jn(t){this.pa=0,this.g=[],this.c=new ue,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Ma=this.R=0,this.Ja=Un("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Fa=Un("baseRetryDelayMs",5e3,t),this.Pa=Un("retryDelaySeedMs",1e4,t),this.Ka=Un("forwardChannelMaxRetries",2,t),this.ma=Un("forwardChannelRequestTimeoutMs",2e4,t),this.La=t&&t.h||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new En,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.g&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ia=t&&t.f||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function qn(t){var e,n;Bn(t),3==t.v&&(e=t.R++,Xe(n=Ke(t.B),"SID",t.J),Xe(n,"RID",e),Xe(n,"TYPE","terminate"),Wn(t,n),(e=new Ae(t,t.c,e,void 0)).H=2,e.i=Je(Ke(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.i.toString(),"")),!n&&A.Image&&((new Image).src=e.i,n=!0),n||(e.a=ir(e.g,null),e.a.ba(e.i)),e.u=M(),Re(e)),nr(t)}function Fn(t){t.a&&(Xn(t),t.a.cancel(),t.a=null)}function Bn(t){Fn(t),t.j&&(A.clearTimeout(t.j),t.j=null),$n(t),t.b.cancel(),t.h&&("number"==typeof t.h&&A.clearTimeout(t.h),t.h=null)}function zn(t,e){t.g.push(new pn(t.Ma++,e)),3==t.v&&Gn(t)}function Gn(t){vn(t.b)||t.h||(t.h=!0,Kt(t.Ba,t),t.u=0)}function Kn(t,e){var n=e?e.f:t.R++,r=Ke(t.B);Xe(r,"SID",t.J),Xe(r,"RID",n),Xe(r,"AID",t.P),Wn(t,r),t.i&&t.l&&Mn(r,t.i,t.l),n=new Ae(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Hn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),xe(n,r,e)}function Wn(t,n){t.f&&je({},function(t,e){Xe(n,e,t)})}function Hn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?L(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r){var i="req"+c+"_"||"";try{je(t,function(t,e){var n=t;x(t)&&(n=jt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s)}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Qn(t){t.a||t.j||(t.T=1,Kt(t.Aa,t),t.o=0)}function Yn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ve(L(t.Aa,t),tr(t,t.o)),t.o++,1)}function Xn(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function Jn(t){t.a=new Ae(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ke(t.la);Xe(e,"RID","rpc"),Xe(e,"SID",t.J),Xe(e,"CI",t.H?"0":"1"),Xe(e,"AID",t.P),Wn(t,e),Xe(e,"TYPE","xmlhttp"),t.i&&t.l&&Mn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Je(Ke(e)),n.j=null,n.I=!0,ke(n,t)}function $n(t){null!=t.m&&(A.clearTimeout(t.m),t.m=null)}function Zn(t,e){var n,r,i,o=null;if(t.a==e){$n(t),Xn(t),t.a=null;var s=2}else{if(!mn(t.b,e))return;o=e.s,bn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=M()-e.u,n=t.u,Mt(s=he(),new ye(s)),Gn(t)):Qn(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,gn((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.Ja?0:r.Ka)||(r.h=ve(L(r.Ba,r,i),tr(r,r.u)),r.u++,0))))&&(2!=s||!Yn(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:er(t,5);break;case 4:er(t,10);break;case 3:er(t,6);break;default:er(t,2)}}function tr(t,e){var n=t.Fa+Math.floor(Math.random()*t.Pa);return t.f||(n*=2),n*e}function er(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=L(t.Wa,t),r||(r=new Ge("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||We(r,"https"),Je(r)),n=r.toString(),r=o,o=new ue,A.Image?((i=new Image).onload=V(Tn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=V(Tn,o,i,"TestLoadImage: error",!1,r),i.onabort=V(Tn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=V(Tn,o,i,"TestLoadImage: timeout",!1,r),A.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):de(),t.v=0,t.f&&t.f.ra(e),nr(t),Bn(t)}function nr(t){t.v=0,t.I=-1,t.f&&(0==_n(t.b).length&&0==t.g.length||(t.b.c.length=0,z(t.g),t.g.length=0),t.f.qa())}function rr(t,e,n){var r,i,o,s,u,a=(s=n)instanceof Ge?Ke(s):new Ge(s,void 0);return""!=a.c?(e&&He(a,e+"."+a.c),Qe(a,a.h)):(r=(u=A.location).protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new Ge(null,void 0),r&&We(u,r),i&&He(u,i),o&&Qe(u,o),s&&(u.g=s),a=u),t.V&&Y(t.V,function(t,e){Xe(a,e,t)}),e=t.A,n=t.na,e&&n&&Xe(a,e,n),Xe(a,"VER",t.ha),Wn(t,a),a}function ir(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new An(t.La)).F=t.C,e}function or(){}function sr(){if(nt&&!(10<=Number(ft)))throw Error("Environmental error: no available transport.")}function ur(t,e){Vt.call(this),this.a=new jn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!G(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!G(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new hr(this)}function ar(t){Ee.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){Te.call(this),this.status=1}function hr(t){this.a=t}(at=An.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?be(this.H):be(Ie),this.a.onreadystatechange=L(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void kn(this,t)}t=n||"";var i,o=new qe(this.headers);r&&je(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=xn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=A.FormData&&t instanceof A.FormData,0<=q(Dn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Ln(this),0<this.o&&((this.D=(i=this.a,nt&&ht(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=L(this.xa,this)):this.m=Jt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){kn(this,t)}},at.xa=function(){this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Mt(this,"timeout"),this.abort(8))},at.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Mt(this,"complete"),Mt(this,"abort"),Cn(this))},at.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Cn(this,!0)),An.X.G.call(this)},at.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Sa())},at.Sa=function(){Rn(this)},at.W=function(){try{return 2<Vn(this)?this.a.status:-1}catch(t){return-1}},at.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},at.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Nn(e)}},at.ua=function(){return this.h},at.Oa=function(){return"string"==typeof this.f?this.f:String(this.f)},(at=jn.prototype).ha=8,at.v=1,at.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ae(this,this.c,t,void 0),r=this.l;if(this.O&&(r?$(r=X(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Hn(this,n,e),Xe(i=Ke(this.B),"RID",t),Xe(i,"CVER",22),this.A&&Xe(i,"X-HTTP-Session-Id",this.A),Wn(this,i),this.i&&r&&Mn(i,this.i,r),wn(this.b,n),this.Ga&&Xe(i,"TYPE","init"),this.da?(Xe(i,"$req",e),Xe(i,"SID","null"),n.U=!0,xe(n,i,null)):xe(n,i,e),this.v=2}}else 3==this.v&&(t?Kn(this,t):0==this.g.length||vn(this.b)||Kn(this))},at.Aa=function(){var t;this.j=null,Jn(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=ve(L(this.Ra,this),t))},at.Ra=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,de(),Fn(this),Jn(this))},at.Qa=function(){null!=this.m&&(this.m=null,Fn(this),Yn(this),de())},at.Wa=function(t){t?this.c.info("Successfully pinged google.com"):this.c.info("Failed to ping google.com"),de()},(at=or.prototype).ta=function(){},at.sa=function(){},at.ra=function(){},at.qa=function(){},at.Ha=function(){},sr.prototype.a=function(t,e){return new ur(t,e)},U(ur,Vt),ur.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;de(),t.fa=e,t.V=n||{},t.H=t.S,t.B=rr(t,null,t.fa),Gn(t)},ur.prototype.close=function(){qn(this.a)},ur.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,zn(this.a,e)):this.l?((e={}).__data__=jt(t),zn(this.a,e)):zn(this.a,t)},ur.prototype.G=function(){this.a.f=null,delete this.f,qn(this.a),delete this.a,ur.X.G.call(this)},U(ar,Ee),U(cr,Te),U(hr,or),hr.prototype.ta=function(){Mt(this.a,"a")},hr.prototype.sa=function(t){Mt(this.a,new ar(t))},hr.prototype.ra=function(t){Mt(this.a,new cr)},hr.prototype.qa=function(){Mt(this.a,"b")},sr.prototype.createWebChannel=sr.prototype.a,ur.prototype.send=ur.prototype.h,ur.prototype.open=ur.prototype.g,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",(_e.EventType=N).OPEN="a",N.CLOSE="b",N.ERROR="c",N.MESSAGE="d",Vt.prototype.listen=Vt.prototype.va,An.prototype.listenOnce=An.prototype.wa,An.prototype.getLastError=An.prototype.Oa,An.prototype.getLastErrorCode=An.prototype.ua,An.prototype.getStatus=An.prototype.W,An.prototype.getResponseJson=An.prototype.Na,An.prototype.getResponseText=An.prototype.$,An.prototype.send=An.prototype.ba;var fr=ge,lr=me,pr=_e,dr=An,N=(yr.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},yr.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},yr.prototype.setServiceProps=function(t){return this.serviceProps=t,this},yr);function yr(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var vr=function(t,e,n,r,i,o){this.t=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.i=o},gr=(Object.defineProperty(br.prototype,"o",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),br.prototype.isEqual=function(t){return t instanceof br&&t.projectId===this.projectId&&t.database===this.database},br),mr=(wr.prototype.u=function(){return null!=this.uid},wr.prototype.h=function(){return this.u()?"uid:"+this.uid:"anonymous-user"},wr.prototype.isEqual=function(t){return t.uid===this.uid},wr);function wr(t){this.uid=t}function br(t,e){this.projectId=t,this.database=e||"(default)"}mr.UNAUTHENTICATED=new mr(null),mr.l=new mr("google-credentials-uid"),mr._=new mr("first-party-uid");var _r="8.1.0-202010180421",Ir=new h("@firebase/firestore");function Er(){return Ir.logLevel}function Tr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ir.logLevel<=l.DEBUG&&(e=n.map(Or),Ir.debug.apply(Ir,s(["Firestore ("+_r+"): "+t],e)))}function Nr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ir.logLevel<=l.ERROR&&(e=n.map(Or),Ir.error.apply(Ir,s(["Firestore ("+_r+"): "+t],e)))}function Ar(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ir.logLevel<=l.WARN&&(e=n.map(Or),Ir.warn.apply(Ir,s(["Firestore ("+_r+"): "+t],e)))}function Or(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Sr(t){throw void 0===t&&(t="Unexpected state"),Nr(t="FIRESTORE ("+_r+") INTERNAL ASSERTION FAILED: "+t),new Error(t)}function Dr(t){t||Sr()}function xr(t,e){this.user=e,this.type="OAuth",this.T={},this.T.Authorization="Bearer "+t}var kr,Pr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Rr=(n(Br,kr=Error),Br),Cr=(Fr.prototype.getToken=function(){return Promise.resolve(null)},Fr.prototype.m=function(){},Fr.prototype.A=function(t){(this.I=t)(mr.UNAUTHENTICATED)},Fr.prototype.R=function(){this.I=null},Fr),Lr=(qr.prototype.getToken=function(){var e=this,n=this.V,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.V!==n?(Tr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Dr("string"==typeof t.accessToken),new xr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},qr.prototype.m=function(){this.forceRefresh=!0},qr.prototype.A=function(t){this.I=t,this.g&&t(this.currentUser)},qr.prototype.R=function(){this.auth&&this.auth.removeAuthTokenListener(this.P),this.P=null,this.I=null},qr.prototype.p=function(){var t=this.auth&&this.auth.getUid();return Dr(null===t||"string"==typeof t),new mr(t)},qr),Vr=(Object.defineProperty(jr.prototype,"T",{get:function(){var t={"X-Goog-AuthUser":this.S},e=this.v.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),jr),Mr=(Ur.prototype.getToken=function(){return Promise.resolve(new Vr(this.v,this.S))},Ur.prototype.A=function(t){t(mr._)},Ur.prototype.R=function(){},Ur.prototype.m=function(){},Ur);function Ur(t,e){this.v=t,this.S=e}function jr(t,e){this.v=t,this.S=e,this.type="FirstParty",this.user=mr._}function qr(t){var e=this;this.P=null,this.currentUser=mr.UNAUTHENTICATED,this.g=!1,this.V=0,this.I=null,this.forceRefresh=!1,this.P=function(){e.V++,e.currentUser=e.p(),e.g=!0,e.I&&e.I(e.currentUser)},this.V=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.P):(this.P(null),t.get().then(function(t){e.auth=t,e.P&&e.auth.addAuthTokenListener(e.P)},function(){}))}function Fr(){this.I=null}function Br(t,e){var n=this;return(n=kr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}var zr=(Gr.D=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(var n=0;n<40;n++)e[n]=Math.floor(256*Math.random());return e}(),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Gr);function Gr(){}function Kr(t,e){return t<e?-1:e<t?1:0}function Wr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Hr(t){return t+"\0"}var Qr,Yr,Xr=(ui.now=function(){return ui.fromMillis(Date.now())},ui.fromDate=function(t){return ui.fromMillis(t.getTime())},ui.fromMillis=function(t){var e=Math.floor(t/1e3);return new ui(e,1e6*(t-1e3*e))},ui.prototype.toDate=function(){return new Date(this.toMillis())},ui.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ui.prototype.C=function(t){return this.seconds===t.seconds?Kr(this.nanoseconds,t.nanoseconds):Kr(this.seconds,t.seconds)},ui.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ui.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ui.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ui.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ui),Jr=(si.N=function(t){return new si(t)},si.min=function(){return new si(new Xr(0,0))},si.prototype.F=function(t){return this.timestamp.C(t.timestamp)},si.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},si.prototype.O=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},si.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},si.prototype.M=function(){return this.timestamp},si),ge=(Object.defineProperty(oi.prototype,"length",{get:function(){return this.k},enumerable:!1,configurable:!0}),oi.prototype.isEqual=function(t){return 0===oi.$(this,t)},oi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof oi?t.forEach(function(t){e.push(t)}):e.push(t),this.L(e)},oi.prototype.limit=function(){return this.offset+this.length},oi.prototype.B=function(t){return t=void 0===t?1:t,this.L(this.segments,this.offset+t,this.length-t)},oi.prototype.q=function(){return this.L(this.segments,this.offset,this.length-1)},oi.prototype.U=function(){return this.segments[this.offset]},oi.prototype.K=function(){return this.get(this.length-1)},oi.prototype.get=function(t){return this.segments[this.offset+t]},oi.prototype.W=function(){return 0===this.length},oi.prototype.j=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},oi.prototype.G=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},oi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},oi.prototype.H=function(){return this.segments.slice(this.offset,this.limit())},oi.$=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},oi),$r=(n(ii,Yr=ge),ii.prototype.L=function(t,e,n){return new ii(t,e,n)},ii.prototype.J=function(){return this.H().join("/")},ii.prototype.toString=function(){return this.J()},ii.Y=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new ii(n)},ii.X=function(){return new ii([])},ii),Zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ti=(n(ri,Qr=ge),ri.prototype.L=function(t,e,n){return new ri(t,e,n)},ri.Z=function(t){return Zr.test(t)},ri.prototype.J=function(){return this.H().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),ri.Z(t)||(t="`"+t+"`"),t}).join(".")},ri.prototype.toString=function(){return this.J()},ri.prototype.tt=function(){return 1===this.length&&"__name__"===this.get(0)},ri.et=function(){return new ri(["__name__"])},ri.nt=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Rr(Pr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Rr(Pr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Rr(Pr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ri(e)},ri.X=function(){return new ri([])},ri),ei=(ni.st=function(t){return new ni($r.Y(t))},ni.it=function(t){return new ni($r.Y(t).B(5))},ni.prototype.rt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ni.prototype.isEqual=function(t){return null!==t&&0===$r.$(this.path,t.path)},ni.prototype.toString=function(){return this.path.toString()},ni.$=function(t,e){return $r.$(t.path,e.path)},ni.ot=function(t){return t.length%2==0},ni.ct=function(t){return new ni(new $r(t.slice()))},ni);function ni(t){this.path=t}function ri(){return null!==Qr&&Qr.apply(this,arguments)||this}function ii(){return null!==Yr&&Yr.apply(this,arguments)||this}function oi(t,e,n){void 0===e?e=0:e>t.length&&Sr(),void 0===n?n=t.length-e:n>t.length-e&&Sr(),this.segments=t,this.offset=e,this.k=n}function si(t){this.timestamp=t}function ui(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Rr(Pr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Rr(Pr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Rr(Pr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Rr(Pr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ai(t){return null==t}function ci(t){return 0===t&&1/t==-1/0}function hi(t){return"number"==typeof t&&Number.isInteger(t)&&!ci(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var fi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.ut=null};function li(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new fi(t,e,n,r,i,o,s)}function pi(t){var e=t;return null===e.ut&&(t=e.path.J(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return t.field.J()+t.op.toString()+mo(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return t.field.J()+t.dir}).join(","),ai(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Hu(e.startAt)),e.endAt&&(t+="|ub:",t+=Hu(e.endAt)),e.ut=t),e.ut}function di(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!po(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Yu(t.startAt,e.startAt)&&Yu(t.endAt,e.endAt)}function yi(t){return ei.ot(t.path)&&null===t.collectionGroup&&0===t.filters.length}var vi=(gi.fromBase64String=function(t){return new gi(atob(t))},gi.fromUint8Array=function(t){return new gi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},gi.prototype.toBase64=function(){return t=this.at,btoa(t);var t},gi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.at)},gi.prototype.ht=function(){return 2*this.at.length},gi.prototype.F=function(t){return Kr(this.at,t.at)},gi.prototype.isEqual=function(t){return this.at===t.at},gi);function gi(t){this.at=t}function mi(t){this.count=t}vi.lt=new vi("");var wi,bi=(_i.prototype.dt=function(t){return new _i(this.target,this.targetId,this._t,t,this.ft,this.lastLimboFreeSnapshotVersion,this.resumeToken)},_i.prototype.wt=function(t,e){return new _i(this.target,this.targetId,this._t,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},_i.prototype.Et=function(t){return new _i(this.target,this.targetId,this._t,this.sequenceNumber,this.ft,t,this.resumeToken)},_i);function _i(t,e,n,r,i,o,s){void 0===i&&(i=Jr.min()),void 0===o&&(o=Jr.min()),void 0===s&&(s=vi.lt),this.target=t,this.targetId=e,this._t=n,this.sequenceNumber=r,this.ft=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ii(t){switch(t){case Pr.OK:return Sr(),0;case Pr.CANCELLED:case Pr.UNKNOWN:case Pr.DEADLINE_EXCEEDED:case Pr.RESOURCE_EXHAUSTED:case Pr.INTERNAL:case Pr.UNAVAILABLE:case Pr.UNAUTHENTICATED:return;case Pr.INVALID_ARGUMENT:case Pr.NOT_FOUND:case Pr.ALREADY_EXISTS:case Pr.PERMISSION_DENIED:case Pr.FAILED_PRECONDITION:case Pr.ABORTED:case Pr.OUT_OF_RANGE:case Pr.UNIMPLEMENTED:case Pr.DATA_LOSS:return 1;default:return Sr(),0}}function Ei(t){if(void 0===t)return Nr("GRPC error has no .code"),Pr.UNKNOWN;switch(t){case wi.OK:return Pr.OK;case wi.CANCELLED:return Pr.CANCELLED;case wi.UNKNOWN:return Pr.UNKNOWN;case wi.DEADLINE_EXCEEDED:return Pr.DEADLINE_EXCEEDED;case wi.RESOURCE_EXHAUSTED:return Pr.RESOURCE_EXHAUSTED;case wi.INTERNAL:return Pr.INTERNAL;case wi.UNAVAILABLE:return Pr.UNAVAILABLE;case wi.UNAUTHENTICATED:return Pr.UNAUTHENTICATED;case wi.INVALID_ARGUMENT:return Pr.INVALID_ARGUMENT;case wi.NOT_FOUND:return Pr.NOT_FOUND;case wi.ALREADY_EXISTS:return Pr.ALREADY_EXISTS;case wi.PERMISSION_DENIED:return Pr.PERMISSION_DENIED;case wi.FAILED_PRECONDITION:return Pr.FAILED_PRECONDITION;case wi.ABORTED:return Pr.ABORTED;case wi.OUT_OF_RANGE:return Pr.OUT_OF_RANGE;case wi.UNIMPLEMENTED:return Pr.UNIMPLEMENTED;case wi.DATA_LOSS:return Pr.DATA_LOSS;default:return Sr()}}(me=wi={})[me.OK=0]="OK",me[me.CANCELLED=1]="CANCELLED",me[me.UNKNOWN=2]="UNKNOWN",me[me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",me[me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",me[me.NOT_FOUND=5]="NOT_FOUND",me[me.ALREADY_EXISTS=6]="ALREADY_EXISTS",me[me.PERMISSION_DENIED=7]="PERMISSION_DENIED",me[me.UNAUTHENTICATED=16]="UNAUTHENTICATED",me[me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",me[me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",me[me.ABORTED=10]="ABORTED",me[me.OUT_OF_RANGE=11]="OUT_OF_RANGE",me[me.UNIMPLEMENTED=12]="UNIMPLEMENTED",me[me.INTERNAL=13]="INTERNAL",me[me.UNAVAILABLE=14]="UNAVAILABLE",me[me.DATA_LOSS=15]="DATA_LOSS";var Ti=(Di.prototype.Tt=function(t,e){return new Di(this.$,this.root.Tt(t,e,this.$).copy(null,null,Ai.It,null,null))},Di.prototype.remove=function(t){return new Di(this.$,this.root.remove(t,this.$).copy(null,null,Ai.It,null,null))},Di.prototype.get=function(t){for(var e=this.root;!e.W();){var n=this.$(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Di.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.W();){var r=this.$(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Di.prototype.W=function(){return this.root.W()},Object.defineProperty(Di.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Di.prototype.At=function(){return this.root.At()},Di.prototype.Rt=function(){return this.root.Rt()},Di.prototype.Pt=function(t){return this.root.Pt(t)},Di.prototype.forEach=function(n){this.Pt(function(t,e){return n(t,e),!1})},Di.prototype.toString=function(){var n=[];return this.Pt(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Di.prototype.gt=function(t){return this.root.gt(t)},Di.prototype.yt=function(){return new Ni(this.root,null,this.$,!1)},Di.prototype.Vt=function(t){return new Ni(this.root,t,this.$,!1)},Di.prototype.vt=function(){return new Ni(this.root,null,this.$,!0)},Di.prototype.bt=function(t){return new Ni(this.root,t,this.$,!0)},Di),Ni=(Si.prototype.Ct=function(){var t=this.Dt.pop(),e={key:t.key,value:t.value};if(this.St)for(t=t.left;!t.W();)this.Dt.push(t),t=t.right;else for(t=t.right;!t.W();)this.Dt.push(t),t=t.left;return e},Si.prototype.Nt=function(){return 0<this.Dt.length},Si.prototype.xt=function(){if(0===this.Dt.length)return null;var t=this.Dt[this.Dt.length-1];return{key:t.key,value:t.value}},Si),Ai=(Oi.prototype.copy=function(t,e,n,r,i){return new Oi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Oi.prototype.W=function(){return!1},Oi.prototype.Pt=function(t){return this.left.Pt(t)||t(this.key,this.value)||this.right.Pt(t)},Oi.prototype.gt=function(t){return this.right.gt(t)||t(this.key,this.value)||this.left.gt(t)},Oi.prototype.min=function(){return this.left.W()?this:this.left.min()},Oi.prototype.At=function(){return this.min().key},Oi.prototype.Rt=function(){return this.right.W()?this.key:this.right.Rt()},Oi.prototype.Tt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Tt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Tt(t,e,n))).Ft()},Oi.prototype.Ot=function(){if(this.left.W())return Oi.EMPTY;var t=this;return t.left.Mt()||t.left.left.Mt()||(t=t.kt()),(t=t.copy(null,null,null,t.left.Ot(),null)).Ft()},Oi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.W()||r.left.Mt()||r.left.left.Mt()||(r=r.kt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Mt()&&(r=r.$t()),r.right.W()||r.right.Mt()||r.right.left.Mt()||(r=r.Lt()),0===e(t,r.key)){if(r.right.W())return Oi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Ot())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Ft()},Oi.prototype.Mt=function(){return this.color},Oi.prototype.Ft=function(){var t=this;return t.right.Mt()&&!t.left.Mt()&&(t=t.Bt()),t.left.Mt()&&t.left.left.Mt()&&(t=t.$t()),t.left.Mt()&&t.right.Mt()&&(t=t.qt()),t},Oi.prototype.kt=function(){var t=this.qt();return t.right.left.Mt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.$t())).Bt()).qt()),t},Oi.prototype.Lt=function(){var t=this.qt();return t.left.left.Mt()&&(t=(t=t.$t()).qt()),t},Oi.prototype.Bt=function(){var t=this.copy(null,null,Oi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Oi.prototype.$t=function(){var t=this.copy(null,null,Oi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Oi.prototype.qt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Oi.prototype.Ut=function(){var t=this.Qt();return Math.pow(2,t)<=this.size+1},Oi.prototype.Qt=function(){if(this.Mt()&&this.left.Mt())throw Sr();if(this.right.Mt())throw Sr();var t=this.left.Qt();if(t!==this.right.Qt())throw Sr();return t+(this.Mt()?0:1)},Oi);function Oi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Oi.RED,this.left=null!=r?r:Oi.EMPTY,this.right=null!=i?i:Oi.EMPTY,this.size=this.left.size+1+this.right.size}function Si(t,e,n,r){this.St=r,this.Dt=[];for(var i=1;!t.W();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.St?t.left:t.right;else{if(0===i){this.Dt.push(t);break}this.Dt.push(t),t=this.St?t.right:t.left}}function Di(t,e){this.$=t,this.root=e||Ai.EMPTY}function xi(){this.size=0}Ai.EMPTY=null,Ai.RED=!0,Ai.It=!1,Ai.EMPTY=(Object.defineProperty(xi.prototype,"key",{get:function(){throw Sr()},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"value",{get:function(){throw Sr()},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"color",{get:function(){throw Sr()},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"left",{get:function(){throw Sr()},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"right",{get:function(){throw Sr()},enumerable:!1,configurable:!0}),xi.prototype.copy=function(t,e,n,r,i){return this},xi.prototype.Tt=function(t,e,n){return new Ai(t,e)},xi.prototype.remove=function(t,e){return this},xi.prototype.W=function(){return!0},xi.prototype.Pt=function(t){return!1},xi.prototype.gt=function(t){return!1},xi.prototype.At=function(){return null},xi.prototype.Rt=function(){return null},xi.prototype.Mt=function(){return!1},xi.prototype.Ut=function(){return!0},xi.prototype.Qt=function(){return 0},new xi);var ki=(Li.prototype.has=function(t){return null!==this.data.get(t)},Li.prototype.first=function(){return this.data.At()},Li.prototype.last=function(){return this.data.Rt()},Object.defineProperty(Li.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Li.prototype.indexOf=function(t){return this.data.indexOf(t)},Li.prototype.forEach=function(n){this.data.Pt(function(t,e){return n(t),!1})},Li.prototype.Kt=function(t,e){for(var n=this.data.Vt(t[0]);n.Nt();){var r=n.Ct();if(0<=this.$(r.key,t[1]))return;e(r.key)}},Li.prototype.Wt=function(t,e){for(var n=void 0!==e?this.data.Vt(e):this.data.yt();n.Nt();)if(!t(n.Ct().key))return},Li.prototype.jt=function(t){return(t=this.data.Vt(t)).Nt()?t.Ct().key:null},Li.prototype.yt=function(){return new Pi(this.data.yt())},Li.prototype.Vt=function(t){return new Pi(this.data.Vt(t))},Li.prototype.add=function(t){return this.copy(this.data.remove(t).Tt(t,!0))},Li.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Li.prototype.W=function(){return this.data.W()},Li.prototype.Gt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Li.prototype.isEqual=function(t){if(!(t instanceof Li))return!1;if(this.size!==t.size)return!1;for(var e=this.data.yt(),n=t.data.yt();e.Nt();){var r=e.Ct().key,i=n.Ct().key;if(0!==this.$(r,i))return!1}return!0},Li.prototype.H=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Li.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Li.prototype.copy=function(t){var e=new Li(this.$);return e.data=t,e},Li),Pi=(Ci.prototype.Ct=function(){return this.zt.Ct().key},Ci.prototype.Nt=function(){return this.zt.Nt()},Ci),Ri=new Ti(ei.$);function Ci(t){this.zt=t}function Li(t){this.$=t,this.data=new Ti(this.$)}var Vi=new Ti(ei.$),Mi=new Ti(ei.$),Ui=new ki(ei.$);function ji(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ui,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var qi=new ki(Kr),Fi=(ro.Yt=function(t){return new ro(t.$)},ro.prototype.has=function(t){return null!=this.Ht.get(t)},ro.prototype.get=function(t){return this.Ht.get(t)},ro.prototype.first=function(){return this.Jt.At()},ro.prototype.last=function(){return this.Jt.Rt()},ro.prototype.W=function(){return this.Jt.W()},ro.prototype.indexOf=function(t){return(t=this.Ht.get(t))?this.Jt.indexOf(t):-1},Object.defineProperty(ro.prototype,"size",{get:function(){return this.Jt.size},enumerable:!1,configurable:!0}),ro.prototype.forEach=function(n){this.Jt.Pt(function(t,e){return n(t),!1})},ro.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ht.Tt(t.key,t),e.Jt.Tt(t,null))},ro.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ht.remove(t),this.Jt.remove(e)):this},ro.prototype.isEqual=function(t){if(!(t instanceof ro))return!1;if(this.size!==t.size)return!1;for(var e=this.Jt.yt(),n=t.Jt.yt();e.Nt();){var r=e.Ct().key,i=n.Ct().key;if(!r.isEqual(i))return!1}return!0},ro.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ro.prototype.copy=function(t,e){var n=new ro;return n.$=this.$,n.Ht=t,n.Jt=e,n},ro),Bi=(no.prototype.track=function(t){var e=t.doc.key,n=this.Xt.get(e);!n||0!==t.type&&3===n.type?this.Xt=this.Xt.Tt(e,t):3===t.type&&1!==n.type?this.Xt=this.Xt.Tt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Xt=this.Xt.Tt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Xt=this.Xt.Tt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Xt=this.Xt.remove(e):1===t.type&&2===n.type?this.Xt=this.Xt.Tt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Xt=this.Xt.Tt(e,{type:2,doc:t.doc}):Sr()},no.prototype.Zt=function(){var n=[];return this.Xt.Pt(function(t,e){n.push(e)}),n},no),zi=(eo.ie=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new eo(t,e,Fi.Yt(e),i,n,r,!0,!1)},Object.defineProperty(eo.prototype,"hasPendingWrites",{get:function(){return!this.ee.W()},enumerable:!1,configurable:!0}),eo.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.ne===t.ne&&this.ee.isEqual(t.ee)&&vu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.te.isEqual(t.te)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},eo),Gi=(to.ae=function(t,e){var n=new Map;return n.set(t,Ki.he(t,e)),new to(Jr.min(),n,qi,Ri,ji())},to),Ki=(Zi.he=function(t,e){return new Zi(vi.lt,e,ji(),ji(),ji())},Zi),Wi=function(t,e,n,r){this.we=t,this.removedTargetIds=e,this.key=n,this.Ee=r},Hi=function(t,e){this.targetId=t,this.Te=e},Qi=function(t,e,n,r){void 0===n&&(n=vi.lt),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Yi=(Object.defineProperty($i.prototype,"le",{get:function(){return this.Re},enumerable:!1,configurable:!0}),Object.defineProperty($i.prototype,"resumeToken",{get:function(){return this.Ae},enumerable:!1,configurable:!0}),Object.defineProperty($i.prototype,"ge",{get:function(){return 0!==this.Ie},enumerable:!1,configurable:!0}),Object.defineProperty($i.prototype,"ye",{get:function(){return this.Pe},enumerable:!1,configurable:!0}),$i.prototype.Ve=function(t){0<t.ht()&&(this.Pe=!0,this.Ae=t)},$i.prototype.pe=function(){var n=ji(),r=ji(),i=ji();return this.me.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Sr()}}),new Ki(this.Ae,this.Re,n,r,i)},$i.prototype.ve=function(){this.Pe=!1,this.me=oo()},$i.prototype.be=function(t,e){this.Pe=!0,this.me=this.me.Tt(t,e)},$i.prototype.Se=function(t){this.Pe=!0,this.me=this.me.remove(t)},$i.prototype.De=function(){this.Ie+=1},$i.prototype.Ce=function(){--this.Ie},$i.prototype.Ne=function(){this.Pe=!0,this.Re=!0},$i),Xi=(Ji.prototype.$e=function(t){for(var e=0,n=t.we;e<n.length;e++){var r=n[e];t.Ee instanceof Zs?this.Le(r,t.Ee):t.Ee instanceof tu&&this.Be(r,t.key,t.Ee)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Be(s,t.key,t.Ee)}},Ji.prototype.qe=function(n){var r=this;this.Ue(n,function(t){var e=r.Qe(t);switch(n.state){case 0:r.Ke(t)&&e.Ve(n.resumeToken);break;case 1:e.Ce(),e.ge||e.ve(),e.Ve(n.resumeToken);break;case 2:e.Ce(),e.ge||r.removeTarget(t);break;case 3:r.Ke(t)&&(e.Ne(),e.Ve(n.resumeToken));break;case 4:r.Ke(t)&&(r.We(t),e.Ve(n.resumeToken));break;default:Sr()}})},Ji.prototype.Ue=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Fe.forEach(function(t,e){r.Ke(e)&&n(e)})},Ji.prototype.je=function(t){var e=t.targetId,n=t.Te.count;(t=this.Ge(e))&&(yi(t=t.target)?0===n?(t=new ei(t.path),this.Be(e,t,new tu(t,Jr.min()))):Dr(1===n):this.ze(e)!==n&&(this.We(e),this.ke=this.ke.add(e)))},Ji.prototype.He=function(r){var i=this,o=new Map;this.Fe.forEach(function(t,e){var n=i.Ge(e);n&&(t.le&&yi(n.target)&&(n=new ei(n.target.path),null!==i.Oe.get(n)||i.Je(e,n)||i.Be(e,n,new tu(n,r))),t.ye&&(o.set(e,t.pe()),t.ve()))});var s=ji();this.Me.forEach(function(t,e){var n=!0;e.Wt(function(t){return!(t=i.Ge(t))||2===t._t||(n=!1)}),n&&(s=s.add(t))});var t=new Gi(r,o,this.ke,this.Oe,s);return this.Oe=Ri,this.Me=io(),this.ke=new ki(Kr),t},Ji.prototype.Le=function(t,e){var n;this.Ke(t)&&(n=this.Je(t,e.key)?2:0,this.Qe(t).be(e.key,n),this.Oe=this.Oe.Tt(e.key,e),this.Me=this.Me.Tt(e.key,this.Ye(e.key).add(t)))},Ji.prototype.Be=function(t,e,n){var r;this.Ke(t)&&(r=this.Qe(t),this.Je(t,e)?r.be(e,1):r.Se(e),this.Me=this.Me.Tt(e,this.Ye(e).delete(t)),n&&(this.Oe=this.Oe.Tt(e,n)))},Ji.prototype.removeTarget=function(t){this.Fe.delete(t)},Ji.prototype.ze=function(t){var e=this.Qe(t).pe();return this.xe.Xe(t).size+e._e.size-e.de.size},Ji.prototype.De=function(t){this.Qe(t).De()},Ji.prototype.Qe=function(t){var e=this.Fe.get(t);return e||(e=new Yi,this.Fe.set(t,e)),e},Ji.prototype.Ye=function(t){var e=this.Me.get(t);return e||(e=new ki(Kr),this.Me=this.Me.Tt(t,e)),e},Ji.prototype.Ke=function(t){var e=null!==this.Ge(t);return e||Tr("WatchChangeAggregator","Detected inactive target",t),e},Ji.prototype.Ge=function(t){var e=this.Fe.get(t);return e&&e.ge?null:this.xe.Ze(t)},Ji.prototype.We=function(e){var n=this;this.Fe.set(e,new Yi),this.xe.Xe(e).forEach(function(t){n.Be(e,t,null)})},Ji.prototype.Je=function(t,e){return this.xe.Xe(t).has(e)},Ji);function Ji(t){this.xe=t,this.Fe=new Map,this.Oe=Ri,this.Me=io(),this.ke=new ki(Kr)}function $i(){this.Ie=0,this.me=oo(),this.Ae=vi.lt,this.Re=!1,this.Pe=!0}function Zi(t,e,n,r,i){this.resumeToken=t,this.le=e,this._e=n,this.fe=r,this.de=i}function to(t,e,n,r,i){this.ft=t,this.re=e,this.oe=n,this.ce=r,this.ue=i}function eo(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.te=n,this.docChanges=r,this.ee=i,this.fromCache=o,this.ne=s,this.se=u}function no(){this.Xt=new Ti(ei.$)}function ro(n){this.$=n?function(t,e){return n(t,e)||ei.$(t.key,e.key)}:function(t,e){return ei.$(t.key,e.key)},this.Ht=Vi,this.Jt=new Ti(this.$)}function io(){return new Ti(ei.$)}function oo(){return new Ti(ei.$)}function so(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function uo(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ao(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function co(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function ho(t){return t=wo(t.mapValue.fields.__local_write_time__.timestampValue),new Xr(t.seconds,t.nanos)}var fo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?co(t)?4:10:Sr()}function po(r,i){var t,e=lo(r);if(e!==lo(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return ho(r).isEqual(ho(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=wo(r.timestampValue),t=wo(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,_o(r.bytesValue).isEqual(_o(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,bo((t=r).geoPointValue.latitude)===bo(e.geoPointValue.latitude)&&bo(t.geoPointValue.longitude)===bo(e.geoPointValue.longitude);case 2:return t=i,"integerValue"in(e=r)&&"integerValue"in t?bo(e.integerValue)===bo(t.integerValue):"doubleValue"in e&&"doubleValue"in t&&((e=bo(e.doubleValue))===(t=bo(t.doubleValue))?ci(e)===ci(t):isNaN(e)&&isNaN(t));case 9:return Wr(r.arrayValue.values||[],i.arrayValue.values||[],po);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(so(e)!==so(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!po(e[t],n[t])))return!1;return!0}();default:return Sr()}}function yo(t,e){return void 0!==(t.values||[]).find(function(t){return po(t,e)})}function vo(t,e){var n,r,i,o=lo(t),s=lo(e);if(o!==s)return Kr(o,s);switch(o){case 0:return 0;case 1:return Kr(t.booleanValue,e.booleanValue);case 2:return n=e,(r=bo(t.integerValue||t.doubleValue))<(n=bo(n.integerValue||n.doubleValue))?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return go(t.timestampValue,e.timestampValue);case 4:return go(ho(t),ho(e));case 5:return Kr(t.stringValue,e.stringValue);case 6:return i=t.bytesValue,s=e.bytesValue,i=_o(i),s=_o(s),i.F(s);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Kr(n[i],r[i]);if(0!==o)return o}return Kr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return o=t.geoPointValue,r=e.geoPointValue,0!==(n=Kr(bo(o.latitude),bo(r.latitude)))?n:Kr(bo(o.longitude),bo(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=vo(n[i],r[i]);if(o)return o}return Kr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Kr(r[s],o[s]);if(0!==u)return u;if(0!==(u=vo(n[r[s]],i[o[s]])))return u}return Kr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Sr()}}function go(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Kr(t,e);var n=wo(t),t=wo(e);return 0!==(e=Kr(n.seconds,t.seconds))?e:Kr(n.nanos,t.nanos)}function mo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=wo(t=i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?_o(i.bytesValue).toBase64():"referenceValue"in i?(e=i.referenceValue,ei.it(e).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Sr();var t,e}(t)}function wo(t){if(Dr(!!t),"string"!=typeof t)return{seconds:bo(t.seconds),nanos:bo(t.nanos)};var e=0,n=fo.exec(t);return Dr(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n)),t=new Date(t),{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function bo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function _o(t){return"string"==typeof t?vi.fromBase64String(t):vi.fromUint8Array(t)}function Io(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.J()}}function Eo(t){return t&&"integerValue"in t}function To(t){return!!t&&"arrayValue"in t}function No(t){return t&&"nullValue"in t}function Ao(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Oo(t){return t&&"mapValue"in t}var So={asc:"ASCENDING",desc:"DESCENDING"},Do={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xo=function(t,e){this.t=t,this.tn=e};function ko(t){return{integerValue:""+t}}function Po(t,e){if(t.tn){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ci(e)?"-0":e}}function Ro(t,e){return hi(e)?ko(e):Po(t,e)}function Co(t,e){return t.tn?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Lo(t,e){return t.tn?e.toBase64():e.toUint8Array()}function Vo(t){return Dr(!!t),Jr.N((t=wo(t),new Xr(t.seconds,t.nanos)))}function Mo(t,e){return new $r(["projects",t.projectId,"databases",t.database]).child("documents").child(e).J()}function Uo(t){return Dr(es(t=$r.Y(t))),t}function jo(t,e){return Mo(t.t,e.path)}function qo(t,e){if((e=Uo(e)).get(1)!==t.t.projectId)throw new Rr(Pr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.t.projectId);if(e.get(3)!==t.t.database)throw new Rr(Pr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.t.database);return new ei(Go(e))}function Fo(t,e){return Mo(t.t,e)}function Bo(t){return 4===(t=Uo(t)).length?$r.X():Go(t)}function zo(t){return new $r(["projects",t.t.projectId,"databases",t.t.database]).J()}function Go(t){return Dr(4<t.length&&"documents"===t.get(4)),t.B(5)}function Ko(t,e,n){return{name:jo(t,e),fields:n.proto.mapValue.fields}}function Wo(t,e){var n,r,i;if(e instanceof ks)n={update:Ko(t,e.key,e.value)};else if(e instanceof Bs)n={delete:jo(t,e.key)};else if(e instanceof Ps)n={update:Ko(t,e.key,e.data),updateMask:(i=e.en,r=[],i.fields.forEach(function(t){return r.push(t.J())}),{fieldPaths:r})};else if(e instanceof Ms)n={transform:{document:jo(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof os)return{fieldPath:t.field.J(),setToServerValue:"REQUEST_TIME"};if(e instanceof ss)return{fieldPath:t.field.J(),appendMissingElements:{values:e.elements}};if(e instanceof fs)return{fieldPath:t.field.J(),removeAllFromArray:{values:e.elements}};if(e instanceof ys)return{fieldPath:t.field.J(),increment:e.nn};throw Sr()})}};else{if(!(e instanceof zs))return Sr();n={verify:jo(t,e.key)}}return e.rn.sn||(n.currentDocument=void 0!==(i=e.rn).updateTime?{updateTime:Co(e=t,(t=i.updateTime).M())}:void 0!==i.exists?{exists:i.exists}:Sr()),n}function Ho(i,t){var e=t.currentDocument?void 0!==(o=t.currentDocument).updateTime?Es.updateTime(Vo(o.updateTime)):void 0!==o.exists?Es.exists(o.exists):Es.on():Es.on();if(t.update){t.update.name;var n=qo(i,t.update.name),r=new Gs({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=(o=t.updateMask.fieldPaths||[],new ws(o.map(function(t){return ti.nt(t)})));return new Ps(n,r,o,e)}return new ks(n,r,e)}if(t.delete){var s=qo(i,t.delete);return new Bs(s,e)}return t.transform?(r=qo(i,t.transform.document),s=t.transform.fieldTransforms.map(function(t){return e=i,r=null,"setToServerValue"in(t=t)?(Dr("REQUEST_TIME"===t.setToServerValue),r=new os):"appendMissingElements"in t?(n=t.appendMissingElements.values||[],r=new ss(n)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new fs(n)):"increment"in t?r=new ys(e,t.increment):Sr(),t=ti.nt(t.fieldPath),new bs(t,r);var e,n,r}),Dr(!0===e.exists),new Ms(r,s)):t.verify?(t=qo(i,t.verify),new zs(t,e)):Sr()}function Qo(t,e){return{documents:[Fo(t,e.path)]}}function Yo(t,e){var n={structuredQuery:{}},r=e.path;return null!==e.collectionGroup?(n.parent=Fo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Fo(t,r.q()),n.structuredQuery.from=[{collectionId:r.K()}]),(r=function(t){if(0!==t.length)return 1===(t=t.map(function(t){if("=="===t.op){if(Ao(t.value))return{unaryFilter:{field:Zo(t.field),op:"IS_NAN"}};if(No(t.value))return{unaryFilter:{field:Zo(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ao(t.value))return{unaryFilter:{field:Zo(t.field),op:"IS_NOT_NAN"}};if(No(t.value))return{unaryFilter:{field:Zo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Zo(t.field),op:(e=t.op,Do[e]),value:t.value}};var e})).length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(e.filters))&&(n.structuredQuery.where=r),(r=function(t){if(0!==t.length)return t.map(function(t){return{field:Zo(t.field),direction:(t=t.dir,So[t])}})}(e.orderBy))&&(n.structuredQuery.orderBy=r),r=e.limit,null!==(r=t.tn||ai(r)?r:{value:r})&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Jo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Jo(e.endAt)),n}function Xo(t){var e=Bo(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Dr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ts(t.unaryFilter.field);return Iu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ts(t.unaryFilter.field);return Iu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":return n=ts(t.unaryFilter.field),Iu.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return t=ts(t.unaryFilter.field),Iu.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Sr()}}(e)]:void 0!==e.fieldFilter?[(n=e,Iu.create(ts(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Sr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Sr():[];var n}(n.where)),t=[],n.orderBy&&(t=n.orderBy.map(function(t){return new Xu(ts((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e})),r=null,n.limit&&(r=ai(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=$o(n.startAt));var u=null;return n.endAt&&(u=$o(n.endAt)),su(e,i,t,o,r,"F",s,u)}function Jo(t){return{before:t.before,values:t.position}}function $o(t){var e=!!t.before,t=t.values||[];return new Bu(t,e)}function Zo(t){return{fieldPath:t.J()}}function ts(t){return ti.nt(t.fieldPath)}function es(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function ns(t,e){return t instanceof ys?Eo(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var rs,is,os=(n(as,is=h=function(){this.cn=void 0}),as),ss=(n(us,rs=h),us);function us(t){var e=this;return(e=rs.call(this)||this).elements=t,e}function as(){return null!==is&&is.apply(this,arguments)||this}function cs(t,e){for(var n=ms(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return po(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var hs,fs=(n(ls,hs=h),ls);function ls(t){var e=this;return(e=hs.call(this)||this).elements=t,e}function ps(t,e){for(var n=ms(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!po(t,e)})}(i[r]);return{arrayValue:{values:n}}}var ds,ys=(n(vs,ds=h),vs);function vs(t,e){var n=this;return(n=ds.call(this)||this).serializer=t,n.nn=e,n}function gs(t){return bo(t.integerValue||t.doubleValue)}function ms(t){return To(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var ws=(_s.prototype.un=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].j(t))return!0;return!1},_s.prototype.isEqual=function(t){return Wr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},_s),bs=function(t,e){this.field=t,this.transform=e};function _s(t){(this.fields=t).sort(ti.$)}function Is(t,e){this.version=t,this.transformResults=e}var Es=(Ts.on=function(){return new Ts},Ts.exists=function(t){return new Ts(void 0,t)},Ts.updateTime=function(t){return new Ts(t)},Object.defineProperty(Ts.prototype,"sn",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Ts.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Ts);function Ts(t,e){this.updateTime=t,this.exists=e}function Ns(t,e){return void 0!==t.updateTime?e instanceof Zs&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Zs}function As(t,e,n,r){return t instanceof ks?(o=e,Ns((i=t).rn,o)?(o=Ss(o),new Zs(i.key,o,i.value,{an:!0})):o):t instanceof Ps?function(t,e){if(!Ns(t.rn,e))return e;var n=Ss(e),e=Ls(t,e);return new Zs(t.key,n,e,{an:!0})}(t,e):t instanceof Ms?function(t,e,n,r){if(!Ns(t.rn,e))return e;var i=e,r=function(t,e,n,r){for(var i,o=[],s=0,u=t;s<u.length;s++){var a=u[s],c=a.transform,h=null;n instanceof Zs&&(h=n.field(a.field)),null===h&&r instanceof Zs&&(h=r.field(a.field)),o.push((i=h,a=e,h=void 0,c instanceof os?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},i&&(h.fields.__previous_value__=i),{mapValue:h}):c instanceof ss?cs(c,i):c instanceof fs?ps(c,i):(i=gs(c=ns(h=c,i))+gs(h.nn),Eo(c)&&Eo(h.nn)?ko(i):Po(h.serializer,i))))}return o}(t.fieldTransforms,n,e,r),r=js(t,i.data(),r);return new Zs(t.key,i.version,r,{an:!0})}(t,e,r,n):Ns(t.rn,e)?new tu(t.key,Jr.min()):e;var i,o}function Os(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.rn.isEqual(e.rn)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.en.isEqual(e.en):2!==t.type||Wr(t.fieldTransforms,t.fieldTransforms,function(t,e){return t.field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof ss&&e instanceof ss||t instanceof fs&&e instanceof fs?Wr(t.elements,e.elements,po):t instanceof ys&&e instanceof ys?po(t.nn,e.nn):t instanceof os&&e instanceof os)}))}function Ss(t){return t instanceof Zs?t.version:Jr.min()}var Ds,xs,ks=(n(Cs,xs=ge=function(){}),Cs),Ps=(n(Rs,Ds=ge),Rs);function Rs(t,e,n,r){var i=this;return(i=Ds.call(this)||this).key=t,i.data=e,i.en=n,i.rn=r,i.type=1,i}function Cs(t,e,n){var r=this;return(r=xs.call(this)||this).key=t,r.value=e,r.rn=n,r.type=0,r}function Ls(t,e){return n=t,e=e instanceof Zs?e.data():Gs.empty(),r=new Ks(e),n.en.fields.forEach(function(t){var e;t.W()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.hn();var n,r}var Vs,Ms=(n(Us,Vs=ge),Us);function Us(t,e){var n=this;return(n=Vs.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.rn=Es.exists(!0),n}function js(t,e,n){for(var r=new Ks(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.hn()}var qs,Fs,Bs=(n(Ys,Fs=ge),Ys),zs=(n(Qs,qs=ge),Qs),Gs=(Hs.empty=function(){return new Hs({mapValue:{}})},Hs.prototype.field=function(t){if(t.W())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Oo(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.K()])||null},Hs.prototype.isEqual=function(t){return po(this.proto,t.proto)},Hs),Ks=(Ws.prototype.set=function(t,e){return this.fn(t,e),this},Ws.prototype.delete=function(t){return this.fn(t,null),this},Ws.prototype.fn=function(t,e){for(var n=this._n,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===lo(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.K(),e)},Ws.prototype.hn=function(){var t=this.dn(ti.X(),this._n);return null!=t?new Gs(t):this.ln},Ws.prototype.dn=function(r,t){var i=this,o=!1,e=this.ln.field(r),s=Oo(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.dn(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Ws);function Ws(t){void 0===t&&(t=Gs.empty()),this.ln=t,this._n=new Map}function Hs(t){this.proto=t}function Qs(t,e){var n=this;return(n=qs.call(this)||this).key=t,n.rn=e,n.type=4,n}function Ys(t,e){var n=this;return(n=Fs.call(this)||this).key=t,n.rn=e,n.type=3,n}var Xs,Js,$s,Zs=(n(ou,$s=me=function(t,e){this.key=t,this.version=e}),ou.prototype.field=function(t){return this.wn.field(t)},ou.prototype.data=function(){return this.wn},ou.prototype.En=function(){return this.wn.proto},ou.prototype.isEqual=function(t){return t instanceof ou&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.an===t.an&&this.hasCommittedMutations===t.hasCommittedMutations&&this.wn.isEqual(t.wn)},ou.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.wn.toString()+", {hasLocalMutations: "+this.an+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(ou.prototype,"hasPendingWrites",{get:function(){return this.an||this.hasCommittedMutations},enumerable:!1,configurable:!0}),ou),tu=(n(iu,Js=me),iu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(iu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),iu.prototype.isEqual=function(t){return t instanceof iu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},iu),eu=(n(ru,Xs=me),ru.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(ru.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),ru.prototype.isEqual=function(t){return t instanceof ru&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ru),nu=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Tn=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.In=null,this.mn=null,this.startAt,this.endAt};function ru(){return null!==Xs&&Xs.apply(this,arguments)||this}function iu(t,e,n){var r=this;return(r=Js.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function ou(t,e,n,r){var i=this;return(i=$s.call(this,t,e)||this).wn=n,i.an=!!r.an,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function su(t,e,n,r,i,o,s,u){return new nu(t,e,n,r,i,o,s,u)}function uu(t){return new nu(t)}function au(t){return!ai(t.limit)&&"F"===t.limitType}function cu(t){return!ai(t.limit)&&"L"===t.limitType}function hu(t){return 0<t.Tn.length?t.Tn[0].field:null}function fu(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.An())return r.field}return null}function lu(t){return null!==t.collectionGroup}function pu(t){var e=t;if(null===e.In){e.In=[];var n=fu(e),t=hu(e);if(null!==n&&null===t)n.tt()||e.In.push(new Xu(n)),e.In.push(new Xu(ti.et(),"asc"));else{for(var r=!1,i=0,o=e.Tn;i<o.length;i++){var s=o[i];e.In.push(s),s.field.tt()&&(r=!0)}r||(n=0<e.Tn.length?e.Tn[e.Tn.length-1].dir:"asc",e.In.push(new Xu(ti.et(),n)))}}return e.In}function du(t){var e=t;if(!e.mn)if("F"===e.limitType)e.mn=li(e.path,e.collectionGroup,pu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=pu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Xu(o.field,s))}var u=e.endAt?new Bu(e.endAt.position,!e.endAt.before):null,t=e.startAt?new Bu(e.startAt.position,!e.startAt.before):null;e.mn=li(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.mn}function yu(t,e,n){return new nu(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function vu(t,e){return di(du(t),du(e))&&t.limitType===e.limitType}function gu(t){return pi(du(t))+"|lt:"+t.limitType}function mu(t){return"Query(target="+(n=(e=du(t)).path.J(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return t.field.J()+" "+t.op+" "+mo(t.value)}).join(", ")+"]"),ai(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return t.field.J()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Hu(e.startAt)),e.endAt&&(n+=", endAt: "+Hu(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function wu(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.rt(e.collectionGroup)&&e.path.j(n):ei.ot(e.path)?e.path.isEqual(n):e.path.G(n))&&function(t){for(var e=0,n=i.Tn;e<n.length;e++){var r=n[e];if(!r.field.tt()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||Qu(t.startAt,pu(t),n))&&(!t.endAt||!Qu(t.endAt,pu(t),n)));var e,n}function bu(u){return function(t,e){for(var n=!1,r=0,i=pu(u);r<i.length;r++){var o=i[r],s=function(t,e,n){var r,i;switch(n=t.field.tt()?ei.$(e.key,n.key):(r=t.field,i=n,e=e.field(r),r=i.field(r),null!==e&&null!==r?vo(e,r):Sr()),t.dir){case"asc":return n;case"desc":return-1*n;default:return Sr()}}(o,t,e);if(0!==s)return s;n=n||o.field.tt()}return 0}}var _u,Iu=(n(Eu,_u=function(){}),Eu.create=function(t,e,n){return t.tt()?"in"===e||"not-in"===e?this.Rn(t,e,n):new Ou(t,e,n):"array-contains"===e?new Uu(t,n):"in"===e?new ju(t,n):"not-in"===e?new qu(t,n):"array-contains-any"===e?new Fu(t,n):new Eu(t,e,n)},Eu.Rn=function(t,e,n){return new("in"===e?Su:Du)(t,n)},Eu.prototype.matches=function(t){return t=t.field(this.field),"!="===this.op?null!==t&&this.Pn(vo(t,this.value)):null!==t&&lo(this.value)===lo(t)&&this.Pn(vo(t,this.value))},Eu.prototype.Pn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Sr()}},Eu.prototype.An=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Eu);function Eu(t,e,n){var r=this;return(r=_u.call(this)||this).field=t,r.op=e,r.value=n,r}var Tu,Nu,Au,Ou=(n(Pu,Au=Iu),Pu.prototype.matches=function(t){return t=ei.$(t.key,this.key),this.Pn(t)},Pu),Su=(n(ku,Nu=Iu),ku.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},ku),Du=(n(xu,Tu=Iu),xu.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},xu);function xu(t,e){var n=this;return(n=Tu.call(this,t,"not-in",e)||this).keys=Ru(0,e),n}function ku(t,e){var n=this;return(n=Nu.call(this,t,"in",e)||this).keys=Ru(0,e),n}function Pu(t,e,n){var r=this;return(r=Au.call(this,t,e,n)||this).key=ei.it(n.referenceValue),r}function Ru(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return ei.it(t.referenceValue)})}var Cu,Lu,Vu,Mu,Uu=(n(Wu,Mu=Iu),Wu.prototype.matches=function(t){return To(t=t.field(this.field))&&yo(t.arrayValue,this.value)},Wu),ju=(n(Ku,Vu=Iu),Ku.prototype.matches=function(t){return null!==(t=t.field(this.field))&&yo(this.value.arrayValue,t)},Ku),qu=(n(Gu,Lu=Iu),Gu.prototype.matches=function(t){return!yo(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(t=t.field(this.field))&&!yo(this.value.arrayValue,t))},Gu),Fu=(n(zu,Cu=Iu),zu.prototype.matches=function(t){var e=this;return!(!To(t=t.field(this.field))||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return yo(e.value.arrayValue,t)})},zu),Bu=function(t,e){this.position=t,this.before=e};function zu(t,e){return Cu.call(this,t,"array-contains-any",e)||this}function Gu(t,e){return Lu.call(this,t,"not-in",e)||this}function Ku(t,e){return Vu.call(this,t,"in",e)||this}function Wu(t,e){return Mu.call(this,t,"array-contains",e)||this}function Hu(t){return(t.before?"b":"a")+":"+t.position.map(mo).join(",")}function Qu(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.tt()?ei.$(ei.it(s.referenceValue),n.key):vo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Yu(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!po(t.position[n],e.position[n]))return!1;return!0}var Xu=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e},Ju=(sa.prototype.yn=function(t,e,n){for(var r,i,o,s,u,a=n.Vn,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t)&&(r=h,i=e,o=a[c],h=u=s=void 0,e=r instanceof ks?new Zs(r.key,o.version,r.value,{hasCommittedMutations:!0}):r instanceof Ps?(u=i,h=o,Ns((s=r).rn,u)?(u=Ls(s,u),new Zs(s.key,h.version,u,{hasCommittedMutations:!0})):new eu(s.key,h.version)):r instanceof Ms?function(t,e,n){if(Dr(null!=n.transformResults),!Ns(t.rn,e))return new eu(t.key,n.version);var r=e,e=function(t,e,n){var r=[];Dr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof Zs&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof ss?cs(o,s):o instanceof fs?ps(o,s):u))}return r}(t.fieldTransforms,e,n.transformResults),n=n.version,e=js(t,r.data(),e);return new Zs(t.key,n,e,{hasCommittedMutations:!0})}(r,i,o):new tu(r.key,o.version,{hasCommittedMutations:!0}))}return e},sa.prototype.pn=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=As(i,e,e,this.gn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=As(a,e,o,this.gn))}return e},sa.prototype.vn=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.pn(t.key,n.get(t.key));e&&(i=i.Tt(t.key,e))}),i},sa.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ji())},sa.prototype.isEqual=function(t){return this.batchId===t.batchId&&Wr(this.mutations,t.mutations,Os)&&Wr(this.baseMutations,t.baseMutations,Os)},sa),$u=(oa.from=function(t,e,n){Dr(t.mutations.length===n.length);for(var r=Mi,i=t.mutations,o=0;o<i.length;o++)r=r.Tt(i[o].key,n[o].version);return new oa(t,e,n,r)},oa),Zu=(ia.prototype.get=function(t){var e=this.Dn(t);if(void 0!==(e=this.Nn[e]))for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.Cn(i,t))return o}},ia.prototype.has=function(t){return void 0!==this.get(t)},ia.prototype.set=function(t,e){var n=this.Dn(t),r=this.Nn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.Cn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.Nn[n]=[[t,e]]},ia.prototype.delete=function(t){var e=this.Dn(t),n=this.Nn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.Cn(n[r][0],t))return 1===n.length?delete this.Nn[e]:n.splice(r,1),!0;return!1},ia.prototype.forEach=function(s){uo(this.Nn,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];s(i,o)}})},ia.prototype.W=function(){return ao(this.Nn)},ia),ta=(ra.prototype.catch=function(t){return this.next(void 0,t)},ra.prototype.next=function(r,i){var o=this;return this.Mn&&Sr(),this.Mn=!0,this.On?this.error?this.kn(i,this.error):this.$n(r,this.result):new ra(function(e,n){o.xn=function(t){o.$n(r,t).next(e,n)},o.Fn=function(t){o.kn(i,t).next(e,n)}})},ra.prototype.Ln=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},ra.prototype.Bn=function(t){try{var e=t();return e instanceof ra?e:ra.resolve(e)}catch(t){return ra.reject(t)}},ra.prototype.$n=function(t,e){return t?this.Bn(function(){return t(e)}):ra.resolve(e)},ra.prototype.kn=function(t,e){return t?this.Bn(function(){return t(e)}):ra.reject(e)},ra.resolve=function(n){return new ra(function(t,e){t(n)})},ra.reject=function(n){return new ra(function(t,e){e(n)})},ra.qn=function(t){return new ra(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},ra.Un=function(t){for(var n=ra.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?ra.resolve(t):e()})}(r[e]);return n},ra.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.qn(i)},ra),h=(na.prototype.Wn=function(t){return(t=this.Qn.get(t))?t.readTime:Jr.min()},na.prototype.jn=function(t,e){this.Gn(),this.Qn.set(t.key,{zn:t,readTime:e})},na.prototype.Hn=function(t,e){void 0===e&&(e=null),this.Gn(),this.Qn.set(t,{zn:null,readTime:e})},na.prototype.Jn=function(t,e){this.Gn();var n=this.Qn.get(e);return void 0!==n?ta.resolve(n.zn):this.Yn(t,e)},na.prototype.getEntries=function(t,e){return this.Xn(t,e)},na.prototype.apply=function(t){return this.Gn(),this.Kn=!0,this.Zn(t)},na.prototype.Gn=function(){},na),ea=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};function na(){this.Qn=new Zu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.Kn=!1}function ra(t){var e=this;this.xn=null,this.Fn=null,this.result=void 0,this.error=void 0,this.On=!1,this.Mn=!1,t(function(t){e.On=!0,e.result=t,e.xn&&e.xn(t)},function(t){e.On=!0,e.error=t,e.Fn&&e.Fn(t)})}function ia(t,e){this.Dn=t,this.Cn=e,this.Nn={}}function oa(t,e,n,r){this.batch=t,this.bn=e,this.Vn=n,this.Sn=r}function sa(t,e,n,r){this.batchId=t,this.gn=e,this.baseMutations=n,this.mutations=r}function ua(t){return new xo(t,!0)}function aa(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var ca="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ge=(va.prototype.es=function(t){this.ts.push(t)},va.prototype.ns=function(){this.ts.forEach(function(t){return t()})},va),ha=(ya.prototype.cs=function(e,n){var r=this;return this.rs.us(e,n).next(function(t){return r.hs(e,n,t)})},ya.prototype.hs=function(t,r,i){return this.ss.Jn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].pn(r,t);return t})},ya.prototype.ls=function(t,e,i){var o=Ri;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].pn(t,e);o=o.Tt(t,e)}),o},ya.prototype._s=function(e,t){var n=this;return this.ss.getEntries(e,t).next(function(t){return n.fs(e,t)})},ya.prototype.fs=function(e,r){var i=this;return this.rs.ds(e,r).next(function(t){var t=i.ls(e,r,t),n=Ri;return t.forEach(function(t,e){e=e||new tu(t,Jr.min()),n=n.Tt(t,e)}),n})},ya.prototype.ws=function(t,e,n){return r=e,ei.ot(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Es(t,e.path):lu(e)?this.Ts(t,e,n):this.Is(t,e,n);var r},ya.prototype.Es=function(t,e){return this.cs(t,new ei(e)).next(function(t){var e=Vi;return t instanceof Zs&&(e=e.Tt(t.key,t)),e})},ya.prototype.Ts=function(n,r,i){var o=this,s=r.collectionGroup,u=Vi;return this.os.As(n,s).next(function(t){return ta.forEach(t,function(t){var e=(e=r,t=t.child(s),new nu(t,null,e.Tn.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.Is(n,e,i).next(function(t){t.forEach(function(t,e){u=u.Tt(t,e)})})}).next(function(){return u})})},ya.prototype.Is=function(e,n,t){var a,c,r=this;return this.ss.ws(e,n,t).next(function(t){return a=t,r.rs.Rs(e,n)}).next(function(t){return c=t,r.Ps(e,c,a).next(function(t){a=t;for(var e=0,n=c;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,s=As(s,s=a.get(u),s,r.gn);a=s instanceof Zs?a.Tt(u,s):a.remove(u)}})}).next(function(){return a.forEach(function(t,e){wu(n,e)||(a=a.remove(t))}),a})},ya.prototype.Ps=function(t,e,n){for(var r=ji(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Ps&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.ss.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Zs&&(c=c.Tt(t,e))}),c})},ya),fa=(da.Vs=function(t,e){for(var n=ji(),r=ji(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new da(t,e.fromCache,n,r)},da),la=(pa.prototype.vs=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},pa.prototype.next=function(){var t=++this.previousValue;return this.bs&&this.bs(t),t},pa);function pa(t,e){var n=this;this.previousValue=t,e&&(e.ps=function(t){return n.vs(t)},this.bs=function(t){return e.Ss(t)})}function da(t,e,n,r){this.targetId=t,this.fromCache=e,this.gs=n,this.ys=r}function ya(t,e,n){this.ss=t,this.rs=e,this.os=n}function va(){this.ts=[]}la.Ds=-1;var ga,ma=(Na.prototype.reset=function(){this.Ms=0},Na.prototype.Ls=function(){this.Ms=this.Os},Na.prototype.Bs=function(t){var e=this;this.cancel();var n=Math.floor(this.Ms+this.qs()),r=Math.max(0,Date.now()-this.$s),i=Math.max(0,n-r);0<i&&Tr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Ms+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.ks=this.Cs.Us(this.Ns,i,function(){return e.$s=Date.now(),t()}),this.Ms*=this.Fs,this.Ms<this.xs&&(this.Ms=this.xs),this.Ms>this.Os&&(this.Ms=this.Os)},Na.prototype.Qs=function(){null!==this.ks&&(this.ks.Ks(),this.ks=null)},Na.prototype.cancel=function(){null!==this.ks&&(this.ks.cancel(),this.ks=null)},Na.prototype.qs=function(){return(Math.random()-.5)*this.Ms},Na),wa=(Ta.delete=function(t){return Tr("SimpleDb","Removing database:",t),ka(window.indexedDB.deleteDatabase(t)).Ln()},Ta.Gs=function(){if("undefined"==typeof indexedDB)return!1;if(Ta.zs())return!0;var t=p(),e=0<(n=Ta.js(t))&&n<10,n=0<(n=Ta.Hs(t))&&n<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||n)},Ta.zs=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Js)},Ta.Ys=function(t,e){return t.store(e)},Ta.js=function(t){return t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1",Number(t)},Ta.Hs=function(t){return t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1",Number(t)},Ta.prototype.Xs=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Tr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result,e(t)},r.onblocked=function(){n(new _a(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){"VersionError"===(t=t.target.error).name?n(new Rr(Pr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new _a(o,t))},r.onupgradeneeded=function(t){Tr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.Ws.createOrUpgrade(e,r.transaction,t.oldVersion,i.version).next(function(){Tr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Zs&&(this.db.onversionchange=function(t){return i.Zs(t)}),this.db)]}})})},Ta.prototype.ti=function(e){this.Zs=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Ta.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Xs(u)];case 2:return s.db=t.sent(),e=Oa.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),ta.reject(t)}).Ln(),r={},n.catch(function(){}),[4,e.ei];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,Tr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Ta.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Ta),ba=(Object.defineProperty(Ea.prototype,"On",{get:function(){return this.si},enumerable:!1,configurable:!0}),Object.defineProperty(Ea.prototype,"ri",{get:function(){return this.ii},enumerable:!1,configurable:!0}),Object.defineProperty(Ea.prototype,"cursor",{set:function(t){this.ni=t},enumerable:!1,configurable:!0}),Ea.prototype.done=function(){this.si=!0},Ea.prototype.oi=function(t){this.ii=t},Ea.prototype.delete=function(){return ka(this.ni.delete())},Ea),_a=(n(Ia,ga=Rr),Ia);function Ia(t,e){var n=this;return(n=ga.call(this,Pr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function Ea(t){this.ni=t,this.si=!1,this.ii=null}function Ta(t,e,n){this.name=t,this.version=e,this.Ws=n,12.2===Ta.js(p())&&Nr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Na(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Cs=t,this.Ns=e,this.xs=n,this.Fs=r,this.Os=i,this.Ms=0,this.ks=null,this.$s=Date.now(),this.reset()}function Aa(t){return"IndexedDbTransactionError"===t.name}var Oa=(xa.open=function(t,e,n,r){try{return new xa(e,t.transaction(r,n))}catch(t){throw new _a(e,t)}},Object.defineProperty(xa.prototype,"ei",{get:function(){return this.ci.promise},enumerable:!1,configurable:!0}),xa.prototype.abort=function(t){t&&this.ci.reject(t),this.aborted||(Tr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},xa.prototype.store=function(t){return t=this.transaction.objectStore(t),new Sa(t)},xa),Sa=(Da.prototype.put=function(t,e){return ka(t=void 0!==e?(Tr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Tr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Da.prototype.add=function(t){return Tr("SimpleDb","ADD",this.store.name,t,t),ka(this.store.add(t))},Da.prototype.get=function(e){var n=this;return ka(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Tr("SimpleDb","GET",n.store.name,e,t),t})},Da.prototype.delete=function(t){return Tr("SimpleDb","DELETE",this.store.name,t),ka(this.store.delete(t))},Da.prototype.count=function(){return Tr("SimpleDb","COUNT",this.store.name),ka(this.store.count())},Da.prototype.ui=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.ai(e,function(t,e){n.push(e)}).next(function(){return n})},Da.prototype.hi=function(t,e){return Tr("SimpleDb","DELETE ALL",this.store.name),(e=this.options(t,e)).li=!1,e=this.cursor(e),this.ai(e,function(t,e,n){return n.delete()})},Da.prototype._i=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.ai(n,e)},Da.prototype.fi=function(r){var t=this.cursor({});return new ta(function(n,e){t.onerror=function(t){t=Ra(t.target.error),e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Da.prototype.ai=function(t,i){var o=[];return new ta(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new ba(n),(t=i(n.primaryKey,n.value,e))instanceof ta&&(t=t.catch(function(t){return e.done(),ta.reject(t)}),o.push(t)),e.On?r():null===e.ri?n.continue():n.continue(e.ri)):r()}}).next(function(){return ta.qn(o)})},Da.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Da.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.li?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Da);function Da(t){this.store=t}function xa(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.ci=new ea,this.transaction.oncomplete=function(){n.ci.resolve()},this.transaction.onabort=function(){t.error?n.ci.reject(new _a(e,t.error)):n.ci.resolve()},this.transaction.onerror=function(t){t=Ra(t.target.error),n.ci.reject(new _a(e,t))}}function ka(t){return new ta(function(e,n){t.onsuccess=function(t){t=t.target.result,e(t)},t.onerror=function(t){t=Ra(t.target.error),n(t)}})}var Pa=!1;function Ra(t){var e=wa.js(p());if(12.2<=e&&e<13&&(e="An internal error was encountered in the Indexed Database server",0<=t.message.indexOf(e))){var n=new Rr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Pa||(Pa=!0,setTimeout(function(){throw n},0)),n}return t}function Ca(){return"undefined"!=typeof window?window:null}function La(){return"undefined"!=typeof document?document:null}var Va=(ja.Ii=function(t,e,n,r,i){return(i=new ja(t,e,Date.now()+n,r,i)).start(n),i},ja.prototype.start=function(t){var e=this;this.mi=setTimeout(function(){return e.Ai()},t)},ja.prototype.Ks=function(){return this.Ai()},ja.prototype.cancel=function(t){null!==this.mi&&(this.clearTimeout(),this.Ti.reject(new Rr(Pr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},ja.prototype.Ai=function(){var e=this;this.di.Ri(function(){return null!==e.mi?(e.clearTimeout(),e.op().then(function(t){return e.Ti.resolve(t)})):Promise.resolve()})},ja.prototype.clearTimeout=function(){null!==this.mi&&(this.Ei(this),clearTimeout(this.mi),this.mi=null)},ja),Ma=(Object.defineProperty(Ua.prototype,"Ci",{get:function(){return this.yi},enumerable:!1,configurable:!0}),Ua.prototype.Ri=function(t){this.enqueue(t)},Ua.prototype.Ni=function(t){this.xi(),this.Fi(t)},Ua.prototype.Oi=function(){var t;this.yi||(this.yi=!0,(t=La())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Di))},Ua.prototype.enqueue=function(t){return this.xi(),this.yi?new Promise(function(t){}):this.Fi(t)},Ua.prototype.Mi=function(t){var e=this;this.Ri(function(){return e.gi.push(t),e.ki()})},Ua.prototype.ki=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.gi.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.gi[0]()];case 2:return t.sent(),this.gi.shift(),this.Si.reset(),[3,4];case 3:if(!Aa(e=t.sent()))throw e;return Tr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.gi.length&&this.Si.Bs(function(){return n.ki()}),t.label=5;case 5:return[2]}})})},Ua.prototype.Fi=function(t){var r=this,e=this.Pi.then(function(){return r.vi=!0,t().catch(function(t){throw r.pi=t,r.vi=!1,Nr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.vi=!1,t})});return this.Pi=e},Ua.prototype.Us=function(t,e,n){var r=this;return this.xi(),-1<this.bi.indexOf(t)&&(e=0),n=Va.Ii(this,t,e,n,function(t){return r.$i(t)}),this.Vi.push(n),n},Ua.prototype.xi=function(){this.pi&&Sr()},Ua.prototype.Li=function(){},Ua.prototype.Bi=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Pi];case 1:t.sent(),t.label=2;case 2:if(e!==this.Pi)return[3,0];t.label=3;case 3:return[2]}})})},Ua.prototype.qi=function(t){for(var e=0,n=this.Vi;e<n.length;e++)if(n[e].Ns===t)return!0;return!1},Ua.prototype.Ui=function(r){var i=this;return this.Bi().then(function(){i.Vi.sort(function(t,e){return t.wi-e.wi});for(var t=0,e=i.Vi;t<e.length;t++){var n=e[t];if(n.Ks(),"all"!==r&&n.Ns===r)break}return i.Bi()})},Ua.prototype.Qi=function(t){this.bi.push(t)},Ua.prototype.$i=function(t){t=this.Vi.indexOf(t),this.Vi.splice(t,1)},Ua);function Ua(){var e=this;this.Pi=Promise.resolve(),this.gi=[],this.yi=!1,this.Vi=[],this.pi=null,this.vi=!1,this.bi=[],this.Si=new ma(this,"async_queue_retry"),this.Di=function(){var t=La();t&&Tr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Si.Qs()};var t=La();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Di)}function ja(t,e,n,r,i){this.di=t,this.Ns=e,this.wi=n,this.op=r,this.Ei=i,this.Ti=new ea,this.then=this.Ti.promise.then.bind(this.Ti.promise),this.Ti.promise.catch(function(t){})}function qa(t,e){if(Nr("AsyncQueue",e+": "+t),Aa(t))return new Rr(Pr.UNAVAILABLE,e+": "+t);throw t}function Fa(t,e){var n=t[0],r=t[1],t=e[0],e=e[1];return 0===(t=Kr(n,t))?Kr(r,e):t}var Ba=(Wa.prototype.ji=function(){return++this.Wi},Wa.prototype.Gi=function(t){var e=[t,this.ji()];this.buffer.size<this.Ki?this.buffer=this.buffer.add(e):Fa(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Wa.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Wa),za={zi:!1,Hi:0,Ji:0,Yi:0},Ga=(Ka.er=function(t){return new Ka(t,Ka.nr,Ka.sr)},Ka);function Ka(t,e,n){this.Xi=t,this.Zi=e,this.tr=n}function Wa(t){this.Ki=t,this.buffer=new ki(Fa),this.Wi=0}Ga.nr=10,Ga.sr=1e3,Ga.ir=new Ga(41943040,Ga.nr,Ga.sr),Ga.rr=new Ga(-1,0,0);var Ha=(Xa.prototype.start=function(t){-1!==this.cr.params.Xi&&this.hr(t)},Xa.prototype.stop=function(){this.ar&&(this.ar.cancel(),this.ar=null)},Object.defineProperty(Xa.prototype,"lr",{get:function(){return null!==this.ar},enumerable:!1,configurable:!0}),Xa.prototype.hr=function(n){var t=this,e=this.ur?3e5:6e4;Tr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.ar=this.di.Us("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.ar=null,this.ur=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n._r(this.cr)];case 2:return t.sent(),[3,7];case 3:return Aa(e=t.sent())?(Tr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Ch(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.hr(n)];case 8:return t.sent(),[2]}})})})},Xa),Qa=(Ya.prototype.wr=function(t,e){return this.dr.Er(t).next(function(t){return Math.floor(e/100*t)})},Ya.prototype.Tr=function(t,e){var n=this;if(0===e)return ta.resolve(la.Ds);var r=new Ba(e);return this.dr.Ue(t,function(t){return r.Gi(t.sequenceNumber)}).next(function(){return n.dr.Ir(t,function(t){return r.Gi(t)})}).next(function(){return r.maxValue})},Ya.prototype.mr=function(t,e,n){return this.dr.mr(t,e,n)},Ya.prototype.Ar=function(t,e){return this.dr.Ar(t,e)},Ya.prototype.Rr=function(e,n){var r=this;return-1===this.params.Xi?(Tr("LruGarbageCollector","Garbage collection skipped; disabled"),ta.resolve(za)):this.Pr(e).next(function(t){return t<r.params.Xi?(Tr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Xi),za):r.gr(e,n)})},Ya.prototype.Pr=function(t){return this.dr.Pr(t)},Ya.prototype.gr=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.wr(e,this.params.Zi).next(function(t){return i=t>h.params.tr?(Tr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.tr+" from "+t),h.params.tr):t,s=Date.now(),h.Tr(e,i)}).next(function(t){return r=t,u=Date.now(),h.mr(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.Ar(e,r)}).next(function(t){return c=Date.now(),Er()<=l.DEBUG&&Tr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),ta.resolve({zi:!0,Hi:i,Ji:o,Yi:t})})},Ya);function Ya(t,e){this.dr=t,this.params=e}function Xa(t,e){this.cr=t,this.di=e,this.ur=!1,this.ar=null}function Ja(t){for(var o="",e=0;e<t.length;e++)0<o.length&&(o=$a(o)),o=function(t){for(var e=o,n=t.length,r=0;r<n;r++){var i=t.charAt(r);switch(i){case"\0":e+="";break;case"":e+="";break;default:e+=i}}return e}(t.get(e));return $a(o)}function $a(t){return t+""}function Za(t){var e=t.length;if(Dr(2<=e),2===e)return Dr(""===t.charAt(0)&&""===t.charAt(1)),$r.X();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Sr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Sr()}o=s+2}return new $r(r)}var tc=function(t){this.yr=t};function ec(t,e){if(e.document)return n=t.yr,r=e.document,i=!!e.hasCommittedMutations,t=qo(n,r.name),n=Vo(r.updateTime),r=new Gs({mapValue:{fields:r.fields}}),new Zs(t,n,r,{hasCommittedMutations:!!i});var n,r;if(e.noDocument){var i=ei.ct(e.noDocument.path),o=sc(e.noDocument.readTime);return new tu(i,o,{hasCommittedMutations:!!e.hasCommittedMutations})}return e.unknownDocument?(o=ei.ct(e.unknownDocument.path),e=sc(e.unknownDocument.version),new eu(o,e)):Sr()}function nc(t,e,n){var r=rc(n),n=e.key.path.q().H();if(e instanceof Zs){var i={name:jo(i=t.yr,(o=e).key),fields:o.En().mapValue.fields,updateTime:Co(i,o.version.M())},o=e.hasCommittedMutations;return new Fc(null,null,i,o,r,n)}if(e instanceof tu){var i=e.key.path.H(),o=oc(e.version),s=e.hasCommittedMutations;return new Fc(null,new jc(i,o),null,s,r,n)}return e instanceof eu?(s=e.key.path.H(),e=oc(e.version),new Fc(new qc(s,e),null,null,!0,r,n)):Sr()}function rc(t){return[(t=t.M()).seconds,t.nanoseconds]}function ic(t){return t=new Xr(t[0],t[1]),Jr.N(t)}function oc(t){return t=t.M(),new xc(t.seconds,t.nanoseconds)}function sc(t){return t=new Xr(t.seconds,t.nanoseconds),Jr.N(t)}function uc(e,t){var n=(t.baseMutations||[]).map(function(t){return Ho(e.yr,t)}),r=t.mutations.map(function(t){return Ho(e.yr,t)}),i=Xr.fromMillis(t.localWriteTimeMs);return new Ju(t.batchId,i,n,r)}function ac(t){var e=sc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?sc(t.lastLimboFreeSnapshotVersion):Jr.min(),r=void 0!==t.query.documents?(Dr(1===(r=t.query).documents.length),du(uu(Bo(r.documents[0])))):du(Xo(t.query));return new bi(r,t.targetId,0,t.lastListenSequenceNumber,e,n,vi.fromBase64String(t.resumeToken))}function cc(t,e){var n=oc(e.ft),r=oc(e.lastLimboFreeSnapshotVersion),i=(yi(e.target)?Qo:Yo)(t.yr,e.target),t=e.resumeToken.toBase64();return new zc(e.targetId,pi(e.target),n,t,e.sequenceNumber,r,i)}function hc(t){var e=Xo({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?yu(e,e.limit,"L"):e}var fc=(lc.vr=function(t,e,n,r){return Dr(""!==t.uid),new lc(t.u()?t.uid:"",e,n,r)},lc.prototype.br=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return yc(t)._i({index:Vc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},lc.prototype.Sr=function(d,y,v,g){var m=this,w=vc(d),b=yc(d);return b.add({}).next(function(t){Dr("number"==typeof t);for(var e,n,r,i,o,s=new Ju(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return Wo(e.yr,t)}),o=r.mutations.map(function(t){return Wo(e.yr,t)}),new Vc(n,r.batchId,r.gn.toMillis(),i,o)),a=[],c=new ki(function(t,e){return Kr(t.J(),e.J())}),h=0,f=g;h<f.length;h++){var l=f[h],p=Mc.key(m.userId,l.key.path,t),c=c.add(l.key.path.q());a.push(b.put(u)),a.push(w.put(p,Mc.PLACEHOLDER))}return c.forEach(function(t){a.push(m.os.Dr(d,t))}),d.es(function(){m.pr[t]=s.keys()}),ta.qn(a).next(function(){return s})})},lc.prototype.Cr=function(t,e){var n=this;return yc(t).get(e).next(function(t){return t?(Dr(t.userId===n.userId),uc(n.serializer,t)):null})},lc.prototype.Nr=function(t,e){var n=this;return this.pr[e]?ta.resolve(this.pr[e]):this.Cr(t,e).next(function(t){return t?(t=t.keys(),n.pr[e]=t):null})},lc.prototype.Fr=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return yc(t)._i({index:Vc.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Dr(e.batchId>=i),o=uc(r.serializer,e)),n.done()}).next(function(){return o})},lc.prototype.Or=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return yc(t)._i({index:Vc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},lc.prototype.Mr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return yc(t).ui(Vc.userMutationsIndex,n).next(function(t){return t.map(function(t){return uc(e.serializer,t)})})},lc.prototype.us=function(o,s){var u=this,t=Mc.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return vc(o)._i({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Za(i);if(r===u.userId&&s.path.isEqual(i))return yc(o).get(t).next(function(t){if(!t)throw Sr();Dr(t.userId===u.userId),a.push(uc(u.serializer,t))});n.done()}).next(function(){return a})},lc.prototype.ds=function(e,t){var s=this,u=new ki(Kr),n=[];return t.forEach(function(o){var t=Mc.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=vc(e)._i({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Za(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),ta.qn(n).next(function(){return s.kr(e,u)})},lc.prototype.Rs=function(t,e){var o=this,s=e.path,u=s.length+1,e=Mc.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new ki(Kr);return vc(t)._i({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Za(i);r===o.userId&&s.j(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.kr(t,a)})},lc.prototype.kr=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(yc(e).get(t).next(function(t){if(null===t)throw Sr();Dr(t.userId===n.userId),r.push(uc(n.serializer,t))}))}),ta.qn(i).next(function(){return r})},lc.prototype.$r=function(e,n){var r=this;return dc(e.Lr,this.userId,n).next(function(t){return e.es(function(){r.Br(n.batchId)}),ta.forEach(t,function(t){return r.Vr.qr(e,t)})})},lc.prototype.Br=function(t){delete this.pr[t]},lc.prototype.Ur=function(e){var i=this;return this.br(e).next(function(t){if(!t)return ta.resolve();var t=IDBKeyRange.lowerBound(Mc.prefixForUser(i.userId)),r=[];return vc(e)._i({range:t},function(t,e,n){t[0]===i.userId?(t=Za(t[1]),r.push(t)):n.done()}).next(function(){Dr(0===r.length)})})},lc.prototype.Qr=function(t,e){return pc(t,this.userId,e)},lc.prototype.Kr=function(t){var e=this;return gc(t).get(this.userId).next(function(t){return t||new Lc(e.userId,-1,"")})},lc);function lc(t,e,n,r){this.userId=t,this.serializer=e,this.os=n,this.Vr=r,this.pr={}}function pc(t,o,e){var s=(e=Mc.prefixForPath(o,e.path))[1],e=IDBKeyRange.lowerBound(e),u=!1;return vc(t)._i({range:e,li:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function dc(t,e,n){var r=t.store(Vc.store),i=t.store(Mc.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r._i({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Dr(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],f=Mc.key(e,h.key.path,n.batchId);o.push(i.delete(f)),u.push(h.key)}return ta.qn(o).next(function(){return u})}function yc(t){return yh.Ys(t,Vc.store)}function vc(t){return yh.Ys(t,Mc.store)}function gc(t){return yh.Ys(t,Lc.store)}var mc,wc=(Ic.prototype.jn=function(t,e,n){return Tc(t).put(Nc(e),n)},Ic.prototype.Hn=function(t,e){return t=Tc(t),e=Nc(e),t.delete(e)},Ic.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Wr(e,t)})},Ic.prototype.Jn=function(t,e){var n=this;return Tc(t).get(Nc(e)).next(function(t){return n.jr(t)})},Ic.prototype.Gr=function(t,e){var n=this;return Tc(t).get(Nc(e)).next(function(t){var e=n.jr(t);return e?{zn:e,size:Ac(t)}:null})},Ic.prototype.getEntries=function(t,e){var n=this,r=Ri;return this.zr(t,e,function(t,e){e=n.jr(e),r=r.Tt(t,e)}).next(function(){return r})},Ic.prototype.Hr=function(t,e){var r=this,i=Ri,o=new Ti(ei.$);return this.zr(t,e,function(t,e){var n=r.jr(e);o=n?(i=i.Tt(t,n),o.Tt(t,Ac(e))):(i=i.Tt(t,null),o.Tt(t,0))}).next(function(){return{Jr:i,Yr:o}})},Ic.prototype.zr=function(t,e,i){if(e.W())return ta.resolve();var n=IDBKeyRange.bound(e.first().path.H(),e.last().path.H()),o=e.yt(),s=o.Ct();return Tc(t)._i({range:n},function(t,e,n){for(var r=ei.ct(t);s&&ei.$(s,r)<0;)i(s,null),s=o.Ct();s&&s.isEqual(r)&&(i(s,e),s=o.Nt()?o.Ct():null),s?n.oi(s.path.H()):n.done()}).next(function(){for(;s;)i(s,null),s=o.Nt()?o.Ct():null})},Ic.prototype.ws=function(t,r,e){var n,i=this,o=Vi,s=r.path.length+1,u={};return e.isEqual(Jr.min())?(n=r.path.H(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.H(),e=rc(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=Fc.collectionReadTimeIndex),Tc(t)._i(u,function(t,e,n){t.length===s&&(e=ec(i.serializer,e),r.path.j(e.key.path)?e instanceof Zs&&wu(r,e)&&(o=o.Tt(e.key,e)):n.done())}).next(function(){return o})},Ic.prototype.Xr=function(t){return new bc(this,!!t&&t.Zr)},Ic.prototype.eo=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ic.prototype.getMetadata=function(t){return Ec(t).get(Bc.key).next(function(t){return Dr(!!t),t})},Ic.prototype.Wr=function(t,e){return Ec(t).put(Bc.key,e)},Ic.prototype.jr=function(t){return!t||(t=ec(this.serializer,t))instanceof tu&&t.version.isEqual(Jr.min())?null:t},Ic),bc=(n(_c,mc=h),_c.prototype.Zn=function(i){var o=this,s=[],u=0,a=new ki(function(t,e){return Kr(t.J(),e.J())});return this.Qn.forEach(function(t,e){var n,r=o.so.get(t);e.zn?(n=nc(o.no.serializer,e.zn,o.Wn(t)),a=a.add(t.path.q()),e=Ac(n),u+=e-r,s.push(o.no.jn(i,t,n))):(u-=r,o.Zr?(r=nc(o.no.serializer,new tu(t,Jr.min()),o.Wn(t)),s.push(o.no.jn(i,t,r))):s.push(o.no.Hn(i,t)))}),a.forEach(function(t){s.push(o.no.os.Dr(i,t))}),s.push(this.no.updateMetadata(i,u)),ta.qn(s)},_c.prototype.Yn=function(t,e){var n=this;return this.no.Gr(t,e).next(function(t){return null===t?(n.so.set(e,0),null):(n.so.set(e,t.size),t.zn)})},_c.prototype.Xn=function(t,e){var n=this;return this.no.Hr(t,e).next(function(t){var e=t.Jr;return t.Yr.forEach(function(t,e){n.so.set(t,e)}),e})},_c);function _c(t,e){var n=this;return(n=mc.call(this)||this).no=t,n.Zr=e,n.so=new Zu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function Ic(t,e){this.serializer=t,this.os=e}function Ec(t){return yh.Ys(t,Bc.store)}function Tc(t){return yh.Ys(t,Fc.store)}function Nc(t){return t.path.H()}function Ac(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Sr();e=t.noDocument}return JSON.stringify(e).length}var Oc=(Cc.prototype.Dr=function(t,e){return this.io.add(e),ta.resolve()},Cc.prototype.As=function(t,e){return ta.resolve(this.io.getEntries(e))},Cc),Sc=(Rc.prototype.add=function(t){var e=t.K(),n=t.q(),r=this.index[e]||new ki($r.$),t=!r.has(n);return this.index[e]=r.add(n),t},Rc.prototype.has=function(t){var e=t.K(),t=t.q();return(e=this.index[e])&&e.has(t)},Rc.prototype.getEntries=function(t){return(this.index[t]||new ki($r.$)).H()},Rc),Dc=(Pc.prototype.createOrUpgrade=function(e,n,t,r){var i=this;Dr(t<r&&0<=t&&r<=11);var o=new Oa("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(kc.store),(s=e).createObjectStore(Lc.store,{keyPath:Lc.keyPath}),s.createObjectStore(Vc.store,{keyPath:Vc.keyPath,autoIncrement:!0}).createIndex(Vc.userMutationsIndex,Vc.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Mc.store),Hc(e),e.createObjectStore(Fc.store));var s,u=ta.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(Gc.store),s.deleteObjectStore(zc.store),s.deleteObjectStore(Kc.store),Hc(e)),u=u.next(function(){return t=o.store(Kc.store),e=new Kc(0,0,Jr.min().M(),0),t.put(Kc.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(Vc.store).ui().next(function(t){n.deleteObjectStore(Vc.store),n.createObjectStore(Vc.store,{keyPath:Vc.keyPath,autoIncrement:!0}).createIndex(Vc.userMutationsIndex,Vc.userMutationsKeyPath,{unique:!0});var e=r.store(Vc.store),t=t.map(function(t){return e.put(t)});return ta.qn(t)});var n,r})),u=u.next(function(){e.createObjectStore(Qc.store,{keyPath:Qc.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.removeAcknowledgedMutations(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore(Bc.store),i.addDocumentGlobal(o)})),t<7&&7<=r&&(u=u.next(function(){return i.ensureSequenceNumbers(o)})),t<8&&8<=r&&(u=u.next(function(){return i.createCollectionParentIndex(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Fc.store)).createIndex(Fc.readTimeIndex,Fc.readTimeIndexPath,{unique:!1}),t.createIndex(Fc.collectionReadTimeIndex,Fc.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.rewriteCanonicalIds(o)})),t<11&&11<=r&&(u=u.next(function(){e.createObjectStore(Yc.store,{keyPath:Yc.keyPath}),e.createObjectStore(Xc.store,{keyPath:Xc.keyPath})})),u},Pc.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Fc.store)._i(function(t,e){n+=Ac(e)}).next(function(){var t=new Bc(n);return e.store(Bc.store).put(Bc.key,t)})},Pc.prototype.removeAcknowledgedMutations=function(n){var r=this,t=n.store(Lc.store),i=n.store(Vc.store);return t.ui().next(function(t){return ta.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.ui(Vc.userMutationsIndex,t).next(function(t){return ta.forEach(t,function(t){return Dr(t.userId===e.userId),t=uc(r.serializer,t),dc(n,e.userId,t).next(function(){})})})})})},Pc.prototype.ensureSequenceNumbers=function(t){var o=t.store(Gc.store),e=t.store(Fc.store);return t.store(Kc.store).get(Kc.key).next(function(r){var i=[];return e._i(function(t,e){var n=new $r(t),t=[0,Ja(n)];i.push(o.get(t).next(function(t){return t?ta.resolve():o.put(new Gc(0,Ja(n),r.highestListenSequenceNumber))}))}).next(function(){return ta.qn(i)})})},Pc.prototype.createCollectionParentIndex=function(t,e){function r(t){if(i.add(t)){var e=t.K(),t=t.q();return n.put({collectionId:e,parent:Ja(t)})}}t.createObjectStore(Wc.store,{keyPath:Wc.keyPath});var n=e.store(Wc.store),i=new Sc;return e.store(Fc.store)._i({li:!0},function(t,e){return r((t=new $r(t)).q())}).next(function(){return e.store(Mc.store)._i({li:!0},function(t,e){t[0];var n=t[1];return r((n=(t[2],Za(n))).q())})})},Pc.prototype.rewriteCanonicalIds=function(t){var n=this,r=t.store(zc.store);return r._i(function(t,e){return e=ac(e),e=cc(n.serializer,e),r.put(e)})},Pc),xc=function(t,e){this.seconds=t,this.nanoseconds=e},kc=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Pc(t){this.serializer=t}function Rc(){this.index={}}function Cc(){this.io=new Sc}kc.store="owner",kc.key="owner";var Lc=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Lc.store="mutationQueues",Lc.keyPath="userId";var Vc=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Vc.store="mutations",Vc.keyPath="batchId",Vc.userMutationsIndex="userMutationsIndex",Vc.userMutationsKeyPath=["userId","batchId"];var Mc=(Uc.prefixForUser=function(t){return[t]},Uc.prefixForPath=function(t,e){return[t,Ja(e)]},Uc.key=function(t,e,n){return[t,Ja(e),n]},Uc);function Uc(){}Mc.store="documentMutations",Mc.PLACEHOLDER=new Mc;var jc=function(t,e){this.path=t,this.readTime=e},qc=function(t,e){this.path=t,this.version=e},Fc=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Fc.store="remoteDocuments",Fc.readTimeIndex="readTimeIndex",Fc.readTimeIndexPath="readTime",Fc.collectionReadTimeIndex="collectionReadTimeIndex",Fc.collectionReadTimeIndexPath=["parentPath","readTime"];var Bc=function(t){this.byteSize=t};Bc.store="remoteDocumentGlobal",Bc.key="remoteDocumentGlobalKey";var zc=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};zc.store="targets",zc.keyPath="targetId",zc.queryTargetsIndexName="queryTargetsIndex",zc.queryTargetsKeyPath=["canonicalId","targetId"];var Gc=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Gc.store="targetDocuments",Gc.keyPath=["targetId","path"],Gc.documentTargetsIndex="documentTargetsIndex",Gc.documentTargetsKeyPath=["path","targetId"];var Kc=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Kc.key="targetGlobalKey",Kc.store="targetGlobal";var Wc=function(t,e){this.collectionId=t,this.parent=e};function Hc(t){t.createObjectStore(Gc.store,{keyPath:Gc.keyPath}).createIndex(Gc.documentTargetsIndex,Gc.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(zc.store,{keyPath:zc.keyPath}).createIndex(zc.queryTargetsIndexName,zc.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Kc.store)}Wc.store="collectionParents",Wc.keyPath=["collectionId","parent"];var Qc=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Qc.store="clientMetadata",Qc.keyPath="clientId";var Yc=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Yc.store="bundles",Yc.keyPath="bundleId";var Xc=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Xc.store="namedQueries",Xc.keyPath="name";var Jc=s(s(s(s([Lc.store,Vc.store,Mc.store,Fc.store,zc.store,kc.store,Kc.store,Gc.store],[Qc.store]),[Bc.store]),[Wc.store]),[Yc.store,Xc.store]),$c=(Zc.prototype.ro=function(t,e){return th(t).get(e).next(function(t){if(t)return{id:t.bundleId,createTime:sc(t.createTime),version:t.version}})},Zc.prototype.oo=function(t,e){return th(t).put({bundleId:e.id,createTime:oc(Vo(e.createTime)),version:e.version})},Zc.prototype.co=function(t,e){return eh(t).get(e).next(function(t){if(t)return{name:t.name,query:hc(t.bundledQuery),readTime:sc(t.readTime)}})},Zc.prototype.uo=function(t,e){return eh(t).put({name:e.name,readTime:oc(Vo(e.readTime)),bundledQuery:e.bundledQuery})},Zc);function Zc(t){this.serializer=t}function th(t){return yh.Ys(t,Yc.store)}function eh(t){return yh.Ys(t,Xc.store)}var nh=(rh.prototype.Dr=function(t,e){var n=this;if(this.ao.has(e))return ta.resolve();var r=e.K(),i=e.q();return t.es(function(){n.ao.add(e)}),i={collectionId:r,parent:Ja(i)},ih(t).put(i)},rh.prototype.As=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Hr(i),""],!1,!0);return ih(t).ui(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Za(r.parent))}return o})},rh);function rh(){this.ao=new Sc}function ih(t){return yh.Ys(t,Wc.store)}var oh=(ah.prototype.next=function(){return this.ho+=2,this.ho},ah.lo=function(){return new ah(0)},ah._o=function(){return new ah(-1)},ah),sh=(uh.prototype.fo=function(n){var r=this;return this.wo(n).next(function(t){var e=new oh(t.highestTargetId);return t.highestTargetId=e.next(),r.Eo(n,t).next(function(){return t.highestTargetId})})},uh.prototype.To=function(t){return this.wo(t).next(function(t){return Jr.N(new Xr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},uh.prototype.Io=function(t){return this.wo(t).next(function(t){return t.highestListenSequenceNumber})},uh.prototype.mo=function(e,n,r){var i=this;return this.wo(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.M()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Eo(e,t)})},uh.prototype.Ao=function(e,n){var r=this;return this.Ro(e,n).next(function(){return r.wo(e).next(function(t){return t.targetCount+=1,r.Po(n,t),r.Eo(e,t)})})},uh.prototype.yo=function(t,e){return this.Ro(t,e)},uh.prototype.Vo=function(e,t){var n=this;return this.po(e,t.targetId).next(function(){return ch(e).delete(t.targetId)}).next(function(){return n.wo(e)}).next(function(t){return Dr(0<t.targetCount),--t.targetCount,n.Eo(e,t)})},uh.prototype.mr=function(n,r,i){var o=this,s=0,u=[];return ch(n)._i(function(t,e){(e=ac(e)).sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.Vo(n,e)))}).next(function(){return ta.qn(u)}).next(function(){return s})},uh.prototype.Ue=function(t,n){return ch(t)._i(function(t,e){e=ac(e),n(e)})},uh.prototype.wo=function(t){return hh(t).get(Kc.key).next(function(t){return Dr(null!==t),t})},uh.prototype.Eo=function(t,e){return hh(t).put(Kc.key,e)},uh.prototype.Ro=function(t,e){return ch(t).put(cc(this.serializer,e))},uh.prototype.Po=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},uh.prototype.vo=function(t){return this.wo(t).next(function(t){return t.targetCount})},uh.prototype.bo=function(t,r){var e=pi(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return ch(t)._i({range:e,index:zc.queryTargetsIndexName},function(t,e,n){e=ac(e),di(r,e.target)&&(i=e,n.done())}).next(function(){return i})},uh.prototype.So=function(n,t,r){var i=this,o=[],s=fh(n);return t.forEach(function(t){var e=Ja(t.path);o.push(s.put(new Gc(r,e))),o.push(i.Vr.Do(n,r,t))}),ta.qn(o)},uh.prototype.Co=function(n,t,r){var i=this,o=fh(n);return ta.forEach(t,function(t){var e=Ja(t.path);return ta.qn([o.delete([r,e]),i.Vr.No(n,r,t)])})},uh.prototype.po=function(t,e){return t=fh(t),e=IDBKeyRange.bound([e],[e+1],!1,!0),t.delete(e)},uh.prototype.xo=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=fh(t),r=ji();return t._i({range:e,li:!0},function(t,e,n){t=Za(t[1]),t=new ei(t),r=r.add(t)}).next(function(){return r})},uh.prototype.Qr=function(t,e){var e=Ja(e.path),e=IDBKeyRange.bound([e],[Hr(e)],!1,!0),i=0;return fh(t)._i({index:Gc.documentTargetsIndex,li:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},uh.prototype.Ze=function(t,e){return ch(t).get(e).next(function(t){return t?ac(t):null})},uh);function uh(t,e){this.Vr=t,this.serializer=e}function ah(t){this.ho=t}function ch(t){return yh.Ys(t,zc.store)}function hh(t){return yh.Ys(t,Kc.store)}function fh(t){return yh.Ys(t,Gc.store)}var lh,ph="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",dh=(n(gh,lh=ge),gh),yh=(vh.Ys=function(t,e){if(t instanceof dh)return wa.Ys(t.Lr,e);throw Sr()},vh.prototype.start=function(){var e=this;return this.Ho().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Rr(Pr.FAILED_PRECONDITION,ph);return e.Jo(),e.Yo(),e.Xo(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.jo.Io(t)})}).then(function(t){e.ko=new la(t,e.Oo)}).then(function(){e.$o=!0}).catch(function(t){return e.Wo&&e.Wo.close(),Promise.reject(t)})},vh.prototype.Zo=function(n){var t=this;return this.Qo=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.lr?[2,n(e)]:[2]})})},n(this.isPrimary)},vh.prototype.tc=function(n){var t=this;this.Wo.ti(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},vh.prototype.ec=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Cs.Ri(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.lr?[4,this.Ho()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},vh.prototype.Ho=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return wh(e).put(new Qc(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.nc(e).next(function(t){t||(n.isPrimary=!1,n.Cs.Mi(function(){return n.Qo(!1)}))})}).next(function(){return n.sc(e)}).next(function(t){return n.isPrimary&&!t?n.ic(e).next(function(){return!1}):!!t&&n.rc(e).next(function(){return!0})})}).catch(function(t){if(Aa(t))return Tr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Tr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Cs.Mi(function(){return n.Qo(t)}),n.isPrimary=t})},vh.prototype.nc=function(t){var e=this;return mh(t).get(kc.key).next(function(t){return ta.resolve(e.oc(t))})},vh.prototype.cc=function(t){return wh(t).delete(this.clientId)},vh.prototype.uc=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.ac(this.Uo,18e5)?[3,2]:(this.Uo=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=vh.Ys(t,Qc.store);return r.ui().next(function(t){var e=o.hc(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return ta.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.zo)for(n=0,r=e;n<r.length;n++)i=r[n],this.zo.removeItem(this.lc(i.clientId));t.label=2;case 2:return[2]}})})},vh.prototype.Xo=function(){var t=this;this.qo=this.Cs.Us("client_metadata_refresh",4e3,function(){return t.Ho().then(function(){return t.uc()}).then(function(){return t.Xo()})})},vh.prototype.oc=function(t){return!!t&&t.ownerId===this.clientId},vh.prototype.sc=function(e){var r=this;return this.Mo?ta.resolve(!0):mh(e).get(kc.key).next(function(t){if(null!==t&&r.ac(t.leaseTimestampMs,5e3)&&!r._c(t.ownerId)){if(r.oc(t)&&r.networkEnabled)return!0;if(!r.oc(t)){if(!t.allowTabSynchronization)throw new Rr(Pr.FAILED_PRECONDITION,ph);return!1}}return!(!r.networkEnabled||!r.inForeground)||wh(e).ui().next(function(t){return void 0===r.hc(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&Tr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},vh.prototype.fc=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.$o=!1,this.dc(),this.qo&&(this.qo.cancel(),this.qo=null),this.wc(),this.Ec(),[4,this.Wo.runTransaction("shutdown","readwrite",[kc.store,Qc.store],function(t){var e=new dh(t,la.Ds);return n.ic(e).next(function(){return n.cc(e)})})];case 1:return t.sent(),this.Wo.close(),this.Tc(),[2]}})})},vh.prototype.hc=function(t,e){var n=this;return t.filter(function(t){return n.ac(t.updateTimeMs,e)&&!n._c(t.clientId)})},vh.prototype.Ic=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return wh(t).ui().next(function(t){return e.hc(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(vh.prototype,"lr",{get:function(){return this.$o},enumerable:!1,configurable:!0}),vh.prototype.mc=function(t){return fc.vr(t,this.serializer,this.os,this.Vr)},vh.prototype.Ac=function(){return this.jo},vh.prototype.Rc=function(){return this.ss},vh.prototype.Pc=function(){return this.os},vh.prototype.gc=function(){return this.Go},vh.prototype.runTransaction=function(e,n,r){var i=this;Tr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Wo.runTransaction(e,t,Jc,function(t){return o=new dh(t,i.ko?i.ko.next():la.Ds),"readwrite-primary"===n?i.nc(o).next(function(t){return!!t||i.sc(o)}).next(function(t){if(!t)throw Nr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Cs.Mi(function(){return i.Qo(!1)}),new Rr(Pr.FAILED_PRECONDITION,ca);return r(o)}).next(function(t){return i.rc(o).next(function(){return t})}):i.yc(o).next(function(){return r(o)})}).then(function(t){return o.ns(),t})},vh.prototype.yc=function(t){var e=this;return mh(t).get(kc.key).next(function(t){if(null!==t&&e.ac(t.leaseTimestampMs,5e3)&&!e._c(t.ownerId)&&!e.oc(t)&&!(e.Mo||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Rr(Pr.FAILED_PRECONDITION,ph)})},vh.prototype.rc=function(t){var e=new kc(this.clientId,this.allowTabSynchronization,Date.now());return mh(t).put(kc.key,e)},vh.Gs=function(){return wa.Gs()},vh.prototype.ic=function(t){var e=this,n=mh(t);return n.get(kc.key).next(function(t){return e.oc(t)?(Tr("IndexedDbPersistence","Releasing primary lease."),n.delete(kc.key)):ta.resolve()})},vh.prototype.ac=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Nr("Detected an update time that is in the future: "+t+" > "+n),1))},vh.prototype.Jo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Bo=function(){t.Cs.Ri(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ho()})},this.document.addEventListener("visibilitychange",this.Bo),this.inForeground="visible"===this.document.visibilityState)},vh.prototype.wc=function(){this.Bo&&(this.document.removeEventListener("visibilitychange",this.Bo),this.Bo=null)},vh.prototype.Yo=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Lo=function(){e.dc(),e.Cs.Ri(function(){return e.fc()})},this.window.addEventListener("unload",this.Lo))},vh.prototype.Ec=function(){this.Lo&&(this.window.removeEventListener("unload",this.Lo),this.Lo=null)},vh.prototype._c=function(t){try{var e=null!==(null===(e=this.zo)||void 0===e?void 0:e.getItem(this.lc(t)));return Tr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Nr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},vh.prototype.dc=function(){if(this.zo)try{this.zo.setItem(this.lc(this.clientId),String(Date.now()))}catch(t){Nr("Failed to set zombie client id.",t)}},vh.prototype.Tc=function(){if(this.zo)try{this.zo.removeItem(this.lc(this.clientId))}catch(t){}},vh.prototype.lc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},vh);function vh(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Cs=i,this.window=o,this.document=s,this.Oo=a,this.Mo=c,this.ko=null,this.$o=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Lo=null,this.inForeground=!1,this.Bo=null,this.qo=null,this.Uo=Number.NEGATIVE_INFINITY,this.Qo=function(t){return Promise.resolve()},!vh.Gs())throw new Rr(Pr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Vr=new bh(this,r),this.Ko=e+"main",this.serializer=new tc(u),this.Wo=new wa(this.Ko,11,new Dc(this.serializer)),this.jo=new sh(this.Vr,this.serializer),this.os=new nh,this.ss=(e=this.serializer,u=this.os,new wc(e,u)),this.Go=new $c(this.serializer),this.window&&this.window.localStorage?this.zo=this.window.localStorage:(this.zo=null,!1===c&&Nr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function gh(t,e){var n=this;return(n=lh.call(this)||this).Lr=t,n.Fo=e,n}function mh(t){return yh.Ys(t,kc.store)}function wh(t){return yh.Ys(t,Qc.store)}var bh=(_h.prototype.Er=function(t){var n=this.Vc(t);return this.db.Ac().vo(t).next(function(e){return n.next(function(t){return e+t})})},_h.prototype.Vc=function(t){var e=0;return this.Ir(t,function(t){e++}).next(function(){return e})},_h.prototype.Ue=function(t,e){return this.db.Ac().Ue(t,e)},_h.prototype.Ir=function(t,n){return this.vc(t,function(t,e){return n(e)})},_h.prototype.Do=function(t,e,n){return Ih(t,n)},_h.prototype.No=function(t,e,n){return Ih(t,n)},_h.prototype.mr=function(t,e,n){return this.db.Ac().mr(t,e,n)},_h.prototype.qr=Ih,_h.prototype.bc=function(t,e){return r=e,i=!1,gc(n=t).fi(function(t){return pc(n,t,r).next(function(t){return t&&(i=!0),ta.resolve(!t)})}).next(function(){return i});var n,r,i},_h.prototype.Ar=function(n,r){var i=this,o=this.db.Rc().Xr(),s=[],u=0;return this.vc(n,function(e,t){t<=r&&(t=i.bc(n,e).next(function(t){if(!t)return u++,o.Jn(n,e).next(function(){return o.Hn(e),fh(n).delete([0,Ja(e.path)])})}),s.push(t))}).next(function(){return ta.qn(s)}).next(function(){return o.apply(n)}).next(function(){return u})},_h.prototype.removeTarget=function(t,e){return e=e.dt(t.Fo),this.db.Ac().yo(t,e)},_h.prototype.Sc=Ih,_h.prototype.vc=function(t,r){var i,t=fh(t),o=la.Ds;return t._i({index:Gc.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==la.Ds&&r(new ei(Za(i)),o),o=e,i=t):o=la.Ds}).next(function(){o!==la.Ds&&r(new ei(Za(i)),o)})},_h.prototype.Pr=function(t){return this.db.Rc().eo(t)},_h);function _h(t,e){this.db=t,this.cr=new Qa(this,e)}function Ih(t,e){return fh(t).put((t=t.Fo,new Gc(0,Ja(e.path),t)))}function Eh(t,e){var n=t.projectId;return t.o||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Th=(Nh.prototype._r=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Rr(t,n.Cc)})},Nh);function Nh(t,e,n,r){this.persistence=t,this.Dc=e,this.serializer=r,this.Cc=new Ti(Kr),this.Nc=new Zu(pi,di),this.xc=Jr.min(),this.rs=t.mc(n),this.Fc=t.Rc(),this.jo=t.Ac(),this.Oc=new ha(this.Fc,this.rs,this.persistence.Pc()),this.Go=t.gc(),this.Dc.Mc(this.Oc)}function Ah(t,e,n,r){return new Th(t,e,n,r)}function Oh(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).rs,m=e.Oc,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.rs.Mr(v).next(function(t){return g=t,n=e.persistence.mc(o),m=new ha(e.Fc,n,e.persistence.Pc()),n.Mr(v)}).next(function(t){for(var e=[],n=[],r=ji(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m._s(v,r).next(function(t){return{kc:t,$c:e,Lc:n}})})})];case 1:return r=t.sent(),[2,(e.rs=n,e.Oc=m,e.Dc.Mc(e.Oc),r)]}})})}function Sh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.jo.To(t)})}function Dh(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.jo.bo(e,r).next(function(t){return t?(n=t,ta.resolve(n)):i.jo.fo(e).next(function(t){return n=new bi(r,t,0,e.Fo),i.jo.Ao(e,n).next(function(){return n})})})}).then(function(t){var e=i.Cc.get(t.targetId);return(null===e||0<t.ft.F(e.ft))&&(i.Cc=i.Cc.Tt(t.targetId,t),i.Nc.set(r,t.targetId)),t})}function xh(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).Cc.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Vr.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Aa(r=t.sent()))throw r;return Tr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Cc=e.Cc.remove(o),e.Nc.delete(n.target),[2]}})})}function kh(t,o,s){var u=t,a=Jr.min(),c=ji();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=du(o),(void 0!==(t=(i=t).Nc.get(r))?ta.resolve(i.Cc.get(t)):i.jo.bo(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.jo.xo(e,t.targetId).next(function(t){c=t})}).next(function(){return u.Dc.ws(e,o,s?a:Jr.min(),s?c:ji())}).next(function(t){return{documents:t,Bc:c}});var t,n,r,i})}function Ph(t,e){var n=t,r=n.jo;return(t=n.Cc.get(e))?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Ze(t,e).next(function(t){return t?t.target:null})})}function Rh(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Fc,n=t,t=s.xc,r=e,i=Ri,o=rc(t),t=Tc(n),n=IDBKeyRange.lowerBound(o,!0),t._i({index:Fc.readTimeIndex,range:n},function(t,e){var n=ec(r.serializer,e);i=i.Tt(n.key,n),o=e.readTime}).next(function(){return{qc:i,readTime:ic(o)}});var e,n,r,i,o}).then(function(t){var e=t.qc,t=t.readTime;return s.xc=t,e})}function Ch(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Pr.FAILED_PRECONDITION||e.message!==ca)throw e;return Tr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Lh(t,e,n,r,i){var o=this;this.Cu=t,this.Nu=e,this.di=n,this.xu={},this.Fu=[],this.Ou=new Map,this.Mu=new Set,this.ku=[],this.$u=i,this.$u.Lu(function(t){n.Ri(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return nf(this)?(Tr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Mu.add(4),[4,Yh(e)];case 1:return t.sent(),e.Bu.set("Unknown"),e.Mu.delete(4),[4,Qh(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Bu=new Bh(n,r)}var Vh,Mh,Uh,me=(Hh.prototype.Gc=function(){return 1===this.state||2===this.state||4===this.state},Hh.prototype.zc=function(){return 2===this.state},Hh.prototype.start=function(){3!==this.state?this.auth():this.Hc()},Hh.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Gc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Hh.prototype.Jc=function(){this.state=0,this.Si.reset()},Hh.prototype.Yc=function(){var t=this;this.zc()&&null===this.jc&&(this.jc=this.Cs.Us(this.Uc,6e4,function(){return t.Xc()}))},Hh.prototype.Zc=function(t){this.tu(),this.stream.send(t)},Hh.prototype.Xc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.zc()?[2,this.close(0)]:[2]})})},Hh.prototype.tu=function(){this.jc&&(this.jc.cancel(),this.jc=null)},Hh.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.tu(),this.Si.cancel(),this.Wc++,3!==e?this.Si.reset():n&&n.code===Pr.RESOURCE_EXHAUSTED?(Nr(n.toString()),Nr("Using maximum backoff delay to prevent overloading the backend."),this.Si.Ls()):n&&n.code===Pr.UNAUTHENTICATED&&this.Kc.m(),null!==this.stream&&(this.eu(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.nu(n)];case 1:return t.sent(),[2]}})})},Hh.prototype.eu=function(){},Hh.prototype.auth=function(){var n=this;this.state=1;var t=this.su(this.Wc),e=this.Wc;this.Kc.getToken().then(function(t){n.Wc===e&&n.iu(t)},function(e){t(function(){var t=new Rr(Pr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.ru(t)})})},Hh.prototype.iu=function(t){var e=this,n=this.su(this.Wc);this.stream=this.ou(t),this.stream.cu(function(){n(function(){return e.state=2,e.listener.cu()})}),this.stream.nu(function(t){n(function(){return e.ru(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Hh.prototype.Hc=function(){var t=this;this.state=4,this.Si.Bs(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Hh.prototype.ru=function(t){return Tr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Hh.prototype.su=function(e){var n=this;return function(t){n.Cs.Ri(function(){return n.Wc===e?t():(Tr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Hh),jh=(n(Wh,Uh=me),Wh.prototype.ou=function(t){return this.Qc.uu("Listen",t)},Wh.prototype.onMessage=function(t){this.Si.reset();var e,n=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(i=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:Sr(),r=e.targetChange.targetIds||[],i=(o=e.targetChange.resumeToken,t.tn?(Dr(void 0===o||"string"==typeof o),vi.fromBase64String(o||"")):(Dr(void 0===o||o instanceof Uint8Array),vi.fromUint8Array(o||new Uint8Array))),o=e.targetChange.cause,s=o&&(o=void 0===(s=o).code?Pr.UNKNOWN:Ei(s.code),new Rr(o,s.message||"")),r=new Qi(n,r,i,s||null)}else if("documentChange"in e){e.documentChange,(a=e.documentChange).document,a.document.name,a.document.updateTime;var i=qo(t,a.document.name),u=Vo(a.document.updateTime),s=new Gs({mapValue:{fields:a.document.fields}}),u=new Zs(i,u,s,{}),s=a.targetIds||[],a=a.removedTargetIds||[];r=new Wi(s,a,u.key,u)}else if("documentDelete"in e){e.documentDelete,(a=e.documentDelete).document;var u=qo(t,a.document),c=a.readTime?Vo(a.readTime):Jr.min(),c=new tu(u,c),a=a.removedTargetIds||[];r=new Wi([],a,c.key,c)}else if("documentRemove"in e){e.documentRemove,(c=e.documentRemove).document;var h=qo(t,c.document),c=c.removedTargetIds||[];r=new Wi([],c,h,null)}else{if(!("filter"in e))return Sr();e.filter,(h=e.filter).targetId,e=new mi(e=h.count||0),h=h.targetId,r=new Hi(h,e)}return r}(this.serializer,t),t=!("targetChange"in(e=t))||(e=e.targetChange).targetIds&&e.targetIds.length||!e.readTime?Jr.min():Vo(e.readTime);return this.listener.au(n,t)},Wh.prototype.hu=function(t){var e,n,r,i,o={};o.database=zo(this.serializer),o.addTarget=(e=this.serializer,(r=yi(r=(n=t).target)?{documents:Qo(e,r)}:{query:Yo(e,r)}).targetId=n.targetId,0<n.resumeToken.ht()?r.resumeToken=Lo(e,n.resumeToken):0<n.ft.F(Jr.min())&&(r.readTime=Co(e,n.ft.M())),r),(t=(this.serializer,i=t,null==(t=function(){switch(i._t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Sr()}}())?null:{"goog-listen-tags":t}))&&(o.labels=t),this.Zc(o)},Wh.prototype.lu=function(t){var e={};e.database=zo(this.serializer),e.removeTarget=t,this.Zc(e)},Wh),qh=(n(Kh,Mh=me),Object.defineProperty(Kh.prototype,"fu",{get:function(){return this._u},enumerable:!1,configurable:!0}),Kh.prototype.start=function(){this._u=!1,this.lastStreamToken=void 0,Mh.prototype.start.call(this)},Kh.prototype.eu=function(){this._u&&this.du([])},Kh.prototype.ou=function(t){return this.Qc.uu("Write",t)},Kh.prototype.onMessage=function(t){if(Dr(!!t.streamToken),this.lastStreamToken=t.streamToken,this._u){this.Si.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Dr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?Vo(e.updateTime):Vo(n)).isEqual(Jr.min())&&(t=Vo(n)),n=null,e.transformResults&&0<e.transformResults.length&&(n=e.transformResults),new Is(t,n);var e,n})):[]),n=Vo(t.commitTime);return this.listener.wu(n,e)}var r;return Dr(!t.writeResults||0===t.writeResults.length),this._u=!0,this.listener.Eu()},Kh.prototype.Tu=function(){var t={};t.database=zo(this.serializer),this.Zc(t)},Kh.prototype.du=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return Wo(e.serializer,t)})};this.Zc(t)},Kh),Fh=(n(Gh,Vh=function(){}),Gh.prototype.mu=function(){if(this.Iu)throw new Rr(Pr.FAILED_PRECONDITION,"The client has already been terminated.")},Gh.prototype.Au=function(e,n,r){var i=this;return this.mu(),this.credentials.getToken().then(function(t){return i.Qc.Au(e,n,r,t)}).catch(function(t){throw t.code===Pr.UNAUTHENTICATED&&i.credentials.m(),t})},Gh.prototype.Ru=function(e,n,r){var i=this;return this.mu(),this.credentials.getToken().then(function(t){return i.Qc.Ru(e,n,r,t)}).catch(function(t){throw t.code===Pr.UNAUTHENTICATED&&i.credentials.m(),t})},Gh.prototype.terminate=function(){this.Iu=!1},Gh),Bh=(zh.prototype.pu=function(){var t=this;0===this.gu&&(this.vu("Unknown"),this.yu=this.di.Us("online_state_timeout",1e4,function(){return t.yu=null,t.bu("Backend didn't respond within 10 seconds."),t.vu("Offline"),Promise.resolve()}))},zh.prototype.Su=function(t){"Online"===this.state?this.vu("Unknown"):(this.gu++,1<=this.gu&&(this.Du(),this.bu("Connection failed 1 times. Most recent error: "+t.toString()),this.vu("Offline")))},zh.prototype.set=function(t){this.Du(),this.gu=0,"Online"===t&&(this.Vu=!1),this.vu(t)},zh.prototype.vu=function(t){t!==this.state&&(this.state=t,this.Pu(t))},zh.prototype.bu=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.Vu?(Nr(t),this.Vu=!1):Tr("OnlineStateTracker",t)},zh.prototype.Du=function(){null!==this.yu&&(this.yu.cancel(),this.yu=null)},zh);function zh(t,e){this.di=t,this.Pu=e,this.state="Unknown",this.gu=0,this.yu=null,this.Vu=!0}function Gh(t,e,n){var r=this;return(r=Vh.call(this)||this).credentials=t,r.Qc=e,r.serializer=n,r.Iu=!1,r}function Kh(t,e,n,r,i){var o=this;return(o=Mh.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o._u=!1,o}function Wh(t,e,n,r,i){var o=this;return(o=Uh.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Hh(t,e,n,r,i,o){this.Cs=t,this.Uc=n,this.Qc=r,this.Kc=i,this.listener=o,this.state=0,this.Wc=0,this.jc=null,this.stream=null,this.Si=new ma(t,e)}function Qh(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!nf(r))return[3,4];e=0,n=r.ku,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Yh(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.ku,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Xh(t,e){t.Ou.has(e.targetId)||(t.Ou.set(e.targetId,e),ef(t)?tf(t):ff(t).zc()&&$h(t,e))}function Jh(t,e){var n=t,t=ff(n);n.Ou.delete(e),t.zc()&&Zh(n,e),0===n.Ou.size&&(t.zc()?t.Yc():nf(n)&&n.Bu.set("Unknown"))}function $h(t,e){t.qu.De(e.targetId),ff(t).hu(e)}function Zh(t,e){t.qu.De(e),ff(t).lu(e)}function tf(e){e.qu=new Xi({Xe:function(t){return e.xu.Xe(t)},Ze:function(t){return e.Ou.get(t)||null}}),ff(e).start(),e.Bu.pu()}function ef(t){return nf(t)&&!ff(t).Gc()&&0<t.Ou.size}function nf(t){return 0===t.Mu.size}function rf(t){t.qu=void 0}function of(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!Aa(r))throw r;return n.Mu.add(1),[4,Yh(n)];case 1:return t.sent(),n.Bu.set("Offline"),i=i||function(){return Sh(n.Cu)},n.di.Mi(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Tr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Mu.delete(1),[4,Qh(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function sf(e,n){return n().catch(function(t){return of(e,t,n)})}function uf(c){return y(this,void 0,void 0,function(){var o,s,u,a;return v(this,function(t){switch(t.label){case 0:s=lf(o=c),u=0<o.Fu.length?o.Fu[o.Fu.length-1].batchId:-1,t.label=1;case 1:if(!(nf(o)&&o.Fu.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(n=o.Cu,r=u,(i=n).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===r&&(r=-1),i.rs.Fr(t,r)}))];case 3:return null===(a=t.sent())?(0===o.Fu.length&&s.Yc(),[3,7]):(u=a.batchId,e=a,(n=o).Fu.push(e),(n=lf(n)).zc()&&n.fu&&n.du(e.mutations),[3,6]);case 4:return a=t.sent(),[4,of(o,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return af(o)&&cf(o),[2]}var e,n,r,i})})}function af(t){return nf(t)&&!lf(t).Gc()&&0<t.Fu.length}function cf(t){lf(t).start()}function hf(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Mu.delete(2),[4,Qh(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Mu.add(2),[4,Yh(e)]);case 3:t.sent(),e.Bu.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function ff(n){var t,e,r,i=this;return n.ju||(n.ju=(t=n.Nu,e=n.di,r={cu:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.Ou.forEach(function(t,e){$h(n,t)}),[2]})})}.bind(null,n),nu:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return rf(e),ef(e)?(e.Bu.Su(n),tf(e)):e.Bu.set("Unknown"),[2]})})}.bind(null,n),au:function(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Bu.set("Online"),!(u instanceof Qi&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Ou.has(i)?[4,o.xu.Uu(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Ou.delete(i),o.qu.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Tr("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,of(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof Wi?s.qu.$e(u):u instanceof Hi?s.qu.je(u):s.qu.qe(u),a.isEqual(Jr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,Sh(s.Cu)];case 8:return o=t.sent(),0<=a.F(o)?[4,(i=a,(e=(r=s).qu.He(i)).re.forEach(function(t,e){var n;0<t.resumeToken.ht()&&(n=r.Ou.get(e))&&r.Ou.set(e,n.wt(t.resumeToken,i))}),e.oe.forEach(function(t){var e=r.Ou.get(t);e&&(r.Ou.set(t,e.wt(vi.lt,e.ft)),Zh(r,t),e=new bi(e.target,t,1,e.sequenceNumber),$h(r,e))}),r.xu.Qu(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Tr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,of(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}.bind(null,n)},t.mu(),new jh(e,t.Qc,t.credentials,t.serializer,r)),n.ku.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.ju.Jc(),ef(n)?tf(n):n.Bu.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.ju.stop()];case 2:t.sent(),rf(n),t.label=3;case 3:return[2]}})})})),n.ju}function lf(n){var t,e,r,i=this;return n.Gu||(n.Gu=(t=n.Nu,e=n.di,r={cu:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return lf(e).Tu(),[2]})})}.bind(null,n),nu:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&lf(e).fu?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return Ii(n=i.code)&&n!==Pr.ABORTED?(e=r.Fu.shift(),lf(r).Jc(),[4,sf(r,function(){return r.xu.Wu(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,uf(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return af(e)&&cf(e),[2]}})})}.bind(null,n),Eu:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=lf(o),n=0,r=o.Fu;n<r.length;n++)i=r[n],e.du(i.mutations);return[2]})})}.bind(null,n),wu:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Fu.shift(),n=$u.from(e,i,o),[4,sf(r,function(){return r.xu.Ku(n)})];case 1:return t.sent(),[4,uf(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.mu(),new qh(e,t.Qc,t.credentials,t.serializer,r)),n.ku.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.Gu.Jc(),[4,uf(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Gu.stop()];case 3:t.sent(),0<n.Fu.length&&(Tr("RemoteStore","Stopping write stream with "+n.Fu.length+" pending writes"),n.Fu=[]),t.label=4;case 4:return[2]}})})})),n.Gu}function pf(){this.queries=new Zu(gu,vu),this.onlineState="Unknown",this.Hu=new Set}var df=function(){this.zu=void 0,this.listeners=[]};function yf(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new df),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.Ju(n)];case 2:return o.zu=t.sent(),[3,4];case 3:return o=qa(o=t.sent(),"Initialization of query '"+mu(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(u),u.Yu(e.onlineState),i.zu&&u.Xu(i.zu)&&gf(e),[2]}})})}function vf(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.Zu(n))]:[2]})})}function gf(t){t.Hu.forEach(function(t){t.next()})}var mf=(Ef.prototype.Xu=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new zi(t.query,t.docs,t.te,e,t.ee,t.fromCache,t.ne,!0)}var o=!1;return this.ea?this.sa(t)&&(this.ta.next(t),o=!0):this.ia(t,this.onlineState)&&(this.ra(t),o=!0),this.na=t,o},Ef.prototype.onError=function(t){this.ta.error(t)},Ef.prototype.Yu=function(t){this.onlineState=t;var e=!1;return this.na&&!this.ea&&this.ia(this.na,t)&&(this.ra(this.na),e=!0),e},Ef.prototype.ia=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.oa&&n||t.docs.W()&&"Offline"!==e)},Ef.prototype.sa=function(t){if(0<t.docChanges.length)return!0;var e=this.na&&this.na.hasPendingWrites!==t.hasPendingWrites;return!(!t.ne&&!e)&&!0===this.options.includeMetadataChanges},Ef.prototype.ra=function(t){t=zi.ie(t.query,t.docs,t.ee,t.fromCache),this.ea=!0,this.ta.next(t)},Ef),wf=(If.prototype.W=function(){return this.ca.W()},If.prototype.Do=function(t,e){e=new bf(t,e),this.ca=this.ca.add(e),this.aa=this.aa.add(e)},If.prototype.la=function(t,e){var n=this;t.forEach(function(t){return n.Do(t,e)})},If.prototype.No=function(t,e){this._a(new bf(t,e))},If.prototype.fa=function(t,e){var n=this;t.forEach(function(t){return n.No(t,e)})},If.prototype.da=function(t){var e=this,n=new ei(new $r([])),r=new bf(n,t),t=new bf(n,t+1),i=[];return this.aa.Kt([r,t],function(t){e._a(t),i.push(t.key)}),i},If.prototype.wa=function(){var e=this;this.ca.forEach(function(t){return e._a(t)})},If.prototype._a=function(t){this.ca=this.ca.delete(t),this.aa=this.aa.delete(t)},If.prototype.Ea=function(t){var e=new ei(new $r([])),n=new bf(e,t),t=new bf(e,t+1),r=ji();return this.aa.Kt([n,t],function(t){r=r.add(t.key)}),r},If.prototype.Qr=function(t){var e=new bf(t,0);return null!==(e=this.ca.jt(e))&&t.isEqual(e.key)},If),bf=(_f.ua=function(t,e){return ei.$(t.key,e.key)||Kr(t.Ta,e.Ta)},_f.ha=function(t,e){return Kr(t.Ta,e.Ta)||ei.$(t.key,e.key)},_f);function _f(t,e){this.key=t,this.Ta=e}function If(){this.ca=new ki(bf.ua),this.aa=new ki(bf.ha)}function Ef(t,e,n){this.query=t,this.ta=e,this.ea=!1,this.na=null,this.onlineState="Unknown",this.options=n||{}}function Tf(t,e){return"firestore_clients_"+t+"_"+e}function Nf(t,e,n){return n="firestore_mutations_"+t+"_"+n,e.u()&&(n+="_"+e.uid),n}function Af(t,e){return"firestore_targets_"+t+"_"+e}var Of=(Qf.Ia=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Rr(r.error.code,r.error.message)),i?new Qf(t,e,r.state,o):(Nr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Qf.prototype.ma=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Qf),Sf=(Hf.Ia=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Rr(n.error.code,n.error.message)),r?new Hf(t,n.state,i):(Nr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Hf.prototype.ma=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Hf),Df=(Wf.Ia=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=qi,o=0;r&&o<n.activeTargetIds.length;++o)r=hi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Wf(t,i):(Nr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Wf),xf=(Kf.Ia=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Kf(e.clientId,e.onlineState):(Nr("SharedClientState","Failed to parse online state: "+t),null)},Kf),kf=(Gf.prototype.Aa=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Gf.prototype.Ra=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Gf.prototype.ma=function(){var t={activeTargetIds:this.activeTargetIds.H(),updateTimeMs:Date.now()};return JSON.stringify(t)},Gf),Pf=(zf.Gs=function(t){return!(!t||!t.localStorage)},zf.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f=this;return v(this,function(t){switch(t.label){case 0:return[4,this.ga.Ic()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Pa&&(i=this.getItem(Tf(this.persistenceKey,r)))&&(o=Df.Ia(r,i))&&(this.pa=this.pa.Tt(o.clientId,o));for(this.Oa(),(s=this.storage.getItem(this.xa))&&(u=this.Ma(s))&&this.ka(u),a=0,c=this.va;a<c.length;a++)h=c[a],this.Va(h);return this.va=[],this.window.addEventListener("unload",function(){return f.fc()}),this.lr=!0,[2]}})})},zf.prototype.Ss=function(t){this.setItem(this.Sa,JSON.stringify(t))},zf.prototype.$a=function(){return this.La(this.pa)},zf.prototype.Ba=function(n){var r=!1;return this.pa.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},zf.prototype.qa=function(t){this.Ua(t,"pending")},zf.prototype.Qa=function(t,e,n){this.Ua(t,e,n),this.Ka(t)},zf.prototype.Wa=function(t){var e,n="not-current";return this.Ba(t)&&(!(e=this.storage.getItem(Af(this.persistenceKey,t)))||(e=Sf.Ia(t,e))&&(n=e.state)),this.ja.Aa(t),this.Oa(),n},zf.prototype.Ga=function(t){this.ja.Ra(t),this.Oa()},zf.prototype.za=function(t){return this.ja.activeTargetIds.has(t)},zf.prototype.Ha=function(t){this.removeItem(Af(this.persistenceKey,t))},zf.prototype.Ja=function(t,e,n){this.Ya(t,e,n)},zf.prototype.Xa=function(t,e,n){var r=this;e.forEach(function(t){r.Ka(t)}),this.currentUser=t,n.forEach(function(t){r.qa(t)})},zf.prototype.Za=function(t){this.th(t)},zf.prototype.eh=function(){this.nh()},zf.prototype.fc=function(){this.lr&&(this.window.removeEventListener("storage",this.ya),this.removeItem(this.ba),this.lr=!1)},zf.prototype.getItem=function(t){var e=this.storage.getItem(t);return Tr("SharedClientState","READ",t,e),e},zf.prototype.setItem=function(t,e){Tr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},zf.prototype.removeItem=function(t){Tr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},zf.prototype.Va=function(t){var e=this,o=t;o.storageArea===this.storage&&(Tr("SharedClientState","EVENT",o.key,o.newValue),o.key!==this.ba?this.Cs.Mi(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){if(this.lr){if(null!==o.key)if(this.Da.test(o.key)){if(null==o.newValue)return e=this.sh(o.key),[2,this.ih(e,null)];if(e=this.rh(o.key,o.newValue))return[2,this.ih(e.clientId,e)]}else if(this.Ca.test(o.key)){if(null!==o.newValue&&(n=this.oh(o.key,o.newValue)))return[2,this.uh(n)]}else if(this.Na.test(o.key)){if(null!==o.newValue&&(r=this.ah(o.key,o.newValue)))return[2,this.hh(r)]}else if(o.key===this.xa){if(null!==o.newValue&&(i=this.Ma(o.newValue)))return[2,this.ka(i)]}else if(o.key===this.Sa)(i=function(t){var e=la.Ds;if(null!=t)try{var n=JSON.parse(t);Dr("number"==typeof n),e=n}catch(t){Nr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==la.Ds&&this.ps(i);else if(o.key===this.Fa)return[2,this.ga.lh()]}else this.va.push(o);return[2]})})}):Nr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(zf.prototype,"ja",{get:function(){return this.pa.get(this.Pa)},enumerable:!1,configurable:!0}),zf.prototype.Oa=function(){this.setItem(this.ba,this.ja.ma())},zf.prototype.Ua=function(t,e,n){n=new Of(this.currentUser,t,e,n),t=Nf(this.persistenceKey,this.currentUser,t),this.setItem(t,n.ma())},zf.prototype.Ka=function(t){t=Nf(this.persistenceKey,this.currentUser,t),this.removeItem(t)},zf.prototype.th=function(t){t={clientId:this.Pa,onlineState:t},this.storage.setItem(this.xa,JSON.stringify(t))},zf.prototype.Ya=function(t,e,n){var r=Af(this.persistenceKey,t),n=new Sf(t,e,n);this.setItem(r,n.ma())},zf.prototype.nh=function(){this.setItem(this.Fa,"value-not-used")},zf.prototype.sh=function(t){return(t=this.Da.exec(t))?t[1]:null},zf.prototype.rh=function(t,e){return t=this.sh(t),Df.Ia(t,e)},zf.prototype.oh=function(t,e){var n=this.Ca.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Of.Ia(new mr(n),t,e)},zf.prototype.ah=function(t,e){return t=this.Na.exec(t),t=Number(t[1]),Sf.Ia(t,e)},zf.prototype.Ma=function(t){return xf.Ia(t)},zf.prototype.uh=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.ga._h(e.batchId,e.state,e.error)]:(Tr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},zf.prototype.hh=function(t){return this.ga.fh(t.targetId,t.state,t.error)},zf.prototype.ih=function(t,e){var n=this,r=e?this.pa.Tt(t,e):this.pa.remove(t),i=this.La(this.pa),o=this.La(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.ga.dh(s,u).then(function(){n.pa=r})},zf.prototype.ka=function(t){this.pa.get(t.clientId)&&this.Pu(t.onlineState)},zf.prototype.La=function(t){var n=qi;return t.forEach(function(t,e){n=n.Gt(e.activeTargetIds)}),n},zf),Rf=(Bf.prototype.qa=function(t){},Bf.prototype.Qa=function(t,e,n){},Bf.prototype.Wa=function(t){return this.wh.Aa(t),this.Eh[t]||"not-current"},Bf.prototype.Ja=function(t,e,n){this.Eh[t]=e},Bf.prototype.Ga=function(t){this.wh.Ra(t)},Bf.prototype.za=function(t){return this.wh.activeTargetIds.has(t)},Bf.prototype.Ha=function(t){delete this.Eh[t]},Bf.prototype.$a=function(){return this.wh.activeTargetIds},Bf.prototype.Ba=function(t){return this.wh.activeTargetIds.has(t)},Bf.prototype.start=function(){return this.wh=new kf,Promise.resolve()},Bf.prototype.Xa=function(t,e,n){},Bf.prototype.Za=function(t){},Bf.prototype.fc=function(){},Bf.prototype.Ss=function(t){},Bf.prototype.eh=function(){},Bf),Cf=function(t){this.key=t},Lf=function(t){this.key=t},Vf=(Object.defineProperty(Ff.prototype,"Ph",{get:function(){return this.Th},enumerable:!1,configurable:!0}),Ff.prototype.gh=function(t,e){var s=this,u=e?e.yh:new Bi,a=(e||this).Rh,c=(e||this).ee,h=a,f=!1,l=au(this.query)&&a.size===this.query.limit?a.last():null,p=cu(this.query)&&a.size===this.query.limit?a.first():null;if(t.Pt(function(t,e){var n=a.get(t),r=(r=e instanceof Zs?e:null)&&(wu(s.query,r)?r:null),i=!!n&&s.ee.has(n.key),o=!!r&&(r.an||s.ee.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.Vh(n,r)||(u.track({type:2,doc:r}),e=!0,(l&&0<s.Ah(r,l)||p&&s.Ah(r,p)<0)&&(f=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(l||p)&&(f=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),au(this.query)||cu(this.query))for(;h.size>this.query.limit;){var n=au(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{Rh:h,yh:u,ph:f,ee:c}},Ff.prototype.Vh=function(t,e){return t.an&&e.hasCommittedMutations&&!e.an},Ff.prototype.Zn=function(t,e,n){var o=this,r=this.Rh;this.Rh=t.Rh,this.ee=t.ee;var i=t.yh.Zt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.Ah(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Sr()}}var r,i}),this.bh(n);var s=e?this.Sh():[],e=(n=0===this.mh.size&&this.le?1:0)!==this.Ih;return this.Ih=n,0!==i.length||e?{snapshot:new zi(this.query,t.Rh,r,i,t.ee,0==n,e,!1),Dh:s}:{Dh:s}},Ff.prototype.Yu=function(t){return this.le&&"Offline"===t?(this.le=!1,this.Zn({Rh:this.Rh,yh:new Bi,ee:this.ee,ph:!1},!1)):{Dh:[]}},Ff.prototype.Ch=function(t){return!this.Th.has(t)&&!!this.Rh.has(t)&&!this.Rh.get(t).an},Ff.prototype.bh=function(t){var e=this;t&&(t._e.forEach(function(t){return e.Th=e.Th.add(t)}),t.fe.forEach(function(t){}),t.de.forEach(function(t){return e.Th=e.Th.delete(t)}),this.le=t.le)},Ff.prototype.Sh=function(){var e=this;if(!this.le)return[];var n=this.mh;this.mh=ji(),this.Rh.forEach(function(t){e.Ch(t.key)&&(e.mh=e.mh.add(t.key))});var r=[];return n.forEach(function(t){e.mh.has(t)||r.push(new Lf(t))}),this.mh.forEach(function(t){n.has(t)||r.push(new Cf(t))}),r},Ff.prototype.Nh=function(t){return this.Th=t.Bc,this.mh=ji(),t=this.gh(t.documents),this.Zn(t,!0)},Ff.prototype.xh=function(){return zi.ie(this.query,this.Rh,this.ee,0===this.Ih)},Ff),Mf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Uf=function(t){this.key=t,this.Fh=!1},jf=(Object.defineProperty(qf.prototype,"Jh",{get:function(){return!0===this.Hh},enumerable:!1,configurable:!0}),qf);function qf(t,e,n,r,i,o){this.Cu=t,this.Oh=e,this.Mh=n,this.kh=r,this.currentUser=i,this.$h=o,this.Lh={},this.Bh=new Zu(gu,vu),this.qh=new Map,this.Uh=[],this.Qh=new Ti(ei.$),this.Kh=new Map,this.Wh=new wf,this.jh={},this.Gh=new Map,this.zh=oh._o(),this.onlineState="Unknown",this.Hh=void 0}function Ff(t,e){this.query=t,this.Th=e,this.Ih=null,this.le=!1,this.mh=ji(),this.ee=ji(),this.Ah=bu(t),this.Rh=new Fi(this.Ah)}function Bf(){this.wh=new kf,this.Eh={},this.Pu=null,this.ps=null}function zf(t,e,n,r,i){this.window=t,this.Cs=e,this.persistenceKey=n,this.Pa=r,this.ga=null,this.Pu=null,this.ps=null,this.ya=this.Va.bind(this),this.pa=new Ti(Kr),this.lr=!1,this.va=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.ba=Tf(this.persistenceKey,this.Pa),this.Sa="firestore_sequence_number_"+this.persistenceKey,this.pa=this.pa.Tt(this.Pa,new kf),this.Da=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Ca=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.Na=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.xa="firestore_online_state_"+this.persistenceKey,this.Fa="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.ya)}function Gf(){this.activeTargetIds=qi}function Kf(t,e){this.clientId=t,this.onlineState=e}function Wf(t,e){this.clientId=t,this.activeTargetIds=e}function Hf(t,e,n){this.targetId=t,this.state=e,this.error=n}function Qf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Yf(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Yh=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.gh(o)).ph?[4,kh(r.Cu,i.query,!1).then(function(t){return t=t.documents,i.view.gh(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.re.get(i.targetId),n=i.view.Zn(e,r.Jh,n),[2,(il(r,i.targetId,n.Dh),n.snapshot)]}})})}(i,t,e,n)},[4,kh(i.Cu,o,!0)];case 1:return n=t.sent(),r=new Vf(o,n.Bc),e=r.gh(n.documents),n=Ki.he(s,u&&"Offline"!==i.onlineState),n=r.Zn(e,i.Jh,n),il(i,s,n.Dh),r=new Mf(o,s,r),[2,(i.Bh.set(o,r),i.qh.has(s)?i.qh.get(s).push(o):i.qh.set(s,[o]),n.snapshot)]}})})}function Xf(l,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=hl(l),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.Cu,a=p,h=i,f=Xr.now(),o=a.reduce(function(t,e){return t.add(e.key)},ji()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Oc._s(u,o).next(function(t){c=t;for(var s,e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=(s=i,o=c.get(i.key),s instanceof Ms?function(t){for(var e=null,n=0,r=s.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Zs?t.field(i.field):void 0;null!=(o=ns(i.transform,o||null))&&(e=(null==e?new Ks:e).set(i.field,o))}return e?e.hn():null}(o):null);null!=o&&e.push(new Ps(i.key,o,function s(t){var u=[];return uo(t.fields||{},function(t,e){var n=new ti([t]);if(Oo(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new ws(u)}(o.proto.mapValue),Es.exists(!0)))}return h.rs.Sr(u,f,e,a)})}).then(function(t){var e=t.vn(c);return{batchId:t.batchId,Qn:e}}))];case 2:return s=t.sent(),u.kh.qa(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.jh[e.currentUser.h()])||new Ti(Kr)).Tt(n,r),e.jh[e.currentUser.h()]=i,[4,sl(u,s.Qn)];case 3:return t.sent(),[4,uf(u.Oh)];case 4:return t.sent(),[3,6];case 5:return u=qa(u=t.sent(),"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,f,o})})}function Jf(i,s){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:n=i,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Cu,h=e,f=(o=s).ft,l=h.Cc,h.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=h.Fc.Xr({Zr:!0});l=h.Cc;var u=[];o.re.forEach(function(t,e){var n,r,i,o=l.get(e);o&&(u.push(h.jo.Co(s,t.de,e).next(function(){return h.jo.So(s,t._e,e)})),0<(i=t.resumeToken).ht()&&(n=o.wt(i,f).dt(s.Fo),l=l.Tt(e,n),r=o,i=t,Dr(0<(o=n).resumeToken.ht()),(0===r.resumeToken.ht()||3e8<=o.ft.O()-r.ft.O()||0<i._e.size+i.fe.size+i.de.size)&&u.push(h.jo.yo(s,n))))});var e,a,n,c,r,i=Ri;return o.ce.forEach(function(t,e){o.ue.has(t)&&u.push(h.persistence.Vr.Sc(s,t))}),u.push((e=s,a=t,n=o.ce,c=f,r=ji(),n.forEach(function(t){return r=r.add(t)}),a.getEntries(e,r).next(function(i){var o=Ri;return n.forEach(function(t,e){var n=i.get(t),r=c;e instanceof tu&&e.version.isEqual(Jr.min())?(a.Hn(t,r),o=o.Tt(t,e)):null==n||0<e.version.F(n.version)||0===e.version.F(n.version)&&n.hasPendingWrites?(a.jn(e,r),o=o.Tt(t,e)):Tr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o}).next(function(t){i=t}))),f.isEqual(Jr.min())||(e=h.jo.To(s).next(function(t){return h.jo.mo(s,s.Fo,f)}),u.push(e)),ta.qn(u).next(function(){return t.apply(s)}).next(function(){return h.Oc.fs(s,i)})}).then(function(t){return h.Cc=l,t}))];case 2:return r=t.sent(),s.re.forEach(function(t,e){(e=n.Kh.get(e))&&(Dr(t._e.size+t.fe.size+t.de.size<=1),0<t._e.size?e.Fh=!0:0<t.fe.size?Dr(e.Fh):0<t.de.size&&(Dr(e.Fh),e.Fh=!1))}),[4,sl(n,r,s)];case 3:return t.sent(),[3,6];case 4:return[4,Ch(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,o,h,f,l})})}function $f(t,n,e){var r;((t=t).Jh&&0===e||!t.Jh&&1===e)&&(r=[],t.Bh.forEach(function(t,e){(e=e.view.Yu(n)).snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Yu(i)&&(o=!0)}),o&&gf(t)}(t.Mh,n),r.length&&t.Lh.au(r),t.onlineState=n,t.Jh&&t.kh.Za(n))}function Zf(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:nf((n=o).Oh)||Tr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.Cu).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.rs.Or(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Gh.get(r)||[]).push(s),n.Gh.set(r,i),[3,4]);case 3:return i=qa(i=t.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function tl(t,e){(t.Gh.get(e)||[]).forEach(function(t){t.resolve()}),t.Gh.delete(e)}function el(t,e,n){var r=t,i=r.jh[r.currentUser.h()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.jh[r.currentUser.h()]=i)}function nl(e,t,n){void 0===n&&(n=null),e.kh.Ga(t);for(var r=0,i=e.qh.get(t);r<i.length;r++){var o=i[r];e.Bh.delete(o),n&&e.Lh.Xh(o,n)}e.qh.delete(t),e.Jh&&e.Wh.da(t).forEach(function(t){e.Wh.Qr(t)||rl(e,t)})}function rl(t,e){var n=t.Qh.get(e);null!==n&&(Jh(t.Oh,n),t.Qh=t.Qh.remove(e),t.Kh.delete(n),ol(t))}function il(t,e,n){for(var r,i,o=0,s=n;o<s.length;o++){var u=s[o];u instanceof Cf?(t.Wh.Do(u.key,e),r=t,i=(i=u).key,r.Qh.get(i)||(Tr("SyncEngine","New document in limbo: "+i),r.Uh.push(i),ol(r))):u instanceof Lf?(Tr("SyncEngine","Document no longer in limbo: "+u.key),t.Wh.No(u.key,e),t.Wh.Qr(u.key)||rl(t,u.key)):Sr()}}function ol(t){for(;0<t.Uh.length&&t.Qh.size<t.$h;){var e=t.Uh.shift(),n=t.zh.next();t.Kh.set(n,new Uf(e)),t.Qh=t.Qh.Tt(e,n),Xh(t.Oh,new bi(du(uu(e.path)),n,2,la.Ds))}}function sl(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Bh.W()?[3,3]:(n.Bh.forEach(function(t,e){o.push(n.Yh(e,s,u).then(function(t){t&&(n.Jh&&n.kh.Ja(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=fa.Vs(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.Lh.au(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return ta.forEach(c,function(e){return ta.forEach(e.gs,function(t){return r.persistence.Vr.Do(n,e.targetId,t)}).next(function(){return ta.forEach(e.ys,function(t){return r.persistence.Vr.No(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Aa(e=t.sent()))throw e;return Tr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.Cc.get(o),u=s.ft,u=s.Et(u),r.Cc=r.Cc.Tt(o,u));return[2]}})})}(n.Cu,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function ul(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.qh.get(s))&&0!==a.length?[4,Dh(e.Cu,du(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],f=e.Bh.get(f),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,kh((e=r).Cu,i.query,!0)];case 1:return n=t.sent(),n=i.view.Nh(n),[2,(e.Jh&&il(e,i.targetId,n.Dh),n)]}})})}(e,f)]):[3,6];case 4:(f=t.sent()).snapshot&&r.push(f.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Ph(e.Cu,s)];case 8:return l=t.sent(),[4,Dh(e.Cu,l)];case 9:return u=t.sent(),[4,Yf(e,al(l),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Lh.au(r),n)]}})})}function al(t){return su(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function cl(t){return t.Oh.xu.Qu=Jf.bind(null,t),t.Oh.xu.Xe=function(t,e){var n=t;if((t=n.Kh.get(e))&&t.Fh)return ji().add(t.key);var r=ji();if(!(e=n.qh.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Bh.get(s),r=r.Gt(s.view.Ph);return r}.bind(null,t),t.Oh.xu.Uu=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).kh.Ja(s,"rejected",u),i=e.Kh.get(s),(n=i&&i.key)?(r=(r=new Ti(ei.$)).Tt(n,new tu(n,Jr.min())),i=ji().add(n),i=new Gi(Jr.min(),new Map,new ki(Kr),r,i),[4,Jf(e,i)]):[3,2];case 1:return t.sent(),e.Qh=e.Qh.remove(n),e.Kh.delete(s),ol(e),[3,4];case 2:return[4,xh(e.Cu,s,!1).then(function(){return nl(e,s,u)}).catch(Ch)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.Lh.au=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query;if(u=n.queries.get(u)){for(var a=0,c=u.listeners;a<c.length;a++)c[a].Xu(s)&&(r=!0);u.zu=s}}r&&gf(n)}.bind(null,t.Mh),t.Lh.Xh=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.Mh),t}function hl(t){return t.Oh.xu.Ku=function(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:n=o,r=s.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Cu,h=s,(f=e).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r,e=h.batch.keys(),n=f.Fc.Xr({Zr:!0}),i=f,o=t,s=n,u=(r=h).batch,a=u.keys(),c=ta.resolve();return a.forEach(function(n){c=c.next(function(){return s.Jn(o,n)}).next(function(t){var e=t;Dr(null!==(t=r.Sn.get(n))),(!e||e.version.F(t)<0)&&(e=u.yn(n,e,r))&&s.jn(e,r.bn)})}),c.next(function(){return i.rs.$r(o,u)}).next(function(){return n.apply(t)}).next(function(){return f.rs.Ur(t)}).next(function(){return f.Oc._s(t,e)})}))];case 2:return i=t.sent(),el(n,r,null),tl(n,r),n.kh.Qa(r,"acknowledged"),[4,sl(n,i)];case 3:return t.sent(),[3,6];case 4:return[4,Ch(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,h,f})})}.bind(null,t),t.Oh.xu.Wu=function(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Cu,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.rs.Cr(e,r).next(function(t){return Dr(null!==t),n=t.keys(),i.rs.$r(e,t)}).next(function(){return i.rs.Ur(e)}).next(function(){return i.Oc._s(e,n)})}))];case 2:return o=t.sent(),el(n,u,a),tl(n,u),n.kh.Qa(u,"rejected",a),[4,sl(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Ch(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,t),t}var fl,ll,pl,dl,yl,vl=(tp.prototype.Mc=function(t){this.Zh=t},tp.prototype.ws=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.Tn.length||1===r.Tn.length&&r.Tn[0].field.tt())||i.isEqual(Jr.min())?this.tl(e,r):this.Zh._s(e,o).next(function(t){var n=s.el(r,t);return(au(r)||cu(r))&&s.ph(r.limitType,n,o,i)?s.tl(e,r):(Er()<=l.DEBUG&&Tr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),mu(r)),s.Zh.ws(e,r,i).next(function(e){return n.forEach(function(t){e=e.Tt(t.key,t)}),e}))})},tp.prototype.el=function(n,t){var r=new ki(bu(n));return t.forEach(function(t,e){e instanceof Zs&&wu(n,e)&&(r=r.add(e))}),r},tp.prototype.ph=function(t,e,n,r){return n.size!==e.size||!!(e="F"===t?e.last():e.first())&&(e.hasPendingWrites||0<e.version.F(r))},tp.prototype.tl=function(t,e){return Er()<=l.DEBUG&&Tr("IndexFreeQueryEngine","Using full collection scan to execute query:",mu(e)),this.Zh.ws(t,e,Jr.min())},tp),gl=(Zl.prototype.br=function(t){return ta.resolve(0===this.rs.length)},Zl.prototype.Sr=function(t,e,n,r){var i=this.nl;this.nl++,0<this.rs.length&&this.rs[this.rs.length-1],n=new Ju(i,e,n,r),this.rs.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this.sl=this.sl.add(new bf(u.key,i)),this.os.Dr(t,u.key.path.q())}return ta.resolve(n)},Zl.prototype.Cr=function(t,e){return ta.resolve(this.il(e))},Zl.prototype.Fr=function(t,e){return e+=1,e=(e=this.rl(e))<0?0:e,ta.resolve(this.rs.length>e?this.rs[e]:null)},Zl.prototype.Or=function(){return ta.resolve(0===this.rs.length?-1:this.nl-1)},Zl.prototype.Mr=function(t){return ta.resolve(this.rs.slice())},Zl.prototype.us=function(t,e){var n=this,r=new bf(e,0),e=new bf(e,Number.POSITIVE_INFINITY),i=[];return this.sl.Kt([r,e],function(t){t=n.il(t.Ta),i.push(t)}),ta.resolve(i)},Zl.prototype.ds=function(t,e){var n=this,r=new ki(Kr);return e.forEach(function(t){var e=new bf(t,0),t=new bf(t,Number.POSITIVE_INFINITY);n.sl.Kt([e,t],function(t){r=r.add(t.Ta)})}),ta.resolve(this.ol(r))},Zl.prototype.Rs=function(t,e){var n=e.path,r=n.length+1,e=n;ei.ot(e)||(e=e.child(""));var e=new bf(new ei(e),0),i=new ki(Kr);return this.sl.Wt(function(t){var e=t.key.path;return!!n.j(e)&&(e.length===r&&(i=i.add(t.Ta)),!0)},e),ta.resolve(this.ol(i))},Zl.prototype.ol=function(t){var e=this,n=[];return t.forEach(function(t){null!==(t=e.il(t))&&n.push(t)}),n},Zl.prototype.$r=function(n,r){var i=this;Dr(0===this.cl(r.batchId,"removed")),this.rs.shift();var o=this.sl;return ta.forEach(r.mutations,function(t){var e=new bf(t.key,r.batchId);return o=o.delete(e),i.Vr.qr(n,t.key)}).next(function(){i.sl=o})},Zl.prototype.Br=function(t){},Zl.prototype.Qr=function(t,e){var n=new bf(e,0),n=this.sl.jt(n);return ta.resolve(e.isEqual(n&&n.key))},Zl.prototype.Ur=function(t){return this.rs.length,ta.resolve()},Zl.prototype.cl=function(t,e){return this.rl(t)},Zl.prototype.rl=function(t){return 0===this.rs.length?0:t-this.rs[0].batchId},Zl.prototype.il=function(t){return(t=this.rl(t))<0||t>=this.rs.length?null:this.rs[t]},Zl),ml=($l.prototype.jn=function(t,e,n){var r=e.key,i=(o=this.docs.get(r))?o.size:0,o=this.ul(e);return this.docs=this.docs.Tt(r,{zn:e,size:o,readTime:n}),this.size+=o-i,this.os.Dr(t,r.path.q())},$l.prototype.Hn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},$l.prototype.Jn=function(t,e){return e=this.docs.get(e),ta.resolve(e?e.zn:null)},$l.prototype.getEntries=function(t,e){var n=this,r=Ri;return e.forEach(function(t){var e=n.docs.get(t);r=r.Tt(t,e?e.zn:null)}),ta.resolve(r)},$l.prototype.ws=function(t,e,n){for(var r=Vi,i=new ei(e.path.child("")),o=this.docs.Vt(i);o.Nt();){var s=(u=o.Ct()).key,u=(a=u.value).zn,a=a.readTime;if(!e.path.j(s.path))break;a.F(n)<=0||u instanceof Zs&&wu(e,u)&&(r=r.Tt(u.key,u))}return ta.resolve(r)},$l.prototype.al=function(t,e){return ta.forEach(this.docs,function(t){return e(t)})},$l.prototype.Xr=function(t){return new wl(this)},$l.prototype.eo=function(t){return ta.resolve(this.size)},$l),wl=(n(Jl,yl=h),Jl.prototype.Zn=function(n){var r=this,i=[];return this.Qn.forEach(function(t,e){e&&e.zn?i.push(r.no.jn(n,e.zn,r.Wn(t))):r.no.Hn(t)}),ta.qn(i)},Jl.prototype.Yn=function(t,e){return this.no.Jn(t,e)},Jl.prototype.Xn=function(t,e){return this.no.getEntries(t,e)},Jl),bl=(Xl.prototype.Ue=function(t,n){return this.hl.forEach(function(t,e){return n(e)}),ta.resolve()},Xl.prototype.To=function(t){return ta.resolve(this.lastRemoteSnapshotVersion)},Xl.prototype.Io=function(t){return ta.resolve(this.ll)},Xl.prototype.fo=function(t){return this.highestTargetId=this.fl.next(),ta.resolve(this.highestTargetId)},Xl.prototype.mo=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ll&&(this.ll=e),ta.resolve()},Xl.prototype.Ro=function(t){this.hl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.fl=new oh(e),this.highestTargetId=e),t.sequenceNumber>this.ll&&(this.ll=t.sequenceNumber)},Xl.prototype.Ao=function(t,e){return this.Ro(e),this.targetCount+=1,ta.resolve()},Xl.prototype.yo=function(t,e){return this.Ro(e),ta.resolve()},Xl.prototype.Vo=function(t,e){return this.hl.delete(e.target),this._l.da(e.targetId),--this.targetCount,ta.resolve()},Xl.prototype.mr=function(n,r,i){var o=this,s=0,u=[];return this.hl.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.hl.delete(t),u.push(o.po(n,e.targetId)),s++)}),ta.qn(u).next(function(){return s})},Xl.prototype.vo=function(t){return ta.resolve(this.targetCount)},Xl.prototype.bo=function(t,e){return e=this.hl.get(e)||null,ta.resolve(e)},Xl.prototype.So=function(t,e,n){return this._l.la(e,n),ta.resolve()},Xl.prototype.Co=function(e,t,n){this._l.fa(t,n);var r=this.persistence.Vr,i=[];return r&&t.forEach(function(t){i.push(r.qr(e,t))}),ta.qn(i)},Xl.prototype.po=function(t,e){return this._l.da(e),ta.resolve()},Xl.prototype.xo=function(t,e){return e=this._l.Ea(e),ta.resolve(e)},Xl.prototype.Qr=function(t,e){return ta.resolve(this._l.Qr(e))},Xl),_l=(Yl.prototype.ro=function(t,e){return ta.resolve(this.dl.get(e))},Yl.prototype.oo=function(t,e){return this.dl.set(e.id,{id:e.id,version:e.version,createTime:Vo(e.createTime)}),ta.resolve()},Yl.prototype.co=function(t,e){return ta.resolve(this.wl.get(e))},Yl.prototype.uo=function(t,e){return this.wl.set(e.name,{name:e.name,query:hc(e.bundledQuery),readTime:Vo(e.readTime)}),ta.resolve()},Yl),Il=(Ql.prototype.start=function(){return Promise.resolve()},Ql.prototype.fc=function(){return this.$o=!1,Promise.resolve()},Object.defineProperty(Ql.prototype,"lr",{get:function(){return this.$o},enumerable:!1,configurable:!0}),Ql.prototype.tc=function(){},Ql.prototype.ec=function(){},Ql.prototype.Pc=function(){return this.os},Ql.prototype.mc=function(t){var e=this.El[t.h()];return e||(e=new gl(this.os,this.Vr),this.El[t.h()]=e),e},Ql.prototype.Ac=function(){return this.jo},Ql.prototype.Rc=function(){return this.ss},Ql.prototype.gc=function(){return this.Go},Ql.prototype.runTransaction=function(t,e,n){var r=this;Tr("MemoryPersistence","Starting transaction:",t);var i=new El(this.ko.next());return this.Vr.Il(),n(i).next(function(t){return r.Vr.ml(i).next(function(){return t})}).Ln().then(function(t){return i.ns(),t})},Ql.prototype.Al=function(e,n){return ta.Un(Object.values(this.El).map(function(t){return function(){return t.Qr(e,n)}}))},Ql),El=(n(Hl,dl=ge),Hl),Tl=(Wl.gl=function(t){return new Wl(t)},Object.defineProperty(Wl.prototype,"yl",{get:function(){if(this.Pl)return this.Pl;throw Sr()},enumerable:!1,configurable:!0}),Wl.prototype.Do=function(t,e,n){return this.Rl.Do(n,e),this.yl.delete(n.toString()),ta.resolve()},Wl.prototype.No=function(t,e,n){return this.Rl.No(n,e),this.yl.add(n.toString()),ta.resolve()},Wl.prototype.qr=function(t,e){return this.yl.add(e.toString()),ta.resolve()},Wl.prototype.removeTarget=function(t,e){var n=this;this.Rl.da(e.targetId).forEach(function(t){return n.yl.add(t.toString())});var r=this.persistence.Ac();return r.xo(t,e.targetId).next(function(t){t.forEach(function(t){return n.yl.add(t.toString())})}).next(function(){return r.Vo(t,e)})},Wl.prototype.Il=function(){this.Pl=new Set},Wl.prototype.ml=function(n){var r=this,i=this.persistence.Rc().Xr();return ta.forEach(this.yl,function(t){var e=ei.st(t);return r.Vl(n,e).next(function(t){t||i.Hn(e)})}).next(function(){return r.Pl=null,i.apply(n)})},Wl.prototype.Sc=function(t,e){var n=this;return this.Vl(t,e).next(function(t){t?n.yl.delete(e.toString()):n.yl.add(e.toString())})},Wl.prototype.Tl=function(t){return 0},Wl.prototype.Vl=function(t,e){var n=this;return ta.Un([function(){return ta.resolve(n.Rl.Qr(e))},function(){return n.persistence.Ac().Qr(t,e)},function(){return n.persistence.Al(t,e)}])},Wl),Nl=(Kl.prototype.cu=function(t){this.bl=t},Kl.prototype.nu=function(t){this.Sl=t},Kl.prototype.onMessage=function(t){this.Dl=t},Kl.prototype.close=function(){this.vl()},Kl.prototype.send=function(t){this.pl(t)},Kl.prototype.Cl=function(){this.bl()},Kl.prototype.Nl=function(t){this.Sl(t)},Kl.prototype.xl=function(t){this.Dl(t)},Kl),Al={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ol=(Gl.prototype.Au=function(e,t,n,r){var i=this.kl(e,t);return Tr("RestConnection","Sending: ",i,n),t={},this.$l(t,r),this.Ll(e,i,t,n).then(function(t){return Tr("RestConnection","Received: ",t),t},function(t){throw Ar("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Gl.prototype.Ru=function(t,e,n,r){return this.Au(t,e,n,r)},Gl.prototype.$l=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.1.0-202010180421",t["Content-Type"]="text/plain",e)for(var n in e.T)e.T.hasOwnProperty(n)&&(t[n]=e.T[n])},Gl.prototype.kl=function(t,e){return t=Al[t],this.Ol+"/v1/"+e+":"+t},n(zl,pl=Gl),zl.prototype.Ll=function(o,e,s,u){return new Promise(function(n,r){var i=new dr;i.listenOnce(lr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case fr.NO_ERROR:var t=i.getResponseJson();Tr("Connection","XHR received:",JSON.stringify(t)),n(t);break;case fr.TIMEOUT:Tr("Connection",'RPC "'+o+'" timed out'),r(new Rr(Pr.DEADLINE_EXCEEDED,"Request time out"));break;case fr.HTTP_ERROR:var e=i.getStatus();Tr("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace("_","-"),e=0<=Object.values(Pr).indexOf(e)?e:Pr.UNKNOWN,r(new Rr(e,t.message))):r(new Rr(Pr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Rr(Pr.UNAVAILABLE,"Connection failed."));break;default:Sr()}}finally{Tr("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},zl.prototype.uu=function(t,e){var n,r=[this.Ol,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new sr,t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.t.projectId+"/databases/"+this.t.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.i};this.$l(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(n=p()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders"),Tr("Connection","Creating WebChannel: "+(r=r.join("")),t);var o=i.createWebChannel(r,t),s=!1,u=!1,a=new Nl({pl:function(t){u?Tr("Connection","Not sending because WebChannel is closed:",t):(s||(Tr("Connection","Opening WebChannel transport."),o.open(),s=!0),Tr("Connection","WebChannel sending:",t),o.send(t))},vl:function(){return o.close()}});return(t=function(t,e){o.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})})(pr.EventType.OPEN,function(){u||Tr("Connection","WebChannel transport opened.")}),t(pr.EventType.CLOSE,function(){u||(u=!0,Tr("Connection","WebChannel transport closed"),a.Nl())}),t(pr.EventType.ERROR,function(t){u||(u=!0,Ar("Connection","WebChannel transport errored:",t),a.Nl(new Rr(Pr.UNAVAILABLE,"The operation could not be completed")))}),t(pr.EventType.MESSAGE,function(t){var e,n,r,i;u||(Dr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Tr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=wi[r];if(void 0!==t)return Ei(t)}(),i=n.message,void 0===t&&(t=Pr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,a.Nl(new Rr(t,i)),o.close()):(Tr("Connection","WebChannel received:",e),a.xl(e)))}),setTimeout(function(){a.Cl()},0),a},zl),Sl=(Bl.prototype.Lu=function(t){this.Kl.push(t)},Bl.prototype.fc=function(){window.removeEventListener("online",this.Bl),window.removeEventListener("offline",this.Ul)},Bl.prototype.Wl=function(){window.addEventListener("online",this.Bl),window.addEventListener("offline",this.Ul)},Bl.prototype.ql=function(){Tr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Kl;t<e.length;t++)(0,e[t])(0)},Bl.prototype.Ql=function(){Tr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Kl;t<e.length;t++)(0,e[t])(1)},Bl.Gs=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Bl),Dl=(Fl.prototype.Lu=function(t){},Fl.prototype.fc=function(){},Fl),xl=(ql.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.serializer=ua(e.Fl.t),this.kh=this.jl(e),this.persistence=this.Gl(e),[4,this.persistence.start()];case 1:return t.sent(),this.zl=this.Hl(e),this.Cu=this.Jl(e),[2]}})})},ql.prototype.Hl=function(t){return null},ql.prototype.Jl=function(t){return Ah(this.persistence,new vl,t.Yl,this.serializer)},ql.prototype.Gl=function(t){return new Il(Tl.gl,this.serializer)},ql.prototype.jl=function(t){return new Rf},ql.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.zl&&this.zl.stop(),[4,this.kh.fc()];case 1:return t.sent(),[4,this.persistence.fc()];case 2:return t.sent(),[2]}})})},ql),kl=(n(jl,ll=xl),jl.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,ll.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=Tc(t),r=Jr.min(),t._i({index:Fc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=ic(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.xc=t})]})})}(this.Cu)];case 2:return t.sent(),[4,this.Xl.initialize(this,e)];case 3:return t.sent(),[4,hl(this.Xl.ga)];case 4:return t.sent(),[4,uf(this.Xl.Oh)];case 5:return t.sent(),[2]}})})},jl.prototype.Jl=function(t){return Ah(this.persistence,new vl,t.Yl,this.serializer)},jl.prototype.Hl=function(t){var e=this.persistence.Vr.cr;return new Ha(e,t.di)},jl.prototype.Gl=function(t){var e=Eh(t.Fl.t,t.Fl.persistenceKey),n=void 0!==this.cacheSizeBytes?Ga.er(this.cacheSizeBytes):Ga.ir;return new yh(this.synchronizeTabs,e,t.clientId,n,t.di,Ca(),La(),this.serializer,this.kh,!!this.forceOwnership)},jl.prototype.jl=function(t){return new Rf},jl),Pl=(n(Ul,fl=kl),Ul.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,fl.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Xl.ga,this.kh instanceof Pf?(this.kh.ga={_h:function(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).Cu,n=a,i=(r=e).rs,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Nr(e,n).next(function(t){return t?r.Oc._s(e,t):ta.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,uf(o.Oh)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(el(o,a,h||null),tl(o,a),o.Cu.rs.Br(a)):Sr(),t.label=4;case 4:return[4,sl(o,s)];case 5:return t.sent(),[3,7];case 6:Tr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}.bind(null,e),fh:function(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return(e=i).Hh?(Tr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.qh.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Rh(e.Cu)];case 3:return n=t.sent(),r=Gi.ae(o,"current"===s),[4,sl(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,xh(e.Cu,o,!0)];case 6:return t.sent(),nl(e,o,u),[3,8];case 7:Sr(),t.label=8;case 8:return[2]}})})}.bind(null,e),dh:function(c,h,f){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=cl(c)).Hh)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.qh.has(r)?(Tr("SyncEngine","Adding an already active target "+r),[3,5]):[4,Ph(n.Cu,r)]):[3,6];case 2:return i=t.sent(),[4,Dh(n.Cu,i)];case 3:return o=t.sent(),[4,Yf(n,al(i),o.targetId,!1)];case 4:t.sent(),Xh(n.Oh,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.qh.has(e)?[4,xh(n.Cu,e,!1).then(function(){Jh(n.Oh,e),nl(n,e)}).catch(Ch)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=f,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),Ic:function(t){return t.Cu.persistence.Ic()}.bind(null,e),lh:function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,Rh((e=n).Cu).then(function(t){return sl(e,t)})]})})}.bind(null,e)},[4,this.kh.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.Zo(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,function(h,f){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return cl(r=h),hl(r),!0!==f||!0===r.Hh?[3,3]:(e=r.kh.$a(),[4,ul(r,e.H())]);case 1:return i=t.sent(),r.Hh=!0,[4,hf(r.Oh,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],Xh(r.Oh,u);return[3,7];case 3:return!1!==f||!1===r.Hh?[3,7]:(a=[],c=Promise.resolve(),r.qh.forEach(function(t,e){r.kh.za(e)?a.push(e):c=c.then(function(){return nl(r,e),xh(r.Cu,e,!0)}),Jh(r.Oh,e)}),[4,c]);case 4:return t.sent(),[4,ul(r,a)];case 5:return t.sent(),(n=r).Kh.forEach(function(t,e){Jh(n.Oh,e)}),n.Wh.wa(),n.Kh=new Map,n.Qh=new Ti(ei.$),r.Hh=!1,[4,hf(r.Oh,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}(this.Xl.ga,e)];case 1:return t.sent(),this.zl&&(e&&!this.zl.lr?this.zl.start(this.Cu):e||this.zl.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Ul.prototype.jl=function(t){var e=Ca();if(!Pf.Gs(e))throw new Rr(Pr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Eh(t.Fl.t,t.Fl.persistenceKey);return new Pf(e,t.di,n,t.clientId,t.Yl)},Ul),Rl=(Ml.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Cu?[3,2]:(this.Cu=n.Cu,this.kh=n.kh,this.Nu=this.Zl(r),this.Oh=this.t_(r),this.Mh=this.e_(r),this.ga=this.n_(r,!n.synchronizeTabs),this.kh.Pu=function(t){return $f(e.ga,t,1)},this.Oh.xu.s_=function(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Tr("SyncEngine","User change. New user:",o.h()),[4,Oh(n.Cu,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Gh.forEach(function(t){t.forEach(function(t){t.reject(new Rr(Pr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Gh.clear(),n.kh.Xa(o,r.$c,r.Lc),[4,sl(n,r.kc)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}.bind(null,this.ga),[4,hf(this.Oh,this.ga.Jh)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ml.prototype.e_=function(t){return new pf},Ml.prototype.Zl=function(t){var e=ua(t.Fl.t),n=(n=t.Fl,new Ol(n));return t=t.credentials,new Fh(t,n,e)},Ml.prototype.t_=function(t){var e=this;return new Lh(this.Cu,this.Nu,t.di,function(t){return $f(e.ga,t,0)},t=new(Sl.Gs()?Sl:Dl))},Ml.prototype.n_=function(t,e){return n=this.Cu,r=this.Oh,i=this.Mh,o=this.kh,s=t.Yl,t=t.$h,e=e,t=new jf(n,r,i,o,s,t),e&&(t.Hh=!0),t;var n,r,i,o,s},Ml.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,Tr("RemoteStore","RemoteStore shutting down."),e.Mu.add(5),[4,Yh(e)];case 1:return t.sent(),e.$u.fc(),e.Bu.set("Unknown"),[2]}})})}(this.Oh)},Ml),Cl=(Vl.prototype.next=function(t){this.observer.next&&this.i_(this.observer.next,t)},Vl.prototype.error=function(t){this.observer.error?this.i_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Vl.prototype.r_=function(){this.muted=!0},Vl.prototype.i_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Vl),Ll=function(t){this.o_=t};function Vl(t){this.observer=t,this.muted=!1}function Ml(){}function Ul(t,e){var n=this;return(n=fl.call(this,t,e,!1)||this).Xl=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function jl(t,e,n){var r=this;return(r=ll.call(this)||this).Xl=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function ql(){this.synchronizeTabs=!1}function Fl(){}function Bl(){var t=this;this.Bl=function(){return t.ql()},this.Ul=function(){return t.Ql()},this.Kl=[],this.Wl()}function zl(t){var e=this;return(e=pl.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.i=t.i,e}function Gl(t){this.Fl=t,this.t=t.t;var e=t.ssl?"https":"http";this.Ol=e+"://"+t.host,this.Ml="projects/"+this.t.projectId+"/databases/"+this.t.database+"/documents"}function Kl(t){this.pl=t.pl,this.vl=t.vl}function Wl(t){this.persistence=t,this.Rl=new wf,this.Pl=null}function Hl(t){var e=this;return(e=dl.call(this)||this).Fo=t,e}function Ql(t,e){var n=this;this.El={},this.ko=new la(0),this.$o=!1,this.$o=!0,this.Vr=t(this),this.jo=new bl(this),this.os=new Oc,this.ss=(t=this.os,new ml(t,function(t){return n.Vr.Tl(t)})),this.serializer=new tc(e),this.Go=new _l(this.serializer)}function Yl(t){this.serializer=t,this.dl=new Map,this.wl=new Map}function Xl(t){this.persistence=t,this.hl=new Zu(pi,di),this.lastRemoteSnapshotVersion=Jr.min(),this.highestTargetId=0,this.ll=0,this._l=new wf,this.targetCount=0,this.fl=oh.lo()}function Jl(t){var e=this;return(e=yl.call(this)||this).no=t,e}function $l(t,e){this.os=t,this.ul=e,this.docs=new Ti(ei.$),this.size=0}function Zl(t,e){this.os=t,this.Vr=e,this.rs=[],this.nl=1,this.sl=new ki(bf.ua)}function tp(){}function ep(t,e,n){if(!n)throw new Rr(Pr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function np(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function rp(t,e,n,r){if(!0===e&&!0===r)throw new Rr(Pr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function ip(t){if(!ei.ot(t))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function op(t){if(ei.ot(t))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function sp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Sr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function up(t,e){if(t instanceof Ll&&(t=t.o_),t instanceof e)return t;if(e.name===t.constructor.name)throw new Rr(Pr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw t=sp(t),new Rr(Pr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function ap(t,e){if(e<=0)throw new Rr(Pr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var cp,hp=function(t){this.c_=t},fp=(n(lp,cp=hp),lp.prototype.u_=function(t){if(2!==t.a_)throw 1===t.a_?t.h_(this.c_+"() can only appear at the top level of your update data"):t.h_(this.c_+"() cannot be used with set() unless you pass {merge:true}");return t.en.push(t.path),null},lp.prototype.isEqual=function(t){return t instanceof lp},lp);function lp(){return null!==cp&&cp.apply(this,arguments)||this}function pp(t,e,n){return new uy({a_:3,l_:e.settings.l_,methodName:t.c_,__:n},e.t,e.serializer,e.ignoreUndefinedProperties)}var dp,yp,vp,gp,mp=(n(Cp,gp=hp),Cp.prototype.u_=function(t){return new bs(t.path,new os)},Cp.prototype.isEqual=function(t){return t instanceof Cp},Cp),wp=(n(Rp,vp=hp),Rp.prototype.u_=function(t){var e=pp(this,t,!0),n=this.f_.map(function(t){return yy(t,e)}),n=new ss(n);return new bs(t.path,n)},Rp.prototype.isEqual=function(t){return this===t},Rp),bp=(n(Pp,yp=hp),Pp.prototype.u_=function(t){var e=pp(this,t,!0),n=this.f_.map(function(t){return yy(t,e)}),n=new fs(n);return new bs(t.path,n)},Pp.prototype.isEqual=function(t){return this===t},Pp),_p=(n(kp,dp=hp),kp.prototype.u_=function(t){var e=new ys(t.serializer,Ro(t.serializer,this.d_));return new bs(t.path,e)},kp.prototype.isEqual=function(t){return this===t},kp),Ip=(Object.defineProperty(xp.prototype,"latitude",{get:function(){return this.w_},enumerable:!1,configurable:!0}),Object.defineProperty(xp.prototype,"longitude",{get:function(){return this.E_},enumerable:!1,configurable:!0}),xp.prototype.isEqual=function(t){return this.w_===t.w_&&this.E_===t.E_},xp.prototype.toJSON=function(){return{latitude:this.w_,longitude:this.E_}},xp.prototype.C=function(t){return Kr(this.w_,t.w_)||Kr(this.E_,t.E_)},xp),Ep=(Dp.fromBase64String=function(t){try{return new Dp(vi.fromBase64String(t))}catch(t){throw new Rr(Pr.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},Dp.fromUint8Array=function(t){return new Dp(vi.fromUint8Array(t))},Dp.prototype.toBase64=function(){return this.T_.toBase64()},Dp.prototype.toUint8Array=function(){return this.T_.toUint8Array()},Dp.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Dp.prototype.isEqual=function(t){return this.T_.isEqual(t.T_)},Dp),Tp=new Map,Np=(Sp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Sp),Ap=(Object.defineProperty(Op.prototype,"app",{get:function(){if(!this.g_)throw new Rr(Pr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.g_},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"y_",{get:function(){return this.A_},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"V_",{get:function(){return void 0!==this.p_},enumerable:!1,configurable:!0}),Op.prototype.v_=function(t){if(this.A_)throw new Rr(Pr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.m_=new Np(t),void 0!==t.credentials&&(this.P_=function(t){if(!t)return new Cr;switch(t.type){case"gapi":var e=t.client;return Dr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Mr(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Rr(Pr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},Op.prototype.b_=function(){return this.m_},Op.prototype.S_=function(){return this.A_=!0,this.m_},Op.prototype._delete=function(){return this.p_||(this.p_=this.D_()),this.p_},Op.prototype.D_=function(){return(t=Tp.get(this))&&(Tr("ComponentProvider","Removing Datastore"),Tp.delete(this),t.terminate()),Promise.resolve();var t},Op);function Op(t,e){this.I_="(lite)",this.m_=new Np({}),this.A_=!1,t instanceof gr?(this.R_=t,this.P_=new Cr):(this.g_=t,this.R_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Rr(Pr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gr(t.options.projectId)}(t),this.P_=new Lr(e))}function Sp(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Rr(Pr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Rr(Pr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,rp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Dp(t){this.T_=t}function xp(t,e){if(!isFinite(t)||t<-90||90<t)throw new Rr(Pr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Rr(Pr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.w_=t,this.E_=e}function kp(t,e){var n=this;return(n=dp.call(this,t)||this).d_=e,n}function Pp(t,e){var n=this;return(n=yp.call(this,t)||this).f_=e,n}function Rp(t,e){var n=this;return(n=vp.call(this,t)||this).f_=e,n}function Cp(){return null!==gp&&gp.apply(this,arguments)||this}function Lp(){if("undefined"==typeof Uint8Array)throw new Rr(Pr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Vp(){if("undefined"==typeof atob)throw new Rr(Pr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Mp,Up,jp,qp=(n(Qp,jp=Ep),Qp.fromBase64String=function(t){Vp();try{return new Qp(vi.fromBase64String(t))}catch(t){throw new Rr(Pr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Qp.fromUint8Array=function(t){return Lp(),new Qp(vi.fromUint8Array(t))},Qp.prototype.toBase64=function(){return Vp(),jp.prototype.toBase64.call(this)},Qp.prototype.toUint8Array=function(){return Lp(),jp.prototype.toUint8Array.call(this)},Qp.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Qp),h=(Hp.prototype.C_=function(t,e){switch(void 0===e&&(e="none"),lo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return bo(t.integerValue||t.doubleValue);case 3:return this.N_(t.timestampValue);case 4:return this.x_(t,e);case 5:return t.stringValue;case 6:return this.F_(_o(t.bytesValue));case 7:return this.O_(t.referenceValue);case 8:return this.M_(t.geoPointValue);case 9:return this.k_(t.arrayValue,e);case 10:return this.L_(t.mapValue,e);default:throw Sr()}},Hp.prototype.L_=function(t,n){var r=this,i={};return uo(t.fields||{},function(t,e){i[t]=r.C_(e,n)}),i},Hp.prototype.M_=function(t){return new Ip(bo(t.latitude),bo(t.longitude))},Hp.prototype.k_=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.C_(t,e)})},Hp.prototype.x_=function(t,e){switch(e){case"previous":var n=function t(e){return co(e=e.mapValue.fields.__previous_value__)?t(e):e}(t);return null==n?null:this.C_(n,e);case"estimate":return this.N_(ho(t));default:return null}},Hp.prototype.N_=function(t){return t=wo(t),new Xr(t.seconds,t.nanos)},Hp.prototype.B_=function(t,e){var n=$r.Y(t);return Dr(es(n)),t=new gr(n.get(1),n.get(3)),n=new ei(n.B(5)),t.isEqual(e)||Nr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},Hp),Fp=(n(Wp,Up=h),Wp.prototype.F_=function(t){return new qp(t)},Wp.prototype.O_=function(t){return t=this.B_(t,this.firestore.R_),sv.q_(t,this.firestore,null)},Wp),Bp=(Object.defineProperty(Kp.prototype,"id",{get:function(){return this.K_.path.K()},enumerable:!1,configurable:!0}),Object.defineProperty(Kp.prototype,"ref",{get:function(){return new wd(this.U_,this.j_,this.K_)},enumerable:!1,configurable:!0}),Kp.prototype.exists=function(){return null!==this.W_},Kp.prototype.data=function(){if(this.W_){if(this.j_){var t=new zp(this.U_,this.Q_,this.K_,this.W_,null);return this.j_.fromFirestore(t)}return this.Q_.C_(this.W_.En())}},Kp.prototype.get=function(t){if(this.W_&&null!==(t=this.W_.data().field(Yp("DocumentSnapshot.get",t))))return this.Q_.C_(t)},Kp),zp=(n(Gp,Mp=Bp),Gp.prototype.data=function(){return Mp.prototype.data.call(this)},Gp);function Gp(){return null!==Mp&&Mp.apply(this,arguments)||this}function Kp(t,e,n,r,i){this.U_=t,this.Q_=e,this.K_=n,this.W_=r,this.j_=i}function Wp(t){var e=this;return(e=Up.call(this)||this).firestore=t,e}function Hp(){}function Qp(){return null!==jp&&jp.apply(this,arguments)||this}function Yp(t,e){return"string"==typeof e?_y(t,e):(e instanceof Ll?e.o_:e).G_}var Xp,Jp=(td.prototype.isEqual=function(t){return this.G_.isEqual(t.G_)},td),$p=(n(Zp,Xp=Ap),Zp.prototype.D_=function(){return this.H_||tv(this),this.H_.terminate()},Zp);function Zp(t,e){var n=this;return(n=Xp.call(this,t,e)||this).z_=new Ma,n.I_="name"in t?t.name:"[DEFAULT]",n}function td(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.G_=new ti(t)}function ed(n,r,i){var t=this,o=new ea;return n.di.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,xy(n,i)];case 1:return t.sent(),[4,ky(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===Pr.FAILED_PRECONDITION||t.code===Pr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function nd(t){if(t.y_||t.V_)throw new Rr(Pr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var rd,id,od=(n(hd,id=Bp),hd.prototype.exists=function(){return id.prototype.exists.call(this)},hd.prototype.data=function(t){if(void 0===t&&(t={}),this.W_){if(this.j_){var e=new sd(this.U_,this.Q_,this.K_,this.W_,this.metadata,null);return this.j_.fromFirestore(e,t)}return this.Q_.C_(this.W_.En(),t.serverTimestamps)}},hd.prototype.get=function(t,e){if(void 0===e&&(e={}),this.W_&&null!==(t=this.W_.data().field(Yp("DocumentSnapshot.get",t))))return this.Q_.C_(t,e.serverTimestamps)},hd),sd=(n(cd,rd=od),cd.prototype.data=function(t){return void 0===t&&(t={}),rd.prototype.data.call(this,t)},cd),ud=(Object.defineProperty(ad.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(ad.prototype,"size",{get:function(){return this.Y_.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(ad.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),ad.prototype.forEach=function(e,n){var r=this;this.Y_.docs.forEach(function(t){e.call(n,new sd(r.U_,r.Q_,t.key,t,new wv(r.Y_.ee.has(t.key),r.Y_.fromCache),r.query.j_))})},ad.prototype.docChanges=function(t){if(void 0===t&&(t={}),(t=!!t.includeMetadataChanges)&&this.Y_.se)throw new Rr(Pr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.X_&&this.Z_===t||(this.X_=function(i,e){if(i.Y_.te.W()){var n=0;return i.Y_.docChanges.map(function(t){var e=new sd(i.U_,i.Q_,t.doc.key,t.doc,new wv(i.Y_.ee.has(t.doc.key),i.Y_.fromCache),i.query.j_);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i.Y_.te;return i.Y_.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new sd(i.U_,i.Q_,t.doc.key,t.doc,new wv(i.Y_.ee.has(t.doc.key),i.Y_.fromCache),i.query.j_),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Sr()}}(),doc:e,oldIndex:n,newIndex:r}})}(this,t),this.Z_=t),this.X_},ad);function ad(t,e,n,r){this.U_=t,this.Q_=e,this.Y_=r,this.metadata=new wv(r.hasPendingWrites,r.fromCache),this.query=n}function cd(){return null!==rd&&rd.apply(this,arguments)||this}function hd(t,e,n,r,i,o){var s=this;return(s=id.call(this,t,e,n,r,o)||this).U_=t,s.J_=t,s.metadata=i,s}function fd(t,e){return t instanceof od&&e instanceof od?t.U_===e.U_&&t.K_.isEqual(e.K_)&&(null===t.W_?null===e.W_:t.W_.isEqual(e.W_))&&t.j_===e.j_:t instanceof ud&&e instanceof ud&&t.U_===e.U_&&Zd(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.Y_.isEqual(e.Y_)}var ld,pd=(n(dd,ld=h),dd.prototype.F_=function(t){return new Ep(t)},dd.prototype.O_=function(t){return t=this.B_(t,this.firestore.R_),new wd(this.firestore,null,t)},dd);function dd(t){var e=this;return(e=ld.call(this)||this).firestore=t,e}function yd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=up(t.firestore,$p),s=ty(o);return e instanceof Ll&&(e=e.o_),gd(o,("string"==typeof e||e instanceof Jp?py(s,"updateDoc",t.K_,e,n,r):ly(s,"updateDoc",t.K_,e)).ef(t.K_,Es.exists(!0)))}function vd(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i={includeMetadataChanges:!1},o=0;"object"!=typeof n[o]||aa(n[o])||(i=n[o],o++);var s,u,a,c,h,f={includeMetadataChanges:i.includeMetadataChanges};aa(n[o])&&(a=n[o],n[o]=null===(i=a.next)||void 0===i?void 0:i.bind(a),n[o+1]=null===(i=a.error)||void 0===i?void 0:i.bind(a),n[o+2]=null===(i=a.complete)||void 0===i?void 0:i.bind(a)),e instanceof wd?(s=up(e.firestore,$p),u=uu(e.K_.path),h={next:function(t){n[o]&&n[o](md(s,e,t))},error:n[o+1],complete:n[o+2]}):(s=up(e.firestore,$p),u=e.tf,c=new pd(s),h={next:function(t){n[o]&&n[o](new ud(s,c,e,t))},error:n[o+1],complete:n[o+2]},zd(e.tf));var l=Zy(s),p=new Cl(h),d=new mf(u,p,f);return s.z_.Ri(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=yf,[4,Uy(l)];case 1:return[2,e.apply(void 0,[t.sent(),d])]}})})}),function(){p.r_(),s.z_.Ri(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=vf,[4,Uy(l)];case 1:return[2,e.apply(void 0,[t.sent(),d])]}})})})}}function gd(t,e){return function(n,r){var t=this,i=new ea;return n.di.Ri(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Xf,[4,My(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(Zy(t),e)}function md(t,e,n){var r=n.docs.get(e.K_),i=new pd(t);return new od(t,i,e.K_,r,new wv(n.hasPendingWrites,n.fromCache),e.j_)}var wd=(Object.defineProperty(Id.prototype,"nf",{get:function(){return this.K_.path},enumerable:!1,configurable:!0}),Object.defineProperty(Id.prototype,"id",{get:function(){return this.K_.path.K()},enumerable:!1,configurable:!0}),Object.defineProperty(Id.prototype,"path",{get:function(){return this.K_.path.J()},enumerable:!1,configurable:!0}),Object.defineProperty(Id.prototype,"parent",{get:function(){return new Kd(this.firestore,this.j_,this.K_.path.q())},enumerable:!1,configurable:!0}),Id.prototype.withConverter=function(t){return new Id(this.firestore,t,this.K_)},Id),bd=(_d.prototype.withConverter=function(t){return new _d(this.firestore,t,this.tf)},_d);function _d(t,e,n){this.j_=e,this.tf=n,this.type="query",this.firestore=t}function Id(t,e,n){this.j_=e,this.K_=n,this.type="document",this.firestore=t}function Ed(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r].sf(t);return t}var Td,Nd,Ad,Od,Sd,Dd=(n(Ud,Sd=ge=function(){}),Ud.prototype.sf=function(t){var e=ty(t.firestore),e=function(t,e,n,r,i,o){if(r.tt()){if("array-contains"===i||"array-contains-any"===i)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Fd(o,i);for(var s=[],u=0,a=o;u<a.length;u++){var c=a[u];s.push(qd(n,t,c))}h={arrayValue:{values:s}}}else h=qd(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Fd(o,i),h=dy(e,"where",o,"in"===i||"not-in"===i);var h=Iu.create(r,i,h);return function(t,e){if(e.An()){var n=fu(t);if(null!==n&&!n.isEqual(e.field))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");null!==(n=hu(t))&&Bd(0,e.field,n)}if(null!==(t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw t===e.op?new Rr(Pr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Rr(Pr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t.tf,e,t.firestore.R_,this.rf,this.cf,this.uf);return new bd(t.firestore,t.j_,(e=(t=t.tf).filters.concat([e]),new nu(t.path,t.collectionGroup,t.Tn.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},Ud),xd=(n(Md,Od=ge),Md.prototype.sf=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Xu(e,n);return e=r,null!==hu(n=t)||null!==(t=fu(n))&&Bd(0,t,e.field),r}(t.tf,this.rf,this.af);return new bd(t.firestore,t.j_,(e=(t=t.tf).Tn.concat([e]),new nu(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},Md),kd=(n(Vd,Ad=ge),Vd.prototype.sf=function(t){return new bd(t.firestore,t.j_,yu(t.tf,this.hf,this.lf))},Vd),Pd=(n(Ld,Nd=ge),Ld.prototype.sf=function(t){var e=jd(t,this.type,this._f,this.ff);return new bd(t.firestore,t.j_,(t=t.tf,new nu(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},Ld),Rd=(n(Cd,Td=ge),Cd.prototype.sf=function(t){var e=jd(t,this.type,this._f,this.ff);return new bd(t.firestore,t.j_,(t=t.tf,new nu(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},Cd);function Cd(t,e,n){var r=this;return(r=Td.call(this)||this).type=t,r._f=e,r.ff=n,r}function Ld(t,e,n){var r=this;return(r=Nd.call(this)||this).type=t,r._f=e,r.ff=n,r}function Vd(t,e,n){var r=this;return(r=Ad.call(this)||this).type=t,r.hf=e,r.lf=n,r}function Md(t,e){var n=this;return(n=Od.call(this)||this).rf=t,n.af=e,n.type="orderBy",n}function Ud(t,e,n){var r=this;return(r=Sd.call(this)||this).rf=t,r.cf=e,r.uf=n,r.type="where",r}function jd(t,c,e,n){if(e[0]instanceof Ll&&(e[0]=e[0].o_),e[0]instanceof Bp)return function(t,e,n,r){if(!n)throw new Rr(Pr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=pu(t);o<s.length;o++){var u=s[o];if(u.field.tt())i.push(Io(e,n.key));else{var a=n.field(u.field);if(co(a))throw new Rr(Pr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a)throw u=u.field.J(),new Rr(Pr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.");i.push(a)}}return new Bu(i,r)}(t.tf,t.firestore.R_,e[0].W_,n);var r=ty(t.firestore);return function(t,e,n,r,i,o){var s=t.Tn;if(i.length>s.length)throw new Rr(Pr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.tt()){if("string"!=typeof c)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!lu(t)&&-1!==c.indexOf("/"))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child($r.Y(c));if(!ei.ot(h))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new ei(h),u.push(Io(e,h))}else c=dy(n,r,c),u.push(c)}return new Bu(u,o)}(t.tf,t.firestore.R_,r,c,e,n)}function qd(t,e,n){if(n instanceof Ll&&(n=n.o_),"string"==typeof n){if(""===n)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!lu(e)&&-1!==n.indexOf("/"))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(e=e.path.child($r.Y(n)),!ei.ot(e))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Io(t,new ei(e))}if(n instanceof wd)return Io(t,n.K_);throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+sp(n)+".")}function Fd(t,e){if(!Array.isArray(t)||0===t.length)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Bd(t,e,n){if(!n.isEqual(e))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function zd(t){if(cu(t)&&0===t.Tn.length)throw new Rr(Pr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Gd,Kd=(n(Wd,Gd=bd),Object.defineProperty(Wd.prototype,"id",{get:function(){return this.tf.path.K()},enumerable:!1,configurable:!0}),Object.defineProperty(Wd.prototype,"path",{get:function(){return this.tf.path.J()},enumerable:!1,configurable:!0}),Object.defineProperty(Wd.prototype,"parent",{get:function(){var t=this.nf.q();return t.W()?null:new wd(this.firestore,null,new ei(t))},enumerable:!1,configurable:!0}),Wd.prototype.withConverter=function(t){return new Wd(this.firestore,t,this.nf)},Wd);function Wd(t,e,n){var r=this;return(r=Gd.call(this,t,e,uu(n))||this).firestore=t,r.nf=n,r.type="collection",r}function Hd(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(ep("collection","path",e),t instanceof Ap){var i=$r.Y.apply($r,s([e],n));return op(i),new Kd(t,null,i)}if(!(t instanceof wd||t instanceof Kd))throw new Rr(Pr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return op(e=$r.Y.apply($r,s([t.path],n)).child($r.Y(e))),new Kd(t.firestore,null,e)}function Qd(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(1===arguments.length&&(e=zr.D()),ep("doc","path",e),t instanceof Ap){var i=$r.Y.apply($r,s([e],n));return ip(i),new wd(t,null,new ei(i))}if(!(t instanceof wd||t instanceof Kd))throw new Rr(Pr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ip(e=t.nf.child($r.Y.apply($r,s([e],n)))),new wd(t.firestore,t instanceof Kd?t.j_:null,new ei(e))}var Yd,Xd=(n(Jd,Yd=h),Jd.prototype.F_=function(t){return new Ep(t)},Jd.prototype.O_=function(t){return t=this.B_(t,this.firestore.R_),new wd(this.firestore,null,t)},Jd);function Jd(t){var e=this;return(e=Yd.call(this)||this).firestore=t,e}function $d(t,e){return(t instanceof wd||t instanceof Kd)&&(e instanceof wd||e instanceof Kd)&&t.firestore===e.firestore&&t.path===e.path&&t.j_===e.j_}function Zd(t,e){return t instanceof bd&&e instanceof bd&&t.firestore===e.firestore&&vu(t.tf,e.tf)&&t.j_===e.j_}function ty(t){var e=t.S_(),n=ua(t.R_);return new ay(t.R_,!!e.ignoreUndefinedProperties,n)}var ey=/^__.*__$/,ny=(oy.prototype.ef=function(t,e){var n=[];return null!==this.en?n.push(new Ps(t,this.data,this.en,e)):n.push(new ks(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Ms(t,this.fieldTransforms)),n},oy),ry=(iy.prototype.ef=function(t,e){return e=[new Ps(t,this.data,this.en,e)],0<this.fieldTransforms.length&&e.push(new Ms(t,this.fieldTransforms)),e},iy);function iy(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}function oy(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}function sy(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Sr()}}var uy=(Object.defineProperty(hy.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(hy.prototype,"a_",{get:function(){return this.settings.a_},enumerable:!1,configurable:!0}),hy.prototype.wf=function(t){return new hy(Object.assign(Object.assign({},this.settings),t),this.t,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.en)},hy.prototype.Ef=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t);return(e=this.wf({path:e,__:!1})).Tf(t),e},hy.prototype.If=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t);return(t=this.wf({path:t,__:!1})).df(),t},hy.prototype.mf=function(t){return this.wf({path:void 0,__:!0})},hy.prototype.h_=function(t){return Iy(t,this.settings.methodName,this.settings.Af||!1,this.path,this.settings.l_)},hy.prototype.contains=function(e){return void 0!==this.en.find(function(t){return e.j(t)})||void 0!==this.fieldTransforms.find(function(t){return e.j(t.field)})},hy.prototype.df=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Tf(this.path.get(t))},hy.prototype.Tf=function(t){if(0===t.length)throw this.h_("Document fields must not be empty");if(sy(this.a_)&&ey.test(t))throw this.h_('Document fields cannot begin and end with "__"')},hy),ay=(cy.prototype.Rf=function(t,e,n,r){return void 0===r&&(r=!1),new uy({a_:t,methodName:e,l_:n,path:ti.X(),__:!1,Af:r},this.t,this.serializer,this.ignoreUndefinedProperties)},cy);function cy(t,e,n){this.t=t,this.ignoreUndefinedProperties=e,this.serializer=n||ua(t)}function hy(t,e,n,r,i,o){this.settings=t,this.t=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.df(),this.fieldTransforms=i||[],this.en=o||[]}function fy(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Rf(o.merge||o.mergeFields?2:0,e,n,i);my("Data must be an object, but it was:",s,r);var u,a,r=vy(r,s);if(o.merge)u=new ws(s.en),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,f=o.mergeFields;h<f.length;h++){var l=wy(e,f[h],n);if(!s.contains(l))throw new Rr(Pr.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");Ey(c,l)||c.push(l)}u=new ws(c),a=s.fieldTransforms.filter(function(t){return u.un(t.field)})}else u=null,a=s.fieldTransforms;return new ny(new Gs(r),u,a)}function ly(t,r,i,e){var o=t.Rf(1,r,i);my("Data must be an object, but it was:",o,e);var s=[],u=new Ks;return uo(e,function(t,e){var n=_y(r,t,i);e instanceof Ll&&(e=e.o_),t=o.If(n),e instanceof fp?s.push(n):null!=(t=yy(e,t))&&(s.push(n),u.set(n,t))}),e=new ws(s),new ry(u.hn(),e,o.fieldTransforms)}function py(t,e,n,r,i,o){var s=t.Rf(1,e,n),u=[wy(e,r,n)],a=[i];if(o.length%2!=0)throw new Rr(Pr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(wy(e,o[c])),a.push(o[c+1]);for(var h,f,l,p=[],d=new Ks,y=u.length-1;0<=y;--y)Ey(p,u[y])||(h=u[y],(f=a[y])instanceof Ll&&(f=f.o_),l=s.If(h),f instanceof fp?p.push(h):null!=(l=yy(f,l))&&(p.push(h),d.set(h,l)));return i=new ws(p),new ry(d.hn(),i,s.fieldTransforms)}function dy(t,e,n,r){return void 0===r&&(r=!1),yy(n,t.Rf(r?4:3,e))}function yy(s,t){if(s instanceof Ll&&(s=s.o_),gy(s))return my("Unsupported field value:",t,s),vy(s,t);if(s instanceof hp)return function(t,e){if(!sy(e.a_))throw e.h_(t.c_+"() can only be used with update() and set()");if(!e.path)throw e.h_(t.c_+"() is not currently supported inside arrays");(t=t.u_(e))&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.en.push(t.path),s instanceof Array){if(t.settings.__&&4!==t.a_)throw t.h_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=yy(i[r],t.mf(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(t instanceof Ll&&(t=t.o_),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ro(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Xr.fromDate(t);return{timestampValue:Co(e.serializer,n)}}if(t instanceof Xr){var r=new Xr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Co(e.serializer,r)}}if(t instanceof Ip)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ep)return{bytesValue:Lo(e.serializer,t.T_)};if(t instanceof wd){if(n=e.t,!(r=t.firestore.R_).isEqual(n))throw e.h_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Mo(t.firestore.R_||e.t,t.K_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.h_("Unsupported field value: "+sp(t))}(s,t)}function vy(t,n){var r={};return ao(t)?n.path&&0<n.path.length&&n.en.push(n.path):uo(t,function(t,e){null!=(e=yy(e,n.Ef(t)))&&(r[t]=e)}),{mapValue:{fields:r}}}function gy(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Xr||t instanceof Ip||t instanceof Ep||t instanceof wd||t instanceof hp)}function my(t,e,n){if(!gy(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=sp(n))?e.h_(t+" a custom object"):e.h_(t+" "+n);var r}function wy(t,e,n){if(e instanceof Ll&&(e=e.o_),e instanceof Jp)return e.G_;if("string"==typeof e)return _y(t,e);throw Iy("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var by=new RegExp("[~\\*/\\[\\]]");function _y(e,n,r){if(0<=n.search(by))throw Iy("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(Jp.bind.apply(Jp,s([void 0],n.split("."))))).G_}catch(t){throw Iy("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Iy(t,e,n,r,i){var o=r&&!r.W(),s=void 0!==i,e="Function "+e+"() called with invalid data";return n&&(e+=" (via `toFirestore()`)"),n="",(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Rr(Pr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Ey(t,e){return t.some(function(t){return t.isEqual(e)})}var Ty=(Dy.prototype.pf=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.vf(),0<this.mutations.length)throw new Rr(Pr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var r,e,n,i,o;return v(this,function(t){switch(t.label){case 0:return e=zo((r=s).serializer)+"/documents",n={documents:u.map(function(t){return jo(r.serializer,t)})},[4,r.Ru("BatchGetDocuments",e,n)];case 1:return n=t.sent(),i=new Map,n.forEach(function(t){var e,n,t=(n=r.serializer,"found"in t?function(t,e){Dr(!!e.found),e.found.name,e.found.updateTime;var n=qo(t,e.found.name),t=Vo(e.found.updateTime),e=new Gs({mapValue:{fields:e.found.fields}});return new Zs(n,t,e,{})}(n,t):"missing"in t?(e=n,Dr(!!(n=t).missing),Dr(!!n.readTime),e=qo(e,n.missing),n=Vo(n.readTime),new tu(e,n)):Sr());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){Dr(!!(t=i.get(t.toString()))),o.push(t)}),o)]}})})}(this.Nu,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof tu||t instanceof Zs?n.bf(t):Sr()}),e)]}})})},Dy.prototype.set=function(t,e){this.write(e.ef(t,this.rn(t))),this.Vf.add(t.toString())},Dy.prototype.update=function(t,e){try{this.write(e.ef(t,this.Sf(t)))}catch(t){this.yf=t}this.Vf.add(t.toString())},Dy.prototype.delete=function(t){this.write([new Bs(t,this.rn(t))]),this.Vf.add(t.toString())},Dy.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.vf(),this.yf)throw this.yf;return e=this.Pf,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=ei.st(e),n.mutations.push(new zs(e,n.rn(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=zo((e=i).serializer)+"/documents",r={writes:o.map(function(t){return Wo(e.serializer,t)})},[4,e.Au("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.Nu,this.mutations)];case 1:return t.sent(),this.gf=!0,[2]}})})},Dy.prototype.bf=function(t){var e;if(t instanceof Zs)e=t.version;else{if(!(t instanceof tu))throw Sr();e=Jr.min()}var n=this.Pf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Rr(Pr.ABORTED,"Document version changed between two reads.")}else this.Pf.set(t.key.toString(),e)},Dy.prototype.rn=function(t){var e=this.Pf.get(t.toString());return!this.Vf.has(t.toString())&&e?Es.updateTime(e):Es.on()},Dy.prototype.Sf=function(t){var e=this.Pf.get(t.toString());if(this.Vf.has(t.toString())||!e)return Es.exists(!0);if(e.isEqual(Jr.min()))throw new Rr(Pr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Es.updateTime(e)},Dy.prototype.write=function(t){this.vf(),this.mutations=this.mutations.concat(t)},Dy.prototype.vf=function(){},Dy),Ny=(Sy.prototype.run=function(){this.Cf()},Sy.prototype.Cf=function(){var t=this;this.Si.Bs(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Ty(this.Nu),(n=this.Nf(e))&&n.then(function(t){r.di.Ri(function(){return e.commit().then(function(){r.Ti.resolve(t)}).catch(function(t){r.xf(t)})})}).catch(function(t){r.xf(t)}),[2]})})})},Sy.prototype.Nf=function(t){try{var e=this.updateFunction(t);return!ai(e)&&e.catch&&e.then?e:(this.Ti.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ti.reject(t),null}},Sy.prototype.xf=function(t){var e=this;0<this.Df&&this.Ff(t)?(--this.Df,this.di.Ri(function(){return e.Cf(),Promise.resolve()})):this.Ti.reject(t)},Sy.prototype.Ff=function(t){return"FirebaseError"===t.name&&("aborted"===(t=t.code)||"failed-precondition"===t||!Ii(t))},Sy),Ay=(Oy.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.g.promise];case 1:return[2,(t.sent(),{di:this.di,Fl:this.Fl,clientId:this.clientId,credentials:this.credentials,Yl:this.user,$h:100})]}})})},Oy.prototype.Mf=function(t){var e=this;this.Of=t,this.g.promise.then(function(){return e.Of(e.user)})},Oy.prototype.kf=function(){if(this.di.Ci)throw new Rr(Pr.FAILED_PRECONDITION,"The client has already been terminated.")},Oy.prototype.terminate=function(){var t=this;this.di.Oi();var n=new ea;return this.di.Ni(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.$f?[4,this.$f.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Lf?[4,this.Lf.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.R(),n.resolve(),[3,6];case 5:return e=qa(t.sent(),"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Oy);function Oy(t,e,n){var r=this;this.credentials=t,this.di=e,this.Fl=n,this.user=mr.UNAUTHENTICATED,this.clientId=zr.D(),this.Of=function(){},this.g=new ea,this.credentials.A(function(t){Tr("FirestoreClient","Received user=",t.uid),r.user.isEqual(t)||(r.user=t,r.Of(t)),r.g.resolve()})}function Sy(t,e,n,r){this.di=t,this.Nu=e,this.updateFunction=n,this.Ti=r,this.Df=5,this.Si=new ma(this.di,"transaction_retry")}function Dy(t){this.Nu=t,this.Pf=new Map,this.mutations=[],this.gf=!1,this.yf=null,this.Vf=new Set}function xy(r,i){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return r.di.Li(),Tr("FirestoreClient","Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return e=t.sent(),[4,i.initialize(e)];case 2:return t.sent(),r.Mf(function(e){return r.di.Mi(function(){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Oh(i.Cu,e)];case 1:return t.sent(),[2]}})})})}),i.persistence.tc(function(){return r.terminate()}),r.Lf=i,[2]}})})}function ky(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return r.di.Li(),[4,Py(r)];case 1:return e=t.sent(),Tr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.Mf(function(t){return r.di.Mi(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).di.Li(),Tr("RemoteStore","RemoteStore received new credentials"),n=nf(e),e.Mu.add(3),[4,Yh(e)];case 1:return t.sent(),n&&e.Bu.set("Unknown"),[4,e.xu.s_(i)];case 2:return t.sent(),e.Mu.delete(3),[4,Qh(e)];case 3:return t.sent(),[2]}})})}(i.Oh,t)})}),r.$f=i,[2]}})})}function Py(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.Lf?[3,2]:(Tr("FirestoreClient","Using default OfflineComponentProvider"),[4,xy(e,new xl)]);case 1:t.sent(),t.label=2;case 2:return[2,e.Lf]}})})}function Ry(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.$f?[3,2]:(Tr("FirestoreClient","Using default OnlineComponentProvider"),[4,ky(e,new Rl)]);case 1:t.sent(),t.label=2;case 2:return[2,e.$f]}})})}function Cy(t){return Py(t).then(function(t){return t.persistence})}function Ly(t){return Py(t).then(function(t){return t.Cu})}function Vy(t){return Ry(t).then(function(t){return t.Oh})}function My(t){return Ry(t).then(function(t){return t.ga})}function Uy(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Ry(r)];case 1:return e=t.sent(),[2,((n=e.Mh).Ju=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=cl(s),(o=e.Bh.get(u))?(n=o.targetId,e.kh.Wa(n),r=o.view.xh(),[3,4]):[3,1];case 1:return[4,Dh(e.Cu,du(u))];case 2:return i=t.sent(),o=e.kh.Wa(i.targetId),n=i.targetId,[4,Yf(e,u,n,"current"===o)];case 3:r=t.sent(),e.Jh&&Xh(e.Oh,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.ga),n.Zu=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Bh.get(o),1<(r=e.qh.get(n.targetId)).length?[2,(e.qh.set(n.targetId,r.filter(function(t){return!vu(t,o)})),void e.Bh.delete(o))]:e.Jh?(e.kh.Ga(n.targetId),e.kh.Ba(n.targetId)?[3,2]:[4,xh(e.Cu,n.targetId,!1).then(function(){e.kh.Ha(n.targetId),Jh(e.Oh,n.targetId),nl(e,n.targetId)}).catch(Ch)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return nl(e,n.targetId),[4,xh(e.Cu,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.ga),n)]}})})}function jy(n,r,i,o,s){var t=new Cl({next:function(t){r.Ri(function(){return vf(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Rr(Pr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Rr(Pr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new mf(uu(i.path),t,{includeMetadataChanges:!0,oa:!0});return yf(n,u)}function qy(e,n,t,r,i){var o=new Cl({next:function(t){n.Ri(function(){return vf(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Rr(Pr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new mf(t,o,{includeMetadataChanges:!0,oa:!0});return yf(e,s)}var Fy=(By.prototype.set=function(t,e,n){return this.Kf(),e=Cv((t=zy(t,this.U_)).j_,e,n),n=fy(this.Qf,"WriteBatch.set",t.K_,e,null!==t.j_,n),this.qf=this.qf.concat(n.ef(t.K_,Es.on())),this},By.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this.Kf(),t=zy(t,this.U_),e instanceof Ll&&(e=e.o_),e="string"==typeof e||e instanceof Jp?py(this.Qf,"WriteBatch.update",t.K_,e,n,r):ly(this.Qf,"WriteBatch.update",t.K_,e),this.qf=this.qf.concat(e.ef(t.K_,Es.exists(!0))),this},By.prototype.delete=function(t){return this.Kf(),t=zy(t,this.U_),this.qf=this.qf.concat(new Bs(t.K_,Es.on())),this},By.prototype.commit=function(){return this.Kf(),this.Uf=!0,0<this.qf.length?this.Bf(this.qf):Promise.resolve()},By.prototype.Kf=function(){if(this.Uf)throw new Rr(Pr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},By);function By(t,e){this.U_=t,this.Bf=e,this.qf=[],this.Uf=!1,this.Qf=ty(t)}function zy(t,e){if(t instanceof Ll&&(t=t.o_),t.firestore!==e)throw new Rr(Pr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Gy,Ky,Wy=($y.prototype.get=function(t){var e=this,n=zy(t,this.U_),r=new Xd(this.U_);return this.Wf.pf([n.K_]).then(function(t){if(!t||1!==t.length)return Sr();if((t=t[0])instanceof tu)return new Bp(e.U_,r,n.K_,null,n.j_);if(t instanceof Zs)return new Bp(e.U_,r,t.key,t,n.j_);throw Sr()})},$y.prototype.set=function(t,e,n){return e=Cv((t=zy(t,this.U_)).j_,e,n),n=fy(this.Qf,"Transaction.set",t.K_,e,null!==t.j_,n),this.Wf.set(t.K_,n),this},$y.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t=zy(t,this.U_),e instanceof Ll&&(e=e.o_),e="string"==typeof e||e instanceof Jp?py(this.Qf,"Transaction.update",t.K_,e,n,r):ly(this.Qf,"Transaction.update",t.K_,e),this.Wf.update(t.K_,e),this},$y.prototype.delete=function(t){return t=zy(t,this.U_),this.Wf.delete(t.K_),this},n(Jy,Ky=$y),Jy.prototype.get=function(t){var e=this,n=zy(t,this.U_),r=new pd(this.U_);return Ky.prototype.get.call(this,t).then(function(t){return new od(e.U_,r,n.K_,t.W_,new wv(!1,!1),n.j_)})},Jy),Hy=(Xy.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){nd(t);var n=Zy(t),r=t.S_();return ed(n,t=new Rl,new kl(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t.o_,{forceOwnership:e})},Xy.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){nd(t);var e=Zy(t),n=t.S_();return ed(e,t=new Rl,new Pl(t,n.cacheSizeBytes))}(t.o_)},Xy.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n.y_&&!n.V_)throw new Rr(Pr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new ea;return n.z_.Ni(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return wa.Gs()?(e=n+"main",[4,wa.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(Eh(n.R_,n.I_))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t.o_)},Xy),Qy=(n(Yy,Gy=Ll),Object.defineProperty(Yy.prototype,"R_",{get:function(){return this.o_.R_},enumerable:!1,configurable:!0}),Yy.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.o_.b_()),t)).merge,this.o_.v_(t)},Yy.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this.o_.b_().host&&Ar("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},Yy.prototype.enableNetwork=function(){return function(r){var t=this;return r.di.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Cy(r)];case 1:return e=t.sent(),[4,Vy(r)];case 2:return n=t.sent(),[2,(e.ec(!0),(t=n).Mu.delete(0),Qh(t))]}})})})}(Zy(this.o_))},Yy.prototype.disableNetwork=function(){return function(r){var t=this;return r.di.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Cy(r)];case 1:return e=t.sent(),[4,Vy(r)];case 2:return n=t.sent(),[2,(e.ec(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Mu.add(0),[4,Yh(e)];case 1:return t.sent(),e.Bu.set("Offline"),[2]}})})}(n))]}})})})}(Zy(this.o_))},Yy.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&rp("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.jf.enableMultiTabIndexedDbPersistence(this):this.jf.enableIndexedDbPersistence(this,n)},Yy.prototype.clearPersistence=function(){return this.jf.clearIndexedDbPersistence(this)},Yy.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this.o_._delete()},Yy.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new ea;return n.di.Ri(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Zf,[4,My(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Zy(this.o_))},Yy.prototype.onSnapshotsInSync=function(t){return function(t,e){var n=this,r=Zy(t),e=aa(e)?e:{next:e},i=new Cl(e);return t.z_.Ri(function(){return y(n,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Hu.add(e),e.next()},[4,Uy(r)];case 1:return e.apply(void 0,[t.sent(),i]),[2]}})})}),function(){i.r_(),t.z_.Ri(function(){return y(n,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Hu.delete(e)},[4,Uy(r)];case 1:return e.apply(void 0,[t.sent(),i]),[2]}})})})}}(this.o_,t)},Object.defineProperty(Yy.prototype,"app",{get:function(){if(!this.Gf)throw new Rr(Pr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Gf},enumerable:!1,configurable:!0}),Yy.prototype.collection=function(t){try{return new Nv(this,Hd(this.o_,t))}catch(t){throw hv(t,"collection()","Firestore.collection()")}},Yy.prototype.doc=function(t){try{return new sv(this,Qd(this.o_,t))}catch(t){throw hv(t,"doc()","Firestore.doc()")}},Yy.prototype.collectionGroup=function(t){try{return new Iv(this,function(t,e){if(ep("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Rr(Pr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new bd(t,null,new nu($r.X(),e))}(this.o_,t))}catch(t){throw hv(t,"collectionGroup()","Firestore.collectionGroup()")}},Yy.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new ea;return n.di.Ri(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,Ry(n).then(function(t){return t.Nu})];case 1:return e=t.sent(),new Ny(n.di,e,r,i).run(),[2]}})})}),i.promise}(Zy(n=this.o_),function(t){return t=new Wy(n,t),e(new iv(r,t))})},Yy.prototype.batch=function(){var e=this;return Zy(this.o_),new ov(new Fy(this.o_,function(t){return gd(e.o_,t)}))},Yy);function Yy(t,e,n){var r=this;return(r=Gy.call(this,e)||this).jf=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof gr||(r.Gf=t),r}function Xy(){}function Jy(t,e){var n=this;return(n=Ky.call(this,t,e)||this).U_=t,n}function $y(t,e){this.U_=t,this.Wf=e,this.Qf=ty(t)}function Zy(t){return t.H_||tv(t),t.H_.kf(),t.H_}function tv(t){var e,n,r=t.S_(),r=(e=t.R_,n=t.I_,new vr(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.H_=new Ay(t.P_,t.z_,r)}var ev,nv,rv,iv=(n(cv,rv=Ll),cv.prototype.get=function(t){var e=this,t=Rv(t);return this.o_.get(t).then(function(t){return new bv(e.U_,t)})},cv.prototype.set=function(t,e,n){return t=Rv(t),n?(np("Transaction.set",n),this.o_.set(t,e,n)):this.o_.set(t,e),this},cv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Rv(t);return 2===arguments.length?this.o_.update(o,e):(t=this.o_).update.apply(t,s([o,e,n],r)),this},cv.prototype.delete=function(t){return t=Rv(t),this.o_.delete(t),this},cv),ov=(n(av,nv=Ll),av.prototype.set=function(t,e,n){return t=Rv(t),n?(np("WriteBatch.set",n),this.o_.set(t,e,n)):this.o_.set(t,e),this},av.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Rv(t);return 2===arguments.length?this.o_.update(o,e):(t=this.o_).update.apply(t,s([o,e,n],r)),this},av.prototype.delete=function(t){return t=Rv(t),this.o_.delete(t),this},av.prototype.commit=function(){return this.o_.commit()},av),sv=(n(uv,ev=Ll),uv.zf=function(t,e,n){if(t.length%2!=0)throw new Rr(Pr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.J()+" has "+t.length);return new uv(e,new wd(e.o_,n,new ei(t)))},uv.q_=function(t,e,n){return new uv(e,new wd(e.o_,n,t))},Object.defineProperty(uv.prototype,"id",{get:function(){return this.o_.id},enumerable:!1,configurable:!0}),Object.defineProperty(uv.prototype,"parent",{get:function(){return new Nv(this.firestore,this.o_.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(uv.prototype,"path",{get:function(){return this.o_.path},enumerable:!1,configurable:!0}),uv.prototype.collection=function(t){try{return new Nv(this.firestore,Hd(this.o_,t))}catch(t){throw hv(t,"collection()","DocumentReference.collection()")}},uv.prototype.isEqual=function(t){return t instanceof Ll&&(t=t.o_),t instanceof wd&&$d(this.o_,t)},uv.prototype.set=function(t,e){e=np("DocumentReference.set",e);try{return n=this.o_,r=t,i=e,o=up(n.firestore,$p),r=Cv(n.j_,r,i),gd(o,fy(ty(o),"setDoc",n.K_,r,null!==n.j_,i).ef(n.K_,Es.on()))}catch(t){throw hv(t,"setDoc()","DocumentReference.set()")}var n,r,i,o},uv.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?yd(this.o_,t):yd.apply(void 0,s([this.o_,t,e],n))}catch(t){throw hv(t,"updateDoc()","DocumentReference.update()")}},uv.prototype.delete=function(){return gd(up((t=this.o_).firestore,$p),[new Bs(t.K_,Es.on())]);var t},uv.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=fv(t),i=lv(t,function(t){return new bv(e.firestore,new od(e.firestore.o_,e.Q_,t.K_,t.W_,t.metadata,e.o_.j_))});return vd(this.o_,r,i)},uv.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){var t=this,n=up(e.firestore,$p),r=Zy(n),i=new pd(n),o=new ea;return n.z_.Ri(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Ly(r)];case 1:return[4,function(i,o,s){return y(this,void 0,void 0,function(){var r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=o,(n=i).persistence.runTransaction("read document","readonly",function(t){return n.Oc.cs(t,e)}))];case 1:return(r=t.sent())instanceof Zs?s.resolve(r):r instanceof tu?s.resolve(null):s.reject(new Rr(Pr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=qa(r=t.sent(),"Failed to get document '"+o+" from cache"),s.reject(r),[3,3];case 3:return[2]}var e,n})})}(t.sent(),e.K_,o)];case 2:return t.sent(),[2]}})})}),o.promise.then(function(t){return new od(n,i,e.K_,t,new wv(t instanceof Zs&&t.an,!0),e.j_)})}:"server"===(null==t?void 0:t.source)?function(e){var t=this,n=up(e.firestore,$p),r=Zy(n),i=new ea;return n.z_.Ri(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Uy(r)];case 1:return[4,jy(t.sent(),n.z_,e.K_,{source:"server"},i)];case 2:return t.sent(),[2]}})})}),i.promise.then(function(t){return md(n,e,t)})}:function(e){var t=this,n=up(e.firestore,$p),r=Zy(n),i=new ea;return n.z_.Ri(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Uy(r)];case 1:return[4,jy(t.sent(),n.z_,e.K_,{source:"default"},i)];case 2:return t.sent(),[2]}})})}),i.promise.then(function(t){return md(n,e,t)})})(this.o_).then(function(t){return new bv(e.firestore,new od(e.firestore.o_,e.Q_,t.K_,t.W_,t.metadata,e.o_.j_))})},uv.prototype.withConverter=function(t){return new uv(this.firestore,this.o_.withConverter(t))},uv);function uv(t,e){var n=this;return(n=ev.call(this,e)||this).firestore=t,n.Q_=new Fp(t),n}function av(){return null!==nv&&nv.apply(this,arguments)||this}function cv(t,e){var n=this;return(n=rv.call(this,e)||this).U_=t,n}function hv(t,e,n){return t.message=t.message.replace(e,n),t}function fv(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!aa(r))return r}return{}}function lv(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=aa(t[0])?t[0]:aa(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var pv,dv,yv,vv,gv,mv,wv=(Pv.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Pv),bv=(n(kv,mv=Ll),Object.defineProperty(kv.prototype,"ref",{get:function(){return new sv(this.U_,this.o_.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(kv.prototype,"id",{get:function(){return this.o_.id},enumerable:!1,configurable:!0}),Object.defineProperty(kv.prototype,"metadata",{get:function(){return this.o_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(kv.prototype,"exists",{get:function(){return this.o_.exists()},enumerable:!1,configurable:!0}),kv.prototype.data=function(t){return this.o_.data(t)},kv.prototype.get=function(t,e){return this.o_.get(t,e)},kv.prototype.isEqual=function(t){return fd(this.o_,t.o_)},kv),_v=(n(xv,gv=bv),xv.prototype.data=function(t){return this.o_.data(t)},xv),Iv=(n(Dv,vv=Ll),Dv.prototype.where=function(t,e,n){try{return new Dv(this.firestore,Ed(this.o_,(r=n,i=e,o=Yp("where",t),new Dd(o,i,r))))}catch(t){throw hv(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},Dv.prototype.orderBy=function(n,t){try{return new Dv(this.firestore,Ed(this.o_,function(t){void 0===t&&(t="asc");var e=t,t=Yp("orderBy",n);return new xd(t,e)}(t)))}catch(n){throw hv(n,/(orderBy|where)\(\)/,"Query.$1()")}},Dv.prototype.limit=function(t){try{return new Dv(this.firestore,Ed(this.o_,(ap("limit",e=t),new kd("limit",e,"F"))))}catch(t){throw hv(t,"limit()","Query.limit()")}var e},Dv.prototype.limitToLast=function(t){try{return new Dv(this.firestore,Ed(this.o_,(ap("limitToLast",e=t),new kd("limitToLast",e,"L"))))}catch(t){throw hv(t,"limitToLast()","Query.limitToLast()")}var e},Dv.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Dv(this.firestore,Ed(this.o_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Pd("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw hv(t,"startAt()","Query.startAt()")}},Dv.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Dv(this.firestore,Ed(this.o_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Pd("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw hv(t,"startAfter()","Query.startAfter()")}},Dv.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Dv(this.firestore,Ed(this.o_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Rd("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw hv(t,"endBefore()","Query.endBefore()")}},Dv.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Dv(this.firestore,Ed(this.o_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Rd("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw hv(t,"endAt()","Query.endAt()")}},Dv.prototype.isEqual=function(t){return Zd(this.o_,t.o_)},Dv.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){var t=this,n=up(e.firestore,$p),r=Zy(n),i=new pd(n),o=new ea;return n.z_.Ri(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Ly(r)];case 1:return[4,function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,kh(r,i,!0)];case 1:return n=t.sent(),e=new Vf(i,n.Bc),n=e.gh(n.documents),n=e.Zn(n,!1),o.resolve(n.snapshot),[3,3];case 2:return n=qa(n=t.sent(),"Failed to execute query '"+i+" against cache"),o.reject(n),[3,3];case 3:return[2]}})})}(t.sent(),e.tf,o)];case 2:return t.sent(),[2]}})})}),o.promise.then(function(t){return new ud(n,i,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){var t=this,n=up(e.firestore,$p),r=Zy(n),i=new pd(n),o=new ea;return n.z_.Ri(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Uy(r)];case 1:return[4,qy(t.sent(),n.z_,e.tf,{source:"server"},o)];case 2:return t.sent(),[2]}})})}),o.promise.then(function(t){return new ud(n,i,e,t)})}:function(e){var t=this,n=up(e.firestore,$p),r=Zy(n),i=new pd(n);zd(e.tf);var o=new ea;return n.z_.Ri(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Uy(r)];case 1:return[4,qy(t.sent(),n.z_,e.tf,{source:"default"},o)];case 2:return t.sent(),[2]}})})}),o.promise.then(function(t){return new ud(n,i,e,t)})})(this.o_).then(function(t){return new Tv(e.firestore,t)})},Dv.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=fv(t),i=lv(t,function(t){return new Tv(e.firestore,t)});return vd(this.o_,r,i)},Dv.prototype.withConverter=function(t){return new Dv(this.firestore,this.o_.withConverter(t))},Dv),Ev=(n(Sv,yv=Ll),Object.defineProperty(Sv.prototype,"type",{get:function(){return this.o_.type},enumerable:!1,configurable:!0}),Object.defineProperty(Sv.prototype,"doc",{get:function(){return new _v(this.U_,this.o_.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Sv.prototype,"oldIndex",{get:function(){return this.o_.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Sv.prototype,"newIndex",{get:function(){return this.o_.newIndex},enumerable:!1,configurable:!0}),Sv),Tv=(n(Ov,dv=Ll),Object.defineProperty(Ov.prototype,"query",{get:function(){return new Iv(this.U_,this.o_.query)},enumerable:!1,configurable:!0}),Object.defineProperty(Ov.prototype,"metadata",{get:function(){return this.o_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Ov.prototype,"size",{get:function(){return this.o_.size},enumerable:!1,configurable:!0}),Object.defineProperty(Ov.prototype,"empty",{get:function(){return this.o_.empty},enumerable:!1,configurable:!0}),Object.defineProperty(Ov.prototype,"docs",{get:function(){var e=this;return this.o_.docs.map(function(t){return new _v(e.U_,t)})},enumerable:!1,configurable:!0}),Ov.prototype.docChanges=function(t){var e=this;return this.o_.docChanges(t).map(function(t){return new Ev(e.U_,t)})},Ov.prototype.forEach=function(e,n){var r=this;this.o_.forEach(function(t){e.call(n,new _v(r.U_,t))})},Ov.prototype.isEqual=function(t){return fd(this.o_,t.o_)},Ov),Nv=(n(Av,pv=Iv),Object.defineProperty(Av.prototype,"id",{get:function(){return this.o_.id},enumerable:!1,configurable:!0}),Object.defineProperty(Av.prototype,"path",{get:function(){return this.o_.path},enumerable:!1,configurable:!0}),Object.defineProperty(Av.prototype,"parent",{get:function(){var t=this.o_.parent;return t?new sv(this.firestore,t):null},enumerable:!1,configurable:!0}),Av.prototype.doc=function(t){try{return new sv(this.firestore,void 0===t?Qd(this.o_):Qd(this.o_,t))}catch(t){throw hv(t,"doc()","CollectionReference.doc()")}},Av.prototype.add=function(t){var e,n=this,r=this.o_,i=t;return t=up(r.firestore,$p),e=Qd(r),i=Cv(r.j_,i),gd(t,fy(ty(r.firestore),"addDoc",e.K_,i,null!==r.j_,{}).ef(e.K_,Es.exists(!1))).then(function(){return e}).then(function(t){return new sv(n.firestore,t)})},Av.prototype.isEqual=function(t){return $d(this.o_,t.o_)},Av.prototype.withConverter=function(t){return new Av(this.firestore,this.o_.withConverter(t))},Av);function Av(t,e){var n=this;return(n=pv.call(this,t,e)||this).firestore=t,n.o_=e,n}function Ov(t,e){var n=this;return(n=dv.call(this,e)||this).U_=t,n}function Sv(t,e){var n=this;return(n=yv.call(this,e)||this).U_=t,n}function Dv(t,e){var n=this;return(n=vv.call(this,e)||this).firestore=t,n}function xv(){return null!==gv&&gv.apply(this,arguments)||this}function kv(t,e){var n=this;return(n=mv.call(this,e)||this).U_=t,n}function Pv(t,e){this.hasPendingWrites=t,this.fromCache=e}function Rv(t){return t instanceof Ll&&(t=t.o_),up(t,wd)}function Cv(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Lv,Vv,ge=(n(Uv,Vv=Ll),Uv.documentId=function(){return new Uv(ti.et().J())},Uv.prototype.isEqual=function(t){return t instanceof Ll&&(t=t.o_),t instanceof Jp&&this.o_.G_.isEqual(t.G_)},Uv),h=(n(Mv,Lv=Ll),Mv.serverTimestamp=function(){var t=new mp("serverTimestamp");return t.c_="FieldValue.serverTimestamp",new Mv(t)},Mv.delete=function(){var t=new fp("deleteField");return t.c_="FieldValue.delete",new Mv(t)},Mv.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new wp("arrayUnion",t)}.apply(void 0,t);return n.c_="FieldValue.arrayUnion",new Mv(n)},Mv.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new bp("arrayRemove",t)}.apply(void 0,t);return n.c_="FieldValue.arrayRemove",new Mv(n)},Mv.increment=function(t){return(t=new _p("increment",t)).c_="FieldValue.increment",new Mv(t)},Mv.prototype.isEqual=function(t){return this.o_.isEqual(t.o_)},Mv),h={Firestore:Qy,GeoPoint:Ip,Timestamp:Xr,Blob:qp,Transaction:iv,WriteBatch:ov,DocumentReference:sv,DocumentSnapshot:bv,Query:Iv,QueryDocumentSnapshot:_v,QuerySnapshot:Tv,CollectionReference:Nv,FieldPath:ge,FieldValue:h,setLogLevel:function(t){Ir.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function Mv(){return null!==Lv&&Lv.apply(this,arguments)||this}function Uv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Vv.call(this,new(Jp.bind.apply(Jp,s([void 0],t))))||this}(e=e.default).INTERNAL.registerComponent(new N("firestore",function(t){return e=t.getProvider("app").getImmediate(),t=t.getProvider("auth-internal"),new Qy(e,new $p(e,t),new Hy);var e},"PUBLIC").setServiceProps(Object.assign({},h))),e.registerVersion("@firebase/firestore","2.0.3-202010180421")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});