!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(fv){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(fv),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var f,i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function o(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(_e=f=f||{})[_e.DEBUG=0]="DEBUG",_e[_e.VERBOSE=1]="VERBOSE",_e[_e.INFO=2]="INFO",_e[_e.WARN=3]="WARN",_e[_e.ERROR=4]="ERROR",_e[_e.SILENT=5]="SILENT";function u(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=h[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var a={debug:f.DEBUG,verbose:f.VERBOSE,info:f.INFO,warn:f.WARN,error:f.ERROR,silent:f.SILENT},c=f.INFO,h=((Te={})[f.DEBUG]="log",Te[f.VERBOSE]="log",Te[f.INFO]="info",Te[f.WARN]="warn",Te[f.ERROR]="error",Te),l=(Object.defineProperty(p.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in f))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),p.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?a[t]:t},Object.defineProperty(p.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),p.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.DEBUG],t)),this._logHandler.apply(this,s([this,f.DEBUG],t))},p.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.VERBOSE],t)),this._logHandler.apply(this,s([this,f.VERBOSE],t))},p.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.INFO],t)),this._logHandler.apply(this,s([this,f.INFO],t))},p.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.WARN],t)),this._logHandler.apply(this,s([this,f.WARN],t))},p.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.ERROR],t)),this._logHandler.apply(this,s([this,f.ERROR],t))},p);function p(t){this.name=t,this._logLevel=c,this._logHandler=u,this._userLogHandler=null}function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var g,m="FirebaseError",w=(n(b,g=Error),b);function b(t,e,n){e=g.call(this,e)||this;return e.code=t,e.customData=n,e.name=m,Object.setPrototypeOf(e,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,I.prototype.create),e}var I=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(_,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new w(o,t,i)},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var _=/\{\$([^}]+)}/g,T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S={},O=D||self;function x(){}function P(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function k(t){var e=P(t);return"array"==e||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),V=0;function C(t,e,n){return t.call.apply(t.bind,arguments)}function U(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?C:U).apply(null,arguments)}function M(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var F=Date.now;function j(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t}function B(){this.j=this.j,this.i=this.i}B.prototype.j=!1,B.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,R)&&t[R]||(t[R]=++V))},B.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function K(){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var J,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var $=O.navigator;if($){$=$.userAgent;if($){J=$;break t}}J=""}function Z(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function tt(t){var e,n={};for(e in t)n[e]=t[e];return n}var et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nt(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<et.length;i++)e=et[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function rt(t){return rt[" "](t),t}rt[" "]=x;var it,ot=Y(J,"Opera"),st=Y(J,"Trident")||Y(J,"MSIE"),ut=Y(J,"Edge"),at=ut||st,ct=Y(J,"Gecko")&&!(Y(J.toLowerCase(),"webkit")&&!Y(J,"Edge"))&&!(Y(J,"Trident")||Y(J,"MSIE"))&&!Y(J,"Edge"),ht=Y(J.toLowerCase(),"webkit")&&!Y(J,"Edge");function lt(){var t=O.document;return t?t.documentMode:void 0}t:{var ft="",pt=(pt=J,ct?/rv:([^\);]+)(\)|;)/.exec(pt):ut?/Edge\/([\d\.]+)/.exec(pt):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(pt):ht?/WebKit\/(\S+)/.exec(pt):ot?/(?:Version)[ \/]?(\S+)/.exec(pt):void 0);if(pt&&(ft=pt?pt[1]:""),st){pt=lt();if(null!=pt&&pt>parseFloat(ft)){it=String(pt);break t}}it=ft}var dt={};function yt(u){return t=u,e=function(){for(var t=0,e=Q(String(it)).split("."),n=Q(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=dt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var vt=O.document&&st?lt()||(parseInt(it,10)||void 0):void 0,gt=!st||9<=Number(vt),mt=st&&!yt("9"),wt=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{O.addEventListener("test",x,e),O.removeEventListener("test",x,e)}catch(t){}return t}();function bt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function It(t,e){if(bt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ct){t:{try{rt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Et[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}bt.prototype.b=function(){this.defaultPrevented=!0},j(It,bt);var Et={2:"touch",3:"pen",4:"mouse"};It.prototype.b=function(){It.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,mt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var _t="closure_listenable_"+(1e6*Math.random()|0),Tt=0;function At(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Tt,this.Y=this.Z=!1}function Nt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Dt(t){this.src=t,this.a={},this.b=0}function St(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=G(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(Nt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Ot(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Dt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Ot(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new At(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var xt="closure_lm_"+(1e6*Math.random()|0),Pt={};function kt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Ft(r);return e&&e[_t]?e.wa(n,r,L(i)?!!i.capture:!!i,o):Lt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)kt(t,e[o],n,r,i);return null}return n=Ft(n),t&&t[_t]?t.va(e,n,L(r)?!!r.capture:!!r,i):Lt(t,e,n,!1,r,i)}function Lt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=L(i)?!!i.capture:!!i;if(s&&!gt)return null;var u,a,c=qt(t);if(c||(t[xt]=c=new Dt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=Ut,r=a=gt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)wt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Rt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[_t]?St(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=qt(e))?(St(n,t),0==n.b&&(n.src=null,e[xt]=null)):Nt(t)))}function Vt(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function Ct(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Rt(t),n.call(r,e)}function Ut(t,e){if(t.Y)return!0;if(gt)return Ct(t,new It(e,this));if(!e)t:{e=["window","event"];for(var n=O,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ct(t,e=new It(e,this))}function qt(t){return(t=t[xt])instanceof Dt?t:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(e){return"function"==P(e)?e:(e[Mt]||(e[Mt]=function(t){return e.handleEvent(t)}),e[Mt])}function jt(){B.call(this),this.c=new Dt(this),(this.J=this).C=null}function Bt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new bt(e,t):e instanceof bt?e.target=e.target||t:(s=e,nt(e=new bt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Gt(o,r,!0,e)&&s;if(s=Gt(o=e.a=t,r,!0,e)&&s,s=Gt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Gt(o=e.a=n[i],r,!1,e)&&s}function Gt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&St(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}j(jt,B),jt.prototype[_t]=!0,(N=jt.prototype).addEventListener=function(t,e,n,r){kt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=L(i)?!!i.capture:!!i,r=Ft(r),e&&e[_t]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Ot(s=e.a[n],r,i,o))&&(Nt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&qt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Ot(n,r,i,o)),(r=-1<e?n[e]:null)&&Rt(r))}(this,t,e,n,r)},N.G=function(){if(jt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Nt(n[r]);delete e.a[t],e.b--}}this.C=null},N.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var zt=O.JSON.stringify;function Kt(){this.b=this.a=null}var Ht,Wt=(Jt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Jt(function(){return new Qt},function(t){t.reset()},100));function Jt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Qt(){this.next=this.b=this.a=null}function Yt(t,e){var n;Ht||(n=O.Promise.resolve(void 0),Ht=function(){n.then(Zt)}),Xt||(Ht(),Xt=!0),$t.add(t,e)}Kt.prototype.add=function(t,e){var n=Wt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Qt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Xt=!(Qt.prototype.reset=function(){this.next=this.b=this.a=null}),$t=new Kt;function Zt(){for(var t,e;n=e=void 0,n=null,(e=$t).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){O.setTimeout(function(){throw t},0)}(t)}var n=Wt;n.g(t),n.b<n.f&&(n.b++,t.next=n.a,n.a=t)}Xt=!1}function te(t,e){jt.call(this),this.b=t||1,this.a=e||O,this.f=q(this.Xa,this),this.g=F()}function ee(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ne(t,e,n){if("function"==P(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:O.setTimeout(t,e||0)}j(te,jt),(N=te.prototype).aa=!1,N.M=null,N.Xa=function(){var t;this.aa&&(0<(t=F()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Bt(this,"tick"),this.aa&&(ee(this),this.start())))},N.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=F())},N.G=function(){te.X.G.call(this),ee(this),delete this.a};var re,ie,oe,se=(T(ie=ae,oe=re=B),ie.prototype=null===oe?Object.create(oe):(ue.prototype=oe.prototype,new ue),ae.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=ne(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},ae.prototype.G=function(){re.prototype.G.call(this),this.a&&(O.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},ae);function ue(){this.constructor=ie}function ae(t,e,n){var r=re.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function ce(t){B.call(this),this.b=t,this.a={}}j(ce,B);var he=[];function le(t,e,n,r){Array.isArray(n)||(n&&(he[0]=n.toString()),n=he);for(var i=0;i<n.length;i++){var o=kt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function fe(t){Z(t.a,function(t,e){this.a.hasOwnProperty(e)&&Rt(t)},t),t.a={}}function pe(){this.a=!0}function de(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return zt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ce.prototype.G=function(){ce.X.G.call(this),fe(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},pe.prototype.info=function(){};var ye=null;function ve(){return ye=ye||new jt}function ge(t){bt.call(this,"serverreachability",t)}function me(t){var e=ve();Bt(e,new ge(e))}function we(t){bt.call(this,"statevent",t)}function be(t){var e=ve();Bt(e,new we(e))}function Ie(t){bt.call(this,"timingevent",t)}function Ee(t,e){if("function"!=P(t))throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){t()},e)}j(ge,bt),j(we,bt),j(Ie,bt);var _e={NO_ERROR:0,Ya:1,fb:2,eb:3,ab:4,cb:5,gb:6,Da:7,TIMEOUT:8,jb:9},Te={$a:"complete",nb:"success",Ea:"error",Da:"abort",lb:"ready",mb:"readystatechange",TIMEOUT:"timeout",hb:"incrementaldata",kb:"progress",bb:"downloadprogress",ob:"uploadprogress"};function Ae(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function De(){}Ae.prototype.a=null;var Se,D={OPEN:"a",Za:"b",Ea:"c",ib:"d"};function Oe(){bt.call(this,"d")}function xe(){bt.call(this,"c")}function Pe(){}function ke(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ce(this),this.P=Le,t=at?125:void 0,this.R=new te(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}j(Oe,bt),j(xe,bt),j(Pe,Ae),Se=new Pe;var Le=45e3,Re={},Ve={};function Ce(t,e,n){t.H=1,t.i=rn(Xe(e)),t.j=n,t.I=!0,Ue(t,null)}function Ue(t,e){t.u=F(),Me(t),t.l=Xe(t.i);var s,u,a,c,h,l,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),gn(n.b,"t",r),t.D=0,t.a=hr(t.g,t.g.C?e:null),0<t.O&&(t.F=new se(q(t.Ca,t,t.a),t.O)),le(t.J,t.a,"readystatechange",t.Va),e=t.B?tt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),me(1),s=t.c,u=t.m,a=t.l,c=t.f,h=t.S,l=t.j,s.info(function(){if(s.a)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function qe(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var u=(u=n,o=i=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?Ve:(i=Number(u.substring(i,o)),isNaN(i)?Re:(o+=1)+i>u.length?Ve:(u=u.substr(o,i),r.D=o+i,u)));if(u==Ve){4==e&&(t.h=4,be(14),s=!1),de(t.c,t.f,null,"[Incomplete Response]");break}if(u==Re){t.h=4,be(15),de(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}de(t.c,t.f,u,null),ze(t,u)}4==e&&0==n.length&&(t.h=1,be(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),nr(e),e.F=!0,be(11))):(de(t.c,t.f,n,"[Invalid Chunked Response]"),Ge(t),Be(t))}function Me(t){t.T=F()+t.P,Fe(t,t.P)}function Fe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ee(q(t.Ta,t),e)}function je(t){t.o&&(O.clearTimeout(t.o),t.o=null)}function Be(t){0==t.g.v||t.A||or(t.g,t)}function Ge(t){je(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ee(t.R),fe(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function ze(t,e){try{var n,r,i,o,s,u=t.g;if(0!=u.v&&(u.a==t||Tn(u.b,t)))if(u.I=t.N,!t.C&&Tn(u.b,t)&&3==u.v){try{var a=u.ka.a.parse(e)}catch(t){a=null}if(Array.isArray(a)&&3==a.length){var c=a;if(0==c[0]){t:if(!u.j){if(u.a){if(!(u.a.u+3e3<t.u))break t;ir(u),Wn(u)}er(u),be(18)}}else u.oa=c[1],0<u.oa-u.P&&c[2]<37500&&u.H&&0==u.o&&!u.m&&(u.m=Ee(q(u.Qa,u),6e3));if(_n(u.b)<=1&&u.ea){try{u.ea()}catch(t){}u.ea=void 0}}else ur(u,11)}else if(!t.C&&u.a!=t||ir(u),!W(e))for(e=a=u.ka.a.parse(e),a=0;a<e.length;a++){c=e[a],u.P=c[0],c=c[1],2==u.v?"c"==c[0]?(u.J=c[1],u.ga=c[2],null!=(r=c[3])&&(u.ha=r,u.c.info("VER="+u.ha)),null!=(o=c[4])&&(u.pa=o,u.c.info("SVER="+u.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,u.D=n,u.c.info("backChannelRequestTimeoutMs_="+n)),n=u,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(Y(r,"spdy")||Y(r,"quic")||Y(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(An(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,nn(n.B,n.A,s))),u.v=3,u.f&&u.f.ta(),u.U&&(u.N=F()-t.u,u.c.info("Handshake RTT: "+u.N+"ms")),i=t,(n=u).la=cr(n,n.C?n.ga:null,n.fa),i.C?(Nn(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(je(o),Me(o)),n.a=i):tr(n),0<u.g.length&&Yn(u)):"stop"!=c[0]&&"close"!=c[0]||ur(u,7):3==u.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?ur(u,7):Hn(u):"noop"!=c[0]&&u.f&&u.f.sa(c),u.o=0)}me(4)}catch(t){}}function Ke(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(k(t)||"string"==typeof t)z(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(k(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(k(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function He(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof He)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function We(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Je(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Je(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=ke.prototype).setTimeout=function(t){this.P=t},N.Va=function(t){t=t.target;var e=this.F;e&&3==Bn(t)?e.f():this.Ca(t)},N.Ca=function(t){try{if(t==this.a)t:{var e=Bn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!at&&!this.a.$())){this.A||4!=e||7==n||me(8==n||r<=0?3:2),je(this);var i=this.a.W();this.N=i;n=this.a.$();if(this.b=200==i,r=this.c,u=this.m,a=this.l,c=this.f,h=this.S,l=e,f=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+u+"\n"+a+"\n"+l+" "+f}),this.b){if(this.U&&!this.C){e:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.h=3,be(12),Ge(this),Be(this);break t}de(this.c,this.f,s,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,ze(this,s)}this.I?(qe(this,e,n),at&&this.b&&3==e&&(le(this.J,this.R,"tick",this.Ua),this.R.start())):(de(this.c,this.f,n,null),ze(this,n)),4==e&&Ge(this),this.b&&!this.A&&(4==e?or(this.g,this):(this.b=!1,Me(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,be(12)):(this.h=0,be(13)),Ge(this),Be(this)}}}catch(t){}var u,a,c,h,l,f},N.Ua=function(){var t,e;this.a&&(t=Bn(this.a),e=this.a.$(),this.D<e.length&&(je(this),qe(this,t,e),this.b&&4!=t&&Me(this)))},N.cancel=function(){this.A=!0,Ge(this)},N.Ta=function(){this.o=null;var t,e,n=F();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(me(3),be(17)),Ge(this),this.h=2,Be(this)):Fe(this,this.T-n)},(N=He.prototype).K=function(){We(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.L=function(){return We(this),this.a.concat()},N.get=function(t,e){return Je(this.b,t)?this.b[t]:e},N.set=function(t,e){Je(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye?(this.a=void 0!==e?e:t.a,$e(this,t.f),this.j=t.j,Ze(this,t.c),tn(this,t.h),this.g=t.g,e=t.b,(n=new pn).c=e.c,e.a&&(n.a=new He(e.a),n.b=e.b),en(this,n),this.i=t.i):t&&(n=String(t).match(Qe))?(this.a=!!e,$e(this,n[1]||"",!0),this.j=on(n[2]||""),Ze(this,n[3]||"",!0),tn(this,n[4]),this.g=on(n[5]||"",!0),en(this,n[6]||"",!0),this.i=on(n[7]||"")):(this.a=!!e,this.b=new pn(null,this.a))}function Xe(t){return new Ye(t)}function $e(t,e,n){t.f=n?on(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ze(t,e,n){t.c=n?on(e,!0):e}function tn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function en(t,e,n){var r,i;e instanceof pn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(dn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(yn(this,e),gn(this,n,t))},r)),r.f=i):(n||(e=sn(e,ln)),t.b=new pn(e,t.a))}function nn(t,e,n){t.b.set(e,n)}function rn(t){return nn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^F()).toString(36)),t}function on(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function sn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,un),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function un(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(sn(e,an,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(sn(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(sn(n,"/"==n.charAt(0)?hn:cn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",sn(n,fn)),t.join("")};var an=/[#\/\?@]/g,cn=/[#\?:]/g,hn=/[#\?]/g,ln=/[#\?@]/g,fn=/#/g;function pn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function dn(n){n.a||(n.a=new He,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function yn(t,e){dn(t),e=mn(t,e),Je(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Je((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&We(t)))}function vn(t,e){return dn(t),e=mn(t,e),Je(t.a.b,e)}function gn(t,e,n){yn(t,e),0<n.length&&(t.c=null,t.a.set(mn(t,e),H(n)),t.b+=n.length)}function mn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function wn(t,e){this.b=t,this.a=e}function bn(t){this.g=t||In,t=O.PerformanceNavigationTiming?0<(t=O.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(O.ia&&O.ia.ya&&O.ia.ya()&&O.ia.ya().pb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=pn.prototype).add=function(t,e){dn(this),this.c=null,t=mn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){dn(this),this.a.forEach(function(t,e){z(t,function(t){n.call(r,t,e,this)},this)},this)},N.L=function(){dn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.K=function(t){dn(this);var e=[];if("string"==typeof t)vn(this,t)&&(e=K(e,this.a.get(mn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=K(e,t[n])}return e},N.set=function(t,e){return dn(this),this.c=null,vn(this,t=mn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var In=10;function En(t){return t.b||t.a&&t.a.size>=t.f}function _n(t){return t.b?1:t.a?t.a.size:0}function Tn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function An(t,e){t.a?t.a.add(e):t.b=e}function Nn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Dn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return H(t.c);var r=t.c;try{for(var i=A(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Sn(){}function On(){this.a=new Sn}function xn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}bn.prototype.cancel=function(){var e,t;if(this.c=Dn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=A(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Sn.prototype.stringify=function(t){return O.JSON.stringify(t,void 0)},Sn.prototype.parse=function(t){return O.JSON.parse(t,void 0)};var Pn=O.JSON.parse;function kn(t){jt.call(this),this.headers=new He,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Ln,this.D=this.F=!1}j(kn,jt);var Ln="",Rn=/^https?$/i,Vn=["POST","PUT"];function Cn(t){return"content-type"==t.toLowerCase()}function Un(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,qn(t),Fn(t)}function qn(t){t.u||(t.u=!0,Bt(t,"complete"),Bt(t,"error"))}function Mn(t){if(t.b&&void 0!==S&&(!t.s[1]||4!=Bn(t)||2!=t.W()))if(t.l&&4==Bn(t))ne(t.za,0,t);else if(Bt(t,"readystatechange"),4==Bn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(Qe)[1]||null)&&O.self&&O.self.location&&(i=(r=O.self.location.protocol).substr(0,r.length-1)),n=!Rn.test(i?i.toLowerCase():"")),e=n),e)Bt(t,"complete"),Bt(t,"success");else{t.h=6;try{var u=2<Bn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.W()+"]",qn(t)}}finally{Fn(t)}}}function Fn(t,e){if(t.a){jn(t);var n=t.a,r=t.s[0]?x:null;t.a=null,t.s=null,e||Bt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function jn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(O.clearTimeout(t.m),t.m=null)}function Bn(t){return t.a?t.a.readyState:0}function Gn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Z(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):nn(t,e,n))}function zn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Kn(t){this.pa=0,this.g=[],this.c=new pe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Ma=this.R=0,this.Ja=zn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Fa=zn("baseRetryDelayMs",5e3,t),this.Pa=zn("retryDelaySeedMs",1e4,t),this.Ka=zn("forwardChannelMaxRetries",2,t),this.ma=zn("forwardChannelRequestTimeoutMs",2e4,t),this.La=t&&t.h||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new bn(t&&t.concurrentRequestLimit),this.ka=new On,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.g&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ia=t&&t.f||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Hn(t){var e,n;Jn(t),3==t.v&&(e=t.R++,nn(n=Xe(t.B),"SID",t.J),nn(n,"RID",e),nn(n,"TYPE","terminate"),$n(t,n),(e=new ke(t,t.c,e,void 0)).H=2,e.i=rn(Xe(n)),n=!1,O.navigator&&O.navigator.sendBeacon&&(n=O.navigator.sendBeacon(e.i.toString(),"")),!n&&O.Image&&((new Image).src=e.i,n=!0),n||(e.a=hr(e.g,null),e.a.ba(e.i)),e.u=F(),Me(e)),ar(t)}function Wn(t){t.a&&(nr(t),t.a.cancel(),t.a=null)}function Jn(t){Wn(t),t.j&&(O.clearTimeout(t.j),t.j=null),ir(t),t.b.cancel(),t.h&&("number"==typeof t.h&&O.clearTimeout(t.h),t.h=null)}function Qn(t,e){t.g.push(new wn(t.Ma++,e)),3==t.v&&Yn(t)}function Yn(t){En(t.b)||t.h||(t.h=!0,Yt(t.Ba,t),t.u=0)}function Xn(t,e){var n=e?e.f:t.R++,r=Xe(t.B);nn(r,"SID",t.J),nn(r,"RID",n),nn(r,"AID",t.P),$n(t,r),t.i&&t.l&&Gn(r,t.i,t.l),n=new ke(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),An(t.b,n),Ce(n,r,e)}function $n(t,n){t.f&&Ke({},function(t,e){nn(n,e,t)})}function Zn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?q(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{Ke(t,function(t,e){var n=t;L(t)&&(n=zt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function tr(t){t.a||t.j||(t.T=1,Yt(t.Aa,t),t.o=0)}function er(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=Ee(q(t.Aa,t),sr(t,t.o)),t.o++,1)}function nr(t){null!=t.s&&(O.clearTimeout(t.s),t.s=null)}function rr(t){t.a=new ke(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Xe(t.la);nn(e,"RID","rpc"),nn(e,"SID",t.J),nn(e,"CI",t.H?"0":"1"),nn(e,"AID",t.P),$n(t,e),nn(e,"TYPE","xmlhttp"),t.i&&t.l&&Gn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=rn(Xe(e)),n.j=null,n.I=!0,Ue(n,t)}function ir(t){null!=t.m&&(O.clearTimeout(t.m),t.m=null)}function or(t,e){var n,r=null;if(t.a==e){ir(t),nr(t),t.a=null;var i=2}else{if(!Tn(t.b,e))return;r=e.s,Nn(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=F()-e.u,n=t.u,Bt(i=ve(),new Ie(i)),Yn(t)):tr(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(_n(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ja?0:t.Ka)))return t.h=Ee(q(t.Ba,t,e),sr(t,t.u)),t.u++,1}}(t,e)||2==i&&er(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:ur(t,5);break;case 4:ur(t,10);break;case 3:ur(t,6);break;default:ur(t,2)}}function sr(t,e){var n=t.Fa+Math.floor(Math.random()*t.Pa);return t.f||(n*=2),n*e}function ur(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=q(t.Wa,t),r||(r=new Ye("//www.google.com/images/cleardot.gif"),O.location&&"http"==O.location.protocol||$e(r,"https"),rn(r)),n=r.toString(),r=o,o=new pe,O.Image?((i=new Image).onload=M(xn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=M(xn,o,i,"TestLoadImage: error",!1,r),i.onabort=M(xn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=M(xn,o,i,"TestLoadImage: timeout",!1,r),O.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):be(2),t.v=0,t.f&&t.f.ra(e),ar(t),Jn(t)}function ar(t){t.v=0,t.I=-1,t.f&&(0==Dn(t.b).length&&0==t.g.length||(t.b.c.length=0,H(t.g),t.g.length=0),t.f.qa())}function cr(t,e,n){var r,i,o,s,u,a=(s=n)instanceof Ye?Xe(s):new Ye(s,void 0);return""!=a.c?(e&&Ze(a,e+"."+a.c),tn(a,a.h)):(u=O.location,r=u.protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new Ye(null,void 0),r&&$e(u,r),i&&Ze(u,i),o&&tn(u,o),s&&(u.g=s),a=u),t.V&&Z(t.V,function(t,e){nn(a,e,t)}),e=t.A,n=t.na,e&&n&&nn(a,e,n),nn(a,"VER",t.ha),$n(t,a),a}function hr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new kn(t.La)).F=t.C,e}function lr(){}function fr(){if(st&&!(10<=Number(vt)))throw Error("Environmental error: no available transport.")}function pr(t,e){jt.call(this),this.a=new Kn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new vr(this)}function dr(t){Oe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function yr(){xe.call(this),this.status=1}function vr(t){this.a=t}(N=kn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ne(this.H):Ne(Se),this.a.onreadystatechange=q(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Un(this,t)}t=n||"";var i,o=new He(this.headers);r&&Ke(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Cn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=O.FormData&&t instanceof O.FormData,0<=G(Vn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{jn(this),0<this.o&&((this.D=(i=this.a,st&&yt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=q(this.xa,this)):this.m=ne(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Un(this,t)}},N.xa=function(){void 0!==S&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Bt(this,"timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Bt(this,"complete"),Bt(this,"abort"),Fn(this))},N.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Fn(this,!0)),kn.X.G.call(this)},N.za=function(){this.j||(this.A||this.l||this.g?Mn(this):this.Sa())},N.Sa=function(){Mn(this)},N.W=function(){try{return 2<Bn(this)?this.a.status:-1}catch(t){return-1}},N.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Pn(e)}},N.ua=function(){return this.h},N.Oa=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Kn.prototype).ha=8,N.v=1,N.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ke(this,this.c,t,void 0),r=this.l;if(this.O&&(r?nt(r=tt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zn(this,n,e),nn(i=Xe(this.B),"RID",t),nn(i,"CVER",22),this.A&&nn(i,"X-HTTP-Session-Id",this.A),$n(this,i),this.i&&r&&Gn(i,this.i,r),An(this.b,n),this.Ga&&nn(i,"TYPE","init"),this.da?(nn(i,"$req",e),nn(i,"SID","null"),n.U=!0,Ce(n,i,null)):Ce(n,i,e),this.v=2}}else 3==this.v&&(t?Xn(this,t):0==this.g.length||En(this.b)||Xn(this))},N.Aa=function(){var t;this.j=null,rr(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ee(q(this.Ra,this),t))},N.Ra=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,be(10),Wn(this),rr(this))},N.Qa=function(){null!=this.m&&(this.m=null,Wn(this),er(this),be(19))},N.Wa=function(t){t?(this.c.info("Successfully pinged google.com"),be(2)):(this.c.info("Failed to ping google.com"),be(1))},(N=lr.prototype).ta=function(){},N.sa=function(){},N.ra=function(){},N.qa=function(){},N.Ha=function(){},fr.prototype.a=function(t,e){return new pr(t,e)},j(pr,jt),pr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;be(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=cr(t,null,t.fa),Yn(t)},pr.prototype.close=function(){Hn(this.a)},pr.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,Qn(this.a,e)):this.l?((e={}).__data__=zt(t),Qn(this.a,e)):Qn(this.a,t)},pr.prototype.G=function(){this.a.f=null,delete this.f,Hn(this.a),delete this.a,pr.X.G.call(this)},j(dr,Oe),j(yr,xe),j(vr,lr),vr.prototype.ta=function(){Bt(this.a,"a")},vr.prototype.sa=function(t){Bt(this.a,new dr(t))},vr.prototype.ra=function(t){Bt(this.a,new yr)},vr.prototype.qa=function(){Bt(this.a,"b")},fr.prototype.createWebChannel=fr.prototype.a,pr.prototype.send=pr.prototype.h,pr.prototype.open=pr.prototype.g,_e.NO_ERROR=0,_e.TIMEOUT=8,_e.HTTP_ERROR=6,Te.COMPLETE="complete",(De.EventType=D).OPEN="a",D.CLOSE="b",D.ERROR="c",D.MESSAGE="d",jt.prototype.listen=jt.prototype.va,kn.prototype.listenOnce=kn.prototype.wa,kn.prototype.getLastError=kn.prototype.Oa,kn.prototype.getLastErrorCode=kn.prototype.ua,kn.prototype.getStatus=kn.prototype.W,kn.prototype.getResponseJson=kn.prototype.Na,kn.prototype.getResponseText=kn.prototype.$,kn.prototype.send=kn.prototype.ba;var gr=_e,mr=Te,wr=De,br=kn,Ir=(Er.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Er.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Er.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Er);function Er(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var _r=(Tr.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(t){if(function(t){t=t.getComponent();return"VERSION"===(null==t?void 0:t.type)}(t)){t=t.getImmediate();return t.library+"/"+t.version}return null}).filter(function(t){return t}).join(" ")},Tr);function Tr(t){this.container=t}var Ar="@firebase/app-exp",Nr=new l("@firebase/app"),Dr="[DEFAULT]",Sr=((_e={})[Ar]="fire-core",_e["@firebase/app-compat"]="fire-core-compat",_e["@firebase/analytics"]="fire-analytics",_e["@firebase/auth"]="fire-auth",_e["@firebase/database"]="fire-rtdb",_e["@firebase/functions-exp"]="fire-fn",_e["@firebase/functions-compat"]="fire-fn-compat",_e["@firebase/installations"]="fire-iid",_e["@firebase/messaging"]="fire-fcm",_e["@firebase/performance"]="fire-perf",_e["@firebase/remote-config"]="fire-rc",_e["@firebase/storage"]="fire-gcs",_e["@firebase/firestore"]="fire-fst",_e["fire-js"]="fire-js",_e["firebase-exp"]="fire-js-all",_e),Or=new Map,xr=new Map;function Pr(t){var e,n,r=t.name;if(!xr.has(r)){xr.set(r,t);try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Or.values()),o=i.next();!o.done;o=i.next()){!function(e,n){try{e.container.addComponent(n)}catch(t){Nr.debug("Component "+n.name+" failed to register with FirebaseApp "+e.name,t)}}(o.value,t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return 1}Nr.debug("There were multiple attempts to register component "+r+".")}var kr,_e=((Te={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Te["bad-app-name"]="Illegal App name: '{$appName}",Te["duplicate-app"]="Firebase App named '{$appName}' already exists",Te["app-deleted"]="Firebase App named '{$appName}' already deleted",Te["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Te["invalid-log-argument"]="First argument to `onLog` must be null or a function.",Te),Lr=new I("app","Firebase",_e);Object.defineProperty(Rr.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(Rr.prototype,"name",{get:function(){return this.checkDestroyed(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(Rr.prototype,"options",{get:function(){return this.checkDestroyed(),this.options_},enumerable:!1,configurable:!0}),Rr.prototype.checkDestroyed=function(){if(this.isDeleted)throw Lr.create("app-deleted",{appName:this.name_})};function Rr(t,e,n){var r=this;this.isDeleted=!1,this.options_=i({},t),this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled,this.container=n,this.container.addComponent(new Ir("app-exp",function(){return r},"PUBLIC"))}function Vr(t,e,n){var r=null!==(i=Sr[t])&&void 0!==i?i:t;n&&(r+="-"+n);var i=r.match(/\s|\//),t=e.match(/\s|\//);if(i||t){n=['Unable to register library "'+r+'" with version "'+e+'":'];return i&&n.push('library name "'+r+'" contains illegal characters (whitespace or "/")'),i&&t&&n.push("and"),t&&n.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void Nr.warn(n.join(" "))}Pr(new Ir(r+"-version",function(){return{library:r,version:e}},"VERSION"))}Pr(new Ir("platform-logger",function(t){return new _r(t)},"PRIVATE")),Vr(Ar,"0.0.800",kr),Vr("fire-js","");var Cr,Ur={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},qr=(n(jr,Cr=Error),jr),Mr="8.0.2-20201010222127",Fr=new l("@firebase/firestore");function jr(t,e){var n=this;return(n=Cr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Br(){return Fr.logLevel}function Gr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Fr.logLevel<=f.DEBUG&&(e=n.map(Hr),Fr.debug.apply(Fr,o(["Firestore ("+Mr+"): "+t],e)))}function zr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Fr.logLevel<=f.ERROR&&(e=n.map(Hr),Fr.error.apply(Fr,o(["Firestore ("+Mr+"): "+t],e)))}function Kr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Fr.logLevel<=f.WARN&&(e=n.map(Hr),Fr.warn.apply(Fr,o(["Firestore ("+Mr+"): "+t],e)))}function Hr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Wr(t){void 0===t&&(t="Unexpected state");t="FIRESTORE ("+Mr+") INTERNAL ASSERTION FAILED: "+t;throw zr(t),new Error(t)}function Jr(t){t||Wr()}var Qr=(Yr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Yr);function Yr(){}function Xr(t,e){return t<e?-1:e<t?1:0}function $r(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Zr(t){return t+"\0"}var ti=(ei.fromBase64String=function(t){return new ei(atob(t))},ei.fromUint8Array=function(t){return new ei(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ei.prototype.toBase64=function(){return t=this.i,btoa(t);var t},ei.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},ei.prototype.o=function(){return 2*this.i.length},ei.prototype.u=function(t){return Xr(this.i,t.i)},ei.prototype.isEqual=function(t){return this.i===t.i},ei);function ei(t){this.i=t}ti.h=new ti("");var ni=(ri.fromBase64String=function(t){try{return new ri(ti.fromBase64String(t))}catch(t){throw new qr(Ur.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},ri.fromUint8Array=function(t){return new ri(ti.fromUint8Array(t))},ri.prototype.toBase64=function(){return this.l.toBase64()},ri.prototype.toUint8Array=function(){return this.l.toUint8Array()},ri.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},ri.prototype.isEqual=function(t){return this.l.isEqual(t.l)},ri);function ri(t){this.l=t}function ii(){if("undefined"==typeof Uint8Array)throw new qr(Ur.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function oi(){if("undefined"==typeof atob)throw new qr(Ur.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var si,ui=(n(li,si=ni),li.fromBase64String=function(t){oi();try{return new li(ti.fromBase64String(t))}catch(t){throw new qr(Ur.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},li.fromUint8Array=function(t){return ii(),new li(ti.fromUint8Array(t))},li.prototype.toBase64=function(){return oi(),si.prototype.toBase64.call(this)},li.prototype.toUint8Array=function(){return ii(),si.prototype.toUint8Array.call(this)},li.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},li),ai=function(t,e,n,r,i,o){this._=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.T=o},ci=(Object.defineProperty(hi.prototype,"I",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),hi.prototype.isEqual=function(t){return t instanceof hi&&t.projectId===this.projectId&&t.database===this.database},hi);function hi(t,e){this.projectId=t,this.database=e||"(default)"}function li(){return null!==si&&si.apply(this,arguments)||this}function fi(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function pi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function di(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var yi,vi,gi=(xi.prototype.get=function(t){var e=this.m(t),e=this.R[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.A(o,t))return i}},xi.prototype.has=function(t){return void 0!==this.get(t)},xi.prototype.set=function(t,e){var n=this.m(t),r=this.R[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.A(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.R[n]=[[t,e]]},xi.prototype.delete=function(t){var e=this.m(t),n=this.R[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.A(n[r][0],t))return 1===n.length?delete this.R[e]:n.splice(r,1),!0;return!1},xi.prototype.forEach=function(s){pi(this.R,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},xi.prototype.P=function(){return di(this.R)},xi),mi=(Oi.now=function(){return Oi.fromMillis(Date.now())},Oi.fromDate=function(t){return Oi.fromMillis(t.getTime())},Oi.fromMillis=function(t){var e=Math.floor(t/1e3);return new Oi(e,1e6*(t-1e3*e))},Oi.prototype.toDate=function(){return new Date(this.toMillis())},Oi.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Oi.prototype.g=function(t){return this.seconds===t.seconds?Xr(this.nanoseconds,t.nanoseconds):Xr(this.seconds,t.seconds)},Oi.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Oi.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Oi.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Oi.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Oi),wi=(Si.V=function(t){return new Si(t)},Si.min=function(){return new Si(new mi(0,0))},Si.prototype.u=function(t){return this.timestamp.g(t.timestamp)},Si.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Si.prototype.p=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Si.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Si.prototype.v=function(){return this.timestamp},Si),Te=(Object.defineProperty(Di.prototype,"length",{get:function(){return this.S},enumerable:!1,configurable:!0}),Di.prototype.isEqual=function(t){return 0===Di.D(this,t)},Di.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Di?t.forEach(function(t){e.push(t)}):e.push(t),this.C(e)},Di.prototype.limit=function(){return this.offset+this.length},Di.prototype.N=function(t){return t=void 0===t?1:t,this.C(this.segments,this.offset+t,this.length-t)},Di.prototype.F=function(){return this.C(this.segments,this.offset,this.length-1)},Di.prototype.O=function(){return this.segments[this.offset]},Di.prototype.k=function(){return this.get(this.length-1)},Di.prototype.get=function(t){return this.segments[this.offset+t]},Di.prototype.P=function(){return 0===this.length},Di.prototype.M=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Di.prototype.$=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Di.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Di.prototype.L=function(){return this.segments.slice(this.offset,this.limit())},Di.D=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Di),bi=(n(Ni,vi=Te),Ni.prototype.C=function(t,e,n){return new Ni(t,e,n)},Ni.prototype.B=function(){return this.L().join("/")},Ni.prototype.toString=function(){return this.B()},Ni.q=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new qr(Ur.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new Ni(n)},Ni.U=function(){return new Ni([])},Ni),Ii=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ei=(n(Ai,yi=Te),Ai.prototype.C=function(t,e,n){return new Ai(t,e,n)},Ai.K=function(t){return Ii.test(t)},Ai.prototype.B=function(){return this.L().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Ai.K(t)||(t="`"+t+"`"),t}).join(".")},Ai.prototype.toString=function(){return this.B()},Ai.prototype.W=function(){return 1===this.length&&"__name__"===this.get(0)},Ai.j=function(){return new Ai(["__name__"])},Ai.G=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new qr(Ur.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new qr(Ur.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new qr(Ur.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new qr(Ur.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Ai(e)},Ai.U=function(){return new Ai([])},Ai),_i=(Ti.H=function(t){return new Ti(bi.q(t))},Ti.J=function(t){return new Ti(bi.q(t).N(5))},Ti.prototype.Y=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Ti.prototype.isEqual=function(t){return null!==t&&0===bi.D(this.path,t.path)},Ti.prototype.toString=function(){return this.path.toString()},Ti.D=function(t,e){return bi.D(t.path,e.path)},Ti.X=function(t){return t.length%2==0},Ti.Z=function(t){return new Ti(new bi(t.slice()))},Ti);function Ti(t){this.path=t}function Ai(){return null!==yi&&yi.apply(this,arguments)||this}function Ni(){return null!==vi&&vi.apply(this,arguments)||this}function Di(t,e,n){void 0===e?e=0:e>t.length&&Wr(),void 0===n?n=t.length-e:n>t.length-e&&Wr(),this.segments=t,this.offset=e,this.S=n}function Si(t){this.timestamp=t}function Oi(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new qr(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new qr(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new qr(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new qr(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function xi(t,e){this.m=t,this.A=e,this.R={}}function Pi(t){return null==t}function ki(t){return 0===t&&1/t==-1/0}function Li(t){return"number"==typeof t&&Number.isInteger(t)&&!ki(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ri=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.tt=null};function Vi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ri(t,e,n,r,i,o,s)}function Ci(t){var e=t;return null===e.tt&&(t=e.path.B(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.B()+t.op.toString()+Co(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.B()+t.dir}).join(","),Pi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ya(e.startAt)),e.endAt&&(t+="|ub:",t+=ya(e.endAt)),e.tt=t),e.tt}function Ui(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!ko(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ga(t.startAt,e.startAt)&&ga(t.endAt,e.endAt)}function qi(t){return _i.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Mi(t){this.count=t}var Fi,ji=(Bi.prototype.st=function(t){return new Bi(this.target,this.targetId,this.et,t,this.nt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Bi.prototype.it=function(t,e){return new Bi(this.target,this.targetId,this.et,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Bi.prototype.rt=function(t){return new Bi(this.target,this.targetId,this.et,this.sequenceNumber,this.nt,t,this.resumeToken)},Bi);function Bi(t,e,n,r,i,o,s){void 0===i&&(i=wi.min()),void 0===o&&(o=wi.min()),void 0===s&&(s=ti.h),this.target=t,this.targetId=e,this.et=n,this.sequenceNumber=r,this.nt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Gi(t){switch(t){case Ur.OK:return Wr(),0;case Ur.CANCELLED:case Ur.UNKNOWN:case Ur.DEADLINE_EXCEEDED:case Ur.RESOURCE_EXHAUSTED:case Ur.INTERNAL:case Ur.UNAVAILABLE:case Ur.UNAUTHENTICATED:return;case Ur.INVALID_ARGUMENT:case Ur.NOT_FOUND:case Ur.ALREADY_EXISTS:case Ur.PERMISSION_DENIED:case Ur.FAILED_PRECONDITION:case Ur.ABORTED:case Ur.OUT_OF_RANGE:case Ur.UNIMPLEMENTED:case Ur.DATA_LOSS:return 1;default:return Wr(),0}}function zi(t){if(void 0===t)return zr("GRPC error has no .code"),Ur.UNKNOWN;switch(t){case Fi.OK:return Ur.OK;case Fi.CANCELLED:return Ur.CANCELLED;case Fi.UNKNOWN:return Ur.UNKNOWN;case Fi.DEADLINE_EXCEEDED:return Ur.DEADLINE_EXCEEDED;case Fi.RESOURCE_EXHAUSTED:return Ur.RESOURCE_EXHAUSTED;case Fi.INTERNAL:return Ur.INTERNAL;case Fi.UNAVAILABLE:return Ur.UNAVAILABLE;case Fi.UNAUTHENTICATED:return Ur.UNAUTHENTICATED;case Fi.INVALID_ARGUMENT:return Ur.INVALID_ARGUMENT;case Fi.NOT_FOUND:return Ur.NOT_FOUND;case Fi.ALREADY_EXISTS:return Ur.ALREADY_EXISTS;case Fi.PERMISSION_DENIED:return Ur.PERMISSION_DENIED;case Fi.FAILED_PRECONDITION:return Ur.FAILED_PRECONDITION;case Fi.ABORTED:return Ur.ABORTED;case Fi.OUT_OF_RANGE:return Ur.OUT_OF_RANGE;case Fi.UNIMPLEMENTED:return Ur.UNIMPLEMENTED;case Fi.DATA_LOSS:return Ur.DATA_LOSS;default:return Wr()}}(_e=Fi=Fi||{})[_e.OK=0]="OK",_e[_e.CANCELLED=1]="CANCELLED",_e[_e.UNKNOWN=2]="UNKNOWN",_e[_e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_e[_e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_e[_e.NOT_FOUND=5]="NOT_FOUND",_e[_e.ALREADY_EXISTS=6]="ALREADY_EXISTS",_e[_e.PERMISSION_DENIED=7]="PERMISSION_DENIED",_e[_e.UNAUTHENTICATED=16]="UNAUTHENTICATED",_e[_e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_e[_e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_e[_e.ABORTED=10]="ABORTED",_e[_e.OUT_OF_RANGE=11]="OUT_OF_RANGE",_e[_e.UNIMPLEMENTED=12]="UNIMPLEMENTED",_e[_e.INTERNAL=13]="INTERNAL",_e[_e.UNAVAILABLE=14]="UNAVAILABLE",_e[_e.DATA_LOSS=15]="DATA_LOSS";var Ki=(Yi.prototype.ot=function(t,e){return new Yi(this.D,this.root.ot(t,e,this.D).copy(null,null,Wi.at,null,null))},Yi.prototype.remove=function(t){return new Yi(this.D,this.root.remove(t,this.D).copy(null,null,Wi.at,null,null))},Yi.prototype.get=function(t){for(var e=this.root;!e.P();){var n=this.D(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Yi.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.P();){var r=this.D(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Yi.prototype.P=function(){return this.root.P()},Object.defineProperty(Yi.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Yi.prototype.ct=function(){return this.root.ct()},Yi.prototype.ut=function(){return this.root.ut()},Yi.prototype.ht=function(t){return this.root.ht(t)},Yi.prototype.forEach=function(n){this.ht(function(t,e){return n(t,e),!1})},Yi.prototype.toString=function(){var n=[];return this.ht(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Yi.prototype.lt=function(t){return this.root.lt(t)},Yi.prototype._t=function(){return new Hi(this.root,null,this.D,!1)},Yi.prototype.ft=function(t){return new Hi(this.root,t,this.D,!1)},Yi.prototype.dt=function(){return new Hi(this.root,null,this.D,!0)},Yi.prototype.wt=function(t){return new Hi(this.root,t,this.D,!0)},Yi),Hi=(Qi.prototype.It=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.Et)for(t=t.left;!t.P();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.P();)this.Tt.push(t),t=t.left;return e},Qi.prototype.At=function(){return 0<this.Tt.length},Qi.prototype.Rt=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},Qi),Wi=(Ji.prototype.copy=function(t,e,n,r,i){return new Ji(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ji.prototype.P=function(){return!1},Ji.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},Ji.prototype.lt=function(t){return this.right.lt(t)||t(this.key,this.value)||this.left.lt(t)},Ji.prototype.min=function(){return this.left.P()?this:this.left.min()},Ji.prototype.ct=function(){return this.min().key},Ji.prototype.ut=function(){return this.right.P()?this.key:this.right.ut()},Ji.prototype.ot=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.ot(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ot(t,e,n))).Pt()},Ji.prototype.gt=function(){if(this.left.P())return Ji.EMPTY;var t=this;return t.left.Vt()||t.left.left.Vt()||(t=t.yt()),(t=t.copy(null,null,null,t.left.gt(),null)).Pt()},Ji.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.P()||r.left.Vt()||r.left.left.Vt()||(r=r.yt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Vt()&&(r=r.bt()),r.right.P()||r.right.Vt()||r.right.left.Vt()||(r=r.vt()),0===e(t,r.key)){if(r.right.P())return Ji.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.gt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Pt()},Ji.prototype.Vt=function(){return this.color},Ji.prototype.Pt=function(){var t=this;return t.right.Vt()&&!t.left.Vt()&&(t=t.St()),t.left.Vt()&&t.left.left.Vt()&&(t=t.bt()),t.left.Vt()&&t.right.Vt()&&(t=t.Dt()),t},Ji.prototype.yt=function(){var t=this.Dt();return t.right.left.Vt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.bt())).St()).Dt()),t},Ji.prototype.vt=function(){var t=this.Dt();return t.left.left.Vt()&&(t=(t=t.bt()).Dt()),t},Ji.prototype.St=function(){var t=this.copy(null,null,Ji.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ji.prototype.bt=function(){var t=this.copy(null,null,Ji.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ji.prototype.Dt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ji.prototype.Ct=function(){var t=this.Nt();return Math.pow(2,t)<=this.size+1},Ji.prototype.Nt=function(){if(this.Vt()&&this.left.Vt())throw Wr();if(this.right.Vt())throw Wr();var t=this.left.Nt();if(t!==this.right.Nt())throw Wr();return t+(this.Vt()?0:1)},Ji);function Ji(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ji.RED,this.left=null!=r?r:Ji.EMPTY,this.right=null!=i?i:Ji.EMPTY,this.size=this.left.size+1+this.right.size}function Qi(t,e,n,r){this.Et=r,this.Tt=[];for(var i=1;!t.P();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Et?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.Et?t.right:t.left}}function Yi(t,e){this.D=t,this.root=e||Wi.EMPTY}function Xi(){this.size=0}Wi.EMPTY=null,Wi.RED=!0,Wi.at=!1,Wi.EMPTY=(Object.defineProperty(Xi.prototype,"key",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(Xi.prototype,"value",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(Xi.prototype,"color",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(Xi.prototype,"left",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(Xi.prototype,"right",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Xi.prototype.copy=function(t,e,n,r,i){return this},Xi.prototype.ot=function(t,e,n){return new Wi(t,e)},Xi.prototype.remove=function(t,e){return this},Xi.prototype.P=function(){return!0},Xi.prototype.ht=function(t){return!1},Xi.prototype.lt=function(t){return!1},Xi.prototype.ct=function(){return null},Xi.prototype.ut=function(){return null},Xi.prototype.Vt=function(){return!1},Xi.prototype.Ct=function(){return!0},Xi.prototype.Nt=function(){return 0},new Xi);var $i=(no.prototype.has=function(t){return null!==this.data.get(t)},no.prototype.first=function(){return this.data.ct()},no.prototype.last=function(){return this.data.ut()},Object.defineProperty(no.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),no.prototype.indexOf=function(t){return this.data.indexOf(t)},no.prototype.forEach=function(n){this.data.ht(function(t,e){return n(t),!1})},no.prototype.xt=function(t,e){for(var n=this.data.ft(t[0]);n.At();){var r=n.It();if(0<=this.D(r.key,t[1]))return;e(r.key)}},no.prototype.Ft=function(t,e){for(var n=void 0!==e?this.data.ft(e):this.data._t();n.At();)if(!t(n.It().key))return},no.prototype.Ot=function(t){t=this.data.ft(t);return t.At()?t.It().key:null},no.prototype._t=function(){return new Zi(this.data._t())},no.prototype.ft=function(t){return new Zi(this.data.ft(t))},no.prototype.add=function(t){return this.copy(this.data.remove(t).ot(t,!0))},no.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},no.prototype.P=function(){return this.data.P()},no.prototype.kt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},no.prototype.isEqual=function(t){if(!(t instanceof no))return!1;if(this.size!==t.size)return!1;for(var e=this.data._t(),n=t.data._t();e.At();){var r=e.It().key,i=n.It().key;if(0!==this.D(r,i))return!1}return!0},no.prototype.L=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},no.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},no.prototype.copy=function(t){var e=new no(this.D);return e.data=t,e},no),Zi=(eo.prototype.It=function(){return this.Mt.It().key},eo.prototype.At=function(){return this.Mt.At()},eo),to=new Ki(_i.D);function eo(t){this.Mt=t}function no(t){this.D=t,this.data=new Ki(this.D)}var ro=new Ki(_i.D);var io=new Ki(_i.D),oo=new $i(_i.D);function so(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=oo,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var uo=new $i(Xr);var ao=(Ao.Bt=function(t){return new Ao(t.D)},Ao.prototype.has=function(t){return null!=this.$t.get(t)},Ao.prototype.get=function(t){return this.$t.get(t)},Ao.prototype.first=function(){return this.Lt.ct()},Ao.prototype.last=function(){return this.Lt.ut()},Ao.prototype.P=function(){return this.Lt.P()},Ao.prototype.indexOf=function(t){t=this.$t.get(t);return t?this.Lt.indexOf(t):-1},Object.defineProperty(Ao.prototype,"size",{get:function(){return this.Lt.size},enumerable:!1,configurable:!0}),Ao.prototype.forEach=function(n){this.Lt.ht(function(t,e){return n(t),!1})},Ao.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.$t.ot(t.key,t),e.Lt.ot(t,null))},Ao.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.$t.remove(t),this.Lt.remove(e)):this},Ao.prototype.isEqual=function(t){if(!(t instanceof Ao))return!1;if(this.size!==t.size)return!1;for(var e=this.Lt._t(),n=t.Lt._t();e.At();){var r=e.It().key,i=n.It().key;if(!r.isEqual(i))return!1}return!0},Ao.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Ao.prototype.copy=function(t,e){var n=new Ao;return n.D=this.D,n.$t=t,n.Lt=e,n},Ao),co=(To.prototype.track=function(t){var e=t.doc.key,n=this.qt.get(e);!n||0!==t.type&&3===n.type?this.qt=this.qt.ot(e,t):3===t.type&&1!==n.type?this.qt=this.qt.ot(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.qt=this.qt.ot(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.qt=this.qt.remove(e):1===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):Wr()},To.prototype.Ut=function(){var n=[];return this.qt.ht(function(t,e){n.push(e)}),n},To),ho=(_o.Gt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new _o(t,e,ao.Bt(e),i,n,r,!0,!1)},Object.defineProperty(_o.prototype,"hasPendingWrites",{get:function(){return!this.Qt.P()},enumerable:!1,configurable:!0}),_o.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&qu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Kt.isEqual(t.Kt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},_o),lo=(Eo.Xt=function(t,e){var n=new Map;return n.set(t,fo.Zt(t,e)),new Eo(wi.min(),n,uo,to,so())},Eo),fo=(Io.Zt=function(t,e){return new Io(ti.h,e,so(),so(),so())},Io),po=function(t,e,n,r){this.ie=t,this.removedTargetIds=e,this.key=n,this.re=r},yo=function(t,e){this.targetId=t,this.oe=e},vo=function(t,e,n,r){void 0===n&&(n=ti.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},go=(Object.defineProperty(bo.prototype,"te",{get:function(){return this.he},enumerable:!1,configurable:!0}),Object.defineProperty(bo.prototype,"resumeToken",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(bo.prototype,"_e",{get:function(){return 0!==this.ae},enumerable:!1,configurable:!0}),Object.defineProperty(bo.prototype,"fe",{get:function(){return this.le},enumerable:!1,configurable:!0}),bo.prototype.de=function(t){0<t.o()&&(this.le=!0,this.ue=t)},bo.prototype.we=function(){var n=so(),r=so(),i=so();return this.ce.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Wr()}}),new fo(this.ue,this.he,n,r,i)},bo.prototype.Ee=function(){this.le=!1,this.ce=Do()},bo.prototype.Te=function(t,e){this.le=!0,this.ce=this.ce.ot(t,e)},bo.prototype.Ie=function(t){this.le=!0,this.ce=this.ce.remove(t)},bo.prototype.me=function(){this.ae+=1},bo.prototype.Ae=function(){--this.ae},bo.prototype.Re=function(){this.le=!0,this.he=!0},bo),mo=(wo.prototype.be=function(t){for(var e=0,n=t.ie;e<n.length;e++){var r=n[e];t.re instanceof wu?this.ve(r,t.re):t.re instanceof bu&&this.Se(r,t.key,t.re)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Se(s,t.key,t.re)}},wo.prototype.De=function(n){var r=this;this.Ce(n,function(t){var e=r.Ne(t);switch(n.state){case 0:r.xe(t)&&e.de(n.resumeToken);break;case 1:e.Ae(),e._e||e.Ee(),e.de(n.resumeToken);break;case 2:e.Ae(),e._e||r.removeTarget(t);break;case 3:r.xe(t)&&(e.Re(),e.de(n.resumeToken));break;case 4:r.xe(t)&&(r.Fe(t),e.de(n.resumeToken));break;default:Wr()}})},wo.prototype.Ce=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.ge.forEach(function(t,e){r.xe(e)&&n(e)})},wo.prototype.Oe=function(t){var e=t.targetId,n=t.oe.count,t=this.ke(e);t&&(qi(t=t.target)?0===n?(t=new _i(t.path),this.Se(e,t,new bu(t,wi.min()))):Jr(1===n):this.Me(e)!==n&&(this.Fe(e),this.pe=this.pe.add(e)))},wo.prototype.$e=function(r){var i=this,o=new Map;this.ge.forEach(function(t,e){var n=i.ke(e);n&&(t.te&&qi(n.target)&&(n=new _i(n.target.path),null!==i.Ve.get(n)||i.Le(e,n)||i.Se(e,n,new bu(n,r))),t.fe&&(o.set(e,t.we()),t.Ee()))});var s=so();this.ye.forEach(function(t,e){var n=!0;e.Ft(function(t){t=i.ke(t);return!t||2===t.et||(n=!1)}),n&&(s=s.add(t))});var t=new lo(r,o,this.pe,this.Ve,s);return this.Ve=to,this.ye=No(),this.pe=new $i(Xr),t},wo.prototype.ve=function(t,e){var n;this.xe(t)&&(n=this.Le(t,e.key)?2:0,this.Ne(t).Te(e.key,n),this.Ve=this.Ve.ot(e.key,e),this.ye=this.ye.ot(e.key,this.Be(e.key).add(t)))},wo.prototype.Se=function(t,e,n){var r;this.xe(t)&&(r=this.Ne(t),this.Le(t,e)?r.Te(e,1):r.Ie(e),this.ye=this.ye.ot(e,this.Be(e).delete(t)),n&&(this.Ve=this.Ve.ot(e,n)))},wo.prototype.removeTarget=function(t){this.ge.delete(t)},wo.prototype.Me=function(t){var e=this.Ne(t).we();return this.Pe.qe(t).size+e.ee.size-e.se.size},wo.prototype.me=function(t){this.Ne(t).me()},wo.prototype.Ne=function(t){var e=this.ge.get(t);return e||(e=new go,this.ge.set(t,e)),e},wo.prototype.Be=function(t){var e=this.ye.get(t);return e||(e=new $i(Xr),this.ye=this.ye.ot(t,e)),e},wo.prototype.xe=function(t){var e=null!==this.ke(t);return e||Gr("WatchChangeAggregator","Detected inactive target",t),e},wo.prototype.ke=function(t){var e=this.ge.get(t);return e&&e._e?null:this.Pe.Ue(t)},wo.prototype.Fe=function(e){var n=this;this.ge.set(e,new go),this.Pe.qe(e).forEach(function(t){n.Se(e,t,null)})},wo.prototype.Le=function(t,e){return this.Pe.qe(t).has(e)},wo);function wo(t){this.Pe=t,this.ge=new Map,this.Ve=to,this.ye=No(),this.pe=new $i(Xr)}function bo(){this.ae=0,this.ce=Do(),this.ue=ti.h,this.he=!1,this.le=!0}function Io(t,e,n,r,i){this.resumeToken=t,this.te=e,this.ee=n,this.ne=r,this.se=i}function Eo(t,e,n,r,i){this.nt=t,this.zt=e,this.Ht=n,this.Jt=r,this.Yt=i}function _o(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Kt=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}function To(){this.qt=new Ki(_i.D)}function Ao(n){this.D=n?function(t,e){return n(t,e)||_i.D(t.key,e.key)}:function(t,e){return _i.D(t.key,e.key)},this.$t=ro,this.Lt=new Ki(this.D)}function No(){return new Ki(_i.D)}function Do(){return new Ki(_i.D)}function So(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Oo(t){t=Uo(t.mapValue.fields.__local_write_time__.timestampValue);return new mi(t.seconds,t.nanos)}var xo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Po(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?So(t)?4:10:Wr()}function ko(r,i){var t,e=Po(r);if(e!==Po(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Oo(r).isEqual(Oo(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Uo(r.timestampValue),t=Uo(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,Mo(r.bytesValue).isEqual(Mo(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,qo((t=r).geoPointValue.latitude)===qo(e.geoPointValue.latitude)&&qo(t.geoPointValue.longitude)===qo(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return qo(t.integerValue)===qo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=qo(t.doubleValue),e=qo(e.doubleValue);return t===e?ki(t)===ki(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return $r(r.arrayValue.values||[],i.arrayValue.values||[],ko);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(fi(e)!==fi(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!ko(e[t],n[t])))return!1;return!0}();default:return Wr()}}function Lo(t,e){return void 0!==(t.values||[]).find(function(t){return ko(t,e)})}function Ro(t,e){var n,r,i=Po(t),o=Po(e);if(i!==o)return Xr(i,o);switch(i){case 0:return 0;case 1:return Xr(t.booleanValue,e.booleanValue);case 2:return n=e,r=qo(t.integerValue||t.doubleValue),n=qo(n.integerValue||n.doubleValue),r<n?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return Vo(t.timestampValue,e.timestampValue);case 4:return Vo(Oo(t),Oo(e));case 5:return Xr(t.stringValue,e.stringValue);case 6:return function(t,e){t=Mo(t),e=Mo(e);return t.u(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Xr(n[i],r[i]);if(0!==o)return o}return Xr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return i=t.geoPointValue,r=e.geoPointValue,0!==(n=Xr(qo(i.latitude),qo(r.latitude)))?n:Xr(qo(i.longitude),qo(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ro(n[i],r[i]);if(o)return o}return Xr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Xr(r[s],o[s]);if(0!==u)return u;u=Ro(n[r[s]],i[o[s]]);if(0!==u)return u}return Xr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Wr()}}function Vo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Xr(t,e);var n=Uo(t),t=Uo(e),e=Xr(n.seconds,t.seconds);return 0!==e?e:Xr(n.nanos,t.nanos)}function Co(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var t=Uo(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Mo(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,_i.J(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):Wr();var e}(t)}function Uo(t){if(Jr(!!t),"string"!=typeof t)return{seconds:qo(t.seconds),nanos:qo(t.nanos)};var e=0,n=xo.exec(t);Jr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function qo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Mo(t){return"string"==typeof t?ti.fromBase64String(t):ti.fromUint8Array(t)}function Fo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.B()}}function jo(t){return t&&"integerValue"in t}function Bo(t){return!!t&&"arrayValue"in t}function Go(t){return t&&"nullValue"in t}function zo(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ko(t){return t&&"mapValue"in t}var Ho={asc:"ASCENDING",desc:"DESCENDING"},Wo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Jo=function(t,e){this._=t,this.Ke=e};function Qo(t){return{integerValue:""+t}}function Yo(t,e){if(t.Ke){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ki(e)?"-0":e}}function Xo(t,e){return Li(e)?Qo(e):Yo(t,e)}function $o(t,e){return t.Ke?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Zo(t,e){return t.Ke?e.toBase64():e.toUint8Array()}function ts(t){return Jr(!!t),wi.V((t=Uo(t),new mi(t.seconds,t.nanos)))}function es(t,e){return new bi(["projects",t.projectId,"databases",t.database]).child("documents").child(e).B()}function ns(t){t=bi.q(t);return Jr(bs(t)),t}function rs(t,e){return es(t._,e.path)}function is(t,e){e=ns(e);return Jr(e.get(1)===t._.projectId),Jr(!e.get(3)&&!t._.database||e.get(3)===t._.database),new _i(as(e))}function os(t,e){return es(t._,e)}function ss(t){t=ns(t);return 4===t.length?bi.U():as(t)}function us(t){return new bi(["projects",t._.projectId,"databases",t._.database]).B()}function as(t){return Jr(4<t.length&&"documents"===t.get(4)),t.N(5)}function cs(t,e,n){return{name:rs(t,e),fields:n.proto.mapValue.fields}}function hs(t,e){var n,r,i;if(e instanceof Xs)n={update:cs(t,e.key,e.value)};else if(e instanceof au)n={delete:rs(t,e.key)};else if(e instanceof $s)n={update:cs(t,e.key,e.data),updateMask:(i=e.Qe,r=[],i.fields.forEach(function(t){return r.push(t.B())}),{fieldPaths:r})};else if(e instanceof ru)n={transform:{document:rs(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Ts)return{fieldPath:t.field.B(),setToServerValue:"REQUEST_TIME"};if(e instanceof As)return{fieldPath:t.field.B(),appendMissingElements:{values:e.elements}};if(e instanceof xs)return{fieldPath:t.field.B(),removeAllFromArray:{values:e.elements}};if(e instanceof Rs)return{fieldPath:t.field.B(),increment:e.We};throw Wr()})}};else{if(!(e instanceof cu))return Wr();n={verify:rs(t,e.key)}}return e.Ge.je||(n.currentDocument=void 0!==(i=e.Ge).updateTime?{updateTime:(e=t,t=i.updateTime,$o(e,t.v()))}:void 0!==i.exists?{exists:i.exists}:Wr()),n}function ls(e,t){var n=t.currentDocument?void 0!==(o=t.currentDocument).updateTime?Bs.updateTime(ts(o.updateTime)):void 0!==o.exists?Bs.exists(o.exists):Bs.ze():Bs.ze();if(t.update){t.update.name;var r=is(e,t.update.name),i=new hu({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=(o=t.updateMask.fieldPaths||[],new qs(o.map(function(t){return Ei.G(t)})));return new $s(r,i,o,n)}return new Xs(r,i,n)}if(t.delete){var s=is(e,t.delete);return new au(s,n)}if(t.transform){i=is(e,t.transform.document),s=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r=null;"setToServerValue"in e?(Jr("REQUEST_TIME"===e.setToServerValue),r=new Ts):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new As(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new xs(n)):"increment"in e?r=new Rs(t,e.increment):Wr();e=Ei.G(e.fieldPath);return new Ms(e,r)}(e,t)});return Jr(!0===n.exists),new ru(i,s)}if(t.verify){t=is(e,t.verify);return new cu(t,n)}return Wr()}function fs(t,e){return{documents:[os(t,e.path)]}}function ps(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=os(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=os(t,r.F()),n.structuredQuery.from=[{collectionId:r.k()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(zo(t.value))return{unaryFilter:{field:gs(t.field),op:"IS_NAN"}};if(Go(t.value))return{unaryFilter:{field:gs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(zo(t.value))return{unaryFilter:{field:gs(t.field),op:"IS_NOT_NAN"}};if(Go(t.value))return{unaryFilter:{field:gs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gs(t.field),op:(e=t.op,Wo[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:gs((t=t).field),direction:(t=t.dir,Ho[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.Ke||Pi(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=ys(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ys(e.endAt)),n}function ds(t){var e=ss(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Jr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[ws(t)]:void 0!==t.fieldFilter?[(n=t,zu.create(ms(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Wr()}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):Wr():[];var n}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new ma(ms((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=Pi(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=vs(n.startAt));var u=null;return n.endAt&&(u=vs(n.endAt)),Ru(Nu(e,i,t,o,r,"F",s,u))}function ys(t){return{before:t.before,values:t.position}}function vs(t){var e=!!t.before,t=t.values||[];return new ha(t,e)}function gs(t){return{fieldPath:t.B()}}function ms(t){return Ei.G(t.fieldPath)}function ws(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ms(t.unaryFilter.field);return zu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ms(t.unaryFilter.field);return zu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":n=ms(t.unaryFilter.field);return zu.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":t=ms(t.unaryFilter.field);return zu.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Wr()}}function bs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}l=function(){this.He=void 0};function Is(t,e){return t instanceof Rs?jo(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Es,_s,Ts=(n(Ds,_s=l),Ds),As=(n(Ns,Es=l),Ns);function Ns(t){var e=this;return(e=Es.call(this)||this).elements=t,e}function Ds(){return null!==_s&&_s.apply(this,arguments)||this}function Ss(t,e){for(var n=Us(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return ko(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Os,xs=(n(Ps,Os=l),Ps);function Ps(t){var e=this;return(e=Os.call(this)||this).elements=t,e}function ks(t,e){for(var n=Us(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!ko(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Ls,Rs=(n(Vs,Ls=l),Vs);function Vs(t,e){var n=this;return(n=Ls.call(this)||this).serializer=t,n.We=e,n}function Cs(t){return qo(t.integerValue||t.doubleValue)}function Us(t){return Bo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var qs=(Fs.prototype.Je=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].M(t))return!0;return!1},Fs.prototype.isEqual=function(t){return $r(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Fs),Ms=function(t,e){this.field=t,this.transform=e};function Fs(t){(this.fields=t).sort(Ei.D)}function js(t,e){this.version=t,this.transformResults=e}var Bs=(Gs.ze=function(){return new Gs},Gs.exists=function(t){return new Gs(void 0,t)},Gs.updateTime=function(t){return new Gs(t)},Object.defineProperty(Gs.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Gs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Gs);function Gs(t,e){this.updateTime=t,this.exists=e}function zs(t,e){return void 0!==t.updateTime?e instanceof wu&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof wu}Te=function(){};function Ks(t,e,n){return t instanceof Xs?new wu(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof $s?function(t,e,n){if(!zs(t.Ge,e))return new Iu(t.key,n.version);e=eu(t,e);return new wu(t.key,n.version,e,{hasCommittedMutations:!0})}(t,e,n):t instanceof ru?function(t,e,n){if(Jr(null!=n.transformResults),!zs(t.Ge,e))return new Iu(t.key,n.version);var r=e,e=function(t,e,n){var r=[];Jr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof wu&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof As?Ss(o,s):o instanceof xs?ks(o,s):u))}return r}(t.fieldTransforms,e,n.transformResults),n=n.version,e=ou(t,r.data(),e);return new wu(t.key,n,e,{hasCommittedMutations:!0})}(t,e,n):new bu(t.key,n.version,{hasCommittedMutations:!0})}function Hs(t,e,n,r){return t instanceof Xs?function(t,e){if(!zs(t.Ge,e))return e;e=Js(e);return new wu(t.key,e,t.value,{Ye:!0})}(t,e):t instanceof $s?function(t,e){if(!zs(t.Ge,e))return e;var n=Js(e),e=eu(t,e);return new wu(t.key,n,e,{Ye:!0})}(t,e):t instanceof ru?function(t,e,n,r){if(!zs(t.Ge,e))return e;var i=e,r=function(t,e,n,r){for(var i,o=[],s=0,u=t;s<u.length;s++){var a=u[s],c=a.transform,h=null;n instanceof wu&&(h=n.field(a.field)),null===h&&r instanceof wu&&(h=r.field(a.field)),o.push((i=h,a=e,h=void 0,(c=c)instanceof Ts?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},i&&(h.fields.__previous_value__=i),{mapValue:h}):c instanceof As?Ss(c,i):c instanceof xs?ks(c,i):(c=Is(h=c,i),i=Cs(c)+Cs(h.We),jo(c)&&jo(h.We)?Qo(i):Yo(h.serializer,i))))}return o}(t.fieldTransforms,n,e,r),r=ou(t,i.data(),r);return new wu(t.key,i.version,r,{Ye:!0})}(t,e,r,n):(e=e,zs((t=t).Ge,e)?new bu(t.key,wi.min()):e)}function Ws(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ge.isEqual(e.Ge)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||$r(t.fieldTransforms,t.fieldTransforms,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof As&&e instanceof As||t instanceof xs&&e instanceof xs?$r(t.elements,e.elements,ko):t instanceof Rs&&e instanceof Rs?ko(t.We,e.We):t instanceof Ts&&e instanceof Ts)}))}function Js(t){return t instanceof wu?t.version:wi.min()}var Qs,Ys,Xs=(n(tu,Ys=Te),tu),$s=(n(Zs,Qs=Te),Zs);function Zs(t,e,n,r){var i=this;return(i=Qs.call(this)||this).key=t,i.data=e,i.Qe=n,i.Ge=r,i.type=1,i}function tu(t,e,n){var r=this;return(r=Ys.call(this)||this).key=t,r.value=e,r.Ge=n,r.type=0,r}function eu(t,e){return n=t,e=e instanceof wu?e.data():hu.empty(),r=new lu(e),n.Qe.fields.forEach(function(t){var e;t.P()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.Xe();var n,r}var nu,ru=(n(iu,nu=Te),iu);function iu(t,e){var n=this;return(n=nu.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ge=Bs.exists(!0),n}function ou(t,e,n){for(var r=new lu(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Xe()}var su,uu,au=(n(yu,uu=Te),yu),cu=(n(du,su=Te),du),hu=(pu.empty=function(){return new pu({mapValue:{}})},pu.prototype.field=function(t){if(t.P())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ko(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.k()])||null},pu.prototype.isEqual=function(t){return ko(this.proto,t.proto)},pu),lu=(fu.prototype.set=function(t,e){return this.en(t,e),this},fu.prototype.delete=function(t){return this.en(t,null),this},fu.prototype.en=function(t,e){for(var n=this.tn,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===Po(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.k(),e)},fu.prototype.Xe=function(){var t=this.nn(Ei.U(),this.tn);return null!=t?new hu(t):this.Ze},fu.prototype.nn=function(r,t){var i=this,o=!1,e=this.Ze.field(r),s=Ko(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.nn(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},fu);function fu(t){void 0===t&&(t=hu.empty()),this.Ze=t,this.tn=new Map}function pu(t){this.proto=t}function du(t,e){var n=this;return(n=su.call(this)||this).key=t,n.Ge=e,n.type=4,n}function yu(t,e){var n=this;return(n=uu.call(this)||this).key=t,n.Ge=e,n.type=3,n}var vu,gu,mu,_e=function(t,e){this.key=t,this.version=e},wu=(n(Au,mu=_e),Au.prototype.field=function(t){return this.sn.field(t)},Au.prototype.data=function(){return this.sn},Au.prototype.rn=function(){return this.sn.proto},Au.prototype.isEqual=function(t){return t instanceof Au&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.sn.isEqual(t.sn)},Au.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.sn.toString()+", {hasLocalMutations: "+this.Ye+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Au.prototype,"hasPendingWrites",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Au),bu=(n(Tu,gu=_e),Tu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Tu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Tu.prototype.isEqual=function(t){return t instanceof Tu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Tu),Iu=(n(_u,vu=_e),_u.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(_u.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),_u.prototype.isEqual=function(t){return t instanceof _u&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},_u),Eu=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.on=n,this.filters=r,this.limit=i,this.an=o,this.startAt=s,this.endAt=u,this.cn=null,this.un=null,this.startAt,this.endAt};function _u(){return null!==vu&&vu.apply(this,arguments)||this}function Tu(t,e,n){var r=this;return(r=gu.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Au(t,e,n,r){var i=this;return(i=mu.call(this,t,e)||this).sn=n,i.Ye=!!r.Ye,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Nu(t,e,n,r,i,o,s,u){return new Eu(t,e,n,r,i,o,s,u)}function Du(t){return new Eu(t)}function Su(t){return!Pi(t.limit)&&"F"===t.an}function Ou(t){return!Pi(t.limit)&&"L"===t.an}function xu(t){return 0<t.on.length?t.on[0].field:null}function Pu(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.hn())return r.field}return null}function ku(t){return null!==t.collectionGroup}function Lu(t){var e=t;if(null===e.cn){e.cn=[];var n=Pu(e),t=xu(e);if(null!==n&&null===t)n.W()||e.cn.push(new ma(n)),e.cn.push(new ma(Ei.j(),"asc"));else{for(var r=!1,i=0,o=e.on;i<o.length;i++){var s=o[i];e.cn.push(s),s.field.W()&&(r=!0)}r||(n=0<e.on.length?e.on[e.on.length-1].dir:"asc",e.cn.push(new ma(Ei.j(),n)))}}return e.cn}function Ru(t){var e=t;if(!e.un)if("F"===e.an)e.un=Vi(e.path,e.collectionGroup,Lu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Lu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new ma(o.field,s))}var u=e.endAt?new ha(e.endAt.position,!e.endAt.before):null,t=e.startAt?new ha(e.startAt.position,!e.startAt.before):null;e.un=Vi(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.un}function Vu(t,e,n){return new Eu(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Cu(t,e){return new Eu(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,e,t.endAt)}function Uu(t,e){return new Eu(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,e)}function qu(t,e){return Ui(Ru(t),Ru(e))&&t.an===e.an}function Mu(t){return Ci(Ru(t))+"|lt:"+t.an}function Fu(t){return"Query(target="+(e=Ru(t),n=e.path.B(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.B()+" "+t.op+" "+Co(t.value)}).join(", ")+"]"),Pi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.B()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+ya(e.startAt)),e.endAt&&(n+=", endAt: "+ya(e.endAt)),"Target("+n+")")+"; limitType="+t.an+")";var e,n}function ju(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.Y(e.collectionGroup)&&e.path.M(n):_i.X(e.path)?e.path.isEqual(n):e.path.$(n))&&function(t){for(var e=0,n=i.on;e<n.length;e++){var r=n[e];if(!r.field.W()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||va(t.startAt,Lu(t),n))&&(!t.endAt||!va(t.endAt,Lu(t),n)));var e,n}function Bu(u){return function(t,e){for(var n=!1,r=0,i=Lu(u);r<i.length;r++){var o=i[r],s=function(t,r,e){e=t.field.W()?_i.D(r.key,e.key):function(t,e){var n=r.field(t),t=e.field(t);return null!==n&&null!==t?Ro(n,t):Wr()}(t.field,e);switch(t.dir){case"asc":return e;case"desc":return-1*e;default:return Wr()}}(o,t,e);if(0!==s)return s;n=n||o.field.W()}return 0}}var Gu,zu=(n(Ku,Gu=function(){}),Ku.create=function(t,e,n){return t.W()?"in"===e||"not-in"===e?this.ln(t,e,n):new Qu(t,e,n):"array-contains"===e?new sa(t,n):"in"===e?new ua(t,n):"not-in"===e?new aa(t,n):"array-contains-any"===e?new ca(t,n):new Ku(t,e,n)},Ku.ln=function(t,e,n){return new("in"===e?Yu:Xu)(t,n)},Ku.prototype.matches=function(t){t=t.field(this.field);return"!="===this.op?null!==t&&this._n(Ro(t,this.value)):null!==t&&Po(this.value)===Po(t)&&this._n(Ro(t,this.value))},Ku.prototype._n=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Wr()}},Ku.prototype.hn=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Ku);function Ku(t,e,n){var r=this;return(r=Gu.call(this)||this).field=t,r.op=e,r.value=n,r}var Hu,Wu,Ju,Qu=(n(ta,Ju=zu),ta.prototype.matches=function(t){t=_i.D(t.key,this.key);return this._n(t)},ta),Yu=(n(Zu,Wu=zu),Zu.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Zu),Xu=(n($u,Hu=zu),$u.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},$u);function $u(t,e){var n=this;return(n=Hu.call(this,t,"not-in",e)||this).keys=ea(0,e),n}function Zu(t,e){var n=this;return(n=Wu.call(this,t,"in",e)||this).keys=ea(0,e),n}function ta(t,e,n){var r=this;return(r=Ju.call(this,t,e,n)||this).key=_i.J(n.referenceValue),r}function ea(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return _i.J(t.referenceValue)})}var na,ra,ia,oa,sa=(n(da,oa=zu),da.prototype.matches=function(t){t=t.field(this.field);return Bo(t)&&Lo(t.arrayValue,this.value)},da),ua=(n(pa,ia=zu),pa.prototype.matches=function(t){t=t.field(this.field);return null!==t&&Lo(this.value.arrayValue,t)},pa),aa=(n(fa,ra=zu),fa.prototype.matches=function(t){if(Lo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.field(this.field);return null!==t&&!Lo(this.value.arrayValue,t)},fa),ca=(n(la,na=zu),la.prototype.matches=function(t){var e=this,t=t.field(this.field);return!(!Bo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return Lo(e.value.arrayValue,t)})},la),ha=function(t,e){this.position=t,this.before=e};function la(t,e){return na.call(this,t,"array-contains-any",e)||this}function fa(t,e){return ra.call(this,t,"not-in",e)||this}function pa(t,e){return ia.call(this,t,"in",e)||this}function da(t,e){return oa.call(this,t,"array-contains",e)||this}function ya(t){return(t.before?"b":"a")+":"+t.position.map(Co).join(",")}function va(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.W()?_i.D(_i.J(s.referenceValue),n.key):Ro(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ga(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ko(t.position[n],e.position[n]))return!1;return!0}var ma=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};var wa,ba=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Ia=(xa.prototype.reset=function(){this.In=0},xa.prototype.Rn=function(){this.In=this.Tn},xa.prototype.Pn=function(t){var e=this;this.cancel();var n=Math.floor(this.In+this.gn()),r=Math.max(0,Date.now()-this.An),i=Math.max(0,n-r);0<i&&Gr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.In+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.mn=this.fn.Vn(this.dn,i,function(){return e.An=Date.now(),t()}),this.In*=this.En,this.In<this.wn&&(this.In=this.wn),this.In>this.Tn&&(this.In=this.Tn)},xa.prototype.yn=function(){null!==this.mn&&(this.mn.pn(),this.mn=null)},xa.prototype.cancel=function(){null!==this.mn&&(this.mn.cancel(),this.mn=null)},xa.prototype.gn=function(){return(Math.random()-.5)*this.In},xa),Ea=(Oa.prototype.catch=function(t){return this.next(void 0,t)},Oa.prototype.next=function(r,i){var o=this;return this.Dn&&Wr(),this.Dn=!0,this.Sn?this.error?this.Cn(i,this.error):this.Nn(r,this.result):new Oa(function(e,n){o.bn=function(t){o.Nn(r,t).next(e,n)},o.vn=function(t){o.Cn(i,t).next(e,n)}})},Oa.prototype.xn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Oa.prototype.Fn=function(t){try{var e=t();return e instanceof Oa?e:Oa.resolve(e)}catch(t){return Oa.reject(t)}},Oa.prototype.Nn=function(t,e){return t?this.Fn(function(){return t(e)}):Oa.resolve(e)},Oa.prototype.Cn=function(t,e){return t?this.Fn(function(){return t(e)}):Oa.reject(e)},Oa.resolve=function(n){return new Oa(function(t,e){t(n)})},Oa.reject=function(n){return new Oa(function(t,e){e(n)})},Oa.On=function(t){return new Oa(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Oa.kn=function(t){for(var n=Oa.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Oa.resolve(t):e()})}(r[e]);return n},Oa.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.On(i)},Oa),_a=(Sa.delete=function(t){return Gr("SimpleDb","Removing database:",t),Ca(window.indexedDB.deleteDatabase(t)).xn()},Sa.Ln=function(){if("undefined"==typeof indexedDB)return!1;if(Sa.Bn())return!0;var t=d(),e=Sa.$n(t),n=0<e&&e<10,e=Sa.qn(t),e=0<e&&e<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||e)},Sa.Bn=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Un)},Sa.Kn=function(t,e){return t.store(e)},Sa.$n=function(t){t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)},Sa.qn=function(t){t=t.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)},Sa.prototype.Qn=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Gr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result;e(t)},r.onblocked=function(){n(new Aa(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){t=t.target.error;"VersionError"===t.name?n(new qr(Ur.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Aa(o,t))},r.onupgradeneeded=function(t){Gr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.Mn.createOrUpgrade(e,r.transaction,t.oldVersion,i.version).next(function(){Gr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return i.Wn(t)}),this.db)]}})})},Sa.prototype.jn=function(e){this.Wn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Sa.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Qn(u)];case 2:return s.db=t.sent(),e=ka.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),Ea.reject(t)}).xn(),r={},n.catch(function(){}),[4,e.Gn];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,Gr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Sa.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Sa),Ta=(Object.defineProperty(Da.prototype,"Sn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(Da.prototype,"Yn",{get:function(){return this.Jn},enumerable:!1,configurable:!0}),Object.defineProperty(Da.prototype,"cursor",{set:function(t){this.zn=t},enumerable:!1,configurable:!0}),Da.prototype.done=function(){this.Hn=!0},Da.prototype.Xn=function(t){this.Jn=t},Da.prototype.delete=function(){return Ca(this.zn.delete())},Da),Aa=(n(Na,wa=qr),Na);function Na(t,e){var n=this;return(n=wa.call(this,Ur.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function Da(t){this.zn=t,this.Hn=!1,this.Jn=null}function Sa(t,e,n){this.name=t,this.version=e,this.Mn=n,12.2===Sa.$n(d())&&zr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Oa(t){var e=this;this.bn=null,this.vn=null,this.result=void 0,this.error=void 0,this.Sn=!1,this.Dn=!1,t(function(t){e.Sn=!0,e.result=t,e.bn&&e.bn(t)},function(t){e.Sn=!0,e.error=t,e.vn&&e.vn(t)})}function xa(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.fn=t,this.dn=e,this.wn=n,this.En=r,this.Tn=i,this.In=0,this.mn=null,this.An=Date.now(),this.reset()}function Pa(t){return"IndexedDbTransactionError"===t.name}var ka=(Va.open=function(t,e,n,r){try{return new Va(e,t.transaction(r,n))}catch(t){throw new Aa(e,t)}},Object.defineProperty(Va.prototype,"Gn",{get:function(){return this.Zn.promise},enumerable:!1,configurable:!0}),Va.prototype.abort=function(t){t&&this.Zn.reject(t),this.aborted||(Gr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Va.prototype.store=function(t){t=this.transaction.objectStore(t);return new La(t)},Va),La=(Ra.prototype.put=function(t,e){t=void 0!==e?(Gr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Gr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Ca(t)},Ra.prototype.add=function(t){return Gr("SimpleDb","ADD",this.store.name,t,t),Ca(this.store.add(t))},Ra.prototype.get=function(e){var n=this;return Ca(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Gr("SimpleDb","GET",n.store.name,e,t),t})},Ra.prototype.delete=function(t){return Gr("SimpleDb","DELETE",this.store.name,t),Ca(this.store.delete(t))},Ra.prototype.count=function(){return Gr("SimpleDb","COUNT",this.store.name),Ca(this.store.count())},Ra.prototype.ts=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.es(e,function(t,e){n.push(e)}).next(function(){return n})},Ra.prototype.ns=function(t,e){Gr("SimpleDb","DELETE ALL",this.store.name);e=this.options(t,e);e.ss=!1;e=this.cursor(e);return this.es(e,function(t,e,n){return n.delete()})},Ra.prototype.rs=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.es(n,e)},Ra.prototype.os=function(r){var t=this.cursor({});return new Ea(function(n,e){t.onerror=function(t){t=qa(t.target.error);e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Ra.prototype.es=function(t,i){var o=[];return new Ea(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new Ta(n),(t=i(n.primaryKey,n.value,e))instanceof Ea&&(t=t.catch(function(t){return e.done(),Ea.reject(t)}),o.push(t)),e.Sn?r():null===e.Yn?n.continue():n.continue(e.Yn)):r()}}).next(function(){return Ea.On(o)})},Ra.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Ra.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ss?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Ra);function Ra(t){this.store=t}function Va(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.Zn=new ba,this.transaction.oncomplete=function(){n.Zn.resolve()},this.transaction.onabort=function(){t.error?n.Zn.reject(new Aa(e,t.error)):n.Zn.resolve()},this.transaction.onerror=function(t){t=qa(t.target.error);n.Zn.reject(new Aa(e,t))}}function Ca(t){return new Ea(function(e,n){t.onsuccess=function(t){t=t.target.result;e(t)},t.onerror=function(t){t=qa(t.target.error);n(t)}})}var Ua=!1;function qa(t){var e=_a.$n(d());if(12.2<=e&&e<13){e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){var n=new qr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ua||(Ua=!0,setTimeout(function(){throw n},0)),n}}return t}function Ma(){return"undefined"!=typeof window?window:null}function Fa(){return"undefined"!=typeof document?document:null}var ja=(za._s=function(t,e,n,r,i){i=new za(t,e,Date.now()+n,r,i);return i.start(n),i},za.prototype.start=function(t){var e=this;this.fs=setTimeout(function(){return e.ds()},t)},za.prototype.pn=function(){return this.ds()},za.prototype.cancel=function(t){null!==this.fs&&(this.clearTimeout(),this.ls.reject(new qr(Ur.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},za.prototype.ds=function(){var e=this;this.cs.ws(function(){return null!==e.fs?(e.clearTimeout(),e.op().then(function(t){return e.ls.resolve(t)})):Promise.resolve()})},za.prototype.clearTimeout=function(){null!==this.fs&&(this.hs(this),clearTimeout(this.fs),this.fs=null)},za),Ba=(Object.defineProperty(Ga.prototype,"ps",{get:function(){return this.Is},enumerable:!1,configurable:!0}),Ga.prototype.ws=function(t){this.enqueue(t)},Ga.prototype.bs=function(t){this.vs(),this.Ss(t)},Ga.prototype.Ds=function(){var t;this.Is||(this.Is=!0,(t=Fa())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ys))},Ga.prototype.enqueue=function(t){return this.vs(),this.Is?new Promise(function(t){}):this.Ss(t)},Ga.prototype.Cs=function(t){var e=this;this.ws(function(){return e.Ts.push(t),e.Ns()})},Ga.prototype.Ns=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.Ts.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return t.sent(),this.Ts.shift(),this.Vs.reset(),[3,4];case 3:if(!Pa(e=t.sent()))throw e;return Gr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Ts.length&&this.Vs.Pn(function(){return n.Ns()}),t.label=5;case 5:return[2]}})})},Ga.prototype.Ss=function(t){var r=this,e=this.Es.then(function(){return r.Ps=!0,t().catch(function(t){throw r.Rs=t,r.Ps=!1,zr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Ps=!1,t})});return this.Es=e},Ga.prototype.Vn=function(t,e,n){var r=this;this.vs(),-1<this.gs.indexOf(t)&&(e=0);n=ja._s(this,t,e,n,function(t){return r.xs(t)});return this.As.push(n),n},Ga.prototype.vs=function(){this.Rs&&Wr()},Ga.prototype.Fs=function(){},Ga.prototype.Os=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Es];case 1:t.sent(),t.label=2;case 2:if(e!==this.Es)return[3,0];t.label=3;case 3:return[2]}})})},Ga.prototype.ks=function(t){for(var e=0,n=this.As;e<n.length;e++)if(n[e].dn===t)return!0;return!1},Ga.prototype.Ms=function(r){var i=this;return this.Os().then(function(){i.As.sort(function(t,e){return t.us-e.us});for(var t=0,e=i.As;t<e.length;t++){var n=e[t];if(n.pn(),"all"!==r&&n.dn===r)break}return i.Os()})},Ga.prototype.$s=function(t){this.gs.push(t)},Ga.prototype.xs=function(t){t=this.As.indexOf(t);this.As.splice(t,1)},Ga);function Ga(){var e=this;this.Es=Promise.resolve(),this.Ts=[],this.Is=!1,this.As=[],this.Rs=null,this.Ps=!1,this.gs=[],this.Vs=new Ia(this,"async_queue_retry"),this.ys=function(){var t=Fa();t&&Gr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Vs.yn()};var t=Fa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ys)}function za(t,e,n,r,i){this.cs=t,this.dn=e,this.us=n,this.op=r,this.hs=i,this.ls=new ba,this.then=this.ls.promise.then.bind(this.ls.promise),this.ls.promise.catch(function(t){})}function Ka(t,e){if(zr("AsyncQueue",e+": "+t),Pa(t))return new qr(Ur.UNAVAILABLE,e+": "+t);throw t}function Ha(){this.Bs=new gi(Mu,qu),this.onlineState="Unknown",this.qs=new Set}var Wa=function(){this.Ls=void 0,this.listeners=[]};function Ja(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.Bs.get(n))||(r=!0,i=new Wa),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.Us(n)];case 2:return o.Ls=t.sent(),[3,4];case 3:return o=t.sent(),o=Ka(o,"Initialization of query '"+Fu(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.Bs.set(n,i),i.listeners.push(u),u.Ks(e.onlineState),i.Ls&&u.Qs(i.Ls)&&Ya(e),[2]}})})}function Qa(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.Bs.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.Bs.delete(n),e.Ws(n))]:[2]})})}function Ya(t){t.qs.forEach(function(t){t.next()})}var Xa=(tc.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new ho(t.query,t.docs,t.Kt,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Gs?this.Hs(t)&&(this.js.next(t),o=!0):this.Js(t,this.onlineState)&&(this.Ys(t),o=!0),this.zs=t,o},tc.prototype.onError=function(t){this.js.error(t)},tc.prototype.Ks=function(t){this.onlineState=t;var e=!1;return this.zs&&!this.Gs&&this.Js(this.zs,t)&&(this.Ys(this.zs),e=!0),e},tc.prototype.Js=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Xs&&n||t.docs.P()&&"Offline"!==e)},tc.prototype.Hs=function(t){if(0<t.docChanges.length)return!0;var e=this.zs&&this.zs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},tc.prototype.Ys=function(t){t=ho.Gt(t.query,t.docs,t.Qt,t.fromCache),this.Gs=!0,this.js.next(t)},tc),$a=(Za.prototype.Zs=function(){return null!=this.uid},Za.prototype.ti=function(){return this.Zs()?"uid:"+this.uid:"anonymous-user"},Za.prototype.isEqual=function(t){return t.uid===this.uid},Za);function Za(t){this.uid=t}function tc(t,e,n){this.query=t,this.js=e,this.Gs=!1,this.zs=null,this.onlineState="Unknown",this.options=n||{}}$a.UNAUTHENTICATED=new $a(null),$a.ei=new $a("google-credentials-uid"),$a.ni=new $a("first-party-uid");function ec(t,e){this.user=e,this.type="OAuth",this.si={},this.si.Authorization="Bearer "+t}var nc=(Ec.prototype.getToken=function(){return Promise.resolve(null)},Ec.prototype.ri=function(){},Ec.prototype.oi=function(t){(this.ii=t)($a.UNAUTHENTICATED)},Ec.prototype.ai=function(){this.ii=null},Ec),rc=(Ic.prototype.getToken=function(){var e=this,n=this.hi,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.hi!==n?(Gr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Jr("string"==typeof t.accessToken),new ec(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Ic.prototype.ri=function(){this.forceRefresh=!0},Ic.prototype.oi=function(t){this.ii=t,this.ui&&t(this.currentUser)},Ic.prototype.ai=function(){this.auth&&this.auth.removeAuthTokenListener(this.ci),this.ci=null,this.ii=null},Ic.prototype.li=function(){var t=this.auth&&this.auth.getUid();return Jr(null===t||"string"==typeof t),new $a(t)},Ic),ic=(Object.defineProperty(bc.prototype,"si",{get:function(){var t={"X-Goog-AuthUser":this.fi},e=this._i.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),bc),oc=(wc.prototype.getToken=function(){return Promise.resolve(new ic(this._i,this.fi))},wc.prototype.oi=function(t){t($a.ni)},wc.prototype.ai=function(){},wc.prototype.ri=function(){},wc),sc=(mc.prototype.wi=function(t,e,n){for(var r=n.Ei,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Ks(o,e,r[i]))}return e},mc.prototype.Ti=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Hs(i,e,e,this.di))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Hs(a,e,o,this.di))}return e},mc.prototype.Ii=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Ti(t.key,n.get(t.key));e&&(i=i.ot(t.key,e))}),i},mc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},so())},mc.prototype.isEqual=function(t){return this.batchId===t.batchId&&$r(this.mutations,t.mutations,Ws)&&$r(this.baseMutations,t.baseMutations,Ws)},mc),uc=(gc.from=function(t,e,n){Jr(t.mutations.length===n.length);for(var r=io,i=t.mutations,o=0;o<i.length;o++)r=r.ot(i[o].key,n[o].version);return new gc(t,e,n,r)},gc),l=(Object.defineProperty(vc.prototype,"readTime",{get:function(){return this.gi},set:function(t){this.gi=t},enumerable:!1,configurable:!0}),vc.prototype.Vi=function(t,e){this.yi(),this.readTime=e,this.Ri.set(t.key,t)},vc.prototype.pi=function(t,e){this.yi(),e&&(this.readTime=e),this.Ri.set(t,null)},vc.prototype.bi=function(t,e){this.yi();var n=this.Ri.get(e);return void 0!==n?Ea.resolve(n):this.vi(t,e)},vc.prototype.getEntries=function(t,e){return this.Si(t,e)},vc.prototype.apply=function(t){return this.yi(),this.Pi=!0,this.Di(t)},vc.prototype.yi=function(){},vc),ac="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Te=(yc.prototype.Ni=function(t){this.Ci.push(t)},yc.prototype.xi=function(){this.Ci.forEach(function(t){return t()})},yc),cc=(dc.prototype.Mi=function(e,n){var r=this;return this.Oi.$i(e,n).next(function(t){return r.Li(e,n,t)})},dc.prototype.Li=function(t,r,i){return this.Fi.bi(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Ti(r,t);return t})},dc.prototype.Bi=function(t,e,i){var o=to;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Ti(t,e);o=o.ot(t,e)}),o},dc.prototype.qi=function(e,t){var n=this;return this.Fi.getEntries(e,t).next(function(t){return n.Ui(e,t)})},dc.prototype.Ui=function(e,r){var i=this;return this.Oi.Ki(e,r).next(function(t){var t=i.Bi(e,r,t),n=to;return t.forEach(function(t,e){e=e||new bu(t,wi.min()),n=n.ot(t,e)}),n})},dc.prototype.Qi=function(t,e,n){return r=e,_i.X(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Wi(t,e.path):ku(e)?this.ji(t,e,n):this.Gi(t,e,n);var r},dc.prototype.Wi=function(t,e){return this.Mi(t,new _i(e)).next(function(t){var e=ro;return t instanceof wu&&(e=e.ot(t.key,t)),e})},dc.prototype.ji=function(n,r,i){var o=this,s=r.collectionGroup,u=ro;return this.ki.zi(n,s).next(function(t){return Ea.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new Eu(t,null,e.on.slice(),e.filters.slice(),e.limit,e.an,e.startAt,e.endAt));return o.Gi(n,e,i).next(function(t){t.forEach(function(t,e){u=u.ot(t,e)})})}).next(function(){return u})})},dc.prototype.Gi=function(e,n,t){var c,h,r=this;return this.Fi.Qi(e,n,t).next(function(t){return c=t,r.Oi.Hi(e,n)}).next(function(t){return h=t,r.Ji(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),a=Hs(s,a,a,r.di);c=a instanceof wu?c.ot(u,a):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){ju(n,e)||(c=c.remove(t))}),c})},dc.prototype.Ji=function(t,e,n){for(var r=so(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof $s&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Fi.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof wu&&(c=c.ot(t,e))}),c})},dc),hc=(pc.Zi=function(t,e){for(var n=so(),r=so(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new pc(t,e.fromCache,n,r)},pc),lc=(fc.prototype.er=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},fc.prototype.next=function(){var t=++this.previousValue;return this.nr&&this.nr(t),t},fc);function fc(t,e){var n=this;this.previousValue=t,e&&(e.tr=function(t){return n.er(t)},this.nr=function(t){return e.sr(t)})}function pc(t,e,n,r){this.targetId=t,this.fromCache=e,this.Yi=n,this.Xi=r}function dc(t,e,n){this.Fi=t,this.Oi=e,this.ki=n}function yc(){this.Ci=[]}function vc(){this.Ri=new gi(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.Pi=!1}function gc(t,e,n,r){this.batch=t,this.mi=e,this.Ei=n,this.Ai=r}function mc(t,e,n,r){this.batchId=t,this.di=e,this.baseMutations=n,this.mutations=r}function wc(t,e){this._i=t,this.fi=e}function bc(t,e){this._i=t,this.fi=e,this.type="FirstParty",this.user=$a.ni}function Ic(t){var e=this;this.ci=null,this.currentUser=$a.UNAUTHENTICATED,this.ui=!1,this.hi=0,this.ii=null,this.forceRefresh=!1,this.ci=function(){e.hi++,e.currentUser=e.li(),e.ui=!0,e.ii&&e.ii(e.currentUser)},this.hi=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.ci):(this.ci(null),t.get().then(function(t){e.auth=t,e.ci&&e.auth.addAuthTokenListener(e.ci)},function(){}))}function Ec(){this.ii=null}function _c(t,e){var n=t[0],r=t[1],t=e[0],e=e[1],t=Xr(n,t);return 0===t?Xr(r,e):t}lc.ir=-1;var Tc=(Sc.prototype.cr=function(){return++this.ar},Sc.prototype.ur=function(t){var e=[t,this.cr()];this.buffer.size<this.rr?this.buffer=this.buffer.add(e):_c(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Sc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Sc),Ac={hr:!1,lr:0,_r:0,dr:0},Nc=(Dc.Ir=function(t){return new Dc(t,Dc.mr,Dc.Ar)},Dc);function Dc(t,e,n){this.wr=t,this.Er=e,this.Tr=n}function Sc(t){this.rr=t,this.buffer=new $i(_c),this.ar=0}Nc.mr=10,Nc.Ar=1e3,Nc.Rr=new Nc(41943040,Nc.mr,Nc.Ar),Nc.Pr=new Nc(-1,0,0);var Oc=(kc.prototype.start=function(t){-1!==this.gr.params.wr&&this.pr(t)},kc.prototype.stop=function(){this.yr&&(this.yr.cancel(),this.yr=null)},Object.defineProperty(kc.prototype,"br",{get:function(){return null!==this.yr},enumerable:!1,configurable:!0}),kc.prototype.pr=function(n){var t=this,e=this.Vr?3e5:6e4;Gr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.yr=this.cs.Vn("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.yr=null,this.Vr=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.vr(this.gr)];case 2:return t.sent(),[3,7];case 3:return Pa(e=t.sent())?(Gr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,ll(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.pr(n)];case 8:return t.sent(),[2]}})})})},kc),xc=(Pc.prototype.Dr=function(t,e){return this.Sr.Cr(t).next(function(t){return Math.floor(e/100*t)})},Pc.prototype.Nr=function(t,e){var n=this;if(0===e)return Ea.resolve(lc.ir);var r=new Tc(e);return this.Sr.Ce(t,function(t){return r.ur(t.sequenceNumber)}).next(function(){return n.Sr.Fr(t,function(t){return r.ur(t)})}).next(function(){return r.maxValue})},Pc.prototype.Or=function(t,e,n){return this.Sr.Or(t,e,n)},Pc.prototype.kr=function(t,e){return this.Sr.kr(t,e)},Pc.prototype.Mr=function(e,n){var r=this;return-1===this.params.wr?(Gr("LruGarbageCollector","Garbage collection skipped; disabled"),Ea.resolve(Ac)):this.$r(e).next(function(t){return t<r.params.wr?(Gr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.wr),Ac):r.Lr(e,n)})},Pc.prototype.$r=function(t){return this.Sr.$r(t)},Pc.prototype.Lr=function(e,n){var r,i,o,s,u,a,c,h=this,l=Date.now();return this.Dr(e,this.params.Er).next(function(t){return i=t>h.params.Tr?(Gr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Tr+" from "+t),h.params.Tr):t,s=Date.now(),h.Nr(e,i)}).next(function(t){return r=t,u=Date.now(),h.Or(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.kr(e,r)}).next(function(t){return c=Date.now(),Br()<=f.DEBUG&&Gr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-l)+"ms"),Ea.resolve({hr:!0,lr:i,_r:o,dr:t})})},Pc);function Pc(t,e){this.Sr=t,this.params=e}function kc(t,e){this.gr=t,this.cs=e,this.Vr=!1,this.yr=null}function Lc(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Rc(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return Rc(e)}function Rc(t){return t+"\x01\x01"}function Vc(t){var e=t.length;if(Jr(2<=e),2===e)return Jr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),bi.U();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&Wr(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Wr()}o=s+2}return new bi(r)}var Cc=function(t){this.Br=t};function Uc(t,e){if(e.document)return n=t.Br,r=e.document,i=!!e.hasCommittedMutations,t=is(n,r.name),n=ts(r.updateTime),r=new hu({mapValue:{fields:r.fields}}),new wu(t,n,r,{hasCommittedMutations:!!i});var n,r;if(e.noDocument){var i=_i.Z(e.noDocument.path),o=Bc(e.noDocument.readTime);return new bu(i,o,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){o=_i.Z(e.unknownDocument.path),e=Bc(e.unknownDocument.version);return new Iu(o,e)}return Wr()}function qc(t,e,n){var r=Mc(n),n=e.key.path.F().L();if(e instanceof wu){var i={name:rs(i=t.Br,(o=e).key),fields:o.rn().mapValue.fields,updateTime:$o(i,o.version.v())},o=e.hasCommittedMutations;return new Eh(null,null,i,o,r,n)}if(e instanceof bu){var i=e.key.path.L(),o=jc(e.version),s=e.hasCommittedMutations;return new Eh(null,new bh(i,o),null,s,r,n)}if(e instanceof Iu){s=e.key.path.L(),e=jc(e.version);return new Eh(new Ih(s,e),null,null,!0,r,n)}return Wr()}function Mc(t){t=t.v();return[t.seconds,t.nanoseconds]}function Fc(t){t=new mi(t[0],t[1]);return wi.V(t)}function jc(t){t=t.v();return new lh(t.seconds,t.nanoseconds)}function Bc(t){t=new mi(t.seconds,t.nanoseconds);return wi.V(t)}function Gc(e,t){var n=(t.baseMutations||[]).map(function(t){return ls(e.Br,t)}),r=t.mutations.map(function(t){return ls(e.Br,t)}),i=mi.fromMillis(t.localWriteTimeMs);return new sc(t.batchId,i,n,r)}function zc(t){var e=Bc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Bc(t.lastLimboFreeSnapshotVersion):wi.min(),r=void 0!==t.query.documents?(Jr(1===(r=t.query).documents.length),Ru(Du(ss(r.documents[0])))):ds(t.query);return new ji(r,t.targetId,0,t.lastListenSequenceNumber,e,n,ti.fromBase64String(t.resumeToken))}function Kc(t,e){var n=jc(e.nt),r=jc(e.lastLimboFreeSnapshotVersion),i=(qi(e.target)?fs:ps)(t.Br,e.target),t=e.resumeToken.toBase64();return new Th(e.targetId,Ci(e.target),n,t,e.sequenceNumber,r,i)}var Hc=(Wc.Kr=function(t,e,n,r){return Jr(""!==t.uid),new Wc(t.Zs()?t.uid:"",e,n,r)},Wc.prototype.Qr=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Yc(t).rs({index:gh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Wc.prototype.Wr=function(d,y,v,g){var m=this,w=Xc(d),b=Yc(d);return b.add({}).next(function(t){Jr("number"==typeof t);for(var e,n,r,i,o,s=new sc(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return hs(e.Br,t)}),o=r.mutations.map(function(t){return hs(e.Br,t)}),new gh(n,r.batchId,r.di.toMillis(),i,o)),a=[],c=new $i(function(t,e){return Xr(t.B(),e.B())}),h=0,l=g;h<l.length;h++){var f=l[h],p=mh.key(m.userId,f.key.path,t),c=c.add(f.key.path.F());a.push(b.put(u)),a.push(w.put(p,mh.PLACEHOLDER))}return c.forEach(function(t){a.push(m.ki.jr(d,t))}),d.Ni(function(){m.Ur[t]=s.keys()}),Ea.On(a).next(function(){return s})})},Wc.prototype.Gr=function(t,e){var n=this;return Yc(t).get(e).next(function(t){return t?(Jr(t.userId===n.userId),Gc(n.serializer,t)):null})},Wc.prototype.zr=function(t,e){var n=this;return this.Ur[e]?Ea.resolve(this.Ur[e]):this.Gr(t,e).next(function(t){if(t){t=t.keys();return n.Ur[e]=t}return null})},Wc.prototype.Hr=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Yc(t).rs({index:gh.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Jr(e.batchId>=i),o=Gc(r.serializer,e)),n.done()}).next(function(){return o})},Wc.prototype.Jr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Yc(t).rs({index:gh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Wc.prototype.Yr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Yc(t).ts(gh.userMutationsIndex,n).next(function(t){return t.map(function(t){return Gc(e.serializer,t)})})},Wc.prototype.$i=function(o,s){var u=this,t=mh.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return Xc(o).rs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Vc(i);if(r===u.userId&&s.path.isEqual(i))return Yc(o).get(t).next(function(t){if(!t)throw Wr();Jr(t.userId===u.userId),a.push(Gc(u.serializer,t))});n.done()}).next(function(){return a})},Wc.prototype.Ki=function(e,t){var s=this,u=new $i(Xr),n=[];return t.forEach(function(o){var t=mh.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=Xc(e).rs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Vc(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),Ea.On(n).next(function(){return s.Xr(e,u)})},Wc.prototype.Hi=function(t,e){var o=this,s=e.path,u=s.length+1,e=mh.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new $i(Xr);return Xc(t).rs({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Vc(i);r===o.userId&&s.M(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.Xr(t,a)})},Wc.prototype.Xr=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Yc(e).get(t).next(function(t){if(null===t)throw Wr();Jr(t.userId===n.userId),r.push(Gc(n.serializer,t))}))}),Ea.On(i).next(function(){return r})},Wc.prototype.Zr=function(e,n){var r=this;return Qc(e.eo,this.userId,n).next(function(t){return e.Ni(function(){r.no(n.batchId)}),Ea.forEach(t,function(t){return r.qr.so(e,t)})})},Wc.prototype.no=function(t){delete this.Ur[t]},Wc.prototype.io=function(e){var i=this;return this.Qr(e).next(function(t){if(!t)return Ea.resolve();var t=IDBKeyRange.lowerBound(mh.prefixForUser(i.userId)),r=[];return Xc(e).rs({range:t},function(t,e,n){t[0]===i.userId?(t=Vc(t[1]),r.push(t)):n.done()}).next(function(){Jr(0===r.length)})})},Wc.prototype.ro=function(t,e){return Jc(t,this.userId,e)},Wc.prototype.oo=function(t){var e=this;return $c(t).get(this.userId).next(function(t){return t||new vh(e.userId,-1,"")})},Wc);function Wc(t,e,n,r){this.userId=t,this.serializer=e,this.ki=n,this.qr=r,this.Ur={}}function Jc(t,o,e){var e=mh.prefixForPath(o,e.path),s=e[1],e=IDBKeyRange.lowerBound(e),u=!1;return Xc(t).rs({range:e,ss:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Qc(t,e,n){var r=t.store(gh.store),i=t.store(mh.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.rs({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Jr(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],l=mh.key(e,h.key.path,n.batchId);o.push(i.delete(l)),u.push(h.key)}return Ea.On(o).next(function(){return u})}function Yc(t){return zh.Kn(t,gh.store)}function Xc(t){return zh.Kn(t,mh.store)}function $c(t){return zh.Kn(t,vh.store)}var Zc,th=(rh.prototype.Vi=function(t,e,n){return oh(t).put(sh(e),n)},rh.prototype.pi=function(t,e){t=oh(t),e=sh(e);return t.delete(e)},rh.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.ao(e,t)})},rh.prototype.bi=function(t,e){var n=this;return oh(t).get(sh(e)).next(function(t){return n.co(t)})},rh.prototype.uo=function(t,e){var n=this;return oh(t).get(sh(e)).next(function(t){var e=n.co(t);return e?{ho:e,size:uh(t)}:null})},rh.prototype.getEntries=function(t,e){var n=this,r=to;return this.lo(t,e,function(t,e){e=n.co(e);r=r.ot(t,e)}).next(function(){return r})},rh.prototype._o=function(t,e){var r=this,i=to,o=new Ki(_i.D);return this.lo(t,e,function(t,e){var n=r.co(e);o=n?(i=i.ot(t,n),o.ot(t,uh(e))):(i=i.ot(t,null),o.ot(t,0))}).next(function(){return{fo:i,do:o}})},rh.prototype.lo=function(t,e,i){if(e.P())return Ea.resolve();var n=IDBKeyRange.bound(e.first().path.L(),e.last().path.L()),o=e._t(),s=o.It();return oh(t).rs({range:n},function(t,e,n){for(var r=_i.Z(t);s&&_i.D(s,r)<0;)i(s,null),s=o.It();s&&s.isEqual(r)&&(i(s,e),s=o.At()?o.It():null),s?n.Xn(s.path.L()):n.done()}).next(function(){for(;s;)i(s,null),s=o.At()?o.It():null})},rh.prototype.Qi=function(t,r,e){var n,i=this,o=ro,s=r.path.length+1,u={};return e.isEqual(wi.min())?(n=r.path.L(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.L(),e=Mc(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=Eh.collectionReadTimeIndex),oh(t).rs(u,function(t,e,n){t.length===s&&(e=Uc(i.serializer,e),r.path.M(e.key.path)?e instanceof wu&&ju(r,e)&&(o=o.ot(e.key,e)):n.done())}).next(function(){return o})},rh.prototype.wo=function(t){return new eh(this,!!t&&t.Eo)},rh.prototype.To=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},rh.prototype.getMetadata=function(t){return ih(t).get(_h.key).next(function(t){return Jr(!!t),t})},rh.prototype.ao=function(t,e){return ih(t).put(_h.key,e)},rh.prototype.co=function(t){if(t){t=Uc(this.serializer,t);return t instanceof bu&&t.version.isEqual(wi.min())?null:t}return null},rh),eh=(n(nh,Zc=l),nh.prototype.Di=function(i){var o=this,s=[],u=0,a=new $i(function(t,e){return Xr(t.B(),e.B())});return this.Ri.forEach(function(t,e){var n,r=o.mo.get(t);e?(n=qc(o.Io.serializer,e,o.readTime),a=a.add(t.path.F()),e=uh(n),u+=e-r,s.push(o.Io.Vi(i,t,n))):(u-=r,o.Eo?(r=qc(o.Io.serializer,new bu(t,wi.min()),o.readTime),s.push(o.Io.Vi(i,t,r))):s.push(o.Io.pi(i,t)))}),a.forEach(function(t){s.push(o.Io.ki.jr(i,t))}),s.push(this.Io.updateMetadata(i,u)),Ea.On(s)},nh.prototype.vi=function(t,e){var n=this;return this.Io.uo(t,e).next(function(t){return null===t?(n.mo.set(e,0),null):(n.mo.set(e,t.size),t.ho)})},nh.prototype.Si=function(t,e){var n=this;return this.Io._o(t,e).next(function(t){var e=t.fo;return t.do.forEach(function(t,e){n.mo.set(t,e)}),e})},nh);function nh(t,e){var n=this;return(n=Zc.call(this)||this).Io=t,n.Eo=e,n.mo=new gi(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function rh(t,e){this.serializer=t,this.ki=e}function ih(t){return zh.Kn(t,_h.store)}function oh(t){return zh.Kn(t,Eh.store)}function sh(t){return t.path.L()}function uh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Wr();e=t.noDocument}return JSON.stringify(e).length}var ah=(yh.prototype.jr=function(t,e){return this.Ao.add(e),Ea.resolve()},yh.prototype.zi=function(t,e){return Ea.resolve(this.Ao.getEntries(e))},yh),ch=(dh.prototype.add=function(t){var e=t.k(),n=t.F(),r=this.index[e]||new $i(bi.D),t=!r.has(n);return this.index[e]=r.add(n),t},dh.prototype.has=function(t){var e=t.k(),t=t.F(),e=this.index[e];return e&&e.has(t)},dh.prototype.getEntries=function(t){return(this.index[t]||new $i(bi.D)).L()},dh),hh=(ph.prototype.createOrUpgrade=function(e,n,t,r){var i=this;Jr(t<r&&0<=t&&r<=10);var o=new ka("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(fh.store),(s=e).createObjectStore(vh.store,{keyPath:vh.keyPath}),s.createObjectStore(gh.store,{keyPath:gh.keyPath,autoIncrement:!0}).createIndex(gh.userMutationsIndex,gh.userMutationsKeyPath,{unique:!0}),s.createObjectStore(mh.store),Sh(e),e.createObjectStore(Eh.store));var s,u=Ea.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(Ah.store),s.deleteObjectStore(Th.store),s.deleteObjectStore(Nh.store),Sh(e)),u=u.next(function(){return t=o.store(Nh.store),e=new Nh(0,0,wi.min().v(),0),t.put(Nh.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(gh.store).ts().next(function(t){n.deleteObjectStore(gh.store),n.createObjectStore(gh.store,{keyPath:gh.keyPath,autoIncrement:!0}).createIndex(gh.userMutationsIndex,gh.userMutationsKeyPath,{unique:!0});var e=r.store(gh.store),t=t.map(function(t){return e.put(t)});return Ea.On(t)});var n,r})),u=u.next(function(){e.createObjectStore(Oh.store,{keyPath:Oh.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.removeAcknowledgedMutations(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore(_h.store),i.addDocumentGlobal(o)})),t<7&&7<=r&&(u=u.next(function(){return i.ensureSequenceNumbers(o)})),t<8&&8<=r&&(u=u.next(function(){return i.createCollectionParentIndex(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Eh.store)).createIndex(Eh.readTimeIndex,Eh.readTimeIndexPath,{unique:!1}),t.createIndex(Eh.collectionReadTimeIndex,Eh.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.rewriteCanonicalIds(o)})),u},ph.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Eh.store).rs(function(t,e){n+=uh(e)}).next(function(){var t=new _h(n);return e.store(_h.store).put(_h.key,t)})},ph.prototype.removeAcknowledgedMutations=function(n){var r=this,t=n.store(vh.store),i=n.store(gh.store);return t.ts().next(function(t){return Ea.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.ts(gh.userMutationsIndex,t).next(function(t){return Ea.forEach(t,function(t){Jr(t.userId===e.userId);t=Gc(r.serializer,t);return Qc(n,e.userId,t).next(function(){})})})})})},ph.prototype.ensureSequenceNumbers=function(t){var o=t.store(Ah.store),e=t.store(Eh.store);return t.store(Nh.store).get(Nh.key).next(function(r){var i=[];return e.rs(function(t,e){var n=new bi(t),t=[0,Lc(n)];i.push(o.get(t).next(function(t){return t?Ea.resolve():o.put(new Ah(0,Lc(n),r.highestListenSequenceNumber))}))}).next(function(){return Ea.On(i)})})},ph.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Dh.store,{keyPath:Dh.keyPath});function r(t){if(i.add(t)){var e=t.k(),t=t.F();return n.put({collectionId:e,parent:Lc(t)})}}var n=e.store(Dh.store),i=new ch;return e.store(Eh.store).rs({ss:!0},function(t,e){t=new bi(t);return r(t.F())}).next(function(){return e.store(mh.store).rs({ss:!0},function(t,e){t[0];var n=t[1],n=(t[2],Vc(n));return r(n.F())})})},ph.prototype.rewriteCanonicalIds=function(t){var n=this,r=t.store(Th.store);return r.rs(function(t,e){e=zc(e),e=Kc(n.serializer,e);return r.put(e)})},ph),lh=function(t,e){this.seconds=t,this.nanoseconds=e},fh=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function ph(t){this.serializer=t}function dh(){this.index={}}function yh(){this.Ao=new ch}fh.store="owner",fh.key="owner";var vh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};vh.store="mutationQueues",vh.keyPath="userId";var gh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};gh.store="mutations",gh.keyPath="batchId",gh.userMutationsIndex="userMutationsIndex",gh.userMutationsKeyPath=["userId","batchId"];var mh=(wh.prefixForUser=function(t){return[t]},wh.prefixForPath=function(t,e){return[t,Lc(e)]},wh.key=function(t,e,n){return[t,Lc(e),n]},wh);function wh(){}mh.store="documentMutations",mh.PLACEHOLDER=new mh;var bh=function(t,e){this.path=t,this.readTime=e},Ih=function(t,e){this.path=t,this.version=e},Eh=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Eh.store="remoteDocuments",Eh.readTimeIndex="readTimeIndex",Eh.readTimeIndexPath="readTime",Eh.collectionReadTimeIndex="collectionReadTimeIndex",Eh.collectionReadTimeIndexPath=["parentPath","readTime"];var _h=function(t){this.byteSize=t};_h.store="remoteDocumentGlobal",_h.key="remoteDocumentGlobalKey";var Th=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Th.store="targets",Th.keyPath="targetId",Th.queryTargetsIndexName="queryTargetsIndex",Th.queryTargetsKeyPath=["canonicalId","targetId"];var Ah=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ah.store="targetDocuments",Ah.keyPath=["targetId","path"],Ah.documentTargetsIndex="documentTargetsIndex",Ah.documentTargetsKeyPath=["path","targetId"];var Nh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Nh.key="targetGlobalKey",Nh.store="targetGlobal";var Dh=function(t,e){this.collectionId=t,this.parent=e};function Sh(t){t.createObjectStore(Ah.store,{keyPath:Ah.keyPath}).createIndex(Ah.documentTargetsIndex,Ah.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Th.store,{keyPath:Th.keyPath}).createIndex(Th.queryTargetsIndexName,Th.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Nh.store)}Dh.store="collectionParents",Dh.keyPath=["collectionId","parent"];var Oh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Oh.store="clientMetadata",Oh.keyPath="clientId";var xh=o(o(o([vh.store,gh.store,mh.store,Eh.store,Th.store,fh.store,Nh.store,Ah.store],[Oh.store]),[_h.store]),[Dh.store]),Ph=(kh.prototype.jr=function(t,e){var n=this;if(this.Ro.has(e))return Ea.resolve();var r=e.k(),i=e.F();t.Ni(function(){n.Ro.add(e)});i={collectionId:r,parent:Lc(i)};return Lh(t).put(i)},kh.prototype.zi=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Zr(i),""],!1,!0);return Lh(t).ts(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Vc(r.parent))}return o})},kh);function kh(){this.Ro=new ch}function Lh(t){return zh.Kn(t,Dh.store)}var Rh=(Uh.prototype.next=function(){return this.Po+=2,this.Po},Uh.Vo=function(){return new Uh(0)},Uh.yo=function(){return new Uh(-1)},Uh),Vh=(Ch.prototype.po=function(n){var r=this;return this.bo(n).next(function(t){var e=new Rh(t.highestTargetId);return t.highestTargetId=e.next(),r.vo(n,t).next(function(){return t.highestTargetId})})},Ch.prototype.So=function(t){return this.bo(t).next(function(t){return wi.V(new mi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Ch.prototype.Do=function(t){return this.bo(t).next(function(t){return t.highestListenSequenceNumber})},Ch.prototype.Co=function(e,n,r){var i=this;return this.bo(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.v()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.vo(e,t)})},Ch.prototype.No=function(e,n){var r=this;return this.xo(e,n).next(function(){return r.bo(e).next(function(t){return t.targetCount+=1,r.Fo(n,t),r.vo(e,t)})})},Ch.prototype.Oo=function(t,e){return this.xo(t,e)},Ch.prototype.ko=function(e,t){var n=this;return this.Mo(e,t.targetId).next(function(){return qh(e).delete(t.targetId)}).next(function(){return n.bo(e)}).next(function(t){return Jr(0<t.targetCount),--t.targetCount,n.vo(e,t)})},Ch.prototype.Or=function(n,r,i){var o=this,s=0,u=[];return qh(n).rs(function(t,e){e=zc(e);e.sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.ko(n,e)))}).next(function(){return Ea.On(u)}).next(function(){return s})},Ch.prototype.Ce=function(t,n){return qh(t).rs(function(t,e){e=zc(e);n(e)})},Ch.prototype.bo=function(t){return Mh(t).get(Nh.key).next(function(t){return Jr(null!==t),t})},Ch.prototype.vo=function(t,e){return Mh(t).put(Nh.key,e)},Ch.prototype.xo=function(t,e){return qh(t).put(Kc(this.serializer,e))},Ch.prototype.Fo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Ch.prototype.$o=function(t){return this.bo(t).next(function(t){return t.targetCount})},Ch.prototype.Lo=function(t,r){var e=Ci(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return qh(t).rs({range:e,index:Th.queryTargetsIndexName},function(t,e,n){e=zc(e);Ui(r,e.target)&&(i=e,n.done())}).next(function(){return i})},Ch.prototype.Bo=function(n,t,r){var i=this,o=[],s=Fh(n);return t.forEach(function(t){var e=Lc(t.path);o.push(s.put(new Ah(r,e))),o.push(i.qr.qo(n,r,t))}),Ea.On(o)},Ch.prototype.Uo=function(n,t,r){var i=this,o=Fh(n);return Ea.forEach(t,function(t){var e=Lc(t.path);return Ea.On([o.delete([r,e]),i.qr.Ko(n,r,t)])})},Ch.prototype.Mo=function(t,e){t=Fh(t),e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)},Ch.prototype.Qo=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Fh(t),r=so();return t.rs({range:e,ss:!0},function(t,e,n){t=Vc(t[1]),t=new _i(t);r=r.add(t)}).next(function(){return r})},Ch.prototype.ro=function(t,e){var e=Lc(e.path),e=IDBKeyRange.bound([e],[Zr(e)],!1,!0),i=0;return Fh(t).rs({index:Ah.documentTargetsIndex,ss:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Ch.prototype.Ue=function(t,e){return qh(t).get(e).next(function(t){return t?zc(t):null})},Ch);function Ch(t,e){this.qr=t,this.serializer=e}function Uh(t){this.Po=t}function qh(t){return zh.Kn(t,Th.store)}function Mh(t){return zh.Kn(t,Nh.store)}function Fh(t){return zh.Kn(t,Ah.store)}var jh,Bh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Gh=(n(Hh,jh=Te),Hh),zh=(Kh.Kn=function(t,e){if(t instanceof Gh)return _a.Kn(t.eo,e);throw Wr()},Kh.prototype.start=function(){var e=this;return this.ra().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new qr(Ur.FAILED_PRECONDITION,Bh);return e.oa(),e.aa(),e.ca(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.sa.Do(t)})}).then(function(t){e.zo=new lc(t,e.jo)}).then(function(){e.Ho=!0}).catch(function(t){return e.na&&e.na.close(),Promise.reject(t)})},Kh.prototype.ua=function(n){var t=this;return this.ta=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.br?[2,n(e)]:[2]})})},n(this.isPrimary)},Kh.prototype.ha=function(n){var t=this;this.na.jn(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Kh.prototype.la=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fn.ws(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.br?[4,this.ra()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Kh.prototype.ra=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Jh(e).put(new Oh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n._a(e).next(function(t){t||(n.isPrimary=!1,n.fn.Cs(function(){return n.ta(!1)}))})}).next(function(){return n.fa(e)}).next(function(t){return n.isPrimary&&!t?n.da(e).next(function(){return!1}):!!t&&n.wa(e).next(function(){return!0})})}).catch(function(t){if(Pa(t))return Gr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Gr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.fn.Cs(function(){return n.ta(t)}),n.isPrimary=t})},Kh.prototype._a=function(t){var e=this;return Wh(t).get(fh.key).next(function(t){return Ea.resolve(e.Ea(t))})},Kh.prototype.Ta=function(t){return Jh(t).delete(this.clientId)},Kh.prototype.Ia=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.ma(this.Zo,18e5)?[3,2]:(this.Zo=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Kh.Kn(t,Oh.store);return r.ts().next(function(t){var e=o.Aa(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Ea.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.ia)for(n=0,r=e;n<r.length;n++)i=r[n],this.ia.removeItem(this.Ra(i.clientId));t.label=2;case 2:return[2]}})})},Kh.prototype.ca=function(){var t=this;this.Xo=this.fn.Vn("client_metadata_refresh",4e3,function(){return t.ra().then(function(){return t.Ia()}).then(function(){return t.ca()})})},Kh.prototype.Ea=function(t){return!!t&&t.ownerId===this.clientId},Kh.prototype.fa=function(e){var r=this;return this.Go?Ea.resolve(!0):Wh(e).get(fh.key).next(function(t){if(null!==t&&r.ma(t.leaseTimestampMs,5e3)&&!r.Pa(t.ownerId)){if(r.Ea(t)&&r.networkEnabled)return!0;if(!r.Ea(t)){if(!t.allowTabSynchronization)throw new qr(Ur.FAILED_PRECONDITION,Bh);return!1}}return!(!r.networkEnabled||!r.inForeground)||Jh(e).ts().next(function(t){return void 0===r.Aa(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&Gr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Kh.prototype.ga=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.Ho=!1,this.Va(),this.Xo&&(this.Xo.cancel(),this.Xo=null),this.ya(),this.pa(),[4,this.na.runTransaction("shutdown","readwrite",[fh.store,Oh.store],function(t){var e=new Gh(t,lc.ir);return n.da(e).next(function(){return n.Ta(e)})})];case 1:return t.sent(),this.na.close(),this.ba(),[2]}})})},Kh.prototype.Aa=function(t,e){var n=this;return t.filter(function(t){return n.ma(t.updateTimeMs,e)&&!n.Pa(t.clientId)})},Kh.prototype.va=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return Jh(t).ts().next(function(t){return e.Aa(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(Kh.prototype,"br",{get:function(){return this.Ho},enumerable:!1,configurable:!0}),Kh.prototype.Sa=function(t){return Hc.Kr(t,this.serializer,this.ki,this.qr)},Kh.prototype.Da=function(){return this.sa},Kh.prototype.Ca=function(){return this.Fi},Kh.prototype.Na=function(){return this.ki},Kh.prototype.runTransaction=function(e,n,r){var i=this;Gr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.na.runTransaction(e,t,xh,function(t){return o=new Gh(t,i.zo?i.zo.next():lc.ir),"readwrite-primary"===n?i._a(o).next(function(t){return!!t||i.fa(o)}).next(function(t){if(!t)throw zr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.fn.Cs(function(){return i.ta(!1)}),new qr(Ur.FAILED_PRECONDITION,ac);return r(o)}).next(function(t){return i.wa(o).next(function(){return t})}):i.xa(o).next(function(){return r(o)})}).then(function(t){return o.xi(),t})},Kh.prototype.xa=function(t){var e=this;return Wh(t).get(fh.key).next(function(t){if(null!==t&&e.ma(t.leaseTimestampMs,5e3)&&!e.Pa(t.ownerId)&&!e.Ea(t)&&!(e.Go||e.allowTabSynchronization&&t.allowTabSynchronization))throw new qr(Ur.FAILED_PRECONDITION,Bh)})},Kh.prototype.wa=function(t){var e=new fh(this.clientId,this.allowTabSynchronization,Date.now());return Wh(t).put(fh.key,e)},Kh.Ln=function(){return _a.Ln()},Kh.prototype.da=function(t){var e=this,n=Wh(t);return n.get(fh.key).next(function(t){return e.Ea(t)?(Gr("IndexedDbPersistence","Releasing primary lease."),n.delete(fh.key)):Ea.resolve()})},Kh.prototype.ma=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(zr("Detected an update time that is in the future: "+t+" > "+n),1))},Kh.prototype.oa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Yo=function(){t.fn.ws(function(){return t.inForeground="visible"===t.document.visibilityState,t.ra()})},this.document.addEventListener("visibilitychange",this.Yo),this.inForeground="visible"===this.document.visibilityState)},Kh.prototype.ya=function(){this.Yo&&(this.document.removeEventListener("visibilitychange",this.Yo),this.Yo=null)},Kh.prototype.aa=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Jo=function(){e.Va(),e.fn.ws(function(){return e.ga()})},this.window.addEventListener("unload",this.Jo))},Kh.prototype.pa=function(){this.Jo&&(this.window.removeEventListener("unload",this.Jo),this.Jo=null)},Kh.prototype.Pa=function(t){try{var e=null!==(null===(e=this.ia)||void 0===e?void 0:e.getItem(this.Ra(t)));return Gr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return zr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Kh.prototype.Va=function(){if(this.ia)try{this.ia.setItem(this.Ra(this.clientId),String(Date.now()))}catch(t){zr("Failed to set zombie client id.",t)}},Kh.prototype.ba=function(){if(this.ia)try{this.ia.removeItem(this.Ra(this.clientId))}catch(t){}},Kh.prototype.Ra=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Kh);function Kh(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.fn=i,this.window=o,this.document=s,this.jo=a,this.Go=c,this.zo=null,this.Ho=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Jo=null,this.inForeground=!1,this.Yo=null,this.Xo=null,this.Zo=Number.NEGATIVE_INFINITY,this.ta=function(t){return Promise.resolve()},!Kh.Ln())throw new qr(Ur.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.qr=new Qh(this,r),this.ea=e+"main",this.serializer=new Cc(u),this.na=new _a(this.ea,10,new hh(this.serializer)),this.sa=new Vh(this.qr,this.serializer),this.ki=new Ph,this.Fi=(e=this.serializer,u=this.ki,new th(e,u)),this.window&&this.window.localStorage?this.ia=this.window.localStorage:(this.ia=null,!1===c&&zr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Hh(t,e){var n=this;return(n=jh.call(this)||this).eo=t,n.Wo=e,n}function Wh(t){return zh.Kn(t,fh.store)}function Jh(t){return zh.Kn(t,Oh.store)}var Qh=(Yh.prototype.Cr=function(t){var n=this.Fa(t);return this.db.Da().$o(t).next(function(e){return n.next(function(t){return e+t})})},Yh.prototype.Fa=function(t){var e=0;return this.Fr(t,function(t){e++}).next(function(){return e})},Yh.prototype.Ce=function(t,e){return this.db.Da().Ce(t,e)},Yh.prototype.Fr=function(t,n){return this.Oa(t,function(t,e){return n(e)})},Yh.prototype.qo=function(t,e,n){return Xh(t,n)},Yh.prototype.Ko=function(t,e,n){return Xh(t,n)},Yh.prototype.Or=function(t,e,n){return this.db.Da().Or(t,e,n)},Yh.prototype.so=Xh,Yh.prototype.ka=function(t,e){return r=e,i=!1,$c(n=t).os(function(t){return Jc(n,t,r).next(function(t){return t&&(i=!0),Ea.resolve(!t)})}).next(function(){return i});var n,r,i},Yh.prototype.kr=function(n,r){var i=this,o=this.db.Ca().wo(),s=[],u=0;return this.Oa(n,function(e,t){t<=r&&(t=i.ka(n,e).next(function(t){if(!t)return u++,o.bi(n,e).next(function(){return o.pi(e),Fh(n).delete([0,Lc(e.path)])})}),s.push(t))}).next(function(){return Ea.On(s)}).next(function(){return o.apply(n)}).next(function(){return u})},Yh.prototype.removeTarget=function(t,e){e=e.st(t.Wo);return this.db.Da().Oo(t,e)},Yh.prototype.Ma=Xh,Yh.prototype.Oa=function(t,r){var i,t=Fh(t),o=lc.ir;return t.rs({index:Ah.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==lc.ir&&r(new _i(Vc(i)),o),o=e,i=t):o=lc.ir}).next(function(){o!==lc.ir&&r(new _i(Vc(i)),o)})},Yh.prototype.$r=function(t){return this.db.Ca().To(t)},Yh);function Yh(t,e){this.db=t,this.gr=new xc(this,e)}function Xh(t,e){return Fh(t).put((t=t.Wo,new Ah(0,Lc(e.path),t)))}function $h(t,e){var n=t.projectId;return t.I||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Zh=(tl.prototype.vr=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Mr(t,n.La)})},tl);function tl(t,e,n){this.persistence=t,this.$a=e,this.La=new Ki(Xr),this.Ba=new gi(Ci,Ui),this.qa=wi.min(),this.Oi=t.Sa(n),this.Ua=t.Ca(),this.sa=t.Da(),this.Ka=new cc(this.Ua,this.Oi,this.persistence.Na()),this.$a.Qa(this.Ka)}function el(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Oi,m=e.Ka,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Oi.Yr(v).next(function(t){return g=t,n=e.persistence.Sa(o),m=new cc(e.Ua,n,e.persistence.Na()),n.Yr(v)}).next(function(t){for(var e=[],n=[],r=so(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var p=0,d=f.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.qi(v,r).next(function(t){return{Wa:t,ja:e,Ga:n}})})})];case 1:return r=t.sent(),[2,(e.Oi=n,e.Ka=m,e.$a.Qa(e.Ka),r)]}})})}function nl(t,h){var l=t;return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,u,a=h.batch.keys(),c=l.Ua.wo({Eo:!0});return e=l,r=t,o=c,s=(i=h).batch,n=s.keys(),u=Ea.resolve(),n.forEach(function(n){u=u.next(function(){return o.bi(r,n)}).next(function(t){var e=t,t=i.Ai.get(n);Jr(null!==t),(!e||e.version.u(t)<0)&&(e=s.wi(n,e,i))&&o.Vi(e,i.mi)})}),u.next(function(){return e.Oi.Zr(r,s)}).next(function(){return c.apply(t)}).next(function(){return l.Oi.io(t)}).next(function(){return l.Ka.qi(t,a)})})}function rl(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.sa.So(t)})}function il(t,a){var c=t,h=a.nt,l=c.La;return c.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var i=c.Ua.wo({Eo:!0});l=c.La;var u=[];a.zt.forEach(function(t,e){var n,r,i,o=l.get(e);o&&(u.push(c.sa.Uo(s,t.se,e).next(function(){return c.sa.Bo(s,t.ee,e)})),0<(i=t.resumeToken).o()&&(n=o.it(i,h).st(s.Wo),l=l.ot(e,n),r=o,i=t,Jr(0<(o=n).resumeToken.o()),(0===r.resumeToken.o()||3e8<=o.nt.p()-r.nt.p()||0<i.ee.size+i.ne.size+i.se.size)&&u.push(c.sa.Oo(s,n))))});var t,o=to,n=so();return a.Jt.forEach(function(t,e){n=n.add(t)}),u.push(i.getEntries(s,n).next(function(r){a.Jt.forEach(function(t,e){var n=r.get(t);e instanceof bu&&e.version.isEqual(wi.min())?(i.pi(t,h),o=o.ot(t,e)):null==n||0<e.version.u(n.version)||0===e.version.u(n.version)&&n.hasPendingWrites?(i.Vi(e,h),o=o.ot(t,e)):Gr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Yt.has(t)&&u.push(c.persistence.qr.Ma(s,t))})})),h.isEqual(wi.min())||(t=c.sa.So(s).next(function(t){return c.sa.Co(s,s.Wo,h)}),u.push(t)),Ea.On(u).next(function(){return i.apply(s)}).next(function(){return c.Ka.Ui(s,o)})}).then(function(t){return c.La=l,t})}function ol(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.sa.Lo(e,r).next(function(t){return t?(n=t,Ea.resolve(n)):i.sa.po(e).next(function(t){return n=new ji(r,t,0,e.Wo),i.sa.No(e,n).next(function(){return n})})})}).then(function(t){var e=i.La.get(t.targetId);return(null===e||0<t.nt.u(e.nt))&&(i.La=i.La.ot(t.targetId,t),i.Ba.set(r,t.targetId)),t})}function sl(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).La.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.qr.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Pa(r=t.sent()))throw r;return Gr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.La=e.La.remove(o),e.Ba.delete(n.target),[2]}})})}function ul(t,o,s){var u=t,a=wi.min(),c=so();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=Ru(o),(void 0!==(t=(i=t).Ba.get(r))?Ea.resolve(i.La.get(t)):i.sa.Lo(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.sa.Qo(e,t.targetId).next(function(t){c=t})}).next(function(){return u.$a.Qi(e,o,s?a:wi.min(),s?c:so())}).next(function(t){return{documents:t,za:c}});var t,n,r,i})}function al(t,e){var n=t,r=n.sa,t=n.La.get(e);return t?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Ue(t,e).next(function(t){return t?t.target:null})})}function cl(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Ua,n=t,t=s.qa,r=e,i=to,o=Mc(t),t=oh(n),n=IDBKeyRange.lowerBound(o,!0),t.rs({index:Eh.readTimeIndex,range:n},function(t,e){var n=Uc(r.serializer,e);i=i.ot(n.key,n),o=e.readTime}).next(function(){return{Ha:i,readTime:Fc(o)}});var e,n,r,i,o}).then(function(t){var e=t.Ha,t=t.readTime;return s.qa=t,e})}function hl(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=oh(t),r=wi.min(),t.rs({index:Eh.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=Fc(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.qa=t})]})})}function ll(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Ur.FAILED_PRECONDITION||e.message!==ac)throw e;return Gr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function fl(t,e,n,r,i){var o=this;this.Bc=t,this.qc=e,this.cs=n,this.Uc={},this.Kc=[],this.Qc=new Map,this.Wc=new Set,this.jc=[],this.Gc=i,this.Gc.zc(function(t){n.ws(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ll(this)?(Gr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Wc.add(4),[4,Nl(e)];case 1:return t.sent(),e.Hc.set("Unknown"),e.Wc.delete(4),[4,Al(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Hc=new wl(n,r)}var pl,dl,yl,_e=(Tl.prototype.ec=function(){return 1===this.state||2===this.state||4===this.state},Tl.prototype.nc=function(){return 2===this.state},Tl.prototype.start=function(){3!==this.state?this.auth():this.sc()},Tl.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ec()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Tl.prototype.ic=function(){this.state=0,this.Vs.reset()},Tl.prototype.rc=function(){var t=this;this.nc()&&null===this.tc&&(this.tc=this.fn.Vn(this.Ja,6e4,function(){return t.oc()}))},Tl.prototype.ac=function(t){this.cc(),this.stream.send(t)},Tl.prototype.oc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.nc()?[2,this.close(0)]:[2]})})},Tl.prototype.cc=function(){this.tc&&(this.tc.cancel(),this.tc=null)},Tl.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.cc(),this.Vs.cancel(),this.Za++,3!==e?this.Vs.reset():n&&n.code===Ur.RESOURCE_EXHAUSTED?(zr(n.toString()),zr("Using maximum backoff delay to prevent overloading the backend."),this.Vs.Rn()):n&&n.code===Ur.UNAUTHENTICATED&&this.Xa.ri(),null!==this.stream&&(this.uc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.hc(n)];case 1:return t.sent(),[2]}})})},Tl.prototype.uc=function(){},Tl.prototype.auth=function(){var n=this;this.state=1;var t=this.lc(this.Za),e=this.Za;this.Xa.getToken().then(function(t){n.Za===e&&n._c(t)},function(e){t(function(){var t=new qr(Ur.UNKNOWN,"Fetching auth token failed: "+e.message);return n.fc(t)})})},Tl.prototype._c=function(t){var e=this,n=this.lc(this.Za);this.stream=this.dc(t),this.stream.wc(function(){n(function(){return e.state=2,e.listener.wc()})}),this.stream.hc(function(t){n(function(){return e.fc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Tl.prototype.sc=function(){var t=this;this.state=4,this.Vs.Pn(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Tl.prototype.fc=function(t){return Gr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Tl.prototype.lc=function(e){var n=this;return function(t){n.fn.ws(function(){return n.Za===e?t():(Gr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Tl),vl=(n(_l,yl=_e),_l.prototype.dc=function(t){return this.Ya.Ec("Listen",t)},_l.prototype.onMessage=function(t){this.Vs.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(i=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:Wr(),r=e.targetChange.targetIds||[],i=(o=e.targetChange.resumeToken,t.Ke?(Jr(void 0===o||"string"==typeof o),ti.fromBase64String(o||"")):(Jr(void 0===o||o instanceof Uint8Array),ti.fromUint8Array(o||new Uint8Array))),o=e.targetChange.cause,s=o&&(o=void 0===(s=o).code?Ur.UNKNOWN:zi(s.code),new qr(o,s.message||"")),r=new vo(n,r,i,s||null)}else if("documentChange"in e){e.documentChange;var u=e.documentChange;u.document,u.document.name,u.document.updateTime;var i=is(t,u.document.name),a=ts(u.document.updateTime),s=new hu({mapValue:{fields:u.document.fields}}),a=new wu(i,a,s,{}),s=u.targetIds||[],u=u.removedTargetIds||[];r=new po(s,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;u=e.documentDelete;u.document;var a=is(t,u.document),c=u.readTime?ts(u.readTime):wi.min(),c=new bu(a,c),u=u.removedTargetIds||[];r=new po([],u,c.key,c)}else if("documentRemove"in e){e.documentRemove;c=e.documentRemove;c.document;var h=is(t,c.document),c=c.removedTargetIds||[];r=new po([],c,h,null)}else{if(!("filter"in e))return Wr();e.filter;h=e.filter;h.targetId;e=h.count||0,e=new Mi(e),h=h.targetId;r=new yo(h,e)}return r}(this.serializer,t),t=function(t){if(!("targetChange"in t))return wi.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?ts(t.readTime):wi.min()}(t);return this.listener.Tc(e,t)},_l.prototype.Ic=function(t){var e,n,r,i={};i.database=us(this.serializer),i.addTarget=(e=this.serializer,(r=qi(r=(n=t).target)?{documents:fs(e,r)}:{query:ps(e,r)}).targetId=n.targetId,0<n.resumeToken.o()&&(r.resumeToken=Zo(e,n.resumeToken)),r);var o,t=(this.serializer,o=t,null==(t=function(){switch(o.et){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Wr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.ac(i)},_l.prototype.mc=function(t){var e={};e.database=us(this.serializer),e.removeTarget=t,this.ac(e)},_l),gl=(n(El,dl=_e),Object.defineProperty(El.prototype,"Rc",{get:function(){return this.Ac},enumerable:!1,configurable:!0}),El.prototype.start=function(){this.Ac=!1,this.lastStreamToken=void 0,dl.prototype.start.call(this)},El.prototype.uc=function(){this.Ac&&this.Pc([])},El.prototype.dc=function(t){return this.Ya.Ec("Write",t)},El.prototype.onMessage=function(t){if(Jr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Ac){this.Vs.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Jr(void 0!==r),n.map(function(t){return function(t,e){var n=t.updateTime?ts(t.updateTime):ts(e);n.isEqual(wi.min())&&(n=ts(e));e=null;return t.transformResults&&0<t.transformResults.length&&(e=t.transformResults),new js(n,e)}(t,r)})):[]),n=ts(t.commitTime);return this.listener.gc(n,e)}var n,r;return Jr(!t.writeResults||0===t.writeResults.length),this.Ac=!0,this.listener.Vc()},El.prototype.yc=function(){var t={};t.database=us(this.serializer),this.ac(t)},El.prototype.Pc=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return hs(e.serializer,t)})};this.ac(t)},El),ml=(n(Il,pl=function(){}),Il.prototype.vc=function(){if(this.bc)throw new qr(Ur.FAILED_PRECONDITION,"The client has already been terminated.")},Il.prototype.Sc=function(e,n,r){var i=this;return this.vc(),this.credentials.getToken().then(function(t){return i.Ya.Sc(e,n,r,t)}).catch(function(t){throw t.code===Ur.UNAUTHENTICATED&&i.credentials.ri(),t})},Il.prototype.Dc=function(e,n,r){var i=this;return this.vc(),this.credentials.getToken().then(function(t){return i.Ya.Dc(e,n,r,t)}).catch(function(t){throw t.code===Ur.UNAUTHENTICATED&&i.credentials.ri(),t})},Il.prototype.terminate=function(){this.bc=!1},Il),wl=(bl.prototype.Oc=function(){var t=this;0===this.Nc&&(this.kc("Unknown"),this.xc=this.cs.Vn("online_state_timeout",1e4,function(){return t.xc=null,t.Mc("Backend didn't respond within 10 seconds."),t.kc("Offline"),Promise.resolve()}))},bl.prototype.$c=function(t){"Online"===this.state?this.kc("Unknown"):(this.Nc++,1<=this.Nc&&(this.Lc(),this.Mc("Connection failed 1 times. Most recent error: "+t.toString()),this.kc("Offline")))},bl.prototype.set=function(t){this.Lc(),this.Nc=0,"Online"===t&&(this.Fc=!1),this.kc(t)},bl.prototype.kc=function(t){t!==this.state&&(this.state=t,this.Cc(t))},bl.prototype.Mc=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fc?(zr(t),this.Fc=!1):Gr("OnlineStateTracker",t)},bl.prototype.Lc=function(){null!==this.xc&&(this.xc.cancel(),this.xc=null)},bl);function bl(t,e){this.cs=t,this.Cc=e,this.state="Unknown",this.Nc=0,this.xc=null,this.Fc=!0}function Il(t,e,n){var r=this;return(r=pl.call(this)||this).credentials=t,r.Ya=e,r.serializer=n,r.bc=!1,r}function El(t,e,n,r,i){var o=this;return(o=dl.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Ac=!1,o}function _l(t,e,n,r,i){var o=this;return(o=yl.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Tl(t,e,n,r,i,o){this.fn=t,this.Ja=n,this.Ya=r,this.Xa=i,this.listener=o,this.state=0,this.Za=0,this.tc=null,this.stream=null,this.Vs=new Ia(t,e)}function Al(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!Ll(r))return[3,4];e=0,n=r.jc,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Nl(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.jc,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Dl(t,e){t.Qc.has(e.targetId)||(t.Qc.set(e.targetId,e),kl(t)?Pl(t):Bl(t).nc()&&Ol(t,e))}function Sl(t,e){var n=t,t=Bl(n);n.Qc.delete(e),t.nc()&&xl(n,e),0===n.Qc.size&&(t.nc()?t.rc():Ll(n)&&n.Hc.set("Unknown"))}function Ol(t,e){t.Jc.me(e.targetId),Bl(t).Ic(e)}function xl(t,e){t.Jc.me(e),Bl(t).mc(e)}function Pl(e){e.Jc=new mo({qe:function(t){return e.Uc.qe(t)},Ue:function(t){return e.Qc.get(t)||null}}),Bl(e).start(),e.Hc.Oc()}function kl(t){return Ll(t)&&!Bl(t).ec()&&0<t.Qc.size}function Ll(t){return 0===t.Wc.size}function Rl(t){t.Jc=void 0}function Vl(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Hc.set("Online"),!(u instanceof vo&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Qc.has(i)?[4,o.Uc.Yc(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Qc.delete(i),o.Jc.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Gr("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,Cl(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof po?s.Jc.be(u):u instanceof yo?s.Jc.Oe(u):s.Jc.De(u),a.isEqual(wi.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,rl(s.Bc)];case 8:return o=t.sent(),0<=a.u(o)?[4,(i=a,(e=(r=s).Jc.$e(i)).zt.forEach(function(t,e){var n;0<t.resumeToken.o()&&((n=r.Qc.get(e))&&r.Qc.set(e,n.it(t.resumeToken,i)))}),e.Ht.forEach(function(t){var e=r.Qc.get(t);e&&(r.Qc.set(t,e.it(ti.h,e.nt)),xl(r,t),e=new ji(e.target,t,1,e.sequenceNumber),Ol(r,e))}),r.Uc.Xc(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Gr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Cl(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function Cl(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!Pa(r))throw r;return n.Wc.add(1),[4,Nl(n)];case 1:return t.sent(),n.Hc.set("Offline"),i=i||function(){return rl(n.Bc)},n.cs.Cs(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Gr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Wc.delete(1),[4,Al(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Ul(e,n){return n().catch(function(t){return Cl(e,t,n)})}function ql(a){return y(this,void 0,void 0,function(){var i,o,s,u;return v(this,function(t){switch(t.label){case 0:o=Gl(i=a),s=0<i.Kc.length?i.Kc[i.Kc.length-1].batchId:-1,t.label=1;case 1:if(!(Ll(i)&&i.Kc.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.Bc,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.Oi.Hr(t,n)}))];case 3:return null===(u=t.sent())?(0===i.Kc.length&&o.rc(),[3,7]):(s=u.batchId,function(t,e){t.Kc.push(e);t=Gl(t);t.nc()&&t.Rc&&t.Pc(e.mutations)}(i,u),[3,6]);case 4:return u=t.sent(),[4,Cl(i,u)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Ml(i)&&Fl(i),[2]}var e,n,r})})}function Ml(t){return Ll(t)&&!Gl(t).ec()&&0<t.Kc.length}function Fl(t){Gl(t).start()}function jl(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Wc.delete(2),[4,Al(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Wc.add(2),[4,Nl(e)]);case 3:t.sent(),e.Hc.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Bl(n){var t,e,r,i=this;return n.eu||(n.eu=(t=n.qc,e=n.cs,r={wc:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.Qc.forEach(function(t,e){Ol(n,t)}),[2]})})}.bind(null,n),hc:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return Rl(e),kl(e)?(e.Hc.$c(n),Pl(e)):e.Hc.set("Unknown"),[2]})})}.bind(null,n),Tc:Vl.bind(null,n)},t.vc(),new vl(e,t.Ya,t.credentials,t.serializer,r)),n.jc.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.eu.ic(),kl(n)?Pl(n):n.Hc.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.eu.stop()];case 2:t.sent(),Rl(n),t.label=3;case 3:return[2]}})})})),n.eu}function Gl(n){var t,e,r,i=this;return n.nu||(n.nu=(t=n.qc,e=n.cs,r={wc:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Gl(e).yc(),[2]})})}.bind(null,n),hc:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&Gl(e).Rc?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return Gi(n=i.code)&&n!==Ur.ABORTED?(e=r.Kc.shift(),Gl(r).ic(),[4,Ul(r,function(){return r.Uc.tu(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,ql(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Ml(e)&&Fl(e),[2]}})})}.bind(null,n),Vc:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=Gl(o),n=0,r=o.Kc;n<r.length;n++)i=r[n],e.Pc(i.mutations);return[2]})})}.bind(null,n),gc:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Kc.shift(),n=uc.from(e,i,o),[4,Ul(r,function(){return r.Uc.Zc(n)})];case 1:return t.sent(),[4,ql(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.vc(),new gl(e,t.Ya,t.credentials,t.serializer,r)),n.jc.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.nu.ic(),[4,ql(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.nu.stop()];case 3:t.sent(),0<n.Kc.length&&(Gr("RemoteStore","Stopping write stream with "+n.Kc.length+" pending writes"),n.Kc=[]),t.label=4;case 4:return[2]}})})})),n.nu}var zl=(Wl.prototype.P=function(){return this.su.P()},Wl.prototype.qo=function(t,e){e=new Kl(t,e);this.su=this.su.add(e),this.ru=this.ru.add(e)},Wl.prototype.au=function(t,e){var n=this;t.forEach(function(t){return n.qo(t,e)})},Wl.prototype.Ko=function(t,e){this.cu(new Kl(t,e))},Wl.prototype.uu=function(t,e){var n=this;t.forEach(function(t){return n.Ko(t,e)})},Wl.prototype.hu=function(t){var e=this,n=new _i(new bi([])),r=new Kl(n,t),t=new Kl(n,t+1),i=[];return this.ru.xt([r,t],function(t){e.cu(t),i.push(t.key)}),i},Wl.prototype.lu=function(){var e=this;this.su.forEach(function(t){return e.cu(t)})},Wl.prototype.cu=function(t){this.su=this.su.delete(t),this.ru=this.ru.delete(t)},Wl.prototype._u=function(t){var e=new _i(new bi([])),n=new Kl(e,t),t=new Kl(e,t+1),r=so();return this.ru.xt([n,t],function(t){r=r.add(t.key)}),r},Wl.prototype.ro=function(t){var e=new Kl(t,0),e=this.su.Ot(e);return null!==e&&t.isEqual(e.key)},Wl),Kl=(Hl.iu=function(t,e){return _i.D(t.key,e.key)||Xr(t.fu,e.fu)},Hl.ou=function(t,e){return Xr(t.fu,e.fu)||_i.D(t.key,e.key)},Hl);function Hl(t,e){this.key=t,this.fu=e}function Wl(){this.su=new $i(Kl.iu),this.ru=new $i(Kl.ou)}function Jl(t,e){return"firestore_clients_"+t+"_"+e}function Ql(t,e,n){n="firestore_mutations_"+t+"_"+n;return e.Zs()&&(n+="_"+e.uid),n}function Yl(t,e){return"firestore_targets_"+t+"_"+e}var Xl=(wf.du=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new qr(r.error.code,r.error.message)),i?new wf(t,e,r.state,o):(zr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},wf.prototype.wu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},wf),$l=(mf.du=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new qr(n.error.code,n.error.message)),r?new mf(t,n.state,i):(zr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},mf.prototype.wu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},mf),Zl=(gf.du=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=uo,o=0;r&&o<n.activeTargetIds.length;++o)r=Li(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new gf(t,i):(zr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},gf),tf=(vf.du=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new vf(e.clientId,e.onlineState):(zr("SharedClientState","Failed to parse online state: "+t),null)},vf),ef=(yf.prototype.Eu=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},yf.prototype.Tu=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},yf.prototype.wu=function(){var t={activeTargetIds:this.activeTargetIds.L(),updateTimeMs:Date.now()};return JSON.stringify(t)},yf),nf=(df.Ln=function(t){return!(!t||!t.localStorage)},df.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.mu.va()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Iu&&(i=this.getItem(Jl(this.persistenceKey,r)))&&(o=Zl.du(r,i))&&(this.Pu=this.Pu.ot(o.clientId,o));for(this.Du(),(s=this.storage.getItem(this.Su))&&(u=this.Cu(s))&&this.Nu(u),a=0,c=this.gu;a<c.length;a++)h=c[a],this.Ru(h);return this.gu=[],this.window.addEventListener("unload",function(){return l.ga()}),this.br=!0,[2]}})})},df.prototype.sr=function(t){this.setItem(this.yu,JSON.stringify(t))},df.prototype.xu=function(){return this.Fu(this.Pu)},df.prototype.Ou=function(n){var r=!1;return this.Pu.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},df.prototype.ku=function(t){this.Mu(t,"pending")},df.prototype.$u=function(t,e,n){this.Mu(t,e,n),this.Lu(t)},df.prototype.Bu=function(t){var e,n="not-current";return this.Ou(t)&&(!(e=this.storage.getItem(Yl(this.persistenceKey,t)))||(e=$l.du(t,e))&&(n=e.state)),this.qu.Eu(t),this.Du(),n},df.prototype.Uu=function(t){this.qu.Tu(t),this.Du()},df.prototype.Ku=function(t){return this.qu.activeTargetIds.has(t)},df.prototype.Qu=function(t){this.removeItem(Yl(this.persistenceKey,t))},df.prototype.Wu=function(t,e,n){this.ju(t,e,n)},df.prototype.Gu=function(t,e,n){var r=this;e.forEach(function(t){r.Lu(t)}),this.currentUser=t,n.forEach(function(t){r.ku(t)})},df.prototype.zu=function(t){this.Hu(t)},df.prototype.ga=function(){this.br&&(this.window.removeEventListener("storage",this.Au),this.removeItem(this.Vu),this.br=!1)},df.prototype.getItem=function(t){var e=this.storage.getItem(t);return Gr("SharedClientState","READ",t,e),e},df.prototype.setItem=function(t,e){Gr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},df.prototype.removeItem=function(t){Gr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},df.prototype.Ru=function(t){var e=this,s=t;if(s.storageArea===this.storage){if(Gr("SharedClientState","EVENT",s.key,s.newValue),s.key===this.Vu)return void zr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.fn.Cs(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){if(this.br){if(null!==s.key)if(this.pu.test(s.key)){if(null==s.newValue)return e=this.Ju(s.key),[2,this.Yu(e,null)];if(e=this.Xu(s.key,s.newValue))return[2,this.Yu(e.clientId,e)]}else if(this.bu.test(s.key)){if(null!==s.newValue&&(n=this.Zu(s.key,s.newValue)))return[2,this.th(n)]}else if(this.vu.test(s.key)){if(null!==s.newValue&&(r=this.eh(s.key,s.newValue)))return[2,this.nh(r)]}else if(s.key===this.Su){if(null!==s.newValue&&(i=this.Cu(s.newValue)))return[2,this.Nu(i)]}else s.key===this.yu&&(o=function(t){var e=lc.ir;if(null!=t)try{var n=JSON.parse(t);Jr("number"==typeof n),e=n}catch(t){zr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==lc.ir&&this.tr(o)}else this.gu.push(s);return[2]})})})}},Object.defineProperty(df.prototype,"qu",{get:function(){return this.Pu.get(this.Iu)},enumerable:!1,configurable:!0}),df.prototype.Du=function(){this.setItem(this.Vu,this.qu.wu())},df.prototype.Mu=function(t,e,n){n=new Xl(this.currentUser,t,e,n),t=Ql(this.persistenceKey,this.currentUser,t);this.setItem(t,n.wu())},df.prototype.Lu=function(t){t=Ql(this.persistenceKey,this.currentUser,t);this.removeItem(t)},df.prototype.Hu=function(t){t={clientId:this.Iu,onlineState:t};this.storage.setItem(this.Su,JSON.stringify(t))},df.prototype.ju=function(t,e,n){var r=Yl(this.persistenceKey,t),n=new $l(t,e,n);this.setItem(r,n.wu())},df.prototype.Ju=function(t){t=this.pu.exec(t);return t?t[1]:null},df.prototype.Xu=function(t,e){t=this.Ju(t);return Zl.du(t,e)},df.prototype.Zu=function(t,e){var n=this.bu.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Xl.du(new $a(n),t,e)},df.prototype.eh=function(t,e){t=this.vu.exec(t),t=Number(t[1]);return $l.du(t,e)},df.prototype.Cu=function(t){return tf.du(t)},df.prototype.th=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.mu.sh(e.batchId,e.state,e.error)]:(Gr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},df.prototype.nh=function(t){return this.mu.ih(t.targetId,t.state,t.error)},df.prototype.Yu=function(t,e){var n=this,r=e?this.Pu.ot(t,e):this.Pu.remove(t),i=this.Fu(this.Pu),o=this.Fu(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.mu.rh(s,u).then(function(){n.Pu=r})},df.prototype.Nu=function(t){this.Pu.get(t.clientId)&&this.Cc(t.onlineState)},df.prototype.Fu=function(t){var n=uo;return t.forEach(function(t,e){n=n.kt(e.activeTargetIds)}),n},df),rf=(pf.prototype.ku=function(t){},pf.prototype.$u=function(t,e,n){},pf.prototype.Bu=function(t){return this.oh.Eu(t),this.ah[t]||"not-current"},pf.prototype.Wu=function(t,e,n){this.ah[t]=e},pf.prototype.Uu=function(t){this.oh.Tu(t)},pf.prototype.Ku=function(t){return this.oh.activeTargetIds.has(t)},pf.prototype.Qu=function(t){delete this.ah[t]},pf.prototype.xu=function(){return this.oh.activeTargetIds},pf.prototype.Ou=function(t){return this.oh.activeTargetIds.has(t)},pf.prototype.start=function(){return this.oh=new ef,Promise.resolve()},pf.prototype.Gu=function(t,e,n){},pf.prototype.zu=function(t){},pf.prototype.ga=function(){},pf.prototype.sr=function(t){},pf),of=function(t){this.key=t},sf=function(t){this.key=t},uf=(Object.defineProperty(ff.prototype,"dh",{get:function(){return this.uh},enumerable:!1,configurable:!0}),ff.prototype.wh=function(t,e){var s=this,u=e?e.Eh:new co,a=(e||this).fh,c=(e||this).Qt,h=a,l=!1,f=Su(this.query)&&a.size===this.query.limit?a.last():null,p=Ou(this.query)&&a.size===this.query.limit?a.first():null;if(t.ht(function(t,e){var n=a.get(t),r=(r=e instanceof wu?e:null)&&(ju(s.query,r)?r:null),i=!!n&&s.Qt.has(n.key),o=!!r&&(r.Ye||s.Qt.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.Th(n,r)||(u.track({type:2,doc:r}),e=!0,(f&&0<s._h(r,f)||p&&s._h(r,p)<0)&&(l=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(f||p)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),Su(this.query)||Ou(this.query))for(;h.size>this.query.limit;){var n=Su(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{fh:h,Eh:u,Ih:l,Qt:c}},ff.prototype.Th=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},ff.prototype.Di=function(t,e,n){var o=this,r=this.fh;this.fh=t.fh,this.Qt=t.Qt;var i=t.Eh.Ut();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o._h(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Wr()}}var r,i}),this.mh(n);var s=e?this.Ah():[],n=0===this.lh.size&&this.te?1:0,e=n!==this.hh;return this.hh=n,0!==i.length||e?{snapshot:new ho(this.query,t.fh,r,i,t.Qt,0==n,e,!1),Rh:s}:{Rh:s}},ff.prototype.Ks=function(t){return this.te&&"Offline"===t?(this.te=!1,this.Di({fh:this.fh,Eh:new co,Qt:this.Qt,Ih:!1},!1)):{Rh:[]}},ff.prototype.Ph=function(t){return!this.uh.has(t)&&!!this.fh.has(t)&&!this.fh.get(t).Ye},ff.prototype.mh=function(t){var e=this;t&&(t.ee.forEach(function(t){return e.uh=e.uh.add(t)}),t.ne.forEach(function(t){}),t.se.forEach(function(t){return e.uh=e.uh.delete(t)}),this.te=t.te)},ff.prototype.Ah=function(){var e=this;if(!this.te)return[];var n=this.lh;this.lh=so(),this.fh.forEach(function(t){e.Ph(t.key)&&(e.lh=e.lh.add(t.key))});var r=[];return n.forEach(function(t){e.lh.has(t)||r.push(new sf(t))}),this.lh.forEach(function(t){n.has(t)||r.push(new of(t))}),r},ff.prototype.gh=function(t){this.uh=t.za,this.lh=so();t=this.wh(t.documents);return this.Di(t,!0)},ff.prototype.Vh=function(){return ho.Gt(this.query,this.fh,this.Qt,0===this.hh)},ff),af=function(t,e,n){this.query=t,this.targetId=e,this.view=n},cf=function(t){this.key=t,this.yh=!1},hf=(Object.defineProperty(lf.prototype,"Uh",{get:function(){return!0===this.qh},enumerable:!1,configurable:!0}),lf);function lf(t,e,n,r,i,o){this.Bc=t,this.ph=e,this.bh=n,this.Sh=r,this.currentUser=i,this.Dh=o,this.Ch={},this.Nh=new gi(Mu,qu),this.xh=new Map,this.Fh=[],this.Oh=new Ki(_i.D),this.kh=new Map,this.Mh=new zl,this.$h={},this.Lh=new Map,this.Bh=Rh.yo(),this.onlineState="Unknown",this.qh=void 0}function ff(t,e){this.query=t,this.uh=e,this.hh=null,this.te=!1,this.lh=so(),this.Qt=so(),this._h=Bu(t),this.fh=new ao(this._h)}function pf(){this.oh=new ef,this.ah={},this.Cc=null,this.tr=null}function df(t,e,n,r,i){this.window=t,this.fn=e,this.persistenceKey=n,this.Iu=r,this.mu=null,this.Cc=null,this.tr=null,this.Au=this.Ru.bind(this),this.Pu=new Ki(Xr),this.br=!1,this.gu=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Vu=Jl(this.persistenceKey,this.Iu),this.yu="firestore_sequence_number_"+this.persistenceKey,this.Pu=this.Pu.ot(this.Iu,new ef),this.pu=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.bu=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.vu=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Su="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.Au)}function yf(){this.activeTargetIds=uo}function vf(t,e){this.clientId=t,this.onlineState=e}function gf(t,e){this.clientId=t,this.activeTargetIds=e}function mf(t,e,n){this.targetId=t,this.state=e,this.error=n}function wf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function bf(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Kh=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.wh(o)).Ih?[4,ul(r.Bc,i.query,!1).then(function(t){t=t.documents;return i.view.wh(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.zt.get(i.targetId),n=i.view.Di(e,r.Uh,n),[2,(xf(r,i.targetId,n.Rh),n.snapshot)]}})})}(i,t,e,n)},[4,ul(i.Bc,o,!0)];case 1:return n=t.sent(),r=new uf(o,n.za),e=r.wh(n.documents),n=fo.Zt(s,u&&"Offline"!==i.onlineState),n=r.Di(e,i.Uh,n),xf(i,s,n.Rh),r=new af(o,s,r),[2,(i.Nh.set(o,r),i.xh.has(s)?i.xh.get(s).push(o):i.xh.set(s,[o]),n.snapshot)]}})})}function If(f,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=Mf(f),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.Bc,a=p,h=i,l=mi.now(),o=a.reduce(function(t,e){return t.add(e.key)},so()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Ka.qi(u,o).next(function(t){c=t;for(var s,e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=(s=i,o=c.get(i.key),s instanceof ru?function(t){for(var e=null,n=0,r=s.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof wu?t.field(i.field):void 0,o=Is(i.transform,o||null);null!=o&&(e=(null==e?new lu:e).set(i.field,o))}return e?e.Xe():null}(o):null);null!=o&&e.push(new $s(i.key,o,function s(t){var u=[];return pi(t.fields||{},function(t,e){var n=new Ei([t]);if(Ko(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new qs(u)}(o.proto.mapValue),Bs.exists(!0)))}return h.Oi.Wr(u,l,e,a)})}).then(function(t){var e=t.Ii(c);return{batchId:t.batchId,Ri:e}}))];case 2:return s=t.sent(),u.Sh.ku(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.$h[e.currentUser.ti()])||new Ki(Xr)).ot(n,r),e.$h[e.currentUser.ti()]=i,[4,kf(u,s.Ri)];case 3:return t.sent(),[4,ql(u.ph)];case 4:return t.sent(),[3,6];case 5:return u=t.sent(),u=Ka(u,"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,l,o})})}function Ef(r,i){return y(this,void 0,void 0,function(){var n,e;return v(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,il(n.Bc,i)];case 2:return e=t.sent(),i.zt.forEach(function(t,e){e=n.kh.get(e);e&&(Jr(t.ee.size+t.ne.size+t.se.size<=1),0<t.ee.size?e.yh=!0:0<t.ne.size?Jr(e.yh):0<t.se.size&&(Jr(e.yh),e.yh=!1))}),[4,kf(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,ll(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function _f(t,n,e){var r,t=t;(t.Uh&&0===e||!t.Uh&&1===e)&&(r=[],t.Nh.forEach(function(t,e){e=e.view.Ks(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.Bs.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Ks(i)&&(o=!0)}),o&&Ya(t)}(t.bh,n),r.length&&t.Ch.Tc(r),t.onlineState=n,t.Uh&&t.Sh.zu(n))}function Tf(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Bc,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Oi.Gr(e,r).next(function(t){return Jr(null!==t),n=t.keys(),i.Oi.Zr(e,t)}).next(function(){return i.Oi.io(e)}).next(function(){return i.Ka.qi(e,n)})}))];case 2:return o=t.sent(),Df(n,u,a),Nf(n,u),n.Sh.$u(u,"rejected",a),[4,kf(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,ll(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function Af(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:Ll((n=o).ph)||Gr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.Bc).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Oi.Jr(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Lh.get(r)||[]).push(s),n.Lh.set(r,i),[3,4]);case 3:return i=t.sent(),i=Ka(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function Nf(t,e){(t.Lh.get(e)||[]).forEach(function(t){t.resolve()}),t.Lh.delete(e)}function Df(t,e,n){var r=t,i=r.$h[r.currentUser.ti()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.$h[r.currentUser.ti()]=i)}function Sf(e,t,n){void 0===n&&(n=null),e.Sh.Uu(t);for(var r=0,i=e.xh.get(t);r<i.length;r++){var o=i[r];e.Nh.delete(o),n&&e.Ch.Qh(o,n)}e.xh.delete(t),e.Uh&&e.Mh.hu(t).forEach(function(t){e.Mh.ro(t)||Of(e,t)})}function Of(t,e){var n=t.Oh.get(e);null!==n&&(Sl(t.ph,n),t.Oh=t.Oh.remove(e),t.kh.delete(n),Pf(t))}function xf(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof of?(t.Mh.qo(o.key,e),function(t,e){e=e.key;t.Oh.get(e)||(Gr("SyncEngine","New document in limbo: "+e),t.Fh.push(e),Pf(t))}(t,o)):o instanceof sf?(Gr("SyncEngine","Document no longer in limbo: "+o.key),t.Mh.Ko(o.key,e),t.Mh.ro(o.key)||Of(t,o.key)):Wr()}}function Pf(t){for(;0<t.Fh.length&&t.Oh.size<t.Dh;){var e=t.Fh.shift(),n=t.Bh.next();t.kh.set(n,new cf(e)),t.Oh=t.Oh.ot(e,n),Dl(t.ph,new ji(Ru(Du(e.path)),n,2,lc.ir))}}function kf(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Nh.P()?[3,3]:(n.Nh.forEach(function(t,e){o.push(n.Kh(e,s,u).then(function(t){t&&(n.Uh&&n.Sh.Wu(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=hc.Zi(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.Ch.Tc(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Ea.forEach(c,function(e){return Ea.forEach(e.Yi,function(t){return r.persistence.qr.qo(n,e.targetId,t)}).next(function(){return Ea.forEach(e.Xi,function(t){return r.persistence.qr.Ko(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Pa(e=t.sent()))throw e;return Gr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.La.get(o),u=s.nt,u=s.rt(u),r.La=r.La.ot(o,u));return[2]}})})}(n.Bc,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Lf(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Gr("SyncEngine","User change. New user:",o.ti()),[4,el(n.Bc,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Lh.forEach(function(t){t.forEach(function(t){t.reject(new qr(Ur.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Lh.clear(),n.Sh.Gu(o,r.ja,r.Ga),[4,kf(n,r.Wa)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Rf(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).Bc,n=a,i=(r=e).Oi,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.zr(e,n).next(function(t){return t?r.Ka.qi(e,t):Ea.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,ql(o.ph)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Df(o,a,h||null),Nf(o,a),o.Bc.Oi.no(a)):Wr(),t.label=4;case 4:return[4,kf(o,s)];case 5:return t.sent(),[3,7];case 6:Gr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function Vf(h,l){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return qf(r=h),Mf(r),!0!==l||!0===r.qh?[3,3]:(e=r.Sh.xu(),[4,Cf(r,e.L())]);case 1:return i=t.sent(),r.qh=!0,[4,jl(r.ph,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],Dl(r.ph,u);return[3,7];case 3:return!1!==l||!1===r.qh?[3,7]:(a=[],c=Promise.resolve(),r.xh.forEach(function(t,e){r.Sh.Ku(e)?a.push(e):c=c.then(function(){return Sf(r,e),sl(r.Bc,e,!0)}),Sl(r.ph,e)}),[4,c]);case 4:return t.sent(),[4,Cf(r,a)];case 5:return t.sent(),(n=r).kh.forEach(function(t,e){Sl(n.ph,e)}),n.Mh.lu(),n.kh=new Map,n.Oh=new Ki(_i.D),r.qh=!1,[4,jl(r.ph,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Cf(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,l,f;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.xh.get(s))&&0!==a.length?[4,ol(e.Bc,Ru(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(l=h[c],l=e.Nh.get(l),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,ul((e=r).Bc,i.query,!0)];case 1:return n=t.sent(),n=i.view.gh(n),[2,(e.Uh&&xf(e,i.targetId,n.Rh),n)]}})})}(e,l)]):[3,6];case 4:(l=t.sent()).snapshot&&r.push(l.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,al(e.Bc,s)];case 8:return f=t.sent(),[4,ol(e.Bc,f)];case 9:return u=t.sent(),[4,bf(e,Uf(f),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Ch.Tc(r),n)]}})})}function Uf(t){return Nu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function qf(t){return t.ph.Uc.Xc=Ef.bind(null,t),t.ph.Uc.qe=function(t,e){var n=t;if((t=n.kh.get(e))&&t.yh)return so().add(t.key);var r=so();if(!(e=n.xh.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Nh.get(s),r=r.kt(s.view.dh);return r}.bind(null,t),t.ph.Uc.Yc=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).Sh.Wu(s,"rejected",u),i=e.kh.get(s),(n=i&&i.key)?(r=(r=new Ki(_i.D)).ot(n,new bu(n,wi.min())),i=so().add(n),i=new lo(wi.min(),new Map,new $i(Xr),r,i),[4,Ef(e,i)]):[3,2];case 1:return t.sent(),e.Oh=e.Oh.remove(n),e.kh.delete(s),Pf(e),[3,4];case 2:return[4,sl(e.Bc,s,!1).then(function(){return Sf(e,s,u)}).catch(ll)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.Ch.Tc=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,u=n.Bs.get(u);if(u){for(var a=0,c=u.listeners;a<c.length;a++)c[a].Qs(s)&&(r=!0);u.Ls=s}}r&&Ya(n)}.bind(null,t.bh),t.Ch.Qh=function(t,e,n){var r=t;if(t=r.Bs.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.Bs.delete(e)}.bind(null,t.bh),t}function Mf(t){return t.ph.Uc.Zc=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,nl(e.Bc,o)];case 2:return r=t.sent(),Df(e,n,null),Nf(e,n),e.Sh.$u(n,"acknowledged"),[4,kf(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,ll(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,t),t.ph.Uc.tu=Tf.bind(null,t),t}var Ff,jf,Bf,Gf=(dp.prototype.Qa=function(t){this.Wh=t},dp.prototype.Qi=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.on.length||1===r.on.length&&r.on[0].field.W())||i.isEqual(wi.min())?this.jh(e,r):this.Wh.qi(e,o).next(function(t){var n=s.Gh(r,t);return(Su(r)||Ou(r))&&s.Ih(r.an,n,o,i)?s.jh(e,r):(Br()<=f.DEBUG&&Gr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Fu(r)),s.Wh.Qi(e,r,i).next(function(e){return n.forEach(function(t){e=e.ot(t.key,t)}),e}))})},dp.prototype.Gh=function(n,t){var r=new $i(Bu(n));return t.forEach(function(t,e){e instanceof wu&&ju(n,e)&&(r=r.add(e))}),r},dp.prototype.Ih=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.u(r))},dp.prototype.jh=function(t,e){return Br()<=f.DEBUG&&Gr("IndexFreeQueryEngine","Using full collection scan to execute query:",Fu(e)),this.Wh.Qi(t,e,wi.min())},dp),zf=(pp.prototype.Qr=function(t){return Ea.resolve(0===this.Oi.length)},pp.prototype.Wr=function(t,e,n,r){var i=this.zh;this.zh++,0<this.Oi.length&&this.Oi[this.Oi.length-1];n=new sc(i,e,n,r);this.Oi.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this.Hh=this.Hh.add(new Kl(u.key,i)),this.ki.jr(t,u.key.path.F())}return Ea.resolve(n)},pp.prototype.Gr=function(t,e){return Ea.resolve(this.Jh(e))},pp.prototype.Hr=function(t,e){e+=1,e=this.Yh(e),e=e<0?0:e;return Ea.resolve(this.Oi.length>e?this.Oi[e]:null)},pp.prototype.Jr=function(){return Ea.resolve(0===this.Oi.length?-1:this.zh-1)},pp.prototype.Yr=function(t){return Ea.resolve(this.Oi.slice())},pp.prototype.$i=function(t,e){var n=this,r=new Kl(e,0),e=new Kl(e,Number.POSITIVE_INFINITY),i=[];return this.Hh.xt([r,e],function(t){t=n.Jh(t.fu);i.push(t)}),Ea.resolve(i)},pp.prototype.Ki=function(t,e){var n=this,r=new $i(Xr);return e.forEach(function(t){var e=new Kl(t,0),t=new Kl(t,Number.POSITIVE_INFINITY);n.Hh.xt([e,t],function(t){r=r.add(t.fu)})}),Ea.resolve(this.Xh(r))},pp.prototype.Hi=function(t,e){var n=e.path,r=n.length+1,e=n;_i.X(e)||(e=e.child(""));var e=new Kl(new _i(e),0),i=new $i(Xr);return this.Hh.Ft(function(t){var e=t.key.path;return!!n.M(e)&&(e.length===r&&(i=i.add(t.fu)),!0)},e),Ea.resolve(this.Xh(i))},pp.prototype.Xh=function(t){var e=this,n=[];return t.forEach(function(t){t=e.Jh(t);null!==t&&n.push(t)}),n},pp.prototype.Zr=function(n,r){var i=this;Jr(0===this.Zh(r.batchId,"removed")),this.Oi.shift();var o=this.Hh;return Ea.forEach(r.mutations,function(t){var e=new Kl(t.key,r.batchId);return o=o.delete(e),i.qr.so(n,t.key)}).next(function(){i.Hh=o})},pp.prototype.no=function(t){},pp.prototype.ro=function(t,e){var n=new Kl(e,0),n=this.Hh.Ot(n);return Ea.resolve(e.isEqual(n&&n.key))},pp.prototype.io=function(t){return this.Oi.length,Ea.resolve()},pp.prototype.Zh=function(t,e){return this.Yh(t)},pp.prototype.Yh=function(t){return 0===this.Oi.length?0:t-this.Oi[0].batchId},pp.prototype.Jh=function(t){t=this.Yh(t);return t<0||t>=this.Oi.length?null:this.Oi[t]},pp),Kf=(fp.prototype.Vi=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.tl(e);return this.docs=this.docs.ot(r,{ho:e,size:i,readTime:n}),this.size+=i-o,this.ki.jr(t,r.path.F())},fp.prototype.pi=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},fp.prototype.bi=function(t,e){e=this.docs.get(e);return Ea.resolve(e?e.ho:null)},fp.prototype.getEntries=function(t,e){var n=this,r=to;return e.forEach(function(t){var e=n.docs.get(t);r=r.ot(t,e?e.ho:null)}),Ea.resolve(r)},fp.prototype.Qi=function(t,e,n){for(var r=ro,i=new _i(e.path.child("")),o=this.docs.ft(i);o.At();){var s=o.It(),u=s.key,a=s.value,s=a.ho,a=a.readTime;if(!e.path.M(u.path))break;a.u(n)<=0||s instanceof wu&&ju(e,s)&&(r=r.ot(s.key,s))}return Ea.resolve(r)},fp.prototype.el=function(t,e){return Ea.forEach(this.docs,function(t){return e(t)})},fp.prototype.wo=function(t){return new Hf(this)},fp.prototype.To=function(t){return Ea.resolve(this.size)},fp),Hf=(n(lp,Bf=l),lp.prototype.Di=function(n){var r=this,i=[];return this.Ri.forEach(function(t,e){e?i.push(r.Io.Vi(n,e,r.readTime)):r.Io.pi(t)}),Ea.On(i)},lp.prototype.vi=function(t,e){return this.Io.bi(t,e)},lp.prototype.Si=function(t,e){return this.Io.getEntries(t,e)},lp),Wf=(hp.prototype.Ce=function(t,n){return this.nl.forEach(function(t,e){return n(e)}),Ea.resolve()},hp.prototype.So=function(t){return Ea.resolve(this.lastRemoteSnapshotVersion)},hp.prototype.Do=function(t){return Ea.resolve(this.sl)},hp.prototype.po=function(t){return this.highestTargetId=this.rl.next(),Ea.resolve(this.highestTargetId)},hp.prototype.Co=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.sl&&(this.sl=e),Ea.resolve()},hp.prototype.xo=function(t){this.nl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.rl=new Rh(e),this.highestTargetId=e),t.sequenceNumber>this.sl&&(this.sl=t.sequenceNumber)},hp.prototype.No=function(t,e){return this.xo(e),this.targetCount+=1,Ea.resolve()},hp.prototype.Oo=function(t,e){return this.xo(e),Ea.resolve()},hp.prototype.ko=function(t,e){return this.nl.delete(e.target),this.il.hu(e.targetId),--this.targetCount,Ea.resolve()},hp.prototype.Or=function(n,r,i){var o=this,s=0,u=[];return this.nl.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.nl.delete(t),u.push(o.Mo(n,e.targetId)),s++)}),Ea.On(u).next(function(){return s})},hp.prototype.$o=function(t){return Ea.resolve(this.targetCount)},hp.prototype.Lo=function(t,e){e=this.nl.get(e)||null;return Ea.resolve(e)},hp.prototype.Bo=function(t,e,n){return this.il.au(e,n),Ea.resolve()},hp.prototype.Uo=function(e,t,n){this.il.uu(t,n);var r=this.persistence.qr,i=[];return r&&t.forEach(function(t){i.push(r.so(e,t))}),Ea.On(i)},hp.prototype.Mo=function(t,e){return this.il.hu(e),Ea.resolve()},hp.prototype.Qo=function(t,e){e=this.il._u(e);return Ea.resolve(e)},hp.prototype.ro=function(t,e){return Ea.resolve(this.il.ro(e))},hp),Jf=(cp.prototype.start=function(){return Promise.resolve()},cp.prototype.ga=function(){return this.Ho=!1,Promise.resolve()},Object.defineProperty(cp.prototype,"br",{get:function(){return this.Ho},enumerable:!1,configurable:!0}),cp.prototype.ha=function(){},cp.prototype.la=function(){},cp.prototype.Na=function(){return this.ki},cp.prototype.Sa=function(t){var e=this.ol[t.ti()];return e||(e=new zf(this.ki,this.qr),this.ol[t.ti()]=e),e},cp.prototype.Da=function(){return this.sa},cp.prototype.Ca=function(){return this.Fi},cp.prototype.runTransaction=function(t,e,n){var r=this;Gr("MemoryPersistence","Starting transaction:",t);var i=new Qf(this.zo.next());return this.qr.cl(),n(i).next(function(t){return r.qr.ul(i).next(function(){return t})}).xn().then(function(t){return i.xi(),t})},cp.prototype.hl=function(e,n){return Ea.kn(Object.values(this.ol).map(function(t){return function(){return t.ro(e,n)}}))},cp),Qf=(n(ap,jf=Te),ap),Yf=(up.fl=function(t){return new up(t)},Object.defineProperty(up.prototype,"dl",{get:function(){if(this._l)return this._l;throw Wr()},enumerable:!1,configurable:!0}),up.prototype.qo=function(t,e,n){return this.ll.qo(n,e),this.dl.delete(n.toString()),Ea.resolve()},up.prototype.Ko=function(t,e,n){return this.ll.Ko(n,e),this.dl.add(n.toString()),Ea.resolve()},up.prototype.so=function(t,e){return this.dl.add(e.toString()),Ea.resolve()},up.prototype.removeTarget=function(t,e){var n=this;this.ll.hu(e.targetId).forEach(function(t){return n.dl.add(t.toString())});var r=this.persistence.Da();return r.Qo(t,e.targetId).next(function(t){t.forEach(function(t){return n.dl.add(t.toString())})}).next(function(){return r.ko(t,e)})},up.prototype.cl=function(){this._l=new Set},up.prototype.ul=function(n){var r=this,i=this.persistence.Ca().wo();return Ea.forEach(this.dl,function(t){var e=_i.H(t);return r.wl(n,e).next(function(t){t||i.pi(e)})}).next(function(){return r._l=null,i.apply(n)})},up.prototype.Ma=function(t,e){var n=this;return this.wl(t,e).next(function(t){t?n.dl.delete(e.toString()):n.dl.add(e.toString())})},up.prototype.al=function(t){return 0},up.prototype.wl=function(t,e){var n=this;return Ea.kn([function(){return Ea.resolve(n.ll.ro(e))},function(){return n.persistence.Da().ro(t,e)},function(){return n.persistence.hl(t,e)}])},up),Xf=(sp.prototype.wc=function(t){this.Il=t},sp.prototype.hc=function(t){this.ml=t},sp.prototype.onMessage=function(t){this.Al=t},sp.prototype.close=function(){this.Tl()},sp.prototype.send=function(t){this.El(t)},sp.prototype.Rl=function(){this.Il()},sp.prototype.Pl=function(t){this.ml(t)},sp.prototype.gl=function(t){this.Al(t)},sp),$f={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Zf=(op.prototype.Sc=function(e,t,n,r){var i=this.bl(e,t);Gr("RestConnection","Sending: ",i,n);t={};return this.vl(t,r),this.Sl(e,i,t,n).then(function(t){return Gr("RestConnection","Received: ",t),t},function(t){throw Kr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},op.prototype.Dc=function(t,e,n,r){return this.Sc(t,e,n,r)},op.prototype.vl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.0.2-20201010222127",t["Content-Type"]="text/plain",e)for(var n in e.si)e.si.hasOwnProperty(n)&&(t[n]=e.si[n])},op.prototype.bl=function(t,e){t=$f[t];return this.yl+"/v1/"+e+":"+t},n(ip,Ff=op),ip.prototype.Sl=function(o,e,s,u){return new Promise(function(n,r){var i=new br;i.listenOnce(mr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case gr.NO_ERROR:var t=i.getResponseJson();Gr("Connection","XHR received:",JSON.stringify(t)),n(t);break;case gr.TIMEOUT:Gr("Connection",'RPC "'+o+'" timed out'),r(new qr(Ur.DEADLINE_EXCEEDED,"Request time out"));break;case gr.HTTP_ERROR:var e=i.getStatus();Gr("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace("_","-"),e=0<=Object.values(Ur).indexOf(e)?e:Ur.UNKNOWN,r(new qr(e,t.message))):r(new qr(Ur.UNKNOWN,"Server responded with status "+i.getStatus())):r(new qr(Ur.UNAVAILABLE,"Connection failed."));break;default:Wr()}}finally{Gr("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},ip.prototype.Ec=function(t,e){var n,r=[this.yl,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new fr,t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this._.projectId+"/databases/"+this._.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.T};this.vl(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=d().indexOf("Electron/")||(0<=(n=d()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=d().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Gr("Connection","Creating WebChannel: "+r,t);var o=i.createWebChannel(r,t),s=!1,u=!1,a=new Xf({El:function(t){u?Gr("Connection","Not sending because WebChannel is closed:",t):(s||(Gr("Connection","Opening WebChannel transport."),o.open(),s=!0),Gr("Connection","WebChannel sending:",t),o.send(t))},Tl:function(){return o.close()}}),t=function(t,e){o.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(wr.EventType.OPEN,function(){u||Gr("Connection","WebChannel transport opened.")}),t(wr.EventType.CLOSE,function(){u||(u=!0,Gr("Connection","WebChannel transport closed"),a.Pl())}),t(wr.EventType.ERROR,function(t){u||(u=!0,Kr("Connection","WebChannel transport errored:",t),a.Pl(new qr(Ur.UNAVAILABLE,"The operation could not be completed")))}),t(wr.EventType.MESSAGE,function(t){var e,n,r,i;u||(Jr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Gr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Fi[r];if(void 0!==t)return zi(t)}(),i=n.message,void 0===t&&(t=Ur.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,a.Pl(new qr(t,i)),o.close()):(Gr("Connection","WebChannel received:",e),a.gl(e)))}),setTimeout(function(){a.Rl()},0),a},ip),tp=(rp.prototype.zc=function(t){this.Fl.push(t)},rp.prototype.ga=function(){window.removeEventListener("online",this.Dl),window.removeEventListener("offline",this.Nl)},rp.prototype.Ol=function(){window.addEventListener("online",this.Dl),window.addEventListener("offline",this.Nl)},rp.prototype.Cl=function(){Gr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Fl;t<e.length;t++)(0,e[t])(0)},rp.prototype.xl=function(){Gr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Fl;t<e.length;t++)(0,e[t])(1)},rp.Ln=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},rp),ep=(np.prototype.zc=function(t){},np.prototype.ga=function(){},np);function np(){}function rp(){var t=this;this.Dl=function(){return t.Cl()},this.Nl=function(){return t.xl()},this.Fl=[],this.Ol()}function ip(t){var e=this;return(e=Ff.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.T=t.T,e}function op(t){this.Vl=t,this._=t._;var e=t.ssl?"https":"http";this.yl=e+"://"+t.host,this.pl="projects/"+this._.projectId+"/databases/"+this._.database+"/documents"}function sp(t){this.El=t.El,this.Tl=t.Tl}function up(t){this.persistence=t,this.ll=new zl,this._l=null}function ap(t){var e=this;return(e=jf.call(this)||this).Wo=t,e}function cp(t){var e=this;this.ol={},this.zo=new lc(0),this.Ho=!1,this.Ho=!0,this.qr=t(this),this.sa=new Wf(this),this.ki=new ah,this.Fi=(t=this.ki,new Kf(t,function(t){return e.qr.al(t)}))}function hp(t){this.persistence=t,this.nl=new gi(Ci,Ui),this.lastRemoteSnapshotVersion=wi.min(),this.highestTargetId=0,this.sl=0,this.il=new zl,this.targetCount=0,this.rl=Rh.Vo()}function lp(t){var e=this;return(e=Bf.call(this)||this).Io=t,e}function fp(t,e){this.ki=t,this.tl=e,this.docs=new Ki(_i.D),this.size=0}function pp(t,e){this.ki=t,this.qr=e,this.Oi=[],this.zh=1,this.Hh=new $i(Kl.iu)}function dp(){}function yp(t){return new Jo(t,!0)}var vp,gp,mp=(Sp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Sh=this.kl(e),this.persistence=this.Ml(e),[4,this.persistence.start()];case 1:return t.sent(),this.$l=this.Ll(e),this.Bc=this.Bl(e),[2]}})})},Sp.prototype.Ll=function(t){return null},Sp.prototype.Bl=function(t){return e=this.persistence,n=new Gf,t=t.ql,new Zh(e,n,t);var e,n},Sp.prototype.Ml=function(t){return new Jf(Yf.fl)},Sp.prototype.kl=function(t){return new rf},Sp.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.$l&&this.$l.stop(),[4,this.Sh.ga()];case 1:return t.sent(),[4,this.persistence.ga()];case 2:return t.sent(),[2]}})})},Sp),wp=(n(Dp,gp=mp),Dp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,gp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,hl(this.Bc)];case 2:return t.sent(),[4,this.Ul.initialize(this,e)];case 3:return t.sent(),[4,Mf(this.Ul.mu)];case 4:return t.sent(),[4,ql(this.Ul.ph)];case 5:return t.sent(),[2]}})})},Dp.prototype.Ll=function(t){var e=this.persistence.qr.gr;return new Oc(e,t.cs)},Dp.prototype.Ml=function(t){var e=$h(t.Vl._,t.Vl.persistenceKey),n=void 0!==this.cacheSizeBytes?Nc.Ir(this.cacheSizeBytes):Nc.Rr,r=yp(t.Vl._);return new zh(this.synchronizeTabs,e,t.clientId,n,t.cs,Ma(),Fa(),r,this.Sh,!!this.forceOwnership)},Dp.prototype.kl=function(t){return new rf},Dp),bp=(n(Np,vp=wp),Np.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,vp.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Ul.mu,this.Sh instanceof nf?(this.Sh.mu={sh:Rf.bind(null,e),ih:function(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return(e=i).qh?(Gr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.xh.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,cl(e.Bc)];case 3:return n=t.sent(),r=lo.Xt(o,"current"===s),[4,kf(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,sl(e.Bc,o,!0)];case 6:return t.sent(),Sf(e,o,u),[3,8];case 7:Wr(),t.label=8;case 8:return[2]}})})}.bind(null,e),rh:function(c,h,l){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=qf(c)).qh)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.xh.has(r)?(Gr("SyncEngine","Adding an already active target "+r),[3,5]):[4,al(n.Bc,r)]):[3,6];case 2:return i=t.sent(),[4,ol(n.Bc,i)];case 3:return o=t.sent(),[4,bf(n,Uf(i),o.targetId,!1)];case 4:t.sent(),Dl(n.ph,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.xh.has(e)?[4,sl(n.Bc,e,!1).then(function(){Sl(n.ph,e),Sf(n,e)}).catch(ll)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=l,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),va:function(t){return t.Bc.persistence.va()}.bind(null,e)},[4,this.Sh.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.ua(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Vf(this.Ul.mu,e)];case 1:return t.sent(),this.$l&&(e&&!this.$l.br?this.$l.start(this.Bc):e||this.$l.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Np.prototype.kl=function(t){var e=Ma();if(!nf.Ln(e))throw new qr(Ur.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=$h(t.Vl._,t.Vl.persistenceKey);return new nf(e,t.cs,n,t.clientId,t.ql)},Np),Ip=(Ap.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Bc?[3,2]:(this.Bc=n.Bc,this.Sh=n.Sh,this.qc=this.Kl(r),this.ph=this.Ql(r),this.bh=this.Wl(r),this.mu=this.jl(r,!n.synchronizeTabs),this.Sh.Cc=function(t){return _f(e.mu,t,1)},this.ph.Uc.Gl=Lf.bind(null,this.mu),[4,jl(this.ph,this.mu.Uh)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ap.prototype.Wl=function(t){return new Ha},Ap.prototype.Kl=function(t){var e=yp(t.Vl._),n=(n=t.Vl,new Zf(n));return t=t.credentials,new ml(t,n,e)},Ap.prototype.Ql=function(t){var e=this,n=this.Bc,r=this.qc,i=t.cs,o=function(t){return _f(e.mu,t,0)},t=new(tp.Ln()?tp:ep);return new fl(n,r,i,o,t)},Ap.prototype.jl=function(t,e){return function(t,e,n,r,i,o,s){o=new hf(t,e,n,r,i,o);return s&&(o.qh=!0),o}(this.Bc,this.ph,this.bh,this.Sh,t.ql,t.Dh,e)},Ap.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,Gr("RemoteStore","RemoteStore shutting down."),e.Wc.add(5),[4,Nl(e)];case 1:return t.sent(),e.Gc.ga(),e.Hc.set("Unknown"),[2]}})})}(this.ph)},Ap),Ep=(Tp.prototype.next=function(t){this.observer.next&&this.zl(this.observer.next,t)},Tp.prototype.error=function(t){this.observer.error?this.zl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Tp.prototype.Hl=function(){this.muted=!0},Tp.prototype.zl=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Tp),_p=function(t){this.Jl=t};function Tp(t){this.observer=t,this.muted=!1}function Ap(){}function Np(t,e){var n=this;return(n=vp.call(this,t,e,!1)||this).Ul=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function Dp(t,e,n){var r=this;return(r=gp.call(this)||this).Ul=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function Sp(){this.synchronizeTabs=!1}function Op(t,e,n){if(!n)throw new qr(Ur.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function xp(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new qr(Ur.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Pp(t,e,n,r){if(!0===e&&!0===r)throw new qr(Ur.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function kp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Wr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Lp(t,e){if(t instanceof _p&&(t=t.Jl),t instanceof e)return t;if(e.name===t.constructor.name)throw new qr(Ur.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=kp(t);throw new qr(Ur.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function Rp(t,e){if(e<=0)throw new qr(Ur.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Vp,Cp=function(t){this.Yl=t},Up=(n(qp,Vp=Cp),qp.prototype.Xl=function(t){if(2!==t.Zl)throw 1===t.Zl?t.t_(this.Yl+"() can only appear at the top level of your update data"):t.t_(this.Yl+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},qp.prototype.isEqual=function(t){return t instanceof qp},qp);function qp(){return null!==Vp&&Vp.apply(this,arguments)||this}function Mp(t,e,n){return new Ad({Zl:3,e_:e.settings.e_,methodName:t.Yl,n_:n},e._,e.serializer,e.ignoreUndefinedProperties)}var Fp,jp,Bp,Gp,zp,Kp=(n(ad,zp=Cp),ad.prototype.Xl=function(t){return new Ms(t.path,new Ts)},ad.prototype.isEqual=function(t){return t instanceof ad},ad),Hp=(n(ud,Gp=Cp),ud.prototype.Xl=function(t){var e=Mp(this,t,!0),n=this.s_.map(function(t){return Ld(t,e)}),n=new As(n);return new Ms(t.path,n)},ud.prototype.isEqual=function(t){return this===t},ud),Wp=(n(sd,Bp=Cp),sd.prototype.Xl=function(t){var e=Mp(this,t,!0),n=this.s_.map(function(t){return Ld(t,e)}),n=new xs(n);return new Ms(t.path,n)},sd.prototype.isEqual=function(t){return this===t},sd),Jp=(n(od,jp=Cp),od.prototype.Xl=function(t){var e=new Rs(t.serializer,Xo(t.serializer,this.i_));return new Ms(t.path,e)},od.prototype.isEqual=function(t){return this===t},od),Qp=(Object.defineProperty(id.prototype,"latitude",{get:function(){return this.r_},enumerable:!1,configurable:!0}),Object.defineProperty(id.prototype,"longitude",{get:function(){return this.o_},enumerable:!1,configurable:!0}),id.prototype.isEqual=function(t){return this.r_===t.r_&&this.o_===t.o_},id.prototype.toJSON=function(){return{latitude:this.r_,longitude:this.o_}},id.prototype.g=function(t){return Xr(this.r_,t.r_)||Xr(this.o_,t.o_)},id),Yp=new Map,Xp=(rd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},rd),$p=(nd.prototype.h_=function(t){switch(Po(t)){case 0:return null;case 1:return t.booleanValue;case 2:return qo(t.integerValue||t.doubleValue);case 3:return this.l_(t.timestampValue);case 4:return this.__(t);case 5:return t.stringValue;case 6:return this.u_(Mo(t.bytesValue));case 7:return this.f_(t.referenceValue);case 8:return this.d_(t.geoPointValue);case 9:return this.w_(t.arrayValue);case 10:return this.E_(t.mapValue);default:throw Wr()}},nd.prototype.E_=function(t){var n=this,r={};return pi(t.fields||{},function(t,e){r[t]=n.h_(e)}),r},nd.prototype.d_=function(t){return new Qp(qo(t.latitude),qo(t.longitude))},nd.prototype.w_=function(t){var e=this;return(t.values||[]).map(function(t){return e.h_(t)})},nd.prototype.__=function(t){switch(this.a_){case"previous":var e=function t(e){e=e.mapValue.fields.__previous_value__;return So(e)?t(e):e}(t);return null==e?null:this.h_(e);case"estimate":return this.l_(Oo(t));default:return null}},nd.prototype.l_=function(t){t=Uo(t);return new mi(t.seconds,t.nanos)},nd.prototype.f_=function(t){var e=bi.q(t);Jr(bs(e));t=new ci(e.get(1),e.get(3)),e=new _i(e.N(5));return t.isEqual(this._)||zr("Document "+e+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+this._.projectId+"/"+this._.database+") instead."),this.c_(e)},nd),l=(Object.defineProperty(ed.prototype,"id",{get:function(){return this.I_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(ed.prototype,"ref",{get:function(){return new fd(this.T_,this.A_,this.I_)},enumerable:!1,configurable:!0}),ed.prototype.exists=function(){return null!==this.m_},ed.prototype.data=function(){var e=this;if(this.m_){if(this.A_){var t=new Zp(this.T_,this.I_,this.m_,null);return this.A_.fromFirestore(t)}return new $p(this.T_.R_,"none",function(t){return new fd(e.T_,null,t)},function(t){return new ni(t)}).h_(this.m_.rn())}},ed.prototype.get=function(t){var e=this;if(this.m_){t=this.m_.data().field(cd("DocumentSnapshot.get",t));if(null!==t)return new $p(this.T_.R_,"none",function(t){return new fd(e.T_,e.A_,t)},function(t){return new ni(t)}).h_(t)}},ed),Zp=(n(td,Fp=l),td.prototype.data=function(){return Fp.prototype.data.call(this)},td);function td(){return null!==Fp&&Fp.apply(this,arguments)||this}function ed(t,e,n,r){this.T_=t,this.I_=e,this.m_=n,this.A_=r}function nd(t,e,n,r){this._=t,this.a_=e,this.c_=n,this.u_=r}function rd(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new qr(Ur.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new qr(Ur.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Pp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function id(t,e){if(!isFinite(t)||t<-90||90<t)throw new qr(Ur.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new qr(Ur.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.r_=t,this.o_=e}function od(t,e){var n=this;return(n=jp.call(this,t)||this).i_=e,n}function sd(t,e){var n=this;return(n=Bp.call(this,t)||this).s_=e,n}function ud(t,e){var n=this;return(n=Gp.call(this,t)||this).s_=e,n}function ad(){return null!==zp&&zp.apply(this,arguments)||this}function cd(t,e){return"string"==typeof e?Md(t,e):e.P_}var hd,ld=(gd.prototype.isEqual=function(t){return this.P_.isEqual(t.P_)},gd),fd=(Object.defineProperty(vd.prototype,"g_",{get:function(){return this.I_.path},enumerable:!1,configurable:!0}),Object.defineProperty(vd.prototype,"id",{get:function(){return this.I_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(vd.prototype,"path",{get:function(){return this.I_.path.B()},enumerable:!1,configurable:!0}),Object.defineProperty(vd.prototype,"parent",{get:function(){return new pd(this.firestore,this.A_,this.I_.path.F())},enumerable:!1,configurable:!0}),vd.prototype.withConverter=function(t){return new vd(this.firestore,t,this.I_)},vd),pd=(yd.prototype.withConverter=function(t){return new yd(this.firestore,t,this.V_)},n(dd,hd=yd),Object.defineProperty(dd.prototype,"id",{get:function(){return this.V_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"path",{get:function(){return this.V_.path.B()},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"parent",{get:function(){var t=this.g_.F();return t.P()?null:new fd(this.firestore,null,new _i(t))},enumerable:!1,configurable:!0}),dd.prototype.withConverter=function(t){return new dd(this.firestore,t,this.g_)},dd);function dd(t,e,n){var r=this;return(r=hd.call(this,t,e,Du(n))||this).firestore=t,r.g_=n,r.type="collection",r}function yd(t,e,n){this.A_=e,this.V_=n,this.type="query",this.firestore=t}function vd(t,e,n){this.A_=e,this.I_=n,this.type="document",this.firestore=t}function gd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new qr(Ur.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.P_=new Ei(t)}function md(t){var e=t.y_(),n=yp(t.R_);return new Nd(t.R_,!!e.ignoreUndefinedProperties,n)}var wd=/^__.*__$/,bd=(_d.prototype.p_=function(t,e){var n=[];return null!==this.Qe?n.push(new $s(t,this.data,this.Qe,e)):n.push(new Xs(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new ru(t,this.fieldTransforms)),n},_d),Id=(Ed.prototype.p_=function(t,e){e=[new $s(t,this.data,this.Qe,e)];return 0<this.fieldTransforms.length&&e.push(new ru(t,this.fieldTransforms)),e},Ed);function Ed(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function _d(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function Td(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Wr()}}var Ad=(Object.defineProperty(Sd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Sd.prototype,"Zl",{get:function(){return this.settings.Zl},enumerable:!1,configurable:!0}),Sd.prototype.v_=function(t){return new Sd(Object.assign(Object.assign({},this.settings),t),this._,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},Sd.prototype.S_=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.v_({path:e,n_:!1});return e.D_(t),e},Sd.prototype.C_=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.v_({path:t,n_:!1});return t.b_(),t},Sd.prototype.N_=function(t){return this.v_({path:void 0,n_:!0})},Sd.prototype.t_=function(t){return Fd(t,this.settings.methodName,this.settings.x_||!1,this.path,this.settings.e_)},Sd.prototype.contains=function(e){return void 0!==this.Qe.find(function(t){return e.M(t)})||void 0!==this.fieldTransforms.find(function(t){return e.M(t.field)})},Sd.prototype.b_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.D_(this.path.get(t))},Sd.prototype.D_=function(t){if(0===t.length)throw this.t_("Document fields must not be empty");if(Td(this.Zl)&&wd.test(t))throw this.t_('Document fields cannot begin and end with "__"')},Sd),Nd=(Dd.prototype.F_=function(t,e,n,r){return void 0===r&&(r=!1),new Ad({Zl:t,methodName:e,e_:n,path:Ei.U(),n_:!1,x_:r},this._,this.serializer,this.ignoreUndefinedProperties)},Dd);function Dd(t,e,n){this._=t,this.ignoreUndefinedProperties=e,this.serializer=n||yp(t)}function Sd(t,e,n,r,i,o){this.settings=t,this._=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.b_(),this.fieldTransforms=i||[],this.Qe=o||[]}function Od(t,e,n,r,i,o){void 0===o&&(o={});var s=t.F_(o.merge||o.mergeFields?2:0,e,n,i);Cd("Data must be an object, but it was:",s,r);var u,a,r=Rd(r,s);if(o.merge)u=new qs(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=Ud(e,l[h],n);if(!s.contains(f))throw new qr(Ur.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");jd(c,f)||c.push(f)}u=new qs(c),a=s.fieldTransforms.filter(function(t){return u.Je(t.field)})}else u=null,a=s.fieldTransforms;return new bd(new hu(r),u,a)}function xd(t,r,i,e){var o=t.F_(1,r,i);Cd("Data must be an object, but it was:",o,e);var s=[],u=new lu;pi(e,function(t,e){var n=Md(r,t,i);e instanceof _p&&(e=e.Jl);t=o.C_(n);e instanceof Up?s.push(n):null!=(t=Ld(e,t))&&(s.push(n),u.set(n,t))});e=new qs(s);return new Id(u.Xe(),e,o.fieldTransforms)}function Pd(t,e,n,r,i,o){var s=t.F_(1,e,n),u=[Ud(e,r,n)],a=[i];if(o.length%2!=0)throw new qr(Ur.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Ud(e,o[c])),a.push(o[c+1]);for(var h,l,f,p=[],d=new lu,y=u.length-1;0<=y;--y){jd(p,u[y])||(h=u[y],(l=a[y])instanceof _p&&(l=l.Jl),f=s.C_(h),l instanceof Up?p.push(h):null!=(f=Ld(l,f))&&(p.push(h),d.set(h,f)))}i=new qs(p);return new Id(d.Xe(),i,s.fieldTransforms)}function kd(t,e,n,r){return void 0===r&&(r=!1),Ld(n,t.F_(r?4:3,e))}function Ld(s,t){if(s instanceof _p&&(s=s.Jl),Vd(s))return Cd("Unsupported field value:",t,s),Rd(s,t);if(s instanceof Cp)return function(t,e){if(!Td(e.Zl))throw e.t_(t.Yl+"() can only be used with update() and set()");if(!e.path)throw e.t_(t.Yl+"() is not currently supported inside arrays");t=t.Xl(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.Qe.push(t.path),s instanceof Array){if(t.settings.n_&&4!==t.Zl)throw t.t_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Ld(i[r],t.N_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(t instanceof _p&&(t=t.Jl),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Xo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=mi.fromDate(t);return{timestampValue:$o(e.serializer,n)}}if(t instanceof mi){var r=new mi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:$o(e.serializer,r)}}if(t instanceof Qp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ni)return{bytesValue:Zo(e.serializer,t.l)};if(t instanceof fd){n=e._,r=t.firestore.R_;if(!r.isEqual(n))throw e.t_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:es(t.firestore.R_||e._,t.I_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.t_("Unsupported field value: "+kp(t))}(s,t)}function Rd(t,n){var r={};return di(t)?n.path&&0<n.path.length&&n.Qe.push(n.path):pi(t,function(t,e){e=Ld(e,n.S_(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function Vd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof mi||t instanceof Qp||t instanceof ni||t instanceof fd||t instanceof Cp)}function Cd(t,e,n){if(!Vd(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=kp(n);throw"an object"===n?e.t_(t+" a custom object"):e.t_(t+" "+n)}var r}function Ud(t,e,n){if(e instanceof _p&&(e=e.Jl),e instanceof ld)return e.P_;if("string"==typeof e)return Md(t,e);throw Fd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var qd=new RegExp("[~\\*/\\[\\]]");function Md(e,n,r){if(0<=n.search(qd))throw Fd("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(ld.bind.apply(ld,o([void 0],n.split("."))))).P_}catch(t){throw Fd("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Fd(t,e,n,r,i){var o=r&&!r.P(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new qr(Ur.INVALID_ARGUMENT,(e+=". ")+t+n)}function jd(t,e){return t.some(function(t){return t.isEqual(e)})}var Bd=(Wd.prototype.B_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.q_(),0<this.mutations.length)throw new qr(Ur.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=us((n=s).serializer)+"/documents",r={documents:u.map(function(t){return rs(n.serializer,t)})},[4,n.Dc("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.serializer,"found"in(t=t)?function(t,e){Jr(!!e.found),e.found.name,e.found.updateTime;var n=is(t,e.found.name),t=ts(e.found.updateTime),e=new hu({mapValue:{fields:e.found.fields}});return new wu(n,t,e,{})}(e,t):"missing"in t?function(t,e){Jr(!!e.missing),Jr(!!e.readTime);t=is(t,e.missing),e=ts(e.readTime);return new bu(t,e)}(e,t):Wr());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){t=i.get(t.toString());Jr(!!t),o.push(t)}),o)]}})})}(this.qc,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof bu||t instanceof wu?n.U_(t):Wr()}),e)]}})})},Wd.prototype.set=function(t,e){this.write(e.p_(t,this.Ge(t))),this.L_.add(t.toString())},Wd.prototype.update=function(t,e){try{this.write(e.p_(t,this.K_(t)))}catch(t){this.M_=t}this.L_.add(t.toString())},Wd.prototype.delete=function(t){this.write([new au(t,this.Ge(t))]),this.L_.add(t.toString())},Wd.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.q_(),this.M_)throw this.M_;return e=this.O_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=_i.H(e);n.mutations.push(new cu(e,n.Ge(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=us((e=i).serializer)+"/documents",r={writes:o.map(function(t){return hs(e.serializer,t)})},[4,e.Sc("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.qc,this.mutations)];case 1:return t.sent(),this.k_=!0,[2]}})})},Wd.prototype.U_=function(t){var e;if(t instanceof wu)e=t.version;else{if(!(t instanceof bu))throw Wr();e=wi.min()}var n=this.O_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new qr(Ur.ABORTED,"Document version changed between two reads.")}else this.O_.set(t.key.toString(),e)},Wd.prototype.Ge=function(t){var e=this.O_.get(t.toString());return!this.L_.has(t.toString())&&e?Bs.updateTime(e):Bs.ze()},Wd.prototype.K_=function(t){var e=this.O_.get(t.toString());if(this.L_.has(t.toString())||!e)return Bs.exists(!0);if(e.isEqual(wi.min()))throw new qr(Ur.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Bs.updateTime(e)},Wd.prototype.write=function(t){this.q_(),this.mutations=this.mutations.concat(t)},Wd.prototype.q_=function(){},Wd),Gd=(Hd.prototype.run=function(){this.W_()},Hd.prototype.W_=function(){var t=this;this.Vs.Pn(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Bd(this.qc),(n=this.j_(e))&&n.then(function(t){r.cs.ws(function(){return e.commit().then(function(){r.ls.resolve(t)}).catch(function(t){r.G_(t)})})}).catch(function(t){r.G_(t)}),[2]})})})},Hd.prototype.j_=function(t){try{var e=this.updateFunction(t);return!Pi(e)&&e.catch&&e.then?e:(this.ls.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ls.reject(t),null}},Hd.prototype.G_=function(t){var e=this;0<this.Q_&&this.z_(t)?(--this.Q_,this.cs.ws(function(){return e.W_(),Promise.resolve()})):this.ls.reject(t)},Hd.prototype.z_=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Gi(t)},Hd),zd=(Kd.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.ui.promise];case 1:return[2,(t.sent(),{cs:this.cs,Vl:this.Vl,clientId:this.clientId,credentials:this.credentials,ql:this.user,Dh:100})]}})})},Kd.prototype.J_=function(t){var e=this;this.H_=t,this.ui.promise.then(function(){return e.H_(e.user)})},Kd.prototype.Y_=function(){if(this.cs.ps)throw new qr(Ur.FAILED_PRECONDITION,"The client has already been terminated.")},Kd.prototype.terminate=function(){var t=this;this.cs.Ds();var n=new ba;return this.cs.bs(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.X_?[4,this.X_.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Z_?[4,this.Z_.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.ai(),n.resolve(),[3,6];case 5:return e=t.sent(),e=Ka(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Kd);function Kd(t,e,n){var r=this;this.credentials=t,this.cs=e,this.Vl=n,this.user=$a.UNAUTHENTICATED,this.clientId=Qr.t(),this.H_=function(){},this.ui=new ba,this.credentials.oi(function(t){Gr("FirestoreClient","Received user=",t.uid),r.user.isEqual(t)||(r.user=t,r.H_(t)),r.ui.resolve()})}function Hd(t,e,n,r){this.cs=t,this.qc=e,this.updateFunction=n,this.ls=r,this.Q_=5,this.Vs=new Ia(this.cs,"transaction_retry")}function Wd(t){this.qc=t,this.O_=new Map,this.mutations=[],this.k_=!1,this.M_=null,this.L_=new Set}function Jd(r,i){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return r.cs.Fs(),Gr("FirestoreClient","Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return e=t.sent(),[4,i.initialize(e)];case 2:return t.sent(),r.J_(function(e){return r.cs.Cs(function(){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,el(i.Bc,e)];case 1:return t.sent(),[2]}})})})}),i.persistence.ha(function(){return r.terminate()}),r.Z_=i,[2]}})})}function Qd(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return r.cs.Fs(),[4,Yd(r)];case 1:return e=t.sent(),Gr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.J_(function(t){return r.cs.Cs(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).cs.Fs(),Gr("RemoteStore","RemoteStore received new credentials"),n=Ll(e),e.Wc.add(3),[4,Nl(e)];case 1:return t.sent(),n&&e.Hc.set("Unknown"),[4,e.Uc.Gl(i)];case 2:return t.sent(),e.Wc.delete(3),[4,Al(e)];case 3:return t.sent(),[2]}})})}(i.ph,t)})}),r.X_=i,[2]}})})}function Yd(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.Z_?[3,2]:(Gr("FirestoreClient","Using default OfflineComponentProvider"),[4,Jd(e,new mp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.Z_]}})})}function Xd(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.X_?[3,2]:(Gr("FirestoreClient","Using default OnlineComponentProvider"),[4,Qd(e,new Ip)]);case 1:t.sent(),t.label=2;case 2:return[2,e.X_]}})})}function $d(t){return Yd(t).then(function(t){return t.persistence})}function Zd(t){return Yd(t).then(function(t){return t.Bc})}function ty(t){return Xd(t).then(function(t){return t.ph})}function ey(t){return Xd(t).then(function(t){return t.mu})}function ny(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Xd(r)];case 1:return e=t.sent(),[2,((n=e.bh).Us=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=qf(s),(o=e.Nh.get(u))?(n=o.targetId,e.Sh.Bu(n),r=o.view.Vh(),[3,4]):[3,1];case 1:return[4,ol(e.Bc,Ru(u))];case 2:return i=t.sent(),o=e.Sh.Bu(i.targetId),n=i.targetId,[4,bf(e,u,n,"current"===o)];case 3:r=t.sent(),e.Uh&&Dl(e.ph,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.mu),n.Ws=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Nh.get(o),1<(r=e.xh.get(n.targetId)).length?[2,(e.xh.set(n.targetId,r.filter(function(t){return!qu(t,o)})),void e.Nh.delete(o))]:e.Uh?(e.Sh.Uu(n.targetId),e.Sh.Ou(n.targetId)?[3,2]:[4,sl(e.Bc,n.targetId,!1).then(function(){e.Sh.Qu(n.targetId),Sl(e.ph,n.targetId),Sf(e,n.targetId)}).catch(ll)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Sf(e,n.targetId),[4,sl(e.Bc,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.mu),n)]}})})}function ry(n,r){var t=this,i=new ba;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=If,[4,ey(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}function iy(i,o,s){return y(this,void 0,void 0,function(){var r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=o,(n=i).persistence.runTransaction("read document","readonly",function(t){return n.Ka.Mi(t,e)}))];case 1:return(r=t.sent())instanceof wu?s.resolve(r):r instanceof bu?s.resolve(null):s.reject(new qr(Ur.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),r=Ka(r,"Failed to get document '"+o+" from cache"),s.reject(r),[3,3];case 3:return[2]}var e,n})})}function oy(n,r,i,o,s){var t=new Ep({next:function(t){r.ws(function(){return Qa(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new qr(Ur.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new qr(Ur.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new Xa(Du(i.path),t,{includeMetadataChanges:!0,Xs:!0});return Ja(n,u)}function sy(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var uy,ay=(Object.defineProperty(hy.prototype,"app",{get:function(){if(!this.if)throw new qr(Ur.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.if},enumerable:!1,configurable:!0}),Object.defineProperty(hy.prototype,"rf",{get:function(){return this.nf},enumerable:!1,configurable:!0}),Object.defineProperty(hy.prototype,"af",{get:function(){return void 0!==this.cf},enumerable:!1,configurable:!0}),hy.prototype.uf=function(t){if(this.nf)throw new qr(Ur.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.ef=new Xp(t),void 0!==t.credentials&&(this.sf=function(t){if(!t)return new nc;switch(t.type){case"gapi":var e=t.client;return Jr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new oc(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new qr(Ur.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},hy.prototype.hf=function(){return this.ef},hy.prototype.y_=function(){return this.nf=!0,this.ef},hy.prototype._delete=function(){return this.cf||(this.cf=this.lf()),this.cf},hy.prototype.lf=function(){return t=this,(e=Yp.get(t))&&(Gr("ComponentProvider","Removing Datastore"),Yp.delete(t),e.terminate()),Promise.resolve();var t,e},n(cy,uy=hy),cy.prototype.lf=function(){return this.ff||xy(this),this.ff.terminate()},cy);function cy(t,e){var n=this;return(n=uy.call(this,t,e)||this)._f=new Ba,n.tf="name"in t?t.name:"[DEFAULT]",n}function hy(t,e){this.tf="(lite)",this.ef=new Xp({}),this.nf=!1,t instanceof ci?(this.R_=t,this.sf=new nc):(this.if=t,this.R_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new qr(Ur.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ci(t.options.projectId)}(t),this.sf=new rc(e))}function ly(n,r,i){var t=this,o=new ba;return n.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,Jd(n,i)];case 1:return t.sent(),[4,Qd(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===Ur.FAILED_PRECONDITION||t.code===Ur.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function fy(t){if(t.rf||t.af)throw new qr(Ur.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var py,dy,yy=(n(by,dy=l),by.prototype.exists=function(){return dy.prototype.exists.call(this)},by.prototype.data=function(t){var e=this;if(this.m_){if(this.A_){var n=new vy(this.T_,this.I_,this.m_,this.metadata,null);return this.A_.fromFirestore(n,t)}return new $p(this.df.R_,(null==t?void 0:t.serverTimestamps)||"none",function(t){return new fd(e.T_,null,t)},function(t){return new ni(t)}).h_(this.m_.rn())}},by.prototype.get=function(t,e){var n=this;if(void 0===e&&(e={}),this.m_){t=this.m_.data().field(cd("DocumentSnapshot.get",t));if(null!==t)return new $p(this.df.R_,e.serverTimestamps||"none",function(t){return new fd(n.T_,n.A_,t)},function(t){return new ni(t)}).h_(t)}},by),vy=(n(wy,py=yy),wy.prototype.data=function(t){return void 0===t&&(t={}),py.prototype.data.call(this,t)},wy),gy=(Object.defineProperty(my.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(my.prototype,"size",{get:function(){return this.wf.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(my.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),my.prototype.forEach=function(e,n){var r=this;this.wf.docs.forEach(function(t){e.call(n,r.Ef(t,r.wf.fromCache,r.wf.Qt.has(t.key)))})},my.prototype.docChanges=function(t){void 0===t&&(t={});t=!!t.includeMetadataChanges;if(t&&this.wf.jt)throw new qr(Ur.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Tf&&this.If===t||(this.Tf=iv(this.wf,t,this.Ef.bind(this)),this.If=t),this.Tf},my.prototype.Ef=function(t,e,n){return new vy(this.T_,t.key,t,new Fy(n,e),this.query.A_)},my);function my(t,e,n){this.T_=t,this.wf=n,this.metadata=new Fy(n.hasPendingWrites,n.fromCache),this.query=e}function wy(){return null!==py&&py.apply(this,arguments)||this}function by(t,e,n,r,i){var o=this;return(o=dy.call(this,t,e,n,i)||this).T_=t,o.df=t,o.metadata=r,o}function Iy(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Lp(t.firestore,ay),s=md(o);return e instanceof _p&&(e=e.Jl),Ey(o,("string"==typeof e||e instanceof ld?Pd(s,"updateDoc",t.I_,e,n,r):xd(s,"updateDoc",t.I_,e)).p_(t.I_,Bs.exists(!0)))}function Ey(t,e){return ry(Oy(t),e)}function _y(t,e,n){var r=n.docs.get(e.I_);return new yy(t,e.I_,r,new Fy(n.hasPendingWrites,n.fromCache),e.A_)}var Ty,Ay=(Sy.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){fy(t);var n=Oy(t),r=t.y_(),t=new Ip;return ly(n,t,new wp(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t.Jl,{forceOwnership:e})},Sy.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){fy(t);var e=Oy(t),n=t.y_(),t=new Ip;return ly(e,t,new bp(t,n.cacheSizeBytes))}(t.Jl)},Sy.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n.rf&&!n.af)throw new qr(Ur.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new ba;return n._f.bs(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return _a.Ln()?(e=n+"main",[4,_a.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}($h(n.R_,n.tf))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t.Jl)},Sy),Ny=(n(Dy,Ty=_p),Object.defineProperty(Dy.prototype,"R_",{get:function(){return this.Jl.R_},enumerable:!1,configurable:!0}),Dy.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.Jl.hf()),t)).merge,this.Jl.uf(t)},Dy.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this.Jl.hf().host&&Kr("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},Dy.prototype.enableNetwork=function(){return function(r){var t=this;return r.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,$d(r)];case 1:return e=t.sent(),[4,ty(r)];case 2:return n=t.sent(),[2,(e.la(!0),(t=n).Wc.delete(0),Al(t))]}})})})}(Oy(this.Jl))},Dy.prototype.disableNetwork=function(){return function(r){var t=this;return r.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,$d(r)];case 1:return e=t.sent(),[4,ty(r)];case 2:return n=t.sent(),[2,(e.la(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Wc.add(0),[4,Nl(e)];case 1:return t.sent(),e.Hc.set("Offline"),[2]}})})}(n))]}})})})}(Oy(this.Jl))},Dy.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Pp("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.mf.enableMultiTabIndexedDbPersistence(this):this.mf.enableIndexedDbPersistence(this,n)},Dy.prototype.clearPersistence=function(){return this.mf.clearIndexedDbPersistence(this)},Dy.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Dy.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new ba;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Af,[4,ey(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Oy(this.Jl))},Dy.prototype.onSnapshotsInSync=function(t){return function(t,e){var n=this,r=Oy(t),e=sy(e)?e:{next:e},i=new Ep(e);return t._f.ws(function(){return y(n,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.qs.add(e),e.next()},[4,ny(r)];case 1:return e.apply(void 0,[t.sent(),i]),[2]}})})}),function(){i.Hl(),t._f.ws(function(){return y(n,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.qs.delete(e)},[4,ny(r)];case 1:return e.apply(void 0,[t.sent(),i]),[2]}})})})}}(this.Jl,t)},Object.defineProperty(Dy.prototype,"app",{get:function(){if(!this.Af)throw new qr(Ur.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Af},enumerable:!1,configurable:!0}),Dy.prototype.collection=function(t){return Op("Firestore.collection","path",t),Oy(this.Jl),new Zy(bi.q(t),this,null)},Dy.prototype.doc=function(t){return Op("Firestore.doc","path",t),Oy(this.Jl),Ry.Rf(bi.q(t),this,null)},Dy.prototype.collectionGroup=function(t){if(Op("Firestore.collectionGroup","collectionId",t),0<=t.indexOf("/"))throw new qr(Ur.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return Oy(this.Jl),new Xy((t=t,new Eu(bi.U(),t)),this,null)},Dy.prototype.runTransaction=function(e){var n=this;return function(n,r){var t=this,i=new ba;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,Xd(n).then(function(t){return t.qc})];case 1:return e=t.sent(),new Gd(n.cs,e,r,i).run(),[2]}})})}),i.promise}(Oy(this.Jl),function(t){return e(new ky(n,t))})},Dy.prototype.batch=function(){return Oy(this.Jl),new Ly(this)},Dy);function Dy(t,e,n){var i=this;return(i=Ty.call(this,e)||this).mf=n,i.INTERNAL={delete:function(){return r=i.Jl,t=r.app,void 0===n&&(n=Dr),e=e="firestore-exp",t.container.getProvider(e).clearInstance(n),r._delete();var t,e,n,r}},t instanceof ci||(i.Af=t),i}function Sy(){}function Oy(t){return t.ff||xy(t),t.ff.Y_(),t.ff}function xy(t){var e,n,r=t.y_(),r=(e=t.R_,n=t.tf,new ai(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.ff=new zd(t.sf,t._f,r)}var Py,ky=(Uy.prototype.get=function(t){var e=this,n=rv(0,t,this.T_);return this.Pf.B_([n.I_]).then(function(t){if(!t||1!==t.length)return Wr();t=t[0];if(t instanceof bu)return new jy(e.T_,n.I_,null,!1,!1,n.A_);if(t instanceof wu)return new jy(e.T_,n.I_,t,!1,!1,n.A_);throw Wr()})},Uy.prototype.set=function(t,e,n){t=rv(0,t,this.T_);n=xp("Transaction.set",n);e=ov(t.A_,e,n),n=Od(this.gf,"Transaction.set",t.I_,e,null!==t.A_,n);return this.Pf.set(t.I_,n),this},Uy.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=rv(0,t,this.T_);return e instanceof _p&&(e=e.Jl),e="string"==typeof e||e instanceof ld?Pd(this.gf,"Transaction.update",t.I_,e,n,r):xd(this.gf,"Transaction.update",t.I_,e),this.Pf.update(t.I_,e),this},Uy.prototype.delete=function(t){t=rv(0,t,this.T_);return this.Pf.delete(t.I_),this},Uy),Ly=(Cy.prototype.set=function(t,e,n){this.pf();t=rv(0,t,this.T_);n=xp("WriteBatch.set",n);e=ov(t.A_,e,n),n=Od(this.gf,"WriteBatch.set",t.I_,e,null!==t.A_,n);return this.Vf=this.Vf.concat(n.p_(t.I_,Bs.ze())),this},Cy.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.pf();t=rv(0,t,this.T_);return e instanceof _p&&(e=e.Jl),e="string"==typeof e||e instanceof ld?Pd(this.gf,"WriteBatch.update",t.I_,e,n,r):xd(this.gf,"WriteBatch.update",t.I_,e),this.Vf=this.Vf.concat(e.p_(t.I_,Bs.exists(!0))),this},Cy.prototype.delete=function(t){this.pf();t=rv(0,t,this.T_);return this.Vf=this.Vf.concat(new au(t.I_,Bs.ze())),this},Cy.prototype.commit=function(){return this.pf(),this.yf=!0,0<this.Vf.length?ry(Oy(this.T_.Jl),this.Vf):Promise.resolve()},Cy.prototype.pf=function(){if(this.yf)throw new qr(Ur.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Cy),Ry=(n(Vy,Py=_p),Vy.Rf=function(t,e,n){if(t.length%2!=0)throw new qr(Ur.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.B()+" has "+t.length);return new Vy(e,new fd(e.Jl,n,new _i(t)))},Vy.bf=function(t,e,n){return new Vy(e,new fd(e.Jl,n,t))},Object.defineProperty(Vy.prototype,"id",{get:function(){return this.Jl.id},enumerable:!1,configurable:!0}),Object.defineProperty(Vy.prototype,"parent",{get:function(){return new Zy(this.Jl.g_.F(),this.firestore,this.Jl.A_)},enumerable:!1,configurable:!0}),Object.defineProperty(Vy.prototype,"path",{get:function(){return this.Jl.path},enumerable:!1,configurable:!0}),Vy.prototype.collection=function(t){if(Op("DocumentReference.collection","path",t),!t)throw new qr(Ur.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");t=bi.q(t);return new Zy(this.Jl.g_.child(t),this.firestore,null)},Vy.prototype.isEqual=function(t){return t instanceof _p&&(t=t.Jl),t instanceof fd&&(((e=this.Jl)instanceof fd||e instanceof pd)&&(t instanceof fd||t instanceof pd)&&e.firestore===t.firestore&&e.path===t.path&&e.A_===t.A_);var e},Vy.prototype.set=function(t,e){e=xp("DocumentReference.set",e);try{return n=this.Jl,r=t,i=e,o=Lp(n.firestore,ay),r=ov(n.A_,r,i),Ey(o,Od(md(o),"setDoc",n.I_,r,null!==n.A_,i).p_(n.I_,Bs.ze()))}catch(t){throw qy(t,"setDoc","DocumentReference.set")}var n,r,i,o},Vy.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Iy(this.Jl,t):Iy.apply(void 0,o([this.Jl,t,e],n))}catch(t){throw qy(t,"updateDoc","DocumentReference.update")}},Vy.prototype.delete=function(){return Ey(Lp((t=this.Jl).firestore,ay),[new au(t.I_,Bs.ze())]);var t},Vy.prototype.onSnapshot=function(){for(var e=this,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var n,i,o=function(){for(var t=0,e=r;t<e.length;t++){var n=e[t];if("object"==typeof n&&!sy(n))return n}return{}}(),n={next:function(t){i.next&&i.next(new jy(e.firestore,t.I_,t.m_,t.metadata.fromCache,t.metadata.hasPendingWrites,e.Jl.A_))},error:null===(n=(i=sy((n=r)[0])?n[0]:sy(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)};return function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i={includeMetadataChanges:!1},o=0;"object"!=typeof n[o]||sy(n[o])||(i=n[o],o++);var s,u,a,c,h={includeMetadataChanges:i.includeMetadataChanges};sy(n[o])&&(c=n[o],n[o]=null===(i=c.next)||void 0===i?void 0:i.bind(c),n[o+1]=null===(i=c.error)||void 0===i?void 0:i.bind(c),n[o+2]=null===(i=c.complete)||void 0===i?void 0:i.bind(c)),e instanceof fd?(u=Lp(e.firestore,ay),a=Du(e.I_.path),s={next:function(t){n[o]&&n[o](_y(u,e,t))},error:n[o+1],complete:n[o+2]}):(u=Lp(e.firestore,ay),a=e.V_,s={next:function(t){n[o]&&n[o](new gy(u,e,t))},error:n[o+1],complete:n[o+2]},Qy(e.V_));var l=Oy(u),f=new Ep(s),p=new Xa(a,f,h);return u._f.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Ja,[4,ny(l)];case 1:return[2,e.apply(void 0,[t.sent(),p])]}})})}),function(){f.Hl(),u._f.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Qa,[4,ny(l)];case 1:return[2,e.apply(void 0,[t.sent(),p])]}})})})}}(this.Jl,o,n)},Vy.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){var t=this,n=Lp(e.firestore,ay),r=Oy(n),i=new ba;return n._f.ws(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Zd(r)];case 1:return[4,iy(t.sent(),e.I_,i)];case 2:return t.sent(),[2]}})})}),i.promise.then(function(t){return new yy(n,e.I_,t,new Fy(t instanceof wu&&t.Ye,!0),e.A_)})}:"server"===(null==t?void 0:t.source)?function(e){var t=this,n=Lp(e.firestore,ay),r=Oy(n),i=new ba;return n._f.ws(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,ny(r)];case 1:return[4,oy(t.sent(),n._f,e.I_,{source:"server"},i)];case 2:return t.sent(),[2]}})})}),i.promise.then(function(t){return _y(n,e,t)})}:function(e){var t=this,n=Lp(e.firestore,ay),r=Oy(n),i=new ba;return n._f.ws(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,ny(r)];case 1:return[4,oy(t.sent(),n._f,e.I_,{source:"default"},i)];case 2:return t.sent(),[2]}})})}),i.promise.then(function(t){return _y(n,e,t)})})(this.Jl).then(function(t){return new jy(e.firestore,t.I_,t.m_,t.metadata.fromCache,t.metadata.hasPendingWrites,e.Jl.A_)})},Vy.prototype.withConverter=function(t){return new Vy(this.firestore,this.Jl.withConverter(t))},Vy);function Vy(t,e){var n=this;return(n=Py.call(this,e)||this).firestore=t,n}function Cy(t){this.T_=t,this.Vf=[],this.yf=!1,this.gf=md(this.T_.Jl)}function Uy(t,e){this.T_=t,this.Pf=e,this.gf=md(this.T_.Jl)}function qy(t,e,n){return t.message=t.message.replace(e+"()",n+"()"),t}var My,Fy=(Ky.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Ky),jy=(zy.prototype.data=function(t){var e=this;if(void 0===t&&(t={}),this.m_){if(this.A_){var n=new By(this.T_,this.I_,this.m_,this.vf,this.Sf,null);return this.A_.fromFirestore(n,t)}return new $p(this.T_.R_,t.serverTimestamps||"none",function(t){return Ry.bf(t,e.T_,null)},function(t){return new ui(t)}).h_(this.m_.rn())}},zy.prototype.get=function(t,e){var n=this;if(void 0===e&&(e={}),this.m_){t=this.m_.data().field(Ud("DocumentSnapshot.get",t,this.I_));if(null!==t)return new $p(this.T_.R_,e.serverTimestamps||"none",function(t){return Ry.bf(t,n.T_,n.A_)},function(t){return new ui(t)}).h_(t)}},Object.defineProperty(zy.prototype,"id",{get:function(){return this.I_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(zy.prototype,"ref",{get:function(){return Ry.bf(this.I_,this.T_,this.A_)},enumerable:!1,configurable:!0}),Object.defineProperty(zy.prototype,"exists",{get:function(){return null!==this.m_},enumerable:!1,configurable:!0}),Object.defineProperty(zy.prototype,"metadata",{get:function(){return new Fy(this.Sf,this.vf)},enumerable:!1,configurable:!0}),zy.prototype.isEqual=function(t){return t instanceof zy&&this.T_===t.T_&&this.vf===t.vf&&this.I_.isEqual(t.I_)&&(null===this.m_?null===t.m_:this.m_.isEqual(t.m_))&&this.A_===t.A_},zy),By=(n(Gy,My=jy),Gy.prototype.data=function(t){return My.prototype.data.call(this,t)},Gy);function Gy(){return null!==My&&My.apply(this,arguments)||this}function zy(t,e,n,r,i,o){this.T_=t,this.I_=e,this.m_=n,this.vf=r,this.Sf=i,this.A_=o}function Ky(t,e){this.hasPendingWrites=t,this.fromCache=e}function Hy(t,e,n){if(n instanceof _p&&(n=n.Jl),"string"==typeof n){if(""===n)throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ku(e)&&-1!==n.indexOf("/"))throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(bi.q(n));if(!_i.X(e))throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Fo(t,new _i(e))}if(n instanceof fd)return Fo(t,n.I_);throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+kp(n)+".")}function Wy(t,e){if(!Array.isArray(t)||0===t.length)throw new qr(Ur.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new qr(Ur.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Jy(t,e,n){if(!n.isEqual(e))throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Qy(t){if(Ou(t)&&0===t.on.length)throw new qr(Ur.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Yy,Xy=(nv.prototype.where=function(t,e,n){t=Ud("Query.where",t),e=function(t,e,n,r,i,o){if(r.W()){if("array-contains"===i||"array-contains-any"===i)throw new qr(Ur.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Wy(o,i);for(var s=[],u=0,a=o;u<a.length;u++){var c=a[u];s.push(Hy(n,t,c))}h={arrayValue:{values:s}}}else h=Hy(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Wy(o,i),h=kd(e,"Query.where",o,"in"===i||"not-in"===i);var h=zu.create(r,i,h);return function(t,e){if(e.hn()){var n=Pu(t);if(null!==n&&!n.isEqual(e.field))throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=xu(t);null!==n&&Jy(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new qr(Ur.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new qr(Ur.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(this.V_,this.gf,this.firestore.R_,t,e,n);return new nv((n=this.V_,e=n.filters.concat([e]),new Eu(n.path,n.collectionGroup,n.on.slice(),e,n.limit,n.an,n.startAt,n.endAt)),this.firestore,this.A_)},nv.prototype.orderBy=function(t,e){if(void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new qr(Ur.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var n,t=Ud("Query.orderBy",t),t=function(t,e,n){if(null!==t.startAt)throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");e=new ma(e,n);return n=e,null!==xu(t)||null!==(t=Pu(t))&&Jy(0,t,n.field),e}(this.V_,t,n);return new nv((n=this.V_,t=n.on.concat([t]),new Eu(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.an,n.startAt,n.endAt)),this.firestore,this.A_)},nv.prototype.limit=function(t){return Rp("Query.limit",t),new nv(Vu(this.V_,t,"F"),this.firestore,this.A_)},nv.prototype.limitToLast=function(t){return Rp("Query.limitToLast",t),new nv(Vu(this.V_,t,"L"),this.firestore,this.A_)},nv.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=this.Df("Query.startAt",t,e,!0);return new nv(Cu(this.V_,t),this.firestore,this.A_)},nv.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=this.Df("Query.startAfter",t,e,!1);return new nv(Cu(this.V_,t),this.firestore,this.A_)},nv.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=this.Df("Query.endBefore",t,e,!0);return new nv(Uu(this.V_,t),this.firestore,this.A_)},nv.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=this.Df("Query.endAt",t,e,!1);return new nv(Uu(this.V_,t),this.firestore,this.A_)},nv.prototype.isEqual=function(t){return t instanceof nv&&this.firestore===t.firestore&&qu(this.V_,t.V_)&&this.A_===t.A_},nv.prototype.withConverter=function(t){return new nv(this.V_,this.firestore,t)},nv.prototype.Df=function(c,t,e,n){if(t instanceof jy)return function(t,e,n,r){if(!n)throw new qr(Ur.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Lu(t);o<s.length;o++){var u=s[o];if(u.field.W())i.push(Fo(e,n.key));else{var a=n.field(u.field);if(So(a))throw new qr(Ur.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){u=u.field.B();throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}i.push(a)}}return new ha(i,r)}(this.V_,this.firestore.R_,t.m_,n);e=[t].concat(e);return function(t,e,n,r,i,o){var s=t.on;if(i.length>s.length)throw new qr(Ur.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.W()){if("string"!=typeof c)throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!ku(t)&&-1!==c.indexOf("/"))throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(bi.q(c));if(!_i.X(h))throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new _i(h);u.push(Fo(e,h))}else{c=kd(n,r,c);u.push(c)}}return new ha(u,o)}(this.V_,this.firestore.R_,this.gf,c,e,n)},nv.prototype.onSnapshot=function(){for(var t,e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i,o={},s=0;"object"!=typeof n[s]||sy(n[s])||(o=n[s],s++),sy(n[s])&&(i=n[s],n[s]=null===(t=i.next)||void 0===t?void 0:t.bind(i),n[s+1]=null===(t=i.error)||void 0===t?void 0:t.bind(i),n[s+2]=null===(t=i.complete)||void 0===t?void 0:t.bind(i));var u={next:function(t){n[s]&&n[s](new $y(e.firestore,e.V_,t,e.A_))},error:n[s+1],complete:n[s+2]};return Qy(this.V_),function(n,t,e){var r=this,i=new Ep(u),o=new Xa(t,i,e);return n.cs.ws(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Ja,[4,ny(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Hl(),n.cs.ws(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Qa,[4,ny(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(Oy(this.firestore.Jl),this.V_,o)},nv.prototype.get=function(t){var e=this;Qy(this.V_);var n=Oy(this.firestore.Jl);return(t&&"cache"===t.source?function(n,r){var t=this,i=new ba;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,ul(r,i,!0)];case 1:return n=t.sent(),e=new uf(i,n.za),n=e.wh(n.documents),n=e.Di(n,!1),o.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),n=Ka(n,"Failed to execute query '"+i+" against cache"),o.reject(n),[3,3];case 3:return[2]}})})},[4,Zd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(n,this.V_):function(n,r,i){var t=this;void 0===i&&(i={});var o=new ba;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new Ep({next:function(t){n.ws(function(){return Qa(e,s)}),t.fromCache&&"server"===r.source?i.reject(new qr(Ur.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new Xa(t,o,{includeMetadataChanges:!0,Xs:!0});return Ja(e,s)},[4,ny(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.cs,r,i,o])]}})})}),o.promise}(n,this.V_,t)).then(function(t){return new $y(e.firestore,e.V_,t,e.A_)})},nv),$y=(Object.defineProperty(ev.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(ev.prototype,"empty",{get:function(){return this.wf.docs.P()},enumerable:!1,configurable:!0}),Object.defineProperty(ev.prototype,"size",{get:function(){return this.wf.docs.size},enumerable:!1,configurable:!0}),ev.prototype.forEach=function(e,n){var r=this;this.wf.docs.forEach(function(t){e.call(n,r.Nf(t,r.metadata.fromCache,r.wf.Qt.has(t.key)))})},Object.defineProperty(ev.prototype,"query",{get:function(){return new Xy(this.Cf,this.T_,this.A_)},enumerable:!1,configurable:!0}),ev.prototype.docChanges=function(t){t=!(!t||!t.includeMetadataChanges);if(t&&this.wf.jt)throw new qr(Ur.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Tf&&this.If===t||(this.Tf=iv(this.wf,t,this.Nf.bind(this)),this.If=t),this.Tf},ev.prototype.isEqual=function(t){return t instanceof ev&&this.T_===t.T_&&qu(this.Cf,t.Cf)&&this.wf.isEqual(t.wf)&&this.A_===t.A_},ev.prototype.Nf=function(t,e,n){return new By(this.T_,t.key,t,e,n,this.A_)},ev),Zy=(n(tv,Yy=Xy),Object.defineProperty(tv.prototype,"id",{get:function(){return this.V_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(tv.prototype,"parent",{get:function(){var t=this.V_.path.F();return t.P()?null:Ry.Rf(t,this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(tv.prototype,"path",{get:function(){return this.V_.path.B()},enumerable:!1,configurable:!0}),tv.prototype.doc=function(t){0===arguments.length&&(t=Qr.t()),Op("CollectionReference.doc","path",t);t=bi.q(t);return Ry.Rf(this.V_.path.child(t),this.firestore,this.A_)},tv.prototype.add=function(t){var t=this.A_?this.A_.toFirestore(t):t,e=this.doc();return Ry.bf(e.Jl.I_,this.firestore,null).set(t).then(function(){return e})},tv.prototype.withConverter=function(t){return new tv(this.g_,this.firestore,t)},tv);function tv(t,e,n){var r=this;if(((r=Yy.call(this,Du(t),e,n)||this).g_=t).length%2!=1)throw new qr(Ur.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.B()+" has "+t.length);return r}function ev(t,e,n,r){this.T_=t,this.Cf=e,this.wf=n,this.A_=r,this.Tf=null,this.If=null,this.metadata=new Fy(n.hasPendingWrites,n.fromCache)}function nv(t,e,n){this.V_=t,this.firestore=e,this.A_=n,this.gf=md(e.Jl)}function rv(t,e,n){e=Lp(e,fd);if(e.firestore!==n.Jl)throw new qr(Ur.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function iv(i,e,o){if(i.Kt.P()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Kt;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Wr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}function ov(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var sv,uv,av,Te=(n(lv,uv=_p),lv.documentId=function(){return new lv(Ei.j().B())},lv.prototype.isEqual=function(t){return t instanceof _p&&(t=t.Jl),t instanceof ld&&this.Jl.P_.isEqual(t.P_)},lv),l=(n(hv,sv=_p),hv.serverTimestamp=function(){var t=new Kp("serverTimestamp");return t.Yl="FieldValue.serverTimestamp",new hv(t)},hv.delete=function(){var t=new Up("deleteField");return t.Yl="FieldValue.delete",new hv(t)},hv.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hp("arrayUnion",t)}.apply(void 0,t);return n.Yl="FieldValue.arrayUnion",new hv(n)},hv.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wp("arrayRemove",t)}.apply(void 0,t);return n.Yl="FieldValue.arrayRemove",new hv(n)},hv.increment=function(t){t=new Jp("increment",t);return t.Yl="FieldValue.increment",new hv(t)},hv.prototype.isEqual=function(t){return this.Jl.isEqual(t.Jl)},hv),cv={Firestore:Ny,GeoPoint:Qp,Timestamp:mi,Blob:ui,Transaction:ky,WriteBatch:Ly,DocumentReference:Ry,DocumentSnapshot:jy,Query:Xy,QueryDocumentSnapshot:By,QuerySnapshot:$y,CollectionReference:Zy,FieldPath:Te,FieldValue:l,setLogLevel:function(t){Fr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function hv(){return null!==sv&&sv.apply(this,arguments)||this}function lv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return uv.call(this,new(ld.bind.apply(ld,o([void 0],t))))||this}(av=e.default).INTERNAL.registerComponent(new Ir("firestore",function(t){return e=t.getProvider("app").getImmediate(),t=t.getProvider("auth-internal"),new Ny(e,new ay(e,t),new Ay);var e},"PUBLIC").setServiceProps(Object.assign({},cv))),av.registerVersion("@firebase/firestore","2.0.2-20201010222127")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
