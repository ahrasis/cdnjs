!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase)}(this,function(Wp){"use strict";try{(function(){var s,e,t=(e=Wp)&&"object"==typeof e&&"default"in e?e:{default:e},r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function n(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function f(e,a,s,u){return new(s=s||Promise)(function(n,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,i)}o((u=u.apply(e,a||[])).next())})}function d(n,r){var i,o,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function a(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function u(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function i(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=l[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,u(["["+i+"]  "+e.name+":"],n))}}(mt=s=s||{})[mt.DEBUG=0]="DEBUG",mt[mt.VERBOSE=1]="VERBOSE",mt[mt.INFO=2]="INFO",mt[mt.WARN=3]="WARN",mt[mt.ERROR=4]="ERROR",mt[mt.SILENT=5]="SILENT";var o={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},c=s.INFO,l=((vt={})[s.DEBUG]="log",vt[s.VERBOSE]="log",vt[s.INFO]="info",vt[s.WARN]="warn",vt[s.ERROR]="error",vt),h=(Object.defineProperty(p.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in s))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),p.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?o[e]:e},Object.defineProperty(p.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),p.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.DEBUG],e)),this._logHandler.apply(this,u([this,s.DEBUG],e))},p.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.VERBOSE],e)),this._logHandler.apply(this,u([this,s.VERBOSE],e))},p.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.INFO],e)),this._logHandler.apply(this,u([this,s.INFO],e))},p.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.WARN],e)),this._logHandler.apply(this,u([this,s.WARN],e))},p.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.ERROR],e)),this._logHandler.apply(this,u([this,s.ERROR],e))},p);function p(e){this.name=e,this._logLevel=c,this._logHandler=i,this._userLogHandler=null}function y(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var g,m="FirebaseError",v=(n(w,g=Error),w);function w(e,t,n){return(t=g.call(this,t)||this).code=e,t.customData=n,t.name=m,Object.setPrototypeOf(t,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,b.prototype.create),t}var b=(T.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},o=this.service+"/"+e,e=(e=this.errors[e])?(r=i,e.replace(E,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+o+").";return new v(o,e,i)},T);function T(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var E=/\{\$([^}]+)}/g,_=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function I(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},C=S||self;function D(){}function A(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function k(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var N="closure_uid_"+(1e9*Math.random()>>>0),R=0;function O(e,t,n){return e.call.apply(e.bind,arguments)}function L(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function P(e,t,n){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?O:L).apply(null,arguments)}function M(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function x(){return Date.now()}function F(e,o){function t(){}t.prototype=o.prototype,e.X=o.prototype,e.prototype=new t,(e.prototype.constructor=e).Kb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[t].apply(e,r)}}function V(){this.j=this.j,this.i=this.i}V.prototype.j=!1,V.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&(Object.prototype.hasOwnProperty.call(this,N)&&this[N]||(this[N]=++R))},V.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var q=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},B=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function U(){return Array.prototype.concat.apply([],arguments)}function j(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function K(e){return/^[\s\xa0]*$/.test(e)}var z=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function G(e,t){return-1!=e.indexOf(t)}function Q(e,t){return e<t?-1:t<e?1:0}var W=C.navigator;function H(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function Y(e){var t,n={};for(t in e)n[t]=e[t];return n}se=(W=W&&W.userAgent)?W:"";var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(e){for(var t,n,r=1;r<arguments.length;r++){for(t in n=arguments[r])e[t]=n[t];for(var i=0;i<X.length;i++)t=X[i],Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}}function $(e){return $[" "](e),e}$[" "]=D;var Z,ee=G(se,"Opera"),te=G(se,"Trident")||G(se,"MSIE"),ne=G(se,"Edge"),re=ne||te,ie=G(se,"Gecko")&&!(G(se.toLowerCase(),"webkit")&&!G(se,"Edge"))&&!(G(se,"Trident")||G(se,"MSIE"))&&!G(se,"Edge"),oe=G(se.toLowerCase(),"webkit")&&!G(se,"Edge");function ae(){var e=C.document;return e?e.documentMode:void 0}var W="",se=(se=se,ie?/rv:([^\);]+)(\)|;)/.exec(se):ne?/Edge\/([\d\.]+)/.exec(se):te?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(se):oe?/WebKit\/(\S+)/.exec(se):ee?/(?:Version)[ \/]?(\S+)/.exec(se):void 0);se&&(W=se?se[1]:""),Z=te&&null!=(se=ae())&&se>parseFloat(W)?String(se):W;var ue={};function ce(s){return e=s,t=function(){for(var e=0,t=z(String(Z)).split("."),n=z(String(s)).split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++)for(var o=t[i]||"",a=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],(0!=o[0].length||0!=a[0].length)&&(e=Q(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Q(0==o[2].length,0==a[2].length)||Q(o[2],a[2]),o=o[3],a=a[3],0==e););return 0<=e},n=ue,Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t();var e,t,n}var le=C.document&&te&&(ae()||parseInt(Z,10))||void 0,he=!te||9<=Number(le),fe=te&&!ce("9"),de=function(){if(!C.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{C.addEventListener("test",D,t),C.removeEventListener("test",D,t)}catch(e){}return e}();function pe(e,t){this.type=e,this.a=this.target=t,this.defaultPrevented=!1}function ye(e,t){if(pe.call(this,e?e.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.a=t,t=e.relatedTarget){if(ie){e:{try{$(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:ge[e.pointerType]||"",(this.c=e).defaultPrevented&&this.b()}}pe.prototype.b=function(){this.defaultPrevented=!0},F(ye,pe);var ge={2:"touch",3:"pen",4:"mouse"};ye.prototype.b=function(){ye.X.b.call(this);var e=this.c;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,fe)try{(e.ctrlKey||112<=e.keyCode&&e.keyCode<=123)&&(e.keyCode=-1)}catch(e){}};var me="closure_listenable_"+(1e6*Math.random()|0),ve=0;function we(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ca=i,this.key=++ve,this.Y=this.Z=!1}function be(e){e.Y=!0,e.listener=null,e.proxy=null,e.src=null,e.ca=null}function Te(e){this.src=e,this.a={},this.b=0}function Ee(e,t){var n,r,i,o=t.type;o in e.a&&(n=e.a[o],(i=0<=(r=q(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(be(t),0==e.a[o].length&&(delete e.a[o],e.b--)))}function _e(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.Y&&o.listener==t&&o.capture==!!n&&o.ca==r)return i}return-1}Te.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.a[o])||(e=this.a[o]=[],this.b++);var a=_e(e,t,r,i);return-1<a?(t=e[a],n||(t.Z=!1)):((t=new we(t,this.src,o,!!r,i)).Z=n,e.push(t)),t};var Ie="closure_lm_"+(1e6*Math.random()|0),Se={};function Ce(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,o){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,o);return null}return r=Pe(r),t&&t[me]?t.wa(n,r,k(i)?!!i.capture:!!i,o):De(t,n,r,!0,i,o)}(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)Ce(e,t[o],n,r,i);return null}return n=Pe(n),e&&e[me]?e.va(t,n,k(r)?!!r.capture:!!r,i):De(e,t,n,!1,r,i)}function De(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=k(i)?!!i.capture:!!i;if(a&&!he)return null;var s,u,c=Oe(e);if(c||(e[Ie]=c=new Te(e)),(n=c.add(t,n,r,a,o)).proxy)return n;if(s=Re,r=u=he?function(e){return s.call(u.src,u.listener,e)}:function(e){if(!(e=s.call(u.src,u.listener,e)))return e},(n.proxy=r).src=e,r.listener=n,e.addEventListener)de||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ke(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ae(e){var t,n,r;"number"!=typeof e&&e&&!e.Y&&((t=e.src)&&t[me]?Ee(t.c,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ke(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Oe(t))?(Ee(n,e),0==n.b&&(n.src=null,t[Ie]=null)):be(e)))}function ke(e){return e in Se?Se[e]:Se[e]="on"+e}function Ne(e,t){var n=e.listener,r=e.ca||e.src;return e.Z&&Ae(e),n.call(r,t)}function Re(e,t){if(e.Y)return!0;if(he)return Ne(e,new ye(t,this));if(!t)e:{t=["window","event"];for(var n=C,r=0;r<t.length;r++)if(null==(n=n[t[r]])){t=null;break e}t=n}return Ne(e,t=new ye(t,this))}function Oe(e){return(e=e[Ie])instanceof Te?e:null}var Le="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pe(t){return"function"==typeof t?t:(t[Le]||(t[Le]=function(e){return t.handleEvent(e)}),t[Le])}function Me(){V.call(this),this.c=new Te(this),(this.J=this).C=null}function xe(e,t){var n,r=e.C;if(r)for(n=[];r;r=r.C)n.push(r);if(e=e.J,r=t.type||t,"string"==typeof t?t=new pe(t,e):t instanceof pe?t.target=t.target||e:(a=t,J(t=new pe(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var o=t.a=n[i],a=Fe(o,r,!0,t)&&a;if(a=Fe(o=t.a=e,r,!0,t)&&a,a=Fe(o,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=Fe(o=t.a=n[i],r,!1,t)&&a}function Fe(e,t,n,r){if(!(t=e.c.a[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var a,s,u=t[o];u&&!u.Y&&u.capture==n&&(a=u.listener,s=u.ca||u.src,u.Z&&Ee(e.c,u),i=!1!==a.call(s,r)&&i)}return i&&!r.defaultPrevented}F(Me,V),Me.prototype[me]=!0,(se=Me.prototype).addEventListener=function(e,t,n,r){Ce(this,e,t,n,r)},se.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,o){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,o);else i=k(i)?!!i.capture:!!i,r=Pe(r),t&&t[me]?(t=t.c,(n=String(n).toString())in t.a&&-1<(r=_e(a=t.a[n],r,i,o))&&(be(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.a[n],t.b--))):(t=t&&Oe(t))&&(n=t.a[n.toString()],t=-1,n&&(t=_e(n,r,i,o)),(r=-1<t?n[t]:null)&&Ae(r))}(this,e,t,n,r)},se.G=function(){if(Me.X.G.call(this),this.c){var e,t=this.c;for(e in t.a){for(var n=t.a[e],r=0;r<n.length;r++)be(n[r]);delete t.a[e],t.b--}}this.C=null},se.va=function(e,t,n,r){return this.c.add(String(e),t,!1,n,r)},se.wa=function(e,t,n,r){return this.c.add(String(e),t,!0,n,r)};var Ve=C.JSON.stringify;function qe(){this.b=this.a=null}var Be,Ue=(je.prototype.get=function(){var e;return 0<this.b?(this.b--,e=this.a,this.a=e.next,e.next=null):e=this.c(),e},new je(function(){return new Ke},function(e){e.reset()}));function je(e,t){this.c=e,this.f=t,this.b=0,this.a=null}function Ke(){this.next=this.b=this.a=null}function ze(e,t){var n;Be||(n=C.Promise.resolve(void 0),Be=function(){n.then(We)}),Ge||(Be(),Ge=!0),Qe.add(e,t)}qe.prototype.add=function(e,t){var n=Ue.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n},Ke.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null};var Ge=!(Ke.prototype.reset=function(){this.next=this.b=this.a=null}),Qe=new qe;function We(){for(var e,t;n=t=void 0,n=null,(t=Qe).a&&(n=t.a,t.a=t.a.next,t.a||(t.b=null),n.next=null),e=n;){try{e.a.call(e.b)}catch(e){!function(e){C.setTimeout(function(){throw e},0)}(e)}var n=Ue;n.f(e),n.b<100&&(n.b++,e.next=n.a,n.a=e)}Ge=!1}function He(e,t){Me.call(this),this.b=e||1,this.a=t||C,this.f=P(this.Za,this),this.g=x()}function Ye(e){e.aa=!1,e.M&&(e.a.clearTimeout(e.M),e.M=null)}function Xe(e,t,n){if("function"==typeof e)n&&(e=P(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=P(e.handleEvent,e)}return 2147483647<Number(t)?-1:C.setTimeout(e,t||0)}F(He,Me),(se=He.prototype).aa=!1,se.M=null,se.Za=function(){var e;this.aa&&(0<(e=x()-this.g)&&e<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-e):(this.M&&(this.a.clearTimeout(this.M),this.M=null),xe(this,"tick"),this.aa&&(Ye(this),this.start())))},se.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=x())},se.G=function(){He.X.G.call(this),Ye(this),delete this.a};var Je,$e,Ze=(_($e=tt,W=Je=V),$e.prototype=null===W?Object.create(W):(et.prototype=W.prototype,new et),tt.prototype.f=function(e){this.b=arguments,this.a?this.c=!0:function e(t){t.a=Xe(function(){t.a=null,t.c&&(t.c=!1,e(t))},t.h);var n=t.b;t.b=null,t.g.apply(null,n)}(this)},tt.prototype.G=function(){Je.prototype.G.call(this),this.a&&(C.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},tt);function et(){this.constructor=$e}function tt(e,t){var n=Je.call(this)||this;return n.g=e,n.h=t,n.b=null,n.c=!1,n.a=null,n}function nt(e){V.call(this),this.b=e,this.a={}}F(nt,V);var rt=[];function it(e,t,n,r){Array.isArray(n)||(n&&(rt[0]=n.toString()),n=rt);for(var i=0;i<n.length;i++){var o=Ce(t,n[i],r||e.handleEvent,!1,e.b||e);if(!o)break;e.a[o.key]=o}}function ot(e){H(e.a,function(e,t){this.a.hasOwnProperty(t)&&Ae(e)},e),e.a={}}function at(){this.a=!0}function st(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.a)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)&&"noop"!=(r=i[0])&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}return Ve(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}nt.prototype.G=function(){nt.X.G.call(this),ot(this)},nt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},at.prototype.info=function(){};var ut={},ct=null;function lt(){return ct=ct||new Me}function ht(e){pe.call(this,ut.Fa,e)}function ft(){var e=lt();xe(e,new ht(e))}function dt(e,t){pe.call(this,ut.STAT_EVENT,e),this.stat=t}function pt(e){var t=lt();xe(t,new dt(t,e))}function yt(e){pe.call(this,ut.Ga,e)}function gt(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){e()},t)}ut.Fa="serverreachability",F(ht,pe),ut.STAT_EVENT="statevent",F(dt,pe),ut.Ga="timingevent",F(yt,pe);var mt={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},vt={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function wt(){}function bt(e){var t;return(t=e.a)||(t=e.a={}),t}function Tt(){}wt.prototype.a=null;var Et,S={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function _t(){pe.call(this,"d")}function It(){pe.call(this,"c")}function St(){}function Ct(e,t,n,r){this.g=e,this.c=t,this.f=n,this.S=r||1,this.J=new nt(this),this.P=Dt,e=re?125:void 0,this.R=new He(e),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}F(_t,pe),F(It,pe),F(St,wt),Et=new St;var Dt=45e3,At={},kt={};function Nt(e,t,n){e.H=1,e.i=Jt(Gt(t)),e.j=n,e.I=!0,Rt(e,null)}function Rt(e,t){e.u=x(),Lt(e),e.l=Gt(e.i);var a,s,u,c,l,h,n=e.l,r=e.S;Array.isArray(r)||(r=[String(r)]),hn(n.b,"t",r),e.D=0,e.a=ir(e.g,e.g.C?t:null),0<e.O&&(e.F=new Ze(P(e.Ca,e,e.a),e.O)),it(e.J,e.a,"readystatechange",e.Xa),t=e.B?Y(e.B):{},e.j?(e.m||(e.m="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.a.ba(e.l,e.m,e.j,t)):(e.m="GET",e.a.ba(e.l,e.m,null,t)),ft(),a=e.c,s=e.m,u=e.l,c=e.f,l=e.S,h=e.j,a.info(function(){if(a.a)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,o=t[n].split("=");1<o.length&&(r=o[0],o=o[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+o+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+c+") [attempt "+l+"]: "+s+"\n"+u+"\n"+e})}function Ot(e,t,n){for(var r,i,o,a=!0;!e.A&&e.D<n.length;){var s=(s=n,o=void 0,i=(r=e).D,-1==(o=s.indexOf("\n",i))?kt:(i=Number(s.substring(i,o)),isNaN(i)?At:(o+=1)+i>s.length?kt:(s=s.substr(o,i),r.D=o+i,s)));if(s==kt){4==t&&(e.h=4,pt(14),a=!1),st(e.c,e.f,null,"[Incomplete Response]");break}if(s==At){e.h=4,pt(15),st(e.c,e.f,n,"[Invalid Chunk]"),a=!1;break}st(e.c,e.f,s,null),Vt(e,s)}4==t&&0==n.length&&(e.h=1,pt(16),a=!1),e.b=e.b&&a,a?0<n.length&&!e.V&&(e.V=!0,(t=e.g).a==e&&t.U&&!t.F&&(t.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xn(t),t.F=!0,pt(11))):(st(e.c,e.f,n,"[Invalid Chunked Response]"),Ft(e),xt(e))}function Lt(e){e.T=x()+e.P,Pt(e,e.P)}function Pt(e,t){if(null!=e.o)throw Error("WatchDog timer not null");e.o=gt(P(e.Va,e),t)}function Mt(e){e.o&&(C.clearTimeout(e.o),e.o=null)}function xt(e){0==e.g.v||e.A||Zn(e.g,e)}function Ft(e){Mt(e);var t=e.F;t&&"function"==typeof t.ja&&t.ja(),e.F=null,Ye(e.R),ot(e.J),e.a&&(t=e.a,e.a=null,t.abort(),t.ja())}function Vt(e,t){try{var n,r,i,o,a,s=e.g;if(0!=s.v&&(s.a==e||vn(s.b,e)))if(s.I=e.N,!e.C&&vn(s.b,e)&&3==s.v){try{var u=s.ka.a.parse(t)}catch(e){u=null}if(Array.isArray(u)&&3==u.length){var c=u;if(0==c[0]){e:if(!s.j){if(s.a){if(!(s.a.u+3e3<e.u))break e;$n(s),Un(s)}Yn(s),pt(18)}}else s.oa=c[1],0<s.oa-s.P&&c[2]<37500&&s.H&&0==s.o&&!s.m&&(s.m=gt(P(s.Sa,s),6e3));if(mn(s.b)<=1&&s.ea){try{s.ea()}catch(e){}s.ea=void 0}}else tr(s,11)}else if(!e.C&&s.a!=e||$n(s),!K(t))for(t=u=s.ka.a.parse(t),u=0;u<t.length;u++)c=t[u],s.P=c[0],c=c[1],2==s.v?"c"==c[0]?(s.J=c[1],s.ga=c[2],null!=(r=c[3])&&(s.ha=r,s.c.info("VER="+s.ha)),null!=(o=c[4])&&(s.pa=o,s.c.info("SVER="+s.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,s.D=n,s.c.info("backChannelRequestTimeoutMs_="+n)),n=s,(o=e.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(G(r,"spdy")||G(r,"quic")||G(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(wn(i,i.b),i.b=null)),!n.A||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=a,Xt(n.B,n.A,a))),s.v=3,s.f&&s.f.ta(),s.U&&(s.N=x()-e.u,s.c.info("Handshake RTT: "+s.N+"ms")),i=e,(n=s).la=rr(n,n.C?n.ga:null,n.fa),i.C?(bn(n.b,i),o=i,(a=n.D)&&o.setTimeout(a),o.o&&(Mt(o),Lt(o)),n.a=i):Hn(n),0<s.g.length&&zn(s)):"stop"!=c[0]&&"close"!=c[0]||tr(s,7):3==s.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?tr(s,7):Bn(s):"noop"!=c[0]&&s.f&&s.f.sa(c),s.o=0);ft()}catch(e){}}function qt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(A(e)||"string"==typeof e)B(e,t,void 0);else{if(e.L&&"function"==typeof e.L)var n=e.L();else if(e.K&&"function"==typeof e.K)n=void 0;else if(A(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.K&&"function"==typeof e.K)return e.K();if("string"==typeof e)return e.split("");if(A(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Bt(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Bt)for(n=e.L(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Ut(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];jt(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){for(var i={},n=t=0;t<e.a.length;)jt(i,r=e.a[t])||(i[e.a[n++]=r]=1),t++;e.a.length=n}}function jt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(se=Ct.prototype).setTimeout=function(e){this.P=e},se.Xa=function(e){e=e.target;var t=this.F;t&&3==xn(e)?t.f():this.Ca(e)},se.Ca=function(e){try{if(e==this.a)e:{var t=xn(this.a),n=this.a.ua(),r=this.a.W();if(!(t<3||3==t&&!re&&!this.a.$())){this.A||4!=t||7==n||ft(),Mt(this);var i=this.a.W();if(this.N=i,n=this.a.$(),this.b=200==i,r=this.c,s=this.m,u=this.l,c=this.f,l=this.S,h=t,f=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+l+"]: "+s+"\n"+u+"\n"+h+" "+f}),this.b){if(this.U&&!this.C){t:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(o)){var a=o;break t}}a=null}if(!a){this.b=!1,this.h=3,pt(12),Ft(this),xt(this);break e}st(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Vt(this,a)}this.I?(Ot(this,t,n),re&&this.b&&3==t&&(it(this.J,this.R,"tick",this.Wa),this.R.start())):(st(this.c,this.f,n,null),Vt(this,n)),4==t&&Ft(this),this.b&&!this.A&&(4==t?Zn(this.g,this):(this.b=!1,Lt(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,pt(12)):(this.h=0,pt(13)),Ft(this),xt(this)}}}catch(e){}var s,u,c,l,h,f},se.Wa=function(){var e,t;this.a&&(e=xn(this.a),t=this.a.$(),this.D<t.length&&(Mt(this),Ot(this,e,t),this.b&&4!=e&&Lt(this)))},se.cancel=function(){this.A=!0,Ft(this)},se.Va=function(){this.o=null;var e,t,n=x();0<=n-this.T?(e=this.c,t=this.l,e.info(function(){return"TIMEOUT: "+t}),2!=this.H&&(ft(),pt(17)),Ft(this),this.h=2,xt(this)):Pt(this,this.T-n)},(se=Bt.prototype).K=function(){Ut(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e},se.L=function(){return Ut(this),this.a.concat()},se.get=function(e,t){return jt(this.b,e)?this.b[e]:t},se.set=function(e,t){jt(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t},se.forEach=function(e,t){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};var Kt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function zt(e,t){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,e instanceof zt?(this.a=void 0!==t?t:e.a,Qt(this,e.f),this.j=e.j,Wt(this,e.c),Ht(this,e.h),this.g=e.g,t=e.b,(n=new sn).c=t.c,t.a&&(n.a=new Bt(t.a),n.b=t.b),Yt(this,n),this.i=e.i):e&&(n=String(e).match(Kt))?(this.a=!!t,Qt(this,n[1]||"",!0),this.j=$t(n[2]||""),Wt(this,n[3]||"",!0),Ht(this,n[4]),this.g=$t(n[5]||"",!0),Yt(this,n[6]||"",!0),this.i=$t(n[7]||"")):(this.a=!!t,this.b=new sn(null,this.a))}function Gt(e){return new zt(e)}function Qt(e,t,n){e.f=n?$t(t,!0):t,e.f&&(e.f=e.f.replace(/:$/,""))}function Wt(e,t,n){e.c=n?$t(t,!0):t}function Ht(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.h=t}else e.h=null}function Yt(e,t,n){var r,i;t instanceof sn?(e.b=t,r=e.b,(i=e.a)&&!r.f&&(un(r),r.c=null,r.a.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(cn(this,t),hn(this,n,e))},r)),r.f=i):(n||(t=Zt(t,on)),e.b=new sn(t,e.a))}function Xt(e,t,n){e.b.set(t,n)}function Jt(e){return Xt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^x()).toString(36)),e}function $t(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Zt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,en),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function en(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}zt.prototype.toString=function(){var e=[],t=this.f;t&&e.push(Zt(t,tn,!0),":");var n=this.c;return!n&&"file"!=t||(e.push("//"),(t=this.j)&&e.push(Zt(t,tn,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&e.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&e.push("/"),e.push(Zt(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.b.toString())&&e.push("?",n),(n=this.i)&&e.push("#",Zt(n,an)),e.join("")};var tn=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,an=/#/g;function sn(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function un(o){o.a||(o.a=new Bt,o.b=0,o.c&&function(e){if(e){e=e.split("&");for(var t=0;t<e.length;t++){var n,r=e[t].indexOf("="),i=null;0<=r?(n=e[t].substring(0,r),i=e[t].substring(r+1)):n=e[t],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",o.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(o.c))}function cn(e,t){un(e),t=fn(e,t),jt(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,jt((e=e.a).b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Ut(e)))}function ln(e,t){return un(e),t=fn(e,t),jt(e.a.b,t)}function hn(e,t,n){cn(e,t),0<n.length&&(e.c=null,e.a.set(fn(e,t),j(n)),e.b+=n.length)}function fn(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}(se=sn.prototype).add=function(e,t){un(this),this.c=null,e=fn(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this},se.forEach=function(n,r){un(this),this.a.forEach(function(e,t){B(e,function(e){n.call(r,e,t,this)},this)},this)},se.L=function(){un(this);for(var e=this.a.K(),t=this.a.L(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n},se.K=function(e){un(this);var t=[];if("string"==typeof e)ln(this,e)&&(t=U(t,this.a.get(fn(this,e))));else{e=this.a.K();for(var n=0;n<e.length;n++)t=U(t,e[n])}return t},se.set=function(e,t){return un(this),this.c=null,ln(this,e=fn(this,e))&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this},se.get=function(e,t){return e&&0<(e=this.K(e)).length?String(e[0]):t},se.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.L(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),e.push(a)}return this.c=e.join("&")};function dn(e,t){this.b=e,this.a=t}function pn(e){this.g=e||yn,e=C.PerformanceNavigationTiming?0<(e=C.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(C.ia&&C.ia.ya&&C.ia.ya()&&C.ia.ya().Lb),this.f=e?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var yn=10;function gn(e){return e.b||e.a&&e.a.size>=e.f}function mn(e){return e.b?1:e.a?e.a.size:0}function vn(e,t){return e.b?e.b==t:e.a&&e.a.has(t)}function wn(e,t){e.a?e.a.add(t):e.b=t}function bn(e,t){e.b&&e.b==t?e.b=null:e.a&&e.a.has(t)&&e.a.delete(t)}function Tn(e){var t,n;if(null!=e.b)return e.c.concat(e.b.s);if(null==e.a||0===e.a.size)return j(e.c);var r=e.c;try{for(var i=I(e.a.values()),o=i.next();!o.done;o=i.next())var a=o.value,r=r.concat(a.s)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function En(){}function _n(){this.a=new En}function In(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}pn.prototype.cancel=function(){var e,t;if(this.c=Tn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},En.prototype.stringify=function(e){return C.JSON.stringify(e,void 0)},En.prototype.parse=function(e){return C.JSON.parse(e,void 0)};var Sn=C.JSON.parse;function Cn(e){Me.call(this),this.headers=new Bt,this.H=e||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Dn,this.D=this.F=!1}F(Cn,Me);var Dn="",An=/^https?$/i,kn=["POST","PUT"];function Nn(e){return"content-type"==e.toLowerCase()}function Rn(e,t){e.b=!1,e.a&&(e.g=!0,e.a.abort(),e.g=!1),e.f=t,e.h=5,On(e),Pn(e)}function On(e){e.u||(e.u=!0,xe(e,"complete"),xe(e,"error"))}function Ln(e){if(e.b&&(!e.s[1]||4!=xn(e)||2!=e.W()))if(e.l&&4==xn(e))Xe(e.za,0,e);else if(xe(e,"readystatechange"),4==xn(e)){e.b=!1;try{var t,n,r,i,o=e.W();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===o)&&(!(i=String(e.B).match(Kt)[1]||null)&&C.self&&C.self.location&&(i=(r=C.self.location.protocol).substr(0,r.length-1)),n=!An.test(i?i.toLowerCase():"")),t=n),t)xe(e,"complete"),xe(e,"success");else{e.h=6;try{var s=2<xn(e)?e.a.statusText:""}catch(o){s=""}e.f=s+" ["+e.W()+"]",On(e)}}finally{Pn(e)}}}function Pn(e,t){if(e.a){Mn(e);var n=e.a,r=e.s[0]?D:null;e.a=null,e.s=null,t||xe(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Mn(e){e.a&&e.D&&(e.a.ontimeout=null),e.m&&(C.clearTimeout(e.m),e.m=null)}function xn(e){return e.a?e.a.readyState:0}function Fn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}var i;r||(i="",H(n,function(e,t){i+=t,i+=":",i+=e,i+="\r\n"}),n=i,"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Xt(e,t,n))}function Vn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function qn(e){this.pa=0,this.g=[],this.c=new at,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Vn("failFast",!1,e),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Vn("baseRetryDelayMs",5e3,e),this.Ra=Vn("retryDelaySeedMs",1e4,e),this.Ma=Vn("forwardChannelMaxRetries",2,e),this.ma=Vn("forwardChannelRequestTimeoutMs",2e4,e),this.Na=e&&e.g||void 0,this.D=void 0,this.C=e&&e.supportsCrossDomainXhr||!1,this.J="",this.b=new pn(e&&e.concurrentRequestLimit),this.ka=new _n,this.da=e&&e.fastHandshake||!1,this.Ia=e&&e.b||!1,e&&e.f&&(this.c.a=!1),e&&e.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&e&&e.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=e&&e.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Bn(e){var t,n;jn(e),3==e.v&&(t=e.R++,Xt(n=Gt(e.B),"SID",e.J),Xt(n,"RID",t),Xt(n,"TYPE","terminate"),Qn(e,n),(t=new Ct(e,e.c,t,void 0)).H=2,t.i=Jt(Gt(n)),n=!1,C.navigator&&C.navigator.sendBeacon&&(n=C.navigator.sendBeacon(t.i.toString(),"")),!n&&C.Image&&((new Image).src=t.i,n=!0),n||(t.a=ir(t.g,null),t.a.ba(t.i)),t.u=x(),Lt(t)),nr(e)}function Un(e){e.a&&(Xn(e),e.a.cancel(),e.a=null)}function jn(e){Un(e),e.j&&(C.clearTimeout(e.j),e.j=null),$n(e),e.b.cancel(),e.h&&("number"==typeof e.h&&C.clearTimeout(e.h),e.h=null)}function Kn(e,t){e.g.push(new dn(e.Oa++,t)),3==e.v&&zn(e)}function zn(e){gn(e.b)||e.h||(e.h=!0,ze(e.Ba,e),e.u=0)}function Gn(e,t){var n=t?t.f:e.R++,r=Gt(e.B);Xt(r,"SID",e.J),Xt(r,"RID",n),Xt(r,"AID",e.P),Qn(e,r),e.i&&e.l&&Fn(r,e.i,e.l),n=new Ct(e,e.c,n,e.u+1),null===e.i&&(n.B=e.l),t&&(e.g=t.s.concat(e.g)),t=Wn(e,n,1e3),n.setTimeout(Math.round(.5*e.ma)+Math.round(.5*e.ma*Math.random())),wn(e.b,n),Nt(n,r,t)}function Qn(e,n){e.f&&qt({},function(e,t){Xt(n,t,e)})}function Wn(e,t,n){n=Math.min(e.g.length,n);var r=e.f?P(e.f.Ja,e.f,e):null;e:for(var i=e.g,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,l=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{!function(e,r){var i="req"+c+"_"||"";try{qt(e,function(e,t){var n=e;k(e)&&(n=Ve(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(l,a)}catch(e){r&&r(l)}}if(s){r=a.join("&");break e}}return e=e.g.splice(0,n),t.s=e,r}function Hn(e){e.a||e.j||(e.T=1,ze(e.Aa,e),e.o=0)}function Yn(e){return!(e.a||e.j||3<=e.o)&&(e.T++,e.j=gt(P(e.Aa,e),er(e,e.o)),e.o++,1)}function Xn(e){null!=e.s&&(C.clearTimeout(e.s),e.s=null)}function Jn(e){e.a=new Ct(e,e.c,"rpc",e.T),null===e.i&&(e.a.B=e.l),e.a.O=0;var t=Gt(e.la);Xt(t,"RID","rpc"),Xt(t,"SID",e.J),Xt(t,"CI",e.H?"0":"1"),Xt(t,"AID",e.P),Qn(e,t),Xt(t,"TYPE","xmlhttp"),e.i&&e.l&&Fn(t,e.i,e.l),e.D&&e.a.setTimeout(e.D);var n=e.a;e=e.ga,n.H=1,n.i=Jt(Gt(t)),n.j=null,n.I=!0,Rt(n,e)}function $n(e){null!=e.m&&(C.clearTimeout(e.m),e.m=null)}function Zn(e,t){var n,r,i,o=null;if(e.a==t){$n(e),Xn(e),e.a=null;var a=2}else{if(!vn(e.b,t))return;o=t.s,bn(e.b,t),a=1}if(e.I=t.N,0!=e.v)if(t.b)1==a?(o=t.j?t.j.length:0,t=x()-t.u,n=e.u,xe(a=lt(),new yt(a)),zn(e)):Hn(e);else if(3==(n=t.h)||0==n&&0<e.I||(1!=a||(i=t,mn((r=e).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.La?0:r.Ma)||(r.h=gt(P(r.Ba,r,i),er(r,r.u)),r.u++,0))))&&(2!=a||!Yn(e)))switch(o&&0<o.length&&(t=e.b,t.c=t.c.concat(o)),n){case 1:tr(e,5);break;case 4:tr(e,10);break;case 3:tr(e,6);break;default:tr(e,2)}}function er(e,t){var n=e.Ha+Math.floor(Math.random()*e.Ra);return e.f||(n*=2),n*t}function tr(e,t){var n,r,i,o;e.c.info("Error code "+t),2==t?(r=null,e.f&&(r=null),o=P(e.Ya,e),r||(r=new zt("//www.google.com/images/cleardot.gif"),C.location&&"http"==C.location.protocol||Qt(r,"https"),Jt(r)),n=r.toString(),r=o,o=new at,C.Image?((i=new Image).onload=M(In,o,i,"TestLoadImage: loaded",!0,r),i.onerror=M(In,o,i,"TestLoadImage: error",!1,r),i.onabort=M(In,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=M(In,o,i,"TestLoadImage: timeout",!1,r),C.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):pt(2),e.v=0,e.f&&e.f.ra(t),nr(e),jn(e)}function nr(e){e.v=0,e.I=-1,e.f&&(0==Tn(e.b).length&&0==e.g.length||(e.b.c.length=0,j(e.g),e.g.length=0),e.f.qa())}function rr(e,t,n){var r,i,o,a,s,u=(a=n)instanceof zt?Gt(a):new zt(a,void 0);return""!=u.c?(t&&Wt(u,t+"."+u.c),Ht(u,u.h)):(r=(s=C.location).protocol,i=t?t+"."+s.hostname:s.hostname,o=+s.port,a=n,s=new zt(null,void 0),r&&Qt(s,r),i&&Wt(s,i),o&&Ht(s,o),a&&(s.g=a),u=s),e.V&&H(e.V,function(e,t){Xt(u,t,e)}),t=e.A,n=e.na,t&&n&&Xt(u,t,n),Xt(u,"VER",e.ha),Qn(e,u),u}function ir(e,t){if(t&&!e.C)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Cn(e.Na)).F=e.C,t}function or(){}function ar(){if(te&&!(10<=Number(le)))throw Error("Environmental error: no available transport.")}function sr(e,t){Me.call(this),this.a=new qn(t),this.o=e,this.b=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.a.l=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.a&&(e?e["X-WebChannel-Client-Profile"]=t.a:e={"X-WebChannel-Client-Profile":t.a}),this.a.O=e,(e=t&&t.httpHeadersOverwriteParam)&&!K(e)&&(this.a.i=e),this.m=t&&t.supportsCrossDomainXhr||!1,this.l=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!K(t)&&(this.a.A=t,null!==(e=this.b)&&t in e&&t in(e=this.b)&&delete e[t]),this.f=new lr(this)}function ur(e){_t.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.c=e)?(e=this.c,this.data=null!==t&&e in t?t[e]:void 0):this.data=t}else this.data=e}function cr(){It.call(this),this.status=1}function lr(e){this.a=e}(se=Cn.prototype).ba=function(e,t,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+e);t=t?t.toUpperCase():"GET",this.B=e,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?bt(this.H):bt(Et),this.a.onreadystatechange=P(this.za,this);try{this.A=!0,this.a.open(t,String(e),!0),this.A=!1}catch(e){return void Rn(this,e)}e=n||"";var i,o=new Bt(this.headers);r&&qt(r,function(e,t){o.set(t,e)}),r=function(e){e:{for(var t=Nn,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return t<0?null:"string"==typeof e?e.charAt(t):e[t]}(o.L()),n=C.FormData&&e instanceof C.FormData,0<=q(kn,t)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(e,t){this.a.setRequestHeader(t,e)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Mn(this),0<this.o&&((this.D=(i=this.a,te&&ce(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=P(this.xa,this)):this.m=Xe(this.xa,this.o,this)),this.l=!0,this.a.send(e),this.l=!1}catch(e){Rn(this,e)}},se.xa=function(){this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,xe(this,"timeout"),this.abort(8))},se.abort=function(e){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=e||7,xe(this,"complete"),xe(this,"abort"),Pn(this))},se.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Pn(this,!0)),Cn.X.G.call(this)},se.za=function(){this.j||(this.A||this.l||this.g?Ln(this):this.Ua())},se.Ua=function(){Ln(this)},se.W=function(){try{return 2<xn(this)?this.a.status:-1}catch(e){return-1}},se.$=function(){try{return this.a?this.a.responseText:""}catch(e){return""}},se.Pa=function(e){if(this.a){var t=this.a.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Sn(t)}},se.ua=function(){return this.h},se.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(se=qn.prototype).ha=8,se.v=1,se.Ba=function(e){if(this.h)if(this.h=null,1==this.v){if(!e){this.R=Math.floor(1e5*Math.random()),e=this.R++;var t,n=new Ct(this,this.c,e,void 0),r=this.l;if(this.O&&(r?J(r=Y(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)e:{for(var i=t=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(t+=o)){t=i;break e}if(4096===t||i===this.g.length-1){t=i+1;break e}}t=1e3}else t=1e3;t=Wn(this,n,t),Xt(i=Gt(this.B),"RID",e),Xt(i,"CVER",22),this.A&&Xt(i,"X-HTTP-Session-Id",this.A),Qn(this,i),this.i&&r&&Fn(i,this.i,r),wn(this.b,n),this.Ia&&Xt(i,"TYPE","init"),this.da?(Xt(i,"$req",t),Xt(i,"SID","null"),n.U=!0,Nt(n,i,null)):Nt(n,i,t),this.v=2}}else 3==this.v&&(e?Gn(this,e):0==this.g.length||gn(this.b)||Gn(this))},se.Aa=function(){var e;this.j=null,Jn(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(e=2*this.N,this.c.info("BP detection timer enabled: "+e),this.s=gt(P(this.Ta,this),e))},se.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,pt(10),Un(this),Jn(this))},se.Sa=function(){null!=this.m&&(this.m=null,Un(this),Yn(this),pt(19))},se.Ya=function(e){e?(this.c.info("Successfully pinged google.com"),pt(2)):(this.c.info("Failed to ping google.com"),pt(1))},(se=or.prototype).ta=function(){},se.sa=function(){},se.ra=function(){},se.qa=function(){},se.Ja=function(){},ar.prototype.a=function(e,t){return new sr(e,t)},F(sr,Me),sr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var e=this.a,t=this.o,n=this.b||void 0;pt(0),e.fa=t,e.V=n||{},e.H=e.S,e.B=rr(e,null,e.fa),zn(e)},sr.prototype.close=function(){Bn(this.a)},sr.prototype.h=function(e){var t;"string"==typeof e?((t={}).__data__=e,Kn(this.a,t)):this.l?((t={}).__data__=Ve(e),Kn(this.a,t)):Kn(this.a,e)},sr.prototype.G=function(){this.a.f=null,delete this.f,Bn(this.a),delete this.a,sr.X.G.call(this)},F(ur,_t),F(cr,It),F(lr,or),lr.prototype.ta=function(){xe(this.a,"a")},lr.prototype.sa=function(e){xe(this.a,new ur(e))},lr.prototype.ra=function(e){xe(this.a,new cr)},lr.prototype.qa=function(){xe(this.a,"b")},ar.prototype.createWebChannel=ar.prototype.a,sr.prototype.send=sr.prototype.h,sr.prototype.open=sr.prototype.g,mt.NO_ERROR=0,mt.TIMEOUT=8,mt.HTTP_ERROR=6,vt.COMPLETE="complete",(Tt.EventType=S).OPEN="a",S.CLOSE="b",S.ERROR="c",S.MESSAGE="d",Me.prototype.listen=Me.prototype.va,Cn.prototype.listenOnce=Cn.prototype.wa,Cn.prototype.getLastError=Cn.prototype.Qa,Cn.prototype.getLastErrorCode=Cn.prototype.ua,Cn.prototype.getStatus=Cn.prototype.W,Cn.prototype.getResponseJson=Cn.prototype.Pa,Cn.prototype.getResponseText=Cn.prototype.$,Cn.prototype.send=Cn.prototype.ba;var hr=lt,fr=mt,dr=vt,pr=ut,yr=Tt,gr=Cn,S=(mr.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},mr.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},mr.prototype.setServiceProps=function(e){return this.serviceProps=e,this},mr);function mr(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var vr=function(e,t,n,r,i,o){this.databaseId=e,this.persistenceKey=t,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},wr="(default)",br=(Object.defineProperty(Tr.prototype,"isDefaultDatabase",{get:function(){return this.database===wr},enumerable:!1,configurable:!0}),Tr.prototype.isEqual=function(e){return e instanceof Tr&&e.projectId===this.projectId&&e.database===this.database},Tr);function Tr(e,t){this.projectId=e,this.database=t||wr}var Er=(_r.prototype.isAuthenticated=function(){return null!=this.uid},_r.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},_r.prototype.isEqual=function(e){return e.uid===this.uid},_r);function _r(e){this.uid=e}Er.UNAUTHENTICATED=new Er(null),Er.GOOGLE_CREDENTIALS=new Er("google-credentials-uid"),Er.FIRST_PARTY=new Er("first-party-uid");var Ir,Sr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Cr=(n(Dr,Ir=Error),Dr);function Dr(e,t){var n=Ir.call(this,t)||this;return n.code=e,n.message=t,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}var Ar="8.1.1-1.0.0-eap-firestore-debug.9c6096f43",kr=new h("@firebase/firestore");function Nr(){return kr.logLevel}function Rr(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];kr.logLevel<=s.DEBUG&&(t=n.map(Pr),kr.debug.apply(kr,a(["Firestore ("+Ar+"): "+e],t)))}function Or(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];kr.logLevel<=s.ERROR&&(t=n.map(Pr),kr.error.apply(kr,a(["Firestore ("+Ar+"): "+e],t)))}function Lr(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];kr.logLevel<=s.WARN&&(t=n.map(Pr),kr.warn.apply(kr,a(["Firestore ("+Ar+"): "+e],t)))}function Pr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Mr(e){throw void 0===e&&(e="Unexpected state"),Or(e="FIRESTORE ("+Ar+") INTERNAL ASSERTION FAILED: "+e),new Error(e)}function xr(e,t){e||Mr(t)}function Fr(e,t){e||Mr(t)}function Vr(e,t){return Fr(e instanceof t,"Expected type '"+t.name+"', but was '"+e.constructor.name+"'"),e}var qr=(Br.newId=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;Fr(0<t&&t<256,"Expect maxMultiple to be (0, 256), but got "+t);for(var n="";n.length<20;)for(var r=function(){Fr(!0,"Expecting non-negative nBytes, got: 40");var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(var n=0;n<40;n++)t[n]=Math.floor(256*Math.random());return t}(),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return Fr(20===n.length,"Invalid auto ID: "+n),n},Br);function Br(){}function Ur(e,t){return e<t?-1:t<e?1:0}function jr(e,n,r){return e.length===n.length&&e.every(function(e,t){return r(e,n[t])})}var Kr=-62135596800,zr=(Gr.now=function(){return Gr.fromMillis(Date.now())},Gr.fromDate=function(e){return Gr.fromMillis(e.getTime())},Gr.fromMillis=function(e){var t=Math.floor(e/1e3);return new Gr(t,1e6*(e-1e3*t))},Gr.prototype.toDate=function(){return new Date(this.toMillis())},Gr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Gr.prototype._compareTo=function(e){return this.seconds===e.seconds?Ur(this.nanoseconds,e.nanoseconds):Ur(this.seconds,e.seconds)},Gr.prototype.isEqual=function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds},Gr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Gr.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Gr.prototype.valueOf=function(){var e=this.seconds-Kr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Gr);function Gr(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new Cr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new Cr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Kr)throw new Cr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new Cr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}function Qr(e){var t,n=0;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n++;return n}function Wr(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Hr(e){for(var t in Fr(null!=e&&"object"==typeof e,"isEmpty() expects object parameter."),e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Yr=(Xr.fromBase64String=function(e){return new Xr(atob(e))},Xr.fromUint8Array=function(e){return new Xr(function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))},Xr.prototype.toBase64=function(){return e=this.binaryString,btoa(e);var e},Xr.prototype.toUint8Array=function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)},Xr.prototype.approximateByteSize=function(){return 2*this.binaryString.length},Xr.prototype.compareTo=function(e){return Ur(this.binaryString,e.binaryString)},Xr.prototype.isEqual=function(e){return this.binaryString===e.binaryString},Xr);function Xr(e){this.binaryString=e}function Jr(e){return null==e}function $r(e){return 0===e&&1/e==-1/0}Yr.EMPTY_BYTE_STRING=new Yr("");var Zr="__name__",mt=(Object.defineProperty(ei.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),ei.prototype.isEqual=function(e){return 0===ei.comparator(this,e)},ei.prototype.child=function(e){var t=this.segments.slice(this.offset,this.limit());return e instanceof ei?e.forEach(function(e){t.push(e)}):t.push(e),this.construct(t)},ei.prototype.limit=function(){return this.offset+this.length},ei.prototype.popFirst=function(e){return e=void 0===e?1:e,Fr(this.length>=e,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+e,this.length-e)},ei.prototype.popLast=function(){return Fr(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},ei.prototype.firstSegment=function(){return Fr(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},ei.prototype.lastSegment=function(){return this.get(this.length-1)},ei.prototype.get=function(e){return Fr(e<this.length,"Index out of range"),this.segments[this.offset+e]},ei.prototype.isEmpty=function(){return 0===this.length},ei.prototype.isPrefixOf=function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},ei.prototype.isImmediateParentOf=function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},ei.prototype.forEach=function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])},ei.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},ei.comparator=function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),o=t.get(r);if(i<o)return-1;if(o<i)return 1}return e.length<t.length?-1:e.length>t.length?1:0},ei);function ei(e,t,n){void 0===t?t=0:t>e.length&&Mr("offset "+t+" out of range "+e.length),void 0===n?n=e.length-t:n>e.length-t&&Mr("length "+n+" out of range "+(e.length-t)),this.segments=e,this.offset=t,this.len=n}var ti,ni=(n(ri,ti=mt),ri.prototype.construct=function(e,t,n){return new ri(e,t,n)},ri.prototype.canonicalString=function(){return this.toArray().join("/")},ri.prototype.toString=function(){return this.canonicalString()},ri.fromString=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(e){return 0<e.length}))}return new ri(n)},ri.emptyPath=function(){return new ri([])},ri);function ri(){return null!==ti&&ti.apply(this,arguments)||this}var ii,oi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ai=(n(si,ii=mt),si.prototype.construct=function(e,t,n){return new si(e,t,n)},si.isValidIdentifier=function(e){return oi.test(e)},si.prototype.canonicalString=function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),si.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")},si.prototype.toString=function(){return this.canonicalString()},si.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Zr},si.keyField=function(){return new si([Zr])},si.fromServerFormat=function(e){for(var t=[],n="",r=0,i=function(){if(0===n.length)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");t.push(n),n=""},o=!1;r<e.length;){var a=e[r];if("\\"===a){if(r+1===e.length)throw new Cr(Sr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Cr(Sr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Cr(Sr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new si(t)},si.emptyPath=function(){return new si([])},si);function si(){return null!==ii&&ii.apply(this,arguments)||this}var ui=(ci.fromPath=function(e){return new ci(ni.fromString(e))},ci.fromName=function(e){return new ci(ni.fromString(e).popFirst(5))},ci.prototype.hasCollectionId=function(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e},ci.prototype.isEqual=function(e){return null!==e&&0===ni.comparator(this.path,e.path)},ci.prototype.toString=function(){return this.path.toString()},ci.comparator=function(e,t){return ni.comparator(e.path,t.path)},ci.isDocumentKey=function(e){return e.length%2==0},ci.fromSegments=function(e){return new ci(new ni(e.slice()))},ci);function ci(e){this.path=e,Fr(ci.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}var li="server_timestamp",hi="__type__",fi="__previous_value__",di="__local_write_time__";function pi(e){return(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{})[hi])||void 0===e?void 0:e.stringValue)===li}function yi(e){return e=_i(e.mapValue.fields[di].timestampValue),new zr(e.seconds,e.nanos)}var gi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mi(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?pi(e)?4:10:Mr("Invalid value type: "+JSON.stringify(e))}function vi(r,i){var e,t,n,o=mi(r);if(o!==mi(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return yi(r).isEqual(yi(i));case 3:return n=i,"string"==typeof(t=r).timestampValue&&"string"==typeof n.timestampValue&&t.timestampValue.length===n.timestampValue.length?t.timestampValue===n.timestampValue:(t=_i(t.timestampValue),n=_i(n.timestampValue),t.seconds===n.seconds&&t.nanos===n.nanos);case 5:return r.stringValue===i.stringValue;case 6:return e=i,Si(r.bytesValue).isEqual(Si(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return o=i,Ii((e=r).geoPointValue.latitude)===Ii(o.geoPointValue.latitude)&&Ii(e.geoPointValue.longitude)===Ii(o.geoPointValue.longitude);case 2:return e=i,"integerValue"in(o=r)&&"integerValue"in e?Ii(o.integerValue)===Ii(e.integerValue):"doubleValue"in o&&"doubleValue"in e&&((o=Ii(o.doubleValue))===(e=Ii(e.doubleValue))?$r(o)===$r(e):isNaN(o)&&isNaN(e));case 9:return jr(r.arrayValue.values||[],i.arrayValue.values||[],vi);case 10:return function(){var e,t=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Qr(t)!==Qr(n))return!1;for(e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!vi(t[e],n[e])))return!1;return!0}();default:return Mr("Unexpected value type: "+JSON.stringify(r))}}function wi(e,t){return void 0!==(e.values||[]).find(function(e){return vi(e,t)})}function bi(e,t){var n,r,i,o,a=mi(e),s=mi(t);if(a!==s)return Ur(a,s);switch(a){case 0:return 0;case 1:return Ur(e.booleanValue,t.booleanValue);case 2:return o=t,(i=Ii((i=e).integerValue||i.doubleValue))<(o=Ii(o.integerValue||o.doubleValue))?-1:o<i?1:i===o?0:isNaN(i)?isNaN(o)?0:-1:1;case 3:return Ti(e.timestampValue,t.timestampValue);case 4:return Ti(yi(e),yi(t));case 5:return Ur(e.stringValue,t.stringValue);case 6:return n=e.bytesValue,r=t.bytesValue,n=Si(n),r=Si(r),n.compareTo(r);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ur(n[i],r[i]);if(0!==o)return o}return Ur(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0===(s=Ur(Ii(n.latitude),Ii(r.latitude)))?Ur(Ii(n.longitude),Ii(r.longitude)):s;case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var o=bi(n[i],r[i]);if(o)return o}return Ur(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var a=0;a<r.length&&a<o.length;++a){var s=Ur(r[a],o[a]);if(0!==s)return s;if(0!==(s=bi(n[r[a]],i[o[a]])))return s}return Ur(r.length,o.length)}(e.mapValue,t.mapValue);default:throw Mr("Invalid value type: "+a)}}function Ti(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ur(e,t);var n=_i(e),e=_i(t);return 0!==(t=Ur(n.seconds,e.seconds))?t:Ur(n.nanos,e.nanos)}function Ei(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){return"time("+(e=_i(e)).seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Si(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ui.fromName(t).toString()):"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(e){for(var t="[",n=!0,r=0,i=e.values||[];r<i.length;r++)n?n=!1:t+=",",t+=s(i[r]);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var t=Object.keys(e.fields||{}).sort(),n="{",r=!0,i=0,o=t;i<o.length;i++){var a=o[i];r?r=!1:n+=",",n+=a+":"+s(e.fields[a])}return n+"}"}(e.mapValue):Mr("Invalid value type: "+JSON.stringify(e));var t}(e)}function _i(e){if(xr(!!e,"Cannot normalize null or undefined timestamp."),"string"!=typeof e)return{seconds:Ii(e.seconds),nanos:t=Ii(e.nanos)};var t=0,n=gi.exec(e);return xr(!!n,"invalid timestamp: "+e),n[1]&&(n=(n[1]+"000000000").substr(0,9),t=Number(n)),e=new Date(e),{seconds:Math.floor(e.getTime()/1e3),nanos:t}}function Ii(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Si(e){return"string"==typeof e?Yr.fromBase64String(e):Yr.fromUint8Array(e)}function Ci(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function Di(e){return!!e&&"integerValue"in e}function Ai(e){return Di(e)||!!e&&"doubleValue"in e}function ki(e){return!!e&&"arrayValue"in e}function Ni(e){return!!e&&"referenceValue"in e}function Ri(e){return e&&"nullValue"in e}function Oi(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Li(e){return e&&"mapValue"in e}var Pi,Mi=(n(xi,Pi=vt=function(e,t){this.key=e,this.version=t}),xi.prototype.field=function(e){return this.objectValue.field(e)},xi.prototype.data=function(){return this.objectValue},xi.prototype.toProto=function(){return this.objectValue.proto},xi.prototype.isEqual=function(e){return e instanceof xi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.hasLocalMutations===e.hasLocalMutations&&this.hasCommittedMutations===e.hasCommittedMutations&&this.objectValue.isEqual(e.objectValue)},xi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(xi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),xi);function xi(e,t,n,r){return(t=Pi.call(this,e,t)||this).objectValue=n,t.hasLocalMutations=!!r.hasLocalMutations,t.hasCommittedMutations=!!r.hasCommittedMutations,t}var Fi,Vi=(n(qi,Fi=vt),qi.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(qi.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),qi.prototype.isEqual=function(e){return e instanceof qi&&e.hasCommittedMutations===this.hasCommittedMutations&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},qi);function qi(e,t,n){return(t=Fi.call(this,e,t)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),t}var Bi,Ui=(n(ji,Bi=vt),ji.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(ji.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),ji.prototype.isEqual=function(e){return e instanceof ji&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},ji);function ji(){return null!==Bi&&Bi.apply(this,arguments)||this}var Ki=function(e,t,n,r,i,o,a){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null};function zi(e,t,n,r,i,o,a){return void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),new Ki(e,t,n,r,i,o,a)}function Gi(e){var t=Vr(e,Ki);return null===t.memoizedCanonicalId&&(e=t.path.canonicalString(),null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(function(e){return Fr(e instanceof ho,"canonifyFilter() only supports FieldFilters"),e.field.canonicalString()+e.op.toString()+Ei(e.value)}).join(","),e+="|ob:",e+=t.orderBy.map(function(e){return e.field.canonicalString()+e.dir}).join(","),Jr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=Fo(t.startAt)),t.endAt&&(e+="|ub:",e+=Fo(t.endAt)),t.memoizedCanonicalId=e),t.memoizedCanonicalId}function Qi(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n,r,i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(e.filters.length!==t.filters.length)return!1;for(var o,a,i=0;i<e.filters.length;i++)if(o=e.filters[i],a=t.filters[i],Fr(o instanceof ho&&a instanceof ho,"Only FieldFilters can be compared"),o.op!==a.op||!o.field.isEqual(a.field)||!vi(o.value,a.value))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!qo(e.startAt,t.startAt)&&qo(e.endAt,t.endAt)}function Wi(e){return ui.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var Hi=function(e,t,n,r,i,o,a,s){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===a&&(a=null),void 0===s&&(s=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&Fr(this.startAt.position.length<=no(this).length,"Bound is longer than orderBy"),this.endAt&&Fr(this.endAt.position.length<=no(this).length,"Bound is longer than orderBy")};function Yi(e){return new Hi(e)}function Xi(e){return!Jr(e.limit)&&"F"===e.limitType}function Ji(e){return!Jr(e.limit)&&"L"===e.limitType}function $i(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Zi(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(Fr(r instanceof ho,"Only FieldFilters are supported"),r.isInequality())return r.field}return null}function eo(e){return ui.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function to(e){return null!==e.collectionGroup}function no(e){var t=Vr(e,Hi);if(null===t.memoizedOrderBy){t.memoizedOrderBy=[];var n=Zi(t),e=$i(t);if(null!==n&&null===e)n.isKeyField()||t.memoizedOrderBy.push(new Bo(n)),t.memoizedOrderBy.push(new Bo(ai.keyField(),"asc"));else{Fr(null===n||null!==e&&n.isEqual(e),"First orderBy should match inequality field.");for(var r=!1,i=0,o=t.explicitOrderBy;i<o.length;i++){var a=o[i];t.memoizedOrderBy.push(a),a.field.isKeyField()&&(r=!0)}r||(e=0<t.explicitOrderBy.length?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",t.memoizedOrderBy.push(new Bo(ai.keyField(),e)))}}return t.memoizedOrderBy}function ro(e){var t=Vr(e,Hi);if(!t.memoizedTarget)if("F"===t.limitType)t.memoizedTarget=zi(t.path,t.collectionGroup,no(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=no(t);r<i.length;r++){var o=i[r],a="desc"===o.dir?"asc":"desc";n.push(new Bo(o.field,a))}var s=t.endAt?new xo(t.endAt.position,!t.endAt.before):null,e=t.startAt?new xo(t.startAt.position,!t.startAt.before):null;t.memoizedTarget=zi(t.path,t.collectionGroup,n,t.filters,t.limit,s,e)}return t.memoizedTarget}function io(e,t,n){return new Hi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function oo(e,t){return Qi(ro(e),ro(t))&&e.limitType===t.limitType}function ao(e){return Gi(ro(e))+"|lt:"+e.limitType}function so(e){return"Query(target="+(t=ro(e),n=t.path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),0<t.filters.length&&(n+=", filters: ["+t.filters.map(function(e){return Fr(e instanceof ho,"stringifyFilter() only supports FieldFilters"),e.field.canonicalString()+" "+e.op+" "+Ei(e.value)}).join(", ")+"]"),Jr(t.limit)||(n+=", limit: "+t.limit),0<t.orderBy.length&&(n+=", orderBy: ["+t.orderBy.map(function(e){return e.field.canonicalString()+" ("+e.dir+")"}).join(", ")+"]"),t.startAt&&(n+=", startAt: "+Fo(t.startAt)),t.endAt&&(n+=", endAt: "+Fo(t.endAt)),"Target("+n+")")+"; limitType="+e.limitType+")";var t,n}function uo(i,e){return t=i,n=e.key.path,(null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ui.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n))&&function(e){for(var t=0,n=i.explicitOrderBy;t<n.length;t++){var r=n[t];if(!r.field.isKeyField()&&null===e.field(r.field))return}return 1}(e)&&function(e){for(var t=0,n=i.filters;t<n.length;t++)if(!n[t].matches(e))return;return 1}(e)&&(n=e,(!(e=i).startAt||Vo(e.startAt,no(e),n))&&(!e.endAt||!Vo(e.endAt,no(e),n)));var t,n}function co(s){return function(e,t){for(var n=!1,r=0,i=no(s);r<i.length;r++){var o=i[r],a=function(e,t,n){var r,i;switch(n=e.field.isKeyField()?ui.comparator(t.key,n.key):(r=e.field,i=n,t=(t=t).field(r),r=i.field(r),null!==t&&null!==r?bi(t,r):Mr("Trying to compare documents on fields that don't exist")),e.dir){case"asc":return n;case"desc":return-1*n;default:return Mr("Unknown direction: "+e.dir)}}(o,e,t);if(0!==a)return a;n=n||o.field.isKeyField()}return Fr(n,"orderBy used that doesn't compare on key field"),0}}var lo,ho=(n(fo,lo=function(){}),fo.create=function(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):(Fr(Ni(n),"Comparing on key, but filter value not a RefValue"),Fr("array-contains"!==t&&"array-contains-any"!==t,"'"+t.toString()+"' queries don't make sense on document keys."),new yo(e,t,n)):"array-contains"===t?new So(e,n):"in"===t?(Fr(ki(n),"IN filter has invalid value: "+n.toString()),new Ao(e,n)):"not-in"===t?(Fr(ki(n),"NOT_IN filter has invalid value: "+n.toString()),new Ro(e,n)):"array-contains-any"===t?(Fr(ki(n),"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new Po(e,n)):new fo(e,t,n)},fo.createKeyFieldInFilter=function(e,t,n){return Fr(ki(n),"Comparing on key with "+t.toString()+", but filter value not an ArrayValue"),Fr((n.arrayValue.values||[]).every(Ni),"Comparing on key with "+t.toString()+", but an array value was not a RefValue"),new("in"===t?vo:To)(e,n)},fo.prototype.matches=function(e){return e=e.field(this.field),"!="===this.op?null!==e&&this.matchesComparison(bi(e,this.value)):null!==e&&mi(this.value)===mi(e)&&this.matchesComparison(bi(e,this.value))},fo.prototype.matchesComparison=function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Mr("Unknown FieldFilter operator: "+this.op)}},fo.prototype.isInequality=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},fo);function fo(e,t,n){var r=lo.call(this)||this;return r.field=e,r.op=t,r.value=n,r}var po,yo=(n(go,po=ho),go.prototype.matches=function(e){return e=ui.comparator(e.key,this.key),this.matchesComparison(e)},go);function go(e,t,n){return t=po.call(this,e,t,n)||this,Fr(Ni(n),"KeyFieldFilter expects a ReferenceValue"),t.key=ui.fromName(n.referenceValue),t}var mo,vo=(n(wo,mo=ho),wo.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},wo);function wo(e,t){return(e=mo.call(this,e,"in",t)||this).keys=_o("in",t),e}var bo,To=(n(Eo,bo=ho),Eo.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},Eo);function Eo(e,t){return(e=bo.call(this,e,"not-in",t)||this).keys=_o("not-in",t),e}function _o(t,e){return Fr(ki(e),"KeyFieldInFilter/KeyFieldNotInFilter expects an ArrayValue"),((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(e){return Fr(Ni(e),"Comparing on key with "+t.toString()+", but an array value was not a ReferenceValue"),ui.fromName(e.referenceValue)})}var Io,So=(n(Co,Io=ho),Co.prototype.matches=function(e){return ki(e=e.field(this.field))&&wi(e.arrayValue,this.value)},Co);function Co(e,t){return Io.call(this,e,"array-contains",t)||this}var Do,Ao=(n(ko,Do=ho),ko.prototype.matches=function(e){return null!==(e=e.field(this.field))&&wi(this.value.arrayValue,e)},ko);function ko(e,t){return e=Do.call(this,e,"in",t)||this,Fr(ki(t),"InFilter expects an ArrayValue"),e}var No,Ro=(n(Oo,No=ho),Oo.prototype.matches=function(e){return!wi(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(e=e.field(this.field))&&!wi(this.value.arrayValue,e))},Oo);function Oo(e,t){return e=No.call(this,e,"not-in",t)||this,Fr(ki(t),"NotInFilter expects an ArrayValue"),e}var Lo,Po=(n(Mo,Lo=ho),Mo.prototype.matches=function(e){var t=this;return!(!ki(e=e.field(this.field))||!e.arrayValue.values)&&e.arrayValue.values.some(function(e){return wi(t.value.arrayValue,e)})},Mo);function Mo(e,t){return e=Lo.call(this,e,"array-contains-any",t)||this,Fr(ki(t),"ArrayContainsAnyFilter expects an ArrayValue"),e}var xo=function(e,t){this.position=e,this.before=t};function Fo(e){return(e.before?"b":"a")+":"+e.position.map(Ei).join(",")}function Vo(e,t,n){Fr(e.position.length<=t.length,"Bound has more components than query's orderBy");for(var r=0,i=0;i<e.position.length;i++){var o,a=t[i],s=e.position[i],r=a.field.isKeyField()?(Fr(Ni(s),"Bound has a non-key value where the key path is being used."),ui.comparator(ui.fromName(s.referenceValue),n.key)):(Fr(null!==(o=n.field(a.field)),"Field should exist since document matched the orderBy already."),bi(s,o));if("desc"===a.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function qo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!vi(e.position[n],t.position[n]))return!1;return!0}var Bo=function(e,t){void 0===t&&(t="asc"),this.field=e,this.dir=t},Uo=(jo.fromTimestamp=function(e){return new jo(e)},jo.min=function(){return new jo(new zr(0,0))},jo.prototype.compareTo=function(e){return this.timestamp._compareTo(e.timestamp)},jo.prototype.isEqual=function(e){return this.timestamp.isEqual(e.timestamp)},jo.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},jo.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},jo.prototype.toTimestamp=function(){return this.timestamp},jo);function jo(e){this.timestamp=e}var Ko=(zo.prototype.insert=function(e,t){return new zo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wo.BLACK,null,null))},zo.prototype.remove=function(e){return new zo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wo.BLACK,null,null))},zo.prototype.get=function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null},zo.prototype.indexOf=function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1},zo.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(zo.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),zo.prototype.minKey=function(){return this.root.minKey()},zo.prototype.maxKey=function(){return this.root.maxKey()},zo.prototype.inorderTraversal=function(e){return this.root.inorderTraversal(e)},zo.prototype.forEach=function(n){this.inorderTraversal(function(e,t){return n(e,t),!1})},zo.prototype.toString=function(){var n=[];return this.inorderTraversal(function(e,t){return n.push(e+":"+t),!1}),"{"+n.join(", ")+"}"},zo.prototype.reverseTraversal=function(e){return this.root.reverseTraversal(e)},zo.prototype.getIterator=function(){return new Go(this.root,null,this.comparator,!1)},zo.prototype.getIteratorFrom=function(e){return new Go(this.root,e,this.comparator,!1)},zo.prototype.getReverseIterator=function(){return new Go(this.root,null,this.comparator,!0)},zo.prototype.getReverseIteratorFrom=function(e){return new Go(this.root,e,this.comparator,!0)},zo);function zo(e,t){this.comparator=e,this.root=t||Wo.EMPTY}var Go=(Qo.prototype.getNext=function(){Fr(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t},Qo.prototype.hasNext=function(){return 0<this.nodeStack.length},Qo.prototype.peek=function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}},Qo);function Qo(e,t,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}var Wo=(Ho.prototype.copy=function(e,t,n,r,i){return new Ho(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ho.prototype.isEmpty=function(){return!1},Ho.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},Ho.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},Ho.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},Ho.prototype.minKey=function(){return this.min().key},Ho.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Ho.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()},Ho.prototype.removeMin=function(){if(this.left.isEmpty())return Ho.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},Ho.prototype.remove=function(e,t){var n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Ho.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()},Ho.prototype.isRed=function(){return this.color},Ho.prototype.fixUp=function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e},Ho.prototype.moveRedLeft=function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e},Ho.prototype.moveRedRight=function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e},Ho.prototype.rotateLeft=function(){var e=this.copy(null,null,Ho.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},Ho.prototype.rotateRight=function(){var e=this.copy(null,null,Ho.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},Ho.prototype.colorFlip=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},Ho.prototype.checkMaxDepth=function(){var e=this.check();return Math.pow(2,e)<=this.size+1},Ho.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Mr("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Mr("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check();if(e!==this.right.check())throw Mr("Black depths differ");return e+(this.isRed()?0:1)},Ho);function Ho(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Ho.RED,this.left=null!=r?r:Ho.EMPTY,this.right=null!=i?i:Ho.EMPTY,this.size=this.left.size+1+this.right.size}function Yo(){this.size=0}Wo.EMPTY=null,Wo.RED=!0,Wo.BLACK=!1,Object.defineProperty(Yo.prototype,"key",{get:function(){throw Mr("LLRBEmptyNode has no key.")},enumerable:!1,configurable:!0}),Object.defineProperty(Yo.prototype,"value",{get:function(){throw Mr("LLRBEmptyNode has no value.")},enumerable:!1,configurable:!0}),Object.defineProperty(Yo.prototype,"color",{get:function(){throw Mr("LLRBEmptyNode has no color.")},enumerable:!1,configurable:!0}),Object.defineProperty(Yo.prototype,"left",{get:function(){throw Mr("LLRBEmptyNode has no left child.")},enumerable:!1,configurable:!0}),Object.defineProperty(Yo.prototype,"right",{get:function(){throw Mr("LLRBEmptyNode has no right child.")},enumerable:!1,configurable:!0}),Yo.prototype.copy=function(e,t,n,r,i){return this},Yo.prototype.insert=function(e,t,n){return new Wo(e,t)},Yo.prototype.remove=function(e,t){return this},Yo.prototype.isEmpty=function(){return!0},Yo.prototype.inorderTraversal=function(e){return!1},Yo.prototype.reverseTraversal=function(e){return!1},Yo.prototype.minKey=function(){return null},Yo.prototype.maxKey=function(){return null},Yo.prototype.isRed=function(){return!1},Yo.prototype.checkMaxDepth=function(){return!0},Yo.prototype.check=function(){return 0},h=Yo,Wo.EMPTY=new h;var Xo=(Jo.prototype.has=function(e){return null!==this.data.get(e)},Jo.prototype.first=function(){return this.data.minKey()},Jo.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Jo.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Jo.prototype.indexOf=function(e){return this.data.indexOf(e)},Jo.prototype.forEach=function(n){this.data.inorderTraversal(function(e,t){return n(e),!1})},Jo.prototype.forEachInRange=function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}},Jo.prototype.forEachWhile=function(e,t){for(var n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return},Jo.prototype.firstAfterOrEqual=function(e){return(e=this.data.getIteratorFrom(e)).hasNext()?e.getNext().key:null},Jo.prototype.getIterator=function(){return new $o(this.data.getIterator())},Jo.prototype.getIteratorFrom=function(e){return new $o(this.data.getIteratorFrom(e))},Jo.prototype.add=function(e){return this.copy(this.data.remove(e).insert(e,!0))},Jo.prototype.delete=function(e){return this.has(e)?this.copy(this.data.remove(e)):this},Jo.prototype.isEmpty=function(){return this.data.isEmpty()},Jo.prototype.unionWith=function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t},Jo.prototype.isEqual=function(e){if(!(e instanceof Jo))return!1;if(this.size!==e.size)return!1;for(var t=this.data.getIterator(),n=e.data.getIterator();t.hasNext();){var r=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Jo.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},Jo.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},Jo.prototype.copy=function(e){var t=new Jo(this.comparator);return t.data=e,t},Jo);function Jo(e){this.comparator=e,this.data=new Ko(this.comparator)}var $o=(Zo.prototype.getNext=function(){return this.iter.getNext().key},Zo.prototype.hasNext=function(){return this.iter.hasNext()},Zo);function Zo(e){this.iter=e}var ea=new Ko(ui.comparator),ta=new Ko(ui.comparator),na=new Ko(ui.comparator),ra=new Xo(ui.comparator);function ia(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=ra,r=0,i=e;r<i.length;r++)var o=i[r],n=n.add(o);return n}var oa=new Xo(Ur),aa=(sa.empty=function(){return new sa({mapValue:{}})},sa.prototype.field=function(e){if(e.isEmpty())return this.proto;for(var t=this.proto,n=0;n<e.length-1;++n){if(!t.mapValue.fields)return null;if(!Li(t=t.mapValue.fields[e.get(n)]))return null}return(t=(t.mapValue.fields||{})[e.lastSegment()])||null},sa.prototype.isEqual=function(e){return vi(this.proto,e.proto)},sa);function sa(e){Fr(!pi(this.proto=e),"ServerTimestamps should be converted to ServerTimestampValue")}var ua=(ca.prototype.set=function(e,t){return Fr(!e.isEmpty(),"Cannot set field for empty path on ObjectValue"),this.setOverlay(e,t),this},ca.prototype.delete=function(e){return Fr(!e.isEmpty(),"Cannot delete field for empty path on ObjectValue"),this.setOverlay(e,null),this},ca.prototype.setOverlay=function(e,t){for(var n=this.overlayMap,r=0;r<e.length-1;++r)var i=e.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===mi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(e.lastSegment(),t)},ca.prototype.build=function(){var e=this.applyOverlay(ai.emptyPath(),this.overlayMap);return null!=e?new aa(e):this.baseObject},ca.prototype.applyOverlay=function(r,e){var i=this,o=!1,t=this.baseObject.field(r),a=Li(t)?Object.assign({},t.mapValue.fields):{};return e.forEach(function(e,t){var n;e instanceof Map?null!=(n=i.applyOverlay(r.child(t),e))&&(a[t]=n,o=!0):null!==e?(a[t]=e,o=!0):a.hasOwnProperty(t)&&(delete a[t],o=!0)}),o?{mapValue:{fields:a}}:null},ca);function ca(e){void 0===e&&(e=aa.empty()),this.baseObject=e,this.overlayMap=new Map}function la(e){this.count=e}var ha;function fa(e){switch(e){case Sr.OK:return Mr("Treated status OK as error"),0;case Sr.CANCELLED:case Sr.UNKNOWN:case Sr.DEADLINE_EXCEEDED:case Sr.RESOURCE_EXHAUSTED:case Sr.INTERNAL:case Sr.UNAVAILABLE:case Sr.UNAUTHENTICATED:return;case Sr.INVALID_ARGUMENT:case Sr.NOT_FOUND:case Sr.ALREADY_EXISTS:case Sr.PERMISSION_DENIED:case Sr.FAILED_PRECONDITION:case Sr.ABORTED:case Sr.OUT_OF_RANGE:case Sr.UNIMPLEMENTED:case Sr.DATA_LOSS:return 1;default:return Mr("Unknown status code: "+e),0}}function da(e){if(void 0===e)return Or("GRPC error has no .code"),Sr.UNKNOWN;switch(e){case ha.OK:return Sr.OK;case ha.CANCELLED:return Sr.CANCELLED;case ha.UNKNOWN:return Sr.UNKNOWN;case ha.DEADLINE_EXCEEDED:return Sr.DEADLINE_EXCEEDED;case ha.RESOURCE_EXHAUSTED:return Sr.RESOURCE_EXHAUSTED;case ha.INTERNAL:return Sr.INTERNAL;case ha.UNAVAILABLE:return Sr.UNAVAILABLE;case ha.UNAUTHENTICATED:return Sr.UNAUTHENTICATED;case ha.INVALID_ARGUMENT:return Sr.INVALID_ARGUMENT;case ha.NOT_FOUND:return Sr.NOT_FOUND;case ha.ALREADY_EXISTS:return Sr.ALREADY_EXISTS;case ha.PERMISSION_DENIED:return Sr.PERMISSION_DENIED;case ha.FAILED_PRECONDITION:return Sr.FAILED_PRECONDITION;case ha.ABORTED:return Sr.ABORTED;case ha.OUT_OF_RANGE:return Sr.OUT_OF_RANGE;case ha.UNIMPLEMENTED:return Sr.UNIMPLEMENTED;case ha.DATA_LOSS:return Sr.DATA_LOSS;default:return Mr("Unknown status code: "+e)}}(mt=ha=ha||{})[mt.OK=0]="OK",mt[mt.CANCELLED=1]="CANCELLED",mt[mt.UNKNOWN=2]="UNKNOWN",mt[mt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",mt[mt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",mt[mt.NOT_FOUND=5]="NOT_FOUND",mt[mt.ALREADY_EXISTS=6]="ALREADY_EXISTS",mt[mt.PERMISSION_DENIED=7]="PERMISSION_DENIED",mt[mt.UNAUTHENTICATED=16]="UNAUTHENTICATED",mt[mt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",mt[mt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",mt[mt.ABORTED=10]="ABORTED",mt[mt.OUT_OF_RANGE=11]="OUT_OF_RANGE",mt[mt.UNIMPLEMENTED=12]="UNIMPLEMENTED",mt[mt.INTERNAL=13]="INTERNAL",mt[mt.UNAVAILABLE=14]="UNAVAILABLE",mt[mt.DATA_LOSS=15]="DATA_LOSS";var pa=(ya.createSynthesizedRemoteEventForCurrentChange=function(e,t){var n=new Map;return n.set(e,ga.createSynthesizedTargetChangeForCurrentChange(e,t)),new ya(Uo.min(),n,oa,ea,ia())},ya);function ya(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var ga=(ma.createSynthesizedTargetChangeForCurrentChange=function(e,t){return new ma(Yr.EMPTY_BYTE_STRING,t,ia(),ia(),ia())},ma);function ma(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var va=function(e,t,n,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=n,this.newDoc=r},wa=function(e,t){this.targetId=e,this.existenceFilter=t},ba=function(e,t,n,r){void 0===n&&(n=Yr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},Ta=(Object.defineProperty(Ea.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(Ea.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!1,configurable:!0}),Object.defineProperty(Ea.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!1,configurable:!0}),Object.defineProperty(Ea.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!1,configurable:!0}),Ea.prototype.updateResumeToken=function(e){0<e.approximateByteSize()&&(this._hasPendingChanges=!0,this._resumeToken=e)},Ea.prototype.toTargetChange=function(){var n=ia(),r=ia(),i=ia();return this.documentChanges.forEach(function(e,t){switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:Mr("Encountered invalid change type: "+t)}}),new ga(this._resumeToken,this._current,n,r,i)},Ea.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=Ca()},Ea.prototype.addDocumentChange=function(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)},Ea.prototype.removeDocumentChange=function(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)},Ea.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},Ea.prototype.recordTargetResponse=function(){--this.pendingResponses},Ea.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},Ea);function Ea(){this.pendingResponses=0,this.documentChanges=Ca(),this._resumeToken=Yr.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}var _a=(Ia.prototype.handleDocumentChange=function(e){for(var t=0,n=e.updatedTargetIds;t<n.length;t++){var r=n[t];e.newDoc instanceof Mi?this.addDocumentToTarget(r,e.newDoc):e.newDoc instanceof Vi&&this.removeDocumentFromTarget(r,e.key,e.newDoc)}for(var i=0,o=e.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,e.key,e.newDoc)},Ia.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(e){var t=r.ensureTargetState(e);switch(n.state){case 0:r.isActiveTarget(e)&&t.updateResumeToken(n.resumeToken);break;case 1:t.recordTargetResponse(),t.isPending||t.clearPendingChanges(),t.updateResumeToken(n.resumeToken);break;case 2:t.recordTargetResponse(),t.isPending||r.removeTarget(e),Fr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:r.isActiveTarget(e)&&(t.markCurrent(),t.updateResumeToken(n.resumeToken));break;case 4:r.isActiveTarget(e)&&(r.resetTarget(e),t.updateResumeToken(n.resumeToken));break;default:Mr("Unknown target watch change state: "+n.state)}})},Ia.prototype.forEachTarget=function(e,n){var r=this;0<e.targetIds.length?e.targetIds.forEach(n):this.targetStates.forEach(function(e,t){r.isActiveTarget(t)&&n(t)})},Ia.prototype.handleExistenceFilter=function(e){var t=e.targetId,n=e.existenceFilter.count;(e=this.targetDataForActiveTarget(t))&&(Wi(e=e.target)?0===n?(e=new ui(e.path),this.removeDocumentFromTarget(t,e,new Vi(e,Uo.min()))):xr(1===n,"Single document existence filter with count: "+n):this.getCurrentDocumentCountForTarget(t)!==n&&(this.resetTarget(t),this.pendingTargetResets=this.pendingTargetResets.add(t)))},Ia.prototype.createRemoteEvent=function(r){var i=this,o=new Map;this.targetStates.forEach(function(e,t){var n=i.targetDataForActiveTarget(t);n&&(e.current&&Wi(n.target)&&(n=new ui(n.target.path),null!==i.pendingDocumentUpdates.get(n)||i.targetContainsDocument(t,n)||i.removeDocumentFromTarget(t,n,new Vi(n,r))),e.hasPendingChanges&&(o.set(t,e.toTargetChange()),e.clearPendingChanges()))});var a=ia();this.pendingDocumentTargetMapping.forEach(function(e,t){var n=!0;t.forEachWhile(function(e){return!(e=i.targetDataForActiveTarget(e))||2===e.purpose||(n=!1)}),n&&(a=a.add(e))});var e=new pa(r,o,this.pendingTargetResets,this.pendingDocumentUpdates,a);return this.pendingDocumentUpdates=ea,this.pendingDocumentTargetMapping=Sa(),this.pendingTargetResets=new Xo(Ur),e},Ia.prototype.addDocumentToTarget=function(e,t){var n;this.isActiveTarget(e)&&(n=this.targetContainsDocument(e,t.key)?2:0,this.ensureTargetState(e).addDocumentChange(t.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e)))},Ia.prototype.removeDocumentFromTarget=function(e,t,n){var r;this.isActiveTarget(e)&&(r=this.ensureTargetState(e),this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n)))},Ia.prototype.removeTarget=function(e){this.targetStates.delete(e)},Ia.prototype.getCurrentDocumentCountForTarget=function(e){var t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size},Ia.prototype.recordPendingTargetRequest=function(e){this.ensureTargetState(e).recordPendingTargetRequest()},Ia.prototype.ensureTargetState=function(e){var t=this.targetStates.get(e);return t||(t=new Ta,this.targetStates.set(e,t)),t},Ia.prototype.ensureDocumentTargetMapping=function(e){var t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Xo(Ur),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t},Ia.prototype.isActiveTarget=function(e){var t=null!==this.targetDataForActiveTarget(e);return t||Rr("WatchChangeAggregator","Detected inactive target",e),t},Ia.prototype.targetDataForActiveTarget=function(e){var t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)},Ia.prototype.resetTarget=function(t){var n=this;Fr(!this.targetStates.get(t).isPending,"Should only reset active targets"),this.targetStates.set(t,new Ta),this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(e){n.removeDocumentFromTarget(t,e,null)})},Ia.prototype.targetContainsDocument=function(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)},Ia);function Ia(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=ea,this.pendingDocumentTargetMapping=Sa(),this.pendingTargetResets=new Xo(Ur)}function Sa(){return new Ko(ui.comparator)}function Ca(){return new Ko(ui.comparator)}var Da={asc:"ASCENDING",desc:"DESCENDING"},Aa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};function ka(e,t){Fr(!Jr(e),t+" is missing")}var Na=function(e,t){this.databaseId=e,this.useProto3Json=t};function Ra(e){return{integerValue:""+e}}function Oa(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$r(t)?"-0":t}}function La(e,t){return"number"==typeof(n=t)&&Number.isInteger(n)&&!$r(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER?Ra(t):Oa(e,t);var n}function Pa(e,t){return e.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ma(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function xa(e){return xr(!!e,"Trying to deserialize version that isn't set"),Uo.fromTimestamp((e=_i(e),new zr(e.seconds,e.nanos)))}function Fa(e,t){return new ni(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Va(e){return xr($a(e=ni.fromString(e)),"Tried to deserialize invalid key "+e.toString()),e}function qa(e,t){return Fa(e.databaseId,t.path)}function Ba(e,t){if((t=Va(t)).get(1)!==e.databaseId.projectId)throw new Cr(Sr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+e.databaseId.projectId);if(t.get(3)!==e.databaseId.database)throw new Cr(Sr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+e.databaseId.database);return new ui(Ka(t))}function Ua(e,t){return Fa(e.databaseId,t)}function ja(e){return new ni(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ka(e){return xr(4<e.length&&"documents"===e.get(4),"tried to deserialize invalid key "+e.toString()),e.popFirst(5)}function za(e,t,n){return{name:qa(e,t),fields:n.proto.mapValue.fields}}function Ga(e,t){var n,r,i;if(t instanceof Ns)n={update:za(e,t.key,t.value)};else if(t instanceof js)n={delete:qa(e,t.key)};else if(t instanceof Ls)n={update:za(e,t.key,t.data),updateMask:(r=t.fieldMask,i=[],r.fields.forEach(function(e){return i.push(e.canonicalString())}),{fieldPaths:i})};else if(t instanceof Fs)n={transform:{document:qa(e,t.key),fieldTransforms:t.fieldTransforms.map(function(e){var t=e.transform;if(t instanceof ts)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof is)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof us)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof fs)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw Mr("Unknown transform: "+e.transform)})}};else{if(!(t instanceof Gs))return Mr("Unknown mutation type "+t.type);n={verify:qa(e,t.key)}}return t.precondition.isNone||(n.currentDocument=(Fr(!(t=t.precondition).isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:Pa(e,t.updateTime.toTimestamp())}:void 0!==t.exists?{exists:t.exists}:Mr("Unknown precondition"))),n}function Qa(e,t){var n={structuredQuery:{}},r=t.path;return null!==t.collectionGroup?(Fr(r.length%2==0,"Collection Group queries should be within a document path or root."),n.parent=Ua(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Fr(r.length%2!=0,"Document queries with filters are not supported."),n.parent=Ua(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),(r=function(e){if(0!==e.length)return 1!==(e=e.map(function(e){return Fr(e instanceof ho,"Only FieldFilters are supported"),function(e){if("=="===e.op){if(Oi(e.value))return{unaryFilter:{field:Xa(e.field),op:"IS_NAN"}};if(Ri(e.value))return{unaryFilter:{field:Xa(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Oi(e.value))return{unaryFilter:{field:Xa(e.field),op:"IS_NOT_NAN"}};if(Ri(e.value))return{unaryFilter:{field:Xa(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xa(e.field),op:(t=e.op,Aa[t]),value:e.value}};var t}(e)})).length?{compositeFilter:{op:"AND",filters:e}}:e[0]}(t.filters))&&(n.structuredQuery.where=r),(r=0!==(r=t.orderBy).length?r.map(function(e){return{field:Xa(e.field),direction:(e=e.dir,Da[e])}}):void 0)&&(n.structuredQuery.orderBy=r),r=e,e=t.limit,null!==(e=r.useProto3Json||Jr(e)?e:{value:e})&&(n.structuredQuery.limit=e),t.startAt&&(n.structuredQuery.startAt=Ha(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Ha(t.endAt)),n}function Wa(e){var t=4===(o=Va(o=e.parent)).length?ni.emptyPath():Ka(o),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(xr(1===r,"StructuredQuery.from with more than one collection is not supported."),(a=n.from[0]).allDescendants?i=a.collectionId:t=t.child(a.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Ja(e.unaryFilter.field);return ho.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=Ja(e.unaryFilter.field);return ho.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":return n=Ja(e.unaryFilter.field),ho.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return e=Ja(e.unaryFilter.field),ho.create(e,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Mr("Unspecified filter");default:return Mr("Unknown filter")}}(t)]:void 0!==t.fieldFilter?[(n=t,ho.create(Ja(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Mr("Unspecified operator");default:return Mr("Unknown operator")}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(e).reduce(function(e,t){return e.concat(t)}):Mr("Unknown filter: "+JSON.stringify(t)):[];var n}(n.where)),e=[],n.orderBy&&(e=n.orderBy.map(function(e){return new Bo(Ja(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())})),r=null,n.limit&&(r=Jr(s="object"==typeof(s=n.limit)?s.value:s)?null:s);var a=null;n.startAt&&(a=Ya(n.startAt));var s=null;return n.endAt&&(s=Ya(n.endAt)),new Hi(t,i,e,o,r,"F",a,s)}function Ha(e){return{before:e.before,values:e.position}}function Ya(e){var t=!!e.before,e=e.values||[];return new xo(e,t)}function Xa(e){return{fieldPath:e.canonicalString()}}function Ja(e){return ai.fromServerFormat(e.fieldPath)}function $a(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function Za(e,t){return e instanceof fs?Ai(t)?t:{integerValue:0}:null}var es,ts=(n(ns,es=vt=function(){this._=void 0}),ns);function ns(){return null!==es&&es.apply(this,arguments)||this}var rs,is=(n(os,rs=vt),os);function os(e){var t=rs.call(this)||this;return t.elements=e,t}function as(e,t){for(var n=ys(t),r=0,i=e.elements;r<i.length;r++)!function(t){n.some(function(e){return vi(e,t)})||n.push(t)}(i[r]);return{arrayValue:{values:n}}}var ss,us=(n(cs,ss=vt),cs);function cs(e){var t=ss.call(this)||this;return t.elements=e,t}function ls(e,t){for(var n=ys(t),r=0,i=e.elements;r<i.length;r++)!function(t){n=n.filter(function(e){return!vi(e,t)})}(i[r]);return{arrayValue:{values:n}}}var hs,fs=(n(ds,hs=vt),ds);function ds(e,t){var n=hs.call(this)||this;return n.serializer=e,Fr(Ai(n.operand=t),"NumericIncrementTransform transform requires a NumberValue"),n}function ps(e){return Ii(e.integerValue||e.doubleValue)}function ys(e){return ki(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var gs=(ms.prototype.covers=function(e){for(var t=0,n=this.fields;t<n.length;t++)if(n[t].isPrefixOf(e))return!0;return!1},ms.prototype.isEqual=function(e){return jr(this.fields,e.fields,function(e,t){return e.isEqual(t)})},ms);function ms(n){(this.fields=n).sort(ai.comparator),Fr(!n.some(function(e,t){return 0!==t&&e.isEqual(n[t-1])}),"FieldMask contains field that is not unique: "+n.find(function(e,t){return 0!==t&&e.isEqual(n[t-1])}))}function vs(e,t){this.field=e,this.transform=t}function ws(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof is&&t instanceof is||e instanceof us&&t instanceof us?jr(e.elements,t.elements,vi):e instanceof fs&&t instanceof fs?vi(e.operand,t.operand):e instanceof ts&&t instanceof ts)}function bs(e,t){this.version=e,this.transformResults=t}var Ts=(Es.none=function(){return new Es},Es.exists=function(e){return new Es(void 0,e)},Es.updateTime=function(e){return new Es(e)},Object.defineProperty(Es.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Es.prototype.isEqual=function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)},Es);function Es(e,t){this.updateTime=e,this.exists=t,Fr(void 0===e||void 0===t,'Precondition can specify "exists" or "updateTime" but not both')}function _s(e,t){return void 0!==e.updateTime?t instanceof Mi&&t.version.isEqual(e.updateTime):void 0!==e.exists?e.exists===t instanceof Mi:(Fr(e.isNone,"Precondition should be empty"),1)}function Is(e,t,n){return Ds(e,t),e instanceof Ns?(i=e,Fr(null==(o=n).transformResults,"Transform results received by SetMutation."),new Mi(i.key,o.version,i.value,{hasCommittedMutations:!0})):e instanceof Ls?(r=e,o=t,Fr(null==(i=n).transformResults,"Transform results received by PatchMutation."),_s(r.precondition,o)?(o=Ms(r,o),new Mi(r.key,i.version,o,{hasCommittedMutations:!0})):new Ui(r.key,i.version)):e instanceof Fs?function(e,t,n){if(xr(null!=n.transformResults,"Transform results missing for TransformMutation."),!_s(e.precondition,t))return new Ui(e.key,n.version);var r=qs(e,t),t=function(e,t,n){var r=[];xr(e.length===n.length,"server transform result count ("+n.length+") should match field transform count ("+e.length+")");for(var i=0;i<n.length;i++){var o=e[i],a=o.transform,s=null;t instanceof Mi&&(s=t.field(o.field)),r.push((o=a,a=s,s=n[i],o instanceof is?as(o,a):o instanceof us?ls(o,a):(Fr(null!==s,"Didn't receive transformResult for non-array transform"),s)))}return r}(e.fieldTransforms,t,n.transformResults),n=n.version,t=Bs(e,r.data(),t);return new Mi(e.key,n,t,{hasCommittedMutations:!0})}(e,t,n):(Fr(e instanceof js,"Unexpected mutation type: "+e),Fr(null==n.transformResults,"Transform results received by DeleteMutation."),new Vi(e.key,n.version,{hasCommittedMutations:!0}));var r,i,o}function Ss(e,t,n,r){return Ds(e,t),e instanceof Ns?(o=t,_s((i=e).precondition,o)?(o=As(o),new Mi(i.key,o,i.value,{hasLocalMutations:!0})):o):e instanceof Ls?function(e,t){if(!_s(e.precondition,t))return t;var n=As(t),t=Ms(e,t);return new Mi(e.key,n,t,{hasLocalMutations:!0})}(e,t):e instanceof Fs?function(e,t,n,r){if(!_s(e.precondition,t))return t;var i=qs(e,t),r=function(e,t,n,r){for(var i,o,a=[],s=0,u=e;s<u.length;s++){var c=u[s],l=c.transform,h=null;n instanceof Mi&&(h=n.field(c.field)),null===h&&r instanceof Mi&&(h=r.field(c.field)),a.push((i=h,o=t,h=c=void 0,(l=l)instanceof ts?(c=o,o=i,h={fields:((h={})[hi]={stringValue:li},h[di]={timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}},h)},o&&(h.fields[fi]=o),{mapValue:h}):l instanceof is?as(l,i):l instanceof us?ls(l,i):(Fr(l instanceof fs,"Expected NumericIncrementTransformOperation but was: "+l),l=ps(i=Za(h=l,l=i))+ps(h.operand),Di(i)&&Di(h.operand)?Ra(l):Oa(h.serializer,l))))}return a}(e.fieldTransforms,n,t,r),r=Bs(e,i.data(),r);return new Mi(e.key,i.version,r,{hasLocalMutations:!0})}(e,t,r,n):(Fr(e instanceof js,"Unexpected mutation type: "+e),t=t,_s((e=e).precondition,t)?(t&&Fr(t.key.isEqual(e.key),"Can only apply mutation to document with same key"),new Vi(e.key,Uo.min())):t);var i,o}function Cs(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(0===e.type?e.value.isEqual(t.value):1===e.type?e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask):2!==e.type||jr(e.fieldTransforms,e.fieldTransforms,ws))}function Ds(e,t){null!=t&&Fr(t.key.isEqual(e.key),"Can only apply a mutation to a document with the same key")}function As(e){return e instanceof Mi?e.version:Uo.min()}var ks,Ns=(n(Rs,ks=h=function(){}),Rs);function Rs(e,t,n){var r=ks.call(this)||this;return r.key=e,r.value=t,r.precondition=n,r.type=0,r}var Os,Ls=(n(Ps,Os=h),Ps);function Ps(e,t,n,r){var i=Os.call(this)||this;return i.key=e,i.data=t,i.fieldMask=n,i.precondition=r,i.type=1,i}function Ms(e,t){var t=t instanceof Mi?t.data():aa.empty(),n=e,r=new ua(t);return n.fieldMask.fields.forEach(function(e){var t;e.isEmpty()||(null!==(t=n.data.field(e))?r.set(e,t):r.delete(e))}),r.build()}var xs,Fs=(n(Vs,xs=h),Vs);function Vs(e,t){var n=xs.call(this)||this;return n.key=e,n.fieldTransforms=t,n.type=2,n.precondition=Ts.exists(!0),n}function qs(e,t){return Fr(t instanceof Mi,"Unknown MaybeDocument type "+t),Fr(t.key.isEqual(e.key),"Can only transform a document with the same key"),t}function Bs(e,t,n){Fr(n.length===e.fieldTransforms.length,"TransformResults length mismatch.");for(var r=new ua(t),i=0;i<e.fieldTransforms.length;i++){var o=e.fieldTransforms[i];r.set(o.field,n[i])}return r.build()}var Us,js=(n(Ks,Us=h),Ks);function Ks(e,t){var n=Us.call(this)||this;return n.key=e,n.precondition=t,n.type=3,n}var zs,Gs=(n(Qs,zs=h),Qs);function Qs(e,t){var n=zs.call(this)||this;return n.key=e,n.precondition=t,n.type=4,n}var Ws=-1,Hs=(Ys.prototype.applyToRemoteDocument=function(e,t,n){t&&Fr(t.key.isEqual(e),"applyToRemoteDocument: key "+e+" should match maybeDoc key\n        "+t.key);var r=n.mutationResults;Fr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(e)&&(t=Is(o,t,r[i]))}return t},Ys.prototype.applyToLocalView=function(e,t){t&&Fr(t.key.isEqual(e),"applyToLocalDocument: key "+e+" should match maybeDoc key\n        "+t.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(i=r[n]).key.isEqual(e)&&(t=Ss(i,t,t,this.localWriteTime));for(var i,o=t,a=0,s=this.mutations;a<s.length;a++)(i=s[a]).key.isEqual(e)&&(t=Ss(i,t,o,this.localWriteTime));return t},Ys.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(e){var t=r.applyToLocalView(e.key,n.get(e.key));t&&(i=i.insert(e.key,t))}),i},Ys.prototype.keys=function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},ia())},Ys.prototype.isEqual=function(e){return this.batchId===e.batchId&&jr(this.mutations,e.mutations,Cs)&&jr(this.baseMutations,e.baseMutations,Cs)},Ys);function Ys(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,Fr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Xs=(Js.from=function(e,t,n){xr(e.mutations.length===n.length,"Mutations sent "+e.mutations.length+" must equal results received "+n.length);for(var r=na,i=e.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Js(e,t,n,r)},Js);function Js(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}var $s=(Zs.prototype.get=function(e){var t=this.mapKeyFn(e);if(void 0!==(t=this.inner[t]))for(var n=0,r=t;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.equalsFn(i,e))return o}},Zs.prototype.has=function(e){return void 0!==this.get(e)},Zs.prototype.set=function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]},Zs.prototype.delete=function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1},Zs.prototype.forEach=function(a){Wr(this.inner,function(e,t){for(var n=0,r=t;n<r.length;n++){var i=(o=r[n])[0],o=o[1];a(i,o)}})},Zs.prototype.isEmpty=function(){return Hr(this.inner)},Zs);function Zs(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}var eu=(tu.prototype.catch=function(e){return this.next(void 0,e)},tu.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Mr("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new tu(function(t,n){o.nextCallback=function(e){o.wrapSuccess(r,e).next(t,n)},o.catchCallback=function(e){o.wrapFailure(i,e).next(t,n)}})},tu.prototype.toPromise=function(){var n=this;return new Promise(function(e,t){n.next(e,t)})},tu.prototype.wrapUserFunction=function(e){try{var t=e();return t instanceof tu?t:tu.resolve(t)}catch(e){return tu.reject(e)}},tu.prototype.wrapSuccess=function(e,t){return e?this.wrapUserFunction(function(){return e(t)}):tu.resolve(t)},tu.prototype.wrapFailure=function(e,t){return e?this.wrapUserFunction(function(){return e(t)}):tu.reject(t)},tu.resolve=function(n){return new tu(function(e,t){e(n)})},tu.reject=function(n){return new tu(function(e,t){t(n)})},tu.waitFor=function(e){return new tu(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(e){return n(e)})}),o=!0,i===r&&t()})},tu.or=function(e){for(var n=tu.resolve(!1),t=0,r=e;t<r.length;t++)!function(t){n=n.next(function(e){return e?tu.resolve(e):t()})}(r[t]);return n},tu.forEach=function(e,n){var r=this,i=[];return e.forEach(function(e,t){i.push(n.call(r,e,t))}),this.waitFor(i)},tu);function tu(e){var t=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(e){t.isDone=!0,t.result=e,t.nextCallback&&t.nextCallback(e)},function(e){t.isDone=!0,t.error=e,t.catchCallback&&t.catchCallback(e)})}var nu=(ru.prototype.getDocument=function(t,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,n).next(function(e){return r.getDocumentInternal(t,n,e)})},ru.prototype.getDocumentInternal=function(e,r,i){return this.remoteDocumentCache.getEntry(e,r).next(function(e){for(var t=0,n=i;t<n.length;t++)e=n[t].applyToLocalView(r,e);return e})},ru.prototype.applyLocalMutationsToDocuments=function(e,t,i){var o=ea;return t.forEach(function(e,t){for(var n=0,r=i;n<r.length;n++)t=r[n].applyToLocalView(e,t);o=o.insert(e,t)}),o},ru.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},ru.prototype.getLocalViewOfDocuments=function(t,r){var i=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,r).next(function(e){var e=i.applyLocalMutationsToDocuments(t,r,e),n=ea;return e.forEach(function(e,t){t=t||new Vi(e,Uo.min()),n=n.insert(e,t)}),n})},ru.prototype.getDocumentsMatchingQuery=function(e,t,n){return eo(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):to(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)},ru.prototype.getDocumentsMatchingDocumentQuery=function(e,t){return this.getDocument(e,new ui(t)).next(function(e){var t=ta;return e instanceof Mi&&(t=t.insert(e.key,e)),t})},ru.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;Fr(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=ta;return this.indexManager.getCollectionParents(n,a).next(function(e){return eu.forEach(e,function(e){var t=(t=r,e=e.child(a),new Hi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return o.getDocumentsMatchingCollectionQuery(n,t,i).next(function(e){e.forEach(function(e,t){s=s.insert(e,t)})})}).next(function(){return s})})},ru.prototype.getDocumentsMatchingCollectionQuery=function(t,n,e){var u,c,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,e).next(function(e){return u=e,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,n)}).next(function(e){return c=e,r.addMissingBaseDocuments(t,c,u).next(function(e){u=e;for(var t=0,n=c;t<n.length;t++)for(var r=n[t],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,a=Ss(a,a=u.get(s),a,r.localWriteTime);u=a instanceof Mi?u.insert(s,a):u.remove(s)}})}).next(function(){return u.forEach(function(e,t){uo(n,t)||(u=u.remove(e))}),u})},ru.prototype.addMissingBaseDocuments=function(e,t,n){for(var r=ia(),i=0,o=t;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Ls&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(e,r).next(function(e){return e.forEach(function(e,t){null!==t&&t instanceof Mi&&(c=c.insert(e,t))}),c})},ru);function ru(e,t,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.indexManager=n}var iu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",mt=(ou.prototype.addOnCommittedListener=function(e){this.onCommittedListeners.push(e)},ou.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(e){return e()})},ou);function ou(){this.onCommittedListeners=[]}var au=(su.prototype.withSequenceNumber=function(e){return new su(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},su.prototype.withResumeToken=function(e,t){return new su(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)},su.prototype.withLastLimboFreeSnapshotVersion=function(e){return new su(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},su);function su(e,t,n,r,i,o,a){void 0===i&&(i=Uo.min()),void 0===o&&(o=Uo.min()),void 0===a&&(a=Yr.EMPTY_BYTE_STRING),this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var uu=(cu.prototype.setPreviousValue=function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue},cu.prototype.next=function(){var e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e},cu);function cu(e,t){var n=this;this.previousValue=e,t&&(t.sequenceNumberHandler=function(e){return n.setPreviousValue(e)},this.writeNewSequenceNumber=function(e){return t.writeSequenceNumber(e)})}uu.INVALID=-1;function lu(e){this.remoteSerializer=e}function hu(){this.changes=new $s(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}hu.prototype.getReadTime=function(e){var t=this.changes.get(e);return t?(Fr(!!t.readTime,"Read time is not set for "+e+". All removeEntry() calls must include a readTime if 'trackRemovals' is used."),t.readTime):Uo.min()},hu.prototype.addEntry=function(e,t){this.assertNotApplied(),this.changes.set(e.key,{maybeDocument:e,readTime:t})},hu.prototype.removeEntry=function(e,t){void 0===t&&(t=null),this.assertNotApplied(),this.changes.set(e,{maybeDocument:null,readTime:t})},hu.prototype.getEntry=function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?eu.resolve(n.maybeDocument):this.getFromCache(e,t)},hu.prototype.getEntries=function(e,t){return this.getAllFromCache(e,t)},hu.prototype.apply=function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)},hu.prototype.assertNotApplied=function(){Fr(!this.changesApplied,"Changes have already been applied.")},vt=hu;var fu=(du.prototype.addToCollectionParentIndex=function(e,t){return this.collectionParentIndex.add(t),eu.resolve()},du.prototype.getCollectionParents=function(e,t){return eu.resolve(this.collectionParentIndex.getEntries(t))},du);function du(){this.collectionParentIndex=new pu}var pu=(yu.prototype.add=function(e){Fr(e.length%2==1,"Expected a collection path.");var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Xo(ni.comparator),e=!r.has(n);return this.index[t]=r.add(n),e},yu.prototype.has=function(e){var t=e.lastSegment(),e=e.popLast();return(t=this.index[t])&&t.has(e)},yu.prototype.getEntries=function(e){return(this.index[e]||new Xo(ni.comparator)).toArray()},yu);function yu(){this.index={}}var gu=function(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})};function mu(e){return"IndexedDbTransactionError"===e.name}var vu=(wu.prototype.next=function(){return this.lastId+=2,this.lastId},wu.forTargetCache=function(){return new wu(0)},wu.forSyncEngine=function(){return new wu(-1)},wu);function wu(e){this.lastId=e}var bu="LocalStore",Tu=3e8,Eu=(_u.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(e){return t.collect(e,n.targetDataByTarget)})},_u);function _u(e,t,n,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new Ko(Ur),this.targetIdByTarget=new $s(Gi,Qi),this.lastDocumentChangeReadTime=Uo.min(),Fr(e.started,"LocalStore was passed an unstarted persistence implementation"),this.mutationQueue=e.getMutationQueue(n),this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.localDocuments=new nu(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.bundleCache=e.getBundleCache(),this.queryEngine.setLocalDocumentsView(this.localDocuments)}function Iu(i,o){return f(this,void 0,void 0,function(){var t,n,g,r;return d(this,function(e){switch(e.label){case 0:return t=Vr(i,Eu),n=t.mutationQueue,g=t.localDocuments,[4,t.persistence.runTransaction("Handle user change","readonly",function(p){var y;return t.mutationQueue.getAllMutationBatches(p).next(function(e){return y=e,n=t.persistence.getMutationQueue(o),g=new nu(t.remoteDocuments,n,t.persistence.getIndexManager()),n.getAllMutationBatches(p)}).next(function(e){for(var t=[],n=[],r=ia(),i=0,o=y;i<o.length;i++){var a=o[i];t.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++)var c=u[s],r=r.add(c.key)}for(var l=0,h=e;l<h.length;l++){a=h[l],n.push(a.batchId);for(var f=0,d=a.mutations;f<d.length;f++)c=d[f],r=r.add(c.key)}return g.getDocuments(p,r).next(function(e){return{affectedDocuments:e,removedBatchIds:t,addedBatchIds:n}})})})];case 1:return r=e.sent(),t.mutationQueue=n,t.localDocuments=g,t.queryEngine.setLocalDocumentsView(t.localDocuments),[2,r]}})})}function Su(e,u){var c,l=Vr(e,Eu),h=zr.now(),t=u.reduce(function(e,t){return e.add(t.key)},ia());return l.persistence.runTransaction("Locally write mutations","readwrite",function(s){return l.localDocuments.getDocuments(s,t).next(function(e){c=e;for(var a,t=[],n=0,r=u;n<r.length;n++){var i=r[n],o=(a=i,o=c.get(i.key),a instanceof Fs?function(e){for(var t=null,n=0,r=a.fieldTransforms;n<r.length;n++){var i=r[n],o=e instanceof Mi?e.field(i.field):void 0;null!=(o=Za(i.transform,o||null))&&(t=(null==t?new ua:t).set(i.field,o))}return t?t.build():null}(o):null);null!=o&&t.push(new Ls(i.key,o,function a(e){var s=[];return Wr(e.fields||{},function(e,t){var n=new ai([e]);if(Li(t))if(0===(t=a(t.mapValue).fields).length)s.push(n);else for(var r=0,i=t;r<i.length;r++){var o=i[r];s.push(n.child(o))}else s.push(n)}),new gs(s)}(o.proto.mapValue),Ts.exists(!0)))}return l.mutationQueue.addMutationBatch(s,h,t,u)})}).then(function(e){var t=e.applyToLocalDocumentSet(c);return{batchId:e.batchId,changes:t}})}function Cu(e){var t=Vr(e,Eu);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)})}function Du(e,o){var l=Vr(e,Eu),h=o.snapshotVersion,f=l.targetDataByTarget;return l.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var e=l.remoteDocuments.newChangeBuffer({trackRemovals:!0});f=l.targetDataByTarget;var s=[];o.targetChanges.forEach(function(e,t){var n,r,i,o=f.get(t);o&&(s.push(l.targetCache.removeMatchingKeys(a,e.removedDocuments,t).next(function(){return l.targetCache.addMatchingKeys(a,e.addedDocuments,t)})),0<(n=e.resumeToken).approximateByteSize()&&(n=o.withResumeToken(n,h).withSequenceNumber(a.currentSequenceNumber),f=f.insert(t,n),r=o,i=e,xr(0<(o=n).resumeToken.approximateByteSize(),"Attempted to persist target data with no resume token"),0!==r.resumeToken.approximateByteSize()&&!(o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()>=Tu||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)||s.push(l.targetCache.updateTargetData(a,n))))});var u,t,c,n,r,i=ea;return o.documentUpdates.forEach(function(e,t){o.resolvedLimboDocuments.has(e)&&s.push(l.persistence.referenceDelegate.updateLimboDocument(a,e))}),s.push((r=a,u=e,t=o.documentUpdates,c=h,n=ia(),t.forEach(function(e){return n=n.add(e)}),u.getEntries(r,n).next(function(i){var o=ea;return t.forEach(function(e,t){var n=i.get(e),r=c;t instanceof Vi&&t.version.isEqual(Uo.min())?(u.removeEntry(e,r),o=o.insert(e,t)):null==n||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(Fr(!Uo.min().isEqual(r),"Cannot add a document when the remote version is zero"),u.addEntry(t,r),o=o.insert(e,t)):Rr(bu,"Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),o}).next(function(e){i=e}))),h.isEqual(Uo.min())||(r=l.targetCache.getLastRemoteSnapshotVersion(a).next(function(e){return Fr(0<=h.compareTo(e),"Watch stream reverted to previous snapshot?? "+h+" < "+e),l.targetCache.setTargetsMetadata(a,a.currentSequenceNumber,h)}),s.push(r)),eu.waitFor(s).next(function(){return e.apply(a)}).next(function(){return l.localDocuments.getLocalViewOfDocuments(a,i)})}).then(function(e){return l.targetDataByTarget=f,e})}function Au(i,o,a){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:t=Vr(i,Eu),Fr(null!==(n=t.targetDataByTarget.get(o)),"Tried to release nonexistent target: "+o),r=a?"readwrite":"readwrite-primary",e.label=1;case 1:return e.trys.push([1,4,,5]),a?[3,3]:[4,t.persistence.runTransaction("Release target",r,function(e){return t.persistence.referenceDelegate.removeTarget(e,n)})];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if(!mu(r=e.sent()))throw r;return Rr(bu,"Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return t.targetDataByTarget=t.targetDataByTarget.remove(o),t.targetIdByTarget.delete(n.target),[2]}})})}function ku(e,o,a){var s=Vr(e,Eu),u=Uo.min(),c=ia();return s.persistence.runTransaction("Execute query","readonly",function(t){return e=s,n=t,r=ro(o),(void 0!==(e=(i=Vr(e,Eu)).targetIdByTarget.get(r))?eu.resolve(i.targetDataByTarget.get(e)):i.targetCache.getTargetData(n,r)).next(function(e){if(e)return u=e.lastLimboFreeSnapshotVersion,s.targetCache.getMatchingKeysForTargetId(t,e.targetId).next(function(e){c=e})}).next(function(){return s.queryEngine.getDocumentsMatchingQuery(t,o,a?u:Uo.min(),a?c:ia())}).next(function(e){return{documents:e,remoteKeys:c}});var e,n,r,i})}function Nu(t){return f(this,void 0,void 0,function(){return d(this,function(e){if(t.code!==Sr.FAILED_PRECONDITION||t.message!==iu)throw t;return Rr(bu,"Unexpectedly lost primary lease"),[2]})})}var Ru=(Ou.prototype.reset=function(){this.currentBaseMs=0},Ou.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},Ou.prototype.backoffAndRun=function(e){var t=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<i&&Rr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return t.lastAttemptTime=Date.now(),e()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},Ou.prototype.skipBackoff=function(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)},Ou.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},Ou.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},Ou);function Ou(e,t,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=e,this.timerId=t,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var Lu="PersistentStream",h=(Pu.prototype.isStarted=function(){return 1===this.state||2===this.state||4===this.state},Pu.prototype.isOpen=function(){return 2===this.state},Pu.prototype.start=function(){3!==this.state?(Fr(0===this.state,"Already started"),this.auth()):this.performBackoff()},Pu.prototype.stop=function(){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.isStarted()?[4,this.close(0)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Pu.prototype.inhibitBackoff=function(){Fr(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=0,this.backoff.reset()},Pu.prototype.markIdle=function(){var e=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return e.handleIdleCloseTimer()}))},Pu.prototype.sendRequest=function(e){this.cancelIdleCheck(),this.stream.send(e)},Pu.prototype.handleIdleCloseTimer=function(){return f(this,void 0,void 0,function(){return d(this,function(e){return this.isOpen()?[2,this.close(0)]:[2]})})},Pu.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},Pu.prototype.close=function(t,n){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return Fr(this.isStarted(),"Only started streams should be closed."),Fr(3===t||Jr(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,3!==t?this.backoff.reset():n&&n.code===Sr.RESOURCE_EXHAUSTED?(Or(n.toString()),Or("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Sr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(n)];case 1:return e.sent(),[2]}})})},Pu.prototype.tearDown=function(){},Pu.prototype.auth=function(){var n=this;Fr(0===this.state,"Must be in initial state to auth"),this.state=1;var e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;this.credentialsProvider.getToken().then(function(e){n.closeCount===t&&n.startStream(e)},function(t){e(function(){var e=new Cr(Sr.UNKNOWN,"Fetching auth token failed: "+t.message);return n.handleStreamClose(e)})})},Pu.prototype.startStream=function(e){var t=this;Fr(1===this.state,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e),this.stream.onOpen(function(){n(function(){return Fr(1===t.state,"Expected stream to be in state Starting, but was "+t.state),t.state=2,t.listener.onOpen()})}),this.stream.onClose(function(e){n(function(){return t.handleStreamClose(e)})}),this.stream.onMessage(function(e){n(function(){return t.onMessage(e)})})},Pu.prototype.performBackoff=function(){var e=this;Fr(3===this.state,"Should only perform backoff when in Error state"),this.state=4,this.backoff.backoffAndRun(function(){return f(e,void 0,void 0,function(){return d(this,function(e){return Fr(4===this.state,"Backoff elapsed but state is now: "+this.state),this.state=0,this.start(),Fr(this.isStarted(),"PersistentStream should have started"),[2]})})})},Pu.prototype.handleStreamClose=function(e){return Fr(this.isStarted(),"Can't handle server close on non-started stream"),Rr(Lu,"close with error: "+e),this.stream=null,this.close(3,e)},Pu.prototype.getCloseGuardedDispatcher=function(t){var n=this;return function(e){n.queue.enqueueAndForget(function(){return n.closeCount===t?e():(Rr(Lu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Pu);function Pu(e,t,n,r,i,o){this.queue=e,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Ru(e,t)}var Mu,xu=(n(Fu,Mu=h),Fu.prototype.startRpc=function(e){return this.connection.openStream("Listen",e)},Fu.prototype.onMessage=function(e){this.backoff.reset();var t=function(e,t){if("targetChange"in t){ka(t.targetChange,"targetChange");var n="NO_CHANGE"===(o=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Mr("Got unexpected TargetChange.state: "+o),r=t.targetChange.targetIds||[],i=(i=e,o=t.targetChange.resumeToken,i.useProto3Json?(xr(void 0===o||"string"==typeof o,"value must be undefined or a string when using proto3 Json"),Yr.fromBase64String(o||"")):(xr(void 0===o||o instanceof Uint8Array,"value must be undefined or Uint8Array"),Yr.fromUint8Array(o||new Uint8Array))),o=t.targetChange.cause,a=o&&(o=void 0===(a=o).code?Sr.UNKNOWN:da(a.code),new Cr(o,a.message||"")),i=new ba(n,r,i,a||null)}else if("documentChange"in t){ka(t.documentChange,"documentChange"),ka((c=t.documentChange).document,"documentChange.name"),ka(c.document.name,"documentChange.document.name"),ka(c.document.updateTime,"documentChange.document.updateTime");var s=Ba(e,c.document.name),u=xa(c.document.updateTime),a=new aa({mapValue:{fields:c.document.fields}}),u=new Mi(s,u,a,{}),a=c.targetIds||[],c=c.removedTargetIds||[];i=new va(a,c,u.key,u)}else if("documentDelete"in t){ka(t.documentDelete,"documentDelete"),ka((u=t.documentDelete).document,"documentDelete.document");var s=Ba(e,u.document),l=u.readTime?xa(u.readTime):Uo.min(),l=new Vi(s,l),c=u.removedTargetIds||[];i=new va([],c,l.key,l)}else if("documentRemove"in t)ka(t.documentRemove,"documentRemove"),ka((l=t.documentRemove).document,"documentRemove"),s=Ba(e,l.document),c=l.removedTargetIds||[],i=new va([],c,s,null);else{if(!("filter"in t))return Mr("Unknown change type "+JSON.stringify(t));ka(t.filter,"filter"),ka((s=t.filter).targetId,"filter.targetId"),t=s.count||0,t=new la(t),s=s.targetId,i=new wa(s,t)}return i}(this.serializer,e),e="targetChange"in e&&(!(e=e.targetChange).targetIds||!e.targetIds.length)&&e.readTime?xa(e.readTime):Uo.min();return this.listener.onWatchChange(t,e)},Fu.prototype.watch=function(e){var t,n,r,i={};i.database=ja(this.serializer),i.addTarget=(t=this.serializer,(r=Wi(r=(n=e).target)?{documents:{documents:[Ua(t,r.path)]}}:{query:Qa(t,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=Ma(t,n.resumeToken):0<n.snapshotVersion.compareTo(Uo.min())&&(r.readTime=Pa(t,n.snapshotVersion.toTimestamp())),r),this.serializer,(e=null==(r=function(e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Mr("Unrecognized query purpose: "+e)}}((r=e).purpose))?null:{"goog-listen-tags":r})&&(i.labels=e),this.sendRequest(i)},Fu.prototype.unwatch=function(e){var t={};t.database=ja(this.serializer),t.removeTarget=e,this.sendRequest(t)},Fu);function Fu(e,t,n,r,i){return(i=Mu.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",t,n,i)||this).serializer=r,i}var Vu,qu=(n(Bu,Vu=h),Object.defineProperty(Bu.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!1,configurable:!0}),Bu.prototype.start=function(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,Vu.prototype.start.call(this)},Bu.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},Bu.prototype.startRpc=function(e){return this.connection.openStream("Write",e)},Bu.prototype.onMessage=function(e){if(xr(!!e.streamToken,"Got a write response without a stream token"),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();var t=(n=e.writeResults,r=e.commitTime,n&&0<n.length?(xr(void 0!==r,"Received a write result without a commit time"),n.map(function(e){return n=r,(e=(t=e).updateTime?xa(t.updateTime):xa(n)).isEqual(Uo.min())&&(e=xa(n)),n=null,t.transformResults&&0<t.transformResults.length&&(n=t.transformResults),new bs(e,n);var t,n})):[]),n=xa(e.commitTime);return this.listener.onMutationResult(n,t)}var n,r;return xr(!e.writeResults||0===e.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},Bu.prototype.writeHandshake=function(){Fr(this.isOpen(),"Writing handshake requires an opened stream"),Fr(!this.handshakeComplete_,"Handshake already completed"),Fr(!this.lastStreamToken,"Stream token should be empty during handshake");var e={};e.database=ja(this.serializer),this.sendRequest(e)},Bu.prototype.writeMutations=function(e){var t=this;Fr(this.isOpen(),"Writing mutations requires an opened stream"),Fr(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Fr(!!this.lastStreamToken,"Trying to write mutation without a token"),e={streamToken:this.lastStreamToken,writes:e.map(function(e){return Ga(t.serializer,e)})},this.sendRequest(e)},Bu);function Bu(e,t,n,r,i){return(i=Vu.call(this,e,"write_stream_connection_backoff","write_stream_idle",t,n,i)||this).serializer=r,i.handshakeComplete_=!1,i}var Uu,ju=(n(Ku,Uu=function(){}),Ku.prototype.verifyInitialized=function(){if(Fr(!!this.connection,"Datastore.start() not called"),this.terminated)throw new Cr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},Ku.prototype.invokeRPC=function(t,n,r){var i=this;return this.verifyInitialized(),this.credentials.getToken().then(function(e){return i.connection.invokeRPC(t,n,r,e)}).catch(function(e){throw e.code===Sr.UNAUTHENTICATED&&i.credentials.invalidateToken(),e})},Ku.prototype.invokeStreamingRPC=function(t,n,r){var i=this;return this.verifyInitialized(),this.credentials.getToken().then(function(e){return i.connection.invokeStreamingRPC(t,n,r,e)}).catch(function(e){throw e.code===Sr.UNAUTHENTICATED&&i.credentials.invalidateToken(),e})},Ku.prototype.terminate=function(){this.terminated=!1},Ku);function Ku(e,t,n){var r=Uu.call(this)||this;return r.credentials=e,r.connection=t,r.serializer=n,r.terminated=!1,r}var zu=(Gu.prototype.handleWatchStreamStart=function(){var e=this;0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),Fr(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return e.onlineStateTimer=null,Fr("Unknown"===e.state,"Timer should be canceled if we transitioned to a different state."),e.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),e.setAndBroadcast("Offline"),Promise.resolve()}))},Gu.prototype.handleWatchStreamFailure=function(e){"Online"===this.state?(this.setAndBroadcast("Unknown"),Fr(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Fr(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+e.toString()),this.setAndBroadcast("Offline")))},Gu.prototype.set=function(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)},Gu.prototype.setAndBroadcast=function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))},Gu.prototype.logClientOfflineWarningIfNecessary=function(e){e="Could not reach Cloud Firestore backend. "+e+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.shouldWarnClientIsOffline?(Or(e),this.shouldWarnClientIsOffline=!1):Rr("OnlineStateTracker",e)},Gu.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},Gu);function Gu(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}var Qu="RemoteStore",Wu=10,Hu=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(e){n.enqueueAndForget(function(){return f(o,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return rc(this)?(Rr(Qu,"Restarting streams for network reachability change."),[4,function(n){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return(t=Vr(n,Hu)).offlineCauses.add(4),[4,Xu(t)];case 1:return e.sent(),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),[4,Yu(t)];case 2:return e.sent(),[2]}})})}(this)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new zu(n,r)};function Yu(r){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:if(!rc(r))return[3,4];t=0,n=r.onNetworkStatusChange,e.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function Xu(r){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:t=0,n=r.onNetworkStatusChange,e.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function Ju(e,t){(e=Vr(e,Hu)).listenTargets.has(t.targetId)||(e.listenTargets.set(t.targetId,t),nc(e)?tc(e):hc(e).isOpen()&&Zu(e,t))}function $u(e,t){var n=Vr(e,Hu),e=hc(n);Fr(n.listenTargets.has(t),"unlisten called on target no currently watched: "+t),n.listenTargets.delete(t),e.isOpen()&&ec(n,t),0===n.listenTargets.size&&(e.isOpen()?e.markIdle():rc(n)&&n.onlineStateTracker.set("Unknown"))}function Zu(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),hc(e).watch(t)}function ec(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),hc(e).unwatch(t)}function tc(t){Fr(nc(t),"startWatchStream() called when shouldStartWatchStream() is false."),Fr(!!t.remoteSyncer.getRemoteKeysForTarget,"getRemoteKeysForTarget() not set"),t.watchChangeAggregator=new _a({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},getTargetDataForTarget:function(e){return t.listenTargets.get(e)||null}}),hc(t).start(),t.onlineStateTracker.handleWatchStreamStart()}function nc(e){return rc(e)&&!hc(e).isStarted()&&0<e.listenTargets.size}function rc(e){return 0===Vr(e,Hu).offlineCauses.size}function ic(e){e.watchChangeAggregator=void 0}function oc(n,r,i){return f(this,void 0,void 0,function(){var t=this;return d(this,function(e){switch(e.label){case 0:return mu(r)?(Fr(!n.offlineCauses.has(1),"Unexpected network event when IndexedDB was marked failed."),n.offlineCauses.add(1),[4,Xu(n)]):[3,2];case 1:return e.sent(),n.onlineStateTracker.set("Offline"),i=i||function(){return Cu(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return f(t,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return Rr(Qu,"Retrying IndexedDB access"),[4,i()];case 1:return e.sent(),n.offlineCauses.delete(1),[4,Yu(n)];case 2:return e.sent(),[2]}})})}),[3,3];case 2:throw r;case 3:return[2]}})})}function ac(t,n){return n().catch(function(e){return oc(t,e,n)})}function sc(c){return f(this,void 0,void 0,function(){var o,a,s,u;return d(this,function(e){switch(e.label){case 0:o=Vr(c,Hu),a=fc(o),s=0<o.writePipeline.length?o.writePipeline[o.writePipeline.length-1].batchId:Ws,e.label=1;case 1:if(!uc(o))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,(n=o.localStore,r=s,(i=Vr(n,Eu)).persistence.runTransaction("Get next mutation batch","readonly",function(e){return void 0===r&&(r=Ws),i.mutationQueue.getNextMutationBatchAfterBatchId(e,r)}))];case 3:return null===(u=e.sent())?(0===o.writePipeline.length&&a.markIdle(),[3,7]):(s=u.batchId,t=u,Fr(uc(n=o),"addToWritePipeline called when pipeline is full"),n.writePipeline.push(t),(n=fc(n)).isOpen()&&n.handshakeComplete&&n.writeMutations(t.mutations),[3,6]);case 4:return u=e.sent(),[4,oc(o,u)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return cc(o)&&lc(o),[2]}var t,n,r,i})})}function uc(e){return rc(e)&&e.writePipeline.length<Wu}function cc(e){return rc(e)&&!fc(e).isStarted()&&0<e.writePipeline.length}function lc(e){Fr(cc(e),"startWriteStream() called when shouldStartWriteStream() is false."),fc(e).start()}function hc(n){var e,t,r,i=this;return n.watchStream||(n.watchStream=(e=n.datastore,t=n.asyncQueue,r={onOpen:function(n){return f(this,void 0,void 0,function(){return d(this,function(e){return n.listenTargets.forEach(function(e,t){Zu(n,e)}),[2]})})}.bind(null,n),onClose:function(t,n){return f(this,void 0,void 0,function(){return d(this,function(e){return void 0===n&&Fr(!nc(t),"Watch stream was stopped gracefully while still needed."),ic(t),nc(t)?(t.onlineStateTracker.handleWatchStreamFailure(n),tc(t)):t.onlineStateTracker.set("Unknown"),[2]})})}.bind(null,n),onWatchChange:function(r,i,o){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:if(r.onlineStateTracker.set("Online"),!(i instanceof ba&&2===i.state&&i.cause))return[3,6];e.label=1;case 1:return e.trys.push([1,3,,5]),[4,function(o,a){return f(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){switch(e.label){case 0:Fr(!!o.remoteSyncer.rejectListen,"rejectListen() not set"),Fr(!!a.cause,"Handling target error without a cause"),t=a.cause,n=0,r=a.targetIds,e.label=1;case 1:return n<r.length?(i=r[n],o.listenTargets.has(i)?[4,o.remoteSyncer.rejectListen(i,t)]:[3,3]):[3,4];case 2:e.sent(),o.listenTargets.delete(i),o.watchChangeAggregator.removeTarget(i),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}(r,i)];case 2:return e.sent(),[3,5];case 3:return t=e.sent(),Rr(Qu,"Failed to remove targets %s: %s ",i.targetIds.join(","),t),[4,oc(r,t)];case 4:return e.sent(),[3,5];case 5:return[2];case 6:if(i instanceof va?r.watchChangeAggregator.handleDocumentChange(i):i instanceof wa?r.watchChangeAggregator.handleExistenceFilter(i):(Fr(i instanceof ba,"Expected watchChange to be an instance of WatchTargetChange"),r.watchChangeAggregator.handleTargetChange(i)),o.isEqual(Uo.min()))return[3,13];e.label=7;case 7:return e.trys.push([7,11,,13]),[4,Cu(r.localStore)];case 8:return n=e.sent(),0<=o.compareTo(n)?[4,function(r,i){Fr(!i.isEqual(Uo.min()),"Can't raise event for unknown SnapshotVersion");var e=r.watchChangeAggregator.createRemoteEvent(i);return e.targetChanges.forEach(function(e,t){var n;0<e.resumeToken.approximateByteSize()&&(n=r.listenTargets.get(t))&&r.listenTargets.set(t,n.withResumeToken(e.resumeToken,i))}),e.targetMismatches.forEach(function(e){var t=r.listenTargets.get(e);t&&(r.listenTargets.set(e,t.withResumeToken(Yr.EMPTY_BYTE_STRING,t.snapshotVersion)),ec(r,e),t=new au(t.target,e,1,t.sequenceNumber),Zu(r,t))}),Fr(!!r.remoteSyncer.applyRemoteEvent,"applyRemoteEvent() not set"),r.remoteSyncer.applyRemoteEvent(e)}(r,o)]:[3,10];case 9:e.sent(),e.label=10;case 10:return[3,13];case 11:return n=e.sent(),Rr(Qu,"Failed to raise snapshot:",n),[4,oc(r,n)];case 12:return e.sent(),[3,13];case 13:return[2]}})})}.bind(null,n)},(e=Vr(e,ju)).verifyInitialized(),new xu(t,e.connection,e.credentials,e.serializer,r)),n.onNetworkStatusChange.push(function(t){return f(i,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return t?(n.watchStream.inhibitBackoff(),nc(n)?tc(n):n.onlineStateTracker.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.watchStream.stop()];case 2:e.sent(),ic(n),e.label=3;case 3:return[2]}})})})),n.watchStream}function fc(n){var e,t,r,i=this;return n.writeStream||(Fr(0===n.writePipeline.length,"Should not issue writes before WriteStream is enabled"),n.writeStream=(e=n.datastore,t=n.asyncQueue,r={onOpen:function(t){return f(this,void 0,void 0,function(){return d(this,function(e){return fc(t).writeHandshake(),[2]})})}.bind(null,n),onClose:function(t,n){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return void 0===n&&Fr(!cc(t),"Write stream was stopped gracefully while still needed."),n&&fc(t).handshakeComplete?[4,function(r,i){return f(this,void 0,void 0,function(){var n;return d(this,function(e){switch(e.label){case 0:return fa(t=i.code)&&t!==Sr.ABORTED?(n=r.writePipeline.shift(),fc(r).inhibitBackoff(),Fr(!!r.remoteSyncer.rejectFailedWrite,"rejectFailedWrite() not set"),[4,ac(r,function(){return r.remoteSyncer.rejectFailedWrite(n.batchId,i)})]):[3,3];case 1:return e.sent(),[4,sc(r)];case 2:e.sent(),e.label=3;case 3:return[2]}var t})})}(t,n)]:[3,2];case 1:e.sent(),e.label=2;case 2:return cc(t)&&lc(t),[2]}})})}.bind(null,n),onHandshakeComplete:function(o){return f(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){for(t=fc(o),n=0,r=o.writePipeline;n<r.length;n++)i=r[n],t.writeMutations(i.mutations);return[2]})})}.bind(null,n),onMutationResult:function(r,i,o){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return Fr(0<r.writePipeline.length,"Got result for empty write pipeline"),t=r.writePipeline.shift(),n=Xs.from(t,i,o),Fr(!!r.remoteSyncer.applySuccessfulWrite,"applySuccessfulWrite() not set"),[4,ac(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return e.sent(),[4,sc(r)];case 2:return e.sent(),[2]}})})}.bind(null,n)},(e=Vr(e,ju)).verifyInitialized(),new qu(t,e.connection,e.credentials,e.serializer,r)),n.onNetworkStatusChange.push(function(t){return f(i,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return t?(n.writeStream.inhibitBackoff(),[4,sc(n)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,n.writeStream.stop()];case 3:e.sent(),0<n.writePipeline.length&&(Rr(Qu,"Stopping write stream with "+n.writePipeline.length+" pending writes"),n.writePipeline=[]),e.label=4;case 4:return[2]}})})})),n.writeStream}function dc(){return"undefined"!=typeof document?document:null}var pc="AsyncQueue",yc=(gc.createAndSchedule=function(e,t,n,r,i){return(i=new gc(e,t,Date.now()+n,r,i)).start(n),i},gc.prototype.start=function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)},gc.prototype.skipDelay=function(){return this.handleDelayElapsed()},gc.prototype.cancel=function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Cr(Sr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))},gc.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},gc.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},gc);function gc(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new gu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}var mc=(Object.defineProperty(vc.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!1,configurable:!0}),vc.prototype.enqueueAndForget=function(e){this.enqueue(e)},vc.prototype.enqueueAndForgetEvenWhileRestricted=function(e){this.verifyNotFailed(),this.enqueueInternal(e)},vc.prototype.enterRestrictedMode=function(){var e;this._isShuttingDown||(this._isShuttingDown=!0,(e=dc())&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.visibilityHandler))},vc.prototype.enqueue=function(e){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(e){}):this.enqueueInternal(e)},vc.prototype.enqueueRetryable=function(e){var t=this;this.enqueueAndForget(function(){return t.retryableOps.push(e),t.retryNextOp()})},vc.prototype.retryNextOp=function(){return f(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:if(0===this.retryableOps.length)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.retryableOps[0]()];case 2:return e.sent(),this.retryableOps.shift(),this.backoff.reset(),[3,4];case 3:if(!mu(t=e.sent()))throw t;return Rr(pc,"Operation failed with retryable error: "+t),[3,4];case 4:return 0<this.retryableOps.length&&this.backoff.backoffAndRun(function(){return n.retryNextOp()}),[2]}})})},vc.prototype.enqueueInternal=function(e){var t=this,n=this.tail.then(function(){return t.operationInProgress=!0,e().catch(function(e){throw t.failure=e,t.operationInProgress=!1,Or("INTERNAL UNHANDLED ERROR: ",bc(e)),e}).then(function(e){return t.operationInProgress=!1,e})});return this.tail=n},vc.prototype.enqueueAfterDelay=function(e,t,n){var r=this;return this.verifyNotFailed(),Fr(0<=t,"Attempted to schedule an operation with a negative delay of "+t),-1<this.timerIdsToSkip.indexOf(e)&&(t=0),n=yc.createAndSchedule(this,e,t,n,function(e){return r.removeDelayedOperation(e)}),this.delayedOperations.push(n),n},vc.prototype.verifyNotFailed=function(){this.failure&&Mr("AsyncQueue is already failed: "+bc(this.failure))},vc.prototype.verifyOperationInProgress=function(){Fr(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},vc.prototype.drain=function(){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,t=this.tail];case 1:e.sent(),e.label=2;case 2:if(t!==this.tail)return[3,0];e.label=3;case 3:return[2]}})})},vc.prototype.containsDelayedOperation=function(e){for(var t=0,n=this.delayedOperations;t<n.length;t++)if(n[t].timerId===e)return!0;return!1},vc.prototype.runAllDelayedOperationsUntil=function(r){var i=this;return this.drain().then(function(){i.delayedOperations.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});for(var e=0,t=i.delayedOperations;e<t.length;e++){var n=t[e];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.drain()})},vc.prototype.skipDelaysForTimerId=function(e){this.timerIdsToSkip.push(e)},vc.prototype.removeDelayedOperation=function(e){Fr(0<=(e=this.delayedOperations.indexOf(e)),"Delayed operation not found."),this.delayedOperations.splice(e,1)},vc);function vc(){var t=this;this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[],this.backoff=new Ru(this,"async_queue_retry"),this.visibilityHandler=function(){var e=dc();e&&Rr(pc,"Visibility state changed to "+e.visibilityState),t.backoff.skipBackoff()};var e=dc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.visibilityHandler)}function wc(e,t){if(Or(pc,t+": "+e),mu(e))return new Cr(Sr.UNAVAILABLE,t+": "+e);throw e}function bc(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}var Tc=(Ec.emptySet=function(e){return new Ec(e.comparator)},Ec.prototype.has=function(e){return null!=this.keyedMap.get(e)},Ec.prototype.get=function(e){return this.keyedMap.get(e)},Ec.prototype.first=function(){return this.sortedSet.minKey()},Ec.prototype.last=function(){return this.sortedSet.maxKey()},Ec.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},Ec.prototype.indexOf=function(e){return(e=this.keyedMap.get(e))?this.sortedSet.indexOf(e):-1},Object.defineProperty(Ec.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),Ec.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(e,t){return n(e),!1})},Ec.prototype.add=function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))},Ec.prototype.delete=function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this},Ec.prototype.isEqual=function(e){if(!(e instanceof Ec))return!1;if(this.size!==e.size)return!1;for(var t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();t.hasNext();){var r=t.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},Ec.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},Ec.prototype.copy=function(e,t){var n=new Ec;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n},Ec);function Ec(n){this.comparator=n?function(e,t){return n(e,t)||ui.comparator(e.key,t.key)}:function(e,t){return ui.comparator(e.key,t.key)},this.keyedMap=ta,this.sortedSet=new Ko(this.comparator)}var _c=(Ic.prototype.track=function(e){var t=e.doc.key,n=this.changeMap.get(t);!n||0!==e.type&&3===n.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==n.type?this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):Mr("unsupported combination of changes: "+JSON.stringify(e)+" after "+JSON.stringify(n))},Ic.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(e,t){n.push(t)}),n},Ic);function Ic(){this.changeMap=new Ko(ui.comparator)}var Sc=(Cc.fromInitialDocuments=function(e,t,n,r){var i=[];return t.forEach(function(e){i.push({type:0,doc:e})}),new Cc(e,t,Tc.emptySet(t),i,n,r,!0,!1)},Object.defineProperty(Cc.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),Cc.prototype.isEqual=function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0},Cc);function Cc(e,t,n,r,i,o,a,s){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var Dc=function(){this.viewSnap=void 0,this.listeners=[]},Ac=function(){this.queries=new $s(ao,oo),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set};function kc(a,s){return f(this,void 0,void 0,function(){var t,n,r,i,o;return d(this,function(e){switch(e.label){case 0:if(Fr(!!(t=Vr(a,Ac)).onListen,"onListen not set"),n=s.query,r=!1,(i=t.queries.get(n))||(r=!0,i=new Dc),!r)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),o=i,[4,t.onListen(n)];case 2:return o.viewSnap=e.sent(),[3,4];case 3:return o=wc(o=e.sent(),"Initialization of query '"+so(s.query)+"' failed"),s.onError(o),[2];case 4:return t.queries.set(n,i),i.listeners.push(s),Fr(!s.applyOnlineStateChange(t.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),i.viewSnap&&s.onViewSnapshot(i.viewSnap)&&Rc(t),[2]}})})}function Nc(a,s){return f(this,void 0,void 0,function(){var t,n,r,i,o;return d(this,function(e){return Fr(!!(t=Vr(a,Ac)).onUnlisten,"onUnlisten not set"),n=s.query,r=!1,(i=t.queries.get(n))&&0<=(o=i.listeners.indexOf(s))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?(t.queries.delete(n),[2,t.onUnlisten(n)]):[2]})})}function Rc(e){e.snapshotsInSyncListeners.forEach(function(e){e.next()})}var Oc=(Lc.prototype.onViewSnapshot=function(e){if(Fr(0<e.docChanges.length||e.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var t=[],n=0,r=e.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&t.push(i)}e=new Sc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),o=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),o=!0),this.snap=e,o},Lc.prototype.onError=function(e){this.queryObserver.error(e)},Lc.prototype.applyOnlineStateChange=function(e){this.onlineState=e;var t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t},Lc.prototype.shouldRaiseInitialEvent=function(e,t){if(Fr(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!e.fromCache)return!0;var n="Offline"!==t;return this.options.waitForSyncWhenOnline&&n?(Fr(e.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!e.docs.isEmpty()||"Offline"===t},Lc.prototype.shouldRaiseEvent=function(e){if(0<e.docChanges.length)return!0;var t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges},Lc.prototype.raiseInitialEvent=function(e){Fr(!this.raisedInitialEvent,"Trying to raise initial events for second time"),e=Sc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(e)},Lc);function Lc(e,t,n){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=n||{}}var Pc=(Mc.fromSnapshot=function(e,t){for(var n=ia(),r=ia(),i=0,o=t.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:r=r.add(a.doc.key)}}return new Mc(e,t.fromCache,n,r)},Mc);function Mc(e,t,n,r){this.targetId=e,this.fromCache=t,this.addedKeys=n,this.removedKeys=r}var xc=(Fc.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},Fc.prototype.addReference=function(e,t){t=new Vc(e,t),this.refsByKey=this.refsByKey.add(t),this.refsByTarget=this.refsByTarget.add(t)},Fc.prototype.addReferences=function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})},Fc.prototype.removeReference=function(e,t){this.removeRef(new Vc(e,t))},Fc.prototype.removeReferences=function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})},Fc.prototype.removeReferencesForId=function(e){var t=this,n=new ui(new ni([])),r=new Vc(n,e),e=new Vc(n,e+1),i=[];return this.refsByTarget.forEachInRange([r,e],function(e){t.removeRef(e),i.push(e.key)}),i},Fc.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},Fc.prototype.removeRef=function(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)},Fc.prototype.referencesForId=function(e){var t=new ui(new ni([])),n=new Vc(t,e),e=new Vc(t,e+1),r=ia();return this.refsByTarget.forEachInRange([n,e],function(e){r=r.add(e.key)}),r},Fc.prototype.containsKey=function(e){var t=new Vc(e,0);return null!==(t=this.refsByKey.firstAfterOrEqual(t))&&e.isEqual(t.key)},Fc);function Fc(){this.refsByKey=new Xo(Vc.compareByKey),this.refsByTarget=new Xo(Vc.compareByTargetId)}var Vc=(qc.compareByKey=function(e,t){return ui.comparator(e.key,t.key)||Ur(e.targetOrBatchId,t.targetOrBatchId)},qc.compareByTargetId=function(e,t){return Ur(e.targetOrBatchId,t.targetOrBatchId)||ui.comparator(e.key,t.key)},qc);function qc(e,t){this.key=e,this.targetOrBatchId=t}var Bc=function(e){this.key=e},Uc=function(e){this.key=e},jc=(Object.defineProperty(Kc.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!1,configurable:!0}),Kc.prototype.computeDocChanges=function(e,t){var a=this,s=t?t.changeSet:new _c,u=(t||this).documentSet,c=(t||this).mutatedKeys,l=u,h=!1,f=Xi(this.query)&&u.size===this.query.limit?u.last():null,d=Ji(this.query)&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal(function(e,t){var n=u.get(e),r=t instanceof Mi?t:null;r&&(Fr(e.isEqual(r.key),"Mismatching keys found in document changes: "+e+" != "+r.key),r=uo(a.query,r)?r:null);var i=!!n&&a.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||a.mutatedKeys.has(r.key)&&r.hasCommittedMutations),t=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(s.track({type:3,doc:r}),t=!0):a.shouldWaitForSyncedDocument(n,r)||(s.track({type:2,doc:r}),t=!0,(f&&0<a.docComparator(r,f)||d&&a.docComparator(r,d)<0)&&(h=!0)):!n&&r?(s.track({type:0,doc:r}),t=!0):n&&!r&&(s.track({type:1,doc:n}),t=!0,(f||d)&&(h=!0)),t&&(c=r?(l=l.add(r),o?c.add(e):c.delete(e)):(l=l.delete(e),c.delete(e)))}),Xi(this.query)||Ji(this.query))for(;l.size>this.query.limit;){var n=Xi(this.query)?l.last():l.first(),l=l.delete(n.key),c=c.delete(n.key);s.track({type:1,doc:n})}return Fr(!h||!t,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:s,needsRefill:h,mutatedKeys:c}},Kc.prototype.shouldWaitForSyncedDocument=function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations},Kc.prototype.applyChanges=function(e,t,n){var o=this;Fr(!e.needsRefill,"Cannot apply changes that need a refill");var r=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;var i=e.changeSet.getChanges();i.sort(function(e,t){return r=e.type,i=t.type,n(r)-n(i)||o.docComparator(e.doc,t.doc);function n(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Mr("Unknown ChangeType: "+e)}}var r,i}),this.applyTargetChange(n);var a=t?this.updateLimboDocuments():[],t=(n=0===this.limboDocuments.size&&this.current?1:0)!==this.syncState;return this.syncState=n,0!==i.length||t?{snapshot:new Sc(this.query,e.documentSet,r,i,e.mutatedKeys,0==n,t,!1),limboChanges:a}:{limboChanges:a}},Kc.prototype.applyOnlineStateChange=function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new _c,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},Kc.prototype.shouldBeInLimbo=function(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations},Kc.prototype.applyTargetChange=function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.add(e)}),e.modifiedDocuments.forEach(function(e){Fr(t._syncedDocuments.has(e),"Modified document "+e+" not found in view.")}),e.removedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.delete(e)}),this.current=e.current)},Kc.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=ia(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var r=[];return n.forEach(function(e){t.limboDocuments.has(e)||r.push(new Uc(e))}),this.limboDocuments.forEach(function(e){n.has(e)||r.push(new Bc(e))}),r},Kc.prototype.synchronizeWithPersistedState=function(e){return this._syncedDocuments=e.remoteKeys,this.limboDocuments=ia(),e=this.computeDocChanges(e.documents),this.applyChanges(e,!0)},Kc.prototype.computeInitialSnapshot=function(){return Sc.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState)},Kc);function Kc(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.current=!1,this.limboDocuments=ia(),this.mutatedKeys=ia(),this.docComparator=co(e),this.documentSet=new Tc(this.docComparator)}var zc="SyncEngine",Gc=function(e,t,n){this.query=e,this.targetId=t,this.view=n},Qc=function(e){this.key=e,this.receivedDocument=!1},Wc=(Object.defineProperty(Hc.prototype,"isPrimaryClient",{get:function(){return!0===this._isPrimaryClient},enumerable:!1,configurable:!0}),Hc);function Hc(e,t,n,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new $s(ao,oo),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=[],this.activeLimboTargetsByKey=new Ko(ui.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new xc,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=vu.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}function Yc(s,u,c){return f(this,void 0,void 0,function(){var o,a;return d(this,function(e){switch(e.label){case 0:(i=Vr(i=s,Wc)).remoteStore.remoteSyncer.applySuccessfulWrite=function(o,a){return f(this,void 0,void 0,function(){var n,r,i;return d(this,function(e){switch(e.label){case 0:n=Vr(o,Wc),r=a.batch.batchId,e.label=1;case 1:return e.trys.push([1,4,,6]),[4,(t=n.localStore,l=a,(h=Vr(t,Eu)).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(e){var i,t=l.batch.keys(),n=h.remoteDocuments.newChangeBuffer({trackRemovals:!0}),r=h,o=e,a=n,s=(i=l).batch,u=s.keys(),c=eu.resolve();return u.forEach(function(r){c=c.next(function(){return a.getEntry(o,r)}).next(function(e){var t=e,n=i.docVersions.get(r);xr(null!==n,"ackVersions should contain every doc in the write."),(!t||t.version.compareTo(n)<0)&&((t=s.applyToRemoteDocument(r,t,i))?a.addEntry(t,i.commitVersion):Fr(!e,"Mutation batch "+s+" applied to document "+e+" resulted in null"))})}),c.next(function(){return r.mutationQueue.removeMutationBatch(o,s)}).next(function(){return n.apply(e)}).next(function(){return h.mutationQueue.performConsistencyCheck(e)}).next(function(){return h.localDocuments.getDocuments(e,t)})}))];case 2:return i=e.sent(),Zc(n,r,null),$c(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,il(n,i)];case 3:return e.sent(),[3,6];case 4:return[4,Nu(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}var t,l,h})})}.bind(null,i),i.remoteStore.remoteSyncer.rejectFailedWrite=function(a,s,u){return f(this,void 0,void 0,function(){var n,o;return d(this,function(e){switch(e.label){case 0:n=Vr(a,Wc),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,(t=n.localStore,r=s,(i=Vr(t,Eu)).persistence.runTransaction("Reject batch","readwrite-primary",function(t){var n;return i.mutationQueue.lookupMutationBatch(t,r).next(function(e){return xr(null!==e,"Attempt to reject nonexistent batch!"),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,n)})}))];case 2:return o=e.sent(),Zc(n,s,u),$c(n,s),n.sharedClientState.updateMutationState(s,"rejected",u),[4,il(n,o)];case 3:return e.sent(),[3,6];case 4:return[4,Nu(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}var t,r,i})})}.bind(null,i),a=i,e.label=1;case 1:return e.trys.push([1,5,,6]),[4,Su(a.localStore,u)];case 2:return o=e.sent(),a.sharedClientState.addPendingMutation(o.batchId),t=a,n=o.batchId,r=c,i=(i=(i=t.mutationUserCallbacks[t.currentUser.toKey()])||new Ko(Ur)).insert(n,r),t.mutationUserCallbacks[t.currentUser.toKey()]=i,[4,il(a,o.changes)];case 3:return e.sent(),[4,sc(a.remoteStore)];case 4:return e.sent(),[3,6];case 5:return a=wc(a=e.sent(),"Failed to persist write"),c.reject(a),[3,6];case 6:return[2]}var t,n,r,i})})}function Xc(r,i){return f(this,void 0,void 0,function(){var n,t;return d(this,function(e){switch(e.label){case 0:n=Vr(r,Wc),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Du(n.localStore,i)];case 2:return t=e.sent(),i.targetChanges.forEach(function(e,t){(t=n.activeLimboResolutionsByTarget.get(t))&&(xr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?t.receivedDocument=!0:0<e.modifiedDocuments.size?xr(t.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(xr(t.receivedDocument,"Received remove for limbo target document without add."),t.receivedDocument=!1))}),[4,il(n,t,i)];case 3:return e.sent(),[3,6];case 4:return[4,Nu(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function Jc(e,n,t){var r;((e=Vr(e,Wc)).isPrimaryClient&&0===t||!e.isPrimaryClient&&1===t)&&(r=[],e.queryViewsByQuery.forEach(function(e,t){Fr(0===(t=t.view.applyOnlineStateChange(n)).limboChanges.length,"OnlineState should not affect limbo documents."),t.snapshot&&r.push(t.snapshot)}),function(e,i){(e=Vr(e,Ac)).onlineState=i;var o=!1;e.queries.forEach(function(e,t){for(var n=0,r=t.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&Rc(e)}(e.eventManager,n),r.length&&(Fr(!!e.syncEngineListener.onWatchChange,"Active views but EventManager callbacks are not assigned"),e.syncEngineListener.onWatchChange(r)),e.onlineState=n,e.isPrimaryClient&&e.sharedClientState.setOnlineState(n))}function $c(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(function(e){e.resolve()}),e.pendingWritesCallbacks.delete(t)}function Zc(e,t,n){var r=Vr(e,Wc),i=r.mutationUserCallbacks[r.currentUser.toKey()];i&&((e=i.get(t))&&(Fr(t===i.minKey(),"Mutation callbacks processed out-of-order?"),n?e.reject(n):e.resolve(),i=i.remove(t)),r.mutationUserCallbacks[r.currentUser.toKey()]=i)}function el(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e),Fr(t.queriesByTarget.has(e)&&0!==t.queriesByTarget.get(e).length,"There are no queries mapped to target id "+e);for(var r=0,i=t.queriesByTarget.get(e);r<i.length;r++){var o=i[r];t.queryViewsByQuery.delete(o),n&&t.syncEngineListener.onWatchError(o,n)}t.queriesByTarget.delete(e),t.isPrimaryClient&&t.limboDocumentRefs.removeReferencesForId(e).forEach(function(e){t.limboDocumentRefs.containsKey(e)||tl(t,e)})}function tl(e,t){var n=e.activeLimboTargetsByKey.get(t);null!==n&&($u(e.remoteStore,n),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(n),rl(e))}function nl(e,t,n){for(var r,i,o=0,a=n;o<a.length;o++){var s=a[o];s instanceof Bc?(e.limboDocumentRefs.addReference(s.key,t),r=e,i=(i=s).key,r.activeLimboTargetsByKey.get(i)||(Rr(zc,"New document in limbo: "+i),r.enqueuedLimboResolutions.push(i),rl(r))):s instanceof Uc?(Rr(zc,"Document no longer in limbo: "+s.key),e.limboDocumentRefs.removeReference(s.key,t),e.limboDocumentRefs.containsKey(s.key)||tl(e,s.key)):Mr("Unknown limbo change: "+JSON.stringify(s))}}function rl(e){for(;0<e.enqueuedLimboResolutions.length&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){var t=e.enqueuedLimboResolutions.shift(),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new Qc(t)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(t,n),Ju(e.remoteStore,new au(ro(Yi(t.path)),n,2,uu.INVALID))}}function il(t,a,s){return f(this,void 0,void 0,function(){var n,r,i,o;return d(this,function(e){switch(e.label){case 0:return n=Vr(t,Wc),r=[],i=[],o=[],n.queryViewsByQuery.isEmpty()?[2]:(n.queryViewsByQuery.forEach(function(e,t){Fr(!!n.applyDocChanges,"ApplyDocChangesHandler not set"),o.push(n.applyDocChanges(t,a,s).then(function(e){e&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),r.push(e),e=Pc.fromSnapshot(t.targetId,e),i.push(e))}))}),[4,Promise.all(o)]);case 1:return e.sent(),n.syncEngineListener.onWatchChange(r),[4,function(u,c){return f(this,void 0,void 0,function(){var r,t,n,i,o,a,s;return d(this,function(e){switch(e.label){case 0:r=Vr(u,Eu),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return eu.forEach(c,function(t){return eu.forEach(t.addedKeys,function(e){return r.persistence.referenceDelegate.addReference(n,t.targetId,e)}).next(function(){return eu.forEach(t.removedKeys,function(e){return r.persistence.referenceDelegate.removeReference(n,t.targetId,e)})})})})];case 2:return e.sent(),[3,4];case 3:if(!mu(t=e.sent()))throw t;return Rr(bu,"Failed to update sequence numbers: "+t),[3,4];case 4:for(n=0,i=c;n<i.length;n++)s=i[n],o=s.targetId,s.fromCache||(Fr(null!==(a=r.targetDataByTarget.get(o)),"Can't set limbo-free snapshot version for unknown target: "+o),s=a.snapshotVersion,s=a.withLastLimboFreeSnapshotVersion(s),r.targetDataByTarget=r.targetDataByTarget.insert(o,s));return[2]}})})}(n.localStore,i)];case 2:return e.sent(),[2]}})})}var ol=(al.prototype.addQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.add(e)},al.prototype.removeQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.delete(e)},al.prototype.toWebStorageJSON=function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)},al);function al(){this.activeTargetIds=oa}var sl=(ul.prototype.addPendingMutation=function(e){},ul.prototype.updateMutationState=function(e,t,n){},ul.prototype.addLocalQueryTarget=function(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"},ul.prototype.updateQueryState=function(e,t,n){this.queryState[e]=t},ul.prototype.removeLocalQueryTarget=function(e){this.localState.removeQueryTarget(e)},ul.prototype.isLocalQueryTarget=function(e){return this.localState.activeTargetIds.has(e)},ul.prototype.clearQueryState=function(e){delete this.queryState[e]},ul.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},ul.prototype.isActiveQueryTarget=function(e){return this.localState.activeTargetIds.has(e)},ul.prototype.start=function(){return this.localState=new ol,Promise.resolve()},ul.prototype.handleUserChange=function(e,t,n){},ul.prototype.setOnlineState=function(e){},ul.prototype.shutdown=function(){},ul.prototype.writeSequenceNumber=function(e){},ul.prototype.notifyBundleLoaded=function(){},ul);function ul(){this.localState=new ol,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}var cl=(ll.prototype.setLocalDocumentsView=function(e){this.localDocumentsView=e},ll.prototype.getDocumentsMatchingQuery=function(t,r,i,o){var a=this;return Fr(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(Uo.min())?this.executeFullCollectionScan(t,r):this.localDocumentsView.getDocuments(t,o).next(function(e){var n=a.applyQuery(r,e);return(Xi(r)||Ji(r))&&a.needsRefill(r.limitType,n,o,i)?a.executeFullCollectionScan(t,r):(Nr()<=s.DEBUG&&Rr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),so(r)),a.localDocumentsView.getDocumentsMatchingQuery(t,r,i).next(function(t){return n.forEach(function(e){t=t.insert(e.key,e)}),t}))})},ll.prototype.applyQuery=function(n,e){var r=new Xo(co(n));return e.forEach(function(e,t){t instanceof Mi&&uo(n,t)&&(r=r.add(t))}),r},ll.prototype.needsRefill=function(e,t,n,r){return n.size!==t.size||!!(t="F"===e?t.last():t.first())&&(t.hasPendingWrites||0<t.version.compareTo(r))},ll.prototype.executeFullCollectionScan=function(e,t){return Nr()<=s.DEBUG&&Rr("QueryEngine","Using full collection scan to execute query:",so(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Uo.min())},ll);function ll(){}var hl=(fl.prototype.checkEmpty=function(e){return eu.resolve(0===this.mutationQueue.length)},fl.prototype.addMutationBatch=function(e,t,n,r){Fr(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Fr(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order"),n=new Hs(i,t,n,r),this.mutationQueue.push(n);for(var o=0,a=r;o<a.length;o++){var s=a[o];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Vc(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}return eu.resolve(n)},fl.prototype.lookupMutationBatch=function(e,t){return eu.resolve(this.findMutationBatch(t))},fl.prototype.getNextMutationBatchAfterBatchId=function(e,t){return t+=1,t=(t=this.indexOfBatchId(t))<0?0:t,eu.resolve(this.mutationQueue.length>t?this.mutationQueue[t]:null)},fl.prototype.getHighestUnacknowledgedBatchId=function(){return eu.resolve(0===this.mutationQueue.length?Ws:this.nextBatchId-1)},fl.prototype.getAllMutationBatches=function(e){return eu.resolve(this.mutationQueue.slice())},fl.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var n=this,r=new Vc(t,0),i=new Vc(t,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(e){Fr(t.isEqual(e.key),"Should only iterate over a single key's batches"),Fr(null!==(e=n.findMutationBatch(e.targetOrBatchId)),"Batches in the index must exist in the main table"),o.push(e)}),eu.resolve(o)},fl.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var r=this,i=new Xo(Ur);return t.forEach(function(t){var e=new Vc(t,0),n=new Vc(t,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([e,n],function(e){Fr(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),i=i.add(e.targetOrBatchId)})}),eu.resolve(this.findMutationBatches(i))},fl.prototype.getAllMutationBatchesAffectingQuery=function(e,t){Fr(!to(t),"CollectionGroup queries should be handled in LocalDocumentsView");var n=t.path,r=n.length+1,t=n;ui.isDocumentKey(t)||(t=t.child(""));var t=new Vc(new ui(t),0),i=new Xo(Ur);return this.batchesByDocumentKey.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(i=i.add(e.targetOrBatchId)),!0)},t),eu.resolve(this.findMutationBatches(i))},fl.prototype.findMutationBatches=function(e){var t=this,n=[];return e.forEach(function(e){null!==(e=t.findMutationBatch(e))&&n.push(e)}),n},fl.prototype.removeMutationBatch=function(n,r){var i=this;xr(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return eu.forEach(r.mutations,function(e){var t=new Vc(e.key,r.batchId);return o=o.delete(t),i.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(function(){i.batchesByDocumentKey=o})},fl.prototype.removeCachedMutationKeys=function(e){},fl.prototype.containsKey=function(e,t){var n=new Vc(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(n);return eu.resolve(t.isEqual(n&&n.key))},fl.prototype.performConsistencyCheck=function(e){return 0===this.mutationQueue.length&&Fr(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),eu.resolve()},fl.prototype.indexOfExistingBatchId=function(e,t){return Fr(0<=(e=this.indexOfBatchId(e))&&e<this.mutationQueue.length,"Batches must exist to be "+t),e},fl.prototype.indexOfBatchId=function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId},fl.prototype.findMutationBatch=function(e){var t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:(Fr((t=this.mutationQueue[t]).batchId===e,"If found batch must match"),t)},fl);function fl(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Xo(Vc.compareByKey)}var dl=(pl.prototype.addEntry=function(e,t,n){Fr(!n.isEqual(Uo.min()),"Cannot add a document with a read time of zero");var r=t.key,i=(o=this.docs.get(r))?o.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{maybeDocument:t,size:o,readTime:n}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())},pl.prototype.removeEntry=function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)},pl.prototype.getEntry=function(e,t){return t=this.docs.get(t),eu.resolve(t?t.maybeDocument:null)},pl.prototype.getEntries=function(e,t){var n=this,r=ea;return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.maybeDocument:null)}),eu.resolve(r)},pl.prototype.getDocumentsMatchingQuery=function(e,t,n){Fr(!to(t),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=ta,i=new ui(t.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=(s=o.getNext()).key,s=(u=s.value).maybeDocument,u=u.readTime;if(!t.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||s instanceof Mi&&uo(t,s)&&(r=r.insert(s.key,s))}return eu.resolve(r)},pl.prototype.forEachDocumentKey=function(e,t){return eu.forEach(this.docs,function(e){return t(e)})},pl.prototype.newChangeBuffer=function(e){return new gl(this)},pl.prototype.getSize=function(e){return eu.resolve(this.size)},pl);function pl(e,t){this.indexManager=e,this.sizer=t,this.docs=new Ko(ui.comparator),this.size=0}var yl,gl=(n(ml,yl=vt),ml.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(e,t){t&&t.maybeDocument?i.push(r.documentCache.addEntry(n,t.maybeDocument,r.getReadTime(e))):r.documentCache.removeEntry(e)}),eu.waitFor(i)},ml.prototype.getFromCache=function(e,t){return this.documentCache.getEntry(e,t)},ml.prototype.getAllFromCache=function(e,t){return this.documentCache.getEntries(e,t)},ml);function ml(e){var t=yl.call(this)||this;return t.documentCache=e,t}var vl=(wl.prototype.forEachTarget=function(e,n){return this.targets.forEach(function(e,t){return n(t)}),eu.resolve()},wl.prototype.getLastRemoteSnapshotVersion=function(e){return eu.resolve(this.lastRemoteSnapshotVersion)},wl.prototype.getHighestSequenceNumber=function(e){return eu.resolve(this.highestSequenceNumber)},wl.prototype.allocateTargetId=function(e){return this.highestTargetId=this.targetIdGenerator.next(),eu.resolve(this.highestTargetId)},wl.prototype.setTargetsMetadata=function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),eu.resolve()},wl.prototype.saveTargetData=function(e){this.targets.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new vu(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)},wl.prototype.addTargetData=function(e,t){return Fr(!this.targets.has(t.target),"Adding a target that already exists"),this.saveTargetData(t),this.targetCount+=1,eu.resolve()},wl.prototype.updateTargetData=function(e,t){return Fr(this.targets.has(t.target),"Updating a non-existent target"),this.saveTargetData(t),eu.resolve()},wl.prototype.removeTargetData=function(e,t){return Fr(0<this.targetCount,"Removing a target from an empty cache"),Fr(this.targets.has(t.target),"Removing a non-existent target from the cache"),this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),--this.targetCount,eu.resolve()},wl.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.targets.forEach(function(e,t){t.sequenceNumber<=r&&null===i.get(t.targetId)&&(o.targets.delete(e),s.push(o.removeMatchingKeysForTargetId(n,t.targetId)),a++)}),eu.waitFor(s).next(function(){return a})},wl.prototype.getTargetCount=function(e){return eu.resolve(this.targetCount)},wl.prototype.getTargetData=function(e,t){return t=this.targets.get(t)||null,eu.resolve(t)},wl.prototype.addMatchingKeys=function(e,t,n){return this.references.addReferences(t,n),eu.resolve()},wl.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),eu.waitFor(i)},wl.prototype.removeMatchingKeysForTargetId=function(e,t){return this.references.removeReferencesForId(t),eu.resolve()},wl.prototype.getMatchingKeysForTargetId=function(e,t){return t=this.references.referencesForId(t),eu.resolve(t)},wl.prototype.containsKey=function(e,t){return eu.resolve(this.references.containsKey(t))},wl);function wl(e){this.persistence=e,this.targets=new $s(Gi,Qi),this.lastRemoteSnapshotVersion=Uo.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new xc,this.targetCount=0,this.targetIdGenerator=vu.forTargetCache()}var bl=(Tl.prototype.getBundleMetadata=function(e,t){return eu.resolve(this.bundles.get(t))},Tl.prototype.saveBundleMetadata=function(e,t){return this.bundles.set(t.id,{id:t.id,version:t.version,createTime:xa(t.createTime)}),eu.resolve()},Tl.prototype.getNamedQuery=function(e,t){return eu.resolve(this.namedQueries.get(t))},Tl.prototype.saveNamedQuery=function(e,t){return this.namedQueries.set(t.name,{name:(n=t).name,query:(t=Wa({parent:(r=n.bundledQuery).parent,structuredQuery:r.structuredQuery}),"LAST"===r.limitType?(Fr(!!t.limit,"Bundled query has limitType LAST, but limit is null"),io(t,t.limit,"L")):t),readTime:xa(n.readTime)}),eu.resolve();var n,r},Tl);function Tl(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}var El=(_l.prototype.start=function(){return Promise.resolve()},_l.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(_l.prototype,"started",{get:function(){return this._started},enumerable:!1,configurable:!0}),_l.prototype.setDatabaseDeletedListener=function(){},_l.prototype.setNetworkEnabled=function(){},_l.prototype.getIndexManager=function(){return this.indexManager},_l.prototype.getMutationQueue=function(e){var t=this.mutationQueues[e.toKey()];return t||(t=new hl(this.indexManager,this.referenceDelegate),this.mutationQueues[e.toKey()]=t),t},_l.prototype.getTargetCache=function(){return this.targetCache},_l.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},_l.prototype.getBundleCache=function(){return this.bundleCache},_l.prototype.runTransaction=function(e,t,n){var r=this;Rr("MemoryPersistence","Starting transaction:",e);var i=new Sl(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(e){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})},_l.prototype.mutationQueuesContainKey=function(t,n){return eu.or(Object.values(this.mutationQueues).map(function(e){return function(){return e.containsKey(t,n)}}))},_l);function _l(e,t){var n=this;this.mutationQueues={},this.listenSequence=new uu(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new vl(this),this.indexManager=new fu,this.remoteDocumentCache=(e=this.indexManager,new dl(e,function(e){return n.referenceDelegate.documentSize(e)})),this.serializer=new lu(t),this.bundleCache=new bl(this.serializer)}var Il,Sl=(n(Cl,Il=mt),Cl);function Cl(e){var t=Il.call(this)||this;return t.currentSequenceNumber=e,t}var Dl=(Al.factory=function(e){return new Al(e)},Object.defineProperty(Al.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Mr("orphanedDocuments is only valid during a transaction.")},enumerable:!1,configurable:!0}),Al.prototype.addReference=function(e,t,n){return this.localViewReferences.addReference(n,t),this.orphanedDocuments.delete(n.toString()),eu.resolve()},Al.prototype.removeReference=function(e,t,n){return this.localViewReferences.removeReference(n,t),this.orphanedDocuments.add(n.toString()),eu.resolve()},Al.prototype.markPotentiallyOrphaned=function(e,t){return this.orphanedDocuments.add(t.toString()),eu.resolve()},Al.prototype.removeTarget=function(e,t){var n=this;this.localViewReferences.removeReferencesForId(t.targetId).forEach(function(e){return n.orphanedDocuments.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.orphanedDocuments.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})},Al.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},Al.prototype.onTransactionCommitted=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eu.forEach(this.orphanedDocuments,function(e){var t=ui.fromPath(e);return r.isReferenced(n,t).next(function(e){e||i.removeEntry(t)})}).next(function(){return r._orphanedDocuments=null,i.apply(n)})},Al.prototype.updateLimboDocument=function(e,t){var n=this;return this.isReferenced(e,t).next(function(e){e?n.orphanedDocuments.delete(t.toString()):n.orphanedDocuments.add(t.toString())})},Al.prototype.documentSize=function(e){return 0},Al.prototype.isReferenced=function(e,t){var n=this;return eu.or([function(){return eu.resolve(n.localViewReferences.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.mutationQueuesContainKey(e,t)}])},Al);function Al(e){this.persistence=e,this.localViewReferences=new xc,this._orphanedDocuments=null}var kl=(Nl.prototype.onOpen=function(e){Fr(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=e},Nl.prototype.onClose=function(e){Fr(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=e},Nl.prototype.onMessage=function(e){Fr(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=e},Nl.prototype.close=function(){this.closeFn()},Nl.prototype.send=function(e){this.sendFn(e)},Nl.prototype.callOnOpen=function(){Fr(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},Nl.prototype.callOnClose=function(e){Fr(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(e)},Nl.prototype.callOnMessage=function(e){Fr(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(e)},Nl);function Nl(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}var Rl="RestConnection",Ol={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ll="gl-js/ fire/"+Ar,vt=(Pl.prototype.invokeRPC=function(t,e,n,r){var i=this.makeUrl(t,e);return Rr(Rl,"Sending: ",i,n),e={},this.modifyHeadersForRequest(e,r),this.performRPCRequest(t,i,e,n).then(function(e){return Rr(Rl,"Received: ",e),e},function(e){throw Lr(Rl,t+" failed with error: ",e,"url: ",i,"request:",n),e})},Pl.prototype.invokeStreamingRPC=function(e,t,n,r){return this.invokeRPC(e,t,n,r)},Pl.prototype.modifyHeadersForRequest=function(e,t){if(e["X-Goog-Api-Client"]=Ll,e["Content-Type"]="text/plain",t)for(var n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])},Pl.prototype.makeUrl=function(e,t){var n=Ol[e];return Fr(void 0!==n,"Unknown REST mapping for: "+e),this.baseUrl+"/v1/"+t+":"+n},Pl);function Pl(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.baseUrl=t+"://"+e.host,this.databaseRoot="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}var Ml,xl="Connection",Fl=(n(Vl,Ml=vt),Vl.prototype.performRPCRequest=function(o,t,a,s){return new Promise(function(n,r){var i=new gr;i.listenOnce(dr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case fr.NO_ERROR:var e=i.getResponseJson();Rr(xl,"XHR received:",JSON.stringify(e)),n(e);break;case fr.TIMEOUT:Rr(xl,'RPC "'+o+'" timed out'),r(new Cr(Sr.DEADLINE_EXCEEDED,"Request time out"));break;case fr.HTTP_ERROR:var t=i.getStatus();Rr(xl,'RPC "'+o+'" failed with status:',t,"response text:",i.getResponseText()),0<t?(e=i.getResponseJson().error)&&e.status&&e.message?(t=(t=e.status).toLowerCase().replace(/_/g,"-"),t=0<=Object.values(Sr).indexOf(t)?t:Sr.UNKNOWN,r(new Cr(t,e.message))):r(new Cr(Sr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Cr(Sr.UNAVAILABLE,"Connection failed."));break;default:Mr('RPC "'+o+'" failed with unanticipated webchannel error '+i.getLastErrorCode()+": "+i.getLastError()+", giving up.")}}finally{Rr(xl,'RPC "'+o+'" completed.')}});var e=JSON.stringify(s);i.send(t,"POST",e,a,15)})},Vl.prototype.openStream=function(e,t){var n,r=[this.baseUrl,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new ar,o=hr(),e={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.modifyHeadersForRequest(e.initMessageHeaders,t),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(y())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=y().indexOf("Electron/")||0<=(n=y()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=y().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(e.httpHeadersOverwriteParam="$httpHeaders"),r=r.join(""),Rr(xl,"Creating WebChannel: "+r,e);var a=i.createWebChannel(r,e),s=!1,u=!1,c=new kl({sendFn:function(e){u?Rr(xl,"Not sending because WebChannel is closed:",e):(s||(Rr(xl,"Opening WebChannel transport."),a.open(),s=!0),Rr(xl,"WebChannel sending:",e),a.send(e))},closeFn:function(){return a.close()}});return(e=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})})(a,yr.EventType.OPEN,function(){u||Rr(xl,"WebChannel transport opened.")}),e(a,yr.EventType.CLOSE,function(){u||(u=!0,Rr(xl,"WebChannel transport closed"),c.callOnClose())}),e(a,yr.EventType.ERROR,function(e){u||(u=!0,Lr(xl,"WebChannel transport errored:",e),c.callOnClose(new Cr(Sr.UNAVAILABLE,"The operation could not be completed")))}),e(a,yr.EventType.MESSAGE,function(e){var t,n,r,i;u||(xr(!!(t=e.data[0]),"Got a webchannel message without data."),(n=t.error||(null===(i=t[0])||void 0===i?void 0:i.error))?(Rr(xl,"WebChannel received error:",n),e=function(e){if(void 0!==(e=ha[e]))return da(e)}(r=n.status),i=n.message,void 0===e&&(e=Sr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.callOnClose(new Cr(e,i)),a.close()):(Rr(xl,"WebChannel received:",t),c.callOnMessage(t)))}),e(o,pr.STAT_EVENT,function(e){10===e.stat?Rr(xl,"Detected buffering proxy"):11===e.stat&&Rr(xl,"Detected no buffering proxy")}),setTimeout(function(){c.callOnOpen()},0),c},Vl);function Vl(e){var t=Ml.call(this,e)||this;return t.forceLongPolling=e.forceLongPolling,t.autoDetectLongPolling=e.autoDetectLongPolling,t}var ql="ConnectivityMonitor",Bl=(Ul.prototype.addCallback=function(e){this.callbacks.push(e)},Ul.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},Ul.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},Ul.prototype.onNetworkAvailable=function(){Rr(ql,"Network connectivity changed: AVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++)(0,t[e])(0)},Ul.prototype.onNetworkUnavailable=function(){Rr(ql,"Network connectivity changed: UNAVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++)(0,t[e])(1)},Ul.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Ul);function Ul(){var e=this;this.networkAvailableListener=function(){return e.onNetworkAvailable()},this.networkUnavailableListener=function(){return e.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var jl=(Kl.prototype.addCallback=function(e){},Kl.prototype.shutdown=function(){},Kl);function Kl(){}function zl(e){return new Na(e,!0)}var Gl=(Ql.prototype.initialize=function(t){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.serializer=zl(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.createGarbageCollectionScheduler(t),this.localStore=this.createLocalStore(t),[2]}})})},Ql.prototype.createGarbageCollectionScheduler=function(e){return null},Ql.prototype.createLocalStore=function(e){return t=this.persistence,n=new cl,r=e.initialUser,e=this.serializer,new Eu(t,n,r,e);var t,n,r},Ql.prototype.createPersistence=function(e){return new El(Dl.factory,this.serializer)},Ql.prototype.createSharedClientState=function(e){return new sl},Ql.prototype.terminate=function(){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return e.sent(),[4,this.persistence.shutdown()];case 2:return e.sent(),[2]}})})},Ql);function Ql(){this.synchronizeTabs=!1}var Wl=(Hl.prototype.initialize=function(n,r){return f(this,void 0,void 0,function(){var t=this;return d(this,function(e){switch(e.label){case 0:return this.localStore?[2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Jc(t.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=function(i,o){return f(this,void 0,void 0,function(){var n,r;return d(this,function(e){switch(e.label){case 0:return(n=Vr(i,Wc)).currentUser.isEqual(o)?[3,3]:(Rr(zc,"User change. New user:",o.toKey()),[4,Iu(n.localStore,o)]);case 1:return r=e.sent(),n.currentUser=o,(t=n).pendingWritesCallbacks.forEach(function(e){e.forEach(function(e){e.reject(new Cr(Sr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.pendingWritesCallbacks.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,il(n,r.affectedDocuments)];case 2:e.sent(),e.label=3;case 3:return[2]}var t})})}.bind(null,this.syncEngine),[4,function(n,r){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return t=Vr(n,Hu),r?(t.offlineCauses.delete(2),[4,Yu(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return r?[3,4]:(t.offlineCauses.add(2),[4,Xu(t)]);case 3:e.sent(),t.onlineStateTracker.set("Unknown"),e.label=4;case 4:return[2]}})})}(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:return e.sent(),[2]}})})},Hl.prototype.createEventManager=function(e){return new Ac},Hl.prototype.createDatastore=function(e){var t=zl(e.databaseInfo.databaseId),n=(n=e.databaseInfo,new Fl(n));return e=e.credentials,new ju(e,n,t)},Hl.prototype.createRemoteStore=function(e){var t=this,n=this.localStore,r=this.datastore,i=e.asyncQueue,o=function(e){return Jc(t.syncEngine,e,0)};return e=new(Bl.isAvailable()?Bl:jl),new Hu(n,r,i,o,e)},Hl.prototype.createSyncEngine=function(e,t){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,a=e.initialUser,e=e.maxConcurrentLimboResolutions,e=new Wc(n,r,i,o,a,e),t&&(e._isPrimaryClient=!0),e;var n,r,i,o,a},Hl.prototype.terminate=function(){return function(n){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return t=Vr(n,Hu),Rr(Qu,"RemoteStore shutting down."),t.offlineCauses.add(5),[4,Xu(t)];case 1:return e.sent(),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown"),[2]}})})}(this.remoteStore)},Hl);function Hl(){}var Yl=(Xl.prototype.next=function(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)},Xl.prototype.error=function(e){this.observer.error?this.scheduleEvent(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)},Xl.prototype.mute=function(){this.muted=!0},Xl.prototype.scheduleEvent=function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)},Xl);function Xl(e){this.observer=e,this.muted=!1}var Jl=($l.prototype.lookup=function(r){return f(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Cr(Sr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(a,s){return f(this,void 0,void 0,function(){var i,t,n,o,r;return d(this,function(e){switch(e.label){case 0:return i=Vr(a,ju),t=ja(i.serializer)+"/documents",n={documents:s.map(function(e){return qa(i.serializer,e)})},[4,i.invokeStreamingRPC("BatchGetDocuments",t,n)];case 1:return n=e.sent(),o=new Map,n.forEach(function(e){var t,n,r;t=i.serializer,e="found"in(n=e)?function(e,t){xr(!!t.found,"Tried to deserialize a found document from a missing document."),ka(t.found.name,"doc.found.name"),ka(t.found.updateTime,"doc.found.updateTime");var n=Ba(e,t.found.name),e=xa(t.found.updateTime),t=new aa({mapValue:{fields:t.found.fields}});return new Mi(n,e,t,{})}(t,n):"missing"in n?(r=t,xr(!!(t=n).missing,"Tried to deserialize a missing document from a found document."),xr(!!t.readTime,"Tried to deserialize a missing document without a read time."),r=Ba(r,t.missing),t=xa(t.readTime),new Vi(r,t)):Mr("invalid batch get response: "+JSON.stringify(n)),o.set(e.key.toString(),e)}),r=[],s.forEach(function(e){var t=o.get(e.toString());xr(!!t,"Missing entity in write response for "+e),r.push(t)}),[2,r]}})})}(this.datastore,r)];case 1:return(t=e.sent()).forEach(function(e){e instanceof Vi||e instanceof Mi?n.recordVersion(e):Mr("Document in a transaction was a "+e.constructor.name)}),[2,t]}})})},$l.prototype.set=function(e,t){this.write(t.toMutations(e,this.precondition(e))),this.writtenDocs.add(e.toString())},$l.prototype.update=function(e,t){try{this.write(t.toMutations(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())},$l.prototype.delete=function(e){this.write([new js(e,this.precondition(e))]),this.writtenDocs.add(e.toString())},$l.prototype.commit=function(){return f(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(e,t){t=ui.fromPath(t),n.mutations.push(new Gs(t,n.precondition(t)))}),[4,function(i,o){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return t=Vr(i,ju),n=ja(t.serializer)+"/documents",r={writes:o.map(function(e){return Ga(t.serializer,e)})},[4,t.invokeRPC("Commit",n,r)];case 1:return e.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},$l.prototype.recordVersion=function(e){var t;if(e instanceof Mi)t=e.version;else{if(!(e instanceof Vi))throw Mr("Document in a transaction was a "+e.constructor.name);t=Uo.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Cr(Sr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)},$l.prototype.precondition=function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Ts.updateTime(t):Ts.none()},$l.prototype.preconditionForUpdate=function(e){var t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return Ts.exists(!0);if(t.isEqual(Uo.min()))throw new Cr(Sr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ts.updateTime(t)},$l.prototype.write=function(e){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(e)},$l.prototype.ensureCommitNotCalled=function(){Fr(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},$l);function $l(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}var Zl=(eh.prototype.run=function(){this.runWithBackOff()},eh.prototype.runWithBackOff=function(){var e=this;this.backoff.backoffAndRun(function(){return f(e,void 0,void 0,function(){var t,n,r=this;return d(this,function(e){return t=new Jl(this.datastore),(n=this.tryRunUpdateFunction(t))&&n.then(function(e){r.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){r.deferred.resolve(e)}).catch(function(e){r.handleTransactionError(e)})})}).catch(function(e){r.handleTransactionError(e)}),[2]})})})},eh.prototype.tryRunUpdateFunction=function(e){try{var t=this.updateFunction(e);return!Jr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}},eh.prototype.handleTransactionError=function(e){var t=this;0<this.retries&&this.isRetryableTransactionError(e)?(--this.retries,this.asyncQueue.enqueueAndForget(function(){return t.runWithBackOff(),Promise.resolve()})):this.deferred.reject(e)},eh.prototype.isRetryableTransactionError=function(e){return"FirebaseError"===e.name&&("aborted"===(e=e.code)||"failed-precondition"===e||!fa(e))},eh);function eh(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new Ru(this.asyncQueue,"transaction_retry")}var th="FirestoreClient",nh=(rh.prototype.getConfiguration=function(){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return e.sent(),[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}})})},rh.prototype.setCredentialChangeListener=function(e){var t=this;this.credentialListener=e,this.receivedInitialUser.promise.then(function(){return t.credentialListener(t.user)})},rh.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Cr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},rh.prototype.terminate=function(){var e=this;this.asyncQueue.enterRestrictedMode();var n=new gu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return f(e,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return t=wc(e.sent(),"Failed to shutdown persistence"),n.reject(t),[3,6];case 6:return[2]}})})}),n.promise},rh);function rh(e,t,n){var r=this;this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=Er.UNAUTHENTICATED,this.clientId=qr.newId(),this.credentialListener=function(){},this.receivedInitialUser=new gu,this.credentials.setChangeListener(function(e){Rr(th,"Received user=",e.uid),r.user.isEqual(e)||(r.user=e,r.credentialListener(e)),r.receivedInitialUser.resolve()})}function ih(t){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Rr(th,"Using default OfflineComponentProvider"),[4,function(r,i){return f(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:return r.asyncQueue.verifyOperationInProgress(),Rr(th,"Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return t=e.sent(),[4,i.initialize(t)];case 2:return e.sent(),r.setCredentialChangeListener(function(t){return r.asyncQueue.enqueueRetryable(function(){return f(n,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,Iu(i.localStore,t)];case 1:return e.sent(),[2]}})})})}),i.persistence.setDatabaseDeletedListener(function(){return r.terminate()}),r.offlineComponents=i,[2]}})})}(t,new Gl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function oh(t){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Rr(th,"Using default OnlineComponentProvider"),[4,function(r,i){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,ih(r)];case 1:return t=e.sent(),Rr(th,"Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=e.sent(),[4,i.initialize(t,n)];case 3:return e.sent(),r.setCredentialChangeListener(function(e){return r.asyncQueue.enqueueRetryable(function(){return function(r,i){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return(t=Vr(r,Hu)).asyncQueue.verifyOperationInProgress(),Fr(!!t.remoteSyncer.handleCredentialChange,"handleCredentialChange() not set"),Rr(Qu,"RemoteStore received new credentials"),n=rc(t),t.offlineCauses.add(3),[4,Xu(t)];case 1:return e.sent(),n&&t.onlineStateTracker.set("Unknown"),[4,t.remoteSyncer.handleCredentialChange(i)];case 2:return e.sent(),t.offlineCauses.delete(3),[4,Yu(t)];case 3:return e.sent(),[2]}})})}(i.remoteStore,e)})}),r.onlineComponents=i,[2]}})})}(t,new Wl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function ah(e){return ih(e).then(function(e){return e.persistence})}function sh(e){return ih(e).then(function(e){return e.localStore})}function uh(e){return oh(e).then(function(e){return e.remoteStore})}function ch(e){return oh(e).then(function(e){return e.syncEngine})}function lh(r){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return[4,oh(r)];case 1:return t=e.sent(),(n=t.eventManager).onListen=function(c,l){return f(this,void 0,void 0,function(){var n,o,a,s,u;return d(this,function(e){switch(e.label){case 0:return(t=Vr(t=c,Wc)).remoteStore.remoteSyncer.applyRemoteEvent=Xc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){var n=Vr(e,Wc);if((e=n.activeLimboResolutionsByTarget.get(t))&&e.receivedDocument)return ia().add(e.key);var r=ia();if(!(t=n.queriesByTarget.get(t)))return r;for(var i=0,o=t;i<o.length;i++){var a=o[i],s=n.queryViewsByQuery.get(a);Fr(!!s,"No query view found for "+so(a)),r=r.unionWith(s.view.syncedDocuments)}return r}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=function(o,a,s){return f(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){switch(e.label){case 0:return(t=Vr(o,Wc)).sharedClientState.updateQueryState(a,"rejected",s),i=t.activeLimboResolutionsByTarget.get(a),(n=i&&i.key)?(r=(r=new Ko(ui.comparator)).insert(n,new Vi(n,Uo.min())),i=ia().add(n),i=new pa(Uo.min(),new Map,new Xo(Ur),r,i),[4,Xc(t,i)]):[3,2];case 1:return e.sent(),t.activeLimboTargetsByKey=t.activeLimboTargetsByKey.remove(n),t.activeLimboResolutionsByTarget.delete(a),rl(t),[3,4];case 2:return[4,Au(t.localStore,a,!1).then(function(){return el(t,a,s)}).catch(Nu)];case 3:e.sent(),e.label=4;case 4:return[2]}})})}.bind(null,t),t.syncEngineListener.onWatchChange=function(e,t){for(var n=Vr(e,Ac),r=!1,i=0,o=t;i<o.length;i++){var a=o[i],s=a.query;if(s=n.queries.get(s)){for(var u=0,c=s.listeners;u<c.length;u++)c[u].onViewSnapshot(a)&&(r=!0);s.viewSnap=a}}r&&Rc(n)}.bind(null,t.eventManager),t.syncEngineListener.onWatchError=function(e,t,n){var r=Vr(e,Ac);if(e=r.queries.get(t))for(var i=0,o=e.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(t)}.bind(null,t.eventManager),(u=(n=t).queryViewsByQuery.get(l))?(o=u.targetId,n.sharedClientState.addLocalQueryTarget(o),a=u.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,(t=n.localStore,r=ro(l),(i=Vr(t,Eu)).persistence.runTransaction("Allocate target","readwrite",function(t){var n;return i.targetCache.getTargetData(t,r).next(function(e){return e?(n=e,eu.resolve(n)):i.targetCache.allocateTargetId(t).next(function(e){return n=new au(r,e,0,t.currentSequenceNumber),i.targetCache.addTargetData(t,n).next(function(){return n})})})}).then(function(e){var t=i.targetDataByTarget.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.targetDataByTarget=i.targetDataByTarget.insert(e.targetId,e),i.targetIdByTarget.set(r,e.targetId)),e}))];case 2:return s=e.sent(),u=n.sharedClientState.addLocalQueryTarget(s.targetId),o=s.targetId,[4,function(i,o,a,s){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return i.applyDocChanges=function(e,t,n){return function(r,i,o,a){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return(t=i.view.computeDocChanges(o)).needsRefill?[4,ku(r.localStore,i.query,!1).then(function(e){return e=e.documents,i.view.computeDocChanges(e,t)})]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return n=a&&a.targetChanges.get(i.targetId),n=i.view.applyChanges(t,r.isPrimaryClient,n),nl(r,i.targetId,n.limboChanges),[2,n.snapshot]}})})}(i,e,t,n)},[4,ku(i.localStore,o,!0)];case 1:return n=e.sent(),r=new jc(o,n.remoteKeys),t=r.computeDocChanges(n.documents),n=ga.createSynthesizedTargetChangeForCurrentChange(a,s&&"Offline"!==i.onlineState),n=r.applyChanges(t,i.isPrimaryClient,n),nl(i,a,n.limboChanges),Fr(!!n.snapshot,"applyChanges for new view should always return a snapshot"),r=new Gc(o,a,r),i.queryViewsByQuery.set(o,r),i.queriesByTarget.has(a)?i.queriesByTarget.get(a).push(o):i.queriesByTarget.set(a,[o]),[2,n.snapshot]}})})}(n,l,o,"current"===u)];case 3:a=e.sent(),n.isPrimaryClient&&Ju(n.remoteStore,s),e.label=4;case 4:return[2,a]}var t,r,i})})}.bind(null,t.syncEngine),n.onUnlisten=function(i,o){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return t=Vr(i,Wc),Fr(!!(n=t.queryViewsByQuery.get(o)),"Trying to unlisten on query not found:"+so(o)),1<(r=t.queriesByTarget.get(n.targetId)).length?(t.queriesByTarget.set(n.targetId,r.filter(function(e){return!oo(e,o)})),t.queryViewsByQuery.delete(o),[2]):t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(n.targetId),t.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,Au(t.localStore,n.targetId,!1).then(function(){t.sharedClientState.clearQueryState(n.targetId),$u(t.remoteStore,n.targetId),el(t,n.targetId)}).catch(Nu)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return el(t,n.targetId),[4,Au(t.localStore,n.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}})})}.bind(null,t.syncEngine),[2,n]}})})}function hh(u,c,l){var e=this;void 0===l&&(l={});var h=new gu;return u.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,lh(u)];case 1:return t=e.sent(),[2,(n=t,r=u.asyncQueue,i=c,o=l,a=h,e=new Yl({next:function(e){r.enqueueAndForget(function(){return Nc(n,s)});var t=e.docs.has(i);!t&&e.fromCache?a.reject(new Cr(Sr.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&o&&"server"===o.source?a.reject(new Cr(Sr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):(Fr(e.docs.size<=1,"Expected zero or a single result on a document-only query"),a.resolve(e))},error:function(e){return a.reject(e)}}),s=new Oc(Yi(i.path),e,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0}),kc(n,s))]}var n,r,i,o,a,s})})}),h.promise}function fh(u,c,l){var e=this;void 0===l&&(l={});var h=new gu;return u.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){var s;return d(this,function(e){switch(e.label){case 0:return[4,lh(u)];case 1:return s=e.sent(),[2,(t=s,n=u.asyncQueue,r=c,i=l,o=h,e=new Yl({next:function(e){n.enqueueAndForget(function(){return Nc(t,a)}),e.fromCache&&"server"===i.source?o.reject(new Cr(Sr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(e)},error:function(e){return o.reject(e)}}),a=new Oc(r,e,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0}),kc(t,a))]}var t,n,r,i,o,a})})}),h.promise}function dh(e,t,n){if(!n)throw new Cr(Sr.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function ph(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function yh(e,t,n,r){if(!0===t&&!0===r)throw new Cr(Sr.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function gh(e){if(!ui.isDocumentKey(e))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function mh(e){if(ui.isDocumentKey(e))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function vh(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?(20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e)):"number"==typeof e||"boolean"==typeof e?""+e:"object"!=typeof e?"function"==typeof e?"a function":Mr("Unknown wrong type: "+typeof e):e instanceof Array?"an array":(e=(t=e).constructor&&(t=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString()))&&1<t.length?t[1]:null)?"a custom "+e+" object":"an object";var t}function wh(e,t){if("_delegate"in e&&(e=e._delegate),e instanceof t)return e;if(t.name===e.constructor.name)throw new Cr(Sr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw e=vh(e),new Cr(Sr.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+e)}function bh(e,t){if(t<=0)throw new Cr(Sr.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}function Th(i){return function(){if("object"==typeof i&&null!==i)for(var e=i,t=0,n=["next","error","complete"];t<n.length;t++){var r=n[t];if(r in e&&"function"==typeof e[r])return 1}}()}var Eh=(Object.defineProperty(_h.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(_h.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),_h.prototype.isEqual=function(e){return this._lat===e._lat&&this._long===e._long},_h.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},_h.prototype._compareTo=function(e){return Ur(this._lat,e._lat)||Ur(this._long,e._long)},_h);function _h(e,t){if(!isFinite(e)||e<-90||90<e)throw new Cr(Sr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new Cr(Sr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}var Ih=(Sh.fromBase64String=function(e){try{return new Sh(Yr.fromBase64String(e))}catch(e){throw new Cr(Sr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},Sh.fromUint8Array=function(e){return new Sh(Yr.fromUint8Array(e))},Sh.prototype.toBase64=function(){return this._byteString.toBase64()},Sh.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},Sh.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Sh.prototype.isEqual=function(e){return this._byteString.isEqual(e._byteString)},Sh);function Sh(e){this._byteString=e}var Ch=function(e){this._delegate=e};function Dh(){if("undefined"==typeof Uint8Array)throw new Cr(Sr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ah(){if("undefined"==typeof atob)throw new Cr(Sr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var kh,Nh=(n(Rh,kh=Ch),Rh.fromBase64String=function(e){return Ah(),new Rh(Ih.fromBase64String(e))},Rh.fromUint8Array=function(e){return Dh(),new Rh(Ih.fromUint8Array(e))},Rh.prototype.toBase64=function(){return Ah(),this._delegate.toBase64()},Rh.prototype.toUint8Array=function(){return Dh(),this._delegate.toUint8Array()},Rh.prototype.isEqual=function(e){return this._delegate.isEqual(e._delegate)},Rh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Rh);function Rh(){return null!==kh&&kh.apply(this,arguments)||this}function Oh(){}Oh.prototype.convertValue=function(e,t){switch(void 0===t&&(t="none"),mi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ii(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Si(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Mr("Invalid value type: "+JSON.stringify(e))}},Oh.prototype.convertObject=function(e,n){var r=this,i={};return Wr(e.fields||{},function(e,t){i[e]=r.convertValue(t,n)}),i},Oh.prototype.convertGeoPoint=function(e){return new Eh(Ii(e.latitude),Ii(e.longitude))},Oh.prototype.convertArray=function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})},Oh.prototype.convertServerTimestamp=function(e,t){switch(t){case"previous":var n=function e(t){return pi(t=t.mapValue.fields[fi])?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(yi(e));default:return null}},Oh.prototype.convertTimestamp=function(e){return e=_i(e),new zr(e.seconds,e.nanos)},Oh.prototype.convertDocumentKey=function(e,t){var n=ni.fromString(e);return xr($a(n),"ReferenceValue is not valid "+e),e=new br(n.get(1),n.get(3)),n=new ui(n.popFirst(5)),e.isEqual(t)||Or("Document "+n+" contains a document reference within a different database ("+e.projectId+"/"+e.database+") which is not supported. It will be treated as a reference in the current database ("+t.projectId+"/"+t.database+") instead."),n};var Lh,Ph=(n(Mh,Lh=mt=Oh),Mh.prototype.convertBytes=function(e){return new Nh(new Ih(e))},Mh.prototype.convertReference=function(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),yp.forKey(e,this.firestore,null)},Mh);function Mh(e){var t=Lh.call(this)||this;return t.firestore=e,t}function xh(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e}var Fh=(Vh.prototype.getToken=function(){return Promise.resolve(null)},Vh.prototype.invalidateToken=function(){},Vh.prototype.setChangeListener=function(e){Fr(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=e)(Er.UNAUTHENTICATED)},Vh.prototype.removeChangeListener=function(){this.changeListener=null},Vh);function Vh(){this.changeListener=null}var qh=(Bh.prototype.getToken=function(){var t=this;Fr(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(function(e){return t.tokenCounter!==n?(Rr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):e?(xr("string"==typeof e.accessToken,"Invalid tokenData returned from getToken():"+e),new xh(e.accessToken,t.currentUser)):null}):Promise.resolve(null)},Bh.prototype.invalidateToken=function(){this.forceRefresh=!0},Bh.prototype.setChangeListener=function(e){Fr(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=e,this.receivedInitialUser&&e(this.currentUser)},Bh.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},Bh.prototype.getUser=function(){var e=this.auth&&this.auth.getUid();return xr(null===e||"string"==typeof e,"Received invalid UID: "+e),new Er(e)},Bh);function Bh(e){var t=this;this.tokenListener=null,this.currentUser=Er.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){t.tokenCounter++,t.currentUser=t.getUser(),t.receivedInitialUser=!0,t.changeListener&&t.changeListener(t.currentUser)},this.tokenCounter=0,this.auth=e.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),e.get().then(function(e){t.auth=e,t.tokenListener&&t.auth.addAuthTokenListener(t.tokenListener)},function(){}))}var Uh=(Object.defineProperty(jh.prototype,"authHeaders",{get:function(){var e={"X-Goog-AuthUser":this.sessionIndex},t=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),e},enumerable:!1,configurable:!0}),jh);function jh(e,t){this.gapi=e,this.sessionIndex=t,this.type="FirstParty",this.user=Er.FIRST_PARTY}var Kh=(zh.prototype.getToken=function(){return Promise.resolve(new Uh(this.gapi,this.sessionIndex))},zh.prototype.setChangeListener=function(e){e(Er.FIRST_PARTY)},zh.prototype.removeChangeListener=function(){},zh.prototype.invalidateToken=function(){},zh);function zh(e,t){this.gapi=e,this.sessionIndex=t}var Gh=new Map,Qh=(Wh.prototype.isEqual=function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties},Wh);function Wh(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Cr(Sr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Cr(Sr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,yh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}var Hh=(Object.defineProperty(Yh.prototype,"app",{get:function(){if(!this._app)throw new Cr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(Yh.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(Yh.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),Yh.prototype._setSettings=function(e){if(this._settingsFrozen)throw new Cr(Sr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qh(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new Fh;switch(e.type){case"gapi":var t=e.client;return xr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new Kh(t,e.sessionIndex||"0");case"provider":return e.client;default:throw new Cr(Sr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Yh.prototype._getSettings=function(){return this._settings},Yh.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},Yh.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},Yh.prototype._terminate=function(){var e;return(e=Gh.get(this))&&(Rr("ComponentProvider","Removing Datastore"),Gh.delete(this),e.terminate()),Promise.resolve()},Yh);function Yh(e,t){this._persistenceKey="(lite)",this._settings=new Qh({}),this._settingsFrozen=!1,e instanceof br?(this._databaseId=e,this._credentials=new Fh):(this._app=e,this._databaseId=function(e){if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new br(e.options.projectId);throw new Cr(Sr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')}(e),this._credentials=new qh(t))}var Xh,Jh=(n($h,Xh=Hh),$h.prototype._terminate=function(){return this._firestoreClient||sp(this),this._firestoreClient.terminate()},$h);function $h(e,t){return(t=Xh.call(this,e,t)||this)._queue=new mc,t._persistenceKey="name"in e?e.name:"[DEFAULT]",t}function Zh(e){return function(t){var e=this,n=new gu;return t.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,ch(t)];case 1:return[2,function(a,s){return f(this,void 0,void 0,function(){var r,i,o;return d(this,function(e){switch(e.label){case 0:rc((r=Vr(a,Wc)).remoteStore)||Rr(zc,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(t=r.localStore,(n=Vr(t,Eu)).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(e){return n.mutationQueue.getHighestUnacknowledgedBatchId(e)}))];case 2:return(i=e.sent())===Ws?(s.resolve(),[2]):((o=r.pendingWritesCallbacks.get(i)||[]).push(s),r.pendingWritesCallbacks.set(i,o),[3,4]);case 3:return o=wc(o=e.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(o),[3,4];case 4:return[2]}var t,n})})}(e.sent(),n)]}})})}),n.promise}(ap(e=wh(e,Jh)))}var ef,tf=function(e){this._methodName=e},nf=(n(rf,ef=tf),rf.prototype._toFieldTransform=function(e){if(2!==e.dataSource)throw 1===e.dataSource?(Fr(0<e.path.length,this._methodName+"() at the top level should have already been handled."),e.createError(this._methodName+"() can only appear at the top level of your update data")):e.createError(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null},rf.prototype.isEqual=function(e){return e instanceof rf},rf);function rf(){return null!==ef&&ef.apply(this,arguments)||this}function of(e,t,n){return new Cf({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var af,sf=(n(uf,af=tf),uf.prototype._toFieldTransform=function(e){return new vs(e.path,new ts)},uf.prototype.isEqual=function(e){return e instanceof uf},uf);function uf(){return null!==af&&af.apply(this,arguments)||this}var cf,lf=(n(hf,cf=tf),hf.prototype._toFieldTransform=function(e){var t=of(this,e,!0),n=this._elements.map(function(e){return Pf(e,t)}),n=new is(n);return new vs(e.path,n)},hf.prototype.isEqual=function(e){return this===e},hf);function hf(e,t){return(e=cf.call(this,e)||this)._elements=t,e}var ff,df=(n(pf,ff=tf),pf.prototype._toFieldTransform=function(e){var t=of(this,e,!0),n=this._elements.map(function(e){return Pf(e,t)}),n=new us(n);return new vs(e.path,n)},pf.prototype.isEqual=function(e){return this===e},pf);function pf(e,t){return(e=ff.call(this,e)||this)._elements=t,e}var yf,gf=(n(mf,yf=tf),mf.prototype._toFieldTransform=function(e){var t=new fs(e.serializer,La(e.serializer,this._operand));return new vs(e.path,t)},mf.prototype.isEqual=function(e){return this===e},mf);function mf(e,t){return(e=yf.call(this,e)||this)._operand=t,e}var vf=(wf.prototype.isEqual=function(e){return this._internalPath.isEqual(e._internalPath)},wf);function wf(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0;n<e.length;++n)if(0===e[n].length)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ai(e)}var bf=/^__.*__$/,Tf=(Ef.prototype.toMutations=function(e,t){var n=[];return null!==this.fieldMask?n.push(new Ls(e,this.data,this.fieldMask,t)):n.push(new Ns(e,this.data,t)),0<this.fieldTransforms.length&&n.push(new Fs(e,this.fieldTransforms)),n},Ef);function Ef(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}var _f=(If.prototype.toMutations=function(e,t){return t=[new Ls(e,this.data,this.fieldMask,t)],0<this.fieldTransforms.length&&t.push(new Fs(e,this.fieldTransforms)),t},If);function If(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}function Sf(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Mr("Unexpected case for UserDataSource: "+e)}}var Cf=(Object.defineProperty(Df.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Df.prototype,"dataSource",{get:function(){return this.settings.dataSource},enumerable:!1,configurable:!0}),Df.prototype.contextWith=function(e){return new Df(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},Df.prototype.childContextForField=function(e){var t=null===(t=this.path)||void 0===t?void 0:t.child(e);return(t=this.contextWith({path:t,arrayElement:!1})).validatePathSegment(e),t},Df.prototype.childContextForFieldPath=function(e){var t,e=null===(t=this.path)||void 0===t?void 0:t.child(e);return(e=this.contextWith({path:e,arrayElement:!1})).validatePath(),e},Df.prototype.childContextForArray=function(e){return this.contextWith({path:void 0,arrayElement:!0})},Df.prototype.createError=function(e){return Uf(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)},Df.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},Df.prototype.validatePath=function(){if(this.path)for(var e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))},Df.prototype.validatePathSegment=function(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(Sf(this.dataSource)&&bf.test(e))throw this.createError('Document fields cannot begin and end with "__"')},Df);function Df(e,t,n,r,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=o||[]}var Af=(kf.prototype.createContext=function(e,t,n,r){return void 0===r&&(r=!1),new Cf({dataSource:e,methodName:t,targetDoc:n,path:ai.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)},kf);function kf(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||zl(e)}function Nf(e,t,n,r,i,o){void 0===o&&(o={});var a=e.createContext(o.merge||o.mergeFields?2:0,t,n,i);Ff("Data must be an object, but it was:",a,r);var s,u,r=Mf(r,a);if(o.merge)s=new gs(a.fieldMask),u=a.fieldTransforms;else if(o.mergeFields){for(var c=[],l=0,h=o.mergeFields;l<h.length;l++){var f=Vf(t,h[l],n);if(!a.contains(f))throw new Cr(Sr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");jf(c,f)||c.push(f)}s=new gs(c),u=a.fieldTransforms.filter(function(e){return s.covers(e.field)})}else s=null,u=a.fieldTransforms;return new Tf(new aa(r),s,u)}function Rf(e,r,i,t){var o=e.createContext(1,r,i);Ff("Data must be an object, but it was:",o,t);var a=[],s=new ua;return Wr(t,function(e,t){var n=Bf(r,e,i);t instanceof Ch&&(t=t._delegate),e=o.childContextForFieldPath(n),t instanceof nf?a.push(n):null!=(e=Pf(t,e))&&(a.push(n),s.set(n,e))}),t=new gs(a),new _f(s.build(),t,o.fieldTransforms)}function Of(e,t,n,r,i,o){var a=e.createContext(1,t,n),s=[Vf(t,r,n)],u=[i];if(o.length%2!=0)throw new Cr(Sr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)s.push(Vf(t,o[c])),u.push(o[c+1]);for(var l,h,f,d=[],p=new ua,c=s.length-1;0<=c;--c)jf(d,s[c])||(l=s[c],(h=u[c])instanceof Ch&&(h=h._delegate),f=a.childContextForFieldPath(l),h instanceof nf?d.push(l):null!=(f=Pf(h,f))&&(d.push(l),p.set(l,f)));return i=new gs(d),new _f(p.build(),i,a.fieldTransforms)}function Lf(e,t,n,r){return void 0===r&&(r=!1),Fr(null!=(n=Pf(n,t=e.createContext(r?4:3,t))),"Parsed data should not be null."),Fr(0===t.fieldTransforms.length,"Field transforms should have been disallowed."),n}function Pf(a,e){if(a instanceof Ch&&(a=a._delegate),xf(a))return Ff("Unsupported field value:",e,a),Mf(a,e);if(a instanceof tf)return function(e,t){if(!Sf(t.dataSource))throw t.createError(e._methodName+"() can only be used with update() and set()");if(!t.path)throw t.createError(e._methodName+"() is not currently supported inside arrays");(e=e._toFieldTransform(t))&&t.fieldTransforms.push(e)}(a,e),null;if(e.path&&e.fieldMask.push(e.path),a instanceof Array){if(e.settings.arrayElement&&4!==e.dataSource)throw e.createError("Nested arrays are not supported");return function(e){for(var t=[],n=0,r=0,i=a;r<i.length;r++){var o=Pf(i[r],e.childContextForArray(n));null==o&&(o={nullValue:"NULL_VALUE"}),t.push(o),n++}return{arrayValue:{values:t}}}(e)}return function(e,t){if(e instanceof Ch&&(e=e._delegate),null===e)return{nullValue:"NULL_VALUE"};if("number"==typeof e)return La(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=zr.fromDate(e);return{timestampValue:Pa(t.serializer,n)}}if(e instanceof zr)return n=new zr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)),{timestampValue:Pa(t.serializer,n)};if(e instanceof Eh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ih)return{bytesValue:Ma(t.serializer,e._byteString)};if(e instanceof Xf){var r=t.databaseId;if(!(n=e.firestore._databaseId).isEqual(r))throw t.createError("Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+r.projectId+"/"+r.database);return{referenceValue:Fa(e.firestore._databaseId||t.databaseId,e._key.path)}}if(void 0===e&&t.ignoreUndefinedProperties)return null;throw t.createError("Unsupported field value: "+vh(e))}(a,e)}function Mf(e,n){var r={};return Hr(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Wr(e,function(e,t){null!=(t=Pf(t,n.childContextForField(e)))&&(r[e]=t)}),{mapValue:{fields:r}}}function xf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof zr||e instanceof Eh||e instanceof Ih||e instanceof Xf||e instanceof tf)}function Ff(e,t,n){if(!xf(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=vh(n))?t.createError(e+" a custom object"):t.createError(e+" "+n);var r}function Vf(e,t,n){if(t instanceof Ch&&(t=t._delegate),t instanceof vf)return t._internalPath;if("string"==typeof t)return Bf(e,t);throw Uf("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var qf=new RegExp("[~\\*/\\[\\]]");function Bf(t,n,r){if(0<=n.search(qf))throw Uf("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,r);try{return(new(vf.bind.apply(vf,a([void 0],n.split(".")))))._internalPath}catch(e){throw Uf("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,r)}}function Uf(e,t,n,r,i){var o=r&&!r.isEmpty(),a=void 0!==i,t="Function "+t+"() called with invalid data";return n&&(t+=" (via `toFirestore()`)"),t+=". ",n="",(o||a)&&(n+=" (found",o&&(n+=" in field "+r),a&&(n+=" in document "+i),n+=")"),new Cr(Sr.INVALID_ARGUMENT,t+e+n)}function jf(e,t){return e.some(function(e){return e.isEqual(t)})}var Kf,zf=(n(Gf,Kf=mt),Gf.prototype.convertBytes=function(e){return new Ih(e)},Gf.prototype.convertReference=function(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),new Xf(this.firestore,null,e)},Gf);function Gf(e){var t=Kf.call(this)||this;return t.firestore=e,t}function Qf(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=wh(e,Xf);var o=wh(e.firestore,Jh),a=Rd(o);return t instanceof Ch&&(t=t._delegate),Hf(o,("string"==typeof t||t instanceof vf?Of(a,"updateDoc",e._key,t,n,r):Rf(a,"updateDoc",e._key,t)).toMutations(e._key,Ts.exists(!0)))}function Wf(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];t instanceof Ch&&(t=t._delegate);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||Th(n[i])||(r=n[i],i++);var o,a,s,u,c,l,h={includeMetadataChanges:r.includeMetadataChanges};return Th(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),t instanceof Xf?(s=wh(t.firestore,Jh),u=Yi(t._key.path),l={next:function(e){n[i]&&n[i](Yf(s,t,e))},error:n[i+1],complete:n[i+2]}):(a=wh(t,$f),s=wh(a.firestore,Jh),u=a._query,c=new zf(s),l={next:function(e){n[i]&&n[i](new zd(s,c,a,e))},error:n[i+1],complete:n[i+2]},bd(t._query)),function(t,e,n){var r=this,i=new Yl(l),o=new Oc(e,i,n);return t.asyncQueue.enqueueAndForget(function(){return f(r,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,lh(t)];case 1:return[2,kc(e.sent(),o)]}})})}),function(){i.mute(),t.asyncQueue.enqueueAndForget(function(){return f(r,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,lh(t)];case 1:return[2,Nc(e.sent(),o)]}})})})}}(ap(s),u,h)}function Hf(e,t){return function(t,n){var e=this,r=new gu;return t.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,ch(t)];case 1:return[2,Yc(e.sent(),n,r)]}})})}),r.promise}(ap(e),t)}function Yf(e,t,n){Fr(n.docs.size<=1,"Expected zero or a single result on a document-only query");var r=n.docs.get(t._key),i=new zf(e);return new qd(e,i,t._key,r,new bp(n.hasPendingWrites,n.fromCache),t._converter)}var Xf=(Object.defineProperty(Jf.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(Jf.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Jf.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Jf.prototype,"parent",{get:function(){return new Ed(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),Jf.prototype.withConverter=function(e){return new Jf(this.firestore,e,this._key)},Jf);function Jf(e,t,n){this._converter=t,this._key=n,this.type="document",this.firestore=e}var $f=(Zf.prototype.withConverter=function(e){return new Zf(this.firestore,e,this._query)},Zf);function Zf(e,t,n){this._converter=t,this._query=n,this.type="query",this.firestore=e}function ed(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++)e=i[r]._apply(e);return e}var td,nd=(n(rd,td=vt=function(){}),rd.prototype._apply=function(e){var t=Rd(e.firestore),t=function(e,t,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){vd(o,i);for(var a=[],s=0,u=o;s<u.length;s++){var c=u[s];a.push(md(n,e,c))}l={arrayValue:{values:a}}}else l=md(n,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||vd(o,i),l=Lf(t,"where",o,"in"===i||"not-in"===i);var l=ho.create(r,i,l);return function(e,t){if(Fr(t instanceof ho,"Only FieldFilters are supported"),t.isInequality()){var n=Zi(e);if(null!==n&&!n.isEqual(t.field))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+t.field.toString()+"'");null!==(n=$i(e))&&wd(0,t.field,n)}if(null!==(e=function(e,t){for(var n=0,r=e.filters;n<r.length;n++){var i=r[n];if(Fr(i instanceof ho,"Only FieldFilters are supported"),0<=t.indexOf(i.op))return i.op}return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw e===t.op?new Cr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Cr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+e.toString()+"' filters.")}(e,l),l}(e._query,t,e.firestore._databaseId,this._field,this._op,this._value);return new $f(e.firestore,e._converter,(Fr(null==Zi(e=e._query)||!(t instanceof ho)||!t.isInequality()||t.field.isEqual(Zi(e)),"Query must only have one inequality field."),Fr(!eo(e),"No filtering allowed for document query"),t=e.filters.concat([t]),new Hi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))},rd);function rd(e,t,n){var r=td.call(this)||this;return r._field=e,r._op=t,r._value=n,r.type="where",r}var id,od=(n(ad,id=vt),ad.prototype._apply=function(e){var t=function(e,t,n){if(null!==e.startAt)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return n=new Bo(t,n),t=n,null!==$i(e)||null!==(e=Zi(e))&&wd(0,e,t.field),n}(e._query,this._field,this._direction);return new $f(e.firestore,e._converter,(Fr(!(e=e._query).startAt&&!e.endAt,"Bounds must be set after orderBy"),t=e.explicitOrderBy.concat([t]),new Hi(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},ad);function ad(e,t){var n=id.call(this)||this;return n._field=e,n._direction=t,n.type="orderBy",n}var sd,ud=(n(cd,sd=vt),cd.prototype._apply=function(e){return new $f(e.firestore,e._converter,io(e._query,this._limit,this._limitType))},cd);function cd(e,t,n){var r=sd.call(this)||this;return r.type=e,r._limit=t,r._limitType=n,r}var ld,hd=(n(fd,ld=vt),fd.prototype._apply=function(e){var t=gd(e,this.type,this._docOrFields,this._before);return new $f(e.firestore,e._converter,(e=e._query,new Hi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))},fd);function fd(e,t,n){var r=ld.call(this)||this;return r.type=e,r._docOrFields=t,r._before=n,r}var dd,pd=(n(yd,dd=vt),yd.prototype._apply=function(e){var t=gd(e,this.type,this._docOrFields,this._before);return new $f(e.firestore,e._converter,(e=e._query,new Hi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))},yd);function yd(e,t,n){var r=dd.call(this)||this;return r.type=e,r._docOrFields=t,r._before=n,r}function gd(e,c,t,n){if(t[0]instanceof Ch&&(t[0]=t[0]._delegate),t[0]instanceof Od)return function(e,t,n,r){if(!n)throw new Cr(Sr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,a=no(e);o<a.length;o++){var s=a[o];if(s.field.isKeyField())i.push(Ci(t,n.key));else{var u=n.field(s.field);if(pi(u))throw new Cr(Sr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u)throw s=s.field.canonicalString(),new Cr(Sr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+s+"' (used as the orderBy) does not exist.");i.push(u)}}return new xo(i,r)}(e._query,e.firestore._databaseId,t[0]._document,n);var r=Rd(e.firestore);return function(e,t,n,r,i,o){var a=e.explicitOrderBy;if(i.length>a.length)throw new Cr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],u=0;u<i.length;u++){var c=i[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!to(e)&&-1!==c.indexOf("/"))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var l=e.path.child(ni.fromString(c));if(!ui.isDocumentKey(l))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+l+"' is not because it contains an odd number of segments.");l=new ui(l),s.push(Ci(t,l))}else c=Lf(n,r,c),s.push(c)}return new xo(s,o)}(e._query,e.firestore._databaseId,r,c,t,n)}function md(e,t,n){if(n instanceof Ch&&(n=n._delegate),"string"==typeof n){if(""===n)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!to(t)&&-1!==n.indexOf("/"))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(t=t.path.child(ni.fromString(n)),!ui.isDocumentKey(t))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+t+"' is not because it has an odd number of segments ("+t.length+").");return Ci(e,new ui(t))}if(n instanceof Xf)return Ci(e,n._key);throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+vh(n)+".")}function vd(e,t){if(!Array.isArray(e)||0===e.length)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(10<e.length)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function wd(e,t,n){if(!n.isEqual(t))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function bd(e){if(Ji(e)&&0===e.explicitOrderBy.length)throw new Cr(Sr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Td,Ed=(n(_d,Td=$f),Object.defineProperty(_d.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(_d.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(_d.prototype,"parent",{get:function(){var e=this._path.popLast();return e.isEmpty()?null:new Xf(this.firestore,null,new ui(e))},enumerable:!1,configurable:!0}),_d.prototype.withConverter=function(e){return new _d(this.firestore,e,this._path)},_d);function _d(e,t,n){return(t=Td.call(this,e,t,Yi(n))||this).firestore=e,t._path=n,t.type="collection",t}function Id(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e instanceof Ch&&(e=e._delegate),dh("collection","path",t),e instanceof Hh)return mh(n=ni.fromString.apply(ni,a([t],r))),new Ed(e,null,n);if(!(e instanceof Xf||e instanceof Ed))throw new Cr(Sr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return mh(n=ni.fromString.apply(ni,a([e.path],r)).child(ni.fromString(t))),new Ed(e.firestore,null,n)}function Sd(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e instanceof Ch&&(e=e._delegate),1===arguments.length&&(t=qr.newId()),dh("doc","path",t),e instanceof Hh)return gh(n=ni.fromString.apply(ni,a([t],r))),new Xf(e,null,new ui(n));if(!(e instanceof Xf||e instanceof Ed))throw new Cr(Sr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return gh(n=e._path.child(ni.fromString.apply(ni,a([t],r)))),new Xf(e.firestore,e instanceof Ed?e._converter:null,new ui(n))}var Cd,Dd=(n(Ad,Cd=mt),Ad.prototype.convertBytes=function(e){return new Ih(e)},Ad.prototype.convertReference=function(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),new Xf(this.firestore,null,e)},Ad);function Ad(e){var t=Cd.call(this)||this;return t.firestore=e,t}function kd(e,t){return e instanceof Ch&&(e=e._delegate),t instanceof Ch&&(t=t._delegate),(e instanceof Xf||e instanceof Ed)&&(t instanceof Xf||t instanceof Ed)&&e.firestore===t.firestore&&e.path===t.path&&e._converter===t._converter}function Nd(e,t){return e instanceof Ch&&(e=e._delegate),t instanceof Ch&&(t=t._delegate),e instanceof $f&&t instanceof $f&&e.firestore===t.firestore&&oo(e._query,t._query)&&e._converter===t._converter}function Rd(e){var t=e._freezeSettings(),n=zl(e._databaseId);return new Af(e._databaseId,!!t.ignoreUndefinedProperties,n)}var Od=(Object.defineProperty(Ld.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Ld.prototype,"ref",{get:function(){return new Xf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Ld.prototype.exists=function(){return null!==this._document},Ld.prototype.data=function(){if(this._document){if(this._converter){var e=new Md(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.toProto())}},Ld.prototype.get=function(e){if(this._document&&null!==(e=this._document.data().field(Fd("DocumentSnapshot.get",e))))return this._userDataWriter.convertValue(e)},Ld);function Ld(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}var Pd,Md=(n(xd,Pd=Od),xd.prototype.data=function(){return Pd.prototype.data.call(this)},xd);function xd(){return null!==Pd&&Pd.apply(this,arguments)||this}function Fd(e,t){return"string"==typeof t?Bf(e,t):(t instanceof Ch?t._delegate:t)._internalPath}var Vd,qd=(n(Bd,Vd=Od),Bd.prototype.exists=function(){return Vd.prototype.exists.call(this)},Bd.prototype.data=function(e){if(void 0===e&&(e={}),this._document){if(this._converter){var t=new jd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.toProto(),e.serverTimestamps)}},Bd.prototype.get=function(e,t){if(void 0===t&&(t={}),this._document&&null!==(e=this._document.data().field(Fd("DocumentSnapshot.get",e))))return this._userDataWriter.convertValue(e,t.serverTimestamps)},Bd);function Bd(e,t,n,r,i,o){return(o=Vd.call(this,e,t,n,r,o)||this)._firestore=e,o._firestoreImpl=e,o.metadata=i,o}var Ud,jd=(n(Kd,Ud=qd),Kd.prototype.data=function(e){return void 0===e&&(e={}),Ud.prototype.data.call(this,e)},Kd);function Kd(){return null!==Ud&&Ud.apply(this,arguments)||this}var zd=(Object.defineProperty(Gd.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(Gd.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Gd.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Gd.prototype.forEach=function(t,n){var r=this;this._snapshot.docs.forEach(function(e){t.call(n,new jd(r._firestore,r._userDataWriter,e.key,e,new bp(r._snapshot.mutatedKeys.has(e.key),r._snapshot.fromCache),r.query._converter))})},Gd.prototype.docChanges=function(e){if(void 0===e&&(e={}),(e=!!e.includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new Cr(Sr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){var n,r=0;return i._snapshot.docChanges.map(function(e){Fr(0===e.type,"Invalid event type for first snapshot"),Fr(!n||co(i._snapshot.query)(n,e.doc)<0,"Got added events in wrong order");var t=new jd(i._firestore,i._userDataWriter,e.doc.key,e.doc,new bp(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query._converter);return n=e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:r++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(e){var t=new jd(i._firestore,i._userDataWriter,e.doc.key,e.doc,new bp(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query._converter),n=-1,r=-1;return 0!==e.type&&(Fr(0<=(n=o.indexOf(e.doc.key)),"Index for document not found"),o=o.delete(e.doc.key)),1!==e.type&&(r=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Mr("Unknown change type: "+e)}}(e.type),doc:t,oldIndex:n,newIndex:r}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},Gd);function Gd(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new bp(r.hasPendingWrites,r.fromCache),this.query=n}function Qd(e,t){return e instanceof qd&&t instanceof qd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof zd&&t instanceof zd&&e._firestore===t._firestore&&Nd(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}var Wd=(Hd.prototype.set=function(e,t,n){return this._verifyNotCommitted(),t=Up((e=Yd(e,this._firestore))._converter,t,n),n=Nf(this._dataReader,"WriteBatch.set",e._key,t,null!==e._converter,n),this._mutations=this._mutations.concat(n.toMutations(e._key,Ts.none())),this},Hd.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this._verifyNotCommitted(),e=Yd(e,this._firestore),t instanceof Ch&&(t=t._delegate),t="string"==typeof t||t instanceof vf?Of(this._dataReader,"WriteBatch.update",e._key,t,n,r):Rf(this._dataReader,"WriteBatch.update",e._key,t),this._mutations=this._mutations.concat(t.toMutations(e._key,Ts.exists(!0))),this},Hd.prototype.delete=function(e){return this._verifyNotCommitted(),e=Yd(e,this._firestore),this._mutations=this._mutations.concat(new js(e._key,Ts.none())),this},Hd.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},Hd.prototype._verifyNotCommitted=function(){if(this._committed)throw new Cr(Sr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Hd);function Hd(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Rd(e)}function Yd(e,t){if(e instanceof Ch&&(e=e._delegate),e.firestore!==t)throw new Cr(Sr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Xd(e,t){this._firestore=e,this._transaction=t,this._dataReader=Rd(e)}Xd.prototype.get=function(e){var t=this,n=Yd(e,this._firestore),r=new Dd(this._firestore);return this._transaction.lookup([n._key]).then(function(e){if(!e||1!==e.length)return Mr("Mismatch in docs returned from document lookup.");if((e=e[0])instanceof Vi)return new Od(t._firestore,r,n._key,null,n._converter);if(e instanceof Mi)return new Od(t._firestore,r,e.key,e,n._converter);throw Mr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},Xd.prototype.set=function(e,t,n){return t=Up((e=Yd(e,this._firestore))._converter,t,n),n=Nf(this._dataReader,"Transaction.set",e._key,t,null!==e._converter,n),this._transaction.set(e._key,n),this},Xd.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return e=Yd(e,this._firestore),t instanceof Ch&&(t=t._delegate),t="string"==typeof t||t instanceof vf?Of(this._dataReader,"Transaction.update",e._key,t,n,r):Rf(this._dataReader,"Transaction.update",e._key,t),this._transaction.update(e._key,t),this},Xd.prototype.delete=function(e){return e=Yd(e,this._firestore),this._transaction.delete(e._key),this};var Jd,$d=(n(Zd,Jd=vt=Xd),Zd.prototype.get=function(e){var t=this,n=Yd(e,this._firestore),r=new zf(this._firestore);return Jd.prototype.get.call(this,e).then(function(e){return new qd(t._firestore,r,n._key,e._document,new bp(!1,!1),n._converter)})},Zd);function Zd(e,t){return(t=Jd.call(this,e,t)||this)._firestore=e,t}var ep="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",tp=(np.prototype.enableIndexedDbPersistence=function(e,t){throw new Cr(Sr.FAILED_PRECONDITION,ep)},np.prototype.enableMultiTabIndexedDbPersistence=function(e){throw new Cr(Sr.FAILED_PRECONDITION,ep)},np.prototype.clearIndexedDbPersistence=function(e){throw new Cr(Sr.FAILED_PRECONDITION,ep)},np);function np(){}var rp,ip=(n(op,rp=Ch),Object.defineProperty(op.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),op.prototype.settings=function(e){e.merge&&delete(e=Object.assign(Object.assign({},this._delegate._getSettings()),e)).merge,this._delegate._setSettings(e)},op.prototype.useEmulator=function(e,t){"firestore.googleapis.com"!==this._delegate._getSettings().host&&Lr("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:e+":"+t,ssl:!1,merge:!0})},op.prototype.enableNetwork=function(){return function(r){var e=this;return r.asyncQueue.enqueue(function(){return f(e,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return[4,ah(r)];case 1:return t=e.sent(),[4,uh(r)];case 2:return n=e.sent(),t.setNetworkEnabled(!0),[2,((e=Vr(e=n,Hu)).offlineCauses.delete(0),Yu(e))]}})})})}(ap(wh(this._delegate,Jh)))},op.prototype.disableNetwork=function(){return function(r){var e=this;return r.asyncQueue.enqueue(function(){return f(e,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return[4,ah(r)];case 1:return t=e.sent(),[4,uh(r)];case 2:return n=e.sent(),t.setNetworkEnabled(!1),[2,function(n){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return(t=Vr(n,Hu)).offlineCauses.add(0),[4,Xu(t)];case 1:return e.sent(),t.onlineStateTracker.set("Offline"),[2]}})})}(n)]}})})})}(ap(wh(this._delegate,Jh)))},op.prototype.enablePersistence=function(e){var t=!1,n=!1;return e&&yh("synchronizeTabs",t=!!e.synchronizeTabs,"experimentalForceOwningTab",n=!!e.experimentalForceOwningTab),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)},op.prototype.clearPersistence=function(){return this._persistenceProvider.clearIndexedDbPersistence(this)},op.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._delegate._delete()},op.prototype.waitForPendingWrites=function(){return Zh(this._delegate)},op.prototype.onSnapshotsInSync=function(e){return function(n,e){var t=this,r=new Yl(e);return n.asyncQueue.enqueueAndForget(function(){return f(t,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,lh(n)];case 1:return t=e.sent(),[2,(e=r,Vr(t,Ac).snapshotsInSyncListeners.add(e),void e.next())]}})})}),function(){r.mute(),n.asyncQueue.enqueueAndForget(function(){return f(t,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,lh(n)];case 1:return t=e.sent(),[2,(e=r,void Vr(t,Ac).snapshotsInSyncListeners.delete(e))]}})})})}}(ap(wh(this._delegate,Jh)),Th(e)?e:{next:e})},Object.defineProperty(op.prototype,"app",{get:function(){if(!this._appCompat)throw new Cr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat},enumerable:!1,configurable:!0}),op.prototype.collection=function(e){try{return new Vp(this,Id(this._delegate,e))}catch(e){throw mp(e,"collection()","Firestore.collection()")}},op.prototype.doc=function(e){try{return new yp(this,Sd(this._delegate,e))}catch(e){throw mp(e,"doc()","Firestore.doc()")}},op.prototype.collectionGroup=function(e){try{return new kp(this,function(e,t){if(e=wh(e,Hh),dh("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new Cr(Sr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new $f(e,null,new Hi(ni.emptyPath(),t))}(this._delegate,e))}catch(e){throw mp(e,"collectionGroup()","Firestore.collectionGroup()")}},op.prototype.runTransaction=function(t){var n=this,r=this._delegate,i=function(e){return t(new cp(n,e))};return function(n,r){var e=this,i=new gu;return n.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,oh(n).then(function(e){return e.datastore})];case 1:return t=e.sent(),new Zl(n.asyncQueue,t,r,i).run(),[2]}})})}),i.promise}(ap(r),function(e){return i(new $d(r,e))})},op.prototype.batch=function(){var t=this;return ap(this._delegate),new fp(new Wd(this._delegate,function(e){return Hf(t._delegate,e)}))},op);function op(e,t,n){var r=rp.call(this,t)||this;return r._persistenceProvider=n,r.INTERNAL={delete:function(){return r.terminate()}},e instanceof br||(r._appCompat=e),r}function ap(e){return e._firestoreClient||sp(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function sp(e){Fr(!!(r=e._freezeSettings()).host,"FirestoreSettings.host is not set"),Fr(!e._firestoreClient,"configureFirestore() called multiple times");var t,n,r=(t=e._databaseId,n=e._persistenceKey,new vr(t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));e._firestoreClient=new nh(e._credentials,e._queue,r)}var up,cp=(n(lp,up=Ch),lp.prototype.get=function(e){var t=this,e=Bp(e);return this._delegate.get(e).then(function(e){return new _p(t._firestore,e)})},lp.prototype.set=function(e,t,n){return e=Bp(e),n?(ph("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this},lp.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Bp(e);return 2===arguments.length?this._delegate.update(o,t):(e=this._delegate).update.apply(e,a([o,t,n],r)),this},lp.prototype.delete=function(e){return e=Bp(e),this._delegate.delete(e),this},lp);function lp(e,t){return(t=up.call(this,t)||this)._firestore=e,t}var hp,fp=(n(dp,hp=Ch),dp.prototype.set=function(e,t,n){return e=Bp(e),n?(ph("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this},dp.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Bp(e);return 2===arguments.length?this._delegate.update(o,t):(e=this._delegate).update.apply(e,a([o,t,n],r)),this},dp.prototype.delete=function(e){return e=Bp(e),this._delegate.delete(e),this},dp.prototype.commit=function(){return this._delegate.commit()},dp);function dp(){return null!==hp&&hp.apply(this,arguments)||this}var pp,yp=(n(gp,pp=Ch),gp.forPath=function(e,t,n){if(e.length%2!=0)throw new Cr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new gp(t,new Xf(t._delegate,n,new ui(e)))},gp.forKey=function(e,t,n){return new gp(t,new Xf(t._delegate,n,e))},Object.defineProperty(gp.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(gp.prototype,"parent",{get:function(){return new Vp(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(gp.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),gp.prototype.collection=function(e){try{return new Vp(this.firestore,Id(this._delegate,e))}catch(e){throw mp(e,"collection()","DocumentReference.collection()")}},gp.prototype.isEqual=function(e){return e instanceof Ch&&(e=e._delegate),e instanceof Xf&&kd(this._delegate,e)},gp.prototype.set=function(e,t){t=ph("DocumentReference.set",t);try{return function(e,t,n){e=wh(e,Xf);var r=wh(e.firestore,Jh),t=Up(e._converter,t,n);return Hf(r,Nf(Rd(r),"setDoc",e._key,t,null!==e._converter,n).toMutations(e._key,Ts.none()))}(this._delegate,e,t)}catch(e){throw mp(e,"setDoc()","DocumentReference.set()")}},gp.prototype.update=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Qf(this._delegate,e):Qf.apply(void 0,a([this._delegate,e,t],n))}catch(e){throw mp(e,"updateDoc()","DocumentReference.update()")}},gp.prototype.delete=function(){return Hf(wh((e=this._delegate).firestore,Jh),[new js(e._key,Ts.none())]);var e},gp.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=vp(e),i=wp(e,function(e){return new _p(t.firestore,new qd(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))});return Wf(this._delegate,r,i)},gp.prototype.get=function(e){var t=this;return(e=("cache"===(null==e?void 0:e.source)?function(t){t=wh(t,Xf);var n=wh(t.firestore,Jh),e=ap(n),r=new zf(n);return function(t,n){var e=this,r=new gu;return t.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,sh(t)];case 1:return[2,function(i,o,a){return f(this,void 0,void 0,function(){var r;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(t=o,(n=Vr(i,Eu)).persistence.runTransaction("read document","readonly",function(e){return n.localDocuments.getDocument(e,t)}))];case 1:return(r=e.sent())instanceof Mi?a.resolve(r):r instanceof Vi?a.resolve(null):a.reject(new Cr(Sr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=wc(r=e.sent(),"Failed to get document '"+o+" from cache"),a.reject(r),[3,3];case 3:return[2]}var t,n})})}(e.sent(),n,r)]}})})}),r.promise}(e,t._key).then(function(e){return new qd(n,r,t._key,e,new bp(e instanceof Mi&&e.hasLocalMutations,!0),t._converter)})}:"server"===(null==e?void 0:e.source)?function(t){t=wh(t,Xf);var n=wh(t.firestore,Jh);return hh(ap(n),t._key,{source:"server"}).then(function(e){return Yf(n,t,e)})}:function(t){t=wh(t,Xf);var n=wh(t.firestore,Jh);return hh(ap(n),t._key).then(function(e){return Yf(n,t,e)})})(this._delegate)).then(function(e){return new _p(t.firestore,new qd(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))})},gp.prototype.withConverter=function(e){return new gp(this.firestore,this._delegate.withConverter(e))},gp);function gp(e,t){return(t=pp.call(this,t)||this).firestore=e,t._userDataWriter=new Ph(e),t}function mp(e,t,n){return e.message=e.message.replace(t,n),e}function vp(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if("object"==typeof r&&!Th(r))return r}return{}}function wp(e,t){var n=Th(e[0])?e[0]:Th(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]};return{next:function(e){n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}var bp=(Tp.prototype.isEqual=function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache},Tp);function Tp(e,t){this.hasPendingWrites=e,this.fromCache=t}var Ep,_p=(n(Ip,Ep=Ch),Object.defineProperty(Ip.prototype,"ref",{get:function(){return new yp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(Ip.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Ip.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Ip.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),Ip.prototype.data=function(e){return this._delegate.data(e)},Ip.prototype.get=function(e,t){return this._delegate.get(e,t)},Ip.prototype.isEqual=function(e){return Qd(this._delegate,e._delegate)},Ip);function Ip(e,t){return(t=Ep.call(this,t)||this)._firestore=e,t}var Sp,Cp=(n(Dp,Sp=_p),Dp.prototype.data=function(e){return Fr(void 0!==(e=this._delegate.data(e)),"Document in a QueryDocumentSnapshot should exist"),e},Dp);function Dp(){return null!==Sp&&Sp.apply(this,arguments)||this}var Ap,kp=(n(Np,Ap=Ch),Np.prototype.where=function(e,t,n){try{return new Np(this.firestore,ed(this._delegate,(i=t,o=n,r=Fd("where",e),new nd(r,i,o))))}catch(e){throw mp(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},Np.prototype.orderBy=function(e,t){try{return new Np(this.firestore,ed(this._delegate,(void 0===(r=t)&&(r="asc"),n=Fd("orderBy",e),new od(n,r))))}catch(e){throw mp(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},Np.prototype.limit=function(e){try{return new Np(this.firestore,ed(this._delegate,(bh("limit",t=e),new ud("limit",t,"F"))))}catch(e){throw mp(e,"limit()","Query.limit()")}var t},Np.prototype.limitToLast=function(e){try{return new Np(this.firestore,ed(this._delegate,(bh("limitToLast",t=e),new ud("limitToLast",t,"L"))))}catch(e){throw mp(e,"limitToLast()","Query.limitToLast()")}var t},Np.prototype.startAt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new Np(this.firestore,ed(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new hd("startAt",e,!0)}.apply(void 0,e)))}catch(e){throw mp(e,"startAt()","Query.startAt()")}},Np.prototype.startAfter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new Np(this.firestore,ed(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new hd("startAfter",e,!1)}.apply(void 0,e)))}catch(e){throw mp(e,"startAfter()","Query.startAfter()")}},Np.prototype.endBefore=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new Np(this.firestore,ed(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new pd("endBefore",e,!0)}.apply(void 0,e)))}catch(e){throw mp(e,"endBefore()","Query.endBefore()")}},Np.prototype.endAt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new Np(this.firestore,ed(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new pd("endAt",e,!1)}.apply(void 0,e)))}catch(e){throw mp(e,"endAt()","Query.endAt()")}},Np.prototype.isEqual=function(e){return Nd(this._delegate,e._delegate)},Np.prototype.get=function(e){var t=this;return(e=("cache"===(null==e?void 0:e.source)?function(t){t=wh(t,$f);var n=wh(t.firestore,Jh),e=ap(n),r=new zf(n);return function(t,n){var e=this,r=new gu;return t.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,sh(t)];case 1:return[2,function(r,i,o){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,ku(r,i,!0)];case 1:return n=e.sent(),t=new jc(i,n.remoteKeys),n=t.computeDocChanges(n.documents),n=t.applyChanges(n,!1),o.resolve(n.snapshot),[3,3];case 2:return n=wc(n=e.sent(),"Failed to execute query '"+i+" against cache"),o.reject(n),[3,3];case 3:return[2]}})})}(e.sent(),n,r)]}})})}),r.promise}(e,t._query).then(function(e){return new zd(n,r,t,e)})}:"server"===(null==e?void 0:e.source)?function(t){t=wh(t,$f);var n=wh(t.firestore,Jh),e=ap(n),r=new zf(n);return fh(e,t._query,{source:"server"}).then(function(e){return new zd(n,r,t,e)})}:function(t){t=wh(t,$f);var n=wh(t.firestore,Jh),e=ap(n),r=new zf(n);return bd(t._query),fh(e,t._query).then(function(e){return new zd(n,r,t,e)})})(this._delegate)).then(function(e){return new Mp(t.firestore,new zd(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))})},Np.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=vp(e),i=wp(e,function(e){return new Mp(t.firestore,new zd(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Wf(this._delegate,r,i)},Np.prototype.withConverter=function(e){return new Np(this.firestore,this._delegate.withConverter(e))},Np);function Np(e,t){return(t=Ap.call(this,t)||this).firestore=e,t._userDataWriter=new Ph(e),t}var Rp,Op=(n(Lp,Rp=Ch),Object.defineProperty(Lp.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(Lp.prototype,"doc",{get:function(){return new Cp(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Lp.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Lp.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),Lp);function Lp(e,t){return(t=Rp.call(this,t)||this)._firestore=e,t}var Pp,Mp=(n(xp,Pp=Ch),Object.defineProperty(xp.prototype,"query",{get:function(){return new kp(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(xp.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(xp.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(xp.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(xp.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Cp(t._firestore,e)})},enumerable:!1,configurable:!0}),xp.prototype.docChanges=function(e){var t=this;return this._delegate.docChanges(e).map(function(e){return new Op(t._firestore,e)})},xp.prototype.forEach=function(t,n){var r=this;this._delegate.forEach(function(e){t.call(n,new Cp(r._firestore,e))})},xp.prototype.isEqual=function(e){return Qd(this._delegate,e._delegate)},xp);function xp(e,t){return(t=Pp.call(this,t)||this)._firestore=e,t}var Fp,Vp=(n(qp,Fp=kp),Object.defineProperty(qp.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(qp.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(qp.prototype,"parent",{get:function(){var e=this._delegate.parent;return e?new yp(this.firestore,e):null},enumerable:!1,configurable:!0}),qp.prototype.doc=function(e){try{return new yp(this.firestore,void 0===e?Sd(this._delegate):Sd(this._delegate,e))}catch(e){throw mp(e,"doc()","CollectionReference.doc()")}},qp.prototype.add=function(e){var t,n=this,r=this._delegate,i=e;return e=wh(r.firestore,Jh),t=Sd(r),i=Up(r._converter,i),Hf(e,Nf(Rd(r.firestore),"addDoc",t._key,i,null!==r._converter,{}).toMutations(t._key,Ts.exists(!1))).then(function(){return t}).then(function(e){return new yp(n.firestore,e)})},qp.prototype.isEqual=function(e){return kd(this._delegate,e._delegate)},qp.prototype.withConverter=function(e){return new qp(this.firestore,this._delegate.withConverter(e))},qp);function qp(e,t){var n=Fp.call(this,e,t)||this;return n.firestore=e,n._delegate=t,n}function Bp(e){return e instanceof Ch&&(e=e._delegate),wh(e,Xf)}function Up(e,t,n){return t=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var jp,mt=(n(Kp,jp=Ch),Kp.documentId=function(){return new Kp(ai.keyField().canonicalString())},Kp.prototype.isEqual=function(e){return e instanceof Ch&&(e=e._delegate),e instanceof vf&&this._delegate._internalPath.isEqual(e._internalPath)},Kp);function Kp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jp.call(this,new(vf.bind.apply(vf,a([void 0],e))))||this}var zp,vt=(n(Gp,zp=Ch),Gp.serverTimestamp=function(){var e=new sf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Gp(e)},Gp.delete=function(){var e=new nf("deleteField");return e._methodName="FieldValue.delete",new Gp(e)},Gp.arrayUnion=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new lf("arrayUnion",e)}.apply(void 0,e);return n._methodName="FieldValue.arrayUnion",new Gp(n)},Gp.arrayRemove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new df("arrayRemove",e)}.apply(void 0,e);return n._methodName="FieldValue.arrayRemove",new Gp(n)},Gp.increment=function(e){return(e=new gf("increment",e))._methodName="FieldValue.increment",new Gp(e)},Gp.prototype.isEqual=function(e){return this._delegate.isEqual(e._delegate)},Gp);function Gp(){return null!==zp&&zp.apply(this,arguments)||this}var vt={Firestore:ip,GeoPoint:Eh,Timestamp:zr,Blob:Nh,Transaction:cp,WriteBatch:fp,DocumentReference:yp,DocumentSnapshot:_p,Query:kp,QueryDocumentSnapshot:Cp,QuerySnapshot:Mp,CollectionReference:Vp,FieldPath:mt,FieldValue:vt,setLogLevel:function(e){kr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1},t=t.default,Qp=function(e,t){return new ip(e,new Jh(e,t),new tp)};t.INTERNAL.registerComponent(new S("firestore",function(e){var t=e.getProvider("app").getImmediate();return Qp(t,e.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},vt))),t.registerVersion("@firebase/firestore","2.0.4-1.0.0-eap-firestore-debug.9c6096f43")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore.memory.js - be sure to load firebase-app.js first.")}});