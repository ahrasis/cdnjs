!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase)}(this,function(ky){"use strict";try{(function(){function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s,t=e(ky),r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function n(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function f(e,a,s,u){return new(s=s||Promise)(function(n,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,i)}o((u=u.apply(e,a||[])).next())})}function d(n,r){var i,o,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function a(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function u(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}(Et=s=s||{})[Et.DEBUG=0]="DEBUG",Et[Et.VERBOSE=1]="VERBOSE",Et[Et.INFO=2]="INFO",Et[Et.WARN=3]="WARN",Et[Et.ERROR=4]="ERROR",Et[Et.SILENT=5]="SILENT";function i(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=l[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,u(["["+i+"]  "+e.name+":"],n))}}var o={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},c=s.INFO,l=((_t={})[s.DEBUG]="log",_t[s.VERBOSE]="log",_t[s.INFO]="info",_t[s.WARN]="warn",_t[s.ERROR]="error",_t),h=(Object.defineProperty(p.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in s))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),p.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?o[e]:e},Object.defineProperty(p.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),p.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.DEBUG],e)),this._logHandler.apply(this,u([this,s.DEBUG],e))},p.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.VERBOSE],e)),this._logHandler.apply(this,u([this,s.VERBOSE],e))},p.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.INFO],e)),this._logHandler.apply(this,u([this,s.INFO],e))},p.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.WARN],e)),this._logHandler.apply(this,u([this,s.WARN],e))},p.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,u([this,s.ERROR],e)),this._logHandler.apply(this,u([this,s.ERROR],e))},p);function p(e){this.name=e,this._logLevel=c,this._logHandler=i,this._userLogHandler=null}function y(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var g,m="FirebaseError",v=(n(w,g=Error),w);function w(e,t,n){t=g.call(this,t)||this;return t.code=e,t.customData=n,t.name=m,Object.setPrototypeOf(t,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,b.prototype.create),t}var b=(T.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},o=this.service+"/"+e,e=this.errors[e],e=e?(r=i,e.replace(E,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+o+").";return new v(o,e,i)},T);function T(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var E=/\{\$([^}]+)}/g,_=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function I(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var S,C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D={},k=C||self;function A(){}function N(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function R(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var O="closure_uid_"+(1e9*Math.random()>>>0),L=0;function P(e,t,n){return e.call.apply(e.bind,arguments)}function M(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function x(e,t,n){return(x=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:M).apply(null,arguments)}function F(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function V(){return Date.now()}function q(e,o){function t(){}t.prototype=o.prototype,e.X=o.prototype,e.prototype=new t,(e.prototype.constructor=e).Kb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[t].apply(e,r)}}function B(){this.j=this.j,this.i=this.i}B.prototype.j=!1,B.prototype.ja=function(){var e;!this.j&&(this.j=!0,this.G(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,O)&&e[O]||(e[O]=++L))},B.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var U=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},j=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function K(){return Array.prototype.concat.apply([],arguments)}function z(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function G(e){return/^[\s\xa0]*$/.test(e)}var Q,W=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function H(e,t){return-1!=e.indexOf(t)}function Y(e,t){return e<t?-1:t<e?1:0}e:{var X=k.navigator;if(X){X=X.userAgent;if(X){Q=X;break e}}Q=""}function J(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function $(e){var t,n={};for(t in e)n[t]=e[t];return n}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ee(e){for(var t,n,r=1;r<arguments.length;r++){for(t in n=arguments[r])e[t]=n[t];for(var i=0;i<Z.length;i++)t=Z[i],Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}}function te(e){return te[" "](e),e}te[" "]=A;var ne,re=H(Q,"Opera"),ie=H(Q,"Trident")||H(Q,"MSIE"),oe=H(Q,"Edge"),ae=oe||ie,se=H(Q,"Gecko")&&!(H(Q.toLowerCase(),"webkit")&&!H(Q,"Edge"))&&!(H(Q,"Trident")||H(Q,"MSIE"))&&!H(Q,"Edge"),ue=H(Q.toLowerCase(),"webkit")&&!H(Q,"Edge");function ce(){var e=k.document;return e?e.documentMode:void 0}e:{var le="",he=(he=Q,se?/rv:([^\);]+)(\)|;)/.exec(he):oe?/Edge\/([\d\.]+)/.exec(he):ie?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(he):ue?/WebKit\/(\S+)/.exec(he):re?/(?:Version)[ \/]?(\S+)/.exec(he):void 0);if(he&&(le=he?he[1]:""),ie){he=ce();if(null!=he&&he>parseFloat(le)){ne=String(he);break e}}ne=le}var fe={};function de(s){return e=s,t=function(){for(var e=0,t=W(String(ne)).split("."),n=W(String(s)).split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++){var o=t[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=Y(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Y(0==o[2].length,0==a[2].length)||Y(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e},n=fe,Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e);var e,t,n}var pe=k.document&&ie?ce()||(parseInt(ne,10)||void 0):void 0,ye=!ie||9<=Number(pe),ge=ie&&!de("9"),me=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{k.addEventListener("test",A,t),k.removeEventListener("test",A,t)}catch(e){}return e}();function ve(e,t){this.type=e,this.a=this.target=t,this.defaultPrevented=!1}function we(e,t){if(ve.call(this,e?e.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.a=t,t=e.relatedTarget){if(se){e:{try{te(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:be[e.pointerType]||"",(this.c=e).defaultPrevented&&this.b()}}ve.prototype.b=function(){this.defaultPrevented=!0},q(we,ve);var be={2:"touch",3:"pen",4:"mouse"};we.prototype.b=function(){we.X.b.call(this);var e=this.c;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,ge)try{(e.ctrlKey||112<=e.keyCode&&e.keyCode<=123)&&(e.keyCode=-1)}catch(e){}};var Te="closure_listenable_"+(1e6*Math.random()|0),Ee=0;function _e(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ca=i,this.key=++Ee,this.Y=this.Z=!1}function Ie(e){e.Y=!0,e.listener=null,e.proxy=null,e.src=null,e.ca=null}function Se(e){this.src=e,this.a={},this.b=0}function Ce(e,t){var n,r,i,o=t.type;o in e.a&&(n=e.a[o],(i=0<=(r=U(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(Ie(t),0==e.a[o].length&&(delete e.a[o],e.b--)))}function De(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.Y&&o.listener==t&&o.capture==!!n&&o.ca==r)return i}return-1}Se.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.a[o])||(e=this.a[o]=[],this.b++);var a=De(e,t,r,i);return-1<a?(t=e[a],n||(t.Z=!1)):((t=new _e(t,this.src,o,!!r,i)).Z=n,e.push(t)),t};var ke="closure_lm_"+(1e6*Math.random()|0),Ae={};function Ne(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,o){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,o);return null}r=Ve(r);return t&&t[Te]?t.wa(n,r,R(i)?!!i.capture:!!i,o):Re(t,n,r,!0,i,o)}(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)Ne(e,t[o],n,r,i);return null}return n=Ve(n),e&&e[Te]?e.va(t,n,R(r)?!!r.capture:!!r,i):Re(e,t,n,!1,r,i)}function Re(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=R(i)?!!i.capture:!!i;if(a&&!ye)return null;var s,u,c=xe(e);if(c||(e[ke]=c=new Se(e)),(n=c.add(t,n,r,a,o)).proxy)return n;if(s=Me,r=u=ye?function(e){return s.call(u.src,u.listener,e)}:function(e){if(!(e=s.call(u.src,u.listener,e)))return e},(n.proxy=r).src=e,r.listener=n,e.addEventListener)me||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Le(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Oe(e){var t,n,r;"number"!=typeof e&&e&&!e.Y&&((t=e.src)&&t[Te]?Ce(t.c,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Le(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=xe(t))?(Ce(n,e),0==n.b&&(n.src=null,t[ke]=null)):Ie(e)))}function Le(e){return e in Ae?Ae[e]:Ae[e]="on"+e}function Pe(e,t){var n=e.listener,r=e.ca||e.src;return e.Z&&Oe(e),n.call(r,t)}function Me(e,t){if(e.Y)return!0;if(ye)return Pe(e,new we(t,this));if(!t)e:{t=["window","event"];for(var n=k,r=0;r<t.length;r++)if(null==(n=n[t[r]])){t=null;break e}t=n}return Pe(e,t=new we(t,this))}function xe(e){return(e=e[ke])instanceof Se?e:null}var Fe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ve(t){return"function"==typeof t?t:(t[Fe]||(t[Fe]=function(e){return t.handleEvent(e)}),t[Fe])}function qe(){B.call(this),this.c=new Se(this),(this.J=this).C=null}function Be(e,t){var n,r=e.C;if(r)for(n=[];r;r=r.C)n.push(r);if(e=e.J,r=t.type||t,"string"==typeof t?t=new ve(t,e):t instanceof ve?t.target=t.target||e:(a=t,ee(t=new ve(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var o=t.a=n[i],a=Ue(o,r,!0,t)&&a;if(a=Ue(o=t.a=e,r,!0,t)&&a,a=Ue(o,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=Ue(o=t.a=n[i],r,!1,t)&&a}function Ue(e,t,n,r){if(!(t=e.c.a[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var a,s,u=t[o];u&&!u.Y&&u.capture==n&&(a=u.listener,s=u.ca||u.src,u.Z&&Ce(e.c,u),i=!1!==a.call(s,r)&&i)}return i&&!r.defaultPrevented}q(qe,B),qe.prototype[Te]=!0,(S=qe.prototype).addEventListener=function(e,t,n,r){Ne(this,e,t,n,r)},S.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,o){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,o);else i=R(i)?!!i.capture:!!i,r=Ve(r),t&&t[Te]?(t=t.c,(n=String(n).toString())in t.a&&-1<(r=De(a=t.a[n],r,i,o))&&(Ie(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.a[n],t.b--))):(t=t&&xe(t))&&(n=t.a[n.toString()],t=-1,n&&(t=De(n,r,i,o)),(r=-1<t?n[t]:null)&&Oe(r))}(this,e,t,n,r)},S.G=function(){if(qe.X.G.call(this),this.c){var e,t=this.c;for(e in t.a){for(var n=t.a[e],r=0;r<n.length;r++)Ie(n[r]);delete t.a[e],t.b--}}this.C=null},S.va=function(e,t,n,r){return this.c.add(String(e),t,!1,n,r)},S.wa=function(e,t,n,r){return this.c.add(String(e),t,!0,n,r)};var je=k.JSON.stringify;function Ke(){this.b=this.a=null}var ze,Ge=(Qe.prototype.get=function(){var e;return 0<this.b?(this.b--,e=this.a,this.a=e.next,e.next=null):e=this.c(),e},new Qe(function(){return new We},function(e){e.reset()}));function Qe(e,t){this.c=e,this.f=t,this.b=0,this.a=null}function We(){this.next=this.b=this.a=null}function He(e,t){var n;ze||(n=k.Promise.resolve(void 0),ze=function(){n.then(Je)}),Ye||(ze(),Ye=!0),Xe.add(e,t)}Ke.prototype.add=function(e,t){var n=Ge.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n},We.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null};var Ye=!(We.prototype.reset=function(){this.next=this.b=this.a=null}),Xe=new Ke;function Je(){for(var e,t;n=t=void 0,n=null,(t=Xe).a&&(n=t.a,t.a=t.a.next,t.a||(t.b=null),n.next=null),e=n;){try{e.a.call(e.b)}catch(e){!function(e){k.setTimeout(function(){throw e},0)}(e)}var n=Ge;n.f(e),n.b<100&&(n.b++,e.next=n.a,n.a=e)}Ye=!1}function $e(e,t){qe.call(this),this.b=e||1,this.a=t||k,this.f=x(this.Za,this),this.g=V()}function Ze(e){e.aa=!1,e.M&&(e.a.clearTimeout(e.M),e.M=null)}function et(e,t,n){if("function"==typeof e)n&&(e=x(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=x(e.handleEvent,e)}return 2147483647<Number(t)?-1:k.setTimeout(e,t||0)}q($e,qe),(S=$e.prototype).aa=!1,S.M=null,S.Za=function(){var e;this.aa&&(0<(e=V()-this.g)&&e<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-e):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Be(this,"tick"),this.aa&&(Ze(this),this.start())))},S.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=V())},S.G=function(){$e.X.G.call(this),Ze(this),delete this.a};var tt,nt,rt,it=(_(nt=at,rt=tt=B),nt.prototype=null===rt?Object.create(rt):(ot.prototype=rt.prototype,new ot),at.prototype.f=function(e){this.b=arguments,this.a?this.c=!0:function e(t){t.a=et(function(){t.a=null,t.c&&(t.c=!1,e(t))},t.h);var n=t.b;t.b=null,t.g.apply(null,n)}(this)},at.prototype.G=function(){tt.prototype.G.call(this),this.a&&(k.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},at);function ot(){this.constructor=nt}function at(e,t){var n=tt.call(this)||this;return n.g=e,n.h=t,n.b=null,n.c=!1,n.a=null,n}function st(e){B.call(this),this.b=e,this.a={}}q(st,B);var ut=[];function ct(e,t,n,r){Array.isArray(n)||(n&&(ut[0]=n.toString()),n=ut);for(var i=0;i<n.length;i++){var o=Ne(t,n[i],r||e.handleEvent,!1,e.b||e);if(!o)break;e.a[o.key]=o}}function lt(e){J(e.a,function(e,t){this.a.hasOwnProperty(t)&&Oe(e)},e),e.a={}}function ht(){this.a=!0}function ft(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.a)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return je(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}st.prototype.G=function(){st.X.G.call(this),lt(this)},st.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ht.prototype.info=function(){};var dt={},pt=null;function yt(){return pt=pt||new qe}function gt(e){ve.call(this,dt.Fa,e)}function mt(e){var t=yt();Be(t,new gt(t))}function vt(e,t){ve.call(this,dt.STAT_EVENT,e),this.stat=t}function wt(e){var t=yt();Be(t,new vt(t,e))}function bt(e){ve.call(this,dt.Ga,e)}function Tt(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){e()},t)}dt.Fa="serverreachability",q(gt,ve),dt.STAT_EVENT="statevent",q(vt,ve),dt.Ga="timingevent",q(bt,ve);var Et={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},_t={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function It(){}function St(e){var t;return(t=e.a)||(t=e.a={}),t}function Ct(){}It.prototype.a=null;var Dt,C={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function kt(){ve.call(this,"d")}function At(){ve.call(this,"c")}function Nt(){}function Rt(e,t,n,r){this.g=e,this.c=t,this.f=n,this.S=r||1,this.J=new st(this),this.P=Ot,e=ae?125:void 0,this.R=new $e(e),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}q(kt,ve),q(At,ve),q(Nt,It),Dt=new Nt;var Ot=45e3,Lt={},Pt={};function Mt(e,t,n){e.H=1,e.i=nn(Xt(t)),e.j=n,e.I=!0,xt(e,null)}function xt(e,t){e.u=V(),Vt(e),e.l=Xt(e.i);var a,s,u,c,l,h,n=e.l,r=e.S;Array.isArray(r)||(r=[String(r)]),gn(n.b,"t",r),e.D=0,e.a=cr(e.g,e.g.C?t:null),0<e.O&&(e.F=new it(x(e.Ca,e,e.a),e.O)),ct(e.J,e.a,"readystatechange",e.Xa),t=e.B?$(e.B):{},e.j?(e.m||(e.m="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.a.ba(e.l,e.m,e.j,t)):(e.m="GET",e.a.ba(e.l,e.m,null,t)),mt(1),a=e.c,s=e.m,u=e.l,c=e.f,l=e.S,h=e.j,a.info(function(){if(a.a)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,o=t[n].split("=");1<o.length&&(r=o[0],o=o[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+o+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+c+") [attempt "+l+"]: "+s+"\n"+u+"\n"+e})}function Ft(e,t,n){for(var r,i,o,a=!0;!e.A&&e.D<n.length;){var s=(s=n,o=i=void 0,i=(r=e).D,-1==(o=s.indexOf("\n",i))?Pt:(i=Number(s.substring(i,o)),isNaN(i)?Lt:(o+=1)+i>s.length?Pt:(s=s.substr(o,i),r.D=o+i,s)));if(s==Pt){4==t&&(e.h=4,wt(14),a=!1),ft(e.c,e.f,null,"[Incomplete Response]");break}if(s==Lt){e.h=4,wt(15),ft(e.c,e.f,n,"[Invalid Chunk]"),a=!1;break}ft(e.c,e.f,s,null),Kt(e,s)}4==t&&0==n.length&&(e.h=1,wt(16),a=!1),e.b=e.b&&a,a?0<n.length&&!e.V&&(e.V=!0,(t=e.g).a==e&&t.U&&!t.F&&(t.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),tr(t),t.F=!0,wt(11))):(ft(e.c,e.f,n,"[Invalid Chunked Response]"),jt(e),Ut(e))}function Vt(e){e.T=V()+e.P,qt(e,e.P)}function qt(e,t){if(null!=e.o)throw Error("WatchDog timer not null");e.o=Tt(x(e.Va,e),t)}function Bt(e){e.o&&(k.clearTimeout(e.o),e.o=null)}function Ut(e){0==e.g.v||e.A||ir(e.g,e)}function jt(e){Bt(e);var t=e.F;t&&"function"==typeof t.ja&&t.ja(),e.F=null,Ze(e.R),lt(e.J),e.a&&(t=e.a,e.a=null,t.abort(),t.ja())}function Kt(e,t){try{var n,r,i,o,a,s=e.g;if(0!=s.v&&(s.a==e||_n(s.b,e)))if(s.I=e.N,!e.C&&_n(s.b,e)&&3==s.v){try{var u=s.ka.a.parse(t)}catch(e){u=null}if(Array.isArray(u)&&3==u.length){var c=u;if(0==c[0]){e:if(!s.j){if(s.a){if(!(s.a.u+3e3<e.u))break e;rr(s),Qn(s)}er(s),wt(18)}}else s.oa=c[1],0<s.oa-s.P&&c[2]<37500&&s.H&&0==s.o&&!s.m&&(s.m=Tt(x(s.Sa,s),6e3));if(En(s.b)<=1&&s.ea){try{s.ea()}catch(e){}s.ea=void 0}}else ar(s,11)}else if(!e.C&&s.a!=e||rr(s),!G(t))for(t=u=s.ka.a.parse(t),u=0;u<t.length;u++){c=t[u],s.P=c[0],c=c[1],2==s.v?"c"==c[0]?(s.J=c[1],s.ga=c[2],null!=(r=c[3])&&(s.ha=r,s.c.info("VER="+s.ha)),null!=(o=c[4])&&(s.pa=o,s.c.info("SVER="+s.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,s.D=n,s.c.info("backChannelRequestTimeoutMs_="+n)),n=s,(o=e.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(H(r,"spdy")||H(r,"quic")||H(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(In(i,i.b),i.b=null)),!n.A||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=a,tn(n.B,n.A,a))),s.v=3,s.f&&s.f.ta(),s.U&&(s.N=V()-e.u,s.c.info("Handshake RTT: "+s.N+"ms")),i=e,(n=s).la=ur(n,n.C?n.ga:null,n.fa),i.C?(Sn(n.b,i),o=i,(a=n.D)&&o.setTimeout(a),o.o&&(Bt(o),Vt(o)),n.a=i):Zn(n),0<s.g.length&&Yn(s)):"stop"!=c[0]&&"close"!=c[0]||ar(s,7):3==s.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?ar(s,7):Gn(s):"noop"!=c[0]&&s.f&&s.f.sa(c),s.o=0)}mt(4)}catch(e){}}function zt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(N(e)||"string"==typeof e)j(e,t,void 0);else{if(e.L&&"function"==typeof e.L)var n=e.L();else if(e.K&&"function"==typeof e.K)n=void 0;else if(N(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.K&&"function"==typeof e.K)return e.K();if("string"==typeof e)return e.split("");if(N(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Gt(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Gt)for(n=e.L(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Qt(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];Wt(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){for(var i={},n=t=0;t<e.a.length;)Wt(i,r=e.a[t])||(i[e.a[n++]=r]=1),t++;e.a.length=n}}function Wt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(S=Rt.prototype).setTimeout=function(e){this.P=e},S.Xa=function(e){e=e.target;var t=this.F;t&&3==Un(e)?t.f():this.Ca(e)},S.Ca=function(e){try{if(e==this.a)e:{var t=Un(this.a),n=this.a.ua(),r=this.a.W();if(!(t<3||3==t&&!ae&&!this.a.$())){this.A||4!=t||7==n||mt(8==n||r<=0?3:2),Bt(this);var i=this.a.W();this.N=i;n=this.a.$();if(this.b=200==i,r=this.c,s=this.m,u=this.l,c=this.f,l=this.S,h=t,f=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+l+"]: "+s+"\n"+u+"\n"+h+" "+f}),this.b){if(this.U&&!this.C){t:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(o)){var a=o;break t}}a=null}if(!a){this.b=!1,this.h=3,wt(12),jt(this),Ut(this);break e}ft(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Kt(this,a)}this.I?(Ft(this,t,n),ae&&this.b&&3==t&&(ct(this.J,this.R,"tick",this.Wa),this.R.start())):(ft(this.c,this.f,n,null),Kt(this,n)),4==t&&jt(this),this.b&&!this.A&&(4==t?ir(this.g,this):(this.b=!1,Vt(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,wt(12)):(this.h=0,wt(13)),jt(this),Ut(this)}}}catch(e){}var s,u,c,l,h,f},S.Wa=function(){var e,t;this.a&&(e=Un(this.a),t=this.a.$(),this.D<t.length&&(Bt(this),Ft(this,e,t),this.b&&4!=e&&Vt(this)))},S.cancel=function(){this.A=!0,jt(this)},S.Va=function(){this.o=null;var e,t,n=V();0<=n-this.T?(e=this.c,t=this.l,e.info(function(){return"TIMEOUT: "+t}),2!=this.H&&(mt(3),wt(17)),jt(this),this.h=2,Ut(this)):qt(this,this.T-n)},(S=Gt.prototype).K=function(){Qt(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e},S.L=function(){return Qt(this),this.a.concat()},S.get=function(e,t){return Wt(this.b,e)?this.b[e]:t},S.set=function(e,t){Wt(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t},S.forEach=function(e,t){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};var Ht=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yt(e,t){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,e instanceof Yt?(this.a=void 0!==t?t:e.a,Jt(this,e.f),this.j=e.j,$t(this,e.c),Zt(this,e.h),this.g=e.g,t=e.b,(n=new fn).c=t.c,t.a&&(n.a=new Gt(t.a),n.b=t.b),en(this,n),this.i=e.i):e&&(n=String(e).match(Ht))?(this.a=!!t,Jt(this,n[1]||"",!0),this.j=rn(n[2]||""),$t(this,n[3]||"",!0),Zt(this,n[4]),this.g=rn(n[5]||"",!0),en(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!t,this.b=new fn(null,this.a))}function Xt(e){return new Yt(e)}function Jt(e,t,n){e.f=n?rn(t,!0):t,e.f&&(e.f=e.f.replace(/:$/,""))}function $t(e,t,n){e.c=n?rn(t,!0):t}function Zt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.h=t}else e.h=null}function en(e,t,n){var r,i;t instanceof fn?(e.b=t,r=e.b,(i=e.a)&&!r.f&&(dn(r),r.c=null,r.a.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(pn(this,t),gn(this,n,e))},r)),r.f=i):(n||(t=on(t,ln)),e.b=new fn(t,e.a))}function tn(e,t,n){e.b.set(t,n)}function nn(e){return tn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^V()).toString(36)),e}function rn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function on(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,an),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function an(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Yt.prototype.toString=function(){var e=[],t=this.f;t&&e.push(on(t,sn,!0),":");var n=this.c;return!n&&"file"!=t||(e.push("//"),(t=this.j)&&e.push(on(t,sn,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&e.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&e.push("/"),e.push(on(n,"/"==n.charAt(0)?cn:un,!0))),(n=this.b.toString())&&e.push("?",n),(n=this.i)&&e.push("#",on(n,hn)),e.join("")};var sn=/[#\/\?@]/g,un=/[#\?:]/g,cn=/[#\?]/g,ln=/[#\?@]/g,hn=/#/g;function fn(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function dn(n){n.a||(n.a=new Gt,n.b=0,n.c&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),o=null;0<=i?(r=e[n].substring(0,i),o=e[n].substring(i+1)):r=e[n],t(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function pn(e,t){dn(e),t=mn(e,t),Wt(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,Wt((e=e.a).b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Qt(e)))}function yn(e,t){return dn(e),t=mn(e,t),Wt(e.a.b,t)}function gn(e,t,n){pn(e,t),0<n.length&&(e.c=null,e.a.set(mn(e,t),z(n)),e.b+=n.length)}function mn(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}(S=fn.prototype).add=function(e,t){dn(this),this.c=null,e=mn(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this},S.forEach=function(n,r){dn(this),this.a.forEach(function(e,t){j(e,function(e){n.call(r,e,t,this)},this)},this)},S.L=function(){dn(this);for(var e=this.a.K(),t=this.a.L(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n},S.K=function(e){dn(this);var t=[];if("string"==typeof e)yn(this,e)&&(t=K(t,this.a.get(mn(this,e))));else{e=this.a.K();for(var n=0;n<e.length;n++)t=K(t,e[n])}return t},S.set=function(e,t){return dn(this),this.c=null,yn(this,e=mn(this,e))&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this},S.get=function(e,t){return e&&0<(e=this.K(e)).length?String(e[0]):t},S.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.L(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),e.push(a)}return this.c=e.join("&")};var vn=function(e,t){this.b=e,this.a=t};function wn(e){this.g=e||bn,e=k.PerformanceNavigationTiming?0<(e=k.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(k.ia&&k.ia.ya&&k.ia.ya()&&k.ia.ya().Lb),this.f=e?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var bn=10;function Tn(e){return e.b||e.a&&e.a.size>=e.f}function En(e){return e.b?1:e.a?e.a.size:0}function _n(e,t){return e.b?e.b==t:e.a&&e.a.has(t)}function In(e,t){e.a?e.a.add(t):e.b=t}function Sn(e,t){e.b&&e.b==t?e.b=null:e.a&&e.a.has(t)&&e.a.delete(t)}function Cn(e){var t,n;if(null!=e.b)return e.c.concat(e.b.s);if(null==e.a||0===e.a.size)return z(e.c);var r=e.c;try{for(var i=I(e.a.values()),o=i.next();!o.done;o=i.next())var a=o.value,r=r.concat(a.s)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Dn(){}function kn(){this.a=new Dn}function An(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}wn.prototype.cancel=function(){var t,e;if(this.c=Cn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Dn.prototype.stringify=function(e){return k.JSON.stringify(e,void 0)},Dn.prototype.parse=function(e){return k.JSON.parse(e,void 0)};var Nn=k.JSON.parse;function Rn(e){qe.call(this),this.headers=new Gt,this.H=e||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=On,this.D=this.F=!1}q(Rn,qe);var On="",Ln=/^https?$/i,Pn=["POST","PUT"];function Mn(e){return"content-type"==e.toLowerCase()}function xn(e,t){e.b=!1,e.a&&(e.g=!0,e.a.abort(),e.g=!1),e.f=t,e.h=5,Fn(e),qn(e)}function Fn(e){e.u||(e.u=!0,Be(e,"complete"),Be(e,"error"))}function Vn(e){if(e.b&&void 0!==D&&(!e.s[1]||4!=Un(e)||2!=e.W()))if(e.l&&4==Un(e))et(e.za,0,e);else if(Be(e,"readystatechange"),4==Un(e)){e.b=!1;try{var t,n,r,i,o=e.W();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}(t=a)||((n=0===o)&&(!(i=String(e.B).match(Ht)[1]||null)&&k.self&&k.self.location&&(i=(r=k.self.location.protocol).substr(0,r.length-1)),n=!Ln.test(i?i.toLowerCase():"")),t=n);if(t)Be(e,"complete"),Be(e,"success");else{e.h=6;try{var s=2<Un(e)?e.a.statusText:""}catch(o){s=""}e.f=s+" ["+e.W()+"]",Fn(e)}}finally{qn(e)}}}function qn(e,t){if(e.a){Bn(e);var n=e.a,r=e.s[0]?A:null;e.a=null,e.s=null,t||Be(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Bn(e){e.a&&e.D&&(e.a.ontimeout=null),e.m&&(k.clearTimeout(e.m),e.m=null)}function Un(e){return e.a?e.a.readyState:0}function jn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}var i;r||(i="",J(n,function(e,t){i+=t,i+=":",i+=e,i+="\r\n"}),n=i,"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tn(e,t,n))}function Kn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function zn(e){this.pa=0,this.g=[],this.c=new ht,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Kn("failFast",!1,e),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Kn("baseRetryDelayMs",5e3,e),this.Ra=Kn("retryDelaySeedMs",1e4,e),this.Ma=Kn("forwardChannelMaxRetries",2,e),this.ma=Kn("forwardChannelRequestTimeoutMs",2e4,e),this.Na=e&&e.g||void 0,this.D=void 0,this.C=e&&e.supportsCrossDomainXhr||!1,this.J="",this.b=new wn(e&&e.concurrentRequestLimit),this.ka=new kn,this.da=e&&e.fastHandshake||!1,this.Ia=e&&e.b||!1,e&&e.f&&(this.c.a=!1),e&&e.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&e&&e.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=e&&e.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Gn(e){var t,n;Wn(e),3==e.v&&(t=e.R++,tn(n=Xt(e.B),"SID",e.J),tn(n,"RID",t),tn(n,"TYPE","terminate"),Jn(e,n),(t=new Rt(e,e.c,t,void 0)).H=2,t.i=nn(Xt(n)),n=!1,k.navigator&&k.navigator.sendBeacon&&(n=k.navigator.sendBeacon(t.i.toString(),"")),!n&&k.Image&&((new Image).src=t.i,n=!0),n||(t.a=cr(t.g,null),t.a.ba(t.i)),t.u=V(),Vt(t)),sr(e)}function Qn(e){e.a&&(tr(e),e.a.cancel(),e.a=null)}function Wn(e){Qn(e),e.j&&(k.clearTimeout(e.j),e.j=null),rr(e),e.b.cancel(),e.h&&("number"==typeof e.h&&k.clearTimeout(e.h),e.h=null)}function Hn(e,t){e.g.push(new vn(e.Oa++,t)),3==e.v&&Yn(e)}function Yn(e){Tn(e.b)||e.h||(e.h=!0,He(e.Ba,e),e.u=0)}function Xn(e,t){var n=t?t.f:e.R++,r=Xt(e.B);tn(r,"SID",e.J),tn(r,"RID",n),tn(r,"AID",e.P),Jn(e,r),e.i&&e.l&&jn(r,e.i,e.l),n=new Rt(e,e.c,n,e.u+1),null===e.i&&(n.B=e.l),t&&(e.g=t.s.concat(e.g)),t=$n(e,n,1e3),n.setTimeout(Math.round(.5*e.ma)+Math.round(.5*e.ma*Math.random())),In(e.b,n),Mt(n,r,t)}function Jn(e,n){e.f&&zt({},function(e,t){tn(n,t,e)})}function $n(e,t,n){n=Math.min(e.g.length,n);var r=e.f?x(e.f.Ja,e.f,e):null;e:for(var i=e.g,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,l=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{!function(e,r,t){var i=t||"";try{zt(e,function(e,t){var n=e;R(e)&&(n=je(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(l,a,"req"+c+"_")}catch(e){r&&r(l)}}if(s){r=a.join("&");break e}}return e=e.g.splice(0,n),t.s=e,r}function Zn(e){e.a||e.j||(e.T=1,He(e.Aa,e),e.o=0)}function er(e){return!(e.a||e.j||3<=e.o)&&(e.T++,e.j=Tt(x(e.Aa,e),or(e,e.o)),e.o++,1)}function tr(e){null!=e.s&&(k.clearTimeout(e.s),e.s=null)}function nr(e){e.a=new Rt(e,e.c,"rpc",e.T),null===e.i&&(e.a.B=e.l),e.a.O=0;var t=Xt(e.la);tn(t,"RID","rpc"),tn(t,"SID",e.J),tn(t,"CI",e.H?"0":"1"),tn(t,"AID",e.P),Jn(e,t),tn(t,"TYPE","xmlhttp"),e.i&&e.l&&jn(t,e.i,e.l),e.D&&e.a.setTimeout(e.D);var n=e.a;e=e.ga,n.H=1,n.i=nn(Xt(t)),n.j=null,n.I=!0,xt(n,e)}function rr(e){null!=e.m&&(k.clearTimeout(e.m),e.m=null)}function ir(e,t){var n,r=null;if(e.a==t){rr(e),tr(e),e.a=null;var i=2}else{if(!_n(e.b,t))return;r=t.s,Sn(e.b,t),i=1}if(e.I=t.N,0!=e.v)if(t.b){1==i?(r=t.j?t.j.length:0,t=V()-t.u,n=e.u,Be(i=yt(),new bt(i)),Yn(e)):Zn(e)}else if(3==(n=t.h)||0==n&&0<e.I||!(1==i&&function(e,t){if(!(En(e.b)>=e.b.f-(e.h?1:0))){if(e.h)return e.g=t.s.concat(e.g),1;if(!(1==e.v||2==e.v||e.u>=(e.La?0:e.Ma)))return e.h=Tt(x(e.Ba,e,t),or(e,e.u)),e.u++,1}}(e,t)||2==i&&er(e)))switch(r&&0<r.length&&(t=e.b,t.c=t.c.concat(r)),n){case 1:ar(e,5);break;case 4:ar(e,10);break;case 3:ar(e,6);break;default:ar(e,2)}}function or(e,t){var n=e.Ha+Math.floor(Math.random()*e.Ra);return e.f||(n*=2),n*t}function ar(e,t){var n,r,i,o;e.c.info("Error code "+t),2==t?(r=null,e.f&&(r=null),o=x(e.Ya,e),r||(r=new Yt("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||Jt(r,"https"),nn(r)),n=r.toString(),r=o,o=new ht,k.Image?((i=new Image).onload=F(An,o,i,"TestLoadImage: loaded",!0,r),i.onerror=F(An,o,i,"TestLoadImage: error",!1,r),i.onabort=F(An,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=F(An,o,i,"TestLoadImage: timeout",!1,r),k.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):wt(2),e.v=0,e.f&&e.f.ra(t),sr(e),Wn(e)}function sr(e){e.v=0,e.I=-1,e.f&&(0==Cn(e.b).length&&0==e.g.length||(e.b.c.length=0,z(e.g),e.g.length=0),e.f.qa())}function ur(e,t,n){var r,i,o,a,s,u=(a=n)instanceof Yt?Xt(a):new Yt(a,void 0);return""!=u.c?(t&&$t(u,t+"."+u.c),Zt(u,u.h)):(s=k.location,r=s.protocol,i=t?t+"."+s.hostname:s.hostname,o=+s.port,a=n,s=new Yt(null,void 0),r&&Jt(s,r),i&&$t(s,i),o&&Zt(s,o),a&&(s.g=a),u=s),e.V&&J(e.V,function(e,t){tn(u,t,e)}),t=e.A,n=e.na,t&&n&&tn(u,t,n),tn(u,"VER",e.ha),Jn(e,u),u}function cr(e,t){if(t&&!e.C)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Rn(e.Na)).F=e.C,t}function lr(){}function hr(){if(ie&&!(10<=Number(pe)))throw Error("Environmental error: no available transport.")}function fr(e,t){qe.call(this),this.a=new zn(t),this.o=e,this.b=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.a.l=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.a&&(e?e["X-WebChannel-Client-Profile"]=t.a:e={"X-WebChannel-Client-Profile":t.a}),this.a.O=e,(e=t&&t.httpHeadersOverwriteParam)&&!G(e)&&(this.a.i=e),this.m=t&&t.supportsCrossDomainXhr||!1,this.l=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!G(t)&&(this.a.A=t,null!==(e=this.b)&&t in e&&(t in(e=this.b)&&delete e[t])),this.f=new yr(this)}function dr(e){kt.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.c=e)?(e=this.c,this.data=null!==t&&e in t?t[e]:void 0):this.data=t}else this.data=e}function pr(){At.call(this),this.status=1}function yr(e){this.a=e}(S=Rn.prototype).ba=function(e,t,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+e);t=t?t.toUpperCase():"GET",this.B=e,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?St(this.H):St(Dt),this.a.onreadystatechange=x(this.za,this);try{this.A=!0,this.a.open(t,String(e),!0),this.A=!1}catch(e){return void xn(this,e)}e=n||"";var i,o=new Gt(this.headers);r&&zt(r,function(e,t){o.set(t,e)}),r=function(e){e:{for(var t=Mn,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return t<0?null:"string"==typeof e?e.charAt(t):e[t]}(o.L()),n=k.FormData&&e instanceof k.FormData,0<=U(Pn,t)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(e,t){this.a.setRequestHeader(t,e)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Bn(this),0<this.o&&((this.D=(i=this.a,ie&&de(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=x(this.xa,this)):this.m=et(this.xa,this.o,this)),this.l=!0,this.a.send(e),this.l=!1}catch(e){xn(this,e)}},S.xa=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Be(this,"timeout"),this.abort(8))},S.abort=function(e){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=e||7,Be(this,"complete"),Be(this,"abort"),qn(this))},S.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),qn(this,!0)),Rn.X.G.call(this)},S.za=function(){this.j||(this.A||this.l||this.g?Vn(this):this.Ua())},S.Ua=function(){Vn(this)},S.W=function(){try{return 2<Un(this)?this.a.status:-1}catch(e){return-1}},S.$=function(){try{return this.a?this.a.responseText:""}catch(e){return""}},S.Pa=function(e){if(this.a){var t=this.a.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Nn(t)}},S.ua=function(){return this.h},S.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(S=zn.prototype).ha=8,S.v=1,S.Ba=function(e){if(this.h)if(this.h=null,1==this.v){if(!e){this.R=Math.floor(1e5*Math.random()),e=this.R++;var t,n=new Rt(this,this.c,e,void 0),r=this.l;if(this.O&&(r?ee(r=$(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)e:{for(var i=t=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(t+=o)){t=i;break e}if(4096===t||i===this.g.length-1){t=i+1;break e}}t=1e3}else t=1e3;t=$n(this,n,t),tn(i=Xt(this.B),"RID",e),tn(i,"CVER",22),this.A&&tn(i,"X-HTTP-Session-Id",this.A),Jn(this,i),this.i&&r&&jn(i,this.i,r),In(this.b,n),this.Ia&&tn(i,"TYPE","init"),this.da?(tn(i,"$req",t),tn(i,"SID","null"),n.U=!0,Mt(n,i,null)):Mt(n,i,t),this.v=2}}else 3==this.v&&(e?Xn(this,e):0==this.g.length||Tn(this.b)||Xn(this))},S.Aa=function(){var e;this.j=null,nr(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(e=2*this.N,this.c.info("BP detection timer enabled: "+e),this.s=Tt(x(this.Ta,this),e))},S.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,wt(10),Qn(this),nr(this))},S.Sa=function(){null!=this.m&&(this.m=null,Qn(this),er(this),wt(19))},S.Ya=function(e){e?(this.c.info("Successfully pinged google.com"),wt(2)):(this.c.info("Failed to ping google.com"),wt(1))},(S=lr.prototype).ta=function(){},S.sa=function(){},S.ra=function(){},S.qa=function(){},S.Ja=function(){},hr.prototype.a=function(e,t){return new fr(e,t)},q(fr,qe),fr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var e=this.a,t=this.o,n=this.b||void 0;wt(0),e.fa=t,e.V=n||{},e.H=e.S,e.B=ur(e,null,e.fa),Yn(e)},fr.prototype.close=function(){Gn(this.a)},fr.prototype.h=function(e){var t;"string"==typeof e?((t={}).__data__=e,Hn(this.a,t)):this.l?((t={}).__data__=je(e),Hn(this.a,t)):Hn(this.a,e)},fr.prototype.G=function(){this.a.f=null,delete this.f,Gn(this.a),delete this.a,fr.X.G.call(this)},q(dr,kt),q(pr,At),q(yr,lr),yr.prototype.ta=function(){Be(this.a,"a")},yr.prototype.sa=function(e){Be(this.a,new dr(e))},yr.prototype.ra=function(e){Be(this.a,new pr)},yr.prototype.qa=function(){Be(this.a,"b")},hr.prototype.createWebChannel=hr.prototype.a,fr.prototype.send=fr.prototype.h,fr.prototype.open=fr.prototype.g,Et.NO_ERROR=0,Et.TIMEOUT=8,Et.HTTP_ERROR=6,_t.COMPLETE="complete",(Ct.EventType=C).OPEN="a",C.CLOSE="b",C.ERROR="c",C.MESSAGE="d",qe.prototype.listen=qe.prototype.va,Rn.prototype.listenOnce=Rn.prototype.wa,Rn.prototype.getLastError=Rn.prototype.Qa,Rn.prototype.getLastErrorCode=Rn.prototype.ua,Rn.prototype.getStatus=Rn.prototype.W,Rn.prototype.getResponseJson=Rn.prototype.Pa,Rn.prototype.getResponseText=Rn.prototype.$,Rn.prototype.send=Rn.prototype.ba;var gr=yt,mr=Et,vr=_t,wr=dt,br=10,Tr=11,Er=Ct,_r=Rn,Ir=(Sr.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},Sr.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},Sr.prototype.setServiceProps=function(e){return this.serviceProps=e,this},Sr);function Sr(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Cr=function(e,t,n,r,i,o){this.databaseId=e,this.persistenceKey=t,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},Dr="(default)",kr=(Object.defineProperty(Ar.prototype,"isDefaultDatabase",{get:function(){return this.database===Dr},enumerable:!1,configurable:!0}),Ar.prototype.isEqual=function(e){return e instanceof Ar&&e.projectId===this.projectId&&e.database===this.database},Ar);function Ar(e,t){this.projectId=e,this.database=t||Dr}var Nr=(Rr.prototype.isAuthenticated=function(){return null!=this.uid},Rr.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Rr.prototype.isEqual=function(e){return e.uid===this.uid},Rr);function Rr(e){this.uid=e}Nr.UNAUTHENTICATED=new Nr(null),Nr.GOOGLE_CREDENTIALS=new Nr("google-credentials-uid"),Nr.FIRST_PARTY=new Nr("first-party-uid");var Or,Lr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Pr=(n(Mr,Or=Error),Mr);function Mr(e,t){var n=Or.call(this,t)||this;return n.code=e,n.message=t,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}var xr="8.1.1-1.0.0-eap-firestore-debug.9c6096f43";var Fr=new h("@firebase/firestore");function Vr(){return Fr.logLevel}function qr(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Fr.logLevel<=s.DEBUG&&(t=n.map(jr),Fr.debug.apply(Fr,a(["Firestore ("+xr+"): "+e],t)))}function Br(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Fr.logLevel<=s.ERROR&&(t=n.map(jr),Fr.error.apply(Fr,a(["Firestore ("+xr+"): "+e],t)))}function Ur(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Fr.logLevel<=s.WARN&&(t=n.map(jr),Fr.warn.apply(Fr,a(["Firestore ("+xr+"): "+e],t)))}function jr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Kr(e){void 0===e&&(e="Unexpected state");e="FIRESTORE ("+xr+") INTERNAL ASSERTION FAILED: "+e;throw Br(e),new Error(e)}function zr(e,t){e||Kr(t)}function Gr(e,t){e||Kr(t)}function Qr(e,t){return Gr(e instanceof t,"Expected type '"+t.name+"', but was '"+e.constructor.name+"'"),e}var Wr=(Hr.newId=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;Gr(0<t&&t<256,"Expect maxMultiple to be (0, 256), but got "+t);for(var n="";n.length<20;)for(var r=function(e){Gr(0<=e,"Expecting non-negative nBytes, got: "+e);var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return Gr(20===n.length,"Invalid auto ID: "+n),n},Hr);function Hr(){}function Yr(e,t){return e<t?-1:t<e?1:0}function Xr(e,n,r){return e.length===n.length&&e.every(function(e,t){return r(e,n[t])})}var Jr=-62135596800,$r=(Zr.now=function(){return Zr.fromMillis(Date.now())},Zr.fromDate=function(e){return Zr.fromMillis(e.getTime())},Zr.fromMillis=function(e){var t=Math.floor(e/1e3);return new Zr(t,1e6*(e-1e3*t))},Zr.prototype.toDate=function(){return new Date(this.toMillis())},Zr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Zr.prototype._compareTo=function(e){return this.seconds===e.seconds?Yr(this.nanoseconds,e.nanoseconds):Yr(this.seconds,e.seconds)},Zr.prototype.isEqual=function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds},Zr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Zr.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Zr.prototype.valueOf=function(){var e=this.seconds-Jr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Zr);function Zr(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new Pr(Lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new Pr(Lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Jr)throw new Pr(Lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new Pr(Lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}function ei(e){var t,n=0;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n++;return n}function ti(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ni(e){for(var t in Gr(null!=e&&"object"==typeof e,"isEmpty() expects object parameter."),e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var ri=(ii.fromBase64String=function(e){return new ii(atob(e))},ii.fromUint8Array=function(e){return new ii(function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))},ii.prototype.toBase64=function(){return e=this.binaryString,btoa(e);var e},ii.prototype.toUint8Array=function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)},ii.prototype.approximateByteSize=function(){return 2*this.binaryString.length},ii.prototype.compareTo=function(e){return Yr(this.binaryString,e.binaryString)},ii.prototype.isEqual=function(e){return this.binaryString===e.binaryString},ii);function ii(e){this.binaryString=e}function oi(e){return null==e}function ai(e){return 0===e&&1/e==-1/0}ri.EMPTY_BYTE_STRING=new ri("");var si="__name__",Et=(Object.defineProperty(ui.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),ui.prototype.isEqual=function(e){return 0===ui.comparator(this,e)},ui.prototype.child=function(e){var t=this.segments.slice(this.offset,this.limit());return e instanceof ui?e.forEach(function(e){t.push(e)}):t.push(e),this.construct(t)},ui.prototype.limit=function(){return this.offset+this.length},ui.prototype.popFirst=function(e){return e=void 0===e?1:e,Gr(this.length>=e,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+e,this.length-e)},ui.prototype.popLast=function(){return Gr(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},ui.prototype.firstSegment=function(){return Gr(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},ui.prototype.lastSegment=function(){return this.get(this.length-1)},ui.prototype.get=function(e){return Gr(e<this.length,"Index out of range"),this.segments[this.offset+e]},ui.prototype.isEmpty=function(){return 0===this.length},ui.prototype.isPrefixOf=function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},ui.prototype.isImmediateParentOf=function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},ui.prototype.forEach=function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])},ui.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},ui.comparator=function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),o=t.get(r);if(i<o)return-1;if(o<i)return 1}return e.length<t.length?-1:e.length>t.length?1:0},ui);function ui(e,t,n){void 0===t?t=0:t>e.length&&Kr("offset "+t+" out of range "+e.length),void 0===n?n=e.length-t:n>e.length-t&&Kr("length "+n+" out of range "+(e.length-t)),this.segments=e,this.offset=t,this.len=n}var ci,li=(n(hi,ci=Et),hi.prototype.construct=function(e,t,n){return new hi(e,t,n)},hi.prototype.canonicalString=function(){return this.toArray().join("/")},hi.prototype.toString=function(){return this.canonicalString()},hi.fromString=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(e){return 0<e.length}))}return new hi(n)},hi.emptyPath=function(){return new hi([])},hi);function hi(){return null!==ci&&ci.apply(this,arguments)||this}var fi,di=/^[_a-zA-Z][_a-zA-Z0-9]*$/,pi=(n(yi,fi=Et),yi.prototype.construct=function(e,t,n){return new yi(e,t,n)},yi.isValidIdentifier=function(e){return di.test(e)},yi.prototype.canonicalString=function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),yi.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")},yi.prototype.toString=function(){return this.canonicalString()},yi.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===si},yi.keyField=function(){return new yi([si])},yi.fromServerFormat=function(e){for(var t=[],n="",r=0,i=function(){if(0===n.length)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");t.push(n),n=""},o=!1;r<e.length;){var a=e[r];if("\\"===a){if(r+1===e.length)throw new Pr(Lr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Pr(Lr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Pr(Lr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new yi(t)},yi.emptyPath=function(){return new yi([])},yi);function yi(){return null!==fi&&fi.apply(this,arguments)||this}var gi=(mi.fromPath=function(e){return new mi(li.fromString(e))},mi.fromName=function(e){return new mi(li.fromString(e).popFirst(5))},mi.prototype.hasCollectionId=function(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e},mi.prototype.isEqual=function(e){return null!==e&&0===li.comparator(this.path,e.path)},mi.prototype.toString=function(){return this.path.toString()},mi.comparator=function(e,t){return li.comparator(e.path,t.path)},mi.isDocumentKey=function(e){return e.length%2==0},mi.fromSegments=function(e){return new mi(new li(e.slice()))},mi);function mi(e){this.path=e,Gr(mi.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}var vi="server_timestamp",wi="__type__",bi="__previous_value__",Ti="__local_write_time__";function Ei(e){return(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{})[wi])||void 0===e?void 0:e.stringValue)===vi}function _i(e){e=Oi(e.mapValue.fields[Ti].timestampValue);return new $r(e.seconds,e.nanos)}var Ii=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Si(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ei(e)?4:10:Kr("Invalid value type: "+JSON.stringify(e))}function Ci(e,t){var n,r=Si(e);if(r!==Si(t))return!1;switch(r){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return _i(e).isEqual(_i(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;e=Oi(e.timestampValue),t=Oi(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return n=t,Pi(e.bytesValue).isEqual(Pi(n.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return r=t,Li((n=e).geoPointValue.latitude)===Li(r.geoPointValue.latitude)&&Li(n.geoPointValue.longitude)===Li(r.geoPointValue.longitude);case 2:return function(e,t){{if("integerValue"in e&&"integerValue"in t)return Li(e.integerValue)===Li(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){e=Li(e.doubleValue),t=Li(t.doubleValue);return e===t?ai(e)===ai(t):isNaN(e)&&isNaN(t)}}return!1}(e,t);case 9:return Xr(e.arrayValue.values||[],t.arrayValue.values||[],Ci);case 10:return function(e,t){var n,r=e.mapValue.fields||{},i=t.mapValue.fields||{};if(ei(r)!==ei(i))return!1;for(n in r)if(r.hasOwnProperty(n)&&(void 0===i[n]||!Ci(r[n],i[n])))return!1;return!0}(e,t);default:return Kr("Unexpected value type: "+JSON.stringify(e))}}function Di(e,t){return void 0!==(e.values||[]).find(function(e){return Ci(e,t)})}function ki(e,t){var n,r,i=Si(e),o=Si(t);if(i!==o)return Yr(i,o);switch(i){case 0:return 0;case 1:return Yr(e.booleanValue,t.booleanValue);case 2:return function(e,t){e=Li(e.integerValue||e.doubleValue),t=Li(t.integerValue||t.doubleValue);return e<t?-1:t<e?1:e===t?0:isNaN(e)?isNaN(t)?0:-1:1}(e,t);case 3:return Ai(e.timestampValue,t.timestampValue);case 4:return Ai(_i(e),_i(t));case 5:return Yr(e.stringValue,t.stringValue);case 6:return function(e,t){e=Pi(e),t=Pi(t);return e.compareTo(t)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Yr(n[i],r[i]);if(0!==o)return o}return Yr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0===(o=Yr(Li(n.latitude),Li(r.latitude)))?Yr(Li(n.longitude),Li(r.longitude)):o;case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var o=ki(n[i],r[i]);if(o)return o}return Yr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var a=0;a<r.length&&a<o.length;++a){var s=Yr(r[a],o[a]);if(0!==s)return s;s=ki(n[r[a]],i[o[a]]);if(0!==s)return s}return Yr(r.length,o.length)}(e.mapValue,t.mapValue);default:throw Kr("Invalid value type: "+i)}}function Ai(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Yr(e,t);var n=Oi(e),e=Oi(t),t=Yr(n.seconds,e.seconds);return 0!==t?t:Yr(n.nanos,e.nanos)}function Ni(e){return Ri(e)}function Ri(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){e=Oi(e);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Pi(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,gi.fromName(t).toString()):"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(e){for(var t="[",n=!0,r=0,i=e.values||[];r<i.length;r++){n?n=!1:t+=",",t+=Ri(i[r])}return t+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var t=Object.keys(e.fields||{}).sort(),n="{",r=!0,i=0,o=t;i<o.length;i++){var a=o[i];r?r=!1:n+=",",n+=a+":"+Ri(e.fields[a])}return n+"}"}(e.mapValue):Kr("Invalid value type: "+JSON.stringify(e));var t}function Oi(e){if(zr(!!e,"Cannot normalize null or undefined timestamp."),"string"!=typeof e)return{seconds:Li(e.seconds),nanos:t=Li(e.nanos)};var t=0,n=Ii.exec(e);zr(!!n,"invalid timestamp: "+e),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),t=Number(n));e=new Date(e);return{seconds:Math.floor(e.getTime()/1e3),nanos:t}}function Li(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Pi(e){return"string"==typeof e?ri.fromBase64String(e):ri.fromUint8Array(e)}function Mi(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function xi(e){return!!e&&"integerValue"in e}function Fi(e){return xi(e)||!!(e=e)&&"doubleValue"in e}function Vi(e){return!!e&&"arrayValue"in e}function qi(e){return!!e&&"referenceValue"in e}function Bi(e){return e&&"nullValue"in e}function Ui(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ji(e){return e&&"mapValue"in e}var Ki,_t=function(e,t){this.key=e,this.version=t},zi=(n(Gi,Ki=_t),Gi.prototype.field=function(e){return this.objectValue.field(e)},Gi.prototype.data=function(){return this.objectValue},Gi.prototype.toProto=function(){return this.objectValue.proto},Gi.prototype.isEqual=function(e){return e instanceof Gi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.hasLocalMutations===e.hasLocalMutations&&this.hasCommittedMutations===e.hasCommittedMutations&&this.objectValue.isEqual(e.objectValue)},Gi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Gi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Gi);function Gi(e,t,n,r){t=Ki.call(this,e,t)||this;return t.objectValue=n,t.hasLocalMutations=!!r.hasLocalMutations,t.hasCommittedMutations=!!r.hasCommittedMutations,t}var Qi,Wi=(n(Hi,Qi=_t),Hi.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Hi.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Hi.prototype.isEqual=function(e){return e instanceof Hi&&e.hasCommittedMutations===this.hasCommittedMutations&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},Hi);function Hi(e,t,n){t=Qi.call(this,e,t)||this;return t.hasCommittedMutations=!(!n||!n.hasCommittedMutations),t}var Yi,Xi=(n(Ji,Yi=_t),Ji.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ji.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Ji.prototype.isEqual=function(e){return e instanceof Ji&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},Ji);function Ji(){return null!==Yi&&Yi.apply(this,arguments)||this}var $i=function(e,t,n,r,i,o,a){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null};function Zi(e,t,n,r,i,o,a){return void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),new $i(e,t,n,r,i,o,a)}function eo(e){var t=Qr(e,$i);return null===t.memoizedCanonicalId&&(e=t.path.canonicalString(),null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(function(e){return Gr((e=e)instanceof Eo,"canonifyFilter() only supports FieldFilters"),e.field.canonicalString()+e.op.toString()+Ni(e.value)}).join(","),e+="|ob:",e+=t.orderBy.map(function(e){return(e=e).field.canonicalString()+e.dir}).join(","),oi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=Wo(t.startAt)),t.endAt&&(e+="|ub:",e+=Wo(t.endAt)),t.memoizedCanonicalId=e),t.memoizedCanonicalId}function to(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=", filters: ["+e.filters.map(function(e){return Gr((e=e)instanceof Eo,"stringifyFilter() only supports FieldFilters"),e.field.canonicalString()+" "+e.op+" "+Ni(e.value)}).join(", ")+"]"),oi(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=", orderBy: ["+e.orderBy.map(function(e){return(e=e).field.canonicalString()+" ("+e.dir+")"}).join(", ")+"]"),e.startAt&&(t+=", startAt: "+Wo(e.startAt)),e.endAt&&(t+=", endAt: "+Wo(e.endAt)),"Target("+t+")"}function no(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n,r,i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(e.filters.length!==t.filters.length)return!1;for(var o,a,i=0;i<e.filters.length;i++)if(o=e.filters[i],a=t.filters[i],Gr(o instanceof Eo&&a instanceof Eo,"Only FieldFilters can be compared"),o.op!==a.op||!o.field.isEqual(a.field)||!Ci(o.value,a.value))return!1;return e.collectionGroup===t.collectionGroup&&(!!e.path.isEqual(t.path)&&(!!Yo(e.startAt,t.startAt)&&Yo(e.endAt,t.endAt)))}function ro(e){return gi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var io=function(e,t,n,r,i,o,a,s){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===a&&(a=null),void 0===s&&(s=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&Gr(this.startAt.position.length<=fo(this).length,"Bound is longer than orderBy"),this.endAt&&Gr(this.endAt.position.length<=fo(this).length,"Bound is longer than orderBy")};function oo(e){return new io(e)}function ao(e){return!oi(e.limit)&&"F"===e.limitType}function so(e){return!oi(e.limit)&&"L"===e.limitType}function uo(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function co(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(Gr(r instanceof Eo,"Only FieldFilters are supported"),r.isInequality())return r.field}return null}function lo(e){return gi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ho(e){return null!==e.collectionGroup}function fo(e){var t=Qr(e,io);if(null===t.memoizedOrderBy){t.memoizedOrderBy=[];var n=co(t),e=uo(t);if(null!==n&&null===e)n.isKeyField()||t.memoizedOrderBy.push(new Xo(n)),t.memoizedOrderBy.push(new Xo(pi.keyField(),"asc"));else{Gr(null===n||null!==e&&n.isEqual(e),"First orderBy should match inequality field.");for(var r=!1,i=0,o=t.explicitOrderBy;i<o.length;i++){var a=o[i];t.memoizedOrderBy.push(a),a.field.isKeyField()&&(r=!0)}r||(e=0<t.explicitOrderBy.length?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",t.memoizedOrderBy.push(new Xo(pi.keyField(),e)))}}return t.memoizedOrderBy}function po(e){var t=Qr(e,io);if(!t.memoizedTarget)if("F"===t.limitType)t.memoizedTarget=Zi(t.path,t.collectionGroup,fo(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=fo(t);r<i.length;r++){var o=i[r],a="desc"===o.dir?"asc":"desc";n.push(new Xo(o.field,a))}var s=t.endAt?new Qo(t.endAt.position,!t.endAt.before):null,e=t.startAt?new Qo(t.startAt.position,!t.startAt.before):null;t.memoizedTarget=Zi(t.path,t.collectionGroup,n,t.filters,t.limit,s,e)}return t.memoizedTarget}function yo(e,t,n){return new io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function go(e,t){return no(po(e),po(t))&&e.limitType===t.limitType}function mo(e){return eo(po(e))+"|lt:"+e.limitType}function vo(e){return"Query(target="+to(po(e))+"; limitType="+e.limitType+")"}function wo(e,t){return n=e,i=(r=t).key.path,(null!==n.collectionGroup?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):gi.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i))&&function(e,t){for(var n=0,r=e.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===t.field(i.field))return}return 1}(e,t)&&function(e,t){for(var n=0,r=e.filters;n<r.length;n++){if(!r[n].matches(t))return}return 1}(e,t)&&function(e,t){if(e.startAt&&!Ho(e.startAt,fo(e),t))return;if(e.endAt&&Ho(e.endAt,fo(e),t))return;return 1}(e,t);var n,r,i}function bo(s){return function(e,t){for(var n=!1,r=0,i=fo(s);r<i.length;r++){var o=i[r],a=function(e,t,n){n=e.field.isKeyField()?gi.comparator(t.key,n.key):function(e,t,n){return t=t.field(e),e=n.field(e),null!==t&&null!==e?ki(t,e):Kr("Trying to compare documents on fields that don't exist")}(e.field,t,n);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Kr("Unknown direction: "+e.dir)}}(o,e,t);if(0!==a)return a;n=n||o.field.isKeyField()}return Gr(n,"orderBy used that doesn't compare on key field"),0}}var To,Eo=(n(_o,To=function(){}),_o.create=function(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):(Gr(qi(n),"Comparing on key, but filter value not a RefValue"),Gr("array-contains"!==t&&"array-contains-any"!==t,"'"+t.toString()+"' queries don't make sense on document keys."),new So(e,t,n)):"array-contains"===t?new Mo(e,n):"in"===t?(Gr(Vi(n),"IN filter has invalid value: "+n.toString()),new Vo(e,n)):"not-in"===t?(Gr(Vi(n),"NOT_IN filter has invalid value: "+n.toString()),new Uo(e,n)):"array-contains-any"===t?(Gr(Vi(n),"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new zo(e,n)):new _o(e,t,n)},_o.createKeyFieldInFilter=function(e,t,n){return Gr(Vi(n),"Comparing on key with "+t.toString()+", but filter value not an ArrayValue"),Gr((n.arrayValue.values||[]).every(qi),"Comparing on key with "+t.toString()+", but an array value was not a RefValue"),new("in"===t?ko:Ro)(e,n)},_o.prototype.matches=function(e){e=e.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(ki(e,this.value)):null!==e&&Si(this.value)===Si(e)&&this.matchesComparison(ki(e,this.value))},_o.prototype.matchesComparison=function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Kr("Unknown FieldFilter operator: "+this.op)}},_o.prototype.isInequality=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},_o);function _o(e,t,n){var r=To.call(this)||this;return r.field=e,r.op=t,r.value=n,r}var Io,So=(n(Co,Io=Eo),Co.prototype.matches=function(e){e=gi.comparator(e.key,this.key);return this.matchesComparison(e)},Co);function Co(e,t,n){t=Io.call(this,e,t,n)||this;return Gr(qi(n),"KeyFieldFilter expects a ReferenceValue"),t.key=gi.fromName(n.referenceValue),t}var Do,ko=(n(Ao,Do=Eo),Ao.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},Ao);function Ao(e,t){e=Do.call(this,e,"in",t)||this;return e.keys=Lo("in",t),e}var No,Ro=(n(Oo,No=Eo),Oo.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},Oo);function Oo(e,t){e=No.call(this,e,"not-in",t)||this;return e.keys=Lo("not-in",t),e}function Lo(t,e){return Gr(Vi(e),"KeyFieldInFilter/KeyFieldNotInFilter expects an ArrayValue"),((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(e){return Gr(qi(e),"Comparing on key with "+t.toString()+", but an array value was not a ReferenceValue"),gi.fromName(e.referenceValue)})}var Po,Mo=(n(xo,Po=Eo),xo.prototype.matches=function(e){e=e.field(this.field);return Vi(e)&&Di(e.arrayValue,this.value)},xo);function xo(e,t){return Po.call(this,e,"array-contains",t)||this}var Fo,Vo=(n(qo,Fo=Eo),qo.prototype.matches=function(e){e=e.field(this.field);return null!==e&&Di(this.value.arrayValue,e)},qo);function qo(e,t){e=Fo.call(this,e,"in",t)||this;return Gr(Vi(t),"InFilter expects an ArrayValue"),e}var Bo,Uo=(n(jo,Bo=Eo),jo.prototype.matches=function(e){if(Di(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.field(this.field);return null!==e&&!Di(this.value.arrayValue,e)},jo);function jo(e,t){e=Bo.call(this,e,"not-in",t)||this;return Gr(Vi(t),"NotInFilter expects an ArrayValue"),e}var Ko,zo=(n(Go,Ko=Eo),Go.prototype.matches=function(e){var t=this,e=e.field(this.field);return!(!Vi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(function(e){return Di(t.value.arrayValue,e)})},Go);function Go(e,t){e=Ko.call(this,e,"array-contains-any",t)||this;return Gr(Vi(t),"ArrayContainsAnyFilter expects an ArrayValue"),e}var Qo=function(e,t){this.position=e,this.before=t};function Wo(e){return(e.before?"b":"a")+":"+e.position.map(Ni).join(",")}function Ho(e,t,n){Gr(e.position.length<=t.length,"Bound has more components than query's orderBy");for(var r=0,i=0;i<e.position.length;i++){var o,a=t[i],s=e.position[i],r=a.field.isKeyField()?(Gr(qi(s),"Bound has a non-key value where the key path is being used."),gi.comparator(gi.fromName(s.referenceValue),n.key)):(Gr(null!==(o=n.field(a.field)),"Field should exist since document matched the orderBy already."),ki(s,o));if("desc"===a.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function Yo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++){if(!Ci(e.position[n],t.position[n]))return!1}return!0}var Xo=function(e,t){void 0===t&&(t="asc"),this.field=e,this.dir=t};var Jo=($o.fromTimestamp=function(e){return new $o(e)},$o.min=function(){return new $o(new $r(0,0))},$o.prototype.compareTo=function(e){return this.timestamp._compareTo(e.timestamp)},$o.prototype.isEqual=function(e){return this.timestamp.isEqual(e.timestamp)},$o.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},$o.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},$o.prototype.toTimestamp=function(){return this.timestamp},$o);function $o(e){this.timestamp=e}var Zo=(ea.prototype.insert=function(e,t){return new ea(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ra.BLACK,null,null))},ea.prototype.remove=function(e){return new ea(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ra.BLACK,null,null))},ea.prototype.get=function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null},ea.prototype.indexOf=function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1},ea.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(ea.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),ea.prototype.minKey=function(){return this.root.minKey()},ea.prototype.maxKey=function(){return this.root.maxKey()},ea.prototype.inorderTraversal=function(e){return this.root.inorderTraversal(e)},ea.prototype.forEach=function(n){this.inorderTraversal(function(e,t){return n(e,t),!1})},ea.prototype.toString=function(){var n=[];return this.inorderTraversal(function(e,t){return n.push(e+":"+t),!1}),"{"+n.join(", ")+"}"},ea.prototype.reverseTraversal=function(e){return this.root.reverseTraversal(e)},ea.prototype.getIterator=function(){return new ta(this.root,null,this.comparator,!1)},ea.prototype.getIteratorFrom=function(e){return new ta(this.root,e,this.comparator,!1)},ea.prototype.getReverseIterator=function(){return new ta(this.root,null,this.comparator,!0)},ea.prototype.getReverseIteratorFrom=function(e){return new ta(this.root,e,this.comparator,!0)},ea);function ea(e,t){this.comparator=e,this.root=t||ra.EMPTY}var ta=(na.prototype.getNext=function(){Gr(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t},na.prototype.hasNext=function(){return 0<this.nodeStack.length},na.prototype.peek=function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}},na);function na(e,t,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}var ra=(ia.prototype.copy=function(e,t,n,r,i){return new ia(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},ia.prototype.isEmpty=function(){return!1},ia.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},ia.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},ia.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},ia.prototype.minKey=function(){return this.min().key},ia.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},ia.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()},ia.prototype.removeMin=function(){if(this.left.isEmpty())return ia.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},ia.prototype.remove=function(e,t){var n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ia.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()},ia.prototype.isRed=function(){return this.color},ia.prototype.fixUp=function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e},ia.prototype.moveRedLeft=function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e},ia.prototype.moveRedRight=function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e},ia.prototype.rotateLeft=function(){var e=this.copy(null,null,ia.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},ia.prototype.rotateRight=function(){var e=this.copy(null,null,ia.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},ia.prototype.colorFlip=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},ia.prototype.checkMaxDepth=function(){var e=this.check();return Math.pow(2,e)<=this.size+1},ia.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Kr("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Kr("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check();if(e!==this.right.check())throw Kr("Black depths differ");return e+(this.isRed()?0:1)},ia);function ia(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ia.RED,this.left=null!=r?r:ia.EMPTY,this.right=null!=i?i:ia.EMPTY,this.size=this.left.size+1+this.right.size}ra.EMPTY=null,ra.RED=!0,ra.BLACK=!1;Object.defineProperty(oa.prototype,"key",{get:function(){throw Kr("LLRBEmptyNode has no key.")},enumerable:!1,configurable:!0}),Object.defineProperty(oa.prototype,"value",{get:function(){throw Kr("LLRBEmptyNode has no value.")},enumerable:!1,configurable:!0}),Object.defineProperty(oa.prototype,"color",{get:function(){throw Kr("LLRBEmptyNode has no color.")},enumerable:!1,configurable:!0}),Object.defineProperty(oa.prototype,"left",{get:function(){throw Kr("LLRBEmptyNode has no left child.")},enumerable:!1,configurable:!0}),Object.defineProperty(oa.prototype,"right",{get:function(){throw Kr("LLRBEmptyNode has no right child.")},enumerable:!1,configurable:!0}),oa.prototype.copy=function(e,t,n,r,i){return this},oa.prototype.insert=function(e,t,n){return new ra(e,t)},oa.prototype.remove=function(e,t){return this},oa.prototype.isEmpty=function(){return!0},oa.prototype.inorderTraversal=function(e){return!1},oa.prototype.reverseTraversal=function(e){return!1},oa.prototype.minKey=function(){return null},oa.prototype.maxKey=function(){return null},oa.prototype.isRed=function(){return!1},oa.prototype.checkMaxDepth=function(){return!0},oa.prototype.check=function(){return 0},h=oa;function oa(){this.size=0}ra.EMPTY=new h;var aa=(sa.prototype.has=function(e){return null!==this.data.get(e)},sa.prototype.first=function(){return this.data.minKey()},sa.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(sa.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),sa.prototype.indexOf=function(e){return this.data.indexOf(e)},sa.prototype.forEach=function(n){this.data.inorderTraversal(function(e,t){return n(e),!1})},sa.prototype.forEachInRange=function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}},sa.prototype.forEachWhile=function(e,t){for(var n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();){if(!e(n.getNext().key))return}},sa.prototype.firstAfterOrEqual=function(e){e=this.data.getIteratorFrom(e);return e.hasNext()?e.getNext().key:null},sa.prototype.getIterator=function(){return new ua(this.data.getIterator())},sa.prototype.getIteratorFrom=function(e){return new ua(this.data.getIteratorFrom(e))},sa.prototype.add=function(e){return this.copy(this.data.remove(e).insert(e,!0))},sa.prototype.delete=function(e){return this.has(e)?this.copy(this.data.remove(e)):this},sa.prototype.isEmpty=function(){return this.data.isEmpty()},sa.prototype.unionWith=function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t},sa.prototype.isEqual=function(e){if(!(e instanceof sa))return!1;if(this.size!==e.size)return!1;for(var t=this.data.getIterator(),n=e.data.getIterator();t.hasNext();){var r=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},sa.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},sa.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},sa.prototype.copy=function(e){var t=new sa(this.comparator);return t.data=e,t},sa);function sa(e){this.comparator=e,this.data=new Zo(this.comparator)}var ua=(ca.prototype.getNext=function(){return this.iter.getNext().key},ca.prototype.hasNext=function(){return this.iter.hasNext()},ca);function ca(e){this.iter=e}var la=new Zo(gi.comparator);var ha=new Zo(gi.comparator);var fa=new Zo(gi.comparator);var da=new aa(gi.comparator);function pa(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=da,r=0,i=e;r<i.length;r++)var o=i[r],n=n.add(o);return n}var ya=new aa(Yr);var ga=(ma.empty=function(){return new ma({mapValue:{}})},ma.prototype.field=function(e){if(e.isEmpty())return this.proto;for(var t=this.proto,n=0;n<e.length-1;++n){if(!t.mapValue.fields)return null;if(!ji(t=t.mapValue.fields[e.get(n)]))return null}return(t=(t.mapValue.fields||{})[e.lastSegment()])||null},ma.prototype.isEqual=function(e){return Ci(this.proto,e.proto)},ma);function ma(e){Gr(!Ei(this.proto=e),"ServerTimestamps should be converted to ServerTimestampValue")}var va=(wa.prototype.set=function(e,t){return Gr(!e.isEmpty(),"Cannot set field for empty path on ObjectValue"),this.setOverlay(e,t),this},wa.prototype.delete=function(e){return Gr(!e.isEmpty(),"Cannot delete field for empty path on ObjectValue"),this.setOverlay(e,null),this},wa.prototype.setOverlay=function(e,t){for(var n=this.overlayMap,r=0;r<e.length-1;++r)var i=e.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===Si(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(e.lastSegment(),t)},wa.prototype.build=function(){var e=this.applyOverlay(pi.emptyPath(),this.overlayMap);return null!=e?new ga(e):this.baseObject},wa.prototype.applyOverlay=function(r,e){var i=this,o=!1,t=this.baseObject.field(r),a=ji(t)?Object.assign({},t.mapValue.fields):{};return e.forEach(function(e,t){var n;e instanceof Map?null!=(n=i.applyOverlay(r.child(t),e))&&(a[t]=n,o=!0):null!==e?(a[t]=e,o=!0):a.hasOwnProperty(t)&&(delete a[t],o=!0)}),o?{mapValue:{fields:a}}:null},wa);function wa(e){void 0===e&&(e=ga.empty()),this.baseObject=e,this.overlayMap=new Map}var ba,Ta=function(e){this.count=e};function Ea(e){switch(e){case Lr.OK:return Kr("Treated status OK as error");case Lr.CANCELLED:case Lr.UNKNOWN:case Lr.DEADLINE_EXCEEDED:case Lr.RESOURCE_EXHAUSTED:case Lr.INTERNAL:case Lr.UNAVAILABLE:case Lr.UNAUTHENTICATED:return!1;case Lr.INVALID_ARGUMENT:case Lr.NOT_FOUND:case Lr.ALREADY_EXISTS:case Lr.PERMISSION_DENIED:case Lr.FAILED_PRECONDITION:case Lr.ABORTED:case Lr.OUT_OF_RANGE:case Lr.UNIMPLEMENTED:case Lr.DATA_LOSS:return!0;default:return Kr("Unknown status code: "+e)}}function _a(e){if(void 0===e)return Br("GRPC error has no .code"),Lr.UNKNOWN;switch(e){case ba.OK:return Lr.OK;case ba.CANCELLED:return Lr.CANCELLED;case ba.UNKNOWN:return Lr.UNKNOWN;case ba.DEADLINE_EXCEEDED:return Lr.DEADLINE_EXCEEDED;case ba.RESOURCE_EXHAUSTED:return Lr.RESOURCE_EXHAUSTED;case ba.INTERNAL:return Lr.INTERNAL;case ba.UNAVAILABLE:return Lr.UNAVAILABLE;case ba.UNAUTHENTICATED:return Lr.UNAUTHENTICATED;case ba.INVALID_ARGUMENT:return Lr.INVALID_ARGUMENT;case ba.NOT_FOUND:return Lr.NOT_FOUND;case ba.ALREADY_EXISTS:return Lr.ALREADY_EXISTS;case ba.PERMISSION_DENIED:return Lr.PERMISSION_DENIED;case ba.FAILED_PRECONDITION:return Lr.FAILED_PRECONDITION;case ba.ABORTED:return Lr.ABORTED;case ba.OUT_OF_RANGE:return Lr.OUT_OF_RANGE;case ba.UNIMPLEMENTED:return Lr.UNIMPLEMENTED;case ba.DATA_LOSS:return Lr.DATA_LOSS;default:return Kr("Unknown status code: "+e)}}(Et=ba=ba||{})[Et.OK=0]="OK",Et[Et.CANCELLED=1]="CANCELLED",Et[Et.UNKNOWN=2]="UNKNOWN",Et[Et.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Et[Et.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Et[Et.NOT_FOUND=5]="NOT_FOUND",Et[Et.ALREADY_EXISTS=6]="ALREADY_EXISTS",Et[Et.PERMISSION_DENIED=7]="PERMISSION_DENIED",Et[Et.UNAUTHENTICATED=16]="UNAUTHENTICATED",Et[Et.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Et[Et.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Et[Et.ABORTED=10]="ABORTED",Et[Et.OUT_OF_RANGE=11]="OUT_OF_RANGE",Et[Et.UNIMPLEMENTED=12]="UNIMPLEMENTED",Et[Et.INTERNAL=13]="INTERNAL",Et[Et.UNAVAILABLE=14]="UNAVAILABLE",Et[Et.DATA_LOSS=15]="DATA_LOSS";var Ia=(Sa.createSynthesizedRemoteEventForCurrentChange=function(e,t){var n=new Map;return n.set(e,Ca.createSynthesizedTargetChangeForCurrentChange(e,t)),new Sa(Jo.min(),n,ya,la,pa())},Sa);function Sa(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var Ca=(Da.createSynthesizedTargetChangeForCurrentChange=function(e,t){return new Da(ri.EMPTY_BYTE_STRING,t,pa(),pa(),pa())},Da);function Da(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var ka=function(e,t,n,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=n,this.newDoc=r},Aa=function(e,t){this.targetId=e,this.existenceFilter=t},Na=function(e,t,n,r){void 0===n&&(n=ri.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},Ra=(Object.defineProperty(Oa.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(Oa.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!1,configurable:!0}),Object.defineProperty(Oa.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!1,configurable:!0}),Object.defineProperty(Oa.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!1,configurable:!0}),Oa.prototype.updateResumeToken=function(e){0<e.approximateByteSize()&&(this._hasPendingChanges=!0,this._resumeToken=e)},Oa.prototype.toTargetChange=function(){var n=pa(),r=pa(),i=pa();return this.documentChanges.forEach(function(e,t){switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:Kr("Encountered invalid change type: "+t)}}),new Ca(this._resumeToken,this._current,n,r,i)},Oa.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=xa()},Oa.prototype.addDocumentChange=function(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)},Oa.prototype.removeDocumentChange=function(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)},Oa.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},Oa.prototype.recordTargetResponse=function(){--this.pendingResponses},Oa.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},Oa);function Oa(){this.pendingResponses=0,this.documentChanges=xa(),this._resumeToken=ri.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}var La=(Pa.prototype.handleDocumentChange=function(e){for(var t=0,n=e.updatedTargetIds;t<n.length;t++){var r=n[t];e.newDoc instanceof zi?this.addDocumentToTarget(r,e.newDoc):e.newDoc instanceof Wi&&this.removeDocumentFromTarget(r,e.key,e.newDoc)}for(var i=0,o=e.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,e.key,e.newDoc)}},Pa.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(e){var t=r.ensureTargetState(e);switch(n.state){case 0:r.isActiveTarget(e)&&t.updateResumeToken(n.resumeToken);break;case 1:t.recordTargetResponse(),t.isPending||t.clearPendingChanges(),t.updateResumeToken(n.resumeToken);break;case 2:t.recordTargetResponse(),t.isPending||r.removeTarget(e),Gr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:r.isActiveTarget(e)&&(t.markCurrent(),t.updateResumeToken(n.resumeToken));break;case 4:r.isActiveTarget(e)&&(r.resetTarget(e),t.updateResumeToken(n.resumeToken));break;default:Kr("Unknown target watch change state: "+n.state)}})},Pa.prototype.forEachTarget=function(e,n){var r=this;0<e.targetIds.length?e.targetIds.forEach(n):this.targetStates.forEach(function(e,t){r.isActiveTarget(t)&&n(t)})},Pa.prototype.handleExistenceFilter=function(e){var t=e.targetId,n=e.existenceFilter.count,e=this.targetDataForActiveTarget(t);e&&(ro(e=e.target)?0===n?(e=new gi(e.path),this.removeDocumentFromTarget(t,e,new Wi(e,Jo.min()))):zr(1===n,"Single document existence filter with count: "+n):this.getCurrentDocumentCountForTarget(t)!==n&&(this.resetTarget(t),this.pendingTargetResets=this.pendingTargetResets.add(t)))},Pa.prototype.createRemoteEvent=function(r){var i=this,o=new Map;this.targetStates.forEach(function(e,t){var n=i.targetDataForActiveTarget(t);n&&(e.current&&ro(n.target)&&(n=new gi(n.target.path),null!==i.pendingDocumentUpdates.get(n)||i.targetContainsDocument(t,n)||i.removeDocumentFromTarget(t,n,new Wi(n,r))),e.hasPendingChanges&&(o.set(t,e.toTargetChange()),e.clearPendingChanges()))});var a=pa();this.pendingDocumentTargetMapping.forEach(function(e,t){var n=!0;t.forEachWhile(function(e){e=i.targetDataForActiveTarget(e);return!e||2===e.purpose||(n=!1)}),n&&(a=a.add(e))});var e=new Ia(r,o,this.pendingTargetResets,this.pendingDocumentUpdates,a);return this.pendingDocumentUpdates=la,this.pendingDocumentTargetMapping=Ma(),this.pendingTargetResets=new aa(Yr),e},Pa.prototype.addDocumentToTarget=function(e,t){var n;this.isActiveTarget(e)&&(n=this.targetContainsDocument(e,t.key)?2:0,this.ensureTargetState(e).addDocumentChange(t.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e)))},Pa.prototype.removeDocumentFromTarget=function(e,t,n){var r;this.isActiveTarget(e)&&(r=this.ensureTargetState(e),this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n)))},Pa.prototype.removeTarget=function(e){this.targetStates.delete(e)},Pa.prototype.getCurrentDocumentCountForTarget=function(e){var t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size},Pa.prototype.recordPendingTargetRequest=function(e){this.ensureTargetState(e).recordPendingTargetRequest()},Pa.prototype.ensureTargetState=function(e){var t=this.targetStates.get(e);return t||(t=new Ra,this.targetStates.set(e,t)),t},Pa.prototype.ensureDocumentTargetMapping=function(e){var t=this.pendingDocumentTargetMapping.get(e);return t||(t=new aa(Yr),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t},Pa.prototype.isActiveTarget=function(e){var t=null!==this.targetDataForActiveTarget(e);return t||qr("WatchChangeAggregator","Detected inactive target",e),t},Pa.prototype.targetDataForActiveTarget=function(e){var t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)},Pa.prototype.resetTarget=function(t){var n=this;Gr(!this.targetStates.get(t).isPending,"Should only reset active targets"),this.targetStates.set(t,new Ra),this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(e){n.removeDocumentFromTarget(t,e,null)})},Pa.prototype.targetContainsDocument=function(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)},Pa);function Pa(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=la,this.pendingDocumentTargetMapping=Ma(),this.pendingTargetResets=new aa(Yr)}function Ma(){return new Zo(gi.comparator)}function xa(){return new Zo(gi.comparator)}var Fa={asc:"ASCENDING",desc:"DESCENDING"},Va={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};function qa(e,t){Gr(!oi(e),t+" is missing")}var Ba=function(e,t){this.databaseId=e,this.useProto3Json=t};function Ua(e){return{integerValue:""+e}}function ja(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ai(t)?"-0":t}}function Ka(e,t){return"number"==typeof(n=t)&&Number.isInteger(n)&&!ai(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER?Ua(t):ja(e,t);var n}function za(e,t){return e.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ga(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Qa(e){return zr(!!e,"Trying to deserialize version that isn't set"),Jo.fromTimestamp((e=Oi(e=e),new $r(e.seconds,e.nanos)))}function Wa(e,t){return new li(["projects",(e=e).projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Ha(e){e=li.fromString(e);return zr(ps(e),"Tried to deserialize invalid key "+e.toString()),e}function Ya(e,t){return Wa(e.databaseId,t.path)}function Xa(e,t){t=Ha(t);if(t.get(1)!==e.databaseId.projectId)throw new Pr(Lr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+e.databaseId.projectId);if(t.get(3)!==e.databaseId.database)throw new Pr(Lr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+e.databaseId.database);return new gi(Za(t))}function Ja(e,t){return Wa(e.databaseId,t)}function $a(e){return new li(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Za(e){return zr(4<e.length&&"documents"===e.get(4),"tried to deserialize invalid key "+e.toString()),e.popFirst(5)}function es(e,t,n){return{name:Ya(e,t),fields:n.proto.mapValue.fields}}function ts(e,t){return"found"in t?function(e,t){zr(!!t.found,"Tried to deserialize a found document from a missing document."),qa(t.found.name,"doc.found.name"),qa(t.found.updateTime,"doc.found.updateTime");var n=Xa(e,t.found.name),e=Qa(t.found.updateTime),t=new ga({mapValue:{fields:t.found.fields}});return new zi(n,e,t,{})}(e,t):"missing"in t?(n=e,zr(!!(e=t).missing,"Tried to deserialize a missing document from a found document."),zr(!!e.readTime,"Tried to deserialize a missing document without a read time."),n=Xa(n,e.missing),e=Qa(e.readTime),new Wi(n,e)):Kr("invalid batch get response: "+JSON.stringify(t));var n}function ns(e,t){if("targetChange"in t){qa(t.targetChange,"targetChange");var n="NO_CHANGE"===(o=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Kr("Got unexpected TargetChange.state: "+o),r=t.targetChange.targetIds||[],i=(i=e,o=t.targetChange.resumeToken,i.useProto3Json?(zr(void 0===o||"string"==typeof o,"value must be undefined or a string when using proto3 Json"),ri.fromBase64String(o||"")):(zr(void 0===o||o instanceof Uint8Array,"value must be undefined or Uint8Array"),ri.fromUint8Array(o||new Uint8Array))),o=t.targetChange.cause,a=o&&(o=void 0===(a=o).code?Lr.UNKNOWN:_a(a.code),new Pr(o,a.message||"")),i=new Na(n,r,i,a||null)}else if("documentChange"in t){qa(t.documentChange,"documentChange");var s=t.documentChange;qa(s.document,"documentChange.name"),qa(s.document.name,"documentChange.document.name"),qa(s.document.updateTime,"documentChange.document.updateTime");var u=Xa(e,s.document.name),c=Qa(s.document.updateTime),a=new ga({mapValue:{fields:s.document.fields}}),c=new zi(u,c,a,{}),a=s.targetIds||[],s=s.removedTargetIds||[];i=new ka(a,s,c.key,c)}else if("documentDelete"in t){qa(t.documentDelete,"documentDelete");c=t.documentDelete;qa(c.document,"documentDelete.document");var u=Xa(e,c.document),l=c.readTime?Qa(c.readTime):Jo.min(),l=new Wi(u,l),s=c.removedTargetIds||[];i=new ka([],s,l.key,l)}else if("documentRemove"in t){qa(t.documentRemove,"documentRemove");l=t.documentRemove;qa(l.document,"documentRemove");u=Xa(e,l.document),s=l.removedTargetIds||[];i=new ka([],s,u,null)}else{if(!("filter"in t))return Kr("Unknown change type "+JSON.stringify(t));qa(t.filter,"filter");u=t.filter;qa(u.targetId,"filter.targetId");t=u.count||0,t=new Ta(t),u=u.targetId;i=new Aa(u,t)}return i}function rs(e,t){var n,r,i;if(t instanceof Hs)n={update:es(e,t.key,t.value)};else if(t instanceof au)n={delete:Ya(e,t.key)};else if(t instanceof Js)n={update:es(e,t.key,t.data),updateMask:(r=t.fieldMask,i=[],r.fields.forEach(function(e){return i.push(e.canonicalString())}),{fieldPaths:i})};else if(t instanceof tu)n={transform:{document:Ya(e,t.key),fieldTransforms:t.fieldTransforms.map(function(e){var t=e.transform;{if(t instanceof vs)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Ts)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Ss)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof As)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw Kr("Unknown transform: "+e.transform)}})}};else{if(!(t instanceof cu))return Kr("Unknown mutation type "+t.type);n={verify:Ya(e,t.key)}}return t.precondition.isNone||(n.currentDocument=(e=e,Gr(!(t=t.precondition).isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:function(e,t){return za(e,t.toTimestamp())}(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Kr("Unknown precondition"))),n}function is(e,r){return e&&0<e.length?(zr(void 0!==r,"Received a write result without a commit time"),e.map(function(e){return n=r,(e=(t=e).updateTime?Qa(t.updateTime):Qa(n)).isEqual(Jo.min())&&(e=Qa(n)),n=null,t.transformResults&&0<t.transformResults.length&&(n=t.transformResults),new Fs(e,n);var t,n})):[]}function os(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(Gr(r.length%2==0,"Collection Group queries should be within a document path or root."),n.parent=Ja(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Gr(r.length%2!=0,"Document queries with filters are not supported."),n.parent=Ja(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);r=function(e){if(0===e.length)return;e=e.map(function(e){return Gr(e instanceof Eo,"Only FieldFilters are supported"),function(e){if("=="===e.op){if(Ui(e.value))return{unaryFilter:{field:hs(e.field),op:"IS_NAN"}};if(Bi(e.value))return{unaryFilter:{field:hs(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ui(e.value))return{unaryFilter:{field:hs(e.field),op:"IS_NOT_NAN"}};if(Bi(e.value))return{unaryFilter:{field:hs(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hs(e.field),op:function(e){return Va[e]}(e.op),value:e.value}}}(e)});return 1!==e.length?{compositeFilter:{op:"AND",filters:e}}:e[0]}(t.filters);r&&(n.structuredQuery.where=r);r=0!==(r=t.orderBy).length?r.map(function(e){return{field:hs((e=e).field),direction:function(e){return Fa[e]}(e.dir)}}):void 0;r&&(n.structuredQuery.orderBy=r);r=e,e=t.limit,e=r.useProto3Json||oi(e)?e:{value:e};return null!==e&&(n.structuredQuery.limit=e),t.startAt&&(n.structuredQuery.startAt=cs(t.startAt)),t.endAt&&(n.structuredQuery.endAt=cs(t.endAt)),n}function as(e){var t=4===(o=Ha(o=e.parent)).length?li.emptyPath():Za(o),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(zr(1===r,"StructuredQuery.from with more than one collection is not supported."),(a=n.from[0]).allDescendants?i=a.collectionId:t=t.child(a.collectionId));var o=[];n.where&&(o=function t(e){return e?void 0!==e.unaryFilter?[ds(e)]:void 0!==e.fieldFilter?[(n=e,Eo.create(fs(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Kr("Unspecified operator");default:return Kr("Unknown operator")}}(n.fieldFilter.op),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return t(e)}).reduce(function(e,t){return e.concat(t)}):Kr("Unknown filter: "+JSON.stringify(e)):[];var n}(n.where));e=[];n.orderBy&&(e=n.orderBy.map(function(e){return new Xo(fs((e=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}));r=null;n.limit&&(r=oi(s="object"==typeof(s=n.limit)?s.value:s)?null:s);var a=null;n.startAt&&(a=ls(n.startAt));var s=null;return n.endAt&&(s=ls(n.endAt)),new io(t,i,e,o,r,"F",a,s)}function ss(e,t){t=function(e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Kr("Unrecognized query purpose: "+e)}}(t.purpose);return null==t?null:{"goog-listen-tags":t}}function us(e,t){var n=t.target,n=ro(n)?{documents:{documents:[Ja(e,n.path)]}}:{query:os(e,n)};return n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=Ga(e,t.resumeToken):0<t.snapshotVersion.compareTo(Jo.min())&&(n.readTime=za(e,t.snapshotVersion.toTimestamp())),n}function cs(e){return{before:e.before,values:e.position}}function ls(e){var t=!!e.before,e=e.values||[];return new Qo(e,t)}function hs(e){return{fieldPath:e.canonicalString()}}function fs(e){return pi.fromServerFormat(e.fieldPath)}function ds(e){switch(e.unaryFilter.op){case"IS_NAN":var t=fs(e.unaryFilter.field);return Eo.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=fs(e.unaryFilter.field);return Eo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":n=fs(e.unaryFilter.field);return Eo.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":e=fs(e.unaryFilter.field);return Eo.create(e,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Kr("Unspecified filter");default:return Kr("Unknown filter")}}function ps(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}_t=function(){this._=void 0};function ys(e,t,n){return e instanceof vs?(r=n,n=t,i={fields:((i={})[wi]={stringValue:vi},i[Ti]={timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}},i)},n&&(i.fields[bi]=n),{mapValue:i}):e instanceof Ts?_s(e,t):e instanceof Ss?Ds(e,t):(Gr(e instanceof As,"Expected NumericIncrementTransformOperation but was: "+e),e=Rs(t=gs(i=e,e=t))+Rs(i.operand),xi(t)&&xi(i.operand)?Ua(e):ja(i.serializer,e));var r,i}function gs(e,t){return e instanceof As?Fi(t)?t:{integerValue:0}:null}var ms,vs=(n(ws,ms=_t),ws);function ws(){return null!==ms&&ms.apply(this,arguments)||this}var bs,Ts=(n(Es,bs=_t),Es);function Es(e){var t=bs.call(this)||this;return t.elements=e,t}function _s(e,t){for(var n=Os(t),r=0,i=e.elements;r<i.length;r++){!function(t){n.some(function(e){return Ci(e,t)})||n.push(t)}(i[r])}return{arrayValue:{values:n}}}var Is,Ss=(n(Cs,Is=_t),Cs);function Cs(e){var t=Is.call(this)||this;return t.elements=e,t}function Ds(e,t){for(var n=Os(t),r=0,i=e.elements;r<i.length;r++){!function(t){n=n.filter(function(e){return!Ci(e,t)})}(i[r])}return{arrayValue:{values:n}}}var ks,As=(n(Ns,ks=_t),Ns);function Ns(e,t){var n=ks.call(this)||this;return n.serializer=e,Gr(Fi(n.operand=t),"NumericIncrementTransform transform requires a NumberValue"),n}function Rs(e){return Li(e.integerValue||e.doubleValue)}function Os(e){return Vi(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Ls=(Ps.prototype.covers=function(e){for(var t=0,n=this.fields;t<n.length;t++){if(n[t].isPrefixOf(e))return!0}return!1},Ps.prototype.isEqual=function(e){return Xr(this.fields,e.fields,function(e,t){return e.isEqual(t)})},Ps);function Ps(n){(this.fields=n).sort(pi.comparator),Gr(!n.some(function(e,t){return 0!==t&&e.isEqual(n[t-1])}),"FieldMask contains field that is not unique: "+n.find(function(e,t){return 0!==t&&e.isEqual(n[t-1])}))}var Ms=function(e,t){this.field=e,this.transform=t};function xs(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof Ts&&t instanceof Ts||e instanceof Ss&&t instanceof Ss?Xr(e.elements,t.elements,Ci):e instanceof As&&t instanceof As?Ci(e.operand,t.operand):e instanceof vs&&t instanceof vs)}var Fs=function(e,t){this.version=e,this.transformResults=t},Vs=(qs.none=function(){return new qs},qs.exists=function(e){return new qs(void 0,e)},qs.updateTime=function(e){return new qs(e)},Object.defineProperty(qs.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),qs.prototype.isEqual=function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)},qs);function qs(e,t){this.updateTime=e,this.exists=t,Gr(void 0===e||void 0===t,'Precondition can specify "exists" or "updateTime" but not both')}function Bs(e,t){return void 0!==e.updateTime?t instanceof zi&&t.version.isEqual(e.updateTime):void 0!==e.exists?e.exists===t instanceof zi:(Gr(e.isNone,"Precondition should be empty"),1)}h=function(){};function Us(e,t,n){return Gs(e,t),e instanceof Hs?(r=e,Gr(null==(i=n).transformResults,"Transform results received by SetMutation."),new zi(r.key,i.version,r.value,{hasCommittedMutations:!0})):e instanceof Js?function(e,t,n){if(Gr(null==n.transformResults,"Transform results received by PatchMutation."),!Bs(e.precondition,t))return new Xi(e.key,n.version);t=Zs(e,t);return new zi(e.key,n.version,t,{hasCommittedMutations:!0})}(e,t,n):e instanceof tu?function(e,t,n){if(zr(null!=n.transformResults,"Transform results missing for TransformMutation."),!Bs(e.precondition,t))return new Xi(e.key,n.version);var r=ru(e,t),t=function(e,t,n){var r=[];zr(e.length===n.length,"server transform result count ("+n.length+") should match field transform count ("+e.length+")");for(var i=0;i<n.length;i++){var o=e[i],a=o.transform,s=null;t instanceof zi&&(s=t.field(o.field)),r.push(function(e,t,n){return e instanceof Ts?_s(e,t):e instanceof Ss?Ds(e,t):(Gr(null!==n,"Didn't receive transformResult for non-array transform"),n)}(a,s,n[i]))}return r}(e.fieldTransforms,t,n.transformResults),n=n.version,t=iu(e,r.data(),t);return new zi(e.key,n,t,{hasCommittedMutations:!0})}(e,t,n):(Gr(e instanceof au,"Unexpected mutation type: "+e),e=e,Gr(null==(n=n).transformResults,"Transform results received by DeleteMutation."),new Wi(e.key,n.version,{hasCommittedMutations:!0}));var r,i}function js(e,t,n,r){return Gs(e,t),e instanceof Hs?function(e,t){if(!Bs(e.precondition,t))return t;t=Qs(t);return new zi(e.key,t,e.value,{hasLocalMutations:!0})}(e,t):e instanceof Js?function(e,t){if(!Bs(e.precondition,t))return t;var n=Qs(t),t=Zs(e,t);return new zi(e.key,n,t,{hasLocalMutations:!0})}(e,t):e instanceof tu?function(e,t,n,r){if(!Bs(e.precondition,t))return t;var i=ru(e,t),r=function(e,t,n,r){for(var i=[],o=0,a=e;o<a.length;o++){var s=a[o],u=s.transform,c=null;n instanceof zi&&(c=n.field(s.field)),null===c&&r instanceof zi&&(c=r.field(s.field)),i.push(ys(u,c,t))}return i}(e.fieldTransforms,n,t,r),r=iu(e,i.data(),r);return new zi(e.key,i.version,r,{hasLocalMutations:!0})}(e,t,r,n):(Gr(e instanceof au,"Unexpected mutation type: "+e),function(e,t){if(!Bs(e.precondition,t))return t;t&&Gr(t.key.isEqual(e.key),"Can only apply mutation to document with same key");return new Wi(e.key,Jo.min())}(e,t))}function Ks(e,t){return e instanceof tu?function(e,t){for(var n=null,r=0,i=e.fieldTransforms;r<i.length;r++){var o=i[r],a=t instanceof zi?t.field(o.field):void 0,a=gs(o.transform,a||null);null!=a&&(n=(null==n?new va:n).set(o.field,a))}return n?n.build():null}(e,t):null}function zs(e,t){return e.type===t.type&&(!!e.key.isEqual(t.key)&&(!!e.precondition.isEqual(t.precondition)&&(0===e.type?e.value.isEqual(t.value):1===e.type?e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask):2!==e.type||Xr(e.fieldTransforms,e.fieldTransforms,xs))))}function Gs(e,t){null!=t&&Gr(t.key.isEqual(e.key),"Can only apply a mutation to a document with the same key")}function Qs(e){return e instanceof zi?e.version:Jo.min()}var Ws,Hs=(n(Ys,Ws=h),Ys);function Ys(e,t,n){var r=Ws.call(this)||this;return r.key=e,r.value=t,r.precondition=n,r.type=0,r}var Xs,Js=(n($s,Xs=h),$s);function $s(e,t,n,r){var i=Xs.call(this)||this;return i.key=e,i.data=t,i.fieldMask=n,i.precondition=r,i.type=1,i}function Zs(e,t){var n,r,t=t instanceof zi?t.data():ga.empty();return n=e,r=new va(t),n.fieldMask.fields.forEach(function(e){var t;e.isEmpty()||(null!==(t=n.data.field(e))?r.set(e,t):r.delete(e))}),r.build()}var eu,tu=(n(nu,eu=h),nu);function nu(e,t){var n=eu.call(this)||this;return n.key=e,n.fieldTransforms=t,n.type=2,n.precondition=Vs.exists(!0),n}function ru(e,t){return Gr(t instanceof zi,"Unknown MaybeDocument type "+t),Gr(t.key.isEqual(e.key),"Can only transform a document with the same key"),t}function iu(e,t,n){Gr(n.length===e.fieldTransforms.length,"TransformResults length mismatch.");for(var r=new va(t),i=0;i<e.fieldTransforms.length;i++){var o=e.fieldTransforms[i];r.set(o.field,n[i])}return r.build()}var ou,au=(n(su,ou=h),su);function su(e,t){var n=ou.call(this)||this;return n.key=e,n.precondition=t,n.type=3,n}var uu,cu=(n(lu,uu=h),lu);function lu(e,t){var n=uu.call(this)||this;return n.key=e,n.precondition=t,n.type=4,n}var hu=-1,fu=(du.prototype.applyToRemoteDocument=function(e,t,n){t&&Gr(t.key.isEqual(e),"applyToRemoteDocument: key "+e+" should match maybeDoc key\n        "+t.key);var r=n.mutationResults;Gr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(e)&&(t=Us(o,t,r[i]))}return t},du.prototype.applyToLocalView=function(e,t){t&&Gr(t.key.isEqual(e),"applyToLocalDocument: key "+e+" should match maybeDoc key\n        "+t.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(i=r[n]).key.isEqual(e)&&(t=js(i,t,t,this.localWriteTime))}for(var i,o=t,a=0,s=this.mutations;a<s.length;a++){(i=s[a]).key.isEqual(e)&&(t=js(i,t,o,this.localWriteTime))}return t},du.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(e){var t=r.applyToLocalView(e.key,n.get(e.key));t&&(i=i.insert(e.key,t))}),i},du.prototype.keys=function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},pa())},du.prototype.isEqual=function(e){return this.batchId===e.batchId&&Xr(this.mutations,e.mutations,zs)&&Xr(this.baseMutations,e.baseMutations,zs)},du);function du(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,Gr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var pu=(yu.from=function(e,t,n){zr(e.mutations.length===n.length,"Mutations sent "+e.mutations.length+" must equal results received "+n.length);for(var r=fa,i=e.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new yu(e,t,n,r)},yu);function yu(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}var gu=(mu.prototype.get=function(e){var t=this.mapKeyFn(e),t=this.inner[t];if(void 0!==t)for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.equalsFn(o,e))return i}},mu.prototype.has=function(e){return void 0!==this.get(e)},mu.prototype.set=function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]},mu.prototype.delete=function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1},mu.prototype.forEach=function(a){ti(this.inner,function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i[0],i=i[1];a(o,i)}})},mu.prototype.isEmpty=function(){return ni(this.inner)},mu);function mu(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}var vu=(wu.prototype.catch=function(e){return this.next(void 0,e)},wu.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Kr("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new wu(function(t,n){o.nextCallback=function(e){o.wrapSuccess(r,e).next(t,n)},o.catchCallback=function(e){o.wrapFailure(i,e).next(t,n)}})},wu.prototype.toPromise=function(){var n=this;return new Promise(function(e,t){n.next(e,t)})},wu.prototype.wrapUserFunction=function(e){try{var t=e();return t instanceof wu?t:wu.resolve(t)}catch(e){return wu.reject(e)}},wu.prototype.wrapSuccess=function(e,t){return e?this.wrapUserFunction(function(){return e(t)}):wu.resolve(t)},wu.prototype.wrapFailure=function(e,t){return e?this.wrapUserFunction(function(){return e(t)}):wu.reject(t)},wu.resolve=function(n){return new wu(function(e,t){e(n)})},wu.reject=function(n){return new wu(function(e,t){t(n)})},wu.waitFor=function(e){return new wu(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(e){return n(e)})}),o=!0,i===r&&t()})},wu.or=function(e){for(var n=wu.resolve(!1),t=0,r=e;t<r.length;t++){!function(t){n=n.next(function(e){return e?wu.resolve(e):t()})}(r[t])}return n},wu.forEach=function(e,n){var r=this,i=[];return e.forEach(function(e,t){i.push(n.call(r,e,t))}),this.waitFor(i)},wu);function wu(e){var t=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(e){t.isDone=!0,t.result=e,t.nextCallback&&t.nextCallback(e)},function(e){t.isDone=!0,t.error=e,t.catchCallback&&t.catchCallback(e)})}var bu=(Tu.prototype.getDocument=function(t,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,n).next(function(e){return r.getDocumentInternal(t,n,e)})},Tu.prototype.getDocumentInternal=function(e,r,i){return this.remoteDocumentCache.getEntry(e,r).next(function(e){for(var t=0,n=i;t<n.length;t++){e=n[t].applyToLocalView(r,e)}return e})},Tu.prototype.applyLocalMutationsToDocuments=function(e,t,i){var o=la;return t.forEach(function(e,t){for(var n=0,r=i;n<r.length;n++){t=r[n].applyToLocalView(e,t)}o=o.insert(e,t)}),o},Tu.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},Tu.prototype.getLocalViewOfDocuments=function(t,r){var i=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,r).next(function(e){var e=i.applyLocalMutationsToDocuments(t,r,e),n=la;return e.forEach(function(e,t){t=t||new Wi(e,Jo.min()),n=n.insert(e,t)}),n})},Tu.prototype.getDocumentsMatchingQuery=function(e,t,n){return lo(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ho(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)},Tu.prototype.getDocumentsMatchingDocumentQuery=function(e,t){return this.getDocument(e,new gi(t)).next(function(e){var t=ha;return e instanceof zi&&(t=t.insert(e.key,e)),t})},Tu.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;Gr(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=ha;return this.indexManager.getCollectionParents(n,a).next(function(e){return vu.forEach(e,function(e){var t,t=(t=r,e=e.child(a),new io(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return o.getDocumentsMatchingCollectionQuery(n,t,i).next(function(e){e.forEach(function(e,t){s=s.insert(e,t)})})}).next(function(){return s})})},Tu.prototype.getDocumentsMatchingCollectionQuery=function(t,n,e){var c,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,e).next(function(e){return c=e,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,n)}).next(function(e){return l=e,r.addMissingBaseDocuments(t,l,c).next(function(e){c=e;for(var t=0,n=l;t<n.length;t++)for(var r=n[t],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=c.get(s),u=js(a,u,u,r.localWriteTime);c=u instanceof zi?c.insert(s,u):c.remove(s)}})}).next(function(){return c.forEach(function(e,t){wo(n,t)||(c=c.remove(e))}),c})},Tu.prototype.addMissingBaseDocuments=function(e,t,n){for(var r=pa(),i=0,o=t;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Js&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(e,r).next(function(e){return e.forEach(function(e,t){null!==t&&t instanceof zi&&(c=c.insert(e,t))}),c})},Tu);function Tu(e,t,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.indexManager=n}var Eu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Et=(_u.prototype.addOnCommittedListener=function(e){this.onCommittedListeners.push(e)},_u.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(e){return e()})},_u);function _u(){this.onCommittedListeners=[]}var Iu=(Su.prototype.withSequenceNumber=function(e){return new Su(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Su.prototype.withResumeToken=function(e,t){return new Su(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)},Su.prototype.withLastLimboFreeSnapshotVersion=function(e){return new Su(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},Su);function Su(e,t,n,r,i,o,a){void 0===i&&(i=Jo.min()),void 0===o&&(o=Jo.min()),void 0===a&&(a=ri.EMPTY_BYTE_STRING),this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var Cu=(Du.prototype.setPreviousValue=function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue},Du.prototype.next=function(){var e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e},Du);function Du(e,t){var n=this;this.previousValue=e,t&&(t.sequenceNumberHandler=function(e){return n.setPreviousValue(e)},this.writeNewSequenceNumber=function(e){return t.writeSequenceNumber(e)})}Cu.INVALID=-1;var ku=function(e){this.remoteSerializer=e};function Au(e){return{name:e.name,query:(t=e.bundledQuery,n=as({parent:t.parent,structuredQuery:t.structuredQuery}),"LAST"===t.limitType?(Gr(!!n.limit,"Bundled query has limitType LAST, but limit is null"),yo(n,n.limit,"L")):n),readTime:Qa(e.readTime)};var t,n}Nu.prototype.getReadTime=function(e){var t=this.changes.get(e);return t?(Gr(!!t.readTime,"Read time is not set for "+e+". All removeEntry() calls must include a readTime if 'trackRemovals' is used."),t.readTime):Jo.min()},Nu.prototype.addEntry=function(e,t){this.assertNotApplied(),this.changes.set(e.key,{maybeDocument:e,readTime:t})},Nu.prototype.removeEntry=function(e,t){void 0===t&&(t=null),this.assertNotApplied(),this.changes.set(e,{maybeDocument:null,readTime:t})},Nu.prototype.getEntry=function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?vu.resolve(n.maybeDocument):this.getFromCache(e,t)},Nu.prototype.getEntries=function(e,t){return this.getAllFromCache(e,t)},Nu.prototype.apply=function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)},Nu.prototype.assertNotApplied=function(){Gr(!this.changesApplied,"Changes have already been applied.")},_t=Nu;function Nu(){this.changes=new gu(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}var Ru=(Ou.prototype.addToCollectionParentIndex=function(e,t){return this.collectionParentIndex.add(t),vu.resolve()},Ou.prototype.getCollectionParents=function(e,t){return vu.resolve(this.collectionParentIndex.getEntries(t))},Ou);function Ou(){this.collectionParentIndex=new Lu}var Lu=(Pu.prototype.add=function(e){Gr(e.length%2==1,"Expected a collection path.");var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new aa(li.comparator),e=!r.has(n);return this.index[t]=r.add(n),e},Pu.prototype.has=function(e){var t=e.lastSegment(),e=e.popLast(),t=this.index[t];return t&&t.has(e)},Pu.prototype.getEntries=function(e){return(this.index[e]||new aa(li.comparator)).toArray()},Pu);function Pu(){this.index={}}var Mu=function(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})};function xu(e){return"IndexedDbTransactionError"===e.name}var Fu=(Vu.prototype.next=function(){return this.lastId+=2,this.lastId},Vu.forTargetCache=function(){return new Vu(0)},Vu.forSyncEngine=function(){return new Vu(-1)},Vu);function Vu(e){this.lastId=e}var qu="LocalStore",Bu=3e8,Uu=(ju.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(e){return t.collect(e,n.targetDataByTarget)})},ju);function ju(e,t,n,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new Zo(Yr),this.targetIdByTarget=new gu(eo,no),this.lastDocumentChangeReadTime=Jo.min(),Gr(e.started,"LocalStore was passed an unstarted persistence implementation"),this.mutationQueue=e.getMutationQueue(n),this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.localDocuments=new bu(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.bundleCache=e.getBundleCache(),this.queryEngine.setLocalDocumentsView(this.localDocuments)}function Ku(i,o){return f(this,void 0,void 0,function(){var t,n,g,r;return d(this,function(e){switch(e.label){case 0:return t=Qr(i,Uu),n=t.mutationQueue,g=t.localDocuments,[4,t.persistence.runTransaction("Handle user change","readonly",function(p){var y;return t.mutationQueue.getAllMutationBatches(p).next(function(e){return y=e,n=t.persistence.getMutationQueue(o),g=new bu(t.remoteDocuments,n,t.persistence.getIndexManager()),n.getAllMutationBatches(p)}).next(function(e){for(var t=[],n=[],r=pa(),i=0,o=y;i<o.length;i++){var a=o[i];t.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++)var c=u[s],r=r.add(c.key)}for(var l=0,h=e;l<h.length;l++){a=h[l];n.push(a.batchId);for(var f=0,d=a.mutations;f<d.length;f++){c=d[f];r=r.add(c.key)}}return g.getDocuments(p,r).next(function(e){return{affectedDocuments:e,removedBatchIds:t,addedBatchIds:n}})})})];case 1:return r=e.sent(),t.mutationQueue=n,t.localDocuments=g,t.queryEngine.setLocalDocumentsView(t.localDocuments),[2,r]}})})}function zu(e,s){var u,c=Qr(e,Uu),l=$r.now(),t=s.reduce(function(e,t){return e.add(t.key)},pa());return c.persistence.runTransaction("Locally write mutations","readwrite",function(a){return c.localDocuments.getDocuments(a,t).next(function(e){u=e;for(var t=[],n=0,r=s;n<r.length;n++){var i=r[n],o=Ks(i,u.get(i.key));null!=o&&t.push(new Js(i.key,o,function a(e){var s=[];return ti(e.fields||{},function(e,t){var n=new pi([e]);if(ji(t))if(0===(t=a(t.mapValue).fields).length)s.push(n);else for(var r=0,i=t;r<i.length;r++){var o=i[r];s.push(n.child(o))}else s.push(n)}),new Ls(s)}(o.proto.mapValue),Vs.exists(!0)))}return c.mutationQueue.addMutationBatch(a,l,t,s)})}).then(function(e){var t=e.applyToLocalDocumentSet(u);return{batchId:e.batchId,changes:t}})}function Gu(e,l){var h=Qr(e,Uu);return h.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(e){var t,n,i,o,a,r,s,u=l.batch.keys(),c=h.remoteDocuments.newChangeBuffer({trackRemovals:!0});return t=h,n=e,o=c,a=(i=l).batch,r=a.keys(),s=vu.resolve(),r.forEach(function(r){s=s.next(function(){return o.getEntry(n,r)}).next(function(e){var t=e,n=i.docVersions.get(r);zr(null!==n,"ackVersions should contain every doc in the write."),(!t||t.version.compareTo(n)<0)&&((t=a.applyToRemoteDocument(r,t,i))?o.addEntry(t,i.commitVersion):Gr(!e,"Mutation batch "+a+" applied to document "+e+" resulted in null"))})}),s.next(function(){return t.mutationQueue.removeMutationBatch(n,a)}).next(function(){return c.apply(e)}).next(function(){return h.mutationQueue.performConsistencyCheck(e)}).next(function(){return h.localDocuments.getDocuments(e,u)})})}function Qu(e){var t=Qr(e,Uu);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)})}function Wu(e,l){var h=Qr(e,Uu),f=l.snapshotVersion,d=h.targetDataByTarget;return h.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var e=h.remoteDocuments.newChangeBuffer({trackRemovals:!0});d=h.targetDataByTarget;var o=[];l.targetChanges.forEach(function(e,t){var n,r=d.get(t);r&&(o.push(h.targetCache.removeMatchingKeys(i,e.removedDocuments,t).next(function(){return h.targetCache.addMatchingKeys(i,e.addedDocuments,t)})),0<(n=e.resumeToken).approximateByteSize()&&(n=r.withResumeToken(n,f).withSequenceNumber(i.currentSequenceNumber),d=d.insert(t,n),function(e,t,n){if(zr(0<t.resumeToken.approximateByteSize(),"Attempted to persist target data with no resume token"),0===e.resumeToken.approximateByteSize())return!0;if(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=Bu)return!0;return 0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size}(r,n,e)&&o.push(h.targetCache.updateTargetData(i,n))))});var a,t,s,u,n,r,c=la;return l.documentUpdates.forEach(function(e,t){l.resolvedLimboDocuments.has(e)&&o.push(h.persistence.referenceDelegate.updateLimboDocument(i,e))}),o.push((r=i,a=e,t=l.documentUpdates,s=f,u=void 0,n=pa(),t.forEach(function(e){return n=n.add(e)}),a.getEntries(r,n).next(function(i){var o=la;return t.forEach(function(e,t){var n=i.get(e),r=(null==u?void 0:u.get(e))||s;t instanceof Wi&&t.version.isEqual(Jo.min())?(a.removeEntry(e,r),o=o.insert(e,t)):null==n||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(Gr(!Jo.min().isEqual(r),"Cannot add a document when the remote version is zero"),a.addEntry(t,r),o=o.insert(e,t)):qr(qu,"Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),o}).next(function(e){c=e}))),f.isEqual(Jo.min())||(r=h.targetCache.getLastRemoteSnapshotVersion(i).next(function(e){return Gr(0<=f.compareTo(e),"Watch stream reverted to previous snapshot?? "+f+" < "+e),h.targetCache.setTargetsMetadata(i,i.currentSequenceNumber,f)}),o.push(r)),vu.waitFor(o).next(function(){return e.apply(i)}).next(function(){return h.localDocuments.getLocalViewOfDocuments(i,c)})}).then(function(e){return h.targetDataByTarget=d,e})}function Hu(i,o,a){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:t=Qr(i,Uu),Gr(null!==(n=t.targetDataByTarget.get(o)),"Tried to release nonexistent target: "+o),r=a?"readwrite":"readwrite-primary",e.label=1;case 1:return e.trys.push([1,4,,5]),a?[3,3]:[4,t.persistence.runTransaction("Release target",r,function(e){return t.persistence.referenceDelegate.removeTarget(e,n)})];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if(!xu(r=e.sent()))throw r;return qr(qu,"Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return t.targetDataByTarget=t.targetDataByTarget.remove(o),t.targetIdByTarget.delete(n.target),[2]}})})}function Yu(e,o,a){var s=Qr(e,Uu),u=Jo.min(),c=pa();return s.persistence.runTransaction("Execute query","readonly",function(t){return e=s,n=t,r=po(o),i=Qr(e,Uu),(void 0!==(e=i.targetIdByTarget.get(r))?vu.resolve(i.targetDataByTarget.get(e)):i.targetCache.getTargetData(n,r)).next(function(e){if(e)return u=e.lastLimboFreeSnapshotVersion,s.targetCache.getMatchingKeysForTargetId(t,e.targetId).next(function(e){c=e})}).next(function(){return s.queryEngine.getDocumentsMatchingQuery(t,o,a?u:Jo.min(),a?c:pa())}).next(function(e){return{documents:e,remoteKeys:c}});var e,n,r,i})}function Xu(t){return f(this,void 0,void 0,function(){return d(this,function(e){if(t.code!==Lr.FAILED_PRECONDITION||t.message!==Eu)throw t;return qr(qu,"Unexpectedly lost primary lease"),[2]})})}var Ju=($u.prototype.reset=function(){this.currentBaseMs=0},$u.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},$u.prototype.backoffAndRun=function(e){var t=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<i&&qr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return t.lastAttemptTime=Date.now(),e()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},$u.prototype.skipBackoff=function(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)},$u.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},$u.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},$u);function $u(e,t,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=e,this.timerId=t,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var Zu="PersistentStream",h=(ec.prototype.isStarted=function(){return 1===this.state||2===this.state||4===this.state},ec.prototype.isOpen=function(){return 2===this.state},ec.prototype.start=function(){3!==this.state?(Gr(0===this.state,"Already started"),this.auth()):this.performBackoff()},ec.prototype.stop=function(){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.isStarted()?[4,this.close(0)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},ec.prototype.inhibitBackoff=function(){Gr(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=0,this.backoff.reset()},ec.prototype.markIdle=function(){var e=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return e.handleIdleCloseTimer()}))},ec.prototype.sendRequest=function(e){this.cancelIdleCheck(),this.stream.send(e)},ec.prototype.handleIdleCloseTimer=function(){return f(this,void 0,void 0,function(){return d(this,function(e){return this.isOpen()?[2,this.close(0)]:[2]})})},ec.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},ec.prototype.close=function(t,n){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return Gr(this.isStarted(),"Only started streams should be closed."),Gr(3===t||oi(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,3!==t?this.backoff.reset():n&&n.code===Lr.RESOURCE_EXHAUSTED?(Br(n.toString()),Br("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Lr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(n)];case 1:return e.sent(),[2]}})})},ec.prototype.tearDown=function(){},ec.prototype.auth=function(){var n=this;Gr(0===this.state,"Must be in initial state to auth"),this.state=1;var e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;this.credentialsProvider.getToken().then(function(e){n.closeCount===t&&n.startStream(e)},function(t){e(function(){var e=new Pr(Lr.UNKNOWN,"Fetching auth token failed: "+t.message);return n.handleStreamClose(e)})})},ec.prototype.startStream=function(e){var t=this;Gr(1===this.state,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e),this.stream.onOpen(function(){n(function(){return Gr(1===t.state,"Expected stream to be in state Starting, but was "+t.state),t.state=2,t.listener.onOpen()})}),this.stream.onClose(function(e){n(function(){return t.handleStreamClose(e)})}),this.stream.onMessage(function(e){n(function(){return t.onMessage(e)})})},ec.prototype.performBackoff=function(){var e=this;Gr(3===this.state,"Should only perform backoff when in Error state"),this.state=4,this.backoff.backoffAndRun(function(){return f(e,void 0,void 0,function(){return d(this,function(e){return Gr(4===this.state,"Backoff elapsed but state is now: "+this.state),this.state=0,this.start(),Gr(this.isStarted(),"PersistentStream should have started"),[2]})})})},ec.prototype.handleStreamClose=function(e){return Gr(this.isStarted(),"Can't handle server close on non-started stream"),qr(Zu,"close with error: "+e),this.stream=null,this.close(3,e)},ec.prototype.getCloseGuardedDispatcher=function(t){var n=this;return function(e){n.queue.enqueueAndForget(function(){return n.closeCount===t?e():(qr(Zu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},ec);function ec(e,t,n,r,i,o){this.queue=e,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Ju(e,t)}var tc,nc=(n(rc,tc=h),rc.prototype.startRpc=function(e){return this.connection.openStream("Listen",e)},rc.prototype.onMessage=function(e){this.backoff.reset();var t=ns(this.serializer,e),e="targetChange"in(e=e)&&(!(e=e.targetChange).targetIds||!e.targetIds.length)&&e.readTime?Qa(e.readTime):Jo.min();return this.listener.onWatchChange(t,e)},rc.prototype.watch=function(e){var t={};t.database=$a(this.serializer),t.addTarget=us(this.serializer,e);e=ss(this.serializer,e);e&&(t.labels=e),this.sendRequest(t)},rc.prototype.unwatch=function(e){var t={};t.database=$a(this.serializer),t.removeTarget=e,this.sendRequest(t)},rc);function rc(e,t,n,r,i){i=tc.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",t,n,i)||this;return i.serializer=r,i}var ic,oc=(n(ac,ic=h),Object.defineProperty(ac.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!1,configurable:!0}),ac.prototype.start=function(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,ic.prototype.start.call(this)},ac.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},ac.prototype.startRpc=function(e){return this.connection.openStream("Write",e)},ac.prototype.onMessage=function(e){if(zr(!!e.streamToken,"Got a write response without a stream token"),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();var t=is(e.writeResults,e.commitTime),n=Qa(e.commitTime);return this.listener.onMutationResult(n,t)}return zr(!e.writeResults||0===e.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},ac.prototype.writeHandshake=function(){Gr(this.isOpen(),"Writing handshake requires an opened stream"),Gr(!this.handshakeComplete_,"Handshake already completed"),Gr(!this.lastStreamToken,"Stream token should be empty during handshake");var e={};e.database=$a(this.serializer),this.sendRequest(e)},ac.prototype.writeMutations=function(e){var t=this;Gr(this.isOpen(),"Writing mutations requires an opened stream"),Gr(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Gr(!!this.lastStreamToken,"Trying to write mutation without a token");e={streamToken:this.lastStreamToken,writes:e.map(function(e){return rs(t.serializer,e)})};this.sendRequest(e)},ac);function ac(e,t,n,r,i){i=ic.call(this,e,"write_stream_connection_backoff","write_stream_idle",t,n,i)||this;return i.serializer=r,i.handshakeComplete_=!1,i}var sc,uc=(n(cc,sc=function(){}),cc.prototype.verifyInitialized=function(){if(Gr(!!this.connection,"Datastore.start() not called"),this.terminated)throw new Pr(Lr.FAILED_PRECONDITION,"The client has already been terminated.")},cc.prototype.invokeRPC=function(t,n,r){var i=this;return this.verifyInitialized(),this.credentials.getToken().then(function(e){return i.connection.invokeRPC(t,n,r,e)}).catch(function(e){throw e.code===Lr.UNAUTHENTICATED&&i.credentials.invalidateToken(),e})},cc.prototype.invokeStreamingRPC=function(t,n,r){var i=this;return this.verifyInitialized(),this.credentials.getToken().then(function(e){return i.connection.invokeStreamingRPC(t,n,r,e)}).catch(function(e){throw e.code===Lr.UNAUTHENTICATED&&i.credentials.invalidateToken(),e})},cc.prototype.terminate=function(){this.terminated=!1},cc);function cc(e,t,n){var r=sc.call(this)||this;return r.credentials=e,r.connection=t,r.serializer=n,r.terminated=!1,r}var lc=(hc.prototype.handleWatchStreamStart=function(){var e=this;0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),Gr(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return e.onlineStateTimer=null,Gr("Unknown"===e.state,"Timer should be canceled if we transitioned to a different state."),e.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),e.setAndBroadcast("Offline"),Promise.resolve()}))},hc.prototype.handleWatchStreamFailure=function(e){"Online"===this.state?(this.setAndBroadcast("Unknown"),Gr(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Gr(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+e.toString()),this.setAndBroadcast("Offline")))},hc.prototype.set=function(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)},hc.prototype.setAndBroadcast=function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))},hc.prototype.logClientOfflineWarningIfNecessary=function(e){e="Could not reach Cloud Firestore backend. "+e+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Br(e),this.shouldWarnClientIsOffline=!1):qr("OnlineStateTracker",e)},hc.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},hc);function hc(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}var fc="RemoteStore",dc=10,pc=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(e){n.enqueueAndForget(function(){return f(o,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return _c(this)?(qr(fc,"Restarting streams for network reachability change."),[4,function(n){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return(t=Qr(n,pc)).offlineCauses.add(4),[4,gc(t)];case 1:return e.sent(),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),[4,yc(t)];case 2:return e.sent(),[2]}})})}(this)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new lc(n,r)};function yc(r){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:if(!_c(r))return[3,4];t=0,n=r.onNetworkStatusChange,e.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function gc(r){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:t=0,n=r.onNetworkStatusChange,e.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function mc(e,t){e=Qr(e,pc);e.listenTargets.has(t.targetId)||(e.listenTargets.set(t.targetId,t),Ec(e)?Tc(e):Lc(e).isOpen()&&wc(e,t))}function vc(e,t){var n=Qr(e,pc),e=Lc(n);Gr(n.listenTargets.has(t),"unlisten called on target no currently watched: "+t),n.listenTargets.delete(t),e.isOpen()&&bc(n,t),0===n.listenTargets.size&&(e.isOpen()?e.markIdle():_c(n)&&n.onlineStateTracker.set("Unknown"))}function wc(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),Lc(e).watch(t)}function bc(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),Lc(e).unwatch(t)}function Tc(t){Gr(Ec(t),"startWatchStream() called when shouldStartWatchStream() is false."),Gr(!!t.remoteSyncer.getRemoteKeysForTarget,"getRemoteKeysForTarget() not set"),t.watchChangeAggregator=new La({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},getTargetDataForTarget:function(e){return t.listenTargets.get(e)||null}}),Lc(t).start(),t.onlineStateTracker.handleWatchStreamStart()}function Ec(e){return _c(e)&&!Lc(e).isStarted()&&0<e.listenTargets.size}function _c(e){return 0===Qr(e,pc).offlineCauses.size}function Ic(e){e.watchChangeAggregator=void 0}function Sc(r,i,o){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:if(r.onlineStateTracker.set("Online"),!(i instanceof Na&&2===i.state&&i.cause))return[3,6];e.label=1;case 1:return e.trys.push([1,3,,5]),[4,function(o,a){return f(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){switch(e.label){case 0:Gr(!!o.remoteSyncer.rejectListen,"rejectListen() not set"),Gr(!!a.cause,"Handling target error without a cause"),t=a.cause,n=0,r=a.targetIds,e.label=1;case 1:return n<r.length?(i=r[n],o.listenTargets.has(i)?[4,o.remoteSyncer.rejectListen(i,t)]:[3,3]):[3,4];case 2:e.sent(),o.listenTargets.delete(i),o.watchChangeAggregator.removeTarget(i),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}(r,i)];case 2:return e.sent(),[3,5];case 3:return t=e.sent(),qr(fc,"Failed to remove targets %s: %s ",i.targetIds.join(","),t),[4,Cc(r,t)];case 4:return e.sent(),[3,5];case 5:return[2];case 6:if(i instanceof ka?r.watchChangeAggregator.handleDocumentChange(i):i instanceof Aa?r.watchChangeAggregator.handleExistenceFilter(i):(Gr(i instanceof Na,"Expected watchChange to be an instance of WatchTargetChange"),r.watchChangeAggregator.handleTargetChange(i)),o.isEqual(Jo.min()))return[3,13];e.label=7;case 7:return e.trys.push([7,11,,13]),[4,Qu(r.localStore)];case 8:return n=e.sent(),0<=o.compareTo(n)?[4,function(r,i){Gr(!i.isEqual(Jo.min()),"Can't raise event for unknown SnapshotVersion");var e=r.watchChangeAggregator.createRemoteEvent(i);return e.targetChanges.forEach(function(e,t){var n;0<e.resumeToken.approximateByteSize()&&((n=r.listenTargets.get(t))&&r.listenTargets.set(t,n.withResumeToken(e.resumeToken,i)))}),e.targetMismatches.forEach(function(e){var t=r.listenTargets.get(e);t&&(r.listenTargets.set(e,t.withResumeToken(ri.EMPTY_BYTE_STRING,t.snapshotVersion)),bc(r,e),t=new Iu(t.target,e,1,t.sequenceNumber),wc(r,t))}),Gr(!!r.remoteSyncer.applyRemoteEvent,"applyRemoteEvent() not set"),r.remoteSyncer.applyRemoteEvent(e)}(r,o)]:[3,10];case 9:e.sent(),e.label=10;case 10:return[3,13];case 11:return n=e.sent(),qr(fc,"Failed to raise snapshot:",n),[4,Cc(r,n)];case 12:return e.sent(),[3,13];case 13:return[2]}})})}function Cc(n,r,i){return f(this,void 0,void 0,function(){var t=this;return d(this,function(e){switch(e.label){case 0:return xu(r)?(Gr(!n.offlineCauses.has(1),"Unexpected network event when IndexedDB was marked failed."),n.offlineCauses.add(1),[4,gc(n)]):[3,2];case 1:return e.sent(),n.onlineStateTracker.set("Offline"),i=i||function(){return Qu(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return f(t,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return qr(fc,"Retrying IndexedDB access"),[4,i()];case 1:return e.sent(),n.offlineCauses.delete(1),[4,yc(n)];case 2:return e.sent(),[2]}})})}),[3,3];case 2:throw r;case 3:return[2]}})})}function Dc(t,n){return n().catch(function(e){return Cc(t,e,n)})}function kc(u){return f(this,void 0,void 0,function(){var i,o,a,s;return d(this,function(e){switch(e.label){case 0:i=Qr(u,pc),o=Pc(i),a=0<i.writePipeline.length?i.writePipeline[i.writePipeline.length-1].batchId:hu,e.label=1;case 1:if(!Ac(i))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,(t=i.localStore,n=a,(r=Qr(t,Uu)).persistence.runTransaction("Get next mutation batch","readonly",function(e){return void 0===n&&(n=hu),r.mutationQueue.getNextMutationBatchAfterBatchId(e,n)}))];case 3:return null===(s=e.sent())?(0===i.writePipeline.length&&o.markIdle(),[3,7]):(a=s.batchId,function(e,t){Gr(Ac(e),"addToWritePipeline called when pipeline is full"),e.writePipeline.push(t);e=Pc(e);e.isOpen()&&e.handshakeComplete&&e.writeMutations(t.mutations)}(i,s),[3,6]);case 4:return s=e.sent(),[4,Cc(i,s)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return Nc(i)&&Rc(i),[2]}var t,n,r})})}function Ac(e){return _c(e)&&e.writePipeline.length<dc}function Nc(e){return _c(e)&&!Pc(e).isStarted()&&0<e.writePipeline.length}function Rc(e){Gr(Nc(e),"startWriteStream() called when shouldStartWriteStream() is false."),Pc(e).start()}function Oc(t,n){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return void 0===n&&Gr(!Nc(t),"Write stream was stopped gracefully while still needed."),n&&Pc(t).handshakeComplete?[4,function(r,i){return f(this,void 0,void 0,function(){var n;return d(this,function(e){switch(e.label){case 0:return Ea(t=i.code)&&t!==Lr.ABORTED?(n=r.writePipeline.shift(),Pc(r).inhibitBackoff(),Gr(!!r.remoteSyncer.rejectFailedWrite,"rejectFailedWrite() not set"),[4,Dc(r,function(){return r.remoteSyncer.rejectFailedWrite(n.batchId,i)})]):[3,3];case 1:return e.sent(),[4,kc(r)];case 2:e.sent(),e.label=3;case 3:return[2]}var t})})}(t,n)]:[3,2];case 1:e.sent(),e.label=2;case 2:return Nc(t)&&Rc(t),[2]}})})}function Lc(n){var e,t,r,i=this;return n.watchStream||(n.watchStream=(e=n.datastore,t=n.asyncQueue,r={onOpen:function(n){return f(this,void 0,void 0,function(){return d(this,function(e){return n.listenTargets.forEach(function(e,t){wc(n,e)}),[2]})})}.bind(null,n),onClose:function(t,n){return f(this,void 0,void 0,function(){return d(this,function(e){return void 0===n&&Gr(!Ec(t),"Watch stream was stopped gracefully while still needed."),Ic(t),Ec(t)?(t.onlineStateTracker.handleWatchStreamFailure(n),Tc(t)):t.onlineStateTracker.set("Unknown"),[2]})})}.bind(null,n),onWatchChange:Sc.bind(null,n)},(e=Qr(e,uc)).verifyInitialized(),new nc(t,e.connection,e.credentials,e.serializer,r)),n.onNetworkStatusChange.push(function(t){return f(i,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return t?(n.watchStream.inhibitBackoff(),Ec(n)?Tc(n):n.onlineStateTracker.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.watchStream.stop()];case 2:e.sent(),Ic(n),e.label=3;case 3:return[2]}})})})),n.watchStream}function Pc(n){var e,t,r,i=this;return n.writeStream||(Gr(0===n.writePipeline.length,"Should not issue writes before WriteStream is enabled"),n.writeStream=(e=n.datastore,t=n.asyncQueue,r={onOpen:function(t){return f(this,void 0,void 0,function(){return d(this,function(e){return Pc(t).writeHandshake(),[2]})})}.bind(null,n),onClose:Oc.bind(null,n),onHandshakeComplete:function(o){return f(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){for(t=Pc(o),n=0,r=o.writePipeline;n<r.length;n++)i=r[n],t.writeMutations(i.mutations);return[2]})})}.bind(null,n),onMutationResult:function(r,i,o){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return Gr(0<r.writePipeline.length,"Got result for empty write pipeline"),t=r.writePipeline.shift(),n=pu.from(t,i,o),Gr(!!r.remoteSyncer.applySuccessfulWrite,"applySuccessfulWrite() not set"),[4,Dc(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return e.sent(),[4,kc(r)];case 2:return e.sent(),[2]}})})}.bind(null,n)},(e=Qr(e,uc)).verifyInitialized(),new oc(t,e.connection,e.credentials,e.serializer,r)),n.onNetworkStatusChange.push(function(t){return f(i,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return t?(n.writeStream.inhibitBackoff(),[4,kc(n)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,n.writeStream.stop()];case 3:e.sent(),0<n.writePipeline.length&&(qr(fc,"Stopping write stream with "+n.writePipeline.length+" pending writes"),n.writePipeline=[]),e.label=4;case 4:return[2]}})})})),n.writeStream}function Mc(){return"undefined"!=typeof document?document:null}var xc="AsyncQueue",Fc=(Vc.createAndSchedule=function(e,t,n,r,i){i=new Vc(e,t,Date.now()+n,r,i);return i.start(n),i},Vc.prototype.start=function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)},Vc.prototype.skipDelay=function(){return this.handleDelayElapsed()},Vc.prototype.cancel=function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Pr(Lr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))},Vc.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},Vc.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Vc);function Vc(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Mu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}var qc=(Object.defineProperty(Bc.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!1,configurable:!0}),Bc.prototype.enqueueAndForget=function(e){this.enqueue(e)},Bc.prototype.enqueueAndForgetEvenWhileRestricted=function(e){this.verifyNotFailed(),this.enqueueInternal(e)},Bc.prototype.enterRestrictedMode=function(){var e;this._isShuttingDown||(this._isShuttingDown=!0,(e=Mc())&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.visibilityHandler))},Bc.prototype.enqueue=function(e){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(e){}):this.enqueueInternal(e)},Bc.prototype.enqueueRetryable=function(e){var t=this;this.enqueueAndForget(function(){return t.retryableOps.push(e),t.retryNextOp()})},Bc.prototype.retryNextOp=function(){return f(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:if(0===this.retryableOps.length)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.retryableOps[0]()];case 2:return e.sent(),this.retryableOps.shift(),this.backoff.reset(),[3,4];case 3:if(!xu(t=e.sent()))throw t;return qr(xc,"Operation failed with retryable error: "+t),[3,4];case 4:return 0<this.retryableOps.length&&this.backoff.backoffAndRun(function(){return n.retryNextOp()}),[2]}})})},Bc.prototype.enqueueInternal=function(e){var t=this,n=this.tail.then(function(){return t.operationInProgress=!0,e().catch(function(e){throw t.failure=e,t.operationInProgress=!1,Br("INTERNAL UNHANDLED ERROR: ",jc(e)),e}).then(function(e){return t.operationInProgress=!1,e})});return this.tail=n},Bc.prototype.enqueueAfterDelay=function(e,t,n){var r=this;this.verifyNotFailed(),Gr(0<=t,"Attempted to schedule an operation with a negative delay of "+t),-1<this.timerIdsToSkip.indexOf(e)&&(t=0);n=Fc.createAndSchedule(this,e,t,n,function(e){return r.removeDelayedOperation(e)});return this.delayedOperations.push(n),n},Bc.prototype.verifyNotFailed=function(){this.failure&&Kr("AsyncQueue is already failed: "+jc(this.failure))},Bc.prototype.verifyOperationInProgress=function(){Gr(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Bc.prototype.drain=function(){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,t=this.tail];case 1:e.sent(),e.label=2;case 2:if(t!==this.tail)return[3,0];e.label=3;case 3:return[2]}})})},Bc.prototype.containsDelayedOperation=function(e){for(var t=0,n=this.delayedOperations;t<n.length;t++){if(n[t].timerId===e)return!0}return!1},Bc.prototype.runAllDelayedOperationsUntil=function(r){var i=this;return this.drain().then(function(){i.delayedOperations.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});for(var e=0,t=i.delayedOperations;e<t.length;e++){var n=t[e];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.drain()})},Bc.prototype.skipDelaysForTimerId=function(e){this.timerIdsToSkip.push(e)},Bc.prototype.removeDelayedOperation=function(e){e=this.delayedOperations.indexOf(e);Gr(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},Bc);function Bc(){var t=this;this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[],this.backoff=new Ju(this,"async_queue_retry"),this.visibilityHandler=function(){var e=Mc();e&&qr(xc,"Visibility state changed to "+e.visibilityState),t.backoff.skipBackoff()};var e=Mc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.visibilityHandler)}function Uc(e,t){if(Br(xc,t+": "+e),xu(e))return new Pr(Lr.UNAVAILABLE,t+": "+e);throw e}function jc(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}var Kc=(zc.emptySet=function(e){return new zc(e.comparator)},zc.prototype.has=function(e){return null!=this.keyedMap.get(e)},zc.prototype.get=function(e){return this.keyedMap.get(e)},zc.prototype.first=function(){return this.sortedSet.minKey()},zc.prototype.last=function(){return this.sortedSet.maxKey()},zc.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},zc.prototype.indexOf=function(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(zc.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),zc.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(e,t){return n(e),!1})},zc.prototype.add=function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))},zc.prototype.delete=function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this},zc.prototype.isEqual=function(e){if(!(e instanceof zc))return!1;if(this.size!==e.size)return!1;for(var t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();t.hasNext();){var r=t.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},zc.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},zc.prototype.copy=function(e,t){var n=new zc;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n},zc);function zc(n){this.comparator=n?function(e,t){return n(e,t)||gi.comparator(e.key,t.key)}:function(e,t){return gi.comparator(e.key,t.key)},this.keyedMap=ha,this.sortedSet=new Zo(this.comparator)}var Gc=(Qc.prototype.track=function(e){var t=e.doc.key,n=this.changeMap.get(t);!n||0!==e.type&&3===n.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==n.type?this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):Kr("unsupported combination of changes: "+JSON.stringify(e)+" after "+JSON.stringify(n))},Qc.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(e,t){n.push(t)}),n},Qc);function Qc(){this.changeMap=new Zo(gi.comparator)}var Wc=(Hc.fromInitialDocuments=function(e,t,n,r){var i=[];return t.forEach(function(e){i.push({type:0,doc:e})}),new Hc(e,t,Kc.emptySet(t),i,n,r,!0,!1)},Object.defineProperty(Hc.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),Hc.prototype.isEqual=function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&go(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0},Hc);function Hc(e,t,n,r,i,o,a,s){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var Yc=function(){this.viewSnap=void 0,this.listeners=[]};var Xc=function(){this.queries=new gu(mo,go),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set};function Jc(a,s){return f(this,void 0,void 0,function(){var t,n,r,i,o;return d(this,function(e){switch(e.label){case 0:if(Gr(!!(t=Qr(a,Xc)).onListen,"onListen not set"),n=s.query,r=!1,(i=t.queries.get(n))||(r=!0,i=new Yc),!r)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),o=i,[4,t.onListen(n)];case 2:return o.viewSnap=e.sent(),[3,4];case 3:return o=e.sent(),o=Uc(o,"Initialization of query '"+vo(s.query)+"' failed"),s.onError(o),[2];case 4:return t.queries.set(n,i),i.listeners.push(s),Gr(!s.applyOnlineStateChange(t.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),i.viewSnap&&s.onViewSnapshot(i.viewSnap)&&Zc(t),[2]}})})}function $c(a,s){return f(this,void 0,void 0,function(){var t,n,r,i,o;return d(this,function(e){return Gr(!!(t=Qr(a,Xc)).onUnlisten,"onUnlisten not set"),n=s.query,r=!1,(i=t.queries.get(n))&&0<=(o=i.listeners.indexOf(s))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?(t.queries.delete(n),[2,t.onUnlisten(n)]):[2]})})}function Zc(e){e.snapshotsInSyncListeners.forEach(function(e){e.next()})}var el=(tl.prototype.onViewSnapshot=function(e){if(Gr(0<e.docChanges.length||e.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var t=[],n=0,r=e.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&t.push(i)}e=new Wc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),o=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),o=!0),this.snap=e,o},tl.prototype.onError=function(e){this.queryObserver.error(e)},tl.prototype.applyOnlineStateChange=function(e){this.onlineState=e;var t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t},tl.prototype.shouldRaiseInitialEvent=function(e,t){if(Gr(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!e.fromCache)return!0;var n="Offline"!==t;return this.options.waitForSyncWhenOnline&&n?(Gr(e.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!e.docs.isEmpty()||"Offline"===t},tl.prototype.shouldRaiseEvent=function(e){if(0<e.docChanges.length)return!0;var t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges},tl.prototype.raiseInitialEvent=function(e){Gr(!this.raisedInitialEvent,"Trying to raise initial events for second time"),e=Wc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(e)},tl);function tl(e,t,n){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=n||{}}var nl=(rl.fromSnapshot=function(e,t){for(var n=pa(),r=pa(),i=0,o=t.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:r=r.add(a.doc.key)}}return new rl(e,t.fromCache,n,r)},rl);function rl(e,t,n,r){this.targetId=e,this.fromCache=t,this.addedKeys=n,this.removedKeys=r}var il=(ol.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},ol.prototype.addReference=function(e,t){t=new al(e,t);this.refsByKey=this.refsByKey.add(t),this.refsByTarget=this.refsByTarget.add(t)},ol.prototype.addReferences=function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})},ol.prototype.removeReference=function(e,t){this.removeRef(new al(e,t))},ol.prototype.removeReferences=function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})},ol.prototype.removeReferencesForId=function(e){var t=this,n=new gi(new li([])),r=new al(n,e),e=new al(n,e+1),i=[];return this.refsByTarget.forEachInRange([r,e],function(e){t.removeRef(e),i.push(e.key)}),i},ol.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},ol.prototype.removeRef=function(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)},ol.prototype.referencesForId=function(e){var t=new gi(new li([])),n=new al(t,e),e=new al(t,e+1),r=pa();return this.refsByTarget.forEachInRange([n,e],function(e){r=r.add(e.key)}),r},ol.prototype.containsKey=function(e){var t=new al(e,0),t=this.refsByKey.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)},ol);function ol(){this.refsByKey=new aa(al.compareByKey),this.refsByTarget=new aa(al.compareByTargetId)}var al=(sl.compareByKey=function(e,t){return gi.comparator(e.key,t.key)||Yr(e.targetOrBatchId,t.targetOrBatchId)},sl.compareByTargetId=function(e,t){return Yr(e.targetOrBatchId,t.targetOrBatchId)||gi.comparator(e.key,t.key)},sl);function sl(e,t){this.key=e,this.targetOrBatchId=t}var ul=function(e){this.key=e},cl=function(e){this.key=e},ll=(Object.defineProperty(hl.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!1,configurable:!0}),hl.prototype.computeDocChanges=function(e,t){var a=this,s=t?t.changeSet:new Gc,u=(t||this).documentSet,c=(t||this).mutatedKeys,l=u,h=!1,f=ao(this.query)&&u.size===this.query.limit?u.last():null,d=so(this.query)&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal(function(e,t){var n=u.get(e),r=t instanceof zi?t:null;r&&(Gr(e.isEqual(r.key),"Mismatching keys found in document changes: "+e+" != "+r.key),r=wo(a.query,r)?r:null);var i=!!n&&a.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||a.mutatedKeys.has(r.key)&&r.hasCommittedMutations),t=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(s.track({type:3,doc:r}),t=!0):a.shouldWaitForSyncedDocument(n,r)||(s.track({type:2,doc:r}),t=!0,(f&&0<a.docComparator(r,f)||d&&a.docComparator(r,d)<0)&&(h=!0)):!n&&r?(s.track({type:0,doc:r}),t=!0):n&&!r&&(s.track({type:1,doc:n}),t=!0,(f||d)&&(h=!0)),t&&(c=r?(l=l.add(r),o?c.add(e):c.delete(e)):(l=l.delete(e),c.delete(e)))}),ao(this.query)||so(this.query))for(;l.size>this.query.limit;){var n=ao(this.query)?l.last():l.first(),l=l.delete(n.key),c=c.delete(n.key);s.track({type:1,doc:n})}return Gr(!h||!t,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:s,needsRefill:h,mutatedKeys:c}},hl.prototype.shouldWaitForSyncedDocument=function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations},hl.prototype.applyChanges=function(e,t,n){var o=this;Gr(!e.needsRefill,"Cannot apply changes that need a refill");var r=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;var i=e.changeSet.getChanges();i.sort(function(e,t){return r=e.type,i=t.type,n(r)-n(i)||o.docComparator(e.doc,t.doc);function n(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kr("Unknown ChangeType: "+e)}}var r,i}),this.applyTargetChange(n);var a=t?this.updateLimboDocuments():[],n=0===this.limboDocuments.size&&this.current?1:0,t=n!==this.syncState;return this.syncState=n,0!==i.length||t?{snapshot:new Wc(this.query,e.documentSet,r,i,e.mutatedKeys,0==n,t,!1),limboChanges:a}:{limboChanges:a}},hl.prototype.applyOnlineStateChange=function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Gc,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},hl.prototype.shouldBeInLimbo=function(e){return!this._syncedDocuments.has(e)&&(!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations)},hl.prototype.applyTargetChange=function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.add(e)}),e.modifiedDocuments.forEach(function(e){Gr(t._syncedDocuments.has(e),"Modified document "+e+" not found in view.")}),e.removedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.delete(e)}),this.current=e.current)},hl.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=pa(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var r=[];return n.forEach(function(e){t.limboDocuments.has(e)||r.push(new cl(e))}),this.limboDocuments.forEach(function(e){n.has(e)||r.push(new ul(e))}),r},hl.prototype.synchronizeWithPersistedState=function(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=pa();e=this.computeDocChanges(e.documents);return this.applyChanges(e,!0)},hl.prototype.computeInitialSnapshot=function(){return Wc.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState)},hl);function hl(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.current=!1,this.limboDocuments=pa(),this.mutatedKeys=pa(),this.docComparator=bo(e),this.documentSet=new Kc(this.docComparator)}var fl="SyncEngine",dl=function(e,t,n){this.query=e,this.targetId=t,this.view=n},pl=function(e){this.key=e,this.receivedDocument=!1},yl=(Object.defineProperty(gl.prototype,"isPrimaryClient",{get:function(){return!0===this._isPrimaryClient},enumerable:!1,configurable:!0}),gl);function gl(e,t,n,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new gu(mo,go),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=[],this.activeLimboTargetsByKey=new Zo(gi.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new il,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Fu.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}function ml(c,l){return f(this,void 0,void 0,function(){var n,o,a,s,u;return d(this,function(e){switch(e.label){case 0:return(n=function(e){e=Qr(e,yl);return e.remoteStore.remoteSyncer.applyRemoteEvent=wl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){var n=Qr(e,yl),e=n.activeLimboResolutionsByTarget.get(t);{if(e&&e.receivedDocument)return pa().add(e.key);var r=pa(),t=n.queriesByTarget.get(t);if(!t)return r;for(var i=0,o=t;i<o.length;i++){var a=o[i],s=n.queryViewsByQuery.get(a);Gr(!!s,"No query view found for "+vo(a)),r=r.unionWith(s.view.syncedDocuments)}return r}}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=function(o,a,s){return f(this,void 0,void 0,function(){var t,n,r,i;return d(this,function(e){switch(e.label){case 0:return((t=Qr(o,yl)).sharedClientState.updateQueryState(a,"rejected",s),i=t.activeLimboResolutionsByTarget.get(a),n=i&&i.key)?(r=(r=new Zo(gi.comparator)).insert(n,new Wi(n,Jo.min())),i=pa().add(n),i=new Ia(Jo.min(),new Map,new aa(Yr),r,i),[4,wl(t,i)]):[3,2];case 1:return e.sent(),t.activeLimboTargetsByKey=t.activeLimboTargetsByKey.remove(n),t.activeLimboResolutionsByTarget.delete(a),Dl(t),[3,4];case 2:return[4,Hu(t.localStore,a,!1).then(function(){return Il(t,a,s)}).catch(Xu)];case 3:e.sent(),e.label=4;case 4:return[2]}})})}.bind(null,e),e.syncEngineListener.onWatchChange=function(e,t){for(var n=Qr(e,Xc),r=!1,i=0,o=t;i<o.length;i++){var a=o[i],s=a.query,s=n.queries.get(s);if(s){for(var u=0,c=s.listeners;u<c.length;u++){c[u].onViewSnapshot(a)&&(r=!0)}s.viewSnap=a}}r&&Zc(n)}.bind(null,e.eventManager),e.syncEngineListener.onWatchError=function(e,t,n){var r=Qr(e,Xc);if(e=r.queries.get(t))for(var i=0,o=e.listeners;i<o.length;i++){o[i].onError(n)}r.queries.delete(t)}.bind(null,e.eventManager),e}(c),u=n.queryViewsByQuery.get(l))?(o=u.targetId,n.sharedClientState.addLocalQueryTarget(o),a=u.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,(t=n.localStore,r=po(l),(i=Qr(t,Uu)).persistence.runTransaction("Allocate target","readwrite",function(t){var n;return i.targetCache.getTargetData(t,r).next(function(e){return e?(n=e,vu.resolve(n)):i.targetCache.allocateTargetId(t).next(function(e){return n=new Iu(r,e,0,t.currentSequenceNumber),i.targetCache.addTargetData(t,n).next(function(){return n})})})}).then(function(e){var t=i.targetDataByTarget.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.targetDataByTarget=i.targetDataByTarget.insert(e.targetId,e),i.targetIdByTarget.set(r,e.targetId)),e}))];case 2:return s=e.sent(),u=n.sharedClientState.addLocalQueryTarget(s.targetId),o=s.targetId,[4,function(i,o,a,s){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return i.applyDocChanges=function(e,t,n){return function(r,i,o,a){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return(t=i.view.computeDocChanges(o)).needsRefill?[4,Yu(r.localStore,i.query,!1).then(function(e){e=e.documents;return i.view.computeDocChanges(e,t)})]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return n=a&&a.targetChanges.get(i.targetId),n=i.view.applyChanges(t,r.isPrimaryClient,n),Cl(r,i.targetId,n.limboChanges),[2,n.snapshot]}})})}(i,e,t,n)},[4,Yu(i.localStore,o,!0)];case 1:return n=e.sent(),r=new ll(o,n.remoteKeys),t=r.computeDocChanges(n.documents),n=Ca.createSynthesizedTargetChangeForCurrentChange(a,s&&"Offline"!==i.onlineState),n=r.applyChanges(t,i.isPrimaryClient,n),Cl(i,a,n.limboChanges),Gr(!!n.snapshot,"applyChanges for new view should always return a snapshot"),r=new dl(o,a,r),i.queryViewsByQuery.set(o,r),i.queriesByTarget.has(a)?i.queriesByTarget.get(a).push(o):i.queriesByTarget.set(a,[o]),[2,n.snapshot]}})})}(n,l,o,"current"===u)];case 3:a=e.sent(),n.isPrimaryClient&&mc(n.remoteStore,s),e.label=4;case 4:return[2,a]}var t,r,i})})}function vl(r,i,o){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:n=function(e){e=Qr(e,yl);return e.remoteStore.remoteSyncer.applySuccessfulWrite=function(i,o){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:t=Qr(i,yl),n=o.batch.batchId,e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Gu(t.localStore,o)];case 2:return r=e.sent(),_l(t,n,null),El(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),[4,kl(t,r)];case 3:return e.sent(),[3,6];case 4:return[4,Xu(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=function(a,s,u){return f(this,void 0,void 0,function(){var n,o;return d(this,function(e){switch(e.label){case 0:n=Qr(a,yl),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,(t=n.localStore,r=s,(i=Qr(t,Uu)).persistence.runTransaction("Reject batch","readwrite-primary",function(t){var n;return i.mutationQueue.lookupMutationBatch(t,r).next(function(e){return zr(null!==e,"Attempt to reject nonexistent batch!"),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,n)})}))];case 2:return o=e.sent(),_l(n,s,u),El(n,s),n.sharedClientState.updateMutationState(s,"rejected",u),[4,kl(n,o)];case 3:return e.sent(),[3,6];case 4:return[4,Xu(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}var t,r,i})})}.bind(null,e),e}(r),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,zu(n.localStore,i)];case 2:return t=e.sent(),n.sharedClientState.addPendingMutation(t.batchId),function(e,t,n){var r=e.mutationUserCallbacks[e.currentUser.toKey()];r=r||new Zo(Yr);r=r.insert(t,n),e.mutationUserCallbacks[e.currentUser.toKey()]=r}(n,t.batchId,o),[4,kl(n,t.changes)];case 3:return e.sent(),[4,kc(n.remoteStore)];case 4:return e.sent(),[3,6];case 5:return n=e.sent(),n=Uc(n,"Failed to persist write"),o.reject(n),[3,6];case 6:return[2]}})})}function wl(r,i){return f(this,void 0,void 0,function(){var n,t;return d(this,function(e){switch(e.label){case 0:n=Qr(r,yl),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Wu(n.localStore,i)];case 2:return t=e.sent(),i.targetChanges.forEach(function(e,t){t=n.activeLimboResolutionsByTarget.get(t);t&&(zr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?t.receivedDocument=!0:0<e.modifiedDocuments.size?zr(t.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(zr(t.receivedDocument,"Received remove for limbo target document without add."),t.receivedDocument=!1))}),[4,kl(n,t,i)];case 3:return e.sent(),[3,6];case 4:return[4,Xu(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function bl(e,n,t){var r,e=Qr(e,yl);(e.isPrimaryClient&&0===t||!e.isPrimaryClient&&1===t)&&(r=[],e.queryViewsByQuery.forEach(function(e,t){t=t.view.applyOnlineStateChange(n);Gr(0===t.limboChanges.length,"OnlineState should not affect limbo documents."),t.snapshot&&r.push(t.snapshot)}),function(e,i){(e=Qr(e,Xc)).onlineState=i;var o=!1;e.queries.forEach(function(e,t){for(var n=0,r=t.listeners;n<r.length;n++){r[n].applyOnlineStateChange(i)&&(o=!0)}}),o&&Zc(e)}(e.eventManager,n),r.length&&(Gr(!!e.syncEngineListener.onWatchChange,"Active views but EventManager callbacks are not assigned"),e.syncEngineListener.onWatchChange(r)),e.onlineState=n,e.isPrimaryClient&&e.sharedClientState.setOnlineState(n))}function Tl(a,s){return f(this,void 0,void 0,function(){var r,i,o;return d(this,function(e){switch(e.label){case 0:_c((r=Qr(a,yl)).remoteStore)||qr(fl,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(t=r.localStore,(n=Qr(t,Uu)).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(e){return n.mutationQueue.getHighestUnacknowledgedBatchId(e)}))];case 2:return(i=e.sent())===hu?(s.resolve(),[2]):((o=r.pendingWritesCallbacks.get(i)||[]).push(s),r.pendingWritesCallbacks.set(i,o),[3,4]);case 3:return o=e.sent(),o=Uc(o,"Initialization of waitForPendingWrites() operation failed"),s.reject(o),[3,4];case 4:return[2]}var t,n})})}function El(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(function(e){e.resolve()}),e.pendingWritesCallbacks.delete(t)}function _l(e,t,n){var r=Qr(e,yl),i=r.mutationUserCallbacks[r.currentUser.toKey()];i&&((e=i.get(t))&&(Gr(t===i.minKey(),"Mutation callbacks processed out-of-order?"),n?e.reject(n):e.resolve(),i=i.remove(t)),r.mutationUserCallbacks[r.currentUser.toKey()]=i)}function Il(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e),Gr(t.queriesByTarget.has(e)&&0!==t.queriesByTarget.get(e).length,"There are no queries mapped to target id "+e);for(var r=0,i=t.queriesByTarget.get(e);r<i.length;r++){var o=i[r];t.queryViewsByQuery.delete(o),n&&t.syncEngineListener.onWatchError(o,n)}t.queriesByTarget.delete(e),t.isPrimaryClient&&t.limboDocumentRefs.removeReferencesForId(e).forEach(function(e){t.limboDocumentRefs.containsKey(e)||Sl(t,e)})}function Sl(e,t){var n=e.activeLimboTargetsByKey.get(t);null!==n&&(vc(e.remoteStore,n),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(n),Dl(e))}function Cl(e,t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ul?(e.limboDocumentRefs.addReference(o.key,t),function(e,t){t=t.key;e.activeLimboTargetsByKey.get(t)||(qr(fl,"New document in limbo: "+t),e.enqueuedLimboResolutions.push(t),Dl(e))}(e,o)):o instanceof cl?(qr(fl,"Document no longer in limbo: "+o.key),e.limboDocumentRefs.removeReference(o.key,t),e.limboDocumentRefs.containsKey(o.key)||Sl(e,o.key)):Kr("Unknown limbo change: "+JSON.stringify(o))}}function Dl(e){for(;0<e.enqueuedLimboResolutions.length&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){var t=e.enqueuedLimboResolutions.shift(),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new pl(t)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(t,n),mc(e.remoteStore,new Iu(po(oo(t.path)),n,2,Cu.INVALID))}}function kl(t,a,s){return f(this,void 0,void 0,function(){var n,r,i,o;return d(this,function(e){switch(e.label){case 0:return(n=Qr(t,yl),r=[],i=[],o=[],n.queryViewsByQuery.isEmpty())?[2]:(n.queryViewsByQuery.forEach(function(e,t){Gr(!!n.applyDocChanges,"ApplyDocChangesHandler not set"),o.push(n.applyDocChanges(t,a,s).then(function(e){e&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),r.push(e),e=nl.fromSnapshot(t.targetId,e),i.push(e))}))}),[4,Promise.all(o)]);case 1:return e.sent(),n.syncEngineListener.onWatchChange(r),[4,function(u,c){return f(this,void 0,void 0,function(){var r,t,n,i,o,a,s;return d(this,function(e){switch(e.label){case 0:r=Qr(u,Uu),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return vu.forEach(c,function(t){return vu.forEach(t.addedKeys,function(e){return r.persistence.referenceDelegate.addReference(n,t.targetId,e)}).next(function(){return vu.forEach(t.removedKeys,function(e){return r.persistence.referenceDelegate.removeReference(n,t.targetId,e)})})})})];case 2:return e.sent(),[3,4];case 3:if(!xu(t=e.sent()))throw t;return qr(qu,"Failed to update sequence numbers: "+t),[3,4];case 4:for(n=0,i=c;n<i.length;n++)s=i[n],o=s.targetId,s.fromCache||(Gr(null!==(a=r.targetDataByTarget.get(o)),"Can't set limbo-free snapshot version for unknown target: "+o),s=a.snapshotVersion,s=a.withLastLimboFreeSnapshotVersion(s),r.targetDataByTarget=r.targetDataByTarget.insert(o,s));return[2]}})})}(n.localStore,i)];case 2:return e.sent(),[2]}})})}function Al(o,a){return f(this,void 0,void 0,function(){var r,i;return d(this,function(e){switch(e.label){case 0:return(r=Qr(o,yl),!r.currentUser.isEqual(a))?(qr(fl,"User change. New user:",a.toKey()),[4,Ku(r.localStore,a)]):[3,3];case 1:return i=e.sent(),r.currentUser=a,n="'waitForPendingWrites' promise is rejected due to a user change.",(t=r).pendingWritesCallbacks.forEach(function(e){e.forEach(function(e){e.reject(new Pr(Lr.CANCELLED,n))})}),t.pendingWritesCallbacks.clear(),r.sharedClientState.handleUserChange(a,i.removedBatchIds,i.addedBatchIds),[4,kl(r,i.affectedDocuments)];case 2:e.sent(),e.label=3;case 3:return[2]}var t,n})})}var Nl=(Rl.prototype.addQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.add(e)},Rl.prototype.removeQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.delete(e)},Rl.prototype.toWebStorageJSON=function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)},Rl);function Rl(){this.activeTargetIds=ya}var Ol=(Ll.prototype.addPendingMutation=function(e){},Ll.prototype.updateMutationState=function(e,t,n){},Ll.prototype.addLocalQueryTarget=function(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"},Ll.prototype.updateQueryState=function(e,t,n){this.queryState[e]=t},Ll.prototype.removeLocalQueryTarget=function(e){this.localState.removeQueryTarget(e)},Ll.prototype.isLocalQueryTarget=function(e){return this.localState.activeTargetIds.has(e)},Ll.prototype.clearQueryState=function(e){delete this.queryState[e]},Ll.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},Ll.prototype.isActiveQueryTarget=function(e){return this.localState.activeTargetIds.has(e)},Ll.prototype.start=function(){return this.localState=new Nl,Promise.resolve()},Ll.prototype.handleUserChange=function(e,t,n){},Ll.prototype.setOnlineState=function(e){},Ll.prototype.shutdown=function(){},Ll.prototype.writeSequenceNumber=function(e){},Ll.prototype.notifyBundleLoaded=function(){},Ll);function Ll(){this.localState=new Nl,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}var Pl=(Ml.prototype.setLocalDocumentsView=function(e){this.localDocumentsView=e},Ml.prototype.getDocumentsMatchingQuery=function(t,r,i,o){var e,a=this;return Gr(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),0===(e=r).filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||i.isEqual(Jo.min())?this.executeFullCollectionScan(t,r):this.localDocumentsView.getDocuments(t,o).next(function(e){var n=a.applyQuery(r,e);return(ao(r)||so(r))&&a.needsRefill(r.limitType,n,o,i)?a.executeFullCollectionScan(t,r):(Vr()<=s.DEBUG&&qr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),vo(r)),a.localDocumentsView.getDocumentsMatchingQuery(t,r,i).next(function(t){return n.forEach(function(e){t=t.insert(e.key,e)}),t}))})},Ml.prototype.applyQuery=function(n,e){var r=new aa(bo(n));return e.forEach(function(e,t){t instanceof zi&&wo(n,t)&&(r=r.add(t))}),r},Ml.prototype.needsRefill=function(e,t,n,r){if(n.size!==t.size)return!0;t="F"===e?t.last():t.first();return!!t&&(t.hasPendingWrites||0<t.version.compareTo(r))},Ml.prototype.executeFullCollectionScan=function(e,t){return Vr()<=s.DEBUG&&qr("QueryEngine","Using full collection scan to execute query:",vo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Jo.min())},Ml);function Ml(){}var xl=(Fl.prototype.checkEmpty=function(e){return vu.resolve(0===this.mutationQueue.length)},Fl.prototype.addMutationBatch=function(e,t,n,r){Gr(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Gr(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");n=new fu(i,t,n,r);this.mutationQueue.push(n);for(var o=0,a=r;o<a.length;o++){var s=a[o];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new al(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}return vu.resolve(n)},Fl.prototype.lookupMutationBatch=function(e,t){return vu.resolve(this.findMutationBatch(t))},Fl.prototype.getNextMutationBatchAfterBatchId=function(e,t){t+=1,t=this.indexOfBatchId(t),t=t<0?0:t;return vu.resolve(this.mutationQueue.length>t?this.mutationQueue[t]:null)},Fl.prototype.getHighestUnacknowledgedBatchId=function(){return vu.resolve(0===this.mutationQueue.length?hu:this.nextBatchId-1)},Fl.prototype.getAllMutationBatches=function(e){return vu.resolve(this.mutationQueue.slice())},Fl.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var n=this,r=new al(t,0),i=new al(t,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(e){Gr(t.isEqual(e.key),"Should only iterate over a single key's batches");e=n.findMutationBatch(e.targetOrBatchId);Gr(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),vu.resolve(o)},Fl.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var r=this,i=new aa(Yr);return t.forEach(function(t){var e=new al(t,0),n=new al(t,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([e,n],function(e){Gr(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),i=i.add(e.targetOrBatchId)})}),vu.resolve(this.findMutationBatches(i))},Fl.prototype.getAllMutationBatchesAffectingQuery=function(e,t){Gr(!ho(t),"CollectionGroup queries should be handled in LocalDocumentsView");var n=t.path,r=n.length+1,t=n;gi.isDocumentKey(t)||(t=t.child(""));var t=new al(new gi(t),0),i=new aa(Yr);return this.batchesByDocumentKey.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(i=i.add(e.targetOrBatchId)),!0)},t),vu.resolve(this.findMutationBatches(i))},Fl.prototype.findMutationBatches=function(e){var t=this,n=[];return e.forEach(function(e){e=t.findMutationBatch(e);null!==e&&n.push(e)}),n},Fl.prototype.removeMutationBatch=function(n,r){var i=this;zr(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return vu.forEach(r.mutations,function(e){var t=new al(e.key,r.batchId);return o=o.delete(t),i.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(function(){i.batchesByDocumentKey=o})},Fl.prototype.removeCachedMutationKeys=function(e){},Fl.prototype.containsKey=function(e,t){var n=new al(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(n);return vu.resolve(t.isEqual(n&&n.key))},Fl.prototype.performConsistencyCheck=function(e){return 0===this.mutationQueue.length&&Gr(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),vu.resolve()},Fl.prototype.indexOfExistingBatchId=function(e,t){e=this.indexOfBatchId(e);return Gr(0<=e&&e<this.mutationQueue.length,"Batches must exist to be "+t),e},Fl.prototype.indexOfBatchId=function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId},Fl.prototype.findMutationBatch=function(e){var t=this.indexOfBatchId(e);if(t<0||t>=this.mutationQueue.length)return null;t=this.mutationQueue[t];return Gr(t.batchId===e,"If found batch must match"),t},Fl);function Fl(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new aa(al.compareByKey)}var Vl=(ql.prototype.addEntry=function(e,t,n){Gr(!n.isEqual(Jo.min()),"Cannot add a document with a read time of zero");var r=t.key,i=this.docs.get(r),o=i?i.size:0,i=this.sizer(t);return this.docs=this.docs.insert(r,{maybeDocument:t,size:i,readTime:n}),this.size+=i-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())},ql.prototype.removeEntry=function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)},ql.prototype.getEntry=function(e,t){t=this.docs.get(t);return vu.resolve(t?t.maybeDocument:null)},ql.prototype.getEntries=function(e,t){var n=this,r=la;return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.maybeDocument:null)}),vu.resolve(r)},ql.prototype.getDocumentsMatchingQuery=function(e,t,n){Gr(!ho(t),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=ha,i=new gi(t.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,a=u.maybeDocument,u=u.readTime;if(!t.path.isPrefixOf(s.path))break;u.compareTo(n)<=0||a instanceof zi&&wo(t,a)&&(r=r.insert(a.key,a))}return vu.resolve(r)},ql.prototype.forEachDocumentKey=function(e,t){return vu.forEach(this.docs,function(e){return t(e)})},ql.prototype.newChangeBuffer=function(e){return new Ul(this)},ql.prototype.getSize=function(e){return vu.resolve(this.size)},ql);function ql(e,t){this.indexManager=e,this.sizer=t,this.docs=new Zo(gi.comparator),this.size=0}var Bl,Ul=(n(jl,Bl=_t),jl.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(e,t){t&&t.maybeDocument?i.push(r.documentCache.addEntry(n,t.maybeDocument,r.getReadTime(e))):r.documentCache.removeEntry(e)}),vu.waitFor(i)},jl.prototype.getFromCache=function(e,t){return this.documentCache.getEntry(e,t)},jl.prototype.getAllFromCache=function(e,t){return this.documentCache.getEntries(e,t)},jl);function jl(e){var t=Bl.call(this)||this;return t.documentCache=e,t}var Kl=(zl.prototype.forEachTarget=function(e,n){return this.targets.forEach(function(e,t){return n(t)}),vu.resolve()},zl.prototype.getLastRemoteSnapshotVersion=function(e){return vu.resolve(this.lastRemoteSnapshotVersion)},zl.prototype.getHighestSequenceNumber=function(e){return vu.resolve(this.highestSequenceNumber)},zl.prototype.allocateTargetId=function(e){return this.highestTargetId=this.targetIdGenerator.next(),vu.resolve(this.highestTargetId)},zl.prototype.setTargetsMetadata=function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),vu.resolve()},zl.prototype.saveTargetData=function(e){this.targets.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Fu(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)},zl.prototype.addTargetData=function(e,t){return Gr(!this.targets.has(t.target),"Adding a target that already exists"),this.saveTargetData(t),this.targetCount+=1,vu.resolve()},zl.prototype.updateTargetData=function(e,t){return Gr(this.targets.has(t.target),"Updating a non-existent target"),this.saveTargetData(t),vu.resolve()},zl.prototype.removeTargetData=function(e,t){return Gr(0<this.targetCount,"Removing a target from an empty cache"),Gr(this.targets.has(t.target),"Removing a non-existent target from the cache"),this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),--this.targetCount,vu.resolve()},zl.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.targets.forEach(function(e,t){t.sequenceNumber<=r&&null===i.get(t.targetId)&&(o.targets.delete(e),s.push(o.removeMatchingKeysForTargetId(n,t.targetId)),a++)}),vu.waitFor(s).next(function(){return a})},zl.prototype.getTargetCount=function(e){return vu.resolve(this.targetCount)},zl.prototype.getTargetData=function(e,t){t=this.targets.get(t)||null;return vu.resolve(t)},zl.prototype.addMatchingKeys=function(e,t,n){return this.references.addReferences(t,n),vu.resolve()},zl.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),vu.waitFor(i)},zl.prototype.removeMatchingKeysForTargetId=function(e,t){return this.references.removeReferencesForId(t),vu.resolve()},zl.prototype.getMatchingKeysForTargetId=function(e,t){t=this.references.referencesForId(t);return vu.resolve(t)},zl.prototype.containsKey=function(e,t){return vu.resolve(this.references.containsKey(t))},zl);function zl(e){this.persistence=e,this.targets=new gu(eo,no),this.lastRemoteSnapshotVersion=Jo.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new il,this.targetCount=0,this.targetIdGenerator=Fu.forTargetCache()}var Gl=(Ql.prototype.getBundleMetadata=function(e,t){return vu.resolve(this.bundles.get(t))},Ql.prototype.saveBundleMetadata=function(e,t){return this.bundles.set(t.id,{id:(t=t).id,version:t.version,createTime:Qa(t.createTime)}),vu.resolve()},Ql.prototype.getNamedQuery=function(e,t){return vu.resolve(this.namedQueries.get(t))},Ql.prototype.saveNamedQuery=function(e,t){return this.namedQueries.set(t.name,Au(t)),vu.resolve()},Ql);function Ql(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}var Wl=(Hl.prototype.start=function(){return Promise.resolve()},Hl.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(Hl.prototype,"started",{get:function(){return this._started},enumerable:!1,configurable:!0}),Hl.prototype.setDatabaseDeletedListener=function(){},Hl.prototype.setNetworkEnabled=function(){},Hl.prototype.getIndexManager=function(){return this.indexManager},Hl.prototype.getMutationQueue=function(e){var t=this.mutationQueues[e.toKey()];return t||(t=new xl(this.indexManager,this.referenceDelegate),this.mutationQueues[e.toKey()]=t),t},Hl.prototype.getTargetCache=function(){return this.targetCache},Hl.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},Hl.prototype.getBundleCache=function(){return this.bundleCache},Hl.prototype.runTransaction=function(e,t,n){var r=this;qr("MemoryPersistence","Starting transaction:",e);var i=new Xl(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(e){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})},Hl.prototype.mutationQueuesContainKey=function(t,n){return vu.or(Object.values(this.mutationQueues).map(function(e){return function(){return e.containsKey(t,n)}}))},Hl);function Hl(e,t){var n=this;this.mutationQueues={},this.listenSequence=new Cu(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new Kl(this);this.indexManager=new Ru,this.remoteDocumentCache=(e=this.indexManager,new Vl(e,function(e){return n.referenceDelegate.documentSize(e)})),this.serializer=new ku(t),this.bundleCache=new Gl(this.serializer)}var Yl,Xl=(n(Jl,Yl=Et),Jl);function Jl(e){var t=Yl.call(this)||this;return t.currentSequenceNumber=e,t}var $l=(Zl.factory=function(e){return new Zl(e)},Object.defineProperty(Zl.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Kr("orphanedDocuments is only valid during a transaction.")},enumerable:!1,configurable:!0}),Zl.prototype.addReference=function(e,t,n){return this.localViewReferences.addReference(n,t),this.orphanedDocuments.delete(n.toString()),vu.resolve()},Zl.prototype.removeReference=function(e,t,n){return this.localViewReferences.removeReference(n,t),this.orphanedDocuments.add(n.toString()),vu.resolve()},Zl.prototype.markPotentiallyOrphaned=function(e,t){return this.orphanedDocuments.add(t.toString()),vu.resolve()},Zl.prototype.removeTarget=function(e,t){var n=this;this.localViewReferences.removeReferencesForId(t.targetId).forEach(function(e){return n.orphanedDocuments.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.orphanedDocuments.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})},Zl.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},Zl.prototype.onTransactionCommitted=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return vu.forEach(this.orphanedDocuments,function(e){var t=gi.fromPath(e);return r.isReferenced(n,t).next(function(e){e||i.removeEntry(t)})}).next(function(){return r._orphanedDocuments=null,i.apply(n)})},Zl.prototype.updateLimboDocument=function(e,t){var n=this;return this.isReferenced(e,t).next(function(e){e?n.orphanedDocuments.delete(t.toString()):n.orphanedDocuments.add(t.toString())})},Zl.prototype.documentSize=function(e){return 0},Zl.prototype.isReferenced=function(e,t){var n=this;return vu.or([function(){return vu.resolve(n.localViewReferences.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.mutationQueuesContainKey(e,t)}])},Zl);function Zl(e){this.persistence=e,this.localViewReferences=new il,this._orphanedDocuments=null}var eh=(th.prototype.onOpen=function(e){Gr(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=e},th.prototype.onClose=function(e){Gr(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=e},th.prototype.onMessage=function(e){Gr(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=e},th.prototype.close=function(){this.closeFn()},th.prototype.send=function(e){this.sendFn(e)},th.prototype.callOnOpen=function(){Gr(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},th.prototype.callOnClose=function(e){Gr(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(e)},th.prototype.callOnMessage=function(e){Gr(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(e)},th);function th(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}var nh="RestConnection",rh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ih="gl-js/ fire/"+xr,_t=(oh.prototype.invokeRPC=function(t,e,n,r){var i=this.makeUrl(t,e);qr(nh,"Sending: ",i,n);e={};return this.modifyHeadersForRequest(e,r),this.performRPCRequest(t,i,e,n).then(function(e){return qr(nh,"Received: ",e),e},function(e){throw Ur(nh,t+" failed with error: ",e,"url: ",i,"request:",n),e})},oh.prototype.invokeStreamingRPC=function(e,t,n,r){return this.invokeRPC(e,t,n,r)},oh.prototype.modifyHeadersForRequest=function(e,t){if(e["X-Goog-Api-Client"]=ih,e["Content-Type"]="text/plain",t)for(var n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])},oh.prototype.makeUrl=function(e,t){var n=rh[e];return Gr(void 0!==n,"Unknown REST mapping for: "+e),this.baseUrl+"/v1/"+t+":"+n},oh);function oh(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.baseUrl=t+"://"+e.host,this.databaseRoot="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}var ah,sh="Connection",uh=(n(ch,ah=_t),ch.prototype.performRPCRequest=function(o,t,a,s){return new Promise(function(n,r){var i=new _r;i.listenOnce(vr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case mr.NO_ERROR:var e=i.getResponseJson();qr(sh,"XHR received:",JSON.stringify(e)),n(e);break;case mr.TIMEOUT:qr(sh,'RPC "'+o+'" timed out'),r(new Pr(Lr.DEADLINE_EXCEEDED,"Request time out"));break;case mr.HTTP_ERROR:var t=i.getStatus();qr(sh,'RPC "'+o+'" failed with status:',t,"response text:",i.getResponseText()),0<t?(e=i.getResponseJson().error)&&e.status&&e.message?(t=(t=e.status).toLowerCase().replace(/_/g,"-"),t=0<=Object.values(Lr).indexOf(t)?t:Lr.UNKNOWN,r(new Pr(t,e.message))):r(new Pr(Lr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Pr(Lr.UNAVAILABLE,"Connection failed."));break;default:Kr('RPC "'+o+'" failed with unanticipated webchannel error '+i.getLastErrorCode()+": "+i.getLastError()+", giving up.")}}finally{qr(sh,'RPC "'+o+'" completed.')}});var e=JSON.stringify(s);i.send(t,"POST",e,a,15)})},ch.prototype.openStream=function(e,t){var n,r=[this.baseUrl,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new hr,o=gr(),e={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.modifyHeadersForRequest(e.initMessageHeaders,t),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(y())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=y().indexOf("Electron/")||(0<=(n=y()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=y().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(e.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");qr(sh,"Creating WebChannel: "+r,e);var a=i.createWebChannel(r,e),s=!1,u=!1,c=new eh({sendFn:function(e){u?qr(sh,"Not sending because WebChannel is closed:",e):(s||(qr(sh,"Opening WebChannel transport."),a.open(),s=!0),qr(sh,"WebChannel sending:",e),a.send(e))},closeFn:function(){return a.close()}}),e=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})};return e(a,Er.EventType.OPEN,function(){u||qr(sh,"WebChannel transport opened.")}),e(a,Er.EventType.CLOSE,function(){u||(u=!0,qr(sh,"WebChannel transport closed"),c.callOnClose())}),e(a,Er.EventType.ERROR,function(e){u||(u=!0,Ur(sh,"WebChannel transport errored:",e),c.callOnClose(new Pr(Lr.UNAVAILABLE,"The operation could not be completed")))}),e(a,Er.EventType.MESSAGE,function(e){var t,n,r,i;u||(zr(!!(t=e.data[0]),"Got a webchannel message without data."),(n=t.error||(null===(i=t[0])||void 0===i?void 0:i.error))?(qr(sh,"WebChannel received error:",n),e=function(e){if(void 0!==(e=ba[e]))return _a(e)}(r=n.status),i=n.message,void 0===e&&(e=Lr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.callOnClose(new Pr(e,i)),a.close()):(qr(sh,"WebChannel received:",t),c.callOnMessage(t)))}),e(o,wr.STAT_EVENT,function(e){e.stat===br?qr(sh,"Detected buffering proxy"):e.stat===Tr&&qr(sh,"Detected no buffering proxy")}),setTimeout(function(){c.callOnOpen()},0),c},ch);function ch(e){var t=ah.call(this,e)||this;return t.forceLongPolling=e.forceLongPolling,t.autoDetectLongPolling=e.autoDetectLongPolling,t}var lh="ConnectivityMonitor",hh=(fh.prototype.addCallback=function(e){this.callbacks.push(e)},fh.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},fh.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},fh.prototype.onNetworkAvailable=function(){qr(lh,"Network connectivity changed: AVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++){(0,t[e])(0)}},fh.prototype.onNetworkUnavailable=function(){qr(lh,"Network connectivity changed: UNAVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++){(0,t[e])(1)}},fh.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},fh);function fh(){var e=this;this.networkAvailableListener=function(){return e.onNetworkAvailable()},this.networkUnavailableListener=function(){return e.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var dh=(ph.prototype.addCallback=function(e){},ph.prototype.shutdown=function(){},ph);function ph(){}function yh(e){return new Ba(e,!0)}var gh=(mh.prototype.initialize=function(t){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.serializer=yh(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.createGarbageCollectionScheduler(t),this.localStore=this.createLocalStore(t),[2]}})})},mh.prototype.createGarbageCollectionScheduler=function(e){return null},mh.prototype.createLocalStore=function(e){return t=this.persistence,n=new Pl,r=e.initialUser,e=this.serializer,new Uu(t,n,r,e);var t,n,r},mh.prototype.createPersistence=function(e){return new Wl($l.factory,this.serializer)},mh.prototype.createSharedClientState=function(e){return new Ol},mh.prototype.terminate=function(){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return e.sent(),[4,this.persistence.shutdown()];case 2:return e.sent(),[2]}})})},mh);function mh(){this.synchronizeTabs=!1}var vh=(wh.prototype.initialize=function(n,r){return f(this,void 0,void 0,function(){var t=this;return d(this,function(e){switch(e.label){case 0:return this.localStore?[2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return bl(t.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Al.bind(null,this.syncEngine),[4,function(n,r){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return(t=Qr(n,pc),r)?(t.offlineCauses.delete(2),[4,yc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return r?[3,4]:(t.offlineCauses.add(2),[4,gc(t)]);case 3:e.sent(),t.onlineStateTracker.set("Unknown"),e.label=4;case 4:return[2]}})})}(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:return e.sent(),[2]}})})},wh.prototype.createEventManager=function(e){return new Xc},wh.prototype.createDatastore=function(e){var t,n=yh(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new uh(t));return e=e.credentials,new uc(e,t,n)},wh.prototype.createRemoteStore=function(e){var t,n,r,i,o=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return bl(o.syncEngine,e,0)},e=new(hh.isAvailable()?hh:dh),new pc(t,n,r,i,e)},wh.prototype.createSyncEngine=function(e,t){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,a=e.initialUser,e=e.maxConcurrentLimboResolutions,t=t,e=new yl(n,r,i,o,a,e),t&&(e._isPrimaryClient=!0),e;var n,r,i,o,a},wh.prototype.terminate=function(){return function(n){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return t=Qr(n,pc),qr(fc,"RemoteStore shutting down."),t.offlineCauses.add(5),[4,gc(t)];case 1:return e.sent(),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown"),[2]}})})}(this.remoteStore)},wh);function wh(){}var bh=(Th.prototype.next=function(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)},Th.prototype.error=function(e){this.observer.error?this.scheduleEvent(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)},Th.prototype.mute=function(){this.muted=!0},Th.prototype.scheduleEvent=function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)},Th);function Th(e){this.observer=e,this.muted=!1}var Eh=(_h.prototype.lookup=function(r){return f(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Pr(Lr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(a,s){return f(this,void 0,void 0,function(){var t,n,r,i,o;return d(this,function(e){switch(e.label){case 0:return t=Qr(a,uc),n=$a(t.serializer)+"/documents",r={documents:s.map(function(e){return Ya(t.serializer,e)})},[4,t.invokeStreamingRPC("BatchGetDocuments",n,r)];case 1:return r=e.sent(),i=new Map,r.forEach(function(e){e=ts(t.serializer,e);i.set(e.key.toString(),e)}),o=[],s.forEach(function(e){var t=i.get(e.toString());zr(!!t,"Missing entity in write response for "+e),o.push(t)}),[2,o]}})})}(this.datastore,r)];case 1:return(t=e.sent()).forEach(function(e){e instanceof Wi||e instanceof zi?n.recordVersion(e):Kr("Document in a transaction was a "+e.constructor.name)}),[2,t]}})})},_h.prototype.set=function(e,t){this.write(t.toMutations(e,this.precondition(e))),this.writtenDocs.add(e.toString())},_h.prototype.update=function(e,t){try{this.write(t.toMutations(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())},_h.prototype.delete=function(e){this.write([new au(e,this.precondition(e))]),this.writtenDocs.add(e.toString())},_h.prototype.commit=function(){return f(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(e,t){t=gi.fromPath(t);n.mutations.push(new cu(t,n.precondition(t)))}),[4,function(i,o){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return t=Qr(i,uc),n=$a(t.serializer)+"/documents",r={writes:o.map(function(e){return rs(t.serializer,e)})},[4,t.invokeRPC("Commit",n,r)];case 1:return e.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},_h.prototype.recordVersion=function(e){var t;if(e instanceof zi)t=e.version;else{if(!(e instanceof Wi))throw Kr("Document in a transaction was a "+e.constructor.name);t=Jo.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Pr(Lr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)},_h.prototype.precondition=function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Vs.updateTime(t):Vs.none()},_h.prototype.preconditionForUpdate=function(e){var t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return Vs.exists(!0);if(t.isEqual(Jo.min()))throw new Pr(Lr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Vs.updateTime(t)},_h.prototype.write=function(e){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(e)},_h.prototype.ensureCommitNotCalled=function(){Gr(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},_h);function _h(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}var Ih=(Sh.prototype.run=function(){this.runWithBackOff()},Sh.prototype.runWithBackOff=function(){var e=this;this.backoff.backoffAndRun(function(){return f(e,void 0,void 0,function(){var t,n,r=this;return d(this,function(e){return t=new Eh(this.datastore),(n=this.tryRunUpdateFunction(t))&&n.then(function(e){r.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){r.deferred.resolve(e)}).catch(function(e){r.handleTransactionError(e)})})}).catch(function(e){r.handleTransactionError(e)}),[2]})})})},Sh.prototype.tryRunUpdateFunction=function(e){try{var t=this.updateFunction(e);return!oi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}},Sh.prototype.handleTransactionError=function(e){var t=this;0<this.retries&&this.isRetryableTransactionError(e)?(--this.retries,this.asyncQueue.enqueueAndForget(function(){return t.runWithBackOff(),Promise.resolve()})):this.deferred.reject(e)},Sh.prototype.isRetryableTransactionError=function(e){if("FirebaseError"!==e.name)return!1;e=e.code;return"aborted"===e||"failed-precondition"===e||!Ea(e)},Sh);function Sh(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new Ju(this.asyncQueue,"transaction_retry")}var Ch="FirestoreClient",Dh=(kh.prototype.getConfiguration=function(){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return e.sent(),[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}})})},kh.prototype.setCredentialChangeListener=function(e){var t=this;this.credentialListener=e,this.receivedInitialUser.promise.then(function(){return t.credentialListener(t.user)})},kh.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Pr(Lr.FAILED_PRECONDITION,"The client has already been terminated.")},kh.prototype.terminate=function(){var e=this;this.asyncQueue.enterRestrictedMode();var n=new Mu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return f(e,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return t=e.sent(),t=Uc(t,"Failed to shutdown persistence"),n.reject(t),[3,6];case 6:return[2]}})})}),n.promise},kh);function kh(e,t,n){var r=this;this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=Nr.UNAUTHENTICATED,this.clientId=Wr.newId(),this.credentialListener=function(){},this.receivedInitialUser=new Mu,this.credentials.setChangeListener(function(e){qr(Ch,"Received user=",e.uid),r.user.isEqual(e)||(r.user=e,r.credentialListener(e)),r.receivedInitialUser.resolve()})}function Ah(r,i){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,Nh(r)];case 1:return t=e.sent(),qr(Ch,"Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=e.sent(),[4,i.initialize(t,n)];case 3:return e.sent(),r.setCredentialChangeListener(function(e){return r.asyncQueue.enqueueRetryable(function(){return function(r,i){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return(t=Qr(r,pc)).asyncQueue.verifyOperationInProgress(),Gr(!!t.remoteSyncer.handleCredentialChange,"handleCredentialChange() not set"),qr(fc,"RemoteStore received new credentials"),n=_c(t),t.offlineCauses.add(3),[4,gc(t)];case 1:return e.sent(),n&&t.onlineStateTracker.set("Unknown"),[4,t.remoteSyncer.handleCredentialChange(i)];case 2:return e.sent(),t.offlineCauses.delete(3),[4,yc(t)];case 3:return e.sent(),[2]}})})}(i.remoteStore,e)})}),r.onlineComponents=i,[2]}})})}function Nh(t){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(qr(Ch,"Using default OfflineComponentProvider"),[4,function(r,i){return f(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:return r.asyncQueue.verifyOperationInProgress(),qr(Ch,"Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return t=e.sent(),[4,i.initialize(t)];case 2:return e.sent(),r.setCredentialChangeListener(function(t){return r.asyncQueue.enqueueRetryable(function(){return f(n,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,Ku(i.localStore,t)];case 1:return e.sent(),[2]}})})})}),i.persistence.setDatabaseDeletedListener(function(){return r.terminate()}),r.offlineComponents=i,[2]}})})}(t,new gh)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Rh(t){return f(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(qr(Ch,"Using default OnlineComponentProvider"),[4,Ah(t,new vh)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Oh(e){return Nh(e).then(function(e){return e.persistence})}function Lh(e){return Nh(e).then(function(e){return e.localStore})}function Ph(e){return Rh(e).then(function(e){return e.remoteStore})}function Mh(e){return Rh(e).then(function(e){return e.syncEngine})}function xh(r){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return[4,Rh(r)];case 1:return t=e.sent(),(n=t.eventManager).onListen=ml.bind(null,t.syncEngine),n.onUnlisten=function(i,o){return f(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return(t=Qr(i,yl),Gr(!!(n=t.queryViewsByQuery.get(o)),"Trying to unlisten on query not found:"+vo(o)),1<(r=t.queriesByTarget.get(n.targetId)).length)?(t.queriesByTarget.set(n.targetId,r.filter(function(e){return!go(e,o)})),t.queryViewsByQuery.delete(o),[2]):t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(n.targetId),t.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,Hu(t.localStore,n.targetId,!1).then(function(){t.sharedClientState.clearQueryState(n.targetId),vc(t.remoteStore,n.targetId),Il(t,n.targetId)}).catch(Xu)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return Il(t,n.targetId),[4,Hu(t.localStore,n.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}})})}.bind(null,t.syncEngine),[2,n]}})})}function Fh(r){var e=this;return r.asyncQueue.enqueue(function(){return f(e,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return[4,Oh(r)];case 1:return t=e.sent(),[4,Ph(r)];case 2:return n=e.sent(),t.setNetworkEnabled(!0),[2,((e=Qr(e=n,pc)).offlineCauses.delete(0),yc(e))]}})})})}function Vh(r){var e=this;return r.asyncQueue.enqueue(function(){return f(e,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return[4,Oh(r)];case 1:return t=e.sent(),[4,Ph(r)];case 2:return n=e.sent(),t.setNetworkEnabled(!1),[2,function(n){return f(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return(t=Qr(n,pc)).offlineCauses.add(0),[4,gc(t)];case 1:return e.sent(),t.onlineStateTracker.set("Offline"),[2]}})})}(n)]}})})})}function qh(t,n){var e=this,r=new Mu;return t.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,Lh(t)];case 1:return[2,function(i,o,a){return f(this,void 0,void 0,function(){var r;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(t=o,(n=Qr(i,Uu)).persistence.runTransaction("read document","readonly",function(e){return n.localDocuments.getDocument(e,t)}))];case 1:return(r=e.sent())instanceof zi?a.resolve(r):r instanceof Wi?a.resolve(null):a.reject(new Pr(Lr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=e.sent(),r=Uc(r,"Failed to get document '"+o+" from cache"),a.reject(r),[3,3];case 3:return[2]}var t,n})})}(e.sent(),n,r)]}})})}),r.promise}function Bh(u,c,l){var e=this;void 0===l&&(l={});var h=new Mu;return u.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,xh(u)];case 1:return t=e.sent(),[2,(n=t,r=u.asyncQueue,i=c,o=l,a=h,e=new bh({next:function(e){r.enqueueAndForget(function(){return $c(n,s)});var t=e.docs.has(i);!t&&e.fromCache?a.reject(new Pr(Lr.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&o&&"server"===o.source?a.reject(new Pr(Lr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):(Gr(e.docs.size<=1,"Expected zero or a single result on a document-only query"),a.resolve(e))},error:function(e){return a.reject(e)}}),s=new el(oo(i.path),e,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0}),Jc(n,s))]}var n,r,i,o,a,s})})}),h.promise}function Uh(t,n){var e=this,r=new Mu;return t.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,Lh(t)];case 1:return[2,function(r,i,o){return f(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Yu(r,i,!0)];case 1:return n=e.sent(),t=new ll(i,n.remoteKeys),n=t.computeDocChanges(n.documents),n=t.applyChanges(n,!1),o.resolve(n.snapshot),[3,3];case 2:return n=e.sent(),n=Uc(n,"Failed to execute query '"+i+" against cache"),o.reject(n),[3,3];case 3:return[2]}})})}(e.sent(),n,r)]}})})}),r.promise}function jh(u,c,l){var e=this;void 0===l&&(l={});var h=new Mu;return u.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){var s;return d(this,function(e){switch(e.label){case 0:return[4,xh(u)];case 1:return s=e.sent(),[2,(t=s,n=u.asyncQueue,r=c,i=l,o=h,e=new bh({next:function(e){n.enqueueAndForget(function(){return $c(t,a)}),e.fromCache&&"server"===i.source?o.reject(new Pr(Lr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(e)},error:function(e){return o.reject(e)}}),a=new el(r,e,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0}),Jc(t,a))]}var t,n,r,i,o,a})})}),h.promise}function Kh(n,e){var t=this,r=new bh(e);return n.asyncQueue.enqueueAndForget(function(){return f(t,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,xh(n)];case 1:return t=e.sent(),[2,(e=r,Qr(t,Xc).snapshotsInSyncListeners.add(e),void e.next())]}})})}),function(){r.mute(),n.asyncQueue.enqueueAndForget(function(){return f(t,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,xh(n)];case 1:return t=e.sent(),[2,(e=r,void Qr(t,Xc).snapshotsInSyncListeners.delete(e))]}})})})}}function zh(n,r){var e=this,i=new Mu;return n.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,Rh(n).then(function(e){return e.datastore})];case 1:return t=e.sent(),new Ih(n.asyncQueue,t,r,i).run(),[2]}})})}),i.promise}function Gh(e,t,n){if(!n)throw new Pr(Lr.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function Qh(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function Wh(e,t,n,r){if(!0===t&&!0===r)throw new Pr(Lr.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function Hh(e){if(!gi.isDocumentKey(e))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function Yh(e){if(gi.isDocumentKey(e))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function Xh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Kr("Unknown wrong type: "+typeof e);if(e instanceof Array)return"an array";e=function(e){if(e.constructor){e=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(e&&1<e.length)return e[1]}return null}(e);return e?"a custom "+e+" object":"an object"}function Jh(e,t){if("_delegate"in e&&(e=e._delegate),e instanceof t)return e;if(t.name===e.constructor.name)throw new Pr(Lr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=Xh(e);throw new Pr(Lr.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+e)}function $h(e,t){if(t<=0)throw new Pr(Lr.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}function Zh(e){return function(e,t){if("object"!=typeof e||null===e)return;for(var n=e,r=0,i=t;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return 1}return}(e,["next","error","complete"])}var ef=(Object.defineProperty(tf.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(tf.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),tf.prototype.isEqual=function(e){return this._lat===e._lat&&this._long===e._long},tf.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},tf.prototype._compareTo=function(e){return Yr(this._lat,e._lat)||Yr(this._long,e._long)},tf);function tf(e,t){if(!isFinite(e)||e<-90||90<e)throw new Pr(Lr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new Pr(Lr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}var nf=(rf.fromBase64String=function(e){try{return new rf(ri.fromBase64String(e))}catch(e){throw new Pr(Lr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},rf.fromUint8Array=function(e){return new rf(ri.fromUint8Array(e))},rf.prototype.toBase64=function(){return this._byteString.toBase64()},rf.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},rf.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},rf.prototype.isEqual=function(e){return this._byteString.isEqual(e._byteString)},rf);function rf(e){this._byteString=e}var of=function(e){this._delegate=e};function af(){if("undefined"==typeof Uint8Array)throw new Pr(Lr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function sf(){if("undefined"==typeof atob)throw new Pr(Lr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var uf,cf=(n(lf,uf=of),lf.fromBase64String=function(e){return sf(),new lf(nf.fromBase64String(e))},lf.fromUint8Array=function(e){return af(),new lf(nf.fromUint8Array(e))},lf.prototype.toBase64=function(){return sf(),this._delegate.toBase64()},lf.prototype.toUint8Array=function(){return af(),this._delegate.toUint8Array()},lf.prototype.isEqual=function(e){return this._delegate.isEqual(e._delegate)},lf.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},lf);function lf(){return null!==uf&&uf.apply(this,arguments)||this}hf.prototype.convertValue=function(e,t){switch(void 0===t&&(t="none"),Si(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Li(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Pi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Kr("Invalid value type: "+JSON.stringify(e))}},hf.prototype.convertObject=function(e,n){var r=this,i={};return ti(e.fields||{},function(e,t){i[e]=r.convertValue(t,n)}),i},hf.prototype.convertGeoPoint=function(e){return new ef(Li(e.latitude),Li(e.longitude))},hf.prototype.convertArray=function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})},hf.prototype.convertServerTimestamp=function(e,t){switch(t){case"previous":var n=function e(t){t=t.mapValue.fields[bi];return Ei(t)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(_i(e));default:return null}},hf.prototype.convertTimestamp=function(e){e=Oi(e);return new $r(e.seconds,e.nanos)},hf.prototype.convertDocumentKey=function(e,t){var n=li.fromString(e);zr(ps(n),"ReferenceValue is not valid "+e);e=new kr(n.get(1),n.get(3)),n=new gi(n.popFirst(5));return e.isEqual(t)||Br("Document "+n+" contains a document reference within a different database ("+e.projectId+"/"+e.database+") which is not supported. It will be treated as a reference in the current database ("+t.projectId+"/"+t.database+") instead."),n},Et=hf;function hf(){}var ff,df=(n(pf,ff=Et),pf.prototype.convertBytes=function(e){return new cf(new nf(e))},pf.prototype.convertReference=function(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return Hp.forKey(e,this.firestore,null)},pf);function pf(e){var t=ff.call(this)||this;return t.firestore=e,t}var yf=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},gf=(mf.prototype.getToken=function(){return Promise.resolve(null)},mf.prototype.invalidateToken=function(){},mf.prototype.setChangeListener=function(e){Gr(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=e)(Nr.UNAUTHENTICATED)},mf.prototype.removeChangeListener=function(){this.changeListener=null},mf);function mf(){this.changeListener=null}var vf=(wf.prototype.getToken=function(){var t=this;Gr(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(function(e){return t.tokenCounter!==n?(qr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):e?(zr("string"==typeof e.accessToken,"Invalid tokenData returned from getToken():"+e),new yf(e.accessToken,t.currentUser)):null}):Promise.resolve(null)},wf.prototype.invalidateToken=function(){this.forceRefresh=!0},wf.prototype.setChangeListener=function(e){Gr(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=e,this.receivedInitialUser&&e(this.currentUser)},wf.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},wf.prototype.getUser=function(){var e=this.auth&&this.auth.getUid();return zr(null===e||"string"==typeof e,"Received invalid UID: "+e),new Nr(e)},wf);function wf(e){var t=this;this.tokenListener=null,this.currentUser=Nr.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){t.tokenCounter++,t.currentUser=t.getUser(),t.receivedInitialUser=!0,t.changeListener&&t.changeListener(t.currentUser)},this.tokenCounter=0,this.auth=e.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),e.get().then(function(e){t.auth=e,t.tokenListener&&t.auth.addAuthTokenListener(t.tokenListener)},function(){}))}var bf=(Object.defineProperty(Tf.prototype,"authHeaders",{get:function(){var e={"X-Goog-AuthUser":this.sessionIndex},t=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),e},enumerable:!1,configurable:!0}),Tf);function Tf(e,t){this.gapi=e,this.sessionIndex=t,this.type="FirstParty",this.user=Nr.FIRST_PARTY}var Ef=(_f.prototype.getToken=function(){return Promise.resolve(new bf(this.gapi,this.sessionIndex))},_f.prototype.setChangeListener=function(e){e(Nr.FIRST_PARTY)},_f.prototype.removeChangeListener=function(){},_f.prototype.invalidateToken=function(){},_f);function _f(e,t){this.gapi=e,this.sessionIndex=t}var If=new Map;var Sf=(Cf.prototype.isEqual=function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties},Cf);function Cf(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Pr(Lr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Pr(Lr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,Wh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}var Df=(Object.defineProperty(kf.prototype,"app",{get:function(){if(!this._app)throw new Pr(Lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(kf.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(kf.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),kf.prototype._setSettings=function(e){if(this._settingsFrozen)throw new Pr(Lr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sf(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new gf;switch(e.type){case"gapi":var t=e.client;return zr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new Ef(t,e.sessionIndex||"0");case"provider":return e.client;default:throw new Pr(Lr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},kf.prototype._getSettings=function(){return this._settings},kf.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},kf.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},kf.prototype._terminate=function(){var e,t;return e=this,(t=If.get(e))&&(qr("ComponentProvider","Removing Datastore"),If.delete(e),t.terminate()),Promise.resolve()},kf);function kf(e,t){this._persistenceKey="(lite)",this._settings=new Sf({}),this._settingsFrozen=!1,e instanceof kr?(this._databaseId=e,this._credentials=new gf):(this._app=e,this._databaseId=function(e){if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new kr(e.options.projectId);throw new Pr(Lr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')}(e),this._credentials=new vf(t))}var Af,Nf=(n(Rf,Af=Df),Rf.prototype._terminate=function(){return this._firestoreClient||Bp(this),this._firestoreClient.terminate()},Rf);function Rf(e,t){t=Af.call(this,e,t)||this;return t._queue=new qc,t._persistenceKey="name"in e?e.name:"[DEFAULT]",t}function Of(e){return function(t){var e=this,n=new Mu;return t.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,Mh(t)];case 1:return[2,Tl(e.sent(),n)]}})})}),n.promise}(qp(e=Jh(e,Nf)))}var Lf=function(e){this._methodName=e};var Pf,Mf=(n(xf,Pf=Lf),xf.prototype._toFieldTransform=function(e){if(2!==e.dataSource)throw 1===e.dataSource?(Gr(0<e.path.length,this._methodName+"() at the top level should have already been handled."),e.createError(this._methodName+"() can only appear at the top level of your update data")):e.createError(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null},xf.prototype.isEqual=function(e){return e instanceof xf},xf);function xf(){return null!==Pf&&Pf.apply(this,arguments)||this}function Ff(e,t,n){return new id({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Vf,qf=(n(Bf,Vf=Lf),Bf.prototype._toFieldTransform=function(e){return new Ms(e.path,new vs)},Bf.prototype.isEqual=function(e){return e instanceof Bf},Bf);function Bf(){return null!==Vf&&Vf.apply(this,arguments)||this}var Uf,jf=(n(Kf,Uf=Lf),Kf.prototype._toFieldTransform=function(e){var t=Ff(this,e,!0),n=this._elements.map(function(e){return fd(e,t)}),n=new Ts(n);return new Ms(e.path,n)},Kf.prototype.isEqual=function(e){return this===e},Kf);function Kf(e,t){e=Uf.call(this,e)||this;return e._elements=t,e}var zf,Gf=(n(Qf,zf=Lf),Qf.prototype._toFieldTransform=function(e){var t=Ff(this,e,!0),n=this._elements.map(function(e){return fd(e,t)}),n=new Ss(n);return new Ms(e.path,n)},Qf.prototype.isEqual=function(e){return this===e},Qf);function Qf(e,t){e=zf.call(this,e)||this;return e._elements=t,e}var Wf,Hf=(n(Yf,Wf=Lf),Yf.prototype._toFieldTransform=function(e){var t=new As(e.serializer,Ka(e.serializer,this._operand));return new Ms(e.path,t)},Yf.prototype.isEqual=function(e){return this===e},Yf);function Yf(e,t){e=Wf.call(this,e)||this;return e._operand=t,e}var Xf=(Jf.prototype.isEqual=function(e){return this._internalPath.isEqual(e._internalPath)},Jf);function Jf(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0;n<e.length;++n)if(0===e[n].length)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pi(e)}var $f=/^__.*__$/,Zf=(ed.prototype.toMutations=function(e,t){var n=[];return null!==this.fieldMask?n.push(new Js(e,this.data,this.fieldMask,t)):n.push(new Hs(e,this.data,t)),0<this.fieldTransforms.length&&n.push(new tu(e,this.fieldTransforms)),n},ed);function ed(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}var td=(nd.prototype.toMutations=function(e,t){t=[new Js(e,this.data,this.fieldMask,t)];return 0<this.fieldTransforms.length&&t.push(new tu(e,this.fieldTransforms)),t},nd);function nd(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}function rd(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Kr("Unexpected case for UserDataSource: "+e)}}var id=(Object.defineProperty(od.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(od.prototype,"dataSource",{get:function(){return this.settings.dataSource},enumerable:!1,configurable:!0}),od.prototype.contextWith=function(e){return new od(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},od.prototype.childContextForField=function(e){var t=null===(t=this.path)||void 0===t?void 0:t.child(e),t=this.contextWith({path:t,arrayElement:!1});return t.validatePathSegment(e),t},od.prototype.childContextForFieldPath=function(e){var t,e=null===(t=this.path)||void 0===t?void 0:t.child(e),e=this.contextWith({path:e,arrayElement:!1});return e.validatePath(),e},od.prototype.childContextForArray=function(e){return this.contextWith({path:void 0,arrayElement:!0})},od.prototype.createError=function(e){return wd(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)},od.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},od.prototype.validatePath=function(){if(this.path)for(var e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))},od.prototype.validatePathSegment=function(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(rd(this.dataSource)&&$f.test(e))throw this.createError('Document fields cannot begin and end with "__"')},od);function od(e,t,n,r,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=o||[]}var ad=(sd.prototype.createContext=function(e,t,n,r){return void 0===r&&(r=!1),new id({dataSource:e,methodName:t,targetDoc:n,path:pi.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)},sd);function sd(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||yh(e)}function ud(e,t,n,r,i,o){void 0===o&&(o={});var a=e.createContext(o.merge||o.mergeFields?2:0,t,n,i);yd("Data must be an object, but it was:",a,r);var s,u,r=dd(r,a);if(o.merge)s=new Ls(a.fieldMask),u=a.fieldTransforms;else if(o.mergeFields){for(var c=[],l=0,h=o.mergeFields;l<h.length;l++){var f=gd(t,h[l],n);if(!a.contains(f))throw new Pr(Lr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");bd(c,f)||c.push(f)}s=new Ls(c),u=a.fieldTransforms.filter(function(e){return s.covers(e.field)})}else s=null,u=a.fieldTransforms;return new Zf(new ga(r),s,u)}function cd(e,r,i,t){var o=e.createContext(1,r,i);yd("Data must be an object, but it was:",o,t);var a=[],s=new va;ti(t,function(e,t){var n=vd(r,e,i);t instanceof of&&(t=t._delegate);e=o.childContextForFieldPath(n);t instanceof Mf?a.push(n):null!=(e=fd(t,e))&&(a.push(n),s.set(n,e))});t=new Ls(a);return new td(s.build(),t,o.fieldTransforms)}function ld(e,t,n,r,i,o){var a=e.createContext(1,t,n),s=[gd(t,r,n)],u=[i];if(o.length%2!=0)throw new Pr(Lr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)s.push(gd(t,o[c])),u.push(o[c+1]);for(var l,h,f,d=[],p=new va,c=s.length-1;0<=c;--c){bd(d,s[c])||(l=s[c],(h=u[c])instanceof of&&(h=h._delegate),f=a.childContextForFieldPath(l),h instanceof Mf?d.push(l):null!=(f=fd(h,f))&&(d.push(l),p.set(l,f)))}i=new Ls(d);return new td(p.build(),i,a.fieldTransforms)}function hd(e,t,n,r){void 0===r&&(r=!1);t=e.createContext(r?4:3,t),n=fd(n,t);return Gr(null!=n,"Parsed data should not be null."),Gr(0===t.fieldTransforms.length,"Field transforms should have been disallowed."),n}function fd(e,t){if(e instanceof of&&(e=e._delegate),pd(e))return yd("Unsupported field value:",t,e),dd(e,t);if(e instanceof Lf)return function(e,t){if(!rd(t.dataSource))throw t.createError(e._methodName+"() can only be used with update() and set()");if(!t.path)throw t.createError(e._methodName+"() is not currently supported inside arrays");e=e._toFieldTransform(t);e&&t.fieldTransforms.push(e)}(e,t),null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return function(e,t){for(var n=[],r=0,i=0,o=e;i<o.length;i++){var a=fd(o[i],t.childContextForArray(r));null==a&&(a={nullValue:"NULL_VALUE"}),n.push(a),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){e instanceof of&&(e=e._delegate);{if(null===e)return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Ka(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=$r.fromDate(e);return{timestampValue:za(t.serializer,n)}}if(e instanceof $r){n=new $r(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:za(t.serializer,n)}}if(e instanceof ef)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof nf)return{bytesValue:Ga(t.serializer,e._byteString)};if(e instanceof kd){var r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError("Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+r.projectId+"/"+r.database);return{referenceValue:Wa(e.firestore._databaseId||t.databaseId,e._key.path)}}if(void 0===e&&t.ignoreUndefinedProperties)return null;throw t.createError("Unsupported field value: "+Xh(e))}}(e,t)}function dd(e,n){var r={};return ni(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):ti(e,function(e,t){t=fd(t,n.childContextForField(e));null!=t&&(r[e]=t)}),{mapValue:{fields:r}}}function pd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof $r||e instanceof ef||e instanceof nf||e instanceof kd||e instanceof Lf)}function yd(e,t,n){if(!pd(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=Xh(n);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}var r}function gd(e,t,n){if(t instanceof of&&(t=t._delegate),t instanceof Xf)return t._internalPath;if("string"==typeof t)return vd(e,t);throw wd("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var md=new RegExp("[~\\*/\\[\\]]");function vd(t,n,r){if(0<=n.search(md))throw wd("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,r);try{return(new(Xf.bind.apply(Xf,a([void 0],n.split(".")))))._internalPath}catch(e){throw wd("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,r)}}function wd(e,t,n,r,i){var o=r&&!r.isEmpty(),a=void 0!==i,t="Function "+t+"() called with invalid data";n&&(t+=" (via `toFirestore()`)"),t+=". ";n="";return(o||a)&&(n+=" (found",o&&(n+=" in field "+r),a&&(n+=" in document "+i),n+=")"),new Pr(Lr.INVALID_ARGUMENT,t+e+n)}function bd(e,t){return e.some(function(e){return e.isEqual(t)})}var Td,Ed=(n(_d,Td=Et),_d.prototype.convertBytes=function(e){return new nf(e)},_d.prototype.convertReference=function(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new kd(this.firestore,null,e)},_d);function _d(e){var t=Td.call(this)||this;return t.firestore=e,t}function Id(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=Jh(e,kd);var o=Jh(e.firestore,Nf),a=lp(o);return t instanceof of&&(t=t._delegate),Cd(o,("string"==typeof t||t instanceof Xf?ld(a,"updateDoc",e._key,t,n,r):cd(a,"updateDoc",e._key,t)).toMutations(e._key,Vs.exists(!0)))}function Sd(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];t instanceof of&&(t=t._delegate);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||Zh(n[i])||(r=n[i],i++);var o,a,s,u,c,l,h={includeMetadataChanges:r.includeMetadataChanges};return Zh(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),t instanceof kd?(s=Jh(t.firestore,Nf),u=oo(t._key.path),l={next:function(e){n[i]&&n[i](Dd(s,t,e))},error:n[i+1],complete:n[i+2]}):(a=Jh(t,Nd),s=Jh(a.firestore,Nf),u=a._query,c=new Ed(s),l={next:function(e){n[i]&&n[i](new _p(s,c,a,e))},error:n[i+1],complete:n[i+2]},$d(t._query)),function(t,e,n,r){var i=this,o=new bh(r),a=new el(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return f(i,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,xh(t)];case 1:return[2,Jc(e.sent(),a)]}})})}),function(){o.mute(),t.asyncQueue.enqueueAndForget(function(){return f(i,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,xh(t)];case 1:return[2,$c(e.sent(),a)]}})})})}}(qp(s),u,h,l)}function Cd(e,t){return function(t,n){var e=this,r=new Mu;return t.asyncQueue.enqueueAndForget(function(){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,Mh(t)];case 1:return[2,vl(e.sent(),n,r)]}})})}),r.promise}(qp(e),t)}function Dd(e,t,n){Gr(n.docs.size<=1,"Expected zero or a single result on a document-only query");var r=n.docs.get(t._key),i=new Ed(e);return new vp(e,i,t._key,r,new Zp(n.hasPendingWrites,n.fromCache),t._converter)}var kd=(Object.defineProperty(Ad.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"parent",{get:function(){return new ep(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),Ad.prototype.withConverter=function(e){return new Ad(this.firestore,e,this._key)},Ad);function Ad(e,t,n){this._converter=t,this._key=n,this.type="document",this.firestore=e}var Nd=(Rd.prototype.withConverter=function(e){return new Rd(this.firestore,e,this._query)},Rd);function Rd(e,t,n){this._converter=t,this._query=n,this.type="query",this.firestore=e}_t=function(){};function Od(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){e=i[r]._apply(e)}return e}var Ld,Pd=(n(Md,Ld=_t),Md.prototype._apply=function(e){var t=lp(e.firestore),t=function(e,t,n,r,i,o,a){if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Xd(a,o);for(var s=[],u=0,c=a;u<c.length;u++){var l=c[u];s.push(Yd(r,e,l))}h={arrayValue:{values:s}}}else h=Yd(r,e,a)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Xd(a,o),h=hd(n,t,a,"in"===o||"not-in"===o);var h=Eo.create(i,o,h);return function(e,t){if(Gr(t instanceof Eo,"Only FieldFilters are supported"),t.isInequality()){var n=co(e);if(null!==n&&!n.isEqual(t.field))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+t.field.toString()+"'");n=uo(e);null!==n&&Jd(0,t.field,n)}e=function(e,t){for(var n=0,r=e.filters;n<r.length;n++){var i=r[n];if(Gr(i instanceof Eo,"Only FieldFilters are supported"),0<=t.indexOf(i.op))return i.op}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==e)throw e===t.op?new Pr(Lr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Pr(Lr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+e.toString()+"' filters.")}(e,h),h}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return new Nd(e.firestore,e._converter,(e=e._query,t=t,Gr(null==co(e)||!(t instanceof Eo)||!t.isInequality()||t.field.isEqual(co(e)),"Query must only have one inequality field."),Gr(!lo(e),"No filtering allowed for document query"),t=e.filters.concat([t]),new io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))},Md);function Md(e,t,n){var r=Ld.call(this)||this;return r._field=e,r._op=t,r._value=n,r.type="where",r}var xd,Fd=(n(Vd,xd=_t),Vd.prototype._apply=function(e){var t=function(e,t,n){if(null!==e.startAt)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");n=new Xo(t,n);return function(e,t){{var n;null!==uo(e)||null!==(n=co(e))&&Jd(0,n,t.field)}}(e,n),n}(e._query,this._field,this._direction);return new Nd(e.firestore,e._converter,(e=e._query,t=t,Gr(!e.startAt&&!e.endAt,"Bounds must be set after orderBy"),t=e.explicitOrderBy.concat([t]),new io(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},Vd);function Vd(e,t){var n=xd.call(this)||this;return n._field=e,n._direction=t,n.type="orderBy",n}var qd,Bd=(n(Ud,qd=_t),Ud.prototype._apply=function(e){return new Nd(e.firestore,e._converter,yo(e._query,this._limit,this._limitType))},Ud);function Ud(e,t,n){var r=qd.call(this)||this;return r.type=e,r._limit=t,r._limitType=n,r}var jd,Kd=(n(zd,jd=_t),zd.prototype._apply=function(e){var t=Hd(e,this.type,this._docOrFields,this._before);return new Nd(e.firestore,e._converter,(e=e._query,t=t,new io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))},zd);function zd(e,t,n){var r=jd.call(this)||this;return r.type=e,r._docOrFields=t,r._before=n,r}var Gd,Qd=(n(Wd,Gd=_t),Wd.prototype._apply=function(e){var t=Hd(e,this.type,this._docOrFields,this._before);return new Nd(e.firestore,e._converter,(e=e._query,t=t,new io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))},Wd);function Wd(e,t,n){var r=Gd.call(this)||this;return r.type=e,r._docOrFields=t,r._before=n,r}function Hd(e,t,n,r){if(n[0]instanceof of&&(n[0]=n[0]._delegate),n[0]instanceof hp)return function(e,t,n,r,i){if(!r)throw new Pr(Lr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],a=0,s=fo(e);a<s.length;a++){var u=s[a];if(u.field.isKeyField())o.push(Mi(t,r.key));else{var c=r.field(u.field);if(Ei(c))throw new Pr(Lr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){u=u.field.canonicalString();throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Qo(o,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=lp(e.firestore);return function(e,t,n,r,i,o){var a=e.explicitOrderBy;if(i.length>a.length)throw new Pr(Lr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],u=0;u<i.length;u++){var c=i[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!ho(e)&&-1!==c.indexOf("/"))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var l=e.path.child(li.fromString(c));if(!gi.isDocumentKey(l))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+l+"' is not because it contains an odd number of segments.");l=new gi(l);s.push(Mi(t,l))}else{c=hd(n,r,c);s.push(c)}}return new Qo(s,o)}(e._query,e.firestore._databaseId,i,t,n,r)}function Yd(e,t,n){if(n instanceof of&&(n=n._delegate),"string"==typeof n){if(""===n)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ho(t)&&-1!==n.indexOf("/"))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");t=t.path.child(li.fromString(n));if(!gi.isDocumentKey(t))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+t+"' is not because it has an odd number of segments ("+t.length+").");return Mi(e,new gi(t))}if(n instanceof kd)return Mi(e,n._key);throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Xh(n)+".")}function Xd(e,t){if(!Array.isArray(e)||0===e.length)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(10<e.length)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function Jd(e,t,n){if(!n.isEqual(t))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function $d(e){if(so(e)&&0===e.explicitOrderBy.length)throw new Pr(Lr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Zd,ep=(n(tp,Zd=Nd),Object.defineProperty(tp.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(tp.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(tp.prototype,"parent",{get:function(){var e=this._path.popLast();return e.isEmpty()?null:new kd(this.firestore,null,new gi(e))},enumerable:!1,configurable:!0}),tp.prototype.withConverter=function(e){return new tp(this.firestore,e,this._path)},tp);function tp(e,t,n){t=Zd.call(this,e,t,oo(n))||this;return t.firestore=e,t._path=n,t.type="collection",t}function np(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e instanceof of&&(e=e._delegate),Gh("collection","path",t),e instanceof Df)return Yh(n=li.fromString.apply(li,a([t],r))),new ep(e,null,n);if(!(e instanceof kd||e instanceof ep))throw new Pr(Lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Yh(n=li.fromString.apply(li,a([e.path],r)).child(li.fromString(t))),new ep(e.firestore,null,n)}function rp(e,t){if(e=Jh(e,Df),Gh("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new Pr(Lr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Nd(e,null,(t=t,new io(li.emptyPath(),t)))}function ip(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e instanceof of&&(e=e._delegate),1===arguments.length&&(t=Wr.newId()),Gh("doc","path",t),e instanceof Df)return Hh(n=li.fromString.apply(li,a([t],r))),new kd(e,null,new gi(n));if(!(e instanceof kd||e instanceof ep))throw new Pr(Lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Hh(n=e._path.child(li.fromString.apply(li,a([t],r)))),new kd(e.firestore,e instanceof ep?e._converter:null,new gi(n))}var op,ap=(n(sp,op=Et),sp.prototype.convertBytes=function(e){return new nf(e)},sp.prototype.convertReference=function(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new kd(this.firestore,null,e)},sp);function sp(e){var t=op.call(this)||this;return t.firestore=e,t}function up(e,t){return e instanceof of&&(e=e._delegate),t instanceof of&&(t=t._delegate),(e instanceof kd||e instanceof ep)&&(t instanceof kd||t instanceof ep)&&(e.firestore===t.firestore&&e.path===t.path&&e._converter===t._converter)}function cp(e,t){return e instanceof of&&(e=e._delegate),t instanceof of&&(t=t._delegate),e instanceof Nd&&t instanceof Nd&&(e.firestore===t.firestore&&go(e._query,t._query)&&e._converter===t._converter)}function lp(e){var t=e._freezeSettings(),n=yh(e._databaseId);return new ad(e._databaseId,!!t.ignoreUndefinedProperties,n)}var hp=(Object.defineProperty(fp.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(fp.prototype,"ref",{get:function(){return new kd(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),fp.prototype.exists=function(){return null!==this._document},fp.prototype.data=function(){if(this._document){if(this._converter){var e=new pp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.toProto())}},fp.prototype.get=function(e){if(this._document){e=this._document.data().field(gp("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}},fp);function fp(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}var dp,pp=(n(yp,dp=hp),yp.prototype.data=function(){return dp.prototype.data.call(this)},yp);function yp(){return null!==dp&&dp.apply(this,arguments)||this}function gp(e,t){return"string"==typeof t?vd(e,t):(t instanceof of?t._delegate:t)._internalPath}var mp,vp=(n(wp,mp=hp),wp.prototype.exists=function(){return mp.prototype.exists.call(this)},wp.prototype.data=function(e){if(void 0===e&&(e={}),this._document){if(this._converter){var t=new Tp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.toProto(),e.serverTimestamps)}},wp.prototype.get=function(e,t){if(void 0===t&&(t={}),this._document){e=this._document.data().field(gp("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}},wp);function wp(e,t,n,r,i,o){o=mp.call(this,e,t,n,r,o)||this;return o._firestore=e,o._firestoreImpl=e,o.metadata=i,o}var bp,Tp=(n(Ep,bp=vp),Ep.prototype.data=function(e){return void 0===e&&(e={}),bp.prototype.data.call(this,e)},Ep);function Ep(){return null!==bp&&bp.apply(this,arguments)||this}var _p=(Object.defineProperty(Ip.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(Ip.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Ip.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Ip.prototype.forEach=function(t,n){var r=this;this._snapshot.docs.forEach(function(e){t.call(n,new Tp(r._firestore,r._userDataWriter,e.key,e,new Zp(r._snapshot.mutatedKeys.has(e.key),r._snapshot.fromCache),r.query._converter))})},Ip.prototype.docChanges=function(e){void 0===e&&(e={});e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Pr(Lr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,t){{if(i._snapshot.oldDocs.isEmpty()){var n,r=0;return i._snapshot.docChanges.map(function(e){Gr(0===e.type,"Invalid event type for first snapshot"),Gr(!n||bo(i._snapshot.query)(n,e.doc)<0,"Got added events in wrong order");var t=new Tp(i._firestore,i._userDataWriter,e.doc.key,e.doc,new Zp(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query._converter);return n=e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:r++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(e){var t=new Tp(i._firestore,i._userDataWriter,e.doc.key,e.doc,new Zp(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query._converter),n=-1,r=-1;return 0!==e.type&&(Gr(0<=(n=o.indexOf(e.doc.key)),"Index for document not found"),o=o.delete(e.doc.key)),1!==e.type&&(r=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kr("Unknown change type: "+e)}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},Ip);function Ip(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Zp(r.hasPendingWrites,r.fromCache),this.query=n}function Sp(e,t){return e instanceof vp&&t instanceof vp?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof _p&&t instanceof _p&&(e._firestore===t._firestore&&cp(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot))}var Cp=(Dp.prototype.set=function(e,t,n){this._verifyNotCommitted();e=kp(e,this._firestore),t=by(e._converter,t,n),n=ud(this._dataReader,"WriteBatch.set",e._key,t,null!==e._converter,n);return this._mutations=this._mutations.concat(n.toMutations(e._key,Vs.none())),this},Dp.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();e=kp(e,this._firestore);return t instanceof of&&(t=t._delegate),t="string"==typeof t||t instanceof Xf?ld(this._dataReader,"WriteBatch.update",e._key,t,n,r):cd(this._dataReader,"WriteBatch.update",e._key,t),this._mutations=this._mutations.concat(t.toMutations(e._key,Vs.exists(!0))),this},Dp.prototype.delete=function(e){this._verifyNotCommitted();e=kp(e,this._firestore);return this._mutations=this._mutations.concat(new au(e._key,Vs.none())),this},Dp.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},Dp.prototype._verifyNotCommitted=function(){if(this._committed)throw new Pr(Lr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Dp);function Dp(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=lp(e)}function kp(e,t){if(e instanceof of&&(e=e._delegate),e.firestore!==t)throw new Pr(Lr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}Ap.prototype.get=function(e){var t=this,n=kp(e,this._firestore),r=new ap(this._firestore);return this._transaction.lookup([n._key]).then(function(e){if(!e||1!==e.length)return Kr("Mismatch in docs returned from document lookup.");e=e[0];if(e instanceof Wi)return new hp(t._firestore,r,n._key,null,n._converter);if(e instanceof zi)return new hp(t._firestore,r,e.key,e,n._converter);throw Kr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},Ap.prototype.set=function(e,t,n){e=kp(e,this._firestore),t=by(e._converter,t,n),n=ud(this._dataReader,"Transaction.set",e._key,t,null!==e._converter,n);return this._transaction.set(e._key,n),this},Ap.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=kp(e,this._firestore);return t instanceof of&&(t=t._delegate),t="string"==typeof t||t instanceof Xf?ld(this._dataReader,"Transaction.update",e._key,t,n,r):cd(this._dataReader,"Transaction.update",e._key,t),this._transaction.update(e._key,t),this},Ap.prototype.delete=function(e){e=kp(e,this._firestore);return this._transaction.delete(e._key),this},_t=Ap;function Ap(e,t){this._firestore=e,this._transaction=t,this._dataReader=lp(e)}var Np,Rp=(n(Op,Np=_t),Op.prototype.get=function(e){var t=this,n=kp(e,this._firestore),r=new Ed(this._firestore);return Np.prototype.get.call(this,e).then(function(e){return new vp(t._firestore,r,n._key,e._document,new Zp(!1,!1),n._converter)})},Op);function Op(e,t){t=Np.call(this,e,t)||this;return t._firestore=e,t}var Lp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Pp=(Mp.prototype.enableIndexedDbPersistence=function(e,t){throw new Pr(Lr.FAILED_PRECONDITION,Lp)},Mp.prototype.enableMultiTabIndexedDbPersistence=function(e){throw new Pr(Lr.FAILED_PRECONDITION,Lp)},Mp.prototype.clearIndexedDbPersistence=function(e){throw new Pr(Lr.FAILED_PRECONDITION,Lp)},Mp);function Mp(){}var xp,Fp=(n(Vp,xp=of),Object.defineProperty(Vp.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),Vp.prototype.settings=function(e){e.merge&&delete(e=Object.assign(Object.assign({},this._delegate._getSettings()),e)).merge,this._delegate._setSettings(e)},Vp.prototype.useEmulator=function(e,t){"firestore.googleapis.com"!==this._delegate._getSettings().host&&Ur("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:e+":"+t,ssl:!1,merge:!0})},Vp.prototype.enableNetwork=function(){return Fh(qp(Jh(this._delegate,Nf)))},Vp.prototype.disableNetwork=function(){return Vh(qp(Jh(this._delegate,Nf)))},Vp.prototype.enablePersistence=function(e){var t=!1,n=!1;return e&&Wh("synchronizeTabs",t=!!e.synchronizeTabs,"experimentalForceOwningTab",n=!!e.experimentalForceOwningTab),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)},Vp.prototype.clearPersistence=function(){return this._persistenceProvider.clearIndexedDbPersistence(this)},Vp.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._delegate._delete()},Vp.prototype.waitForPendingWrites=function(){return Of(this._delegate)},Vp.prototype.onSnapshotsInSync=function(e){return t=this._delegate,e=e,Kh(qp(t=Jh(t,Nf)),Zh(e)?e:{next:e});var t},Object.defineProperty(Vp.prototype,"app",{get:function(){if(!this._appCompat)throw new Pr(Lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat},enumerable:!1,configurable:!0}),Vp.prototype.collection=function(e){try{return new my(this,np(this._delegate,e))}catch(e){throw Xp(e,"collection()","Firestore.collection()")}},Vp.prototype.doc=function(e){try{return new Hp(this,ip(this._delegate,e))}catch(e){throw Xp(e,"doc()","Firestore.doc()")}},Vp.prototype.collectionGroup=function(e){try{return new uy(this,rp(this._delegate,e))}catch(e){throw Xp(e,"collectionGroup()","Firestore.collectionGroup()")}},Vp.prototype.runTransaction=function(t){var n,r,i=this;return n=this._delegate,r=function(e){return t(new jp(i,e))},zh(qp(n),function(e){return r(new Rp(n,e))})},Vp.prototype.batch=function(){var t=this;return qp(this._delegate),new Gp(new Cp(this._delegate,function(e){return Cd(t._delegate,e)}))},Vp);function Vp(e,t,n){var r=xp.call(this,t)||this;return r._persistenceProvider=n,r.INTERNAL={delete:function(){return r.terminate()}},e instanceof kr||(r._appCompat=e),r}function qp(e){return e._firestoreClient||Bp(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Bp(e){var t=e._freezeSettings();Gr(!!t.host,"FirestoreSettings.host is not set"),Gr(!e._firestoreClient,"configureFirestore() called multiple times");var n,r,t=(n=e._databaseId,r=e._persistenceKey,new Cr(n,r,(t=t).host,t.ssl,t.experimentalForceLongPolling,t.experimentalAutoDetectLongPolling));e._firestoreClient=new Dh(e._credentials,e._queue,t)}var Up,jp=(n(Kp,Up=of),Kp.prototype.get=function(e){var t=this,e=wy(e);return this._delegate.get(e).then(function(e){return new ny(t._firestore,e)})},Kp.prototype.set=function(e,t,n){e=wy(e);return n?(Qh("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this},Kp.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=wy(e);return 2===arguments.length?this._delegate.update(o,t):(e=this._delegate).update.apply(e,a([o,t,n],r)),this},Kp.prototype.delete=function(e){e=wy(e);return this._delegate.delete(e),this},Kp);function Kp(e,t){t=Up.call(this,t)||this;return t._firestore=e,t}var zp,Gp=(n(Qp,zp=of),Qp.prototype.set=function(e,t,n){e=wy(e);return n?(Qh("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this},Qp.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=wy(e);return 2===arguments.length?this._delegate.update(o,t):(e=this._delegate).update.apply(e,a([o,t,n],r)),this},Qp.prototype.delete=function(e){e=wy(e);return this._delegate.delete(e),this},Qp.prototype.commit=function(){return this._delegate.commit()},Qp);function Qp(){return null!==zp&&zp.apply(this,arguments)||this}var Wp,Hp=(n(Yp,Wp=of),Yp.forPath=function(e,t,n){if(e.length%2!=0)throw new Pr(Lr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new Yp(t,new kd(t._delegate,n,new gi(e)))},Yp.forKey=function(e,t,n){return new Yp(t,new kd(t._delegate,n,e))},Object.defineProperty(Yp.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Yp.prototype,"parent",{get:function(){return new my(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Yp.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Yp.prototype.collection=function(e){try{return new my(this.firestore,np(this._delegate,e))}catch(e){throw Xp(e,"collection()","DocumentReference.collection()")}},Yp.prototype.isEqual=function(e){return e instanceof of&&(e=e._delegate),e instanceof kd&&up(this._delegate,e)},Yp.prototype.set=function(e,t){t=Qh("DocumentReference.set",t);try{return function(e,t,n){e=Jh(e,kd);var r=Jh(e.firestore,Nf),t=by(e._converter,t,n);return Cd(r,ud(lp(r),"setDoc",e._key,t,null!==e._converter,n).toMutations(e._key,Vs.none()))}(this._delegate,e,t)}catch(e){throw Xp(e,"setDoc()","DocumentReference.set()")}},Yp.prototype.update=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Id(this._delegate,e):Id.apply(void 0,a([this._delegate,e,t],n))}catch(e){throw Xp(e,"updateDoc()","DocumentReference.update()")}},Yp.prototype.delete=function(){return Cd(Jh((e=this._delegate).firestore,Nf),[new au(e._key,Vs.none())]);var e},Yp.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Jp(e),i=$p(e,function(e){return new ny(t.firestore,new vp(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))});return Sd(this._delegate,r,i)},Yp.prototype.get=function(e){var t=this,e=("cache"===(null==e?void 0:e.source)?function(t){t=Jh(t,kd);var n=Jh(t.firestore,Nf),e=qp(n),r=new Ed(n);return qh(e,t._key).then(function(e){return new vp(n,r,t._key,e,new Zp(e instanceof zi&&e.hasLocalMutations,!0),t._converter)})}:"server"===(null==e?void 0:e.source)?function(t){t=Jh(t,kd);var n=Jh(t.firestore,Nf);return Bh(qp(n),t._key,{source:"server"}).then(function(e){return Dd(n,t,e)})}:function(t){t=Jh(t,kd);var n=Jh(t.firestore,Nf);return Bh(qp(n),t._key).then(function(e){return Dd(n,t,e)})})(this._delegate);return e.then(function(e){return new ny(t.firestore,new vp(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))})},Yp.prototype.withConverter=function(e){return new Yp(this.firestore,this._delegate.withConverter(e))},Yp);function Yp(e,t){t=Wp.call(this,t)||this;return t.firestore=e,t._userDataWriter=new df(e),t}function Xp(e,t,n){return e.message=e.message.replace(t,n),e}function Jp(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if("object"==typeof r&&!Zh(r))return r}return{}}function $p(e,t){var n=Zh(e[0])?e[0]:Zh(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]};return{next:function(e){n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}var Zp=(ey.prototype.isEqual=function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache},ey);function ey(e,t){this.hasPendingWrites=e,this.fromCache=t}var ty,ny=(n(ry,ty=of),Object.defineProperty(ry.prototype,"ref",{get:function(){return new Hp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(ry.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(ry.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(ry.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),ry.prototype.data=function(e){return this._delegate.data(e)},ry.prototype.get=function(e,t){return this._delegate.get(e,t)},ry.prototype.isEqual=function(e){return Sp(this._delegate,e._delegate)},ry);function ry(e,t){t=ty.call(this,t)||this;return t._firestore=e,t}var iy,oy=(n(ay,iy=ny),ay.prototype.data=function(e){e=this._delegate.data(e);return Gr(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},ay);function ay(){return null!==iy&&iy.apply(this,arguments)||this}var sy,uy=(n(cy,sy=of),cy.prototype.where=function(e,t,n){try{return new cy(this.firestore,Od(this._delegate,(i=t,o=n,r=gp("where",r=e),new Pd(r,i,o))))}catch(e){throw Xp(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},cy.prototype.orderBy=function(e,t){try{return new cy(this.firestore,Od(this._delegate,(void 0===(r=t)&&(r="asc"),n=gp("orderBy",n=e),new Fd(n,r))))}catch(e){throw Xp(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},cy.prototype.limit=function(e){try{return new cy(this.firestore,Od(this._delegate,($h("limit",t=e),new Bd("limit",t,"F"))))}catch(e){throw Xp(e,"limit()","Query.limit()")}var t},cy.prototype.limitToLast=function(e){try{return new cy(this.firestore,Od(this._delegate,($h("limitToLast",t=e),new Bd("limitToLast",t,"L"))))}catch(e){throw Xp(e,"limitToLast()","Query.limitToLast()")}var t},cy.prototype.startAt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new cy(this.firestore,Od(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Kd("startAt",e,!0)}.apply(void 0,e)))}catch(e){throw Xp(e,"startAt()","Query.startAt()")}},cy.prototype.startAfter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new cy(this.firestore,Od(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Kd("startAfter",e,!1)}.apply(void 0,e)))}catch(e){throw Xp(e,"startAfter()","Query.startAfter()")}},cy.prototype.endBefore=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new cy(this.firestore,Od(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Qd("endBefore",e,!0)}.apply(void 0,e)))}catch(e){throw Xp(e,"endBefore()","Query.endBefore()")}},cy.prototype.endAt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new cy(this.firestore,Od(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Qd("endAt",e,!1)}.apply(void 0,e)))}catch(e){throw Xp(e,"endAt()","Query.endAt()")}},cy.prototype.isEqual=function(e){return cp(this._delegate,e._delegate)},cy.prototype.get=function(e){var t=this,e=("cache"===(null==e?void 0:e.source)?function(t){t=Jh(t,Nd);var n=Jh(t.firestore,Nf),e=qp(n),r=new Ed(n);return Uh(e,t._query).then(function(e){return new _p(n,r,t,e)})}:"server"===(null==e?void 0:e.source)?function(t){t=Jh(t,Nd);var n=Jh(t.firestore,Nf),e=qp(n),r=new Ed(n);return jh(e,t._query,{source:"server"}).then(function(e){return new _p(n,r,t,e)})}:function(t){t=Jh(t,Nd);var n=Jh(t.firestore,Nf),e=qp(n),r=new Ed(n);return $d(t._query),jh(e,t._query).then(function(e){return new _p(n,r,t,e)})})(this._delegate);return e.then(function(e){return new py(t.firestore,new _p(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))})},cy.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Jp(e),i=$p(e,function(e){return new py(t.firestore,new _p(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Sd(this._delegate,r,i)},cy.prototype.withConverter=function(e){return new cy(this.firestore,this._delegate.withConverter(e))},cy);function cy(e,t){t=sy.call(this,t)||this;return t.firestore=e,t._userDataWriter=new df(e),t}var ly,hy=(n(fy,ly=of),Object.defineProperty(fy.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(fy.prototype,"doc",{get:function(){return new oy(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(fy.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(fy.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),fy);function fy(e,t){t=ly.call(this,t)||this;return t._firestore=e,t}var dy,py=(n(yy,dy=of),Object.defineProperty(yy.prototype,"query",{get:function(){return new uy(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new oy(t._firestore,e)})},enumerable:!1,configurable:!0}),yy.prototype.docChanges=function(e){var t=this;return this._delegate.docChanges(e).map(function(e){return new hy(t._firestore,e)})},yy.prototype.forEach=function(t,n){var r=this;this._delegate.forEach(function(e){t.call(n,new oy(r._firestore,e))})},yy.prototype.isEqual=function(e){return Sp(this._delegate,e._delegate)},yy);function yy(e,t){t=dy.call(this,t)||this;return t._firestore=e,t}var gy,my=(n(vy,gy=uy),Object.defineProperty(vy.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(vy.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(vy.prototype,"parent",{get:function(){var e=this._delegate.parent;return e?new Hp(this.firestore,e):null},enumerable:!1,configurable:!0}),vy.prototype.doc=function(e){try{return new Hp(this.firestore,void 0===e?ip(this._delegate):ip(this._delegate,e))}catch(e){throw Xp(e,"doc()","CollectionReference.doc()")}},vy.prototype.add=function(e){var t,n,r,i=this;return t=this._delegate,n=e,e=Jh(t.firestore,Nf),r=ip(t),n=by(t._converter,n),Cd(e,ud(lp(t.firestore),"addDoc",r._key,n,null!==t._converter,{}).toMutations(r._key,Vs.exists(!1))).then(function(){return r}).then(function(e){return new Hp(i.firestore,e)})},vy.prototype.isEqual=function(e){return up(this._delegate,e._delegate)},vy.prototype.withConverter=function(e){return new vy(this.firestore,this._delegate.withConverter(e))},vy);function vy(e,t){var n=gy.call(this,e,t)||this;return n.firestore=e,n._delegate=t,n}function wy(e){return e instanceof of&&(e=e._delegate),Jh(e,kd)}function by(e,t,n){t=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t;return t}var Ty,Et=(n(Ey,Ty=of),Ey.documentId=function(){return new Ey(pi.keyField().canonicalString())},Ey.prototype.isEqual=function(e){return e instanceof of&&(e=e._delegate),e instanceof Xf&&this._delegate._internalPath.isEqual(e._internalPath)},Ey);function Ey(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ty.call(this,new(Xf.bind.apply(Xf,a([void 0],e))))||this}var _y,_t=(n(Iy,_y=of),Iy.serverTimestamp=function(){var e=new qf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Iy(e)},Iy.delete=function(){var e=new Mf("deleteField");return e._methodName="FieldValue.delete",new Iy(e)},Iy.arrayUnion=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new jf("arrayUnion",e)}.apply(void 0,e);return n._methodName="FieldValue.arrayUnion",new Iy(n)},Iy.arrayRemove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Gf("arrayRemove",e)}.apply(void 0,e);return n._methodName="FieldValue.arrayRemove",new Iy(n)},Iy.increment=function(e){e=new Hf("increment",e);return e._methodName="FieldValue.increment",new Iy(e)},Iy.prototype.isEqual=function(e){return this._delegate.isEqual(e._delegate)},Iy);function Iy(){return null!==_y&&_y.apply(this,arguments)||this}var Sy,Cy,Dy={Firestore:Fp,GeoPoint:ef,Timestamp:$r,Blob:cf,Transaction:jp,WriteBatch:Gp,DocumentReference:Hp,DocumentSnapshot:ny,Query:uy,QueryDocumentSnapshot:oy,QuerySnapshot:py,CollectionReference:my,FieldPath:Et,FieldValue:_t,setLogLevel:function(e){e=e,Fr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};Sy=t.default,Cy=function(e,t){return new Fp(e,new Nf(e,t),new Pp)},Sy.INTERNAL.registerComponent(new Ir("firestore",function(e){var t=e.getProvider("app").getImmediate();return Cy(t,e.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Dy))),Sy.registerVersion("@firebase/firestore","2.0.4-1.0.0-eap-firestore-debug.9c6096f43")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore.memory.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.memory.js.map
