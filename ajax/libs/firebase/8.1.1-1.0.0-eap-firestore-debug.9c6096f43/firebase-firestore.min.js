!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase)}(this,function(Pg){"use strict";try{(function(){var f,e,t=(e=Pg)&&"object"==typeof e&&"default"in e?e:{default:e},r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function n(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function m(e,a,s,u){return new(s=s||Promise)(function(n,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,i)}o((u=u.apply(e,a||[])).next())})}function g(n,r){var i,o,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function a(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function s(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function i(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=c[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,s(["["+i+"]  "+e.name+":"],n))}}(gt=f=f||{})[gt.DEBUG=0]="DEBUG",gt[gt.VERBOSE=1]="VERBOSE",gt[gt.INFO=2]="INFO",gt[gt.WARN=3]="WARN",gt[gt.ERROR=4]="ERROR",gt[gt.SILENT=5]="SILENT";var o={debug:f.DEBUG,verbose:f.VERBOSE,info:f.INFO,warn:f.WARN,error:f.ERROR,silent:f.SILENT},u=f.INFO,c=((vt={})[f.DEBUG]="log",vt[f.VERBOSE]="log",vt[f.INFO]="info",vt[f.WARN]="warn",vt[f.ERROR]="error",vt),l=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in f))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),h.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?o[e]:e},Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),h.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.DEBUG],e)),this._logHandler.apply(this,s([this,f.DEBUG],e))},h.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.VERBOSE],e)),this._logHandler.apply(this,s([this,f.VERBOSE],e))},h.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.INFO],e)),this._logHandler.apply(this,s([this,f.INFO],e))},h.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.WARN],e)),this._logHandler.apply(this,s([this,f.WARN],e))},h.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.ERROR],e)),this._logHandler.apply(this,s([this,f.ERROR],e))},h);function h(e){this.name=e,this._logLevel=u,this._logHandler=i,this._userLogHandler=null}function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var p,y="FirebaseError",v=(n(b,p=Error),b);function b(e,t,n){return(t=p.call(this,t)||this).code=e,t.customData=n,t.name=y,Object.setPrototypeOf(t,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,w.prototype.create),t}var w=(T.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},o=this.service+"/"+e,e=(e=this.errors[e])?(r=i,e.replace(S,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+o+").";return new v(o,e,i)},T);function T(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var S=/\{\$([^}]+)}/g,I=function(e,t){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function E(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D=C||self;function _(){}function k(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function A(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var N="closure_uid_"+(1e9*Math.random()>>>0),x=0;function O(e,t,n){return e.call.apply(e.bind,arguments)}function R(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function L(e,t,n){return(L=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?O:R).apply(null,arguments)}function P(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function M(){return Date.now()}function q(e,o){function t(){}t.prototype=o.prototype,e.X=o.prototype,e.prototype=new t,(e.prototype.constructor=e).Kb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[t].apply(e,r)}}function F(){this.j=this.j,this.i=this.i}F.prototype.j=!1,F.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&(Object.prototype.hasOwnProperty.call(this,N)&&this[N]||(this[N]=++x))},F.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},V=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function U(){return Array.prototype.concat.apply([],arguments)}function K(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function j(e){return/^[\s\xa0]*$/.test(e)}var z=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Q(e,t){return-1!=e.indexOf(t)}function G(e,t){return e<t?-1:t<e?1:0}var W=D.navigator;function H(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function Y(e){var t,n={};for(t in e)n[t]=e[t];return n}se=(W=W&&W.userAgent)?W:"";var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(e){for(var t,n,r=1;r<arguments.length;r++){for(t in n=arguments[r])e[t]=n[t];for(var i=0;i<X.length;i++)t=X[i],Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}}function $(e){return $[" "](e),e}$[" "]=_;var Z,ee=Q(se,"Opera"),te=Q(se,"Trident")||Q(se,"MSIE"),ne=Q(se,"Edge"),re=ne||te,ie=Q(se,"Gecko")&&!(Q(se.toLowerCase(),"webkit")&&!Q(se,"Edge"))&&!(Q(se,"Trident")||Q(se,"MSIE"))&&!Q(se,"Edge"),oe=Q(se.toLowerCase(),"webkit")&&!Q(se,"Edge");function ae(){var e=D.document;return e?e.documentMode:void 0}var W="",se=(se=se,ie?/rv:([^\);]+)(\)|;)/.exec(se):ne?/Edge\/([\d\.]+)/.exec(se):te?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(se):oe?/WebKit\/(\S+)/.exec(se):ee?/(?:Version)[ \/]?(\S+)/.exec(se):void 0);se&&(W=se?se[1]:""),Z=te&&null!=(se=ae())&&se>parseFloat(W)?String(se):W;var ue={};function ce(s){return e=s,t=function(){for(var e=0,t=z(String(Z)).split("."),n=z(String(s)).split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++)for(var o=t[i]||"",a=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],(0!=o[0].length||0!=a[0].length)&&(e=G(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||G(0==o[2].length,0==a[2].length)||G(o[2],a[2]),o=o[3],a=a[3],0==e););return 0<=e},n=ue,Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t();var e,t,n}var le=D.document&&te&&(ae()||parseInt(Z,10))||void 0,he=!te||9<=Number(le),fe=te&&!ce("9"),de=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{D.addEventListener("test",_,t),D.removeEventListener("test",_,t)}catch(e){}return e}();function pe(e,t){this.type=e,this.a=this.target=t,this.defaultPrevented=!1}function ye(e,t){if(pe.call(this,e?e.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.a=t,t=e.relatedTarget){if(ie){e:{try{$(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:me[e.pointerType]||"",(this.c=e).defaultPrevented&&this.b()}}pe.prototype.b=function(){this.defaultPrevented=!0},q(ye,pe);var me={2:"touch",3:"pen",4:"mouse"};ye.prototype.b=function(){ye.X.b.call(this);var e=this.c;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,fe)try{(e.ctrlKey||112<=e.keyCode&&e.keyCode<=123)&&(e.keyCode=-1)}catch(e){}};var ge="closure_listenable_"+(1e6*Math.random()|0),ve=0;function be(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ca=i,this.key=++ve,this.Y=this.Z=!1}function we(e){e.Y=!0,e.listener=null,e.proxy=null,e.src=null,e.ca=null}function Te(e){this.src=e,this.a={},this.b=0}function Se(e,t){var n,r,i,o=t.type;o in e.a&&(n=e.a[o],(i=0<=(r=B(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(we(t),0==e.a[o].length&&(delete e.a[o],e.b--)))}function Ie(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.Y&&o.listener==t&&o.capture==!!n&&o.ca==r)return i}return-1}Te.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.a[o])||(e=this.a[o]=[],this.b++);var a=Ie(e,t,r,i);return-1<a?(t=e[a],n||(t.Z=!1)):((t=new be(t,this.src,o,!!r,i)).Z=n,e.push(t)),t};var Ee="closure_lm_"+(1e6*Math.random()|0),Ce={};function De(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,o){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,o);return null}return r=Le(r),t&&t[ge]?t.wa(n,r,A(i)?!!i.capture:!!i,o):_e(t,n,r,!0,i,o)}(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)De(e,t[o],n,r,i);return null}return n=Le(n),e&&e[ge]?e.va(t,n,A(r)?!!r.capture:!!r,i):_e(e,t,n,!1,r,i)}function _e(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=A(i)?!!i.capture:!!i;if(a&&!he)return null;var s,u,c=Oe(e);if(c||(e[Ee]=c=new Te(e)),(n=c.add(t,n,r,a,o)).proxy)return n;if(s=xe,r=u=he?function(e){return s.call(u.src,u.listener,e)}:function(e){if(!(e=s.call(u.src,u.listener,e)))return e},(n.proxy=r).src=e,r.listener=n,e.addEventListener)de||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Ae(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ke(e){var t,n,r;"number"!=typeof e&&e&&!e.Y&&((t=e.src)&&t[ge]?Se(t.c,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Ae(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Oe(t))?(Se(n,e),0==n.b&&(n.src=null,t[Ee]=null)):we(e)))}function Ae(e){return e in Ce?Ce[e]:Ce[e]="on"+e}function Ne(e,t){var n=e.listener,r=e.ca||e.src;return e.Z&&ke(e),n.call(r,t)}function xe(e,t){if(e.Y)return!0;if(he)return Ne(e,new ye(t,this));if(!t)e:{t=["window","event"];for(var n=D,r=0;r<t.length;r++)if(null==(n=n[t[r]])){t=null;break e}t=n}return Ne(e,t=new ye(t,this))}function Oe(e){return(e=e[Ee])instanceof Te?e:null}var Re="__closure_events_fn_"+(1e9*Math.random()>>>0);function Le(t){return"function"==typeof t?t:(t[Re]||(t[Re]=function(e){return t.handleEvent(e)}),t[Re])}function Pe(){F.call(this),this.c=new Te(this),(this.J=this).C=null}function Me(e,t){var n,r=e.C;if(r)for(n=[];r;r=r.C)n.push(r);if(e=e.J,r=t.type||t,"string"==typeof t?t=new pe(t,e):t instanceof pe?t.target=t.target||e:(a=t,J(t=new pe(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var o=t.a=n[i],a=qe(o,r,!0,t)&&a;if(a=qe(o=t.a=e,r,!0,t)&&a,a=qe(o,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=qe(o=t.a=n[i],r,!1,t)&&a}function qe(e,t,n,r){if(!(t=e.c.a[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var a,s,u=t[o];u&&!u.Y&&u.capture==n&&(a=u.listener,s=u.ca||u.src,u.Z&&Se(e.c,u),i=!1!==a.call(s,r)&&i)}return i&&!r.defaultPrevented}q(Pe,F),Pe.prototype[ge]=!0,(se=Pe.prototype).addEventListener=function(e,t,n,r){De(this,e,t,n,r)},se.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,o){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,o);else i=A(i)?!!i.capture:!!i,r=Le(r),t&&t[ge]?(t=t.c,(n=String(n).toString())in t.a&&-1<(r=Ie(a=t.a[n],r,i,o))&&(we(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.a[n],t.b--))):(t=t&&Oe(t))&&(n=t.a[n.toString()],t=-1,n&&(t=Ie(n,r,i,o)),(r=-1<t?n[t]:null)&&ke(r))}(this,e,t,n,r)},se.G=function(){if(Pe.X.G.call(this),this.c){var e,t=this.c;for(e in t.a){for(var n=t.a[e],r=0;r<n.length;r++)we(n[r]);delete t.a[e],t.b--}}this.C=null},se.va=function(e,t,n,r){return this.c.add(String(e),t,!1,n,r)},se.wa=function(e,t,n,r){return this.c.add(String(e),t,!0,n,r)};var Fe=D.JSON.stringify;function Be(){this.b=this.a=null}var Ve,Ue=(Ke.prototype.get=function(){var e;return 0<this.b?(this.b--,e=this.a,this.a=e.next,e.next=null):e=this.c(),e},new Ke(function(){return new je},function(e){e.reset()}));function Ke(e,t){this.c=e,this.f=t,this.b=0,this.a=null}function je(){this.next=this.b=this.a=null}function ze(e,t){var n;Ve||(n=D.Promise.resolve(void 0),Ve=function(){n.then(We)}),Qe||(Ve(),Qe=!0),Ge.add(e,t)}Be.prototype.add=function(e,t){var n=Ue.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n},je.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null};var Qe=!(je.prototype.reset=function(){this.next=this.b=this.a=null}),Ge=new Be;function We(){for(var e,t;n=t=void 0,n=null,(t=Ge).a&&(n=t.a,t.a=t.a.next,t.a||(t.b=null),n.next=null),e=n;){try{e.a.call(e.b)}catch(e){!function(e){D.setTimeout(function(){throw e},0)}(e)}var n=Ue;n.f(e),n.b<100&&(n.b++,e.next=n.a,n.a=e)}Qe=!1}function He(e,t){Pe.call(this),this.b=e||1,this.a=t||D,this.f=L(this.Za,this),this.g=M()}function Ye(e){e.aa=!1,e.M&&(e.a.clearTimeout(e.M),e.M=null)}function Xe(e,t,n){if("function"==typeof e)n&&(e=L(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=L(e.handleEvent,e)}return 2147483647<Number(t)?-1:D.setTimeout(e,t||0)}q(He,Pe),(se=He.prototype).aa=!1,se.M=null,se.Za=function(){var e;this.aa&&(0<(e=M()-this.g)&&e<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-e):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Me(this,"tick"),this.aa&&(Ye(this),this.start())))},se.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=M())},se.G=function(){He.X.G.call(this),Ye(this),delete this.a};var Je,$e,Ze=(I($e=tt,W=Je=F),$e.prototype=null===W?Object.create(W):(et.prototype=W.prototype,new et),tt.prototype.f=function(e){this.b=arguments,this.a?this.c=!0:function e(t){t.a=Xe(function(){t.a=null,t.c&&(t.c=!1,e(t))},t.h);var n=t.b;t.b=null,t.g.apply(null,n)}(this)},tt.prototype.G=function(){Je.prototype.G.call(this),this.a&&(D.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},tt);function et(){this.constructor=$e}function tt(e,t){var n=Je.call(this)||this;return n.g=e,n.h=t,n.b=null,n.c=!1,n.a=null,n}function nt(e){F.call(this),this.b=e,this.a={}}q(nt,F);var rt=[];function it(e,t,n,r){Array.isArray(n)||(n&&(rt[0]=n.toString()),n=rt);for(var i=0;i<n.length;i++){var o=De(t,n[i],r||e.handleEvent,!1,e.b||e);if(!o)break;e.a[o.key]=o}}function ot(e){H(e.a,function(e,t){this.a.hasOwnProperty(t)&&ke(e)},e),e.a={}}function at(){this.a=!0}function st(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.a)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)&&"noop"!=(r=i[0])&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}return Fe(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}nt.prototype.G=function(){nt.X.G.call(this),ot(this)},nt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},at.prototype.info=function(){};var ut={},ct=null;function lt(){return ct=ct||new Pe}function ht(e){pe.call(this,ut.Fa,e)}function ft(){var e=lt();Me(e,new ht(e))}function dt(e,t){pe.call(this,ut.STAT_EVENT,e),this.stat=t}function pt(e){var t=lt();Me(t,new dt(t,e))}function yt(e){pe.call(this,ut.Ga,e)}function mt(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){e()},t)}ut.Fa="serverreachability",q(ht,pe),ut.STAT_EVENT="statevent",q(dt,pe),ut.Ga="timingevent",q(yt,pe);var gt={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},vt={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function bt(){}function wt(e){var t;return(t=e.a)||(t=e.a={}),t}function Tt(){}bt.prototype.a=null;var St,C={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function It(){pe.call(this,"d")}function Et(){pe.call(this,"c")}function Ct(){}function Dt(e,t,n,r){this.g=e,this.c=t,this.f=n,this.S=r||1,this.J=new nt(this),this.P=_t,e=re?125:void 0,this.R=new He(e),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}q(It,pe),q(Et,pe),q(Ct,bt),St=new Ct;var _t=45e3,kt={},At={};function Nt(e,t,n){e.H=1,e.i=Jt(Qt(t)),e.j=n,e.I=!0,xt(e,null)}function xt(e,t){e.u=M(),Rt(e),e.l=Qt(e.i);var a,s,u,c,l,h,n=e.l,r=e.S;Array.isArray(r)||(r=[String(r)]),hn(n.b,"t",r),e.D=0,e.a=ir(e.g,e.g.C?t:null),0<e.O&&(e.F=new Ze(L(e.Ca,e,e.a),e.O)),it(e.J,e.a,"readystatechange",e.Xa),t=e.B?Y(e.B):{},e.j?(e.m||(e.m="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.a.ba(e.l,e.m,e.j,t)):(e.m="GET",e.a.ba(e.l,e.m,null,t)),ft(),a=e.c,s=e.m,u=e.l,c=e.f,l=e.S,h=e.j,a.info(function(){if(a.a)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,o=t[n].split("=");1<o.length&&(r=o[0],o=o[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+o+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+c+") [attempt "+l+"]: "+s+"\n"+u+"\n"+e})}function Ot(e,t,n){for(var r,i,o,a=!0;!e.A&&e.D<n.length;){var s=(s=n,o=void 0,i=(r=e).D,-1==(o=s.indexOf("\n",i))?At:(i=Number(s.substring(i,o)),isNaN(i)?kt:(o+=1)+i>s.length?At:(s=s.substr(o,i),r.D=o+i,s)));if(s==At){4==t&&(e.h=4,pt(14),a=!1),st(e.c,e.f,null,"[Incomplete Response]");break}if(s==kt){e.h=4,pt(15),st(e.c,e.f,n,"[Invalid Chunk]"),a=!1;break}st(e.c,e.f,s,null),Ft(e,s)}4==t&&0==n.length&&(e.h=1,pt(16),a=!1),e.b=e.b&&a,a?0<n.length&&!e.V&&(e.V=!0,(t=e.g).a==e&&t.U&&!t.F&&(t.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xn(t),t.F=!0,pt(11))):(st(e.c,e.f,n,"[Invalid Chunked Response]"),qt(e),Mt(e))}function Rt(e){e.T=M()+e.P,Lt(e,e.P)}function Lt(e,t){if(null!=e.o)throw Error("WatchDog timer not null");e.o=mt(L(e.Va,e),t)}function Pt(e){e.o&&(D.clearTimeout(e.o),e.o=null)}function Mt(e){0==e.g.v||e.A||Zn(e.g,e)}function qt(e){Pt(e);var t=e.F;t&&"function"==typeof t.ja&&t.ja(),e.F=null,Ye(e.R),ot(e.J),e.a&&(t=e.a,e.a=null,t.abort(),t.ja())}function Ft(e,t){try{var n,r,i,o,a,s=e.g;if(0!=s.v&&(s.a==e||vn(s.b,e)))if(s.I=e.N,!e.C&&vn(s.b,e)&&3==s.v){try{var u=s.ka.a.parse(t)}catch(e){u=null}if(Array.isArray(u)&&3==u.length){var c=u;if(0==c[0]){e:if(!s.j){if(s.a){if(!(s.a.u+3e3<e.u))break e;$n(s),Un(s)}Yn(s),pt(18)}}else s.oa=c[1],0<s.oa-s.P&&c[2]<37500&&s.H&&0==s.o&&!s.m&&(s.m=mt(L(s.Sa,s),6e3));if(gn(s.b)<=1&&s.ea){try{s.ea()}catch(e){}s.ea=void 0}}else tr(s,11)}else if(!e.C&&s.a!=e||$n(s),!j(t))for(t=u=s.ka.a.parse(t),u=0;u<t.length;u++)c=t[u],s.P=c[0],c=c[1],2==s.v?"c"==c[0]?(s.J=c[1],s.ga=c[2],null!=(r=c[3])&&(s.ha=r,s.c.info("VER="+s.ha)),null!=(o=c[4])&&(s.pa=o,s.c.info("SVER="+s.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,s.D=n,s.c.info("backChannelRequestTimeoutMs_="+n)),n=s,(o=e.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(Q(r,"spdy")||Q(r,"quic")||Q(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(bn(i,i.b),i.b=null)),!n.A||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=a,Xt(n.B,n.A,a))),s.v=3,s.f&&s.f.ta(),s.U&&(s.N=M()-e.u,s.c.info("Handshake RTT: "+s.N+"ms")),i=e,(n=s).la=rr(n,n.C?n.ga:null,n.fa),i.C?(wn(n.b,i),o=i,(a=n.D)&&o.setTimeout(a),o.o&&(Pt(o),Rt(o)),n.a=i):Hn(n),0<s.g.length&&zn(s)):"stop"!=c[0]&&"close"!=c[0]||tr(s,7):3==s.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?tr(s,7):Vn(s):"noop"!=c[0]&&s.f&&s.f.sa(c),s.o=0);ft()}catch(e){}}function Bt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(k(e)||"string"==typeof e)V(e,t,void 0);else{if(e.L&&"function"==typeof e.L)var n=e.L();else if(e.K&&"function"==typeof e.K)n=void 0;else if(k(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.K&&"function"==typeof e.K)return e.K();if("string"==typeof e)return e.split("");if(k(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Vt(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Vt)for(n=e.L(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Ut(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];Kt(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){for(var i={},n=t=0;t<e.a.length;)Kt(i,r=e.a[t])||(i[e.a[n++]=r]=1),t++;e.a.length=n}}function Kt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(se=Dt.prototype).setTimeout=function(e){this.P=e},se.Xa=function(e){e=e.target;var t=this.F;t&&3==Mn(e)?t.f():this.Ca(e)},se.Ca=function(e){try{if(e==this.a)e:{var t=Mn(this.a),n=this.a.ua(),r=this.a.W();if(!(t<3||3==t&&!re&&!this.a.$())){this.A||4!=t||7==n||ft(),Pt(this);var i=this.a.W();if(this.N=i,n=this.a.$(),this.b=200==i,r=this.c,s=this.m,u=this.l,c=this.f,l=this.S,h=t,f=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+l+"]: "+s+"\n"+u+"\n"+h+" "+f}),this.b){if(this.U&&!this.C){t:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(o)){var a=o;break t}}a=null}if(!a){this.b=!1,this.h=3,pt(12),qt(this),Mt(this);break e}st(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ft(this,a)}this.I?(Ot(this,t,n),re&&this.b&&3==t&&(it(this.J,this.R,"tick",this.Wa),this.R.start())):(st(this.c,this.f,n,null),Ft(this,n)),4==t&&qt(this),this.b&&!this.A&&(4==t?Zn(this.g,this):(this.b=!1,Rt(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,pt(12)):(this.h=0,pt(13)),qt(this),Mt(this)}}}catch(e){}var s,u,c,l,h,f},se.Wa=function(){var e,t;this.a&&(e=Mn(this.a),t=this.a.$(),this.D<t.length&&(Pt(this),Ot(this,e,t),this.b&&4!=e&&Rt(this)))},se.cancel=function(){this.A=!0,qt(this)},se.Va=function(){this.o=null;var e,t,n=M();0<=n-this.T?(e=this.c,t=this.l,e.info(function(){return"TIMEOUT: "+t}),2!=this.H&&(ft(),pt(17)),qt(this),this.h=2,Mt(this)):Lt(this,this.T-n)},(se=Vt.prototype).K=function(){Ut(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e},se.L=function(){return Ut(this),this.a.concat()},se.get=function(e,t){return Kt(this.b,e)?this.b[e]:t},se.set=function(e,t){Kt(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t},se.forEach=function(e,t){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};var jt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function zt(e,t){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,e instanceof zt?(this.a=void 0!==t?t:e.a,Gt(this,e.f),this.j=e.j,Wt(this,e.c),Ht(this,e.h),this.g=e.g,t=e.b,(n=new sn).c=t.c,t.a&&(n.a=new Vt(t.a),n.b=t.b),Yt(this,n),this.i=e.i):e&&(n=String(e).match(jt))?(this.a=!!t,Gt(this,n[1]||"",!0),this.j=$t(n[2]||""),Wt(this,n[3]||"",!0),Ht(this,n[4]),this.g=$t(n[5]||"",!0),Yt(this,n[6]||"",!0),this.i=$t(n[7]||"")):(this.a=!!t,this.b=new sn(null,this.a))}function Qt(e){return new zt(e)}function Gt(e,t,n){e.f=n?$t(t,!0):t,e.f&&(e.f=e.f.replace(/:$/,""))}function Wt(e,t,n){e.c=n?$t(t,!0):t}function Ht(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.h=t}else e.h=null}function Yt(e,t,n){var r,i;t instanceof sn?(e.b=t,r=e.b,(i=e.a)&&!r.f&&(un(r),r.c=null,r.a.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(cn(this,t),hn(this,n,e))},r)),r.f=i):(n||(t=Zt(t,on)),e.b=new sn(t,e.a))}function Xt(e,t,n){e.b.set(t,n)}function Jt(e){return Xt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^M()).toString(36)),e}function $t(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Zt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,en),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function en(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}zt.prototype.toString=function(){var e=[],t=this.f;t&&e.push(Zt(t,tn,!0),":");var n=this.c;return!n&&"file"!=t||(e.push("//"),(t=this.j)&&e.push(Zt(t,tn,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&e.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&e.push("/"),e.push(Zt(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.b.toString())&&e.push("?",n),(n=this.i)&&e.push("#",Zt(n,an)),e.join("")};var tn=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,an=/#/g;function sn(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function un(o){o.a||(o.a=new Vt,o.b=0,o.c&&function(e){if(e){e=e.split("&");for(var t=0;t<e.length;t++){var n,r=e[t].indexOf("="),i=null;0<=r?(n=e[t].substring(0,r),i=e[t].substring(r+1)):n=e[t],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",o.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(o.c))}function cn(e,t){un(e),t=fn(e,t),Kt(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,Kt((e=e.a).b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Ut(e)))}function ln(e,t){return un(e),t=fn(e,t),Kt(e.a.b,t)}function hn(e,t,n){cn(e,t),0<n.length&&(e.c=null,e.a.set(fn(e,t),K(n)),e.b+=n.length)}function fn(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}(se=sn.prototype).add=function(e,t){un(this),this.c=null,e=fn(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this},se.forEach=function(n,r){un(this),this.a.forEach(function(e,t){V(e,function(e){n.call(r,e,t,this)},this)},this)},se.L=function(){un(this);for(var e=this.a.K(),t=this.a.L(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n},se.K=function(e){un(this);var t=[];if("string"==typeof e)ln(this,e)&&(t=U(t,this.a.get(fn(this,e))));else{e=this.a.K();for(var n=0;n<e.length;n++)t=U(t,e[n])}return t},se.set=function(e,t){return un(this),this.c=null,ln(this,e=fn(this,e))&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this},se.get=function(e,t){return e&&0<(e=this.K(e)).length?String(e[0]):t},se.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.L(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),e.push(a)}return this.c=e.join("&")};function dn(e,t){this.b=e,this.a=t}function pn(e){this.g=e||yn,e=D.PerformanceNavigationTiming?0<(e=D.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(D.ia&&D.ia.ya&&D.ia.ya()&&D.ia.ya().Lb),this.f=e?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var yn=10;function mn(e){return e.b||e.a&&e.a.size>=e.f}function gn(e){return e.b?1:e.a?e.a.size:0}function vn(e,t){return e.b?e.b==t:e.a&&e.a.has(t)}function bn(e,t){e.a?e.a.add(t):e.b=t}function wn(e,t){e.b&&e.b==t?e.b=null:e.a&&e.a.has(t)&&e.a.delete(t)}function Tn(e){var t,n;if(null!=e.b)return e.c.concat(e.b.s);if(null==e.a||0===e.a.size)return K(e.c);var r=e.c;try{for(var i=E(e.a.values()),o=i.next();!o.done;o=i.next())var a=o.value,r=r.concat(a.s)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Sn(){}function In(){this.a=new Sn}function En(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}pn.prototype.cancel=function(){var e,t;if(this.c=Tn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=E(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Sn.prototype.stringify=function(e){return D.JSON.stringify(e,void 0)},Sn.prototype.parse=function(e){return D.JSON.parse(e,void 0)};var Cn=D.JSON.parse;function Dn(e){Pe.call(this),this.headers=new Vt,this.H=e||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=_n,this.D=this.F=!1}q(Dn,Pe);var _n="",kn=/^https?$/i,An=["POST","PUT"];function Nn(e){return"content-type"==e.toLowerCase()}function xn(e,t){e.b=!1,e.a&&(e.g=!0,e.a.abort(),e.g=!1),e.f=t,e.h=5,On(e),Ln(e)}function On(e){e.u||(e.u=!0,Me(e,"complete"),Me(e,"error"))}function Rn(e){if(e.b&&(!e.s[1]||4!=Mn(e)||2!=e.W()))if(e.l&&4==Mn(e))Xe(e.za,0,e);else if(Me(e,"readystatechange"),4==Mn(e)){e.b=!1;try{var t,n,r,i,o=e.W();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===o)&&(!(i=String(e.B).match(jt)[1]||null)&&D.self&&D.self.location&&(i=(r=D.self.location.protocol).substr(0,r.length-1)),n=!kn.test(i?i.toLowerCase():"")),t=n),t)Me(e,"complete"),Me(e,"success");else{e.h=6;try{var s=2<Mn(e)?e.a.statusText:""}catch(o){s=""}e.f=s+" ["+e.W()+"]",On(e)}}finally{Ln(e)}}}function Ln(e,t){if(e.a){Pn(e);var n=e.a,r=e.s[0]?_:null;e.a=null,e.s=null,t||Me(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Pn(e){e.a&&e.D&&(e.a.ontimeout=null),e.m&&(D.clearTimeout(e.m),e.m=null)}function Mn(e){return e.a?e.a.readyState:0}function qn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}var i;r||(i="",H(n,function(e,t){i+=t,i+=":",i+=e,i+="\r\n"}),n=i,"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Xt(e,t,n))}function Fn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Bn(e){this.pa=0,this.g=[],this.c=new at,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Fn("failFast",!1,e),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Fn("baseRetryDelayMs",5e3,e),this.Ra=Fn("retryDelaySeedMs",1e4,e),this.Ma=Fn("forwardChannelMaxRetries",2,e),this.ma=Fn("forwardChannelRequestTimeoutMs",2e4,e),this.Na=e&&e.g||void 0,this.D=void 0,this.C=e&&e.supportsCrossDomainXhr||!1,this.J="",this.b=new pn(e&&e.concurrentRequestLimit),this.ka=new In,this.da=e&&e.fastHandshake||!1,this.Ia=e&&e.b||!1,e&&e.f&&(this.c.a=!1),e&&e.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&e&&e.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=e&&e.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Vn(e){var t,n;Kn(e),3==e.v&&(t=e.R++,Xt(n=Qt(e.B),"SID",e.J),Xt(n,"RID",t),Xt(n,"TYPE","terminate"),Gn(e,n),(t=new Dt(e,e.c,t,void 0)).H=2,t.i=Jt(Qt(n)),n=!1,D.navigator&&D.navigator.sendBeacon&&(n=D.navigator.sendBeacon(t.i.toString(),"")),!n&&D.Image&&((new Image).src=t.i,n=!0),n||(t.a=ir(t.g,null),t.a.ba(t.i)),t.u=M(),Rt(t)),nr(e)}function Un(e){e.a&&(Xn(e),e.a.cancel(),e.a=null)}function Kn(e){Un(e),e.j&&(D.clearTimeout(e.j),e.j=null),$n(e),e.b.cancel(),e.h&&("number"==typeof e.h&&D.clearTimeout(e.h),e.h=null)}function jn(e,t){e.g.push(new dn(e.Oa++,t)),3==e.v&&zn(e)}function zn(e){mn(e.b)||e.h||(e.h=!0,ze(e.Ba,e),e.u=0)}function Qn(e,t){var n=t?t.f:e.R++,r=Qt(e.B);Xt(r,"SID",e.J),Xt(r,"RID",n),Xt(r,"AID",e.P),Gn(e,r),e.i&&e.l&&qn(r,e.i,e.l),n=new Dt(e,e.c,n,e.u+1),null===e.i&&(n.B=e.l),t&&(e.g=t.s.concat(e.g)),t=Wn(e,n,1e3),n.setTimeout(Math.round(.5*e.ma)+Math.round(.5*e.ma*Math.random())),bn(e.b,n),Nt(n,r,t)}function Gn(e,n){e.f&&Bt({},function(e,t){Xt(n,t,e)})}function Wn(e,t,n){n=Math.min(e.g.length,n);var r=e.f?L(e.f.Ja,e.f,e):null;e:for(var i=e.g,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,l=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{!function(e,r){var i="req"+c+"_"||"";try{Bt(e,function(e,t){var n=e;A(e)&&(n=Fe(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(l,a)}catch(e){r&&r(l)}}if(s){r=a.join("&");break e}}return e=e.g.splice(0,n),t.s=e,r}function Hn(e){e.a||e.j||(e.T=1,ze(e.Aa,e),e.o=0)}function Yn(e){return!(e.a||e.j||3<=e.o)&&(e.T++,e.j=mt(L(e.Aa,e),er(e,e.o)),e.o++,1)}function Xn(e){null!=e.s&&(D.clearTimeout(e.s),e.s=null)}function Jn(e){e.a=new Dt(e,e.c,"rpc",e.T),null===e.i&&(e.a.B=e.l),e.a.O=0;var t=Qt(e.la);Xt(t,"RID","rpc"),Xt(t,"SID",e.J),Xt(t,"CI",e.H?"0":"1"),Xt(t,"AID",e.P),Gn(e,t),Xt(t,"TYPE","xmlhttp"),e.i&&e.l&&qn(t,e.i,e.l),e.D&&e.a.setTimeout(e.D);var n=e.a;e=e.ga,n.H=1,n.i=Jt(Qt(t)),n.j=null,n.I=!0,xt(n,e)}function $n(e){null!=e.m&&(D.clearTimeout(e.m),e.m=null)}function Zn(e,t){var n,r,i,o=null;if(e.a==t){$n(e),Xn(e),e.a=null;var a=2}else{if(!vn(e.b,t))return;o=t.s,wn(e.b,t),a=1}if(e.I=t.N,0!=e.v)if(t.b)1==a?(o=t.j?t.j.length:0,t=M()-t.u,n=e.u,Me(a=lt(),new yt(a)),zn(e)):Hn(e);else if(3==(n=t.h)||0==n&&0<e.I||(1!=a||(i=t,gn((r=e).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.La?0:r.Ma)||(r.h=mt(L(r.Ba,r,i),er(r,r.u)),r.u++,0))))&&(2!=a||!Yn(e)))switch(o&&0<o.length&&(t=e.b,t.c=t.c.concat(o)),n){case 1:tr(e,5);break;case 4:tr(e,10);break;case 3:tr(e,6);break;default:tr(e,2)}}function er(e,t){var n=e.Ha+Math.floor(Math.random()*e.Ra);return e.f||(n*=2),n*t}function tr(e,t){var n,r,i,o;e.c.info("Error code "+t),2==t?(r=null,e.f&&(r=null),o=L(e.Ya,e),r||(r=new zt("//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||Gt(r,"https"),Jt(r)),n=r.toString(),r=o,o=new at,D.Image?((i=new Image).onload=P(En,o,i,"TestLoadImage: loaded",!0,r),i.onerror=P(En,o,i,"TestLoadImage: error",!1,r),i.onabort=P(En,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=P(En,o,i,"TestLoadImage: timeout",!1,r),D.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):pt(2),e.v=0,e.f&&e.f.ra(t),nr(e),Kn(e)}function nr(e){e.v=0,e.I=-1,e.f&&(0==Tn(e.b).length&&0==e.g.length||(e.b.c.length=0,K(e.g),e.g.length=0),e.f.qa())}function rr(e,t,n){var r,i,o,a,s,u=(a=n)instanceof zt?Qt(a):new zt(a,void 0);return""!=u.c?(t&&Wt(u,t+"."+u.c),Ht(u,u.h)):(r=(s=D.location).protocol,i=t?t+"."+s.hostname:s.hostname,o=+s.port,a=n,s=new zt(null,void 0),r&&Gt(s,r),i&&Wt(s,i),o&&Ht(s,o),a&&(s.g=a),u=s),e.V&&H(e.V,function(e,t){Xt(u,t,e)}),t=e.A,n=e.na,t&&n&&Xt(u,t,n),Xt(u,"VER",e.ha),Gn(e,u),u}function ir(e,t){if(t&&!e.C)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Dn(e.Na)).F=e.C,t}function or(){}function ar(){if(te&&!(10<=Number(le)))throw Error("Environmental error: no available transport.")}function sr(e,t){Pe.call(this),this.a=new Bn(t),this.o=e,this.b=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.a.l=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.a&&(e?e["X-WebChannel-Client-Profile"]=t.a:e={"X-WebChannel-Client-Profile":t.a}),this.a.O=e,(e=t&&t.httpHeadersOverwriteParam)&&!j(e)&&(this.a.i=e),this.m=t&&t.supportsCrossDomainXhr||!1,this.l=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!j(t)&&(this.a.A=t,null!==(e=this.b)&&t in e&&t in(e=this.b)&&delete e[t]),this.f=new lr(this)}function ur(e){It.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.c=e)?(e=this.c,this.data=null!==t&&e in t?t[e]:void 0):this.data=t}else this.data=e}function cr(){Et.call(this),this.status=1}function lr(e){this.a=e}(se=Dn.prototype).ba=function(e,t,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+e);t=t?t.toUpperCase():"GET",this.B=e,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?wt(this.H):wt(St),this.a.onreadystatechange=L(this.za,this);try{this.A=!0,this.a.open(t,String(e),!0),this.A=!1}catch(e){return void xn(this,e)}e=n||"";var i,o=new Vt(this.headers);r&&Bt(r,function(e,t){o.set(t,e)}),r=function(e){e:{for(var t=Nn,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return t<0?null:"string"==typeof e?e.charAt(t):e[t]}(o.L()),n=D.FormData&&e instanceof D.FormData,0<=B(An,t)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(e,t){this.a.setRequestHeader(t,e)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Pn(this),0<this.o&&((this.D=(i=this.a,te&&ce(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=L(this.xa,this)):this.m=Xe(this.xa,this.o,this)),this.l=!0,this.a.send(e),this.l=!1}catch(e){xn(this,e)}},se.xa=function(){this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Me(this,"timeout"),this.abort(8))},se.abort=function(e){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=e||7,Me(this,"complete"),Me(this,"abort"),Ln(this))},se.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Ln(this,!0)),Dn.X.G.call(this)},se.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Ua())},se.Ua=function(){Rn(this)},se.W=function(){try{return 2<Mn(this)?this.a.status:-1}catch(e){return-1}},se.$=function(){try{return this.a?this.a.responseText:""}catch(e){return""}},se.Pa=function(e){if(this.a){var t=this.a.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Cn(t)}},se.ua=function(){return this.h},se.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(se=Bn.prototype).ha=8,se.v=1,se.Ba=function(e){if(this.h)if(this.h=null,1==this.v){if(!e){this.R=Math.floor(1e5*Math.random()),e=this.R++;var t,n=new Dt(this,this.c,e,void 0),r=this.l;if(this.O&&(r?J(r=Y(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)e:{for(var i=t=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(t+=o)){t=i;break e}if(4096===t||i===this.g.length-1){t=i+1;break e}}t=1e3}else t=1e3;t=Wn(this,n,t),Xt(i=Qt(this.B),"RID",e),Xt(i,"CVER",22),this.A&&Xt(i,"X-HTTP-Session-Id",this.A),Gn(this,i),this.i&&r&&qn(i,this.i,r),bn(this.b,n),this.Ia&&Xt(i,"TYPE","init"),this.da?(Xt(i,"$req",t),Xt(i,"SID","null"),n.U=!0,Nt(n,i,null)):Nt(n,i,t),this.v=2}}else 3==this.v&&(e?Qn(this,e):0==this.g.length||mn(this.b)||Qn(this))},se.Aa=function(){var e;this.j=null,Jn(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(e=2*this.N,this.c.info("BP detection timer enabled: "+e),this.s=mt(L(this.Ta,this),e))},se.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,pt(10),Un(this),Jn(this))},se.Sa=function(){null!=this.m&&(this.m=null,Un(this),Yn(this),pt(19))},se.Ya=function(e){e?(this.c.info("Successfully pinged google.com"),pt(2)):(this.c.info("Failed to ping google.com"),pt(1))},(se=or.prototype).ta=function(){},se.sa=function(){},se.ra=function(){},se.qa=function(){},se.Ja=function(){},ar.prototype.a=function(e,t){return new sr(e,t)},q(sr,Pe),sr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var e=this.a,t=this.o,n=this.b||void 0;pt(0),e.fa=t,e.V=n||{},e.H=e.S,e.B=rr(e,null,e.fa),zn(e)},sr.prototype.close=function(){Vn(this.a)},sr.prototype.h=function(e){var t;"string"==typeof e?((t={}).__data__=e,jn(this.a,t)):this.l?((t={}).__data__=Fe(e),jn(this.a,t)):jn(this.a,e)},sr.prototype.G=function(){this.a.f=null,delete this.f,Vn(this.a),delete this.a,sr.X.G.call(this)},q(ur,It),q(cr,Et),q(lr,or),lr.prototype.ta=function(){Me(this.a,"a")},lr.prototype.sa=function(e){Me(this.a,new ur(e))},lr.prototype.ra=function(e){Me(this.a,new cr)},lr.prototype.qa=function(){Me(this.a,"b")},ar.prototype.createWebChannel=ar.prototype.a,sr.prototype.send=sr.prototype.h,sr.prototype.open=sr.prototype.g,gt.NO_ERROR=0,gt.TIMEOUT=8,gt.HTTP_ERROR=6,vt.COMPLETE="complete",(Tt.EventType=C).OPEN="a",C.CLOSE="b",C.ERROR="c",C.MESSAGE="d",Pe.prototype.listen=Pe.prototype.va,Dn.prototype.listenOnce=Dn.prototype.wa,Dn.prototype.getLastError=Dn.prototype.Qa,Dn.prototype.getLastErrorCode=Dn.prototype.ua,Dn.prototype.getStatus=Dn.prototype.W,Dn.prototype.getResponseJson=Dn.prototype.Pa,Dn.prototype.getResponseText=Dn.prototype.$,Dn.prototype.send=Dn.prototype.ba;var hr=lt,fr=gt,dr=vt,pr=ut,yr=Tt,mr=Dn,C=(gr.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},gr.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},gr.prototype.setServiceProps=function(e){return this.serviceProps=e,this},gr);function gr(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var vr=function(e,t,n,r,i,o){this.databaseId=e,this.persistenceKey=t,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},br="(default)",wr=(Object.defineProperty(Tr.prototype,"isDefaultDatabase",{get:function(){return this.database===br},enumerable:!1,configurable:!0}),Tr.prototype.isEqual=function(e){return e instanceof Tr&&e.projectId===this.projectId&&e.database===this.database},Tr);function Tr(e,t){this.projectId=e,this.database=t||br}var Sr=(Ir.prototype.isAuthenticated=function(){return null!=this.uid},Ir.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Ir.prototype.isEqual=function(e){return e.uid===this.uid},Ir);function Ir(e){this.uid=e}Sr.UNAUTHENTICATED=new Sr(null),Sr.GOOGLE_CREDENTIALS=new Sr("google-credentials-uid"),Sr.FIRST_PARTY=new Sr("first-party-uid");var Er,Cr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Dr=(n(_r,Er=Error),_r);function _r(e,t){var n=Er.call(this,t)||this;return n.code=e,n.message=t,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}var kr="8.1.1-1.0.0-eap-firestore-debug.9c6096f43",Ar=new l("@firebase/firestore");function Nr(){return Ar.logLevel}function xr(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=f.DEBUG&&(t=n.map(Lr),Ar.debug.apply(Ar,a(["Firestore ("+kr+"): "+e],t)))}function Or(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=f.ERROR&&(t=n.map(Lr),Ar.error.apply(Ar,a(["Firestore ("+kr+"): "+e],t)))}function Rr(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=f.WARN&&(t=n.map(Lr),Ar.warn.apply(Ar,a(["Firestore ("+kr+"): "+e],t)))}function Lr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Pr(e){throw void 0===e&&(e="Unexpected state"),Or(e="FIRESTORE ("+kr+") INTERNAL ASSERTION FAILED: "+e),new Error(e)}function Mr(e,t){e||Pr(t)}function qr(e,t){e||Pr(t)}function Fr(e,t){return qr(e instanceof t,"Expected type '"+t.name+"', but was '"+e.constructor.name+"'"),e}var Br=(Vr.newId=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;qr(0<t&&t<256,"Expect maxMultiple to be (0, 256), but got "+t);for(var n="";n.length<20;)for(var r=function(){qr(!0,"Expecting non-negative nBytes, got: 40");var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(var n=0;n<40;n++)t[n]=Math.floor(256*Math.random());return t}(),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return qr(20===n.length,"Invalid auto ID: "+n),n},Vr);function Vr(){}function Ur(e,t){return e<t?-1:t<e?1:0}function Kr(e,n,r){return e.length===n.length&&e.every(function(e,t){return r(e,n[t])})}function jr(e){return e+"\0"}var zr=-62135596800,Qr=(Gr.now=function(){return Gr.fromMillis(Date.now())},Gr.fromDate=function(e){return Gr.fromMillis(e.getTime())},Gr.fromMillis=function(e){var t=Math.floor(e/1e3);return new Gr(t,1e6*(e-1e3*t))},Gr.prototype.toDate=function(){return new Date(this.toMillis())},Gr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Gr.prototype._compareTo=function(e){return this.seconds===e.seconds?Ur(this.nanoseconds,e.nanoseconds):Ur(this.seconds,e.seconds)},Gr.prototype.isEqual=function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds},Gr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Gr.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Gr.prototype.valueOf=function(){var e=this.seconds-zr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Gr);function Gr(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new Dr(Cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new Dr(Cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<zr)throw new Dr(Cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new Dr(Cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}function Wr(e){var t,n=0;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n++;return n}function Hr(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Yr(e){for(var t in qr(null!=e&&"object"==typeof e,"isEmpty() expects object parameter."),e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Xr=(Jr.fromBase64String=function(e){return new Jr(atob(e))},Jr.fromUint8Array=function(e){return new Jr(function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))},Jr.prototype.toBase64=function(){return e=this.binaryString,btoa(e);var e},Jr.prototype.toUint8Array=function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)},Jr.prototype.approximateByteSize=function(){return 2*this.binaryString.length},Jr.prototype.compareTo=function(e){return Ur(this.binaryString,e.binaryString)},Jr.prototype.isEqual=function(e){return this.binaryString===e.binaryString},Jr);function Jr(e){this.binaryString=e}function $r(e){return null==e}function Zr(e){return 0===e&&1/e==-1/0}function ei(e){return"number"==typeof e&&Number.isInteger(e)&&!Zr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}Xr.EMPTY_BYTE_STRING=new Xr("");var ti="__name__",gt=(Object.defineProperty(ni.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),ni.prototype.isEqual=function(e){return 0===ni.comparator(this,e)},ni.prototype.child=function(e){var t=this.segments.slice(this.offset,this.limit());return e instanceof ni?e.forEach(function(e){t.push(e)}):t.push(e),this.construct(t)},ni.prototype.limit=function(){return this.offset+this.length},ni.prototype.popFirst=function(e){return e=void 0===e?1:e,qr(this.length>=e,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+e,this.length-e)},ni.prototype.popLast=function(){return qr(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},ni.prototype.firstSegment=function(){return qr(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},ni.prototype.lastSegment=function(){return this.get(this.length-1)},ni.prototype.get=function(e){return qr(e<this.length,"Index out of range"),this.segments[this.offset+e]},ni.prototype.isEmpty=function(){return 0===this.length},ni.prototype.isPrefixOf=function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},ni.prototype.isImmediateParentOf=function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},ni.prototype.forEach=function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])},ni.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},ni.comparator=function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),o=t.get(r);if(i<o)return-1;if(o<i)return 1}return e.length<t.length?-1:e.length>t.length?1:0},ni);function ni(e,t,n){void 0===t?t=0:t>e.length&&Pr("offset "+t+" out of range "+e.length),void 0===n?n=e.length-t:n>e.length-t&&Pr("length "+n+" out of range "+(e.length-t)),this.segments=e,this.offset=t,this.len=n}var ri,ii=(n(oi,ri=gt),oi.prototype.construct=function(e,t,n){return new oi(e,t,n)},oi.prototype.canonicalString=function(){return this.toArray().join("/")},oi.prototype.toString=function(){return this.canonicalString()},oi.fromString=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(e){return 0<e.length}))}return new oi(n)},oi.emptyPath=function(){return new oi([])},oi);function oi(){return null!==ri&&ri.apply(this,arguments)||this}var ai,si=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ui=(n(ci,ai=gt),ci.prototype.construct=function(e,t,n){return new ci(e,t,n)},ci.isValidIdentifier=function(e){return si.test(e)},ci.prototype.canonicalString=function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ci.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")},ci.prototype.toString=function(){return this.canonicalString()},ci.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===ti},ci.keyField=function(){return new ci([ti])},ci.fromServerFormat=function(e){for(var t=[],n="",r=0,i=function(){if(0===n.length)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");t.push(n),n=""},o=!1;r<e.length;){var a=e[r];if("\\"===a){if(r+1===e.length)throw new Dr(Cr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Dr(Cr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Dr(Cr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ci(t)},ci.emptyPath=function(){return new ci([])},ci);function ci(){return null!==ai&&ai.apply(this,arguments)||this}var li=(hi.fromPath=function(e){return new hi(ii.fromString(e))},hi.fromName=function(e){return new hi(ii.fromString(e).popFirst(5))},hi.prototype.hasCollectionId=function(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e},hi.prototype.isEqual=function(e){return null!==e&&0===ii.comparator(this.path,e.path)},hi.prototype.toString=function(){return this.path.toString()},hi.comparator=function(e,t){return ii.comparator(e.path,t.path)},hi.isDocumentKey=function(e){return e.length%2==0},hi.fromSegments=function(e){return new hi(new ii(e.slice()))},hi);function hi(e){this.path=e,qr(hi.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}var fi="server_timestamp",di="__type__",pi="__previous_value__",yi="__local_write_time__";function mi(e){return(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{})[di])||void 0===e?void 0:e.stringValue)===fi}function gi(e){return e=Ci(e.mapValue.fields[yi].timestampValue),new Qr(e.seconds,e.nanos)}var vi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bi(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?mi(e)?4:10:Pr("Invalid value type: "+JSON.stringify(e))}function wi(r,i){var e,t,n,o=bi(r);if(o!==bi(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return gi(r).isEqual(gi(i));case 3:return n=i,"string"==typeof(t=r).timestampValue&&"string"==typeof n.timestampValue&&t.timestampValue.length===n.timestampValue.length?t.timestampValue===n.timestampValue:(t=Ci(t.timestampValue),n=Ci(n.timestampValue),t.seconds===n.seconds&&t.nanos===n.nanos);case 5:return r.stringValue===i.stringValue;case 6:return e=i,_i(r.bytesValue).isEqual(_i(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return o=i,Di((e=r).geoPointValue.latitude)===Di(o.geoPointValue.latitude)&&Di(e.geoPointValue.longitude)===Di(o.geoPointValue.longitude);case 2:return e=i,"integerValue"in(o=r)&&"integerValue"in e?Di(o.integerValue)===Di(e.integerValue):"doubleValue"in o&&"doubleValue"in e&&((o=Di(o.doubleValue))===(e=Di(e.doubleValue))?Zr(o)===Zr(e):isNaN(o)&&isNaN(e));case 9:return Kr(r.arrayValue.values||[],i.arrayValue.values||[],wi);case 10:return function(){var e,t=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Wr(t)!==Wr(n))return!1;for(e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!wi(t[e],n[e])))return!1;return!0}();default:return Pr("Unexpected value type: "+JSON.stringify(r))}}function Ti(e,t){return void 0!==(e.values||[]).find(function(e){return wi(e,t)})}function Si(e,t){var n,r,i,o,a=bi(e),s=bi(t);if(a!==s)return Ur(a,s);switch(a){case 0:return 0;case 1:return Ur(e.booleanValue,t.booleanValue);case 2:return o=t,(i=Di((i=e).integerValue||i.doubleValue))<(o=Di(o.integerValue||o.doubleValue))?-1:o<i?1:i===o?0:isNaN(i)?isNaN(o)?0:-1:1;case 3:return Ii(e.timestampValue,t.timestampValue);case 4:return Ii(gi(e),gi(t));case 5:return Ur(e.stringValue,t.stringValue);case 6:return n=e.bytesValue,r=t.bytesValue,n=_i(n),r=_i(r),n.compareTo(r);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ur(n[i],r[i]);if(0!==o)return o}return Ur(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0===(s=Ur(Di(n.latitude),Di(r.latitude)))?Ur(Di(n.longitude),Di(r.longitude)):s;case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var o=Si(n[i],r[i]);if(o)return o}return Ur(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var a=0;a<r.length&&a<o.length;++a){var s=Ur(r[a],o[a]);if(0!==s)return s;if(0!==(s=Si(n[r[a]],i[o[a]])))return s}return Ur(r.length,o.length)}(e.mapValue,t.mapValue);default:throw Pr("Invalid value type: "+a)}}function Ii(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ur(e,t);var n=Ci(e),e=Ci(t);return 0!==(t=Ur(n.seconds,e.seconds))?t:Ur(n.nanos,e.nanos)}function Ei(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){return"time("+(e=Ci(e)).seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?_i(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,li.fromName(t).toString()):"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(e){for(var t="[",n=!0,r=0,i=e.values||[];r<i.length;r++)n?n=!1:t+=",",t+=s(i[r]);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var t=Object.keys(e.fields||{}).sort(),n="{",r=!0,i=0,o=t;i<o.length;i++){var a=o[i];r?r=!1:n+=",",n+=a+":"+s(e.fields[a])}return n+"}"}(e.mapValue):Pr("Invalid value type: "+JSON.stringify(e));var t}(e)}function Ci(e){if(Mr(!!e,"Cannot normalize null or undefined timestamp."),"string"!=typeof e)return{seconds:Di(e.seconds),nanos:t=Di(e.nanos)};var t=0,n=vi.exec(e);return Mr(!!n,"invalid timestamp: "+e),n[1]&&(n=(n[1]+"000000000").substr(0,9),t=Number(n)),e=new Date(e),{seconds:Math.floor(e.getTime()/1e3),nanos:t}}function Di(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function _i(e){return"string"==typeof e?Xr.fromBase64String(e):Xr.fromUint8Array(e)}function ki(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function Ai(e){return!!e&&"integerValue"in e}function Ni(e){return Ai(e)||!!e&&"doubleValue"in e}function xi(e){return!!e&&"arrayValue"in e}function Oi(e){return!!e&&"referenceValue"in e}function Ri(e){return e&&"nullValue"in e}function Li(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Pi(e){return e&&"mapValue"in e}var Mi,qi=(n(Fi,Mi=vt=function(e,t){this.key=e,this.version=t}),Fi.prototype.field=function(e){return this.objectValue.field(e)},Fi.prototype.data=function(){return this.objectValue},Fi.prototype.toProto=function(){return this.objectValue.proto},Fi.prototype.isEqual=function(e){return e instanceof Fi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.hasLocalMutations===e.hasLocalMutations&&this.hasCommittedMutations===e.hasCommittedMutations&&this.objectValue.isEqual(e.objectValue)},Fi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Fi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Fi);function Fi(e,t,n,r){return(t=Mi.call(this,e,t)||this).objectValue=n,t.hasLocalMutations=!!r.hasLocalMutations,t.hasCommittedMutations=!!r.hasCommittedMutations,t}var Bi,Vi=(n(Ui,Bi=vt),Ui.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ui.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Ui.prototype.isEqual=function(e){return e instanceof Ui&&e.hasCommittedMutations===this.hasCommittedMutations&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},Ui);function Ui(e,t,n){return(t=Bi.call(this,e,t)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),t}var Ki,ji=(n(zi,Ki=vt),zi.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(zi.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),zi.prototype.isEqual=function(e){return e instanceof zi&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},zi);function zi(){return null!==Ki&&Ki.apply(this,arguments)||this}var Qi=function(e,t,n,r,i,o,a){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null};function Gi(e,t,n,r,i,o,a){return void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),new Qi(e,t,n,r,i,o,a)}function Wi(e){var t=Fr(e,Qi);return null===t.memoizedCanonicalId&&(e=t.path.canonicalString(),null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(function(e){return qr(e instanceof yo,"canonifyFilter() only supports FieldFilters"),e.field.canonicalString()+e.op.toString()+Ei(e.value)}).join(","),e+="|ob:",e+=t.orderBy.map(function(e){return e.field.canonicalString()+e.dir}).join(","),$r(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=Vo(t.startAt)),t.endAt&&(e+="|ub:",e+=Vo(t.endAt)),t.memoizedCanonicalId=e),t.memoizedCanonicalId}function Hi(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n,r,i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(e.filters.length!==t.filters.length)return!1;for(var o,a,i=0;i<e.filters.length;i++)if(o=e.filters[i],a=t.filters[i],qr(o instanceof yo&&a instanceof yo,"Only FieldFilters can be compared"),o.op!==a.op||!o.field.isEqual(a.field)||!wi(o.value,a.value))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ko(e.startAt,t.startAt)&&Ko(e.endAt,t.endAt)}function Yi(e){return li.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var Xi=function(e,t,n,r,i,o,a,s){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===a&&(a=null),void 0===s&&(s=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&qr(this.startAt.position.length<=oo(this).length,"Bound is longer than orderBy"),this.endAt&&qr(this.endAt.position.length<=oo(this).length,"Bound is longer than orderBy")};function Ji(e,t,n,r,i,o,a,s){return new Xi(e,t,n,r,i,o,a,s)}function $i(e){return new Xi(e)}function Zi(e){return!$r(e.limit)&&"F"===e.limitType}function eo(e){return!$r(e.limit)&&"L"===e.limitType}function to(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function no(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(qr(r instanceof yo,"Only FieldFilters are supported"),r.isInequality())return r.field}return null}function ro(e){return li.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function io(e){return null!==e.collectionGroup}function oo(e){var t=Fr(e,Xi);if(null===t.memoizedOrderBy){t.memoizedOrderBy=[];var n=no(t),e=to(t);if(null!==n&&null===e)n.isKeyField()||t.memoizedOrderBy.push(new jo(n)),t.memoizedOrderBy.push(new jo(ui.keyField(),"asc"));else{qr(null===n||null!==e&&n.isEqual(e),"First orderBy should match inequality field.");for(var r=!1,i=0,o=t.explicitOrderBy;i<o.length;i++){var a=o[i];t.memoizedOrderBy.push(a),a.field.isKeyField()&&(r=!0)}r||(e=0<t.explicitOrderBy.length?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",t.memoizedOrderBy.push(new jo(ui.keyField(),e)))}}return t.memoizedOrderBy}function ao(e){var t=Fr(e,Xi);if(!t.memoizedTarget)if("F"===t.limitType)t.memoizedTarget=Gi(t.path,t.collectionGroup,oo(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=oo(t);r<i.length;r++){var o=i[r],a="desc"===o.dir?"asc":"desc";n.push(new jo(o.field,a))}var s=t.endAt?new Bo(t.endAt.position,!t.endAt.before):null,e=t.startAt?new Bo(t.startAt.position,!t.startAt.before):null;t.memoizedTarget=Gi(t.path,t.collectionGroup,n,t.filters,t.limit,s,e)}return t.memoizedTarget}function so(e,t,n){return new Xi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function uo(e,t){return Hi(ao(e),ao(t))&&e.limitType===t.limitType}function co(e){return Wi(ao(e))+"|lt:"+e.limitType}function lo(e){return"Query(target="+(t=ao(e),n=t.path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),0<t.filters.length&&(n+=", filters: ["+t.filters.map(function(e){return qr(e instanceof yo,"stringifyFilter() only supports FieldFilters"),e.field.canonicalString()+" "+e.op+" "+Ei(e.value)}).join(", ")+"]"),$r(t.limit)||(n+=", limit: "+t.limit),0<t.orderBy.length&&(n+=", orderBy: ["+t.orderBy.map(function(e){return e.field.canonicalString()+" ("+e.dir+")"}).join(", ")+"]"),t.startAt&&(n+=", startAt: "+Vo(t.startAt)),t.endAt&&(n+=", endAt: "+Vo(t.endAt)),"Target("+n+")")+"; limitType="+e.limitType+")";var t,n}function ho(i,e){return t=i,n=e.key.path,(null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):li.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n))&&function(e){for(var t=0,n=i.explicitOrderBy;t<n.length;t++){var r=n[t];if(!r.field.isKeyField()&&null===e.field(r.field))return}return 1}(e)&&function(e){for(var t=0,n=i.filters;t<n.length;t++)if(!n[t].matches(e))return;return 1}(e)&&(n=e,(!(e=i).startAt||Uo(e.startAt,oo(e),n))&&(!e.endAt||!Uo(e.endAt,oo(e),n)));var t,n}function fo(s){return function(e,t){for(var n=!1,r=0,i=oo(s);r<i.length;r++){var o=i[r],a=function(e,t,n){var r,i;switch(n=e.field.isKeyField()?li.comparator(t.key,n.key):(r=e.field,i=n,t=(t=t).field(r),r=i.field(r),null!==t&&null!==r?Si(t,r):Pr("Trying to compare documents on fields that don't exist")),e.dir){case"asc":return n;case"desc":return-1*n;default:return Pr("Unknown direction: "+e.dir)}}(o,e,t);if(0!==a)return a;n=n||o.field.isKeyField()}return qr(n,"orderBy used that doesn't compare on key field"),0}}var po,yo=(n(mo,po=function(){}),mo.create=function(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):(qr(Oi(n),"Comparing on key, but filter value not a RefValue"),qr("array-contains"!==t&&"array-contains-any"!==t,"'"+t.toString()+"' queries don't make sense on document keys."),new vo(e,t,n)):"array-contains"===t?new ko(e,n):"in"===t?(qr(xi(n),"IN filter has invalid value: "+n.toString()),new xo(e,n)):"not-in"===t?(qr(xi(n),"NOT_IN filter has invalid value: "+n.toString()),new Lo(e,n)):"array-contains-any"===t?(qr(xi(n),"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new qo(e,n)):new mo(e,t,n)},mo.createKeyFieldInFilter=function(e,t,n){return qr(xi(n),"Comparing on key with "+t.toString()+", but filter value not an ArrayValue"),qr((n.arrayValue.values||[]).every(Oi),"Comparing on key with "+t.toString()+", but an array value was not a RefValue"),new("in"===t?To:Eo)(e,n)},mo.prototype.matches=function(e){return e=e.field(this.field),"!="===this.op?null!==e&&this.matchesComparison(Si(e,this.value)):null!==e&&bi(this.value)===bi(e)&&this.matchesComparison(Si(e,this.value))},mo.prototype.matchesComparison=function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Pr("Unknown FieldFilter operator: "+this.op)}},mo.prototype.isInequality=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},mo);function mo(e,t,n){var r=po.call(this)||this;return r.field=e,r.op=t,r.value=n,r}var go,vo=(n(bo,go=yo),bo.prototype.matches=function(e){return e=li.comparator(e.key,this.key),this.matchesComparison(e)},bo);function bo(e,t,n){return t=go.call(this,e,t,n)||this,qr(Oi(n),"KeyFieldFilter expects a ReferenceValue"),t.key=li.fromName(n.referenceValue),t}var wo,To=(n(So,wo=yo),So.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},So);function So(e,t){return(e=wo.call(this,e,"in",t)||this).keys=Do("in",t),e}var Io,Eo=(n(Co,Io=yo),Co.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},Co);function Co(e,t){return(e=Io.call(this,e,"not-in",t)||this).keys=Do("not-in",t),e}function Do(t,e){return qr(xi(e),"KeyFieldInFilter/KeyFieldNotInFilter expects an ArrayValue"),((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(e){return qr(Oi(e),"Comparing on key with "+t.toString()+", but an array value was not a ReferenceValue"),li.fromName(e.referenceValue)})}var _o,ko=(n(Ao,_o=yo),Ao.prototype.matches=function(e){return xi(e=e.field(this.field))&&Ti(e.arrayValue,this.value)},Ao);function Ao(e,t){return _o.call(this,e,"array-contains",t)||this}var No,xo=(n(Oo,No=yo),Oo.prototype.matches=function(e){return null!==(e=e.field(this.field))&&Ti(this.value.arrayValue,e)},Oo);function Oo(e,t){return e=No.call(this,e,"in",t)||this,qr(xi(t),"InFilter expects an ArrayValue"),e}var Ro,Lo=(n(Po,Ro=yo),Po.prototype.matches=function(e){return!Ti(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(e=e.field(this.field))&&!Ti(this.value.arrayValue,e))},Po);function Po(e,t){return e=Ro.call(this,e,"not-in",t)||this,qr(xi(t),"NotInFilter expects an ArrayValue"),e}var Mo,qo=(n(Fo,Mo=yo),Fo.prototype.matches=function(e){var t=this;return!(!xi(e=e.field(this.field))||!e.arrayValue.values)&&e.arrayValue.values.some(function(e){return Ti(t.value.arrayValue,e)})},Fo);function Fo(e,t){return e=Mo.call(this,e,"array-contains-any",t)||this,qr(xi(t),"ArrayContainsAnyFilter expects an ArrayValue"),e}var Bo=function(e,t){this.position=e,this.before=t};function Vo(e){return(e.before?"b":"a")+":"+e.position.map(Ei).join(",")}function Uo(e,t,n){qr(e.position.length<=t.length,"Bound has more components than query's orderBy");for(var r=0,i=0;i<e.position.length;i++){var o,a=t[i],s=e.position[i],r=a.field.isKeyField()?(qr(Oi(s),"Bound has a non-key value where the key path is being used."),li.comparator(li.fromName(s.referenceValue),n.key)):(qr(null!==(o=n.field(a.field)),"Field should exist since document matched the orderBy already."),Si(s,o));if("desc"===a.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function Ko(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!wi(e.position[n],t.position[n]))return!1;return!0}var jo=function(e,t){void 0===t&&(t="asc"),this.field=e,this.dir=t},zo=(Qo.fromTimestamp=function(e){return new Qo(e)},Qo.min=function(){return new Qo(new Qr(0,0))},Qo.prototype.compareTo=function(e){return this.timestamp._compareTo(e.timestamp)},Qo.prototype.isEqual=function(e){return this.timestamp.isEqual(e.timestamp)},Qo.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Qo.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Qo.prototype.toTimestamp=function(){return this.timestamp},Qo);function Qo(e){this.timestamp=e}var Go=(Wo.prototype.insert=function(e,t){return new Wo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xo.BLACK,null,null))},Wo.prototype.remove=function(e){return new Wo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xo.BLACK,null,null))},Wo.prototype.get=function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null},Wo.prototype.indexOf=function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1},Wo.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Wo.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Wo.prototype.minKey=function(){return this.root.minKey()},Wo.prototype.maxKey=function(){return this.root.maxKey()},Wo.prototype.inorderTraversal=function(e){return this.root.inorderTraversal(e)},Wo.prototype.forEach=function(n){this.inorderTraversal(function(e,t){return n(e,t),!1})},Wo.prototype.toString=function(){var n=[];return this.inorderTraversal(function(e,t){return n.push(e+":"+t),!1}),"{"+n.join(", ")+"}"},Wo.prototype.reverseTraversal=function(e){return this.root.reverseTraversal(e)},Wo.prototype.getIterator=function(){return new Ho(this.root,null,this.comparator,!1)},Wo.prototype.getIteratorFrom=function(e){return new Ho(this.root,e,this.comparator,!1)},Wo.prototype.getReverseIterator=function(){return new Ho(this.root,null,this.comparator,!0)},Wo.prototype.getReverseIteratorFrom=function(e){return new Ho(this.root,e,this.comparator,!0)},Wo);function Wo(e,t){this.comparator=e,this.root=t||Xo.EMPTY}var Ho=(Yo.prototype.getNext=function(){qr(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t},Yo.prototype.hasNext=function(){return 0<this.nodeStack.length},Yo.prototype.peek=function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}},Yo);function Yo(e,t,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}var Xo=(Jo.prototype.copy=function(e,t,n,r,i){return new Jo(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Jo.prototype.isEmpty=function(){return!1},Jo.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},Jo.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},Jo.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},Jo.prototype.minKey=function(){return this.min().key},Jo.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Jo.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()},Jo.prototype.removeMin=function(){if(this.left.isEmpty())return Jo.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},Jo.prototype.remove=function(e,t){var n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Jo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()},Jo.prototype.isRed=function(){return this.color},Jo.prototype.fixUp=function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e},Jo.prototype.moveRedLeft=function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e},Jo.prototype.moveRedRight=function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e},Jo.prototype.rotateLeft=function(){var e=this.copy(null,null,Jo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},Jo.prototype.rotateRight=function(){var e=this.copy(null,null,Jo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},Jo.prototype.colorFlip=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},Jo.prototype.checkMaxDepth=function(){var e=this.check();return Math.pow(2,e)<=this.size+1},Jo.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Pr("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Pr("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check();if(e!==this.right.check())throw Pr("Black depths differ");return e+(this.isRed()?0:1)},Jo);function Jo(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Jo.RED,this.left=null!=r?r:Jo.EMPTY,this.right=null!=i?i:Jo.EMPTY,this.size=this.left.size+1+this.right.size}function $o(){this.size=0}Xo.EMPTY=null,Xo.RED=!0,Xo.BLACK=!1,Object.defineProperty($o.prototype,"key",{get:function(){throw Pr("LLRBEmptyNode has no key.")},enumerable:!1,configurable:!0}),Object.defineProperty($o.prototype,"value",{get:function(){throw Pr("LLRBEmptyNode has no value.")},enumerable:!1,configurable:!0}),Object.defineProperty($o.prototype,"color",{get:function(){throw Pr("LLRBEmptyNode has no color.")},enumerable:!1,configurable:!0}),Object.defineProperty($o.prototype,"left",{get:function(){throw Pr("LLRBEmptyNode has no left child.")},enumerable:!1,configurable:!0}),Object.defineProperty($o.prototype,"right",{get:function(){throw Pr("LLRBEmptyNode has no right child.")},enumerable:!1,configurable:!0}),$o.prototype.copy=function(e,t,n,r,i){return this},$o.prototype.insert=function(e,t,n){return new Xo(e,t)},$o.prototype.remove=function(e,t){return this},$o.prototype.isEmpty=function(){return!0},$o.prototype.inorderTraversal=function(e){return!1},$o.prototype.reverseTraversal=function(e){return!1},$o.prototype.minKey=function(){return null},$o.prototype.maxKey=function(){return null},$o.prototype.isRed=function(){return!1},$o.prototype.checkMaxDepth=function(){return!0},$o.prototype.check=function(){return 0},l=$o,Xo.EMPTY=new l;var Zo=(ea.prototype.has=function(e){return null!==this.data.get(e)},ea.prototype.first=function(){return this.data.minKey()},ea.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(ea.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),ea.prototype.indexOf=function(e){return this.data.indexOf(e)},ea.prototype.forEach=function(n){this.data.inorderTraversal(function(e,t){return n(e),!1})},ea.prototype.forEachInRange=function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}},ea.prototype.forEachWhile=function(e,t){for(var n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return},ea.prototype.firstAfterOrEqual=function(e){return(e=this.data.getIteratorFrom(e)).hasNext()?e.getNext().key:null},ea.prototype.getIterator=function(){return new ta(this.data.getIterator())},ea.prototype.getIteratorFrom=function(e){return new ta(this.data.getIteratorFrom(e))},ea.prototype.add=function(e){return this.copy(this.data.remove(e).insert(e,!0))},ea.prototype.delete=function(e){return this.has(e)?this.copy(this.data.remove(e)):this},ea.prototype.isEmpty=function(){return this.data.isEmpty()},ea.prototype.unionWith=function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t},ea.prototype.isEqual=function(e){if(!(e instanceof ea))return!1;if(this.size!==e.size)return!1;for(var t=this.data.getIterator(),n=e.data.getIterator();t.hasNext();){var r=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},ea.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},ea.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},ea.prototype.copy=function(e){var t=new ea(this.comparator);return t.data=e,t},ea);function ea(e){this.comparator=e,this.data=new Go(this.comparator)}var ta=(na.prototype.getNext=function(){return this.iter.getNext().key},na.prototype.hasNext=function(){return this.iter.hasNext()},na);function na(e){this.iter=e}var ra=new Go(li.comparator),ia=new Go(li.comparator),oa=new Go(li.comparator),aa=new Zo(li.comparator);function sa(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=aa,r=0,i=e;r<i.length;r++)var o=i[r],n=n.add(o);return n}var ua=new Zo(Ur),ca=(la.empty=function(){return new la({mapValue:{}})},la.prototype.field=function(e){if(e.isEmpty())return this.proto;for(var t=this.proto,n=0;n<e.length-1;++n){if(!t.mapValue.fields)return null;if(!Pi(t=t.mapValue.fields[e.get(n)]))return null}return(t=(t.mapValue.fields||{})[e.lastSegment()])||null},la.prototype.isEqual=function(e){return wi(this.proto,e.proto)},la);function la(e){qr(!mi(this.proto=e),"ServerTimestamps should be converted to ServerTimestampValue")}var ha=(fa.prototype.set=function(e,t){return qr(!e.isEmpty(),"Cannot set field for empty path on ObjectValue"),this.setOverlay(e,t),this},fa.prototype.delete=function(e){return qr(!e.isEmpty(),"Cannot delete field for empty path on ObjectValue"),this.setOverlay(e,null),this},fa.prototype.setOverlay=function(e,t){for(var n=this.overlayMap,r=0;r<e.length-1;++r)var i=e.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===bi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(e.lastSegment(),t)},fa.prototype.build=function(){var e=this.applyOverlay(ui.emptyPath(),this.overlayMap);return null!=e?new ca(e):this.baseObject},fa.prototype.applyOverlay=function(r,e){var i=this,o=!1,t=this.baseObject.field(r),a=Pi(t)?Object.assign({},t.mapValue.fields):{};return e.forEach(function(e,t){var n;e instanceof Map?null!=(n=i.applyOverlay(r.child(t),e))&&(a[t]=n,o=!0):null!==e?(a[t]=e,o=!0):a.hasOwnProperty(t)&&(delete a[t],o=!0)}),o?{mapValue:{fields:a}}:null},fa);function fa(e){void 0===e&&(e=ca.empty()),this.baseObject=e,this.overlayMap=new Map}function da(e){this.count=e}var pa;function ya(e){switch(e){case Cr.OK:return Pr("Treated status OK as error"),0;case Cr.CANCELLED:case Cr.UNKNOWN:case Cr.DEADLINE_EXCEEDED:case Cr.RESOURCE_EXHAUSTED:case Cr.INTERNAL:case Cr.UNAVAILABLE:case Cr.UNAUTHENTICATED:return;case Cr.INVALID_ARGUMENT:case Cr.NOT_FOUND:case Cr.ALREADY_EXISTS:case Cr.PERMISSION_DENIED:case Cr.FAILED_PRECONDITION:case Cr.ABORTED:case Cr.OUT_OF_RANGE:case Cr.UNIMPLEMENTED:case Cr.DATA_LOSS:return 1;default:return Pr("Unknown status code: "+e),0}}function ma(e){if(void 0===e)return Or("GRPC error has no .code"),Cr.UNKNOWN;switch(e){case pa.OK:return Cr.OK;case pa.CANCELLED:return Cr.CANCELLED;case pa.UNKNOWN:return Cr.UNKNOWN;case pa.DEADLINE_EXCEEDED:return Cr.DEADLINE_EXCEEDED;case pa.RESOURCE_EXHAUSTED:return Cr.RESOURCE_EXHAUSTED;case pa.INTERNAL:return Cr.INTERNAL;case pa.UNAVAILABLE:return Cr.UNAVAILABLE;case pa.UNAUTHENTICATED:return Cr.UNAUTHENTICATED;case pa.INVALID_ARGUMENT:return Cr.INVALID_ARGUMENT;case pa.NOT_FOUND:return Cr.NOT_FOUND;case pa.ALREADY_EXISTS:return Cr.ALREADY_EXISTS;case pa.PERMISSION_DENIED:return Cr.PERMISSION_DENIED;case pa.FAILED_PRECONDITION:return Cr.FAILED_PRECONDITION;case pa.ABORTED:return Cr.ABORTED;case pa.OUT_OF_RANGE:return Cr.OUT_OF_RANGE;case pa.UNIMPLEMENTED:return Cr.UNIMPLEMENTED;case pa.DATA_LOSS:return Cr.DATA_LOSS;default:return Pr("Unknown status code: "+e)}}(gt=pa=pa||{})[gt.OK=0]="OK",gt[gt.CANCELLED=1]="CANCELLED",gt[gt.UNKNOWN=2]="UNKNOWN",gt[gt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",gt[gt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",gt[gt.NOT_FOUND=5]="NOT_FOUND",gt[gt.ALREADY_EXISTS=6]="ALREADY_EXISTS",gt[gt.PERMISSION_DENIED=7]="PERMISSION_DENIED",gt[gt.UNAUTHENTICATED=16]="UNAUTHENTICATED",gt[gt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",gt[gt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",gt[gt.ABORTED=10]="ABORTED",gt[gt.OUT_OF_RANGE=11]="OUT_OF_RANGE",gt[gt.UNIMPLEMENTED=12]="UNIMPLEMENTED",gt[gt.INTERNAL=13]="INTERNAL",gt[gt.UNAVAILABLE=14]="UNAVAILABLE",gt[gt.DATA_LOSS=15]="DATA_LOSS";var ga=(va.createSynthesizedRemoteEventForCurrentChange=function(e,t){var n=new Map;return n.set(e,ba.createSynthesizedTargetChangeForCurrentChange(e,t)),new va(zo.min(),n,ua,ra,sa())},va);function va(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var ba=(wa.createSynthesizedTargetChangeForCurrentChange=function(e,t){return new wa(Xr.EMPTY_BYTE_STRING,t,sa(),sa(),sa())},wa);function wa(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var Ta=function(e,t,n,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=n,this.newDoc=r},Sa=function(e,t){this.targetId=e,this.existenceFilter=t},Ia=function(e,t,n,r){void 0===n&&(n=Xr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},Ea=(Object.defineProperty(Ca.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(Ca.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!1,configurable:!0}),Object.defineProperty(Ca.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!1,configurable:!0}),Object.defineProperty(Ca.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!1,configurable:!0}),Ca.prototype.updateResumeToken=function(e){0<e.approximateByteSize()&&(this._hasPendingChanges=!0,this._resumeToken=e)},Ca.prototype.toTargetChange=function(){var n=sa(),r=sa(),i=sa();return this.documentChanges.forEach(function(e,t){switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:Pr("Encountered invalid change type: "+t)}}),new ba(this._resumeToken,this._current,n,r,i)},Ca.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=Aa()},Ca.prototype.addDocumentChange=function(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)},Ca.prototype.removeDocumentChange=function(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)},Ca.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},Ca.prototype.recordTargetResponse=function(){--this.pendingResponses},Ca.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},Ca);function Ca(){this.pendingResponses=0,this.documentChanges=Aa(),this._resumeToken=Xr.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}var Da=(_a.prototype.handleDocumentChange=function(e){for(var t=0,n=e.updatedTargetIds;t<n.length;t++){var r=n[t];e.newDoc instanceof qi?this.addDocumentToTarget(r,e.newDoc):e.newDoc instanceof Vi&&this.removeDocumentFromTarget(r,e.key,e.newDoc)}for(var i=0,o=e.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,e.key,e.newDoc)},_a.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(e){var t=r.ensureTargetState(e);switch(n.state){case 0:r.isActiveTarget(e)&&t.updateResumeToken(n.resumeToken);break;case 1:t.recordTargetResponse(),t.isPending||t.clearPendingChanges(),t.updateResumeToken(n.resumeToken);break;case 2:t.recordTargetResponse(),t.isPending||r.removeTarget(e),qr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:r.isActiveTarget(e)&&(t.markCurrent(),t.updateResumeToken(n.resumeToken));break;case 4:r.isActiveTarget(e)&&(r.resetTarget(e),t.updateResumeToken(n.resumeToken));break;default:Pr("Unknown target watch change state: "+n.state)}})},_a.prototype.forEachTarget=function(e,n){var r=this;0<e.targetIds.length?e.targetIds.forEach(n):this.targetStates.forEach(function(e,t){r.isActiveTarget(t)&&n(t)})},_a.prototype.handleExistenceFilter=function(e){var t=e.targetId,n=e.existenceFilter.count;(e=this.targetDataForActiveTarget(t))&&(Yi(e=e.target)?0===n?(e=new li(e.path),this.removeDocumentFromTarget(t,e,new Vi(e,zo.min()))):Mr(1===n,"Single document existence filter with count: "+n):this.getCurrentDocumentCountForTarget(t)!==n&&(this.resetTarget(t),this.pendingTargetResets=this.pendingTargetResets.add(t)))},_a.prototype.createRemoteEvent=function(r){var i=this,o=new Map;this.targetStates.forEach(function(e,t){var n=i.targetDataForActiveTarget(t);n&&(e.current&&Yi(n.target)&&(n=new li(n.target.path),null!==i.pendingDocumentUpdates.get(n)||i.targetContainsDocument(t,n)||i.removeDocumentFromTarget(t,n,new Vi(n,r))),e.hasPendingChanges&&(o.set(t,e.toTargetChange()),e.clearPendingChanges()))});var a=sa();this.pendingDocumentTargetMapping.forEach(function(e,t){var n=!0;t.forEachWhile(function(e){return!(e=i.targetDataForActiveTarget(e))||2===e.purpose||(n=!1)}),n&&(a=a.add(e))});var e=new ga(r,o,this.pendingTargetResets,this.pendingDocumentUpdates,a);return this.pendingDocumentUpdates=ra,this.pendingDocumentTargetMapping=ka(),this.pendingTargetResets=new Zo(Ur),e},_a.prototype.addDocumentToTarget=function(e,t){var n;this.isActiveTarget(e)&&(n=this.targetContainsDocument(e,t.key)?2:0,this.ensureTargetState(e).addDocumentChange(t.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e)))},_a.prototype.removeDocumentFromTarget=function(e,t,n){var r;this.isActiveTarget(e)&&(r=this.ensureTargetState(e),this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n)))},_a.prototype.removeTarget=function(e){this.targetStates.delete(e)},_a.prototype.getCurrentDocumentCountForTarget=function(e){var t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size},_a.prototype.recordPendingTargetRequest=function(e){this.ensureTargetState(e).recordPendingTargetRequest()},_a.prototype.ensureTargetState=function(e){var t=this.targetStates.get(e);return t||(t=new Ea,this.targetStates.set(e,t)),t},_a.prototype.ensureDocumentTargetMapping=function(e){var t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Zo(Ur),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t},_a.prototype.isActiveTarget=function(e){var t=null!==this.targetDataForActiveTarget(e);return t||xr("WatchChangeAggregator","Detected inactive target",e),t},_a.prototype.targetDataForActiveTarget=function(e){var t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)},_a.prototype.resetTarget=function(t){var n=this;qr(!this.targetStates.get(t).isPending,"Should only reset active targets"),this.targetStates.set(t,new Ea),this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(e){n.removeDocumentFromTarget(t,e,null)})},_a.prototype.targetContainsDocument=function(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)},_a);function _a(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=ra,this.pendingDocumentTargetMapping=ka(),this.pendingTargetResets=new Zo(Ur)}function ka(){return new Go(li.comparator)}function Aa(){return new Go(li.comparator)}var Na={asc:"ASCENDING",desc:"DESCENDING"},xa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};function Oa(e,t){qr(!$r(e),t+" is missing")}var Ra=function(e,t){this.databaseId=e,this.useProto3Json=t};function La(e){return{integerValue:""+e}}function Pa(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zr(t)?"-0":t}}function Ma(e,t){return ei(t)?La(t):Pa(e,t)}function qa(e,t){return e.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function Fa(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Ba(e){return Mr(!!e,"Trying to deserialize version that isn't set"),zo.fromTimestamp((e=Ci(e),new Qr(e.seconds,e.nanos)))}function Va(e,t){return new ii(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Ua(e){return Mr(is(e=ii.fromString(e)),"Tried to deserialize invalid key "+e.toString()),e}function Ka(e,t){return Va(e.databaseId,t.path)}function ja(e,t){if((t=Ua(t)).get(1)!==e.databaseId.projectId)throw new Dr(Cr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+e.databaseId.projectId);if(t.get(3)!==e.databaseId.database)throw new Dr(Cr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+e.databaseId.database);return new li(Wa(t))}function za(e,t){return Va(e.databaseId,t)}function Qa(e){return 4===(e=Ua(e)).length?ii.emptyPath():Wa(e)}function Ga(e){return new ii(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Wa(e){return Mr(4<e.length&&"documents"===e.get(4),"tried to deserialize invalid key "+e.toString()),e.popFirst(5)}function Ha(e,t,n){return{name:Ka(e,t),fields:n.proto.mapValue.fields}}function Ya(e,t){var n,r,i;if(t instanceof Ms)n={update:Ha(e,t.key,t.value)};else if(t instanceof Hs)n={delete:Ka(e,t.key)};else if(t instanceof Bs)n={update:Ha(e,t.key,t.data),updateMask:(r=t.fieldMask,i=[],r.fields.forEach(function(e){return i.push(e.canonicalString())}),{fieldPaths:i})};else if(t instanceof js)n={transform:{document:Ka(e,t.key),fieldTransforms:t.fieldTransforms.map(function(e){var t=e.transform;if(t instanceof ss)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof ls)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof ps)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof vs)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw Pr("Unknown transform: "+e.transform)})}};else{if(!(t instanceof Js))return Pr("Unknown mutation type "+t.type);n={verify:Ka(e,t.key)}}return t.precondition.isNone||(n.currentDocument=(qr(!(t=t.precondition).isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:qa(e,t.updateTime.toTimestamp())}:void 0!==t.exists?{exists:t.exists}:Pr("Unknown precondition"))),n}function Xa(i,e){var t,n=e.currentDocument?void 0!==(a=e.currentDocument).updateTime?_s.updateTime(Ba(a.updateTime)):void 0!==a.exists?_s.exists(a.exists):_s.none():_s.none();if(e.update){Oa(e.update.name,"name");var r=ja(i,e.update.name),o=new ca({mapValue:{fields:e.update.fields}});if(e.updateMask){var a=(t=(t=e.updateMask).fieldPaths||[],new Ss(t.map(function(e){return ui.fromServerFormat(e)})));return new Bs(r,o,a,n)}return new Ms(r,o,n)}return e.delete?(r=ja(i,e.delete),new Hs(r,n)):e.transform?(r=ja(i,e.transform.document),o=e.transform.fieldTransforms.map(function(e){return t=i,r=null,"setToServerValue"in(e=e)?(Mr("REQUEST_TIME"===e.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(e)),r=new ss):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new ls(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new ps(n)):"increment"in e?r=new vs(t,e.increment):Pr("Unknown transform proto: "+JSON.stringify(e)),e=ui.fromServerFormat(e.fieldPath),new Es(e,r);var t,n,r}),Mr(!0===n.exists,'Transforms only support precondition "exists == true"'),new js(r,o)):e.verify?(r=ja(i,e.verify),new Js(r,n)):Pr("unknown mutation proto: "+JSON.stringify(e))}function Ja(e,t){return{documents:[za(e,t.path)]}}function $a(e,t){var n={structuredQuery:{}},r=t.path;return null!==t.collectionGroup?(qr(r.length%2==0,"Collection Group queries should be within a document path or root."),n.parent=za(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(qr(r.length%2!=0,"Document queries with filters are not supported."),n.parent=za(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),(r=function(e){if(0!==e.length)return 1!==(e=e.map(function(e){return qr(e instanceof yo,"Only FieldFilters are supported"),function(e){if("=="===e.op){if(Li(e.value))return{unaryFilter:{field:ns(e.field),op:"IS_NAN"}};if(Ri(e.value))return{unaryFilter:{field:ns(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Li(e.value))return{unaryFilter:{field:ns(e.field),op:"IS_NOT_NAN"}};if(Ri(e.value))return{unaryFilter:{field:ns(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ns(e.field),op:(t=e.op,xa[t]),value:e.value}};var t}(e)})).length?{compositeFilter:{op:"AND",filters:e}}:e[0]}(t.filters))&&(n.structuredQuery.where=r),(r=0!==(r=t.orderBy).length?r.map(function(e){return{field:ns(e.field),direction:(e=e.dir,Na[e])}}):void 0)&&(n.structuredQuery.orderBy=r),r=e,e=t.limit,null!==(e=r.useProto3Json||$r(e)?e:{value:e})&&(n.structuredQuery.limit=e),t.startAt&&(n.structuredQuery.startAt=es(t.startAt)),t.endAt&&(n.structuredQuery.endAt=es(t.endAt)),n}function Za(e){var t=Qa(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Mr(1===r,"StructuredQuery.from with more than one collection is not supported."),(a=n.from[0]).allDescendants?i=a.collectionId:t=t.child(a.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=rs(e.unaryFilter.field);return yo.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=rs(e.unaryFilter.field);return yo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":return n=rs(e.unaryFilter.field),yo.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return e=rs(e.unaryFilter.field),yo.create(e,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Pr("Unspecified filter");default:return Pr("Unknown filter")}}(t)]:void 0!==t.fieldFilter?[(n=t,yo.create(rs(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Pr("Unspecified operator");default:return Pr("Unknown operator")}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(e).reduce(function(e,t){return e.concat(t)}):Pr("Unknown filter: "+JSON.stringify(t)):[];var n}(n.where)),e=[],n.orderBy&&(e=n.orderBy.map(function(e){return new jo(rs(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())})),r=null,n.limit&&(r=$r(s="object"==typeof(s=n.limit)?s.value:s)?null:s);var a=null;n.startAt&&(a=ts(n.startAt));var s=null;return n.endAt&&(s=ts(n.endAt)),Ji(t,i,e,o,r,"F",a,s)}function es(e){return{before:e.before,values:e.position}}function ts(e){var t=!!e.before,e=e.values||[];return new Bo(e,t)}function ns(e){return{fieldPath:e.canonicalString()}}function rs(e){return ui.fromServerFormat(e.fieldPath)}function is(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function os(e,t){return e instanceof vs?Ni(t)?t:{integerValue:0}:null}var as,ss=(n(us,as=vt=function(){this._=void 0}),us);function us(){return null!==as&&as.apply(this,arguments)||this}var cs,ls=(n(hs,cs=vt),hs);function hs(e){var t=cs.call(this)||this;return t.elements=e,t}function fs(e,t){for(var n=Ts(t),r=0,i=e.elements;r<i.length;r++)!function(t){n.some(function(e){return wi(e,t)})||n.push(t)}(i[r]);return{arrayValue:{values:n}}}var ds,ps=(n(ys,ds=vt),ys);function ys(e){var t=ds.call(this)||this;return t.elements=e,t}function ms(e,t){for(var n=Ts(t),r=0,i=e.elements;r<i.length;r++)!function(t){n=n.filter(function(e){return!wi(e,t)})}(i[r]);return{arrayValue:{values:n}}}var gs,vs=(n(bs,gs=vt),bs);function bs(e,t){var n=gs.call(this)||this;return n.serializer=e,qr(Ni(n.operand=t),"NumericIncrementTransform transform requires a NumberValue"),n}function ws(e){return Di(e.integerValue||e.doubleValue)}function Ts(e){return xi(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Ss=(Is.prototype.covers=function(e){for(var t=0,n=this.fields;t<n.length;t++)if(n[t].isPrefixOf(e))return!0;return!1},Is.prototype.isEqual=function(e){return Kr(this.fields,e.fields,function(e,t){return e.isEqual(t)})},Is);function Is(n){(this.fields=n).sort(ui.comparator),qr(!n.some(function(e,t){return 0!==t&&e.isEqual(n[t-1])}),"FieldMask contains field that is not unique: "+n.find(function(e,t){return 0!==t&&e.isEqual(n[t-1])}))}var Es=function(e,t){this.field=e,this.transform=t};function Cs(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof ls&&t instanceof ls||e instanceof ps&&t instanceof ps?Kr(e.elements,t.elements,wi):e instanceof vs&&t instanceof vs?wi(e.operand,t.operand):e instanceof ss&&t instanceof ss)}function Ds(e,t){this.version=e,this.transformResults=t}var _s=(ks.none=function(){return new ks},ks.exists=function(e){return new ks(void 0,e)},ks.updateTime=function(e){return new ks(e)},Object.defineProperty(ks.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),ks.prototype.isEqual=function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)},ks);function ks(e,t){this.updateTime=e,this.exists=t,qr(void 0===e||void 0===t,'Precondition can specify "exists" or "updateTime" but not both')}function As(e,t){return void 0!==e.updateTime?t instanceof qi&&t.version.isEqual(e.updateTime):void 0!==e.exists?e.exists===t instanceof qi:(qr(e.isNone,"Precondition should be empty"),1)}function Ns(e,t,n){return Rs(e,t),e instanceof Ms?(i=e,qr(null==(o=n).transformResults,"Transform results received by SetMutation."),new qi(i.key,o.version,i.value,{hasCommittedMutations:!0})):e instanceof Bs?(r=e,o=t,qr(null==(i=n).transformResults,"Transform results received by PatchMutation."),As(r.precondition,o)?(o=Us(r,o),new qi(r.key,i.version,o,{hasCommittedMutations:!0})):new ji(r.key,i.version)):e instanceof js?function(e,t,n){if(Mr(null!=n.transformResults,"Transform results missing for TransformMutation."),!As(e.precondition,t))return new ji(e.key,n.version);var r=Qs(e,t),t=function(e,t,n){var r=[];Mr(e.length===n.length,"server transform result count ("+n.length+") should match field transform count ("+e.length+")");for(var i=0;i<n.length;i++){var o=e[i],a=o.transform,s=null;t instanceof qi&&(s=t.field(o.field)),r.push((o=a,a=s,s=n[i],o instanceof ls?fs(o,a):o instanceof ps?ms(o,a):(qr(null!==s,"Didn't receive transformResult for non-array transform"),s)))}return r}(e.fieldTransforms,t,n.transformResults),n=n.version,t=Gs(e,r.data(),t);return new qi(e.key,n,t,{hasCommittedMutations:!0})}(e,t,n):(qr(e instanceof Hs,"Unexpected mutation type: "+e),qr(null==n.transformResults,"Transform results received by DeleteMutation."),new Vi(e.key,n.version,{hasCommittedMutations:!0}));var r,i,o}function xs(e,t,n,r){return Rs(e,t),e instanceof Ms?(o=t,As((i=e).precondition,o)?(o=Ls(o),new qi(i.key,o,i.value,{hasLocalMutations:!0})):o):e instanceof Bs?function(e,t){if(!As(e.precondition,t))return t;var n=Ls(t),t=Us(e,t);return new qi(e.key,n,t,{hasLocalMutations:!0})}(e,t):e instanceof js?function(e,t,n,r){if(!As(e.precondition,t))return t;var i=Qs(e,t),r=function(e,t,n,r){for(var i,o,a=[],s=0,u=e;s<u.length;s++){var c=u[s],l=c.transform,h=null;n instanceof qi&&(h=n.field(c.field)),null===h&&r instanceof qi&&(h=r.field(c.field)),a.push((i=h,o=t,h=c=void 0,(l=l)instanceof ss?(c=o,o=i,h={fields:((h={})[di]={stringValue:fi},h[yi]={timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}},h)},o&&(h.fields[pi]=o),{mapValue:h}):l instanceof ls?fs(l,i):l instanceof ps?ms(l,i):(qr(l instanceof vs,"Expected NumericIncrementTransformOperation but was: "+l),l=ws(i=os(h=l,l=i))+ws(h.operand),Ai(i)&&Ai(h.operand)?La(l):Pa(h.serializer,l))))}return a}(e.fieldTransforms,n,t,r),r=Gs(e,i.data(),r);return new qi(e.key,i.version,r,{hasLocalMutations:!0})}(e,t,r,n):(qr(e instanceof Hs,"Unexpected mutation type: "+e),t=t,As((e=e).precondition,t)?(t&&qr(t.key.isEqual(e.key),"Can only apply mutation to document with same key"),new Vi(e.key,zo.min())):t);var i,o}function Os(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(0===e.type?e.value.isEqual(t.value):1===e.type?e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask):2!==e.type||Kr(e.fieldTransforms,e.fieldTransforms,Cs))}function Rs(e,t){null!=t&&qr(t.key.isEqual(e.key),"Can only apply a mutation to a document with the same key")}function Ls(e){return e instanceof qi?e.version:zo.min()}var Ps,Ms=(n(qs,Ps=l=function(){}),qs);function qs(e,t,n){var r=Ps.call(this)||this;return r.key=e,r.value=t,r.precondition=n,r.type=0,r}var Fs,Bs=(n(Vs,Fs=l),Vs);function Vs(e,t,n,r){var i=Fs.call(this)||this;return i.key=e,i.data=t,i.fieldMask=n,i.precondition=r,i.type=1,i}function Us(e,t){var t=t instanceof qi?t.data():ca.empty(),n=e,r=new ha(t);return n.fieldMask.fields.forEach(function(e){var t;e.isEmpty()||(null!==(t=n.data.field(e))?r.set(e,t):r.delete(e))}),r.build()}var Ks,js=(n(zs,Ks=l),zs);function zs(e,t){var n=Ks.call(this)||this;return n.key=e,n.fieldTransforms=t,n.type=2,n.precondition=_s.exists(!0),n}function Qs(e,t){return qr(t instanceof qi,"Unknown MaybeDocument type "+t),qr(t.key.isEqual(e.key),"Can only transform a document with the same key"),t}function Gs(e,t,n){qr(n.length===e.fieldTransforms.length,"TransformResults length mismatch.");for(var r=new ha(t),i=0;i<e.fieldTransforms.length;i++){var o=e.fieldTransforms[i];r.set(o.field,n[i])}return r.build()}var Ws,Hs=(n(Ys,Ws=l),Ys);function Ys(e,t){var n=Ws.call(this)||this;return n.key=e,n.precondition=t,n.type=3,n}var Xs,Js=(n($s,Xs=l),$s);function $s(e,t){var n=Xs.call(this)||this;return n.key=e,n.precondition=t,n.type=4,n}var Zs=-1,eu=(tu.prototype.applyToRemoteDocument=function(e,t,n){t&&qr(t.key.isEqual(e),"applyToRemoteDocument: key "+e+" should match maybeDoc key\n        "+t.key);var r=n.mutationResults;qr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(e)&&(t=Ns(o,t,r[i]))}return t},tu.prototype.applyToLocalView=function(e,t){t&&qr(t.key.isEqual(e),"applyToLocalDocument: key "+e+" should match maybeDoc key\n        "+t.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(i=r[n]).key.isEqual(e)&&(t=xs(i,t,t,this.localWriteTime));for(var i,o=t,a=0,s=this.mutations;a<s.length;a++)(i=s[a]).key.isEqual(e)&&(t=xs(i,t,o,this.localWriteTime));return t},tu.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(e){var t=r.applyToLocalView(e.key,n.get(e.key));t&&(i=i.insert(e.key,t))}),i},tu.prototype.keys=function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},sa())},tu.prototype.isEqual=function(e){return this.batchId===e.batchId&&Kr(this.mutations,e.mutations,Os)&&Kr(this.baseMutations,e.baseMutations,Os)},tu);function tu(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,qr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var nu=(ru.from=function(e,t,n){Mr(e.mutations.length===n.length,"Mutations sent "+e.mutations.length+" must equal results received "+n.length);for(var r=oa,i=e.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new ru(e,t,n,r)},ru);function ru(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}var iu=(ou.prototype.get=function(e){var t=this.mapKeyFn(e);if(void 0!==(t=this.inner[t]))for(var n=0,r=t;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.equalsFn(i,e))return o}},ou.prototype.has=function(e){return void 0!==this.get(e)},ou.prototype.set=function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]},ou.prototype.delete=function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1},ou.prototype.forEach=function(a){Hr(this.inner,function(e,t){for(var n=0,r=t;n<r.length;n++){var i=(o=r[n])[0],o=o[1];a(i,o)}})},ou.prototype.isEmpty=function(){return Yr(this.inner)},ou);function ou(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}var au=(su.prototype.catch=function(e){return this.next(void 0,e)},su.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Pr("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new su(function(t,n){o.nextCallback=function(e){o.wrapSuccess(r,e).next(t,n)},o.catchCallback=function(e){o.wrapFailure(i,e).next(t,n)}})},su.prototype.toPromise=function(){var n=this;return new Promise(function(e,t){n.next(e,t)})},su.prototype.wrapUserFunction=function(e){try{var t=e();return t instanceof su?t:su.resolve(t)}catch(e){return su.reject(e)}},su.prototype.wrapSuccess=function(e,t){return e?this.wrapUserFunction(function(){return e(t)}):su.resolve(t)},su.prototype.wrapFailure=function(e,t){return e?this.wrapUserFunction(function(){return e(t)}):su.reject(t)},su.resolve=function(n){return new su(function(e,t){e(n)})},su.reject=function(n){return new su(function(e,t){t(n)})},su.waitFor=function(e){return new su(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(e){return n(e)})}),o=!0,i===r&&t()})},su.or=function(e){for(var n=su.resolve(!1),t=0,r=e;t<r.length;t++)!function(t){n=n.next(function(e){return e?su.resolve(e):t()})}(r[t]);return n},su.forEach=function(e,n){var r=this,i=[];return e.forEach(function(e,t){i.push(n.call(r,e,t))}),this.waitFor(i)},su);function su(e){var t=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(e){t.isDone=!0,t.result=e,t.nextCallback&&t.nextCallback(e)},function(e){t.isDone=!0,t.error=e,t.catchCallback&&t.catchCallback(e)})}var uu=(cu.prototype.getDocument=function(t,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,n).next(function(e){return r.getDocumentInternal(t,n,e)})},cu.prototype.getDocumentInternal=function(e,r,i){return this.remoteDocumentCache.getEntry(e,r).next(function(e){for(var t=0,n=i;t<n.length;t++)e=n[t].applyToLocalView(r,e);return e})},cu.prototype.applyLocalMutationsToDocuments=function(e,t,i){var o=ra;return t.forEach(function(e,t){for(var n=0,r=i;n<r.length;n++)t=r[n].applyToLocalView(e,t);o=o.insert(e,t)}),o},cu.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},cu.prototype.getLocalViewOfDocuments=function(t,r){var i=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,r).next(function(e){var e=i.applyLocalMutationsToDocuments(t,r,e),n=ra;return e.forEach(function(e,t){t=t||new Vi(e,zo.min()),n=n.insert(e,t)}),n})},cu.prototype.getDocumentsMatchingQuery=function(e,t,n){return ro(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):io(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)},cu.prototype.getDocumentsMatchingDocumentQuery=function(e,t){return this.getDocument(e,new li(t)).next(function(e){var t=ia;return e instanceof qi&&(t=t.insert(e.key,e)),t})},cu.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;qr(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=ia;return this.indexManager.getCollectionParents(n,a).next(function(e){return au.forEach(e,function(e){var t=(t=r,e=e.child(a),new Xi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return o.getDocumentsMatchingCollectionQuery(n,t,i).next(function(e){e.forEach(function(e,t){s=s.insert(e,t)})})}).next(function(){return s})})},cu.prototype.getDocumentsMatchingCollectionQuery=function(t,n,e){var u,c,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,e).next(function(e){return u=e,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,n)}).next(function(e){return c=e,r.addMissingBaseDocuments(t,c,u).next(function(e){u=e;for(var t=0,n=c;t<n.length;t++)for(var r=n[t],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,a=xs(a,a=u.get(s),a,r.localWriteTime);u=a instanceof qi?u.insert(s,a):u.remove(s)}})}).next(function(){return u.forEach(function(e,t){ho(n,t)||(u=u.remove(e))}),u})},cu.prototype.addMissingBaseDocuments=function(e,t,n){for(var r=sa(),i=0,o=t;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Bs&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(e,r).next(function(e){return e.forEach(function(e,t){null!==t&&t instanceof qi&&(c=c.insert(e,t))}),c})},cu);function cu(e,t,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.indexManager=n}var lu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",gt=(hu.prototype.addOnCommittedListener=function(e){this.onCommittedListeners.push(e)},hu.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(e){return e()})},hu);function hu(){this.onCommittedListeners=[]}var fu=(du.prototype.withSequenceNumber=function(e){return new du(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},du.prototype.withResumeToken=function(e,t){return new du(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)},du.prototype.withLastLimboFreeSnapshotVersion=function(e){return new du(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},du);function du(e,t,n,r,i,o,a){void 0===i&&(i=zo.min()),void 0===o&&(o=zo.min()),void 0===a&&(a=Xr.EMPTY_BYTE_STRING),this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var pu=(yu.prototype.setPreviousValue=function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue},yu.prototype.next=function(){var e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e},yu);function yu(e,t){var n=this;this.previousValue=e,t&&(t.sequenceNumberHandler=function(e){return n.setPreviousValue(e)},this.writeNewSequenceNumber=function(e){return t.writeSequenceNumber(e)})}pu.INVALID=-1;var mu="",gu="",vu="",bu="";function wu(e){for(var o="",t=0;t<e.length;t++)0<o.length&&(o=Tu(o)),o=function(e){for(var t=o,n=e.length,r=0;r<n;r++){var i=e.charAt(r);switch(i){case"\0":t+=mu+vu;break;case mu:t+=mu+bu;break;default:t+=i}}return t}(e.get(t));return Tu(o)}function Tu(e){return e+mu+gu}function Su(e){var t=e.length;if(Mr(2<=t,"Invalid path "+e),2===t)return Mr(e.charAt(0)===mu&&e.charAt(1)===gu,"Non-empty path "+e+" had length 2"),ii.emptyPath();for(var n=t-2,r=[],i="",o=0;o<t;){var a=e.indexOf(mu,o);switch((a<0||n<a)&&Pr('Invalid encoded resource path: "'+e+'"'),e.charAt(a+1)){case gu:var s=e.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case vu:i+=e.substring(o,a),i+="\0";break;case bu:i+=e.substring(o,a+1);break;default:Pr('Invalid encoded resource path: "'+e+'"')}o=a+2}return new ii(r)}var Iu=function(e){this.remoteSerializer=e};function Eu(e,t){if(t.document)return i=e.remoteSerializer,o=t.document,r=!!t.hasCommittedMutations,e=ja(i,o.name),i=Ba(o.updateTime),o=new ca({mapValue:{fields:o.fields}}),new qi(e,i,o,{hasCommittedMutations:!!r});if(t.noDocument){var n=li.fromSegments(t.noDocument.path),r=Au(t.noDocument.readTime);return new Vi(n,r,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(n=li.fromSegments(t.unknownDocument.path),t=Au(t.unknownDocument.version),new ji(n,t)):Pr("Unexpected DbRemoteDocument");var i,o}function Cu(e,t,n){var r=Du(n),n=t.key.path.popLast().toArray();if(t instanceof qi){var i=(i=e.remoteSerializer,qr(!(o=t).hasLocalMutations,"Can't serialize documents with mutations."),{name:Ka(i,o.key),fields:o.toProto().mapValue.fields,updateTime:qa(i,o.version.toTimestamp())}),o=t.hasCommittedMutations;return new Ac(null,null,i,o,r,n)}if(t instanceof Vi){var a=t.key.path.toArray(),i=ku(t.version),o=t.hasCommittedMutations;return new Ac(null,new _c(a,i),null,o,r,n)}return t instanceof ji?(a=t.key.path.toArray(),t=ku(t.version),new Ac(new kc(a,t),null,null,!0,r,n)):Pr("Unexpected MaybeDocument")}function Du(e){return[(e=e.toTimestamp()).seconds,e.nanoseconds]}function _u(e){return e=new Qr(e[0],e[1]),zo.fromTimestamp(e)}function ku(e){return e=e.toTimestamp(),new Tc(e.seconds,e.nanoseconds)}function Au(e){return e=new Qr(e.seconds,e.nanoseconds),zo.fromTimestamp(e)}function Nu(t,e){var n=(e.baseMutations||[]).map(function(e){return Xa(t.remoteSerializer,e)}),r=e.mutations.map(function(e){return Xa(t.remoteSerializer,e)}),i=Qr.fromMillis(e.localWriteTimeMs);return new eu(e.batchId,i,n,r)}function xu(e){var t,n=Au(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?Au(e.lastLimboFreeSnapshotVersion):zo.min(),i=void 0!==e.query.documents?(Mr(1===(t=(i=e.query).documents.length),"DocumentsTarget contained other than 1 document: "+t),ao($i(Qa(i.documents[0])))):ao(Za(e.query));return new fu(i,e.targetId,0,e.lastListenSequenceNumber,n,r,Xr.fromBase64String(e.resumeToken))}function Ou(e,t){qr(0===t.purpose,"Only queries with purpose 0 may be stored, got "+t.purpose);var n=ku(t.snapshotVersion),r=ku(t.lastLimboFreeSnapshotVersion),i=(Yi(t.target)?Ja:$a)(e.remoteSerializer,t.target),e=t.resumeToken.toBase64();return new xc(t.targetId,Wi(t.target),n,e,t.sequenceNumber,r,i)}function Ru(e){var t=Za({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?(qr(!!t.limit,"Bundled query has limitType LAST, but limit is null"),so(t,t.limit,"L")):t}var Lu=(Pu.forUser=function(e,t,n,r){return Mr(""!==e.uid,"UserID must not be an empty string."),new Pu(e.isAuthenticated()?e.uid:"",t,n,r)},Pu.prototype.checkEmpty=function(e){var r=!0,t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Fu(e).iterate({index:Ec.userMutationsIndex,range:t},function(e,t,n){r=!1,n.done()}).next(function(){return r})},Pu.prototype.addMutationBatch=function(p,y,m,g){var v=this,b=Bu(p),w=Fu(p);return w.add({}).next(function(e){Mr("number"==typeof e,"Auto-generated key is not a number");for(var t,n,r,i,o,a=new eu(e,y,m,g),s=(t=v.serializer,n=v.userId,i=(r=a).baseMutations.map(function(e){return Ya(t.remoteSerializer,e)}),o=r.mutations.map(function(e){return Ya(t.remoteSerializer,e)}),new Ec(n,r.batchId,r.localWriteTime.toMillis(),i,o)),u=[],c=new Zo(function(e,t){return Ur(e.canonicalString(),t.canonicalString())}),l=0,h=g;l<h.length;l++){var f=h[l],d=Cc.key(v.userId,f.key.path,e),c=c.add(f.key.path.popLast());u.push(w.put(s)),u.push(b.put(d,Cc.PLACEHOLDER))}return c.forEach(function(e){u.push(v.indexManager.addToCollectionParentIndex(p,e))}),p.addOnCommittedListener(function(){v.documentKeysByBatchId[e]=a.keys()}),au.waitFor(u).next(function(){return a})})},Pu.prototype.lookupMutationBatch=function(e,t){var n=this;return Fu(e).get(t).next(function(e){return e?(Mr(e.userId===n.userId,"Unexpected user '"+e.userId+"' for mutation batch "+t),Nu(n.serializer,e)):null})},Pu.prototype.lookupMutationKeys=function(e,t){var n=this;return this.documentKeysByBatchId[t]?au.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(function(e){return e?(e=e.keys(),n.documentKeysByBatchId[t]=e):null})},Pu.prototype.getNextMutationBatchAfterBatchId=function(e,t){var r=this,i=t+1,t=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Fu(e).iterate({index:Ec.userMutationsIndex,range:t},function(e,t,n){t.userId===r.userId&&(Mr(t.batchId>=i,"Should have found mutation after "+i),o=Nu(r.serializer,t)),n.done()}).next(function(){return o})},Pu.prototype.getHighestUnacknowledgedBatchId=function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Zs;return Fu(e).iterate({index:Ec.userMutationsIndex,range:t,reverse:!0},function(e,t,n){r=t.batchId,n.done()}).next(function(){return r})},Pu.prototype.getAllMutationBatches=function(e){var t=this,n=IDBKeyRange.bound([this.userId,Zs],[this.userId,Number.POSITIVE_INFINITY]);return Fu(e).loadAll(Ec.userMutationsIndex,n).next(function(e){return e.map(function(e){return Nu(t.serializer,e)})})},Pu.prototype.getAllMutationBatchesAffectingDocumentKey=function(a,s){var u=this,e=Cc.prefixForPath(this.userId,s.path),e=IDBKeyRange.lowerBound(e),c=[];return Bu(a).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],i=Su(i);if(r===u.userId&&s.path.isEqual(i))return Fu(a).get(o).next(function(e){if(!e)throw Pr("Dangling document-mutation reference found: "+t+" which points to "+o);Mr(e.userId===u.userId,"Unexpected user '"+e.userId+"' for mutation batch "+o),c.push(Nu(u.serializer,e))});n.done()}).next(function(){return c})},Pu.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var a=this,s=new Zo(Ur),n=[];return e.forEach(function(o){var e=Cc.prefixForPath(a.userId,o.path),e=IDBKeyRange.lowerBound(e),e=Bu(t).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],e=e[2],i=Su(i);r===a.userId&&o.path.isEqual(i)?s=s.add(e):n.done()});n.push(e)}),au.waitFor(n).next(function(){return a.lookupMutationBatches(t,s)})},Pu.prototype.getAllMutationBatchesAffectingQuery=function(e,t){var o=this;qr(!ro(t),"Document queries shouldn't go down this path"),qr(!io(t),"CollectionGroup queries should be handled in LocalDocumentsView");var a=t.path,s=a.length+1,t=Cc.prefixForPath(this.userId,a),t=IDBKeyRange.lowerBound(t),u=new Zo(Ur);return Bu(e).iterate({range:t},function(e,t,n){var r=e[0],i=e[1],e=e[2],i=Su(i);r===o.userId&&a.isPrefixOf(i)?i.length===s&&(u=u.add(e)):n.done()}).next(function(){return o.lookupMutationBatches(e,u)})},Pu.prototype.lookupMutationBatches=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Fu(e).get(t).next(function(e){if(null===e)throw Pr("Dangling document-mutation reference found, which points to "+t);Mr(e.userId===n.userId,"Unexpected user '"+e.userId+"' for mutation batch "+t),r.push(Nu(n.serializer,e))}))}),au.waitFor(i).next(function(){return r})},Pu.prototype.removeMutationBatch=function(t,n){var r=this;return qu(t.simpleDbTransaction,this.userId,n).next(function(e){return t.addOnCommittedListener(function(){r.removeCachedMutationKeys(n.batchId)}),au.forEach(e,function(e){return r.referenceDelegate.markPotentiallyOrphaned(t,e)})})},Pu.prototype.removeCachedMutationKeys=function(e){delete this.documentKeysByBatchId[e]},Pu.prototype.performConsistencyCheck=function(t){var i=this;return this.checkEmpty(t).next(function(e){if(!e)return au.resolve();var e=IDBKeyRange.lowerBound(Cc.prefixForUser(i.userId)),r=[];return Bu(t).iterate({range:e},function(e,t,n){e[0]===i.userId?(e=Su(e[1]),r.push(e)):n.done()}).next(function(){Mr(0===r.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+r.map(function(e){return e.canonicalString()}))})})},Pu.prototype.containsKey=function(e,t){return Mu(e,this.userId,t)},Pu.prototype.getMutationQueueMetadata=function(e){var t=this;return Vu(e).get(this.userId).next(function(e){return e||new Ic(t.userId,Zs,"")})},Pu);function Pu(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Mu(e,o,t){var a=(t=Cc.prefixForPath(o,t.path))[1],t=IDBKeyRange.lowerBound(t),s=!1;return Bu(e).iterate({range:t,keysOnly:!0},function(e,t,n){var r=e[0],i=e[1];e[2],r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function qu(e,t,n){var r=e.store(Ec.store),i=e.store(Cc.store),o=[],e=IDBKeyRange.only(n.batchId),a=0,e=r.iterate({range:e},function(e,t,n){return a++,n.delete()});o.push(e.next(function(){Mr(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var s=[],u=0,c=n.mutations;u<c.length;u++){var l=c[u],h=Cc.key(t,l.key.path,n.batchId);o.push(i.delete(h)),s.push(l.key)}return au.waitFor(o).next(function(){return s})}function Fu(e){return gl.getStore(e,Ec.store)}function Bu(e){return gl.getStore(e,Cc.store)}function Vu(e){return gl.getStore(e,Ic.store)}function Uu(){this.changes=new iu(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}Uu.prototype.getReadTime=function(e){var t=this.changes.get(e);return t?(qr(!!t.readTime,"Read time is not set for "+e+". All removeEntry() calls must include a readTime if 'trackRemovals' is used."),t.readTime):zo.min()},Uu.prototype.addEntry=function(e,t){this.assertNotApplied(),this.changes.set(e.key,{maybeDocument:e,readTime:t})},Uu.prototype.removeEntry=function(e,t){void 0===t&&(t=null),this.assertNotApplied(),this.changes.set(e,{maybeDocument:null,readTime:t})},Uu.prototype.getEntry=function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?au.resolve(n.maybeDocument):this.getFromCache(e,t)},Uu.prototype.getEntries=function(e,t){return this.getAllFromCache(e,t)},Uu.prototype.apply=function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)},Uu.prototype.assertNotApplied=function(){qr(!this.changesApplied,"Changes have already been applied.")},vt=Uu;var Ku=(ju.prototype.addEntry=function(e,t,n){return Hu(e).put(Yu(t),n)},ju.prototype.removeEntry=function(e,t){return e=Hu(e),t=Yu(t),e.delete(t)},ju.prototype.updateMetadata=function(t,n){var r=this;return this.getMetadata(t).next(function(e){return e.byteSize+=n,r.setMetadata(t,e)})},ju.prototype.getEntry=function(e,t){var n=this;return Hu(e).get(Yu(t)).next(function(e){return n.maybeDecodeDocument(e)})},ju.prototype.getSizedEntry=function(e,t){var n=this;return Hu(e).get(Yu(t)).next(function(e){var t=n.maybeDecodeDocument(e);return t?{maybeDocument:t,size:Xu(e)}:null})},ju.prototype.getEntries=function(e,t){var n=this,r=ra;return this.forEachDbEntry(e,t,function(e,t){t=n.maybeDecodeDocument(t),r=r.insert(e,t)}).next(function(){return r})},ju.prototype.getSizedEntries=function(e,t){var r=this,i=ra,o=new Go(li.comparator);return this.forEachDbEntry(e,t,function(e,t){var n=r.maybeDecodeDocument(t);o=n?(i=i.insert(e,n),o.insert(e,Xu(t))):(i=i.insert(e,null),o.insert(e,0))}).next(function(){return{maybeDocuments:i,sizeMap:o}})},ju.prototype.forEachDbEntry=function(e,t,i){if(t.isEmpty())return au.resolve();var n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),o=t.getIterator(),a=o.getNext();return Hu(e).iterate({range:n},function(e,t,n){for(var r=li.fromSegments(e);a&&li.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,t),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},ju.prototype.getDocumentsMatchingQuery=function(e,r,t){var i=this;qr(!io(r),"CollectionGroup queries should be handled in LocalDocumentsView");var n,o=ia,a=r.path.length+1,s={};return t.isEqual(zo.min())?(n=r.path.toArray(),s.range=IDBKeyRange.lowerBound(n)):(n=r.path.toArray(),t=Du(t),s.range=IDBKeyRange.lowerBound([n,t],!0),s.index=Ac.collectionReadTimeIndex),Hu(e).iterate(s,function(e,t,n){e.length===a&&(t=Eu(i.serializer,t),r.path.isPrefixOf(t.key.path)?t instanceof qi&&ho(r,t)&&(o=o.insert(t.key,t)):n.done())}).next(function(){return o})},ju.prototype.newChangeBuffer=function(e){return new Qu(this,!!e&&e.trackRemovals)},ju.prototype.getSize=function(e){return this.getMetadata(e).next(function(e){return e.byteSize})},ju.prototype.getMetadata=function(e){return Wu(e).get(Nc.key).next(function(e){return Mr(!!e,"Missing document cache metadata"),e})},ju.prototype.setMetadata=function(e,t){return Wu(e).put(Nc.key,t)},ju.prototype.maybeDecodeDocument=function(e){return!e||(e=Eu(this.serializer,e))instanceof Vi&&e.version.isEqual(zo.min())?null:e},ju);function ju(e,t){this.serializer=e,this.indexManager=t}var zu,Qu=(n(Gu,zu=vt),Gu.prototype.applyChanges=function(i){var o=this,a=[],s=0,u=new Zo(function(e,t){return Ur(e.canonicalString(),t.canonicalString())});return this.changes.forEach(function(e,t){var n,r=o.documentSizes.get(e);qr(void 0!==r,"Cannot modify a document that wasn't read (for "+e+")"),t.maybeDocument?(qr(!o.getReadTime(e).isEqual(zo.min()),"Cannot add a document with a read time of zero"),n=Cu(o.documentCache.serializer,t.maybeDocument,o.getReadTime(e)),u=u.add(e.path.popLast()),t=Xu(n),s+=t-r,a.push(o.documentCache.addEntry(i,e,n))):(s-=r,o.trackRemovals?(r=Cu(o.documentCache.serializer,new Vi(e,zo.min()),o.getReadTime(e)),a.push(o.documentCache.addEntry(i,e,r))):a.push(o.documentCache.removeEntry(i,e)))}),u.forEach(function(e){a.push(o.documentCache.indexManager.addToCollectionParentIndex(i,e))}),a.push(this.documentCache.updateMetadata(i,s)),au.waitFor(a)},Gu.prototype.getFromCache=function(e,t){var n=this;return this.documentCache.getSizedEntry(e,t).next(function(e){return null===e?(n.documentSizes.set(t,0),null):(n.documentSizes.set(t,e.size),e.maybeDocument)})},Gu.prototype.getAllFromCache=function(e,t){var n=this;return this.documentCache.getSizedEntries(e,t).next(function(e){var t=e.maybeDocuments;return e.sizeMap.forEach(function(e,t){n.documentSizes.set(e,t)}),t})},Gu);function Gu(e,t){var n=zu.call(this)||this;return n.documentCache=e,n.trackRemovals=t,n.documentSizes=new iu(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),n}function Wu(e){return gl.getStore(e,Nc.store)}function Hu(e){return gl.getStore(e,Ac.store)}function Yu(e){return e.path.toArray()}function Xu(e){var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Pr("Unknown remote document type");t=e.noDocument}return JSON.stringify(t).length}var Ju=($u.prototype.addToCollectionParentIndex=function(e,t){return this.collectionParentIndex.add(t),au.resolve()},$u.prototype.getCollectionParents=function(e,t){return au.resolve(this.collectionParentIndex.getEntries(t))},$u);function $u(){this.collectionParentIndex=new Zu}var Zu=(ec.prototype.add=function(e){qr(e.length%2==1,"Expected a collection path.");var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Zo(ii.comparator),e=!r.has(n);return this.index[t]=r.add(n),e},ec.prototype.has=function(e){var t=e.lastSegment(),e=e.popLast();return(t=this.index[t])&&t.has(e)},ec.prototype.getEntries=function(e){return(this.index[e]||new Zo(ii.comparator)).toArray()},ec);function ec(){this.index={}}var tc=function(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})},nc="SimpleDb",rc=(ic.delete=function(e){return xr(nc,"Removing database:",e),yc(window.indexedDB.deleteDatabase(e)).toPromise()},ic.isAvailable=function(){if("undefined"==typeof indexedDB)return!1;if(ic.isMockPersistence())return!0;var e=d(),t=0<(n=ic.getIOSVersion(e))&&n<10,n=0<(n=ic.getAndroidVersion(e))&&n<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||t||n)},ic.isMockPersistence=function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.USE_MOCK_PERSISTENCE)},ic.getStore=function(e,t){return e.store(t)},ic.getIOSVersion=function(e){return e=(e=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?e[1].split("_").slice(0,2).join("."):"-1",Number(e)},ic.getAndroidVersion=function(e){return e=(e=e.match(/Android ([\d.]+)/i))?e[1].split(".").slice(0,2).join("."):"-1",Number(e)},ic.prototype.ensureDb=function(o){return m(this,void 0,void 0,function(){var t,i=this;return g(this,function(e){switch(e.label){case 0:return this.db?[3,2]:(xr(nc,"Opening database:",this.name),t=this,[4,new Promise(function(t,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(e){e=e.target.result,t(e)},r.onblocked=function(){n(new uc(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(e){"VersionError"===(e=e.target.error).name?n(new Dr(Cr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new uc(o,e))},r.onupgradeneeded=function(e){xr(nc,'Database "'+i.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;i.schemaConverter.createOrUpgrade(t,r.transaction,e.oldVersion,i.version).next(function(){xr(nc,"Database upgrade to version "+i.version+" complete")})}})]);case 1:t.db=e.sent(),e.label=2;case 2:return this.versionchangelistener&&(this.db.onversionchange=function(e){return i.versionchangelistener(e)}),[2,this.db]}})})},ic.prototype.setVersionChangeListener=function(t){this.versionchangelistener=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},ic.prototype.runTransaction=function(s,n,u,c){return m(this,void 0,void 0,function(){var i,o,a,t;return g(this,function(e){switch(e.label){case 0:i="readonly"===n,o=0,t=function(){var t,n,r;return g(this,function(e){switch(e.label){case 0:++o,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,a.ensureDb(s)];case 2:return a.db=e.sent(),t=hc.open(a.db,s,i?"readonly":"readwrite",u),(r=c(t).catch(function(e){return t.abort(e),au.reject(e)}).toPromise()).catch(function(){}),[4,t.completionPromise];case 3:return e.sent(),[2,{value:r}];case 4:return n=e.sent(),r="FirebaseError"!==n.name&&o<3,xr(nc,"Transaction failed with error:",n.message,"Retrying:",r),a.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},a=this,e.label=1;case 1:return[5,t()];case 2:return"object"==typeof(t=e.sent())?[2,t.value]:[3,1];case 3:return[2]}})})},ic.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},ic);function ic(e,t,n){this.name=e,this.version=t,this.schemaConverter=n,qr(ic.isAvailable(),"IndexedDB not supported in current environment."),12.2===ic.getIOSVersion(d())&&Or("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var oc=(Object.defineProperty(ac.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!1,configurable:!0}),Object.defineProperty(ac.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!1,configurable:!0}),Object.defineProperty(ac.prototype,"cursor",{set:function(e){this.dbCursor=e},enumerable:!1,configurable:!0}),ac.prototype.done=function(){this.shouldStop=!0},ac.prototype.skip=function(e){this.nextKey=e},ac.prototype.delete=function(){return yc(this.dbCursor.delete())},ac);function ac(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}var sc,uc=(n(cc,sc=Dr),cc);function cc(e,t){return(t=sc.call(this,Cr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+t)||this).name="IndexedDbTransactionError",t}function lc(e){return"IndexedDbTransactionError"===e.name}var hc=(fc.open=function(e,t,n,r){try{return new fc(t,e.transaction(r,n))}catch(e){throw new uc(t,e)}},Object.defineProperty(fc.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!1,configurable:!0}),fc.prototype.abort=function(e){e&&this.completionDeferred.reject(e),this.aborted||(xr(nc,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},fc.prototype.store=function(e){var t=this.transaction.objectStore(e);return qr(!!t,"Object store not part of transaction: "+e),new dc(t)},fc);function fc(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.completionDeferred=new tc,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){e.error?n.completionDeferred.reject(new uc(t,e.error)):n.completionDeferred.resolve()},this.transaction.onerror=function(e){e=gc(e.target.error),n.completionDeferred.reject(new uc(t,e))}}var dc=(pc.prototype.put=function(e,t){return yc(e=void 0!==t?(xr(nc,"PUT",this.store.name,e,t),this.store.put(t,e)):(xr(nc,"PUT",this.store.name,"<auto-key>",e),this.store.put(e)))},pc.prototype.add=function(e){return xr(nc,"ADD",this.store.name,e,e),yc(this.store.add(e))},pc.prototype.get=function(t){var n=this;return yc(this.store.get(t)).next(function(e){return void 0===e&&(e=null),xr(nc,"GET",n.store.name,t,e),e})},pc.prototype.delete=function(e){return xr(nc,"DELETE",this.store.name,e),yc(this.store.delete(e))},pc.prototype.count=function(){return xr(nc,"COUNT",this.store.name),yc(this.store.count())},pc.prototype.loadAll=function(e,t){var t=this.cursor(this.options(e,t)),n=[];return this.iterateCursor(t,function(e,t){n.push(t)}).next(function(){return n})},pc.prototype.deleteAll=function(e,t){return xr(nc,"DELETE ALL",this.store.name),(t=this.options(e,t)).keysOnly=!1,t=this.cursor(t),this.iterateCursor(t,function(e,t,n){return n.delete()})},pc.prototype.iterate=function(e,t){t?n=e:(n={},t=e);var n=this.cursor(n);return this.iterateCursor(n,t)},pc.prototype.iterateSerial=function(r){var e=this.cursor({});return new au(function(n,t){e.onerror=function(e){e=gc(e.target.error),t(e)},e.onsuccess=function(e){var t=e.target.result;t?r(t.primaryKey,t.value).next(function(e){e?t.continue():n()}):n()}})},pc.prototype.iterateCursor=function(e,i){var o=[];return new au(function(r,t){e.onerror=function(e){t(e.target.error)},e.onsuccess=function(e){var t,n=e.target.result;n?(t=new oc(n),(e=i(n.primaryKey,n.value,t))instanceof au&&(e=e.catch(function(e){return t.done(),au.reject(e)}),o.push(e)),t.isDone?r():null===t.skipToKey?n.continue():n.continue(t.skipToKey)):r()}}).next(function(){return au.waitFor(o)})},pc.prototype.options=function(e,t){var n=void 0;return void 0!==e&&("string"==typeof e?n=e:(qr(void 0===t,"3rd argument must not be defined if 2nd is a range."),t=e)),{index:n,range:t}},pc.prototype.cursor=function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.keysOnly?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)},pc);function pc(e){this.store=e}function yc(e){return new au(function(t,n){e.onsuccess=function(e){e=e.target.result,t(e)},e.onerror=function(e){e=gc(e.target.error),n(e)}})}var mc=!1;function gc(e){var t=rc.getIOSVersion(d());if(12.2<=t&&t<13&&(t="An internal error was encountered in the Indexed Database server",0<=e.message.indexOf(t))){var n=new Dr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+t+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return mc||(mc=!0,setTimeout(function(){throw n},0)),n}return e}var vc=11,bc=(wc.prototype.createOrUpgrade=function(t,n,e,r){var i=this;Mr(e<r&&0<=e&&r<=vc,"Unexpected schema upgrade from v"+e+" to v"+r+".");var o=new hc("createOrUpgrade",n);e<1&&1<=r&&(t.createObjectStore(Sc.store),(a=t).createObjectStore(Ic.store,{keyPath:Ic.keyPath}),a.createObjectStore(Ec.store,{keyPath:Ec.keyPath,autoIncrement:!0}).createIndex(Ec.userMutationsIndex,Ec.userMutationsKeyPath,{unique:!0}),a.createObjectStore(Cc.store),Pc(t),t.createObjectStore(Ac.store));var a,s=au.resolve();return e<3&&3<=r&&(0!==e&&((a=t).deleteObjectStore(Oc.store),a.deleteObjectStore(xc.store),a.deleteObjectStore(Rc.store),Pc(t)),s=s.next(function(){return t=(e=o).store(Rc.store),e=new Rc(0,0,zo.min().toTimestamp(),0),t.put(Rc.key,e);var e,t})),e<4&&4<=r&&(0!==e&&(s=s.next(function(){return n=t,(r=o).store(Ec.store).loadAll().next(function(e){n.deleteObjectStore(Ec.store),n.createObjectStore(Ec.store,{keyPath:Ec.keyPath,autoIncrement:!0}).createIndex(Ec.userMutationsIndex,Ec.userMutationsKeyPath,{unique:!0});var t=r.store(Ec.store),e=e.map(function(e){return t.put(e)});return au.waitFor(e)});var n,r})),s=s.next(function(){t.createObjectStore(Mc.store,{keyPath:Mc.keyPath})})),e<5&&5<=r&&(s=s.next(function(){return i.removeAcknowledgedMutations(o)})),e<6&&6<=r&&(s=s.next(function(){return t.createObjectStore(Nc.store),i.addDocumentGlobal(o)})),e<7&&7<=r&&(s=s.next(function(){return i.ensureSequenceNumbers(o)})),e<8&&8<=r&&(s=s.next(function(){return i.createCollectionParentIndex(t,o)})),e<9&&9<=r&&(s=s.next(function(){var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(e=(e=n).objectStore(Ac.store)).createIndex(Ac.readTimeIndex,Ac.readTimeIndexPath,{unique:!1}),e.createIndex(Ac.collectionReadTimeIndex,Ac.collectionReadTimeIndexPath,{unique:!1})})),e<10&&10<=r&&(s=s.next(function(){return i.rewriteCanonicalIds(o)})),e<11&&11<=r&&(s=s.next(function(){t.createObjectStore(qc.store,{keyPath:qc.keyPath}),t.createObjectStore(Fc.store,{keyPath:Fc.keyPath})})),s},wc.prototype.addDocumentGlobal=function(t){var n=0;return t.store(Ac.store).iterate(function(e,t){n+=Xu(t)}).next(function(){var e=new Nc(n);return t.store(Nc.store).put(Nc.key,e)})},wc.prototype.removeAcknowledgedMutations=function(n){var r=this,e=n.store(Ic.store),i=n.store(Ec.store);return e.loadAll().next(function(e){return au.forEach(e,function(t){var e=IDBKeyRange.bound([t.userId,Zs],[t.userId,t.lastAcknowledgedBatchId]);return i.loadAll(Ec.userMutationsIndex,e).next(function(e){return au.forEach(e,function(e){return Mr(e.userId===t.userId,"Cannot process batch "+e.batchId+" from unexpected user"),e=Nu(r.serializer,e),qu(n,t.userId,e).next(function(){})})})})})},wc.prototype.ensureSequenceNumbers=function(e){var o=e.store(Oc.store),t=e.store(Ac.store);return e.store(Rc.store).get(Rc.key).next(function(r){qr(!!r,"Metadata should have been written during the version 3 migration");var i=[];return t.iterate(function(e,t){var n=new ii(e),e=[0,wu(n)];i.push(o.get(e).next(function(e){return e?au.resolve():(e=n,o.put(new Oc(0,wu(e),r.highestListenSequenceNumber)))}))}).next(function(){return au.waitFor(i)})})},wc.prototype.createCollectionParentIndex=function(e,t){function r(e){if(i.add(e)){var t=e.lastSegment(),e=e.popLast();return n.put({collectionId:t,parent:wu(e)})}}e.createObjectStore(Lc.store,{keyPath:Lc.keyPath});var n=t.store(Lc.store),i=new Zu;return t.store(Ac.store).iterate({keysOnly:!0},function(e,t){return r((e=new ii(e)).popLast())}).next(function(){return t.store(Cc.store).iterate({keysOnly:!0},function(e,t){e[0];var n=e[1];return r((n=(e[2],Su(n))).popLast())})})},wc.prototype.rewriteCanonicalIds=function(e){var n=this,r=e.store(xc.store);return r.iterate(function(e,t){return t=xu(t),t=Ou(n.serializer,t),r.put(t)})},wc);function wc(e){this.serializer=e}var Tc=function(e,t){this.seconds=e,this.nanoseconds=t},Sc=function(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n};Sc.store="owner",Sc.key="owner";var Ic=function(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n};Ic.store="mutationQueues",Ic.keyPath="userId";var Ec=function(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ec.store="mutations",Ec.keyPath="batchId",Ec.userMutationsIndex="userMutationsIndex",Ec.userMutationsKeyPath=["userId","batchId"];var Cc=(Dc.prefixForUser=function(e){return[e]},Dc.prefixForPath=function(e,t){return[e,wu(t)]},Dc.key=function(e,t,n){return[e,wu(t),n]},Dc);function Dc(){}Cc.store="documentMutations",Cc.PLACEHOLDER=new Cc;var _c=function(e,t){this.path=e,this.readTime=t},kc=function(e,t){this.path=e,this.version=t},Ac=function(e,t,n,r,i,o){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ac.store="remoteDocuments",Ac.readTimeIndex="readTimeIndex",Ac.readTimeIndexPath="readTime",Ac.collectionReadTimeIndex="collectionReadTimeIndex",Ac.collectionReadTimeIndexPath=["parentPath","readTime"];var Nc=function(e){this.byteSize=e};Nc.store="remoteDocumentGlobal",Nc.key="remoteDocumentGlobalKey";var xc=function(e,t,n,r,i,o,a){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a};xc.store="targets",xc.keyPath="targetId",xc.queryTargetsIndexName="queryTargetsIndex",xc.queryTargetsKeyPath=["canonicalId","targetId"];var Oc=function(e,t,n){this.targetId=e,this.path=t,qr(0===e==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")};Oc.store="targetDocuments",Oc.keyPath=["targetId","path"],Oc.documentTargetsIndex="documentTargetsIndex",Oc.documentTargetsKeyPath=["path","targetId"];var Rc=function(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Rc.key="targetGlobalKey",Rc.store="targetGlobal";var Lc=function(e,t){this.collectionId=e,this.parent=t};function Pc(e){e.createObjectStore(Oc.store,{keyPath:Oc.keyPath}).createIndex(Oc.documentTargetsIndex,Oc.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(xc.store,{keyPath:xc.keyPath}).createIndex(xc.queryTargetsIndexName,xc.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Rc.store)}Lc.store="collectionParents",Lc.keyPath=["collectionId","parent"];var Mc=function(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r};Mc.store="clientMetadata",Mc.keyPath="clientId";var qc=function(e,t,n){this.bundleId=e,this.createTime=t,this.version=n};qc.store="bundles",qc.keyPath="bundleId";var Fc=function(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n};Fc.store="namedQueries",Fc.keyPath="name";var l=a([Ic.store,Ec.store,Cc.store,Ac.store,xc.store,Sc.store,Rc.store,Oc.store],[Mc.store]),l=a(l,[Nc.store]),l=a(l,[Lc.store]),Bc=a(l,[qc.store,Fc.store]),Vc=(Uc.prototype.getBundleMetadata=function(e,t){return Kc(e).get(t).next(function(e){if(e)return{id:e.bundleId,createTime:Au(e.createTime),version:e.version}})},Uc.prototype.saveBundleMetadata=function(e,t){return Kc(e).put({bundleId:t.id,createTime:ku(Ba(t.createTime)),version:t.version})},Uc.prototype.getNamedQuery=function(e,t){return jc(e).get(t).next(function(e){if(e)return{name:e.name,query:Ru(e.bundledQuery),readTime:Au(e.readTime)}})},Uc.prototype.saveNamedQuery=function(e,t){return jc(e).put({name:t.name,readTime:ku(Ba(t.readTime)),bundledQuery:t.bundledQuery})},Uc);function Uc(e){this.serializer=e}function Kc(e){return gl.getStore(e,qc.store)}function jc(e){return gl.getStore(e,Fc.store)}var zc=(Qc.prototype.addToCollectionParentIndex=function(e,t){var n=this;if(qr(t.length%2==1,"Expected a collection path."),this.collectionParentsCache.has(t))return au.resolve();var r=t.lastSegment(),i=t.popLast();return e.addOnCommittedListener(function(){n.collectionParentsCache.add(t)}),i={collectionId:r,parent:wu(i)},Gc(e).put(i)},Qc.prototype.getCollectionParents=function(e,i){var o=[],t=IDBKeyRange.bound([i,""],[jr(i),""],!1,!0);return Gc(e).loadAll(t).next(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r.collectionId!==i)break;o.push(Su(r.parent))}return o})},Qc);function Qc(){this.collectionParentsCache=new Zu}function Gc(e){return gl.getStore(e,Lc.store)}var Wc=(Hc.prototype.next=function(){return this.lastId+=2,this.lastId},Hc.forTargetCache=function(){return new Hc(0)},Hc.forSyncEngine=function(){return new Hc(-1)},Hc);function Hc(e){this.lastId=e}var Yc=(Xc.prototype.allocateTargetId=function(n){var r=this;return this.retrieveMetadata(n).next(function(e){var t=new Wc(e.highestTargetId);return e.highestTargetId=t.next(),r.saveMetadata(n,e).next(function(){return e.highestTargetId})})},Xc.prototype.getLastRemoteSnapshotVersion=function(e){return this.retrieveMetadata(e).next(function(e){return zo.fromTimestamp(new Qr(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})},Xc.prototype.getHighestSequenceNumber=function(e){return this.retrieveMetadata(e).next(function(e){return e.highestListenSequenceNumber})},Xc.prototype.setTargetsMetadata=function(t,n,r){var i=this;return this.retrieveMetadata(t).next(function(e){return e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),i.saveMetadata(t,e)})},Xc.prototype.addTargetData=function(t,n){var r=this;return this.saveTargetData(t,n).next(function(){return r.retrieveMetadata(t).next(function(e){return e.targetCount+=1,r.updateMetadataFromTargetData(n,e),r.saveMetadata(t,e)})})},Xc.prototype.updateTargetData=function(e,t){return this.saveTargetData(e,t)},Xc.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Jc(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return Mr(0<e.targetCount,"Removing from an empty target cache"),--e.targetCount,n.saveMetadata(t,e)})},Xc.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return Jc(n).iterate(function(e,t){(t=xu(t)).sequenceNumber<=r&&null===i.get(t.targetId)&&(a++,s.push(o.removeTargetData(n,t)))}).next(function(){return au.waitFor(s)}).next(function(){return a})},Xc.prototype.forEachTarget=function(e,n){return Jc(e).iterate(function(e,t){t=xu(t),n(t)})},Xc.prototype.retrieveMetadata=function(e){return $c(e).get(Rc.key).next(function(e){return Mr(null!==e,"Missing metadata row."),e})},Xc.prototype.saveMetadata=function(e,t){return $c(e).put(Rc.key,t)},Xc.prototype.saveTargetData=function(e,t){return Jc(e).put(Ou(this.serializer,t))},Xc.prototype.updateMetadataFromTargetData=function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n},Xc.prototype.getTargetCount=function(e){return this.retrieveMetadata(e).next(function(e){return e.targetCount})},Xc.prototype.getTargetData=function(e,r){var t=Wi(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]),i=null;return Jc(e).iterate({range:t,index:xc.queryTargetsIndexName},function(e,t,n){t=xu(t),Hi(r,t.target)&&(i=t,n.done())}).next(function(){return i})},Xc.prototype.addMatchingKeys=function(n,e,r){var i=this,o=[],a=Zc(n);return e.forEach(function(e){var t=wu(e.path);o.push(a.put(new Oc(r,t))),o.push(i.referenceDelegate.addReference(n,r,e))}),au.waitFor(o)},Xc.prototype.removeMatchingKeys=function(n,e,r){var i=this,o=Zc(n);return au.forEach(e,function(e){var t=wu(e.path);return au.waitFor([o.delete([r,t]),i.referenceDelegate.removeReference(n,r,e)])})},Xc.prototype.removeMatchingKeysForTargetId=function(e,t){return e=Zc(e),t=IDBKeyRange.bound([t],[t+1],!1,!0),e.delete(t)},Xc.prototype.getMatchingKeysForTargetId=function(e,t){var t=IDBKeyRange.bound([t],[t+1],!1,!0),e=Zc(e),r=sa();return e.iterate({range:t,keysOnly:!0},function(e,t,n){e=Su(e[1]),e=new li(e),r=r.add(e)}).next(function(){return r})},Xc.prototype.containsKey=function(e,t){var t=wu(t.path),t=IDBKeyRange.bound([t],[jr(t)],!1,!0),i=0;return Zc(e).iterate({index:Oc.documentTargetsIndex,keysOnly:!0,range:t},function(e,t,n){var r=e[0];e[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Xc.prototype.getTargetDataForTarget=function(e,t){return Jc(e).get(t).next(function(e){return e?xu(e):null})},Xc);function Xc(e,t){this.referenceDelegate=e,this.serializer=t}function Jc(e){return gl.getStore(e,xc.store)}function $c(e){return gl.getStore(e,Rc.store)}function Zc(e){return gl.getStore(e,Oc.store)}function el(e,t){var n=e[0],r=e[1],e=t[0],t=t[1];return 0===(e=Ur(n,e))?Ur(r,t):e}var tl=(nl.prototype.nextIndex=function(){return++this.previousIndex},nl.prototype.addElement=function(e){var t=[e,this.nextIndex()];this.buffer.size<this.maxElements?this.buffer=this.buffer.add(t):el(t,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(t))},Object.defineProperty(nl.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),nl);function nl(e){this.maxElements=e,this.buffer=new Zo(el),this.previousIndex=0}var rl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},il=(ol.withCacheSize=function(e){return new ol(e,ol.DEFAULT_COLLECTION_PERCENTILE,ol.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},ol);function ol(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}il.DEFAULT_COLLECTION_PERCENTILE=10,il.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,il.DEFAULT=new il(41943040,il.DEFAULT_COLLECTION_PERCENTILE,il.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),il.DISABLED=new il(-1,0,0);var al=(sl.prototype.start=function(e){qr(null===this.gcTask,"Cannot start an already started LruScheduler"),-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.scheduleGC(e)},sl.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(sl.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!1,configurable:!0}),sl.prototype.scheduleGC=function(n){var e=this;qr(null===this.gcTask,"Cannot schedule GC while a task is pending");var t=this.hasRun?3e5:6e4;xr("LruGarbageCollector","Garbage collection scheduled in "+t+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,function(){return m(e,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:this.gcTask=null,this.hasRun=!0,e.label=1;case 1:return e.trys.push([1,3,,7]),[4,n.collectGarbage(this.garbageCollector)];case 2:return e.sent(),[3,7];case 3:return lc(t=e.sent())?(xr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t),[3,6]):[3,4];case 4:return[4,Bl(t)];case 5:e.sent(),e.label=6;case 6:return[3,7];case 7:return[4,this.scheduleGC(n)];case 8:return e.sent(),[2]}})})})},sl);function sl(e,t){this.garbageCollector=e,this.asyncQueue=t,this.hasRun=!1,this.gcTask=null}var ul=(cl.prototype.calculateTargetCount=function(e,t){return this.delegate.getSequenceNumberCount(e).next(function(e){return Math.floor(t/100*e)})},cl.prototype.nthSequenceNumber=function(e,t){var n=this;if(0===t)return au.resolve(pu.INVALID);var r=new tl(t);return this.delegate.forEachTarget(e,function(e){return r.addElement(e.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(e,function(e){return r.addElement(e)})}).next(function(){return r.maxValue})},cl.prototype.removeTargets=function(e,t,n){return this.delegate.removeTargets(e,t,n)},cl.prototype.removeOrphanedDocuments=function(e,t){return this.delegate.removeOrphanedDocuments(e,t)},cl.prototype.collect=function(t,n){var r=this;return-1===this.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; disabled"),au.resolve(rl)):this.getCacheSize(t).next(function(e){return e<r.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; Cache size "+e+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),rl):r.runGarbageCollection(t,n)})},cl.prototype.getCacheSize=function(e){return this.delegate.getCacheSize(e)},cl.prototype.runGarbageCollection=function(t,n){var r,i,o,a,s,u,c,l=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return i=e>l.params.maximumSequenceNumbersToCollect?(xr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.maximumSequenceNumbersToCollect+" from "+e),l.params.maximumSequenceNumbersToCollect):e,a=Date.now(),l.nthSequenceNumber(t,i)}).next(function(e){return r=e,s=Date.now(),l.removeTargets(t,r,n)}).next(function(e){return o=e,u=Date.now(),l.removeOrphanedDocuments(t,r)}).next(function(e){return c=Date.now(),Nr()<=f.DEBUG&&xr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-h)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+e+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-h)+"ms"),au.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:e})})},cl);function cl(e,t){this.delegate=e,this.params=t}var ll,hl="IndexedDbPersistence",fl="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",dl="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",pl="main",yl=(n(ml,ll=gt),ml);function ml(e,t){var n=ll.call(this)||this;return n.simpleDbTransaction=e,n.currentSequenceNumber=t,n}var gl=(vl.getStore=function(e,t){if(e instanceof yl)return rc.getStore(e.simpleDbTransaction,t);throw Pr("IndexedDbPersistence must use instances of IndexedDbTransaction")},vl.prototype.start=function(){var t=this;return qr(!this.started,"IndexedDbPersistence double-started!"),qr(null!==this.window,"Expected 'window' to be defined"),this.updateClientMetadataAndTryBecomePrimary().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Dr(Cr.FAILED_PRECONDITION,fl);return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.targetCache.getHighestSequenceNumber(e)})}).then(function(e){t.listenSequence=new pu(e,t.sequenceNumberSyncer)}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},vl.prototype.setPrimaryStateListener=function(n){var e=this;return this.primaryStateListener=function(t){return m(e,void 0,void 0,function(){return g(this,function(e){return this.started?[2,n(t)]:[2]})})},n(this.isPrimary)},vl.prototype.setDatabaseDeletedListener=function(n){var e=this;this.simpleDb.setVersionChangeListener(function(t){return m(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return null!==t.newVersion?[3,2]:[4,n()];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},vl.prototype.setNetworkEnabled=function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(function(){return m(t,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})}))},vl.prototype.updateClientMetadataAndTryBecomePrimary=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(t){return wl(t).put(new Mc(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.verifyPrimaryLease(t).next(function(e){e||(n.isPrimary=!1,n.queue.enqueueRetryable(function(){return n.primaryStateListener(!1)}))})}).next(function(){return n.canActAsPrimary(t)}).next(function(e){return n.isPrimary&&!e?n.releasePrimaryLeaseIfHeld(t).next(function(){return!1}):!!e&&n.acquireOrExtendPrimaryLease(t).next(function(){return!0})})}).catch(function(e){if(lc(e))return xr(hl,"Failed to extend owner lease: ",e),n.isPrimary;if(!n.allowTabSynchronization)throw e;return xr(hl,"Releasing owner lease after error during lease refresh",e),!1}).then(function(e){n.isPrimary!==e&&n.queue.enqueueRetryable(function(){return n.primaryStateListener(e)}),n.isPrimary=e})},vl.prototype.verifyPrimaryLease=function(e){var t=this;return bl(e).get(Sc.key).next(function(e){return au.resolve(t.isLocalClient(e))})},vl.prototype.removeClientMetadata=function(e){return wl(e).delete(this.clientId)},vl.prototype.maybeGarbageCollectMultiClientState=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o=this;return g(this,function(e){switch(e.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(e){var r=vl.getStore(e,Mc.store);return r.loadAll().next(function(e){var t=o.filterActiveClients(e,18e5),n=e.filter(function(e){return-1===t.indexOf(e)});return au.forEach(n,function(e){return r.delete(e.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(t=e.sent(),this.webStorage)for(n=0,r=t;n<r.length;n++)i=r[n],this.webStorage.removeItem(this.zombiedClientLocalStorageKey(i.clientId));e.label=2;case 2:return[2]}})})},vl.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var e=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return e.updateClientMetadataAndTryBecomePrimary().then(function(){return e.maybeGarbageCollectMultiClientState()}).then(function(){return e.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},vl.prototype.isLocalClient=function(e){return!!e&&e.ownerId===this.clientId},vl.prototype.canActAsPrimary=function(t){var r=this;return this.forceOwningTab?au.resolve(!0):bl(t).get(Sc.key).next(function(e){if(null!==e&&r.isWithinAge(e.leaseTimestampMs,5e3)&&!r.isClientZombied(e.ownerId)){if(r.isLocalClient(e)&&r.networkEnabled)return!0;if(!r.isLocalClient(e)){if(!e.allowTabSynchronization)throw new Dr(Cr.FAILED_PRECONDITION,fl);return!1}}return!(!r.networkEnabled||!r.inForeground)||wl(t).loadAll().next(function(e){return void 0===r.filterActiveClients(e,5e3).find(function(e){if(r.clientId!==e.clientId){var t=!r.networkEnabled&&e.networkEnabled,n=!r.inForeground&&e.inForeground,e=r.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1})})}).next(function(e){return r.isPrimary!==e&&xr(hl,"Client "+(e?"is":"is not")+" eligible for a primary lease."),e})},vl.prototype.shutdown=function(){return m(this,void 0,void 0,function(){var n=this;return g(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("shutdown","readwrite",[Sc.store,Mc.store],function(e){var t=new yl(e,pu.INVALID);return n.releasePrimaryLeaseIfHeld(t).next(function(){return n.removeClientMetadata(t)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},vl.prototype.filterActiveClients=function(e,t){var n=this;return e.filter(function(e){return n.isWithinAge(e.updateTimeMs,t)&&!n.isClientZombied(e.clientId)})},vl.prototype.getActiveClients=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return wl(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(e){return e.clientId})})})},Object.defineProperty(vl.prototype,"started",{get:function(){return this._started},enumerable:!1,configurable:!0}),vl.prototype.getMutationQueue=function(e){return qr(this.started,"Cannot initialize MutationQueue before persistence is started."),Lu.forUser(e,this.serializer,this.indexManager,this.referenceDelegate)},vl.prototype.getTargetCache=function(){return qr(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},vl.prototype.getRemoteDocumentCache=function(){return qr(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},vl.prototype.getIndexManager=function(){return qr(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},vl.prototype.getBundleCache=function(){return qr(this.started,"Cannot initialize BundleCache before persistence is started."),this.bundleCache},vl.prototype.runTransaction=function(t,n,r){var i=this;xr(hl,"Starting transaction:",t);var o,e="readonly"===n?"readonly":"readwrite";return this.simpleDb.runTransaction(t,e,Bc,function(e){return o=new yl(e,i.listenSequence?i.listenSequence.next():pu.INVALID),"readwrite-primary"===n?i.verifyPrimaryLease(o).next(function(e){return!!e||i.canActAsPrimary(o)}).next(function(e){if(!e)throw Or("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.queue.enqueueRetryable(function(){return i.primaryStateListener(!1)}),new Dr(Cr.FAILED_PRECONDITION,lu);return r(o)}).next(function(e){return i.acquireOrExtendPrimaryLease(o).next(function(){return e})}):i.verifyAllowTabSynchronization(o).next(function(){return r(o)})}).then(function(e){return o.raiseOnCommittedEvent(),e})},vl.prototype.verifyAllowTabSynchronization=function(e){var t=this;return bl(e).get(Sc.key).next(function(e){if(null!==e&&t.isWithinAge(e.leaseTimestampMs,5e3)&&!t.isClientZombied(e.ownerId)&&!t.isLocalClient(e)&&!(t.forceOwningTab||t.allowTabSynchronization&&e.allowTabSynchronization))throw new Dr(Cr.FAILED_PRECONDITION,fl)})},vl.prototype.acquireOrExtendPrimaryLease=function(e){var t=new Sc(this.clientId,this.allowTabSynchronization,Date.now());return bl(e).put(Sc.key,t)},vl.isAvailable=function(){return rc.isAvailable()},vl.prototype.releasePrimaryLeaseIfHeld=function(e){var t=this,n=bl(e);return n.get(Sc.key).next(function(e){return t.isLocalClient(e)?(xr(hl,"Releasing primary lease."),n.delete(Sc.key)):au.resolve()})},vl.prototype.isWithinAge=function(e,t){var n=Date.now();return!(e<n-t||n<e&&(Or("Detected an update time that is in the future: "+e+" > "+n),1))},vl.prototype.attachVisibilityHandler=function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){e.queue.enqueueAndForget(function(){return e.inForeground="visible"===e.document.visibilityState,e.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},vl.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(qr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},vl.prototype.attachWindowUnloadHook=function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},vl.prototype.detachWindowUnloadHook=function(){var e;this.windowUnloadHandler&&(qr("function"==typeof(null===(e=this.window)||void 0===e?void 0:e.removeEventListener),"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},vl.prototype.isClientZombied=function(e){try{var t=null!==(null===(t=this.webStorage)||void 0===t?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)));return xr(hl,"Client '"+e+"' "+(t?"is":"is not")+" zombied in LocalStorage"),t}catch(e){return Or(hl,"Failed to get zombied client id.",e),!1}},vl.prototype.markClientZombied=function(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Or("Failed to set zombie client id.",e)}},vl.prototype.removeClientZombiedEntry=function(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}},vl.prototype.zombiedClientLocalStorageKey=function(e){return"firestore_zombie_"+this.persistenceKey+"_"+e},vl);function vl(e,t,n,r,i,o,a,s,u,c){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.queue=i,this.window=o,this.document=a,this.sequenceNumberSyncer=u,this.forceOwningTab=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(e){return Promise.resolve()},!vl.isAvailable())throw new Dr(Cr.UNIMPLEMENTED,dl);this.referenceDelegate=new Tl(this,r),this.dbName=t+pl,this.serializer=new Iu(s),this.simpleDb=new rc(this.dbName,vc,new bc(this.serializer)),this.targetCache=new Yc(this.referenceDelegate,this.serializer),this.indexManager=new zc,this.remoteDocumentCache=(t=this.serializer,s=this.indexManager,new Ku(t,s)),this.bundleCache=new Vc(this.serializer),this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===c&&Or(hl,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function bl(e){return gl.getStore(e,Sc.store)}function wl(e){return gl.getStore(e,Mc.store)}var Tl=(Sl.prototype.getSequenceNumberCount=function(e){var n=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(function(t){return n.next(function(e){return t+e})})},Sl.prototype.orphanedDocumentCount=function(e){var t=0;return this.forEachOrphanedDocumentSequenceNumber(e,function(e){t++}).next(function(){return t})},Sl.prototype.forEachTarget=function(e,t){return this.db.getTargetCache().forEachTarget(e,t)},Sl.prototype.forEachOrphanedDocumentSequenceNumber=function(e,n){return this.forEachOrphanedDocument(e,function(e,t){return n(t)})},Sl.prototype.addReference=function(e,t,n){return Il(e,n)},Sl.prototype.removeReference=function(e,t,n){return Il(e,n)},Sl.prototype.removeTargets=function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)},Sl.prototype.markPotentiallyOrphaned=Il,Sl.prototype.isPinned=function(e,t){return r=t,i=!1,Vu(n=e).iterateSerial(function(e){return Mu(n,e,r).next(function(e){return e&&(i=!0),au.resolve(!e)})}).next(function(){return i});var n,r,i},Sl.prototype.removeOrphanedDocuments=function(n,r){var i=this,o=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[],s=0;return this.forEachOrphanedDocument(n,function(t,e){e<=r&&(e=i.isPinned(n,t).next(function(e){if(!e)return s++,o.getEntry(n,t).next(function(){return o.removeEntry(t),Zc(n).delete([0,wu(t.path)])})}),a.push(e))}).next(function(){return au.waitFor(a)}).next(function(){return o.apply(n)}).next(function(){return s})},Sl.prototype.removeTarget=function(e,t){return t=t.withSequenceNumber(e.currentSequenceNumber),this.db.getTargetCache().updateTargetData(e,t)},Sl.prototype.updateLimboDocument=Il,Sl.prototype.forEachOrphanedDocument=function(e,r){var i,e=Zc(e),o=pu.INVALID;return e.iterate({index:Oc.documentTargetsIndex},function(e,t){var n=e[0],e=(e[1],t.path),t=t.sequenceNumber;0===n?(o!==pu.INVALID&&r(new li(Su(i)),o),o=t,i=e):o=pu.INVALID}).next(function(){o!==pu.INVALID&&r(new li(Su(i)),o)})},Sl.prototype.getCacheSize=function(e){return this.db.getRemoteDocumentCache().getSize(e)},Sl);function Sl(e,t){this.db=e,this.garbageCollector=new ul(this,t)}function Il(e,t){return Zc(e).put((e=e.currentSequenceNumber,new Oc(0,wu(t.path),e)))}function El(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var Cl="LocalStore",Dl=3e8,_l=(kl.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(e){return t.collect(e,n.targetDataByTarget)})},kl);function kl(e,t,n,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new Go(Ur),this.targetIdByTarget=new iu(Wi,Hi),this.lastDocumentChangeReadTime=zo.min(),qr(e.started,"LocalStore was passed an unstarted persistence implementation"),this.mutationQueue=e.getMutationQueue(n),this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.localDocuments=new uu(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.bundleCache=e.getBundleCache(),this.queryEngine.setLocalDocumentsView(this.localDocuments)}function Al(e,t,n,r){return new _l(e,t,n,r)}function Nl(i,o){return m(this,void 0,void 0,function(){var t,n,m,r;return g(this,function(e){switch(e.label){case 0:return t=Fr(i,_l),n=t.mutationQueue,m=t.localDocuments,[4,t.persistence.runTransaction("Handle user change","readonly",function(p){var y;return t.mutationQueue.getAllMutationBatches(p).next(function(e){return y=e,n=t.persistence.getMutationQueue(o),m=new uu(t.remoteDocuments,n,t.persistence.getIndexManager()),n.getAllMutationBatches(p)}).next(function(e){for(var t=[],n=[],r=sa(),i=0,o=y;i<o.length;i++){var a=o[i];t.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++)var c=u[s],r=r.add(c.key)}for(var l=0,h=e;l<h.length;l++){a=h[l],n.push(a.batchId);for(var f=0,d=a.mutations;f<d.length;f++)c=d[f],r=r.add(c.key)}return m.getDocuments(p,r).next(function(e){return{affectedDocuments:e,removedBatchIds:t,addedBatchIds:n}})})})];case 1:return r=e.sent(),t.mutationQueue=n,t.localDocuments=m,t.queryEngine.setLocalDocumentsView(t.localDocuments),[2,r]}})})}function xl(e,u){var c,l=Fr(e,_l),h=Qr.now(),t=u.reduce(function(e,t){return e.add(t.key)},sa());return l.persistence.runTransaction("Locally write mutations","readwrite",function(s){return l.localDocuments.getDocuments(s,t).next(function(e){c=e;for(var a,t=[],n=0,r=u;n<r.length;n++){var i=r[n],o=(a=i,o=c.get(i.key),a instanceof js?function(e){for(var t=null,n=0,r=a.fieldTransforms;n<r.length;n++){var i=r[n],o=e instanceof qi?e.field(i.field):void 0;null!=(o=os(i.transform,o||null))&&(t=(null==t?new ha:t).set(i.field,o))}return t?t.build():null}(o):null);null!=o&&t.push(new Bs(i.key,o,function a(e){var s=[];return Hr(e.fields||{},function(e,t){var n=new ui([e]);if(Pi(t))if(0===(t=a(t.mapValue).fields).length)s.push(n);else for(var r=0,i=t;r<i.length;r++){var o=i[r];s.push(n.child(o))}else s.push(n)}),new Ss(s)}(o.proto.mapValue),_s.exists(!0)))}return l.mutationQueue.addMutationBatch(s,h,t,u)})}).then(function(e){var t=e.applyToLocalDocumentSet(c);return{batchId:e.batchId,changes:t}})}function Ol(e){var t=Fr(e,_l);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)})}function Rl(e,o){var l=Fr(e,_l),h=o.snapshotVersion,f=l.targetDataByTarget;return l.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var e=l.remoteDocuments.newChangeBuffer({trackRemovals:!0});f=l.targetDataByTarget;var s=[];o.targetChanges.forEach(function(e,t){var n,r,i,o=f.get(t);o&&(s.push(l.targetCache.removeMatchingKeys(a,e.removedDocuments,t).next(function(){return l.targetCache.addMatchingKeys(a,e.addedDocuments,t)})),0<(n=e.resumeToken).approximateByteSize()&&(n=o.withResumeToken(n,h).withSequenceNumber(a.currentSequenceNumber),f=f.insert(t,n),r=o,i=e,Mr(0<(o=n).resumeToken.approximateByteSize(),"Attempted to persist target data with no resume token"),0!==r.resumeToken.approximateByteSize()&&!(o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()>=Dl||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)||s.push(l.targetCache.updateTargetData(a,n))))});var u,t,c,n,r,i=ra;return o.documentUpdates.forEach(function(e,t){o.resolvedLimboDocuments.has(e)&&s.push(l.persistence.referenceDelegate.updateLimboDocument(a,e))}),s.push((r=a,u=e,t=o.documentUpdates,c=h,n=sa(),t.forEach(function(e){return n=n.add(e)}),u.getEntries(r,n).next(function(i){var o=ra;return t.forEach(function(e,t){var n=i.get(e),r=c;t instanceof Vi&&t.version.isEqual(zo.min())?(u.removeEntry(e,r),o=o.insert(e,t)):null==n||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(qr(!zo.min().isEqual(r),"Cannot add a document when the remote version is zero"),u.addEntry(t,r),o=o.insert(e,t)):xr(Cl,"Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),o}).next(function(e){i=e}))),h.isEqual(zo.min())||(r=l.targetCache.getLastRemoteSnapshotVersion(a).next(function(e){return qr(0<=h.compareTo(e),"Watch stream reverted to previous snapshot?? "+h+" < "+e),l.targetCache.setTargetsMetadata(a,a.currentSequenceNumber,h)}),s.push(r)),au.waitFor(s).next(function(){return e.apply(a)}).next(function(){return l.localDocuments.getLocalViewOfDocuments(a,i)})}).then(function(e){return l.targetDataByTarget=f,e})}function Ll(e,r){var i=Fr(e,_l);return i.persistence.runTransaction("Allocate target","readwrite",function(t){var n;return i.targetCache.getTargetData(t,r).next(function(e){return e?(n=e,au.resolve(n)):i.targetCache.allocateTargetId(t).next(function(e){return n=new fu(r,e,0,t.currentSequenceNumber),i.targetCache.addTargetData(t,n).next(function(){return n})})})}).then(function(e){var t=i.targetDataByTarget.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.targetDataByTarget=i.targetDataByTarget.insert(e.targetId,e),i.targetIdByTarget.set(r,e.targetId)),e})}function Pl(i,o,a){return m(this,void 0,void 0,function(){var t,n,r;return g(this,function(e){switch(e.label){case 0:t=Fr(i,_l),qr(null!==(n=t.targetDataByTarget.get(o)),"Tried to release nonexistent target: "+o),r=a?"readwrite":"readwrite-primary",e.label=1;case 1:return e.trys.push([1,4,,5]),a?[3,3]:[4,t.persistence.runTransaction("Release target",r,function(e){return t.persistence.referenceDelegate.removeTarget(e,n)})];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if(!lc(r=e.sent()))throw r;return xr(Cl,"Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return t.targetDataByTarget=t.targetDataByTarget.remove(o),t.targetIdByTarget.delete(n.target),[2]}})})}function Ml(e,o,a){var s=Fr(e,_l),u=zo.min(),c=sa();return s.persistence.runTransaction("Execute query","readonly",function(t){return e=s,n=t,r=ao(o),(void 0!==(e=(i=Fr(e,_l)).targetIdByTarget.get(r))?au.resolve(i.targetDataByTarget.get(e)):i.targetCache.getTargetData(n,r)).next(function(e){if(e)return u=e.lastLimboFreeSnapshotVersion,s.targetCache.getMatchingKeysForTargetId(t,e.targetId).next(function(e){c=e})}).next(function(){return s.queryEngine.getDocumentsMatchingQuery(t,o,a?u:zo.min(),a?c:sa())}).next(function(e){return{documents:e,remoteKeys:c}});var e,n,r,i})}function ql(e,t){var n=Fr(e,_l),r=Fr(n.targetCache,Yc);return(e=n.targetDataByTarget.get(t))?Promise.resolve(e.target):n.persistence.runTransaction("Get target data","readonly",function(e){return r.getTargetDataForTarget(e,t).next(function(e){return e?e.target:null})})}function Fl(e){var a=Fr(e,_l);return a.persistence.runTransaction("Get new document changes","readonly",function(e){return t=a.remoteDocuments,n=e,e=a.lastDocumentChangeReadTime,r=Fr(t,Ku),i=ra,o=Du(e),e=Hu(n),n=IDBKeyRange.lowerBound(o,!0),e.iterate({index:Ac.readTimeIndex,range:n},function(e,t){var n=Eu(r.serializer,t);i=i.insert(n.key,n),o=t.readTime}).next(function(){return{changedDocs:i,readTime:_u(o)}});var t,n,r,i,o}).then(function(e){var t=e.changedDocs,e=e.readTime;return a.lastDocumentChangeReadTime=e,t})}function Bl(t){return m(this,void 0,void 0,function(){return g(this,function(e){if(t.code!==Cr.FAILED_PRECONDITION||t.message!==lu)throw t;return xr(Cl,"Unexpectedly lost primary lease"),[2]})})}var Vl=(Ul.prototype.reset=function(){this.currentBaseMs=0},Ul.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},Ul.prototype.backoffAndRun=function(e){var t=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<i&&xr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return t.lastAttemptTime=Date.now(),e()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},Ul.prototype.skipBackoff=function(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)},Ul.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},Ul.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},Ul);function Ul(e,t,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=e,this.timerId=t,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var Kl="PersistentStream",l=(jl.prototype.isStarted=function(){return 1===this.state||2===this.state||4===this.state},jl.prototype.isOpen=function(){return 2===this.state},jl.prototype.start=function(){3!==this.state?(qr(0===this.state,"Already started"),this.auth()):this.performBackoff()},jl.prototype.stop=function(){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return this.isStarted()?[4,this.close(0)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},jl.prototype.inhibitBackoff=function(){qr(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=0,this.backoff.reset()},jl.prototype.markIdle=function(){var e=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return e.handleIdleCloseTimer()}))},jl.prototype.sendRequest=function(e){this.cancelIdleCheck(),this.stream.send(e)},jl.prototype.handleIdleCloseTimer=function(){return m(this,void 0,void 0,function(){return g(this,function(e){return this.isOpen()?[2,this.close(0)]:[2]})})},jl.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},jl.prototype.close=function(t,n){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return qr(this.isStarted(),"Only started streams should be closed."),qr(3===t||$r(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,3!==t?this.backoff.reset():n&&n.code===Cr.RESOURCE_EXHAUSTED?(Or(n.toString()),Or("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Cr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(n)];case 1:return e.sent(),[2]}})})},jl.prototype.tearDown=function(){},jl.prototype.auth=function(){var n=this;qr(0===this.state,"Must be in initial state to auth"),this.state=1;var e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;this.credentialsProvider.getToken().then(function(e){n.closeCount===t&&n.startStream(e)},function(t){e(function(){var e=new Dr(Cr.UNKNOWN,"Fetching auth token failed: "+t.message);return n.handleStreamClose(e)})})},jl.prototype.startStream=function(e){var t=this;qr(1===this.state,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e),this.stream.onOpen(function(){n(function(){return qr(1===t.state,"Expected stream to be in state Starting, but was "+t.state),t.state=2,t.listener.onOpen()})}),this.stream.onClose(function(e){n(function(){return t.handleStreamClose(e)})}),this.stream.onMessage(function(e){n(function(){return t.onMessage(e)})})},jl.prototype.performBackoff=function(){var e=this;qr(3===this.state,"Should only perform backoff when in Error state"),this.state=4,this.backoff.backoffAndRun(function(){return m(e,void 0,void 0,function(){return g(this,function(e){return qr(4===this.state,"Backoff elapsed but state is now: "+this.state),this.state=0,this.start(),qr(this.isStarted(),"PersistentStream should have started"),[2]})})})},jl.prototype.handleStreamClose=function(e){return qr(this.isStarted(),"Can't handle server close on non-started stream"),xr(Kl,"close with error: "+e),this.stream=null,this.close(3,e)},jl.prototype.getCloseGuardedDispatcher=function(t){var n=this;return function(e){n.queue.enqueueAndForget(function(){return n.closeCount===t?e():(xr(Kl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},jl);function jl(e,t,n,r,i,o){this.queue=e,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Vl(e,t)}var zl,Ql=(n(Gl,zl=l),Gl.prototype.startRpc=function(e){return this.connection.openStream("Listen",e)},Gl.prototype.onMessage=function(e){this.backoff.reset();var t=function(e,t){if("targetChange"in t){Oa(t.targetChange,"targetChange");var n="NO_CHANGE"===(o=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Pr("Got unexpected TargetChange.state: "+o),r=t.targetChange.targetIds||[],i=(i=e,o=t.targetChange.resumeToken,i.useProto3Json?(Mr(void 0===o||"string"==typeof o,"value must be undefined or a string when using proto3 Json"),Xr.fromBase64String(o||"")):(Mr(void 0===o||o instanceof Uint8Array,"value must be undefined or Uint8Array"),Xr.fromUint8Array(o||new Uint8Array))),o=t.targetChange.cause,a=o&&(o=void 0===(a=o).code?Cr.UNKNOWN:ma(a.code),new Dr(o,a.message||"")),i=new Ia(n,r,i,a||null)}else if("documentChange"in t){Oa(t.documentChange,"documentChange"),Oa((c=t.documentChange).document,"documentChange.name"),Oa(c.document.name,"documentChange.document.name"),Oa(c.document.updateTime,"documentChange.document.updateTime");var s=ja(e,c.document.name),u=Ba(c.document.updateTime),a=new ca({mapValue:{fields:c.document.fields}}),u=new qi(s,u,a,{}),a=c.targetIds||[],c=c.removedTargetIds||[];i=new Ta(a,c,u.key,u)}else if("documentDelete"in t){Oa(t.documentDelete,"documentDelete"),Oa((u=t.documentDelete).document,"documentDelete.document");var s=ja(e,u.document),l=u.readTime?Ba(u.readTime):zo.min(),l=new Vi(s,l),c=u.removedTargetIds||[];i=new Ta([],c,l.key,l)}else if("documentRemove"in t)Oa(t.documentRemove,"documentRemove"),Oa((l=t.documentRemove).document,"documentRemove"),s=ja(e,l.document),c=l.removedTargetIds||[],i=new Ta([],c,s,null);else{if(!("filter"in t))return Pr("Unknown change type "+JSON.stringify(t));Oa(t.filter,"filter"),Oa((s=t.filter).targetId,"filter.targetId"),t=s.count||0,t=new da(t),s=s.targetId,i=new Sa(s,t)}return i}(this.serializer,e),e="targetChange"in e&&(!(e=e.targetChange).targetIds||!e.targetIds.length)&&e.readTime?Ba(e.readTime):zo.min();return this.listener.onWatchChange(t,e)},Gl.prototype.watch=function(e){var t,n,r,i={};i.database=Ga(this.serializer),i.addTarget=(t=this.serializer,(r=Yi(r=(n=e).target)?{documents:Ja(t,r)}:{query:$a(t,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=Fa(t,n.resumeToken):0<n.snapshotVersion.compareTo(zo.min())&&(r.readTime=qa(t,n.snapshotVersion.toTimestamp())),r),this.serializer,(e=null==(r=function(e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Pr("Unrecognized query purpose: "+e)}}((r=e).purpose))?null:{"goog-listen-tags":r})&&(i.labels=e),this.sendRequest(i)},Gl.prototype.unwatch=function(e){var t={};t.database=Ga(this.serializer),t.removeTarget=e,this.sendRequest(t)},Gl);function Gl(e,t,n,r,i){return(i=zl.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",t,n,i)||this).serializer=r,i}var Wl,Hl=(n(Yl,Wl=l),Object.defineProperty(Yl.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!1,configurable:!0}),Yl.prototype.start=function(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,Wl.prototype.start.call(this)},Yl.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},Yl.prototype.startRpc=function(e){return this.connection.openStream("Write",e)},Yl.prototype.onMessage=function(e){if(Mr(!!e.streamToken,"Got a write response without a stream token"),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();var t=(n=e.writeResults,r=e.commitTime,n&&0<n.length?(Mr(void 0!==r,"Received a write result without a commit time"),n.map(function(e){return n=r,(e=(t=e).updateTime?Ba(t.updateTime):Ba(n)).isEqual(zo.min())&&(e=Ba(n)),n=null,t.transformResults&&0<t.transformResults.length&&(n=t.transformResults),new Ds(e,n);var t,n})):[]),n=Ba(e.commitTime);return this.listener.onMutationResult(n,t)}var n,r;return Mr(!e.writeResults||0===e.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},Yl.prototype.writeHandshake=function(){qr(this.isOpen(),"Writing handshake requires an opened stream"),qr(!this.handshakeComplete_,"Handshake already completed"),qr(!this.lastStreamToken,"Stream token should be empty during handshake");var e={};e.database=Ga(this.serializer),this.sendRequest(e)},Yl.prototype.writeMutations=function(e){var t=this;qr(this.isOpen(),"Writing mutations requires an opened stream"),qr(this.handshakeComplete_,"Handshake must be complete before writing mutations"),qr(!!this.lastStreamToken,"Trying to write mutation without a token"),e={streamToken:this.lastStreamToken,writes:e.map(function(e){return Ya(t.serializer,e)})},this.sendRequest(e)},Yl);function Yl(e,t,n,r,i){return(i=Wl.call(this,e,"write_stream_connection_backoff","write_stream_idle",t,n,i)||this).serializer=r,i.handshakeComplete_=!1,i}var Xl,Jl=(n($l,Xl=function(){}),$l.prototype.verifyInitialized=function(){if(qr(!!this.connection,"Datastore.start() not called"),this.terminated)throw new Dr(Cr.FAILED_PRECONDITION,"The client has already been terminated.")},$l.prototype.invokeRPC=function(t,n,r){var i=this;return this.verifyInitialized(),this.credentials.getToken().then(function(e){return i.connection.invokeRPC(t,n,r,e)}).catch(function(e){throw e.code===Cr.UNAUTHENTICATED&&i.credentials.invalidateToken(),e})},$l.prototype.invokeStreamingRPC=function(t,n,r){var i=this;return this.verifyInitialized(),this.credentials.getToken().then(function(e){return i.connection.invokeStreamingRPC(t,n,r,e)}).catch(function(e){throw e.code===Cr.UNAUTHENTICATED&&i.credentials.invalidateToken(),e})},$l.prototype.terminate=function(){this.terminated=!1},$l);function $l(e,t,n){var r=Xl.call(this)||this;return r.credentials=e,r.connection=t,r.serializer=n,r.terminated=!1,r}var Zl=(eh.prototype.handleWatchStreamStart=function(){var e=this;0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),qr(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return e.onlineStateTimer=null,qr("Unknown"===e.state,"Timer should be canceled if we transitioned to a different state."),e.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),e.setAndBroadcast("Offline"),Promise.resolve()}))},eh.prototype.handleWatchStreamFailure=function(e){"Online"===this.state?(this.setAndBroadcast("Unknown"),qr(0===this.watchStreamFailures,"watchStreamFailures must be 0"),qr(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+e.toString()),this.setAndBroadcast("Offline")))},eh.prototype.set=function(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)},eh.prototype.setAndBroadcast=function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))},eh.prototype.logClientOfflineWarningIfNecessary=function(e){e="Could not reach Cloud Firestore backend. "+e+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.shouldWarnClientIsOffline?(Or(e),this.shouldWarnClientIsOffline=!1):xr("OnlineStateTracker",e)},eh.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},eh);function eh(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}var th="RemoteStore",nh=10,rh=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(e){n.enqueueAndForget(function(){return m(o,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return fh(this)?(xr(th,"Restarting streams for network reachability change."),[4,function(n){return m(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return(t=Fr(n,rh)).offlineCauses.add(4),[4,oh(t)];case 1:return e.sent(),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),[4,ih(t)];case 2:return e.sent(),[2]}})})}(this)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new Zl(n,r)};function ih(r){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:if(!fh(r))return[3,4];t=0,n=r.onNetworkStatusChange,e.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function oh(r){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:t=0,n=r.onNetworkStatusChange,e.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function ah(e,t){(e=Fr(e,rh)).listenTargets.has(t.targetId)||(e.listenTargets.set(t.targetId,t),hh(e)?lh(e):Th(e).isOpen()&&uh(e,t))}function sh(e,t){var n=Fr(e,rh),e=Th(n);qr(n.listenTargets.has(t),"unlisten called on target no currently watched: "+t),n.listenTargets.delete(t),e.isOpen()&&ch(n,t),0===n.listenTargets.size&&(e.isOpen()?e.markIdle():fh(n)&&n.onlineStateTracker.set("Unknown"))}function uh(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),Th(e).watch(t)}function ch(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),Th(e).unwatch(t)}function lh(t){qr(hh(t),"startWatchStream() called when shouldStartWatchStream() is false."),qr(!!t.remoteSyncer.getRemoteKeysForTarget,"getRemoteKeysForTarget() not set"),t.watchChangeAggregator=new Da({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},getTargetDataForTarget:function(e){return t.listenTargets.get(e)||null}}),Th(t).start(),t.onlineStateTracker.handleWatchStreamStart()}function hh(e){return fh(e)&&!Th(e).isStarted()&&0<e.listenTargets.size}function fh(e){return 0===Fr(e,rh).offlineCauses.size}function dh(e){e.watchChangeAggregator=void 0}function ph(n,r,i){return m(this,void 0,void 0,function(){var t=this;return g(this,function(e){switch(e.label){case 0:return lc(r)?(qr(!n.offlineCauses.has(1),"Unexpected network event when IndexedDB was marked failed."),n.offlineCauses.add(1),[4,oh(n)]):[3,2];case 1:return e.sent(),n.onlineStateTracker.set("Offline"),i=i||function(){return Ol(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return m(t,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return xr(th,"Retrying IndexedDB access"),[4,i()];case 1:return e.sent(),n.offlineCauses.delete(1),[4,ih(n)];case 2:return e.sent(),[2]}})})}),[3,3];case 2:throw r;case 3:return[2]}})})}function yh(t,n){return n().catch(function(e){return ph(t,e,n)})}function mh(c){return m(this,void 0,void 0,function(){var o,a,s,u;return g(this,function(e){switch(e.label){case 0:o=Fr(c,rh),a=Sh(o),s=0<o.writePipeline.length?o.writePipeline[o.writePipeline.length-1].batchId:Zs,e.label=1;case 1:if(!gh(o))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,(n=o.localStore,r=s,(i=Fr(n,_l)).persistence.runTransaction("Get next mutation batch","readonly",function(e){return void 0===r&&(r=Zs),i.mutationQueue.getNextMutationBatchAfterBatchId(e,r)}))];case 3:return null===(u=e.sent())?(0===o.writePipeline.length&&a.markIdle(),[3,7]):(s=u.batchId,t=u,qr(gh(n=o),"addToWritePipeline called when pipeline is full"),n.writePipeline.push(t),(n=Sh(n)).isOpen()&&n.handshakeComplete&&n.writeMutations(t.mutations),[3,6]);case 4:return u=e.sent(),[4,ph(o,u)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return vh(o)&&bh(o),[2]}var t,n,r,i})})}function gh(e){return fh(e)&&e.writePipeline.length<nh}function vh(e){return fh(e)&&!Sh(e).isStarted()&&0<e.writePipeline.length}function bh(e){qr(vh(e),"startWriteStream() called when shouldStartWriteStream() is false."),Sh(e).start()}function wh(n,r){return m(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return t=Fr(n,rh),r?(t.offlineCauses.delete(2),[4,ih(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return r?[3,4]:(t.offlineCauses.add(2),[4,oh(t)]);case 3:e.sent(),t.onlineStateTracker.set("Unknown"),e.label=4;case 4:return[2]}})})}function Th(n){var e,t,r,i=this;return n.watchStream||(n.watchStream=(e=n.datastore,t=n.asyncQueue,r={onOpen:function(n){return m(this,void 0,void 0,function(){return g(this,function(e){return n.listenTargets.forEach(function(e,t){uh(n,e)}),[2]})})}.bind(null,n),onClose:function(t,n){return m(this,void 0,void 0,function(){return g(this,function(e){return void 0===n&&qr(!hh(t),"Watch stream was stopped gracefully while still needed."),dh(t),hh(t)?(t.onlineStateTracker.handleWatchStreamFailure(n),lh(t)):t.onlineStateTracker.set("Unknown"),[2]})})}.bind(null,n),onWatchChange:function(r,i,o){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:if(r.onlineStateTracker.set("Online"),!(i instanceof Ia&&2===i.state&&i.cause))return[3,6];e.label=1;case 1:return e.trys.push([1,3,,5]),[4,function(o,a){return m(this,void 0,void 0,function(){var t,n,r,i;return g(this,function(e){switch(e.label){case 0:qr(!!o.remoteSyncer.rejectListen,"rejectListen() not set"),qr(!!a.cause,"Handling target error without a cause"),t=a.cause,n=0,r=a.targetIds,e.label=1;case 1:return n<r.length?(i=r[n],o.listenTargets.has(i)?[4,o.remoteSyncer.rejectListen(i,t)]:[3,3]):[3,4];case 2:e.sent(),o.listenTargets.delete(i),o.watchChangeAggregator.removeTarget(i),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}(r,i)];case 2:return e.sent(),[3,5];case 3:return t=e.sent(),xr(th,"Failed to remove targets %s: %s ",i.targetIds.join(","),t),[4,ph(r,t)];case 4:return e.sent(),[3,5];case 5:return[2];case 6:if(i instanceof Ta?r.watchChangeAggregator.handleDocumentChange(i):i instanceof Sa?r.watchChangeAggregator.handleExistenceFilter(i):(qr(i instanceof Ia,"Expected watchChange to be an instance of WatchTargetChange"),r.watchChangeAggregator.handleTargetChange(i)),o.isEqual(zo.min()))return[3,13];e.label=7;case 7:return e.trys.push([7,11,,13]),[4,Ol(r.localStore)];case 8:return n=e.sent(),0<=o.compareTo(n)?[4,function(r,i){qr(!i.isEqual(zo.min()),"Can't raise event for unknown SnapshotVersion");var e=r.watchChangeAggregator.createRemoteEvent(i);return e.targetChanges.forEach(function(e,t){var n;0<e.resumeToken.approximateByteSize()&&(n=r.listenTargets.get(t))&&r.listenTargets.set(t,n.withResumeToken(e.resumeToken,i))}),e.targetMismatches.forEach(function(e){var t=r.listenTargets.get(e);t&&(r.listenTargets.set(e,t.withResumeToken(Xr.EMPTY_BYTE_STRING,t.snapshotVersion)),ch(r,e),t=new fu(t.target,e,1,t.sequenceNumber),uh(r,t))}),qr(!!r.remoteSyncer.applyRemoteEvent,"applyRemoteEvent() not set"),r.remoteSyncer.applyRemoteEvent(e)}(r,o)]:[3,10];case 9:e.sent(),e.label=10;case 10:return[3,13];case 11:return n=e.sent(),xr(th,"Failed to raise snapshot:",n),[4,ph(r,n)];case 12:return e.sent(),[3,13];case 13:return[2]}})})}.bind(null,n)},(e=Fr(e,Jl)).verifyInitialized(),new Ql(t,e.connection,e.credentials,e.serializer,r)),n.onNetworkStatusChange.push(function(t){return m(i,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return t?(n.watchStream.inhibitBackoff(),hh(n)?lh(n):n.onlineStateTracker.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.watchStream.stop()];case 2:e.sent(),dh(n),e.label=3;case 3:return[2]}})})})),n.watchStream}function Sh(n){var e,t,r,i=this;return n.writeStream||(qr(0===n.writePipeline.length,"Should not issue writes before WriteStream is enabled"),n.writeStream=(e=n.datastore,t=n.asyncQueue,r={onOpen:function(t){return m(this,void 0,void 0,function(){return g(this,function(e){return Sh(t).writeHandshake(),[2]})})}.bind(null,n),onClose:function(t,n){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return void 0===n&&qr(!vh(t),"Write stream was stopped gracefully while still needed."),n&&Sh(t).handshakeComplete?[4,function(r,i){return m(this,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return ya(t=i.code)&&t!==Cr.ABORTED?(n=r.writePipeline.shift(),Sh(r).inhibitBackoff(),qr(!!r.remoteSyncer.rejectFailedWrite,"rejectFailedWrite() not set"),[4,yh(r,function(){return r.remoteSyncer.rejectFailedWrite(n.batchId,i)})]):[3,3];case 1:return e.sent(),[4,mh(r)];case 2:e.sent(),e.label=3;case 3:return[2]}var t})})}(t,n)]:[3,2];case 1:e.sent(),e.label=2;case 2:return vh(t)&&bh(t),[2]}})})}.bind(null,n),onHandshakeComplete:function(o){return m(this,void 0,void 0,function(){var t,n,r,i;return g(this,function(e){for(t=Sh(o),n=0,r=o.writePipeline;n<r.length;n++)i=r[n],t.writeMutations(i.mutations);return[2]})})}.bind(null,n),onMutationResult:function(r,i,o){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return qr(0<r.writePipeline.length,"Got result for empty write pipeline"),t=r.writePipeline.shift(),n=nu.from(t,i,o),qr(!!r.remoteSyncer.applySuccessfulWrite,"applySuccessfulWrite() not set"),[4,yh(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return e.sent(),[4,mh(r)];case 2:return e.sent(),[2]}})})}.bind(null,n)},(e=Fr(e,Jl)).verifyInitialized(),new Hl(t,e.connection,e.credentials,e.serializer,r)),n.onNetworkStatusChange.push(function(t){return m(i,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return t?(n.writeStream.inhibitBackoff(),[4,mh(n)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,n.writeStream.stop()];case 3:e.sent(),0<n.writePipeline.length&&(xr(th,"Stopping write stream with "+n.writePipeline.length+" pending writes"),n.writePipeline=[]),e.label=4;case 4:return[2]}})})})),n.writeStream}function Ih(){return"undefined"!=typeof window?window:null}function Eh(){return"undefined"!=typeof document?document:null}var Ch="AsyncQueue",Dh=(_h.createAndSchedule=function(e,t,n,r,i){return(i=new _h(e,t,Date.now()+n,r,i)).start(n),i},_h.prototype.start=function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)},_h.prototype.skipDelay=function(){return this.handleDelayElapsed()},_h.prototype.cancel=function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Dr(Cr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))},_h.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},_h.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},_h);function _h(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new tc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}var kh=(Object.defineProperty(Ah.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!1,configurable:!0}),Ah.prototype.enqueueAndForget=function(e){this.enqueue(e)},Ah.prototype.enqueueAndForgetEvenWhileRestricted=function(e){this.verifyNotFailed(),this.enqueueInternal(e)},Ah.prototype.enterRestrictedMode=function(){var e;this._isShuttingDown||(this._isShuttingDown=!0,(e=Eh())&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.visibilityHandler))},Ah.prototype.enqueue=function(e){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(e){}):this.enqueueInternal(e)},Ah.prototype.enqueueRetryable=function(e){var t=this;this.enqueueAndForget(function(){return t.retryableOps.push(e),t.retryNextOp()})},Ah.prototype.retryNextOp=function(){return m(this,void 0,void 0,function(){var t,n=this;return g(this,function(e){switch(e.label){case 0:if(0===this.retryableOps.length)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.retryableOps[0]()];case 2:return e.sent(),this.retryableOps.shift(),this.backoff.reset(),[3,4];case 3:if(!lc(t=e.sent()))throw t;return xr(Ch,"Operation failed with retryable error: "+t),[3,4];case 4:return 0<this.retryableOps.length&&this.backoff.backoffAndRun(function(){return n.retryNextOp()}),[2]}})})},Ah.prototype.enqueueInternal=function(e){var t=this,n=this.tail.then(function(){return t.operationInProgress=!0,e().catch(function(e){throw t.failure=e,t.operationInProgress=!1,Or("INTERNAL UNHANDLED ERROR: ",xh(e)),e}).then(function(e){return t.operationInProgress=!1,e})});return this.tail=n},Ah.prototype.enqueueAfterDelay=function(e,t,n){var r=this;return this.verifyNotFailed(),qr(0<=t,"Attempted to schedule an operation with a negative delay of "+t),-1<this.timerIdsToSkip.indexOf(e)&&(t=0),n=Dh.createAndSchedule(this,e,t,n,function(e){return r.removeDelayedOperation(e)}),this.delayedOperations.push(n),n},Ah.prototype.verifyNotFailed=function(){this.failure&&Pr("AsyncQueue is already failed: "+xh(this.failure))},Ah.prototype.verifyOperationInProgress=function(){qr(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Ah.prototype.drain=function(){return m(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return[4,t=this.tail];case 1:e.sent(),e.label=2;case 2:if(t!==this.tail)return[3,0];e.label=3;case 3:return[2]}})})},Ah.prototype.containsDelayedOperation=function(e){for(var t=0,n=this.delayedOperations;t<n.length;t++)if(n[t].timerId===e)return!0;return!1},Ah.prototype.runAllDelayedOperationsUntil=function(r){var i=this;return this.drain().then(function(){i.delayedOperations.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});for(var e=0,t=i.delayedOperations;e<t.length;e++){var n=t[e];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.drain()})},Ah.prototype.skipDelaysForTimerId=function(e){this.timerIdsToSkip.push(e)},Ah.prototype.removeDelayedOperation=function(e){qr(0<=(e=this.delayedOperations.indexOf(e)),"Delayed operation not found."),this.delayedOperations.splice(e,1)},Ah);function Ah(){var t=this;this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[],this.backoff=new Vl(this,"async_queue_retry"),this.visibilityHandler=function(){var e=Eh();e&&xr(Ch,"Visibility state changed to "+e.visibilityState),t.backoff.skipBackoff()};var e=Eh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.visibilityHandler)}function Nh(e,t){if(Or(Ch,t+": "+e),lc(e))return new Dr(Cr.UNAVAILABLE,t+": "+e);throw e}function xh(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}var Oh=(Rh.emptySet=function(e){return new Rh(e.comparator)},Rh.prototype.has=function(e){return null!=this.keyedMap.get(e)},Rh.prototype.get=function(e){return this.keyedMap.get(e)},Rh.prototype.first=function(){return this.sortedSet.minKey()},Rh.prototype.last=function(){return this.sortedSet.maxKey()},Rh.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},Rh.prototype.indexOf=function(e){return(e=this.keyedMap.get(e))?this.sortedSet.indexOf(e):-1},Object.defineProperty(Rh.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),Rh.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(e,t){return n(e),!1})},Rh.prototype.add=function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))},Rh.prototype.delete=function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this},Rh.prototype.isEqual=function(e){if(!(e instanceof Rh))return!1;if(this.size!==e.size)return!1;for(var t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();t.hasNext();){var r=t.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},Rh.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},Rh.prototype.copy=function(e,t){var n=new Rh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n},Rh);function Rh(n){this.comparator=n?function(e,t){return n(e,t)||li.comparator(e.key,t.key)}:function(e,t){return li.comparator(e.key,t.key)},this.keyedMap=ia,this.sortedSet=new Go(this.comparator)}var Lh=(Ph.prototype.track=function(e){var t=e.doc.key,n=this.changeMap.get(t);!n||0!==e.type&&3===n.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==n.type?this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):Pr("unsupported combination of changes: "+JSON.stringify(e)+" after "+JSON.stringify(n))},Ph.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(e,t){n.push(t)}),n},Ph);function Ph(){this.changeMap=new Go(li.comparator)}var Mh=(qh.fromInitialDocuments=function(e,t,n,r){var i=[];return t.forEach(function(e){i.push({type:0,doc:e})}),new qh(e,t,Oh.emptySet(t),i,n,r,!0,!1)},Object.defineProperty(qh.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),qh.prototype.isEqual=function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&uo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0},qh);function qh(e,t,n,r,i,o,a,s){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var Fh=function(){this.viewSnap=void 0,this.listeners=[]},Bh=function(){this.queries=new iu(co,uo),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set};function Vh(a,s){return m(this,void 0,void 0,function(){var t,n,r,i,o;return g(this,function(e){switch(e.label){case 0:if(qr(!!(t=Fr(a,Bh)).onListen,"onListen not set"),n=s.query,r=!1,(i=t.queries.get(n))||(r=!0,i=new Fh),!r)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),o=i,[4,t.onListen(n)];case 2:return o.viewSnap=e.sent(),[3,4];case 3:return o=Nh(o=e.sent(),"Initialization of query '"+lo(s.query)+"' failed"),s.onError(o),[2];case 4:return t.queries.set(n,i),i.listeners.push(s),qr(!s.applyOnlineStateChange(t.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),i.viewSnap&&s.onViewSnapshot(i.viewSnap)&&Kh(t),[2]}})})}function Uh(a,s){return m(this,void 0,void 0,function(){var t,n,r,i,o;return g(this,function(e){return qr(!!(t=Fr(a,Bh)).onUnlisten,"onUnlisten not set"),n=s.query,r=!1,(i=t.queries.get(n))&&0<=(o=i.listeners.indexOf(s))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?(t.queries.delete(n),[2,t.onUnlisten(n)]):[2]})})}function Kh(e){e.snapshotsInSyncListeners.forEach(function(e){e.next()})}var jh=(zh.prototype.onViewSnapshot=function(e){if(qr(0<e.docChanges.length||e.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var t=[],n=0,r=e.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&t.push(i)}e=new Mh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),o=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),o=!0),this.snap=e,o},zh.prototype.onError=function(e){this.queryObserver.error(e)},zh.prototype.applyOnlineStateChange=function(e){this.onlineState=e;var t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t},zh.prototype.shouldRaiseInitialEvent=function(e,t){if(qr(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!e.fromCache)return!0;var n="Offline"!==t;return this.options.waitForSyncWhenOnline&&n?(qr(e.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!e.docs.isEmpty()||"Offline"===t},zh.prototype.shouldRaiseEvent=function(e){if(0<e.docChanges.length)return!0;var t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges},zh.prototype.raiseInitialEvent=function(e){qr(!this.raisedInitialEvent,"Trying to raise initial events for second time"),e=Mh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(e)},zh);function zh(e,t,n){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=n||{}}var Qh=(Gh.fromSnapshot=function(e,t){for(var n=sa(),r=sa(),i=0,o=t.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:r=r.add(a.doc.key)}}return new Gh(e,t.fromCache,n,r)},Gh);function Gh(e,t,n,r){this.targetId=e,this.fromCache=t,this.addedKeys=n,this.removedKeys=r}var Wh=(Hh.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},Hh.prototype.addReference=function(e,t){t=new Yh(e,t),this.refsByKey=this.refsByKey.add(t),this.refsByTarget=this.refsByTarget.add(t)},Hh.prototype.addReferences=function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})},Hh.prototype.removeReference=function(e,t){this.removeRef(new Yh(e,t))},Hh.prototype.removeReferences=function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})},Hh.prototype.removeReferencesForId=function(e){var t=this,n=new li(new ii([])),r=new Yh(n,e),e=new Yh(n,e+1),i=[];return this.refsByTarget.forEachInRange([r,e],function(e){t.removeRef(e),i.push(e.key)}),i},Hh.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},Hh.prototype.removeRef=function(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)},Hh.prototype.referencesForId=function(e){var t=new li(new ii([])),n=new Yh(t,e),e=new Yh(t,e+1),r=sa();return this.refsByTarget.forEachInRange([n,e],function(e){r=r.add(e.key)}),r},Hh.prototype.containsKey=function(e){var t=new Yh(e,0);return null!==(t=this.refsByKey.firstAfterOrEqual(t))&&e.isEqual(t.key)},Hh);function Hh(){this.refsByKey=new Zo(Yh.compareByKey),this.refsByTarget=new Zo(Yh.compareByTargetId)}var Yh=(Xh.compareByKey=function(e,t){return li.comparator(e.key,t.key)||Ur(e.targetOrBatchId,t.targetOrBatchId)},Xh.compareByTargetId=function(e,t){return Ur(e.targetOrBatchId,t.targetOrBatchId)||li.comparator(e.key,t.key)},Xh);function Xh(e,t){this.key=e,this.targetOrBatchId=t}var Jh=function(e){this.key=e},$h=function(e){this.key=e},Zh=(Object.defineProperty(ef.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!1,configurable:!0}),ef.prototype.computeDocChanges=function(e,t){var a=this,s=t?t.changeSet:new Lh,u=(t||this).documentSet,c=(t||this).mutatedKeys,l=u,h=!1,f=Zi(this.query)&&u.size===this.query.limit?u.last():null,d=eo(this.query)&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal(function(e,t){var n=u.get(e),r=t instanceof qi?t:null;r&&(qr(e.isEqual(r.key),"Mismatching keys found in document changes: "+e+" != "+r.key),r=ho(a.query,r)?r:null);var i=!!n&&a.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||a.mutatedKeys.has(r.key)&&r.hasCommittedMutations),t=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(s.track({type:3,doc:r}),t=!0):a.shouldWaitForSyncedDocument(n,r)||(s.track({type:2,doc:r}),t=!0,(f&&0<a.docComparator(r,f)||d&&a.docComparator(r,d)<0)&&(h=!0)):!n&&r?(s.track({type:0,doc:r}),t=!0):n&&!r&&(s.track({type:1,doc:n}),t=!0,(f||d)&&(h=!0)),t&&(c=r?(l=l.add(r),o?c.add(e):c.delete(e)):(l=l.delete(e),c.delete(e)))}),Zi(this.query)||eo(this.query))for(;l.size>this.query.limit;){var n=Zi(this.query)?l.last():l.first(),l=l.delete(n.key),c=c.delete(n.key);s.track({type:1,doc:n})}return qr(!h||!t,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:s,needsRefill:h,mutatedKeys:c}},ef.prototype.shouldWaitForSyncedDocument=function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations},ef.prototype.applyChanges=function(e,t,n){var o=this;qr(!e.needsRefill,"Cannot apply changes that need a refill");var r=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;var i=e.changeSet.getChanges();i.sort(function(e,t){return r=e.type,i=t.type,n(r)-n(i)||o.docComparator(e.doc,t.doc);function n(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pr("Unknown ChangeType: "+e)}}var r,i}),this.applyTargetChange(n);var a=t?this.updateLimboDocuments():[],t=(n=0===this.limboDocuments.size&&this.current?1:0)!==this.syncState;return this.syncState=n,0!==i.length||t?{snapshot:new Mh(this.query,e.documentSet,r,i,e.mutatedKeys,0==n,t,!1),limboChanges:a}:{limboChanges:a}},ef.prototype.applyOnlineStateChange=function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Lh,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},ef.prototype.shouldBeInLimbo=function(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations},ef.prototype.applyTargetChange=function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.add(e)}),e.modifiedDocuments.forEach(function(e){qr(t._syncedDocuments.has(e),"Modified document "+e+" not found in view.")}),e.removedDocuments.forEach(function(e){return t._syncedDocuments=t._syncedDocuments.delete(e)}),this.current=e.current)},ef.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=sa(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var r=[];return n.forEach(function(e){t.limboDocuments.has(e)||r.push(new $h(e))}),this.limboDocuments.forEach(function(e){n.has(e)||r.push(new Jh(e))}),r},ef.prototype.synchronizeWithPersistedState=function(e){return this._syncedDocuments=e.remoteKeys,this.limboDocuments=sa(),e=this.computeDocChanges(e.documents),this.applyChanges(e,!0)},ef.prototype.computeInitialSnapshot=function(){return Mh.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState)},ef);function ef(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.current=!1,this.limboDocuments=sa(),this.mutatedKeys=sa(),this.docComparator=fo(e),this.documentSet=new Oh(this.docComparator)}var tf="SyncEngine",nf=function(e,t,n){this.query=e,this.targetId=t,this.view=n},rf=function(e){this.key=e,this.receivedDocument=!1},of=(Object.defineProperty(af.prototype,"isPrimaryClient",{get:function(){return!0===this._isPrimaryClient},enumerable:!1,configurable:!0}),af);function af(e,t,n,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new iu(co,uo),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=[],this.activeLimboTargetsByKey=new Go(li.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Wh,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Wc.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}function sf(i,o,a,s){return m(this,void 0,void 0,function(){var t,n,r;return g(this,function(e){switch(e.label){case 0:return i.applyDocChanges=function(e,t,n){return function(r,i,o,a){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return(t=i.view.computeDocChanges(o)).needsRefill?[4,Ml(r.localStore,i.query,!1).then(function(e){return e=e.documents,i.view.computeDocChanges(e,t)})]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return n=a&&a.targetChanges.get(i.targetId),n=i.view.applyChanges(t,r.isPrimaryClient,n),yf(r,i.targetId,n.limboChanges),[2,n.snapshot]}})})}(i,e,t,n)},[4,Ml(i.localStore,o,!0)];case 1:return n=e.sent(),r=new Zh(o,n.remoteKeys),t=r.computeDocChanges(n.documents),n=ba.createSynthesizedTargetChangeForCurrentChange(a,s&&"Offline"!==i.onlineState),n=r.applyChanges(t,i.isPrimaryClient,n),yf(i,a,n.limboChanges),qr(!!n.snapshot,"applyChanges for new view should always return a snapshot"),r=new nf(o,a,r),i.queryViewsByQuery.set(o,r),i.queriesByTarget.has(a)?i.queriesByTarget.get(a).push(o):i.queriesByTarget.set(a,[o]),[2,n.snapshot]}})})}function uf(s,u,c){return m(this,void 0,void 0,function(){var o,a;return g(this,function(e){switch(e.label){case 0:a=Tf(s),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,xl(a.localStore,u)];case 2:return o=e.sent(),a.sharedClientState.addPendingMutation(o.batchId),t=a,n=o.batchId,r=c,i=(i=(i=t.mutationUserCallbacks[t.currentUser.toKey()])||new Go(Ur)).insert(n,r),t.mutationUserCallbacks[t.currentUser.toKey()]=i,[4,gf(a,o.changes)];case 3:return e.sent(),[4,mh(a.remoteStore)];case 4:return e.sent(),[3,6];case 5:return a=Nh(a=e.sent(),"Failed to persist write"),c.reject(a),[3,6];case 6:return[2]}var t,n,r,i})})}function cf(r,i){return m(this,void 0,void 0,function(){var n,t;return g(this,function(e){switch(e.label){case 0:n=Fr(r,of),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Rl(n.localStore,i)];case 2:return t=e.sent(),i.targetChanges.forEach(function(e,t){(t=n.activeLimboResolutionsByTarget.get(t))&&(Mr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?t.receivedDocument=!0:0<e.modifiedDocuments.size?Mr(t.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Mr(t.receivedDocument,"Received remove for limbo target document without add."),t.receivedDocument=!1))}),[4,gf(n,t,i)];case 3:return e.sent(),[3,6];case 4:return[4,Bl(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function lf(e,n,t){var r;((e=Fr(e,of)).isPrimaryClient&&0===t||!e.isPrimaryClient&&1===t)&&(r=[],e.queryViewsByQuery.forEach(function(e,t){qr(0===(t=t.view.applyOnlineStateChange(n)).limboChanges.length,"OnlineState should not affect limbo documents."),t.snapshot&&r.push(t.snapshot)}),function(e,i){(e=Fr(e,Bh)).onlineState=i;var o=!1;e.queries.forEach(function(e,t){for(var n=0,r=t.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&Kh(e)}(e.eventManager,n),r.length&&(qr(!!e.syncEngineListener.onWatchChange,"Active views but EventManager callbacks are not assigned"),e.syncEngineListener.onWatchChange(r)),e.onlineState=n,e.isPrimaryClient&&e.sharedClientState.setOnlineState(n))}function hf(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(function(e){e.resolve()}),e.pendingWritesCallbacks.delete(t)}function ff(e,t,n){var r=Fr(e,of),i=r.mutationUserCallbacks[r.currentUser.toKey()];i&&((e=i.get(t))&&(qr(t===i.minKey(),"Mutation callbacks processed out-of-order?"),n?e.reject(n):e.resolve(),i=i.remove(t)),r.mutationUserCallbacks[r.currentUser.toKey()]=i)}function df(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e),qr(t.queriesByTarget.has(e)&&0!==t.queriesByTarget.get(e).length,"There are no queries mapped to target id "+e);for(var r=0,i=t.queriesByTarget.get(e);r<i.length;r++){var o=i[r];t.queryViewsByQuery.delete(o),n&&t.syncEngineListener.onWatchError(o,n)}t.queriesByTarget.delete(e),t.isPrimaryClient&&t.limboDocumentRefs.removeReferencesForId(e).forEach(function(e){t.limboDocumentRefs.containsKey(e)||pf(t,e)})}function pf(e,t){var n=e.activeLimboTargetsByKey.get(t);null!==n&&(sh(e.remoteStore,n),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(n),mf(e))}function yf(e,t,n){for(var r,i,o=0,a=n;o<a.length;o++){var s=a[o];s instanceof Jh?(e.limboDocumentRefs.addReference(s.key,t),r=e,i=(i=s).key,r.activeLimboTargetsByKey.get(i)||(xr(tf,"New document in limbo: "+i),r.enqueuedLimboResolutions.push(i),mf(r))):s instanceof $h?(xr(tf,"Document no longer in limbo: "+s.key),e.limboDocumentRefs.removeReference(s.key,t),e.limboDocumentRefs.containsKey(s.key)||pf(e,s.key)):Pr("Unknown limbo change: "+JSON.stringify(s))}}function mf(e){for(;0<e.enqueuedLimboResolutions.length&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){var t=e.enqueuedLimboResolutions.shift(),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new rf(t)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(t,n),ah(e.remoteStore,new fu(ao($i(t.path)),n,2,pu.INVALID))}}function gf(t,a,s){return m(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(e){switch(e.label){case 0:return n=Fr(t,of),r=[],i=[],o=[],n.queryViewsByQuery.isEmpty()?[2]:(n.queryViewsByQuery.forEach(function(e,t){qr(!!n.applyDocChanges,"ApplyDocChangesHandler not set"),o.push(n.applyDocChanges(t,a,s).then(function(e){e&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),r.push(e),e=Qh.fromSnapshot(t.targetId,e),i.push(e))}))}),[4,Promise.all(o)]);case 1:return e.sent(),n.syncEngineListener.onWatchChange(r),[4,function(u,c){return m(this,void 0,void 0,function(){var r,t,n,i,o,a,s;return g(this,function(e){switch(e.label){case 0:r=Fr(u,_l),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return au.forEach(c,function(t){return au.forEach(t.addedKeys,function(e){return r.persistence.referenceDelegate.addReference(n,t.targetId,e)}).next(function(){return au.forEach(t.removedKeys,function(e){return r.persistence.referenceDelegate.removeReference(n,t.targetId,e)})})})})];case 2:return e.sent(),[3,4];case 3:if(!lc(t=e.sent()))throw t;return xr(Cl,"Failed to update sequence numbers: "+t),[3,4];case 4:for(n=0,i=c;n<i.length;n++)s=i[n],o=s.targetId,s.fromCache||(qr(null!==(a=r.targetDataByTarget.get(o)),"Can't set limbo-free snapshot version for unknown target: "+o),s=a.snapshotVersion,s=a.withLastLimboFreeSnapshotVersion(s),r.targetDataByTarget=r.targetDataByTarget.insert(o,s));return[2]}})})}(n.localStore,i)];case 2:return e.sent(),[2]}})})}function vf(d,p,y){return m(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,h,f;return g(this,function(e){switch(e.label){case 0:t=Fr(d,of),n=[],r=[],i=0,o=p,e.label=1;case 1:return i<o.length?(a=o[i],s=void 0,(u=t.queriesByTarget.get(a))&&0!==u.length?[4,Ll(t.localStore,ao(u[0]))]:[3,7]):[3,13];case 2:s=e.sent(),c=0,l=u,e.label=3;case 3:return c<l.length?(l=l[c],qr(!!(h=t.queryViewsByQuery.get(l)),"No query view found for "+lo(l)),[4,function(r,i){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return[4,Ml((t=Fr(r,of)).localStore,i.query,!0)];case 1:return n=e.sent(),n=i.view.synchronizeWithPersistedState(n),t.isPrimaryClient&&yf(t,i.targetId,n.limboChanges),[2,n]}})})}(t,h)]):[3,6];case 4:(h=e.sent()).snapshot&&r.push(h.snapshot),e.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return qr(y,"A secondary tab should never have an active view without an active target."),[4,ql(t.localStore,a)];case 8:return qr(!!(f=e.sent()),"Target for id "+a+" not found"),[4,Ll(t.localStore,f)];case 9:return s=e.sent(),[4,sf(t,bf(f),a,!1)];case 10:e.sent(),e.label=11;case 11:n.push(s),e.label=12;case 12:return i++,[3,1];case 13:return t.syncEngineListener.onWatchChange(r),[2,n]}})})}function bf(e){return Ji(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function wf(e){return(e=Fr(e,of)).remoteStore.remoteSyncer.applyRemoteEvent=cf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){var n=Fr(e,of);if((e=n.activeLimboResolutionsByTarget.get(t))&&e.receivedDocument)return sa().add(e.key);var r=sa();if(!(t=n.queriesByTarget.get(t)))return r;for(var i=0,o=t;i<o.length;i++){var a=o[i],s=n.queryViewsByQuery.get(a);qr(!!s,"No query view found for "+lo(a)),r=r.unionWith(s.view.syncedDocuments)}return r}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=function(o,a,s){return m(this,void 0,void 0,function(){var t,n,r,i;return g(this,function(e){switch(e.label){case 0:return(t=Fr(o,of)).sharedClientState.updateQueryState(a,"rejected",s),i=t.activeLimboResolutionsByTarget.get(a),(n=i&&i.key)?(r=(r=new Go(li.comparator)).insert(n,new Vi(n,zo.min())),i=sa().add(n),i=new ga(zo.min(),new Map,new Zo(Ur),r,i),[4,cf(t,i)]):[3,2];case 1:return e.sent(),t.activeLimboTargetsByKey=t.activeLimboTargetsByKey.remove(n),t.activeLimboResolutionsByTarget.delete(a),mf(t),[3,4];case 2:return[4,Pl(t.localStore,a,!1).then(function(){return df(t,a,s)}).catch(Bl)];case 3:e.sent(),e.label=4;case 4:return[2]}})})}.bind(null,e),e.syncEngineListener.onWatchChange=function(e,t){for(var n=Fr(e,Bh),r=!1,i=0,o=t;i<o.length;i++){var a=o[i],s=a.query;if(s=n.queries.get(s)){for(var u=0,c=s.listeners;u<c.length;u++)c[u].onViewSnapshot(a)&&(r=!0);s.viewSnap=a}}r&&Kh(n)}.bind(null,e.eventManager),e.syncEngineListener.onWatchError=function(e,t,n){var r=Fr(e,Bh);if(e=r.queries.get(t))for(var i=0,o=e.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(t)}.bind(null,e.eventManager),e}function Tf(e){return(e=Fr(e,of)).remoteStore.remoteSyncer.applySuccessfulWrite=function(o,a){return m(this,void 0,void 0,function(){var n,r,i;return g(this,function(e){switch(e.label){case 0:n=Fr(o,of),r=a.batch.batchId,e.label=1;case 1:return e.trys.push([1,4,,6]),[4,(t=n.localStore,l=a,(h=Fr(t,_l)).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(e){var i,t=l.batch.keys(),n=h.remoteDocuments.newChangeBuffer({trackRemovals:!0}),r=h,o=e,a=n,s=(i=l).batch,u=s.keys(),c=au.resolve();return u.forEach(function(r){c=c.next(function(){return a.getEntry(o,r)}).next(function(e){var t=e,n=i.docVersions.get(r);Mr(null!==n,"ackVersions should contain every doc in the write."),(!t||t.version.compareTo(n)<0)&&((t=s.applyToRemoteDocument(r,t,i))?a.addEntry(t,i.commitVersion):qr(!e,"Mutation batch "+s+" applied to document "+e+" resulted in null"))})}),c.next(function(){return r.mutationQueue.removeMutationBatch(o,s)}).next(function(){return n.apply(e)}).next(function(){return h.mutationQueue.performConsistencyCheck(e)}).next(function(){return h.localDocuments.getDocuments(e,t)})}))];case 2:return i=e.sent(),ff(n,r,null),hf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,gf(n,i)];case 3:return e.sent(),[3,6];case 4:return[4,Bl(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}var t,l,h})})}.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=function(a,s,u){return m(this,void 0,void 0,function(){var n,o;return g(this,function(e){switch(e.label){case 0:n=Fr(a,of),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,(t=n.localStore,r=s,(i=Fr(t,_l)).persistence.runTransaction("Reject batch","readwrite-primary",function(t){var n;return i.mutationQueue.lookupMutationBatch(t,r).next(function(e){return Mr(null!==e,"Attempt to reject nonexistent batch!"),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,n)})}))];case 2:return o=e.sent(),ff(n,s,u),hf(n,s),n.sharedClientState.updateMutationState(s,"rejected",u),[4,gf(n,o)];case 3:return e.sent(),[3,6];case 4:return[4,Bl(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}var t,r,i})})}.bind(null,e),e}var Sf="firestore_clients";function If(e,t){return qr(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),Sf+"_"+e+"_"+t}var Ef="firestore_mutations";function Cf(e,t,n){return n=Ef+"_"+e+"_"+n,t.isAuthenticated()&&(n+="_"+t.uid),n}var Df="firestore_targets";function _f(e,t){return Df+"_"+e+"_"+t}var kf="SharedClientState",Af=(Nf.fromWebStorageEntry=function(e,t,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Dr(r.error.code,r.error.message)),i?new Nf(e,t,r.state,o):(Or(kf,"Failed to parse mutation state for ID '"+t+"': "+n),null)},Nf.prototype.toWebStorageJSON=function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)},Nf);function Nf(e,t,n,r){this.user=e,this.batchId=t,this.state=n,qr(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var xf=(Of.fromWebStorageEntry=function(e,t){var n=JSON.parse(t),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Dr(n.error.code,n.error.message)),r?new Of(e,n.state,i):(Or(kf,"Failed to parse target state for ID '"+e+"': "+t),null)},Of.prototype.toWebStorageJSON=function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)},Of);function Of(e,t,n){this.targetId=e,this.state=t,qr(void 0!==(this.error=n)==("rejected"===t),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var Rf=(Lf.fromWebStorageEntry=function(e,t){for(var n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ua,o=0;r&&o<n.activeTargetIds.length;++o)r=ei(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Lf(e,i):(Or(kf,"Failed to parse client data for instance '"+e+"': "+t),null)},Lf);function Lf(e,t){this.clientId=e,this.activeTargetIds=t}var Pf=(Mf.fromWebStorageEntry=function(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Mf(t.clientId,t.onlineState):(Or(kf,"Failed to parse online state: "+e),null)},Mf);function Mf(e,t){this.clientId=e,this.onlineState=t}var qf=(Ff.prototype.addQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.add(e)},Ff.prototype.removeQueryTarget=function(e){this.activeTargetIds=this.activeTargetIds.delete(e)},Ff.prototype.toWebStorageJSON=function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)},Ff);function Ff(){this.activeTargetIds=ua}var Bf=(Vf.isAvailable=function(e){return!(!e||!e.localStorage)},Vf.prototype.start=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,h=this;return g(this,function(e){switch(e.label){case 0:return qr(!this.started,"WebStorageSharedClientState already started"),qr(null!==this.syncEngine,"syncEngine property must be set before calling start()"),qr(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(a=e.sent(),t=0,n=a;t<n.length;t++)(r=n[t])!==this.localClientId&&(i=this.getItem(If(this.persistenceKey,r)))&&(o=Rf.fromWebStorageEntry(r,i))&&(this.activeClients=this.activeClients.insert(o.clientId,o));for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,c=this.earlyEvents;u<c.length;u++)l=c[u],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.window.addEventListener("unload",function(){return h.shutdown()}),this.started=!0,[2]}})})},Vf.prototype.writeSequenceNumber=function(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))},Vf.prototype.getAllActiveQueryTargets=function(){return this.extractActiveQueryTargets(this.activeClients)},Vf.prototype.isActiveQueryTarget=function(n){var r=!1;return this.activeClients.forEach(function(e,t){t.activeTargetIds.has(n)&&(r=!0)}),r},Vf.prototype.addPendingMutation=function(e){this.persistMutationState(e,"pending")},Vf.prototype.updateMutationState=function(e,t,n){this.persistMutationState(e,t,n),this.removeMutationState(e)},Vf.prototype.addLocalQueryTarget=function(e){var t,n="not-current";return this.isActiveQueryTarget(e)&&(!(t=this.storage.getItem(_f(this.persistenceKey,e)))||(t=xf.fromWebStorageEntry(e,t))&&(n=t.state)),this.localClientState.addQueryTarget(e),this.persistClientState(),n},Vf.prototype.removeLocalQueryTarget=function(e){this.localClientState.removeQueryTarget(e),this.persistClientState()},Vf.prototype.isLocalQueryTarget=function(e){return this.localClientState.activeTargetIds.has(e)},Vf.prototype.clearQueryState=function(e){this.removeItem(_f(this.persistenceKey,e))},Vf.prototype.updateQueryState=function(e,t,n){this.persistQueryTargetState(e,t,n)},Vf.prototype.handleUserChange=function(e,t,n){var r=this;t.forEach(function(e){r.removeMutationState(e)}),this.currentUser=e,n.forEach(function(e){r.addPendingMutation(e)})},Vf.prototype.setOnlineState=function(e){this.persistOnlineState(e)},Vf.prototype.notifyBundleLoaded=function(){this.persistBundleLoadedState()},Vf.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},Vf.prototype.getItem=function(e){var t=this.storage.getItem(e);return xr(kf,"READ",e,t),t},Vf.prototype.setItem=function(e,t){xr(kf,"SET",e,t),this.storage.setItem(e,t)},Vf.prototype.removeItem=function(e){xr(kf,"REMOVE",e),this.storage.removeItem(e)},Vf.prototype.handleWebStorageEvent=function(e){var t=this,o=e;o.storageArea===this.storage&&(xr(kf,"EVENT",o.key,o.newValue),o.key!==this.localClientStorageKey?this.queue.enqueueRetryable(function(){return m(t,void 0,void 0,function(){var t,n,r,i;return g(this,function(e){if(!this.started)return this.earlyEvents.push(o),[2];if(null===o.key)return[2];if(this.clientStateKeyRe.test(o.key)){if(null==o.newValue)return t=this.fromWebStorageClientStateKey(o.key),[2,this.handleClientStateEvent(t,null)];if(t=this.fromWebStorageClientState(o.key,o.newValue))return[2,this.handleClientStateEvent(t.clientId,t)]}else if(this.mutationBatchKeyRe.test(o.key)){if(null!==o.newValue&&(n=this.fromWebStorageMutationMetadata(o.key,o.newValue)))return[2,this.handleMutationBatchEvent(n)]}else if(this.queryTargetKeyRe.test(o.key)){if(null!==o.newValue&&(r=this.fromWebStorageQueryTargetMetadata(o.key,o.newValue)))return[2,this.handleQueryTargetEvent(r)]}else if(o.key===this.onlineStateKey){if(null!==o.newValue&&(i=this.fromWebStorageOnlineState(o.newValue)))return[2,this.handleOnlineStateEvent(i)]}else if(o.key===this.sequenceNumberKey)qr(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(i=function(e){var t=pu.INVALID;if(null!=e)try{var n=JSON.parse(e);Mr("number"==typeof n,"Found non-numeric sequence number"),t=n}catch(e){Or(kf,"Failed to read sequence number from WebStorage",e)}return t}(o.newValue))!==pu.INVALID&&this.sequenceNumberHandler(i);else if(o.key===this.bundleLoadedKey)return[2,this.syncEngine.synchronizeWithChangedDocuments()];return[2]})})}):Or("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(Vf.prototype,"localClientState",{get:function(){return this.activeClients.get(this.localClientId)},enumerable:!1,configurable:!0}),Vf.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},Vf.prototype.persistMutationState=function(e,t,n){n=new Af(this.currentUser,e,t,n),e=Cf(this.persistenceKey,this.currentUser,e),this.setItem(e,n.toWebStorageJSON())},Vf.prototype.removeMutationState=function(e){e=Cf(this.persistenceKey,this.currentUser,e),this.removeItem(e)},Vf.prototype.persistOnlineState=function(e){e={clientId:this.localClientId,onlineState:e},this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},Vf.prototype.persistQueryTargetState=function(e,t,n){var r=_f(this.persistenceKey,e),n=new xf(e,t,n);this.setItem(r,n.toWebStorageJSON())},Vf.prototype.persistBundleLoadedState=function(){this.setItem(this.bundleLoadedKey,"value-not-used")},Vf.prototype.fromWebStorageClientStateKey=function(e){return(e=this.clientStateKeyRe.exec(e))?e[1]:null},Vf.prototype.fromWebStorageClientState=function(e,t){var n=this.fromWebStorageClientStateKey(e);return qr(null!==n,"Cannot parse client state key '"+e+"'"),Rf.fromWebStorageEntry(n,t)},Vf.prototype.fromWebStorageMutationMetadata=function(e,t){var n=this.mutationBatchKeyRe.exec(e);return qr(null!==n,"Cannot parse mutation batch key '"+e+"'"),e=Number(n[1]),n=void 0!==n[2]?n[2]:null,Af.fromWebStorageEntry(new Sr(n),e,t)},Vf.prototype.fromWebStorageQueryTargetMetadata=function(e,t){var n=this.queryTargetKeyRe.exec(e);return qr(null!==n,"Cannot parse query target key '"+e+"'"),n=Number(n[1]),xf.fromWebStorageEntry(n,t)},Vf.prototype.fromWebStorageOnlineState=function(e){return Pf.fromWebStorageEntry(e)},Vf.prototype.handleMutationBatchEvent=function(t){return m(this,void 0,void 0,function(){return g(this,function(e){return t.user.uid!==this.currentUser.uid?(xr(kf,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},Vf.prototype.handleQueryTargetEvent=function(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)},Vf.prototype.handleClientStateEvent=function(e,t){var n=this,r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),o=this.extractActiveQueryTargets(r),a=[],s=[];return o.forEach(function(e){i.has(e)||a.push(e)}),i.forEach(function(e){o.has(e)||s.push(e)}),this.syncEngine.applyActiveTargetsChange(a,s).then(function(){n.activeClients=r})},Vf.prototype.handleOnlineStateEvent=function(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)},Vf.prototype.extractActiveQueryTargets=function(e){var n=ua;return e.forEach(function(e,t){n=n.unionWith(t.activeTargetIds)}),n},Vf);function Vf(e,t,n,r,i){this.window=e,this.queue=t,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Go(Ur),this.started=!1,this.earlyEvents=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=If(this.persistenceKey,this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+(i=this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new qf),this.clientStateKeyRe=new RegExp("^"+Sf+"_"+n+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Ef+"_"+n+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+Df+"_"+n+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+(n=this.persistenceKey),this.bundleLoadedKey="firestore_bundle_loaded_"+(n=this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}var Uf=(Kf.prototype.addPendingMutation=function(e){},Kf.prototype.updateMutationState=function(e,t,n){},Kf.prototype.addLocalQueryTarget=function(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"},Kf.prototype.updateQueryState=function(e,t,n){this.queryState[e]=t},Kf.prototype.removeLocalQueryTarget=function(e){this.localState.removeQueryTarget(e)},Kf.prototype.isLocalQueryTarget=function(e){return this.localState.activeTargetIds.has(e)},Kf.prototype.clearQueryState=function(e){delete this.queryState[e]},Kf.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},Kf.prototype.isActiveQueryTarget=function(e){return this.localState.activeTargetIds.has(e)},Kf.prototype.start=function(){return this.localState=new qf,Promise.resolve()},Kf.prototype.handleUserChange=function(e,t,n){},Kf.prototype.setOnlineState=function(e){},Kf.prototype.shutdown=function(){},Kf.prototype.writeSequenceNumber=function(e){},Kf.prototype.notifyBundleLoaded=function(){},Kf);function Kf(){this.localState=new qf,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}var jf=(zf.prototype.setLocalDocumentsView=function(e){this.localDocumentsView=e},zf.prototype.getDocumentsMatchingQuery=function(t,r,i,o){var a=this;return qr(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(zo.min())?this.executeFullCollectionScan(t,r):this.localDocumentsView.getDocuments(t,o).next(function(e){var n=a.applyQuery(r,e);return(Zi(r)||eo(r))&&a.needsRefill(r.limitType,n,o,i)?a.executeFullCollectionScan(t,r):(Nr()<=f.DEBUG&&xr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),lo(r)),a.localDocumentsView.getDocumentsMatchingQuery(t,r,i).next(function(t){return n.forEach(function(e){t=t.insert(e.key,e)}),t}))})},zf.prototype.applyQuery=function(n,e){var r=new Zo(fo(n));return e.forEach(function(e,t){t instanceof qi&&ho(n,t)&&(r=r.add(t))}),r},zf.prototype.needsRefill=function(e,t,n,r){return n.size!==t.size||!!(t="F"===e?t.last():t.first())&&(t.hasPendingWrites||0<t.version.compareTo(r))},zf.prototype.executeFullCollectionScan=function(e,t){return Nr()<=f.DEBUG&&xr("QueryEngine","Using full collection scan to execute query:",lo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,zo.min())},zf);function zf(){}var Qf=(Gf.prototype.checkEmpty=function(e){return au.resolve(0===this.mutationQueue.length)},Gf.prototype.addMutationBatch=function(e,t,n,r){qr(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&qr(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order"),n=new eu(i,t,n,r),this.mutationQueue.push(n);for(var o=0,a=r;o<a.length;o++){var s=a[o];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Yh(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}return au.resolve(n)},Gf.prototype.lookupMutationBatch=function(e,t){return au.resolve(this.findMutationBatch(t))},Gf.prototype.getNextMutationBatchAfterBatchId=function(e,t){return t+=1,t=(t=this.indexOfBatchId(t))<0?0:t,au.resolve(this.mutationQueue.length>t?this.mutationQueue[t]:null)},Gf.prototype.getHighestUnacknowledgedBatchId=function(){return au.resolve(0===this.mutationQueue.length?Zs:this.nextBatchId-1)},Gf.prototype.getAllMutationBatches=function(e){return au.resolve(this.mutationQueue.slice())},Gf.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var n=this,r=new Yh(t,0),i=new Yh(t,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(e){qr(t.isEqual(e.key),"Should only iterate over a single key's batches"),qr(null!==(e=n.findMutationBatch(e.targetOrBatchId)),"Batches in the index must exist in the main table"),o.push(e)}),au.resolve(o)},Gf.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var r=this,i=new Zo(Ur);return t.forEach(function(t){var e=new Yh(t,0),n=new Yh(t,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([e,n],function(e){qr(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),i=i.add(e.targetOrBatchId)})}),au.resolve(this.findMutationBatches(i))},Gf.prototype.getAllMutationBatchesAffectingQuery=function(e,t){qr(!io(t),"CollectionGroup queries should be handled in LocalDocumentsView");var n=t.path,r=n.length+1,t=n;li.isDocumentKey(t)||(t=t.child(""));var t=new Yh(new li(t),0),i=new Zo(Ur);return this.batchesByDocumentKey.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(i=i.add(e.targetOrBatchId)),!0)},t),au.resolve(this.findMutationBatches(i))},Gf.prototype.findMutationBatches=function(e){var t=this,n=[];return e.forEach(function(e){null!==(e=t.findMutationBatch(e))&&n.push(e)}),n},Gf.prototype.removeMutationBatch=function(n,r){var i=this;Mr(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return au.forEach(r.mutations,function(e){var t=new Yh(e.key,r.batchId);return o=o.delete(t),i.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(function(){i.batchesByDocumentKey=o})},Gf.prototype.removeCachedMutationKeys=function(e){},Gf.prototype.containsKey=function(e,t){var n=new Yh(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(n);return au.resolve(t.isEqual(n&&n.key))},Gf.prototype.performConsistencyCheck=function(e){return 0===this.mutationQueue.length&&qr(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),au.resolve()},Gf.prototype.indexOfExistingBatchId=function(e,t){return qr(0<=(e=this.indexOfBatchId(e))&&e<this.mutationQueue.length,"Batches must exist to be "+t),e},Gf.prototype.indexOfBatchId=function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId},Gf.prototype.findMutationBatch=function(e){var t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:(qr((t=this.mutationQueue[t]).batchId===e,"If found batch must match"),t)},Gf);function Gf(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Zo(Yh.compareByKey)}var Wf=(Hf.prototype.addEntry=function(e,t,n){qr(!n.isEqual(zo.min()),"Cannot add a document with a read time of zero");var r=t.key,i=(o=this.docs.get(r))?o.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{maybeDocument:t,size:o,readTime:n}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())},Hf.prototype.removeEntry=function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)},Hf.prototype.getEntry=function(e,t){return t=this.docs.get(t),au.resolve(t?t.maybeDocument:null)},Hf.prototype.getEntries=function(e,t){var n=this,r=ra;return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.maybeDocument:null)}),au.resolve(r)},Hf.prototype.getDocumentsMatchingQuery=function(e,t,n){qr(!io(t),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=ia,i=new li(t.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=(s=o.getNext()).key,s=(u=s.value).maybeDocument,u=u.readTime;if(!t.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||s instanceof qi&&ho(t,s)&&(r=r.insert(s.key,s))}return au.resolve(r)},Hf.prototype.forEachDocumentKey=function(e,t){return au.forEach(this.docs,function(e){return t(e)})},Hf.prototype.newChangeBuffer=function(e){return new Xf(this)},Hf.prototype.getSize=function(e){return au.resolve(this.size)},Hf);function Hf(e,t){this.indexManager=e,this.sizer=t,this.docs=new Go(li.comparator),this.size=0}var Yf,Xf=(n(Jf,Yf=vt),Jf.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(e,t){t&&t.maybeDocument?i.push(r.documentCache.addEntry(n,t.maybeDocument,r.getReadTime(e))):r.documentCache.removeEntry(e)}),au.waitFor(i)},Jf.prototype.getFromCache=function(e,t){return this.documentCache.getEntry(e,t)},Jf.prototype.getAllFromCache=function(e,t){return this.documentCache.getEntries(e,t)},Jf);function Jf(e){var t=Yf.call(this)||this;return t.documentCache=e,t}var $f=(Zf.prototype.forEachTarget=function(e,n){return this.targets.forEach(function(e,t){return n(t)}),au.resolve()},Zf.prototype.getLastRemoteSnapshotVersion=function(e){return au.resolve(this.lastRemoteSnapshotVersion)},Zf.prototype.getHighestSequenceNumber=function(e){return au.resolve(this.highestSequenceNumber)},Zf.prototype.allocateTargetId=function(e){return this.highestTargetId=this.targetIdGenerator.next(),au.resolve(this.highestTargetId)},Zf.prototype.setTargetsMetadata=function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),au.resolve()},Zf.prototype.saveTargetData=function(e){this.targets.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Wc(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)},Zf.prototype.addTargetData=function(e,t){return qr(!this.targets.has(t.target),"Adding a target that already exists"),this.saveTargetData(t),this.targetCount+=1,au.resolve()},Zf.prototype.updateTargetData=function(e,t){return qr(this.targets.has(t.target),"Updating a non-existent target"),this.saveTargetData(t),au.resolve()},Zf.prototype.removeTargetData=function(e,t){return qr(0<this.targetCount,"Removing a target from an empty cache"),qr(this.targets.has(t.target),"Removing a non-existent target from the cache"),this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),--this.targetCount,au.resolve()},Zf.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.targets.forEach(function(e,t){t.sequenceNumber<=r&&null===i.get(t.targetId)&&(o.targets.delete(e),s.push(o.removeMatchingKeysForTargetId(n,t.targetId)),a++)}),au.waitFor(s).next(function(){return a})},Zf.prototype.getTargetCount=function(e){return au.resolve(this.targetCount)},Zf.prototype.getTargetData=function(e,t){return t=this.targets.get(t)||null,au.resolve(t)},Zf.prototype.addMatchingKeys=function(e,t,n){return this.references.addReferences(t,n),au.resolve()},Zf.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),au.waitFor(i)},Zf.prototype.removeMatchingKeysForTargetId=function(e,t){return this.references.removeReferencesForId(t),au.resolve()},Zf.prototype.getMatchingKeysForTargetId=function(e,t){return t=this.references.referencesForId(t),au.resolve(t)},Zf.prototype.containsKey=function(e,t){return au.resolve(this.references.containsKey(t))},Zf);function Zf(e){this.persistence=e,this.targets=new iu(Wi,Hi),this.lastRemoteSnapshotVersion=zo.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Wh,this.targetCount=0,this.targetIdGenerator=Wc.forTargetCache()}var ed=(td.prototype.getBundleMetadata=function(e,t){return au.resolve(this.bundles.get(t))},td.prototype.saveBundleMetadata=function(e,t){return this.bundles.set(t.id,{id:t.id,version:t.version,createTime:Ba(t.createTime)}),au.resolve()},td.prototype.getNamedQuery=function(e,t){return au.resolve(this.namedQueries.get(t))},td.prototype.saveNamedQuery=function(e,t){return this.namedQueries.set(t.name,{name:t.name,query:Ru(t.bundledQuery),readTime:Ba(t.readTime)}),au.resolve()},td);function td(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}var nd=(rd.prototype.start=function(){return Promise.resolve()},rd.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(rd.prototype,"started",{get:function(){return this._started},enumerable:!1,configurable:!0}),rd.prototype.setDatabaseDeletedListener=function(){},rd.prototype.setNetworkEnabled=function(){},rd.prototype.getIndexManager=function(){return this.indexManager},rd.prototype.getMutationQueue=function(e){var t=this.mutationQueues[e.toKey()];return t||(t=new Qf(this.indexManager,this.referenceDelegate),this.mutationQueues[e.toKey()]=t),t},rd.prototype.getTargetCache=function(){return this.targetCache},rd.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},rd.prototype.getBundleCache=function(){return this.bundleCache},rd.prototype.runTransaction=function(e,t,n){var r=this;xr("MemoryPersistence","Starting transaction:",e);var i=new od(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(e){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})},rd.prototype.mutationQueuesContainKey=function(t,n){return au.or(Object.values(this.mutationQueues).map(function(e){return function(){return e.containsKey(t,n)}}))},rd);function rd(e,t){var n=this;this.mutationQueues={},this.listenSequence=new pu(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new $f(this),this.indexManager=new Ju,this.remoteDocumentCache=(e=this.indexManager,new Wf(e,function(e){return n.referenceDelegate.documentSize(e)})),this.serializer=new Iu(t),this.bundleCache=new ed(this.serializer)}var id,od=(n(ad,id=gt),ad);function ad(e){var t=id.call(this)||this;return t.currentSequenceNumber=e,t}var sd=(ud.factory=function(e){return new ud(e)},Object.defineProperty(ud.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Pr("orphanedDocuments is only valid during a transaction.")},enumerable:!1,configurable:!0}),ud.prototype.addReference=function(e,t,n){return this.localViewReferences.addReference(n,t),this.orphanedDocuments.delete(n.toString()),au.resolve()},ud.prototype.removeReference=function(e,t,n){return this.localViewReferences.removeReference(n,t),this.orphanedDocuments.add(n.toString()),au.resolve()},ud.prototype.markPotentiallyOrphaned=function(e,t){return this.orphanedDocuments.add(t.toString()),au.resolve()},ud.prototype.removeTarget=function(e,t){var n=this;this.localViewReferences.removeReferencesForId(t.targetId).forEach(function(e){return n.orphanedDocuments.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.orphanedDocuments.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})},ud.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},ud.prototype.onTransactionCommitted=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return au.forEach(this.orphanedDocuments,function(e){var t=li.fromPath(e);return r.isReferenced(n,t).next(function(e){e||i.removeEntry(t)})}).next(function(){return r._orphanedDocuments=null,i.apply(n)})},ud.prototype.updateLimboDocument=function(e,t){var n=this;return this.isReferenced(e,t).next(function(e){e?n.orphanedDocuments.delete(t.toString()):n.orphanedDocuments.add(t.toString())})},ud.prototype.documentSize=function(e){return 0},ud.prototype.isReferenced=function(e,t){var n=this;return au.or([function(){return au.resolve(n.localViewReferences.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.mutationQueuesContainKey(e,t)}])},ud);function ud(e){this.persistence=e,this.localViewReferences=new Wh,this._orphanedDocuments=null}var cd=(ld.prototype.onOpen=function(e){qr(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=e},ld.prototype.onClose=function(e){qr(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=e},ld.prototype.onMessage=function(e){qr(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=e},ld.prototype.close=function(){this.closeFn()},ld.prototype.send=function(e){this.sendFn(e)},ld.prototype.callOnOpen=function(){qr(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},ld.prototype.callOnClose=function(e){qr(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(e)},ld.prototype.callOnMessage=function(e){qr(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(e)},ld);function ld(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}var hd="RestConnection",fd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},dd="gl-js/ fire/"+kr,vt=(pd.prototype.invokeRPC=function(t,e,n,r){var i=this.makeUrl(t,e);return xr(hd,"Sending: ",i,n),e={},this.modifyHeadersForRequest(e,r),this.performRPCRequest(t,i,e,n).then(function(e){return xr(hd,"Received: ",e),e},function(e){throw Rr(hd,t+" failed with error: ",e,"url: ",i,"request:",n),e})},pd.prototype.invokeStreamingRPC=function(e,t,n,r){return this.invokeRPC(e,t,n,r)},pd.prototype.modifyHeadersForRequest=function(e,t){if(e["X-Goog-Api-Client"]=dd,e["Content-Type"]="text/plain",t)for(var n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])},pd.prototype.makeUrl=function(e,t){var n=fd[e];return qr(void 0!==n,"Unknown REST mapping for: "+e),this.baseUrl+"/v1/"+t+":"+n},pd);function pd(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.baseUrl=t+"://"+e.host,this.databaseRoot="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}var yd,md="Connection",gd=(n(vd,yd=vt),vd.prototype.performRPCRequest=function(o,t,a,s){return new Promise(function(n,r){var i=new mr;i.listenOnce(dr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case fr.NO_ERROR:var e=i.getResponseJson();xr(md,"XHR received:",JSON.stringify(e)),n(e);break;case fr.TIMEOUT:xr(md,'RPC "'+o+'" timed out'),r(new Dr(Cr.DEADLINE_EXCEEDED,"Request time out"));break;case fr.HTTP_ERROR:var t=i.getStatus();xr(md,'RPC "'+o+'" failed with status:',t,"response text:",i.getResponseText()),0<t?(e=i.getResponseJson().error)&&e.status&&e.message?(t=(t=e.status).toLowerCase().replace(/_/g,"-"),t=0<=Object.values(Cr).indexOf(t)?t:Cr.UNKNOWN,r(new Dr(t,e.message))):r(new Dr(Cr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Dr(Cr.UNAVAILABLE,"Connection failed."));break;default:Pr('RPC "'+o+'" failed with unanticipated webchannel error '+i.getLastErrorCode()+": "+i.getLastError()+", giving up.")}}finally{xr(md,'RPC "'+o+'" completed.')}});var e=JSON.stringify(s);i.send(t,"POST",e,a,15)})},vd.prototype.openStream=function(e,t){var n,r=[this.baseUrl,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new ar,o=hr(),e={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.modifyHeadersForRequest(e.initMessageHeaders,t),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=d().indexOf("Electron/")||0<=(n=d()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=d().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(e.httpHeadersOverwriteParam="$httpHeaders"),r=r.join(""),xr(md,"Creating WebChannel: "+r,e);var a=i.createWebChannel(r,e),s=!1,u=!1,c=new cd({sendFn:function(e){u?xr(md,"Not sending because WebChannel is closed:",e):(s||(xr(md,"Opening WebChannel transport."),a.open(),s=!0),xr(md,"WebChannel sending:",e),a.send(e))},closeFn:function(){return a.close()}});return(e=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})})(a,yr.EventType.OPEN,function(){u||xr(md,"WebChannel transport opened.")}),e(a,yr.EventType.CLOSE,function(){u||(u=!0,xr(md,"WebChannel transport closed"),c.callOnClose())}),e(a,yr.EventType.ERROR,function(e){u||(u=!0,Rr(md,"WebChannel transport errored:",e),c.callOnClose(new Dr(Cr.UNAVAILABLE,"The operation could not be completed")))}),e(a,yr.EventType.MESSAGE,function(e){var t,n,r,i;u||(Mr(!!(t=e.data[0]),"Got a webchannel message without data."),(n=t.error||(null===(i=t[0])||void 0===i?void 0:i.error))?(xr(md,"WebChannel received error:",n),e=function(e){if(void 0!==(e=pa[e]))return ma(e)}(r=n.status),i=n.message,void 0===e&&(e=Cr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.callOnClose(new Dr(e,i)),a.close()):(xr(md,"WebChannel received:",t),c.callOnMessage(t)))}),e(o,pr.STAT_EVENT,function(e){10===e.stat?xr(md,"Detected buffering proxy"):11===e.stat&&xr(md,"Detected no buffering proxy")}),setTimeout(function(){c.callOnOpen()},0),c},vd);function vd(e){var t=yd.call(this,e)||this;return t.forceLongPolling=e.forceLongPolling,t.autoDetectLongPolling=e.autoDetectLongPolling,t}var bd="ConnectivityMonitor",wd=(Td.prototype.addCallback=function(e){this.callbacks.push(e)},Td.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},Td.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},Td.prototype.onNetworkAvailable=function(){xr(bd,"Network connectivity changed: AVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++)(0,t[e])(0)},Td.prototype.onNetworkUnavailable=function(){xr(bd,"Network connectivity changed: UNAVAILABLE");for(var e=0,t=this.callbacks;e<t.length;e++)(0,t[e])(1)},Td.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Td);function Td(){var e=this;this.networkAvailableListener=function(){return e.onNetworkAvailable()},this.networkUnavailableListener=function(){return e.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var Sd=(Id.prototype.addCallback=function(e){},Id.prototype.shutdown=function(){},Id);function Id(){}function Ed(e){return new Ra(e,!0)}var Cd=(Dd.prototype.initialize=function(t){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return this.serializer=Ed(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.createGarbageCollectionScheduler(t),this.localStore=this.createLocalStore(t),[2]}})})},Dd.prototype.createGarbageCollectionScheduler=function(e){return null},Dd.prototype.createLocalStore=function(e){return Al(this.persistence,new jf,e.initialUser,this.serializer)},Dd.prototype.createPersistence=function(e){return new nd(sd.factory,this.serializer)},Dd.prototype.createSharedClientState=function(e){return new Uf},Dd.prototype.terminate=function(){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return e.sent(),[4,this.persistence.shutdown()];case 2:return e.sent(),[2]}})})},Dd);function Dd(){this.synchronizeTabs=!1}var _d,kd=(n(Ad,_d=Cd),Ad.prototype.initialize=function(t){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,_d.prototype.initialize.call(this,t)];case 1:return e.sent(),[4,function(n){return m(this,void 0,void 0,function(){var t;return g(this,function(e){return[2,(t=Fr(n,_l)).persistence.runTransaction("Synchronize last document change read time","readonly",function(e){return e=Hu(e),r=zo.min(),e.iterate({index:Ac.readTimeIndex,reverse:!0},function(e,t,n){t.readTime&&(r=_u(t.readTime)),n.done()}).next(function(){return r});var r}).then(function(e){t.lastDocumentChangeReadTime=e})]})})}(this.localStore)];case 2:return e.sent(),[4,this.onlineComponentProvider.initialize(this,t)];case 3:return e.sent(),[4,Tf(this.onlineComponentProvider.syncEngine)];case 4:return e.sent(),[4,mh(this.onlineComponentProvider.remoteStore)];case 5:return e.sent(),[2]}})})},Ad.prototype.createLocalStore=function(e){return Al(this.persistence,new jf,e.initialUser,this.serializer)},Ad.prototype.createGarbageCollectionScheduler=function(e){var t=this.persistence.referenceDelegate.garbageCollector;return new al(t,e.asyncQueue)},Ad.prototype.createPersistence=function(e){var t=El(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?il.withCacheSize(this.cacheSizeBytes):il.DEFAULT;return new gl(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Ih(),Eh(),this.serializer,this.sharedClientState,!!this.forceOwnership)},Ad.prototype.createSharedClientState=function(e){return new Uf},Ad);function Ad(e,t,n){var r=_d.call(this)||this;return r.onlineComponentProvider=e,r.cacheSizeBytes=t,r.forceOwnership=n,r.synchronizeTabs=!1,r}var Nd,xd=(n(Od,Nd=kd),Od.prototype.initialize=function(r){return m(this,void 0,void 0,function(){var t,n=this;return g(this,function(e){switch(e.label){case 0:return[4,Nd.prototype.initialize.call(this,r)];case 1:return e.sent(),t=this.onlineComponentProvider.syncEngine,this.sharedClientState instanceof Bf?(this.sharedClientState.syncEngine={applyBatchState:function(u,c,l,h){return m(this,void 0,void 0,function(){var a,s;return g(this,function(e){switch(e.label){case 0:return[4,(n=(a=Fr(u,of)).localStore,r=c,i=Fr(n,_l),o=Fr(i.mutationQueue,Lu),i.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return o.lookupMutationKeys(t,r).next(function(e){return e?i.localDocuments.getDocuments(t,e):au.resolve(null)})}))];case 1:return null===(s=e.sent())?(xr(tf,"Cannot apply mutation batch with id: "+c),[2]):"pending"!==l?[3,3]:[4,mh(a.remoteStore)];case 2:return e.sent(),[3,4];case 3:"acknowledged"===l||"rejected"===l?(ff(a,c,h||null),hf(a,c),t=a.localStore,n=c,Fr(Fr(t,_l).mutationQueue,Lu).removeCachedMutationKeys(n)):Pr("Unknown batchState: "+l),e.label=4;case 4:return[4,gf(a,s)];case 5:return e.sent(),[2]}var t,n,r,i,o})})}.bind(null,t),applyTargetState:function(i,o,a,s){return m(this,void 0,void 0,function(){var t,n,r;return g(this,function(e){switch(e.label){case 0:if((t=Fr(i,of))._isPrimaryClient)return xr(tf,"Ignoring unexpected query state notification."),[2];if(!t.queriesByTarget.has(o))return[3,7];switch(a){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,Fl(t.localStore)];case 2:return n=e.sent(),r=ga.createSynthesizedRemoteEventForCurrentChange(o,"current"===a),[4,gf(t,n,r)];case 3:return e.sent(),[3,7];case 4:return[4,Pl(t.localStore,o,!0)];case 5:return e.sent(),df(t,o,s),[3,7];case 6:Pr("Unexpected target state: "+a),e.label=7;case 7:return[2]}})})}.bind(null,t),applyActiveTargetsChange:function(l,h,f){return m(this,void 0,void 0,function(){var n,t,r,i,o,a,s,u,c;return g(this,function(e){switch(e.label){case 0:if(!(n=wf(l))._isPrimaryClient)return[2];t=0,r=h,e.label=1;case 1:return t<r.length?(c=r[t],n.queriesByTarget.has(c)?(xr(tf,"Adding an already active target "+c),[3,5]):[4,ql(n.localStore,c)]):[3,6];case 2:return qr(!!(i=e.sent()),"Query data for active target "+c+" not found"),[4,Ll(n.localStore,i)];case 3:return o=e.sent(),[4,sf(n,bf(i),o.targetId,!1)];case 4:e.sent(),ah(n.remoteStore,o),e.label=5;case 5:return t++,[3,1];case 6:a=function(t){return g(this,function(e){switch(e.label){case 0:return n.queriesByTarget.has(t)?[4,Pl(n.localStore,t,!1).then(function(){sh(n.remoteStore,t),df(n,t)}).catch(Bl)]:[2,"continue"];case 1:return e.sent(),[2]}})},s=0,u=f,e.label=7;case 7:return s<u.length?(c=u[s],[5,a(c)]):[3,10];case 8:e.sent(),e.label=9;case 9:return s++,[3,7];case 10:return[2]}})})}.bind(null,t),getActiveClients:function(e){return e=Fr(e,of),Fr(Fr(e.localStore,_l).persistence,gl).getActiveClients()}.bind(null,t),synchronizeWithChangedDocuments:function(n){return m(this,void 0,void 0,function(){var t;return g(this,function(e){return[2,Fl((t=Fr(n,of)).localStore).then(function(e){return gf(t,e)})]})})}.bind(null,t)},[4,this.sharedClientState.start()]):[3,3];case 2:e.sent(),e.label=3;case 3:return[4,this.persistence.setPrimaryStateListener(function(t){return m(n,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,function(l,h){return m(this,void 0,void 0,function(){var r,t,i,o,a,s,u,c;return g(this,function(e){switch(e.label){case 0:return wf(r=Fr(l,of)),Tf(r),!0!==h||!0===r._isPrimaryClient?[3,3]:(t=r.sharedClientState.getAllActiveQueryTargets(),[4,vf(r,t.toArray(),!0)]);case 1:return i=e.sent(),r._isPrimaryClient=!0,[4,wh(r.remoteStore,!0)];case 2:for(e.sent(),o=0,a=i;o<a.length;o++)s=a[o],ah(r.remoteStore,s);return[3,7];case 3:return!1!==h||!1===r._isPrimaryClient?[3,7]:(u=[],c=Promise.resolve(),r.queriesByTarget.forEach(function(e,t){r.sharedClientState.isLocalQueryTarget(t)?u.push(t):c=c.then(function(){return df(r,t),Pl(r.localStore,t,!0)}),sh(r.remoteStore,t)}),[4,c]);case 4:return e.sent(),[4,vf(r,u,!1)];case 5:return e.sent(),(n=Fr(r,of)).activeLimboResolutionsByTarget.forEach(function(e,t){sh(n.remoteStore,t)}),n.limboDocumentRefs.removeAllReferences(),n.activeLimboResolutionsByTarget=new Map,n.activeLimboTargetsByKey=new Go(li.comparator),r._isPrimaryClient=!1,[4,wh(r.remoteStore,!1)];case 6:e.sent(),e.label=7;case 7:return[2]}var n})})}(this.onlineComponentProvider.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return e.sent(),[2]}})})},Od.prototype.createSharedClientState=function(e){var t=Ih();if(!Bf.isAvailable(t))throw new Dr(Cr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=El(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Bf(t,e.asyncQueue,n,e.clientId,e.initialUser)},Od);function Od(e,t){var n=Nd.call(this,e,t,!1)||this;return n.onlineComponentProvider=e,n.cacheSizeBytes=t,n.synchronizeTabs=!0,n}var Rd=(Ld.prototype.initialize=function(n,r){return m(this,void 0,void 0,function(){var t=this;return g(this,function(e){switch(e.label){case 0:return this.localStore?[2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return lf(t.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=function(i,o){return m(this,void 0,void 0,function(){var n,r;return g(this,function(e){switch(e.label){case 0:return(n=Fr(i,of)).currentUser.isEqual(o)?[3,3]:(xr(tf,"User change. New user:",o.toKey()),[4,Nl(n.localStore,o)]);case 1:return r=e.sent(),n.currentUser=o,(t=n).pendingWritesCallbacks.forEach(function(e){e.forEach(function(e){e.reject(new Dr(Cr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.pendingWritesCallbacks.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,gf(n,r.affectedDocuments)];case 2:e.sent(),e.label=3;case 3:return[2]}var t})})}.bind(null,this.syncEngine),[4,wh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:return e.sent(),[2]}})})},Ld.prototype.createEventManager=function(e){return new Bh},Ld.prototype.createDatastore=function(e){var t=Ed(e.databaseInfo.databaseId),n=(n=e.databaseInfo,new gd(n));return e=e.credentials,new Jl(e,n,t)},Ld.prototype.createRemoteStore=function(e){var t=this,n=this.localStore,r=this.datastore,i=e.asyncQueue,o=function(e){return lf(t.syncEngine,e,0)};return e=new(wd.isAvailable()?wd:Sd),new rh(n,r,i,o,e)},Ld.prototype.createSyncEngine=function(e,t){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,a=e.initialUser,e=e.maxConcurrentLimboResolutions,e=new of(n,r,i,o,a,e),t&&(e._isPrimaryClient=!0),e;var n,r,i,o,a},Ld.prototype.terminate=function(){return function(n){return m(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return t=Fr(n,rh),xr(th,"RemoteStore shutting down."),t.offlineCauses.add(5),[4,oh(t)];case 1:return e.sent(),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown"),[2]}})})}(this.remoteStore)},Ld);function Ld(){}var Pd=(Md.prototype.next=function(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)},Md.prototype.error=function(e){this.observer.error?this.scheduleEvent(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)},Md.prototype.mute=function(){this.muted=!0},Md.prototype.scheduleEvent=function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)},Md);function Md(e){this.observer=e,this.muted=!1}var qd=(Fd.prototype.lookup=function(r){return m(this,void 0,void 0,function(){var t,n=this;return g(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Dr(Cr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(a,s){return m(this,void 0,void 0,function(){var i,t,n,o,r;return g(this,function(e){switch(e.label){case 0:return i=Fr(a,Jl),t=Ga(i.serializer)+"/documents",n={documents:s.map(function(e){return Ka(i.serializer,e)})},[4,i.invokeStreamingRPC("BatchGetDocuments",t,n)];case 1:return n=e.sent(),o=new Map,n.forEach(function(e){var t,n,r;t=i.serializer,e="found"in(n=e)?function(e,t){Mr(!!t.found,"Tried to deserialize a found document from a missing document."),Oa(t.found.name,"doc.found.name"),Oa(t.found.updateTime,"doc.found.updateTime");var n=ja(e,t.found.name),e=Ba(t.found.updateTime),t=new ca({mapValue:{fields:t.found.fields}});return new qi(n,e,t,{})}(t,n):"missing"in n?(r=t,Mr(!!(t=n).missing,"Tried to deserialize a missing document from a found document."),Mr(!!t.readTime,"Tried to deserialize a missing document without a read time."),r=ja(r,t.missing),t=Ba(t.readTime),new Vi(r,t)):Pr("invalid batch get response: "+JSON.stringify(n)),o.set(e.key.toString(),e)}),r=[],s.forEach(function(e){var t=o.get(e.toString());Mr(!!t,"Missing entity in write response for "+e),r.push(t)}),[2,r]}})})}(this.datastore,r)];case 1:return(t=e.sent()).forEach(function(e){e instanceof Vi||e instanceof qi?n.recordVersion(e):Pr("Document in a transaction was a "+e.constructor.name)}),[2,t]}})})},Fd.prototype.set=function(e,t){this.write(t.toMutations(e,this.precondition(e))),this.writtenDocs.add(e.toString())},Fd.prototype.update=function(e,t){try{this.write(t.toMutations(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())},Fd.prototype.delete=function(e){this.write([new Hs(e,this.precondition(e))]),this.writtenDocs.add(e.toString())},Fd.prototype.commit=function(){return m(this,void 0,void 0,function(){var t,n=this;return g(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(e,t){t=li.fromPath(t),n.mutations.push(new Js(t,n.precondition(t)))}),[4,function(i,o){return m(this,void 0,void 0,function(){var t,n,r;return g(this,function(e){switch(e.label){case 0:return t=Fr(i,Jl),n=Ga(t.serializer)+"/documents",r={writes:o.map(function(e){return Ya(t.serializer,e)})},[4,t.invokeRPC("Commit",n,r)];case 1:return e.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},Fd.prototype.recordVersion=function(e){var t;if(e instanceof qi)t=e.version;else{if(!(e instanceof Vi))throw Pr("Document in a transaction was a "+e.constructor.name);t=zo.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Dr(Cr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)},Fd.prototype.precondition=function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?_s.updateTime(t):_s.none()},Fd.prototype.preconditionForUpdate=function(e){var t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return _s.exists(!0);if(t.isEqual(zo.min()))throw new Dr(Cr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return _s.updateTime(t)},Fd.prototype.write=function(e){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(e)},Fd.prototype.ensureCommitNotCalled=function(){qr(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},Fd);function Fd(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}var Bd=(Vd.prototype.run=function(){this.runWithBackOff()},Vd.prototype.runWithBackOff=function(){var e=this;this.backoff.backoffAndRun(function(){return m(e,void 0,void 0,function(){var t,n,r=this;return g(this,function(e){return t=new qd(this.datastore),(n=this.tryRunUpdateFunction(t))&&n.then(function(e){r.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){r.deferred.resolve(e)}).catch(function(e){r.handleTransactionError(e)})})}).catch(function(e){r.handleTransactionError(e)}),[2]})})})},Vd.prototype.tryRunUpdateFunction=function(e){try{var t=this.updateFunction(e);return!$r(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}},Vd.prototype.handleTransactionError=function(e){var t=this;0<this.retries&&this.isRetryableTransactionError(e)?(--this.retries,this.asyncQueue.enqueueAndForget(function(){return t.runWithBackOff(),Promise.resolve()})):this.deferred.reject(e)},Vd.prototype.isRetryableTransactionError=function(e){return"FirebaseError"===e.name&&("aborted"===(e=e.code)||"failed-precondition"===e||!ya(e))},Vd);function Vd(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new Vl(this.asyncQueue,"transaction_retry")}var Ud="FirestoreClient",Kd=(jd.prototype.getConfiguration=function(){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return e.sent(),[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}})})},jd.prototype.setCredentialChangeListener=function(e){var t=this;this.credentialListener=e,this.receivedInitialUser.promise.then(function(){return t.credentialListener(t.user)})},jd.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Dr(Cr.FAILED_PRECONDITION,"The client has already been terminated.")},jd.prototype.terminate=function(){var e=this;this.asyncQueue.enterRestrictedMode();var n=new tc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return m(e,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return t=Nh(e.sent(),"Failed to shutdown persistence"),n.reject(t),[3,6];case 6:return[2]}})})}),n.promise},jd);function jd(e,t,n){var r=this;this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=Sr.UNAUTHENTICATED,this.clientId=Br.newId(),this.credentialListener=function(){},this.receivedInitialUser=new tc,this.credentials.setChangeListener(function(e){xr(Ud,"Received user=",e.uid),r.user.isEqual(e)||(r.user=e,r.credentialListener(e)),r.receivedInitialUser.resolve()})}function zd(r,i){return m(this,void 0,void 0,function(){var t,n=this;return g(this,function(e){switch(e.label){case 0:return r.asyncQueue.verifyOperationInProgress(),xr(Ud,"Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return t=e.sent(),[4,i.initialize(t)];case 2:return e.sent(),r.setCredentialChangeListener(function(t){return r.asyncQueue.enqueueRetryable(function(){return m(n,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,Nl(i.localStore,t)];case 1:return e.sent(),[2]}})})})}),i.persistence.setDatabaseDeletedListener(function(){return r.terminate()}),r.offlineComponents=i,[2]}})})}function Qd(r,i){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,Gd(r)];case 1:return t=e.sent(),xr(Ud,"Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=e.sent(),[4,i.initialize(t,n)];case 3:return e.sent(),r.setCredentialChangeListener(function(e){return r.asyncQueue.enqueueRetryable(function(){return function(r,i){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return(t=Fr(r,rh)).asyncQueue.verifyOperationInProgress(),qr(!!t.remoteSyncer.handleCredentialChange,"handleCredentialChange() not set"),xr(th,"RemoteStore received new credentials"),n=fh(t),t.offlineCauses.add(3),[4,oh(t)];case 1:return e.sent(),n&&t.onlineStateTracker.set("Unknown"),[4,t.remoteSyncer.handleCredentialChange(i)];case 2:return e.sent(),t.offlineCauses.delete(3),[4,ih(t)];case 3:return e.sent(),[2]}})})}(i.remoteStore,e)})}),r.onlineComponents=i,[2]}})})}function Gd(t){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(xr(Ud,"Using default OfflineComponentProvider"),[4,zd(t,new Cd)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Wd(t){return m(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(xr(Ud,"Using default OnlineComponentProvider"),[4,Qd(t,new Rd)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Hd(e){return Gd(e).then(function(e){return e.persistence})}function Yd(e){return Gd(e).then(function(e){return e.localStore})}function Xd(e){return Wd(e).then(function(e){return e.remoteStore})}function Jd(e){return Wd(e).then(function(e){return e.syncEngine})}function $d(r){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return[4,Wd(r)];case 1:return t=e.sent(),(n=t.eventManager).onListen=function(a,s){return m(this,void 0,void 0,function(){var t,n,r,i,o;return g(this,function(e){switch(e.label){case 0:return t=wf(a),(o=t.queryViewsByQuery.get(s))?(n=o.targetId,t.sharedClientState.addLocalQueryTarget(n),r=o.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,Ll(t.localStore,ao(s))];case 2:return i=e.sent(),o=t.sharedClientState.addLocalQueryTarget(i.targetId),n=i.targetId,[4,sf(t,s,n,"current"===o)];case 3:r=e.sent(),t.isPrimaryClient&&ah(t.remoteStore,i),e.label=4;case 4:return[2,r]}})})}.bind(null,t.syncEngine),n.onUnlisten=function(i,o){return m(this,void 0,void 0,function(){var t,n,r;return g(this,function(e){switch(e.label){case 0:return t=Fr(i,of),qr(!!(n=t.queryViewsByQuery.get(o)),"Trying to unlisten on query not found:"+lo(o)),1<(r=t.queriesByTarget.get(n.targetId)).length?(t.queriesByTarget.set(n.targetId,r.filter(function(e){return!uo(e,o)})),t.queryViewsByQuery.delete(o),[2]):t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(n.targetId),t.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,Pl(t.localStore,n.targetId,!1).then(function(){t.sharedClientState.clearQueryState(n.targetId),sh(t.remoteStore,n.targetId),df(t,n.targetId)}).catch(Bl)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return df(t,n.targetId),[4,Pl(t.localStore,n.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}})})}.bind(null,t.syncEngine),[2,n]}})})}function Zd(u,c,l){var e=this;void 0===l&&(l={});var h=new tc;return u.asyncQueue.enqueueAndForget(function(){return m(e,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return[4,$d(u)];case 1:return t=e.sent(),[2,(n=t,r=u.asyncQueue,i=c,o=l,a=h,e=new Pd({next:function(e){r.enqueueAndForget(function(){return Uh(n,s)});var t=e.docs.has(i);!t&&e.fromCache?a.reject(new Dr(Cr.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&o&&"server"===o.source?a.reject(new Dr(Cr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):(qr(e.docs.size<=1,"Expected zero or a single result on a document-only query"),a.resolve(e))},error:function(e){return a.reject(e)}}),s=new jh($i(i.path),e,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0}),Vh(n,s))]}var n,r,i,o,a,s})})}),h.promise}function ep(u,c,l){var e=this;void 0===l&&(l={});var h=new tc;return u.asyncQueue.enqueueAndForget(function(){return m(e,void 0,void 0,function(){var s;return g(this,function(e){switch(e.label){case 0:return[4,$d(u)];case 1:return s=e.sent(),[2,(t=s,n=u.asyncQueue,r=c,i=l,o=h,e=new Pd({next:function(e){n.enqueueAndForget(function(){return Uh(t,a)}),e.fromCache&&"server"===i.source?o.reject(new Dr(Cr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(e)},error:function(e){return o.reject(e)}}),a=new jh(r,e,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0}),Vh(t,a))]}var t,n,r,i,o,a})})}),h.promise}function tp(e,t,n){if(!n)throw new Dr(Cr.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function np(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function rp(e,t,n,r){if(!0===t&&!0===r)throw new Dr(Cr.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function ip(e){if(!li.isDocumentKey(e))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function op(e){if(li.isDocumentKey(e))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function ap(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?(20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e)):"number"==typeof e||"boolean"==typeof e?""+e:"object"!=typeof e?"function"==typeof e?"a function":Pr("Unknown wrong type: "+typeof e):e instanceof Array?"an array":(e=(t=e).constructor&&(t=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString()))&&1<t.length?t[1]:null)?"a custom "+e+" object":"an object";var t}function sp(e,t){if("_delegate"in e&&(e=e._delegate),e instanceof t)return e;if(t.name===e.constructor.name)throw new Dr(Cr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw e=ap(e),new Dr(Cr.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+e)}function up(e,t){if(t<=0)throw new Dr(Cr.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}function cp(i){return function(){if("object"==typeof i&&null!==i)for(var e=i,t=0,n=["next","error","complete"];t<n.length;t++){var r=n[t];if(r in e&&"function"==typeof e[r])return 1}}()}var lp=(Object.defineProperty(hp.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(hp.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),hp.prototype.isEqual=function(e){return this._lat===e._lat&&this._long===e._long},hp.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},hp.prototype._compareTo=function(e){return Ur(this._lat,e._lat)||Ur(this._long,e._long)},hp);function hp(e,t){if(!isFinite(e)||e<-90||90<e)throw new Dr(Cr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new Dr(Cr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}var fp=(dp.fromBase64String=function(e){try{return new dp(Xr.fromBase64String(e))}catch(e){throw new Dr(Cr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},dp.fromUint8Array=function(e){return new dp(Xr.fromUint8Array(e))},dp.prototype.toBase64=function(){return this._byteString.toBase64()},dp.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},dp.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},dp.prototype.isEqual=function(e){return this._byteString.isEqual(e._byteString)},dp);function dp(e){this._byteString=e}var pp=function(e){this._delegate=e};function yp(){if("undefined"==typeof Uint8Array)throw new Dr(Cr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function mp(){if("undefined"==typeof atob)throw new Dr(Cr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var gp,vp=(n(bp,gp=pp),bp.fromBase64String=function(e){return mp(),new bp(fp.fromBase64String(e))},bp.fromUint8Array=function(e){return yp(),new bp(fp.fromUint8Array(e))},bp.prototype.toBase64=function(){return mp(),this._delegate.toBase64()},bp.prototype.toUint8Array=function(){return yp(),this._delegate.toUint8Array()},bp.prototype.isEqual=function(e){return this._delegate.isEqual(e._delegate)},bp.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},bp);function bp(){return null!==gp&&gp.apply(this,arguments)||this}function wp(){}wp.prototype.convertValue=function(e,t){switch(void 0===t&&(t="none"),bi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Di(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_i(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Pr("Invalid value type: "+JSON.stringify(e))}},wp.prototype.convertObject=function(e,n){var r=this,i={};return Hr(e.fields||{},function(e,t){i[e]=r.convertValue(t,n)}),i},wp.prototype.convertGeoPoint=function(e){return new lp(Di(e.latitude),Di(e.longitude))},wp.prototype.convertArray=function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})},wp.prototype.convertServerTimestamp=function(e,t){switch(t){case"previous":var n=function e(t){return mi(t=t.mapValue.fields[pi])?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(gi(e));default:return null}},wp.prototype.convertTimestamp=function(e){return e=Ci(e),new Qr(e.seconds,e.nanos)},wp.prototype.convertDocumentKey=function(e,t){var n=ii.fromString(e);return Mr(is(n),"ReferenceValue is not valid "+e),e=new wr(n.get(1),n.get(3)),n=new li(n.popFirst(5)),e.isEqual(t)||Or("Document "+n+" contains a document reference within a different database ("+e.projectId+"/"+e.database+") which is not supported. It will be treated as a reference in the current database ("+t.projectId+"/"+t.database+") instead."),n};var Tp,Sp=(n(Ip,Tp=gt=wp),Ip.prototype.convertBytes=function(e){return new vp(new fp(e))},Ip.prototype.convertReference=function(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),rg.forKey(e,this.firestore,null)},Ip);function Ip(e){var t=Tp.call(this)||this;return t.firestore=e,t}function Ep(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e}var Cp=(Dp.prototype.getToken=function(){return Promise.resolve(null)},Dp.prototype.invalidateToken=function(){},Dp.prototype.setChangeListener=function(e){qr(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=e)(Sr.UNAUTHENTICATED)},Dp.prototype.removeChangeListener=function(){this.changeListener=null},Dp);function Dp(){this.changeListener=null}var _p=(kp.prototype.getToken=function(){var t=this;qr(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(function(e){return t.tokenCounter!==n?(xr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):e?(Mr("string"==typeof e.accessToken,"Invalid tokenData returned from getToken():"+e),new Ep(e.accessToken,t.currentUser)):null}):Promise.resolve(null)},kp.prototype.invalidateToken=function(){this.forceRefresh=!0},kp.prototype.setChangeListener=function(e){qr(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=e,this.receivedInitialUser&&e(this.currentUser)},kp.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},kp.prototype.getUser=function(){var e=this.auth&&this.auth.getUid();return Mr(null===e||"string"==typeof e,"Received invalid UID: "+e),new Sr(e)},kp);function kp(e){var t=this;this.tokenListener=null,this.currentUser=Sr.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){t.tokenCounter++,t.currentUser=t.getUser(),t.receivedInitialUser=!0,t.changeListener&&t.changeListener(t.currentUser)},this.tokenCounter=0,this.auth=e.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),e.get().then(function(e){t.auth=e,t.tokenListener&&t.auth.addAuthTokenListener(t.tokenListener)},function(){}))}var Ap=(Object.defineProperty(Np.prototype,"authHeaders",{get:function(){var e={"X-Goog-AuthUser":this.sessionIndex},t=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),e},enumerable:!1,configurable:!0}),Np);function Np(e,t){this.gapi=e,this.sessionIndex=t,this.type="FirstParty",this.user=Sr.FIRST_PARTY}var xp=(Op.prototype.getToken=function(){return Promise.resolve(new Ap(this.gapi,this.sessionIndex))},Op.prototype.setChangeListener=function(e){e(Sr.FIRST_PARTY)},Op.prototype.removeChangeListener=function(){},Op.prototype.invalidateToken=function(){},Op);function Op(e,t){this.gapi=e,this.sessionIndex=t}var Rp=new Map,Lp=(Pp.prototype.isEqual=function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties},Pp);function Pp(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Dr(Cr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Dr(Cr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,rp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}var Mp=(Object.defineProperty(qp.prototype,"app",{get:function(){if(!this._app)throw new Dr(Cr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(qp.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(qp.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),qp.prototype._setSettings=function(e){if(this._settingsFrozen)throw new Dr(Cr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Lp(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new Cp;switch(e.type){case"gapi":var t=e.client;return Mr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new xp(t,e.sessionIndex||"0");case"provider":return e.client;default:throw new Dr(Cr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},qp.prototype._getSettings=function(){return this._settings},qp.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},qp.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},qp.prototype._terminate=function(){var e;return(e=Rp.get(this))&&(xr("ComponentProvider","Removing Datastore"),Rp.delete(this),e.terminate()),Promise.resolve()},qp);function qp(e,t){this._persistenceKey="(lite)",this._settings=new Lp({}),this._settingsFrozen=!1,e instanceof wr?(this._databaseId=e,this._credentials=new Cp):(this._app=e,this._databaseId=function(e){if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new wr(e.options.projectId);throw new Dr(Cr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')}(e),this._credentials=new _p(t))}var Fp,Bp=(n(Vp,Fp=Mp),Vp.prototype._terminate=function(){return this._firestoreClient||Ym(this),this._firestoreClient.terminate()},Vp);function Vp(e,t){return(t=Fp.call(this,e,t)||this)._queue=new kh,t._persistenceKey="name"in e?e.name:"[DEFAULT]",t}function Up(n,r,i){var e=this,o=new tc;return n.asyncQueue.enqueue(function(){return m(e,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,zd(n,i)];case 1:return e.sent(),[4,Qd(n,r)];case 2:return e.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(e=t=e.sent()).name?e.code===Cr.FAILED_PRECONDITION||e.code===Cr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),o.reject(t),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function Kp(e){return function(t){var e=this,n=new tc;return t.asyncQueue.enqueueAndForget(function(){return m(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,Jd(t)];case 1:return[2,function(a,s){return m(this,void 0,void 0,function(){var r,i,o;return g(this,function(e){switch(e.label){case 0:fh((r=Fr(a,of)).remoteStore)||xr(tf,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(t=r.localStore,(n=Fr(t,_l)).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(e){return n.mutationQueue.getHighestUnacknowledgedBatchId(e)}))];case 2:return(i=e.sent())===Zs?(s.resolve(),[2]):((o=r.pendingWritesCallbacks.get(i)||[]).push(s),r.pendingWritesCallbacks.set(i,o),[3,4]);case 3:return o=Nh(o=e.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(o),[3,4];case 4:return[2]}var t,n})})}(e.sent(),n)]}})})}),n.promise}(Hm(e=sp(e,Bp)))}function jp(e){if(e._initialized||e._terminated)throw new Dr(Cr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var zp,Qp=function(e){this._methodName=e},Gp=(n(Wp,zp=Qp),Wp.prototype._toFieldTransform=function(e){if(2!==e.dataSource)throw 1===e.dataSource?(qr(0<e.path.length,this._methodName+"() at the top level should have already been handled."),e.createError(this._methodName+"() can only appear at the top level of your update data")):e.createError(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null},Wp.prototype.isEqual=function(e){return e instanceof Wp},Wp);function Wp(){return null!==zp&&zp.apply(this,arguments)||this}function Hp(e,t,n){return new yy({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Yp,Xp=(n(Jp,Yp=Qp),Jp.prototype._toFieldTransform=function(e){return new Es(e.path,new ss)},Jp.prototype.isEqual=function(e){return e instanceof Jp},Jp);function Jp(){return null!==Yp&&Yp.apply(this,arguments)||this}var $p,Zp=(n(ey,$p=Qp),ey.prototype._toFieldTransform=function(e){var t=Hp(this,e,!0),n=this._elements.map(function(e){return Iy(e,t)}),n=new ls(n);return new Es(e.path,n)},ey.prototype.isEqual=function(e){return this===e},ey);function ey(e,t){return(e=$p.call(this,e)||this)._elements=t,e}var ty,ny=(n(ry,ty=Qp),ry.prototype._toFieldTransform=function(e){var t=Hp(this,e,!0),n=this._elements.map(function(e){return Iy(e,t)}),n=new ps(n);return new Es(e.path,n)},ry.prototype.isEqual=function(e){return this===e},ry);function ry(e,t){return(e=ty.call(this,e)||this)._elements=t,e}var iy,oy=(n(ay,iy=Qp),ay.prototype._toFieldTransform=function(e){var t=new vs(e.serializer,Ma(e.serializer,this._operand));return new Es(e.path,t)},ay.prototype.isEqual=function(e){return this===e},ay);function ay(e,t){return(e=iy.call(this,e)||this)._operand=t,e}var sy=(uy.prototype.isEqual=function(e){return this._internalPath.isEqual(e._internalPath)},uy);function uy(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0;n<e.length;++n)if(0===e[n].length)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ui(e)}var cy=/^__.*__$/,ly=(hy.prototype.toMutations=function(e,t){var n=[];return null!==this.fieldMask?n.push(new Bs(e,this.data,this.fieldMask,t)):n.push(new Ms(e,this.data,t)),0<this.fieldTransforms.length&&n.push(new js(e,this.fieldTransforms)),n},hy);function hy(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}var fy=(dy.prototype.toMutations=function(e,t){return t=[new Bs(e,this.data,this.fieldMask,t)],0<this.fieldTransforms.length&&t.push(new js(e,this.fieldTransforms)),t},dy);function dy(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}function py(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Pr("Unexpected case for UserDataSource: "+e)}}var yy=(Object.defineProperty(my.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(my.prototype,"dataSource",{get:function(){return this.settings.dataSource},enumerable:!1,configurable:!0}),my.prototype.contextWith=function(e){return new my(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},my.prototype.childContextForField=function(e){var t=null===(t=this.path)||void 0===t?void 0:t.child(e);return(t=this.contextWith({path:t,arrayElement:!1})).validatePathSegment(e),t},my.prototype.childContextForFieldPath=function(e){var t,e=null===(t=this.path)||void 0===t?void 0:t.child(e);return(e=this.contextWith({path:e,arrayElement:!1})).validatePath(),e},my.prototype.childContextForArray=function(e){return this.contextWith({path:void 0,arrayElement:!0})},my.prototype.createError=function(e){return Ny(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)},my.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},my.prototype.validatePath=function(){if(this.path)for(var e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))},my.prototype.validatePathSegment=function(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(py(this.dataSource)&&cy.test(e))throw this.createError('Document fields cannot begin and end with "__"')},my);function my(e,t,n,r,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=o||[]}var gy=(vy.prototype.createContext=function(e,t,n,r){return void 0===r&&(r=!1),new yy({dataSource:e,methodName:t,targetDoc:n,path:ui.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)},vy);function vy(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ed(e)}function by(e,t,n,r,i,o){void 0===o&&(o={});var a=e.createContext(o.merge||o.mergeFields?2:0,t,n,i);Dy("Data must be an object, but it was:",a,r);var s,u,r=Ey(r,a);if(o.merge)s=new Ss(a.fieldMask),u=a.fieldTransforms;else if(o.mergeFields){for(var c=[],l=0,h=o.mergeFields;l<h.length;l++){var f=_y(t,h[l],n);if(!a.contains(f))throw new Dr(Cr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");xy(c,f)||c.push(f)}s=new Ss(c),u=a.fieldTransforms.filter(function(e){return s.covers(e.field)})}else s=null,u=a.fieldTransforms;return new ly(new ca(r),s,u)}function wy(e,r,i,t){var o=e.createContext(1,r,i);Dy("Data must be an object, but it was:",o,t);var a=[],s=new ha;return Hr(t,function(e,t){var n=Ay(r,e,i);t instanceof pp&&(t=t._delegate),e=o.childContextForFieldPath(n),t instanceof Gp?a.push(n):null!=(e=Iy(t,e))&&(a.push(n),s.set(n,e))}),t=new Ss(a),new fy(s.build(),t,o.fieldTransforms)}function Ty(e,t,n,r,i,o){var a=e.createContext(1,t,n),s=[_y(t,r,n)],u=[i];if(o.length%2!=0)throw new Dr(Cr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)s.push(_y(t,o[c])),u.push(o[c+1]);for(var l,h,f,d=[],p=new ha,c=s.length-1;0<=c;--c)xy(d,s[c])||(l=s[c],(h=u[c])instanceof pp&&(h=h._delegate),f=a.childContextForFieldPath(l),h instanceof Gp?d.push(l):null!=(f=Iy(h,f))&&(d.push(l),p.set(l,f)));return i=new Ss(d),new fy(p.build(),i,a.fieldTransforms)}function Sy(e,t,n,r){return void 0===r&&(r=!1),qr(null!=(n=Iy(n,t=e.createContext(r?4:3,t))),"Parsed data should not be null."),qr(0===t.fieldTransforms.length,"Field transforms should have been disallowed."),n}function Iy(a,e){if(a instanceof pp&&(a=a._delegate),Cy(a))return Dy("Unsupported field value:",e,a),Ey(a,e);if(a instanceof Qp)return function(e,t){if(!py(t.dataSource))throw t.createError(e._methodName+"() can only be used with update() and set()");if(!t.path)throw t.createError(e._methodName+"() is not currently supported inside arrays");(e=e._toFieldTransform(t))&&t.fieldTransforms.push(e)}(a,e),null;if(e.path&&e.fieldMask.push(e.path),a instanceof Array){if(e.settings.arrayElement&&4!==e.dataSource)throw e.createError("Nested arrays are not supported");return function(e){for(var t=[],n=0,r=0,i=a;r<i.length;r++){var o=Iy(i[r],e.childContextForArray(n));null==o&&(o={nullValue:"NULL_VALUE"}),t.push(o),n++}return{arrayValue:{values:t}}}(e)}return function(e,t){if(e instanceof pp&&(e=e._delegate),null===e)return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Ma(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=Qr.fromDate(e);return{timestampValue:qa(t.serializer,n)}}if(e instanceof Qr)return n=new Qr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)),{timestampValue:qa(t.serializer,n)};if(e instanceof lp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof fp)return{bytesValue:Fa(t.serializer,e._byteString)};if(e instanceof By){var r=t.databaseId;if(!(n=e.firestore._databaseId).isEqual(r))throw t.createError("Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+r.projectId+"/"+r.database);return{referenceValue:Va(e.firestore._databaseId||t.databaseId,e._key.path)}}if(void 0===e&&t.ignoreUndefinedProperties)return null;throw t.createError("Unsupported field value: "+ap(e))}(a,e)}function Ey(e,n){var r={};return Yr(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Hr(e,function(e,t){null!=(t=Iy(t,n.childContextForField(e)))&&(r[e]=t)}),{mapValue:{fields:r}}}function Cy(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Qr||e instanceof lp||e instanceof fp||e instanceof By||e instanceof Qp)}function Dy(e,t,n){if(!Cy(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=ap(n))?t.createError(e+" a custom object"):t.createError(e+" "+n);var r}function _y(e,t,n){if(t instanceof pp&&(t=t._delegate),t instanceof sy)return t._internalPath;if("string"==typeof t)return Ay(e,t);throw Ny("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var ky=new RegExp("[~\\*/\\[\\]]");function Ay(t,n,r){if(0<=n.search(ky))throw Ny("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,r);try{return(new(sy.bind.apply(sy,a([void 0],n.split(".")))))._internalPath}catch(e){throw Ny("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,r)}}function Ny(e,t,n,r,i){var o=r&&!r.isEmpty(),a=void 0!==i,t="Function "+t+"() called with invalid data";return n&&(t+=" (via `toFirestore()`)"),t+=". ",n="",(o||a)&&(n+=" (found",o&&(n+=" in field "+r),a&&(n+=" in document "+i),n+=")"),new Dr(Cr.INVALID_ARGUMENT,t+e+n)}function xy(e,t){return e.some(function(e){return e.isEqual(t)})}var Oy,Ry=(n(Ly,Oy=gt),Ly.prototype.convertBytes=function(e){return new fp(e)},Ly.prototype.convertReference=function(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),new By(this.firestore,null,e)},Ly);function Ly(e){var t=Oy.call(this)||this;return t.firestore=e,t}function Py(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=sp(e,By);var o=sp(e.firestore,Bp),a=wm(o);return t instanceof pp&&(t=t._delegate),qy(o,("string"==typeof t||t instanceof sy?Ty(a,"updateDoc",e._key,t,n,r):wy(a,"updateDoc",e._key,t)).toMutations(e._key,_s.exists(!0)))}function My(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];t instanceof pp&&(t=t._delegate);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||cp(n[i])||(r=n[i],i++);var o,a,s,u,c,l,h={includeMetadataChanges:r.includeMetadataChanges};return cp(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),t instanceof By?(s=sp(t.firestore,Bp),u=$i(t._key.path),l={next:function(e){n[i]&&n[i](Fy(s,t,e))},error:n[i+1],complete:n[i+2]}):(a=sp(t,Uy),s=sp(a.firestore,Bp),u=a._query,c=new Ry(s),l={next:function(e){n[i]&&n[i](new Rm(s,c,a,e))},error:n[i+1],complete:n[i+2]},cm(t._query)),function(t,e,n){var r=this,i=new Pd(l),o=new jh(e,i,n);return t.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,$d(t)];case 1:return[2,Vh(e.sent(),o)]}})})}),function(){i.mute(),t.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,$d(t)];case 1:return[2,Uh(e.sent(),o)]}})})})}}(Hm(s),u,h)}function qy(e,t){return function(t,n){var e=this,r=new tc;return t.asyncQueue.enqueueAndForget(function(){return m(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,Jd(t)];case 1:return[2,uf(e.sent(),n,r)]}})})}),r.promise}(Hm(e),t)}function Fy(e,t,n){qr(n.docs.size<=1,"Expected zero or a single result on a document-only query");var r=n.docs.get(t._key),i=new Ry(e);return new km(e,i,t._key,r,new ug(n.hasPendingWrites,n.fromCache),t._converter)}var By=(Object.defineProperty(Vy.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(Vy.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Vy.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Vy.prototype,"parent",{get:function(){return new hm(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),Vy.prototype.withConverter=function(e){return new Vy(this.firestore,e,this._key)},Vy);function Vy(e,t,n){this._converter=t,this._key=n,this.type="document",this.firestore=e}var Uy=(Ky.prototype.withConverter=function(e){return new Ky(this.firestore,e,this._query)},Ky);function Ky(e,t,n){this._converter=t,this._query=n,this.type="query",this.firestore=e}function jy(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++)e=i[r]._apply(e);return e}var zy,Qy=(n(Gy,zy=vt=function(){}),Gy.prototype._apply=function(e){var t=wm(e.firestore),t=function(e,t,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){sm(o,i);for(var a=[],s=0,u=o;s<u.length;s++){var c=u[s];a.push(am(n,e,c))}l={arrayValue:{values:a}}}else l=am(n,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||sm(o,i),l=Sy(t,"where",o,"in"===i||"not-in"===i);var l=yo.create(r,i,l);return function(e,t){if(qr(t instanceof yo,"Only FieldFilters are supported"),t.isInequality()){var n=no(e);if(null!==n&&!n.isEqual(t.field))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+t.field.toString()+"'");null!==(n=to(e))&&um(0,t.field,n)}if(null!==(e=function(e,t){for(var n=0,r=e.filters;n<r.length;n++){var i=r[n];if(qr(i instanceof yo,"Only FieldFilters are supported"),0<=t.indexOf(i.op))return i.op}return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw e===t.op?new Dr(Cr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Dr(Cr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+e.toString()+"' filters.")}(e,l),l}(e._query,t,e.firestore._databaseId,this._field,this._op,this._value);return new Uy(e.firestore,e._converter,(qr(null==no(e=e._query)||!(t instanceof yo)||!t.isInequality()||t.field.isEqual(no(e)),"Query must only have one inequality field."),qr(!ro(e),"No filtering allowed for document query"),t=e.filters.concat([t]),new Xi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))},Gy);function Gy(e,t,n){var r=zy.call(this)||this;return r._field=e,r._op=t,r._value=n,r.type="where",r}var Wy,Hy=(n(Yy,Wy=vt),Yy.prototype._apply=function(e){var t=function(e,t,n){if(null!==e.startAt)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return n=new jo(t,n),t=n,null!==to(e)||null!==(e=no(e))&&um(0,e,t.field),n}(e._query,this._field,this._direction);return new Uy(e.firestore,e._converter,(qr(!(e=e._query).startAt&&!e.endAt,"Bounds must be set after orderBy"),t=e.explicitOrderBy.concat([t]),new Xi(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},Yy);function Yy(e,t){var n=Wy.call(this)||this;return n._field=e,n._direction=t,n.type="orderBy",n}var Xy,Jy=(n($y,Xy=vt),$y.prototype._apply=function(e){return new Uy(e.firestore,e._converter,so(e._query,this._limit,this._limitType))},$y);function $y(e,t,n){var r=Xy.call(this)||this;return r.type=e,r._limit=t,r._limitType=n,r}var Zy,em=(n(tm,Zy=vt),tm.prototype._apply=function(e){var t=om(e,this.type,this._docOrFields,this._before);return new Uy(e.firestore,e._converter,(e=e._query,new Xi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))},tm);function tm(e,t,n){var r=Zy.call(this)||this;return r.type=e,r._docOrFields=t,r._before=n,r}var nm,rm=(n(im,nm=vt),im.prototype._apply=function(e){var t=om(e,this.type,this._docOrFields,this._before);return new Uy(e.firestore,e._converter,(e=e._query,new Xi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))},im);function im(e,t,n){var r=nm.call(this)||this;return r.type=e,r._docOrFields=t,r._before=n,r}function om(e,c,t,n){if(t[0]instanceof pp&&(t[0]=t[0]._delegate),t[0]instanceof Tm)return function(e,t,n,r){if(!n)throw new Dr(Cr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,a=oo(e);o<a.length;o++){var s=a[o];if(s.field.isKeyField())i.push(ki(t,n.key));else{var u=n.field(s.field);if(mi(u))throw new Dr(Cr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u)throw s=s.field.canonicalString(),new Dr(Cr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+s+"' (used as the orderBy) does not exist.");i.push(u)}}return new Bo(i,r)}(e._query,e.firestore._databaseId,t[0]._document,n);var r=wm(e.firestore);return function(e,t,n,r,i,o){var a=e.explicitOrderBy;if(i.length>a.length)throw new Dr(Cr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],u=0;u<i.length;u++){var c=i[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!io(e)&&-1!==c.indexOf("/"))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var l=e.path.child(ii.fromString(c));if(!li.isDocumentKey(l))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+l+"' is not because it contains an odd number of segments.");l=new li(l),s.push(ki(t,l))}else c=Sy(n,r,c),s.push(c)}return new Bo(s,o)}(e._query,e.firestore._databaseId,r,c,t,n)}function am(e,t,n){if(n instanceof pp&&(n=n._delegate),"string"==typeof n){if(""===n)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!io(t)&&-1!==n.indexOf("/"))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(t=t.path.child(ii.fromString(n)),!li.isDocumentKey(t))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+t+"' is not because it has an odd number of segments ("+t.length+").");return ki(e,new li(t))}if(n instanceof By)return ki(e,n._key);throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ap(n)+".")}function sm(e,t){if(!Array.isArray(e)||0===e.length)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(10<e.length)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function um(e,t,n){if(!n.isEqual(t))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function cm(e){if(eo(e)&&0===e.explicitOrderBy.length)throw new Dr(Cr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var lm,hm=(n(fm,lm=Uy),Object.defineProperty(fm.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(fm.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(fm.prototype,"parent",{get:function(){var e=this._path.popLast();return e.isEmpty()?null:new By(this.firestore,null,new li(e))},enumerable:!1,configurable:!0}),fm.prototype.withConverter=function(e){return new fm(this.firestore,e,this._path)},fm);function fm(e,t,n){return(t=lm.call(this,e,t,$i(n))||this).firestore=e,t._path=n,t.type="collection",t}function dm(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e instanceof pp&&(e=e._delegate),tp("collection","path",t),e instanceof Mp)return op(n=ii.fromString.apply(ii,a([t],r))),new hm(e,null,n);if(!(e instanceof By||e instanceof hm))throw new Dr(Cr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return op(n=ii.fromString.apply(ii,a([e.path],r)).child(ii.fromString(t))),new hm(e.firestore,null,n)}function pm(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e instanceof pp&&(e=e._delegate),1===arguments.length&&(t=Br.newId()),tp("doc","path",t),e instanceof Mp)return ip(n=ii.fromString.apply(ii,a([t],r))),new By(e,null,new li(n));if(!(e instanceof By||e instanceof hm))throw new Dr(Cr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ip(n=e._path.child(ii.fromString.apply(ii,a([t],r)))),new By(e.firestore,e instanceof hm?e._converter:null,new li(n))}var ym,mm=(n(gm,ym=gt),gm.prototype.convertBytes=function(e){return new fp(e)},gm.prototype.convertReference=function(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),new By(this.firestore,null,e)},gm);function gm(e){var t=ym.call(this)||this;return t.firestore=e,t}function vm(e,t){return e instanceof pp&&(e=e._delegate),t instanceof pp&&(t=t._delegate),(e instanceof By||e instanceof hm)&&(t instanceof By||t instanceof hm)&&e.firestore===t.firestore&&e.path===t.path&&e._converter===t._converter}function bm(e,t){return e instanceof pp&&(e=e._delegate),t instanceof pp&&(t=t._delegate),e instanceof Uy&&t instanceof Uy&&e.firestore===t.firestore&&uo(e._query,t._query)&&e._converter===t._converter}function wm(e){var t=e._freezeSettings(),n=Ed(e._databaseId);return new gy(e._databaseId,!!t.ignoreUndefinedProperties,n)}var Tm=(Object.defineProperty(Sm.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Sm.prototype,"ref",{get:function(){return new By(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Sm.prototype.exists=function(){return null!==this._document},Sm.prototype.data=function(){if(this._document){if(this._converter){var e=new Em(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.toProto())}},Sm.prototype.get=function(e){if(this._document&&null!==(e=this._document.data().field(Dm("DocumentSnapshot.get",e))))return this._userDataWriter.convertValue(e)},Sm);function Sm(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}var Im,Em=(n(Cm,Im=Tm),Cm.prototype.data=function(){return Im.prototype.data.call(this)},Cm);function Cm(){return null!==Im&&Im.apply(this,arguments)||this}function Dm(e,t){return"string"==typeof t?Ay(e,t):(t instanceof pp?t._delegate:t)._internalPath}var _m,km=(n(Am,_m=Tm),Am.prototype.exists=function(){return _m.prototype.exists.call(this)},Am.prototype.data=function(e){if(void 0===e&&(e={}),this._document){if(this._converter){var t=new xm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.toProto(),e.serverTimestamps)}},Am.prototype.get=function(e,t){if(void 0===t&&(t={}),this._document&&null!==(e=this._document.data().field(Dm("DocumentSnapshot.get",e))))return this._userDataWriter.convertValue(e,t.serverTimestamps)},Am);function Am(e,t,n,r,i,o){return(o=_m.call(this,e,t,n,r,o)||this)._firestore=e,o._firestoreImpl=e,o.metadata=i,o}var Nm,xm=(n(Om,Nm=km),Om.prototype.data=function(e){return void 0===e&&(e={}),Nm.prototype.data.call(this,e)},Om);function Om(){return null!==Nm&&Nm.apply(this,arguments)||this}var Rm=(Object.defineProperty(Lm.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(Lm.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Lm.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Lm.prototype.forEach=function(t,n){var r=this;this._snapshot.docs.forEach(function(e){t.call(n,new xm(r._firestore,r._userDataWriter,e.key,e,new ug(r._snapshot.mutatedKeys.has(e.key),r._snapshot.fromCache),r.query._converter))})},Lm.prototype.docChanges=function(e){if(void 0===e&&(e={}),(e=!!e.includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new Dr(Cr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){var n,r=0;return i._snapshot.docChanges.map(function(e){qr(0===e.type,"Invalid event type for first snapshot"),qr(!n||fo(i._snapshot.query)(n,e.doc)<0,"Got added events in wrong order");var t=new xm(i._firestore,i._userDataWriter,e.doc.key,e.doc,new ug(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query._converter);return n=e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:r++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(e){var t=new xm(i._firestore,i._userDataWriter,e.doc.key,e.doc,new ug(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query._converter),n=-1,r=-1;return 0!==e.type&&(qr(0<=(n=o.indexOf(e.doc.key)),"Index for document not found"),o=o.delete(e.doc.key)),1!==e.type&&(r=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Pr("Unknown change type: "+e)}}(e.type),doc:t,oldIndex:n,newIndex:r}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},Lm);function Lm(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ug(r.hasPendingWrites,r.fromCache),this.query=n}function Pm(e,t){return e instanceof km&&t instanceof km?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Rm&&t instanceof Rm&&e._firestore===t._firestore&&bm(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}var Mm=(qm.prototype.set=function(e,t,n){return this._verifyNotCommitted(),t=Ag((e=Fm(e,this._firestore))._converter,t,n),n=by(this._dataReader,"WriteBatch.set",e._key,t,null!==e._converter,n),this._mutations=this._mutations.concat(n.toMutations(e._key,_s.none())),this},qm.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this._verifyNotCommitted(),e=Fm(e,this._firestore),t instanceof pp&&(t=t._delegate),t="string"==typeof t||t instanceof sy?Ty(this._dataReader,"WriteBatch.update",e._key,t,n,r):wy(this._dataReader,"WriteBatch.update",e._key,t),this._mutations=this._mutations.concat(t.toMutations(e._key,_s.exists(!0))),this},qm.prototype.delete=function(e){return this._verifyNotCommitted(),e=Fm(e,this._firestore),this._mutations=this._mutations.concat(new Hs(e._key,_s.none())),this},qm.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},qm.prototype._verifyNotCommitted=function(){if(this._committed)throw new Dr(Cr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},qm);function qm(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=wm(e)}function Fm(e,t){if(e instanceof pp&&(e=e._delegate),e.firestore!==t)throw new Dr(Cr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Bm(e,t){this._firestore=e,this._transaction=t,this._dataReader=wm(e)}Bm.prototype.get=function(e){var t=this,n=Fm(e,this._firestore),r=new mm(this._firestore);return this._transaction.lookup([n._key]).then(function(e){if(!e||1!==e.length)return Pr("Mismatch in docs returned from document lookup.");if((e=e[0])instanceof Vi)return new Tm(t._firestore,r,n._key,null,n._converter);if(e instanceof qi)return new Tm(t._firestore,r,e.key,e,n._converter);throw Pr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},Bm.prototype.set=function(e,t,n){return t=Ag((e=Fm(e,this._firestore))._converter,t,n),n=by(this._dataReader,"Transaction.set",e._key,t,null!==e._converter,n),this._transaction.set(e._key,n),this},Bm.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return e=Fm(e,this._firestore),t instanceof pp&&(t=t._delegate),t="string"==typeof t||t instanceof sy?Ty(this._dataReader,"Transaction.update",e._key,t,n,r):wy(this._dataReader,"Transaction.update",e._key,t),this._transaction.update(e._key,t),this},Bm.prototype.delete=function(e){return e=Fm(e,this._firestore),this._transaction.delete(e._key),this};var Vm,Um=(n(Km,Vm=vt=Bm),Km.prototype.get=function(e){var t=this,n=Fm(e,this._firestore),r=new Ry(this._firestore);return Vm.prototype.get.call(this,e).then(function(e){return new km(t._firestore,r,n._key,e._document,new ug(!1,!1),n._converter)})},Km);function Km(e,t){return(t=Vm.call(this,e,t)||this)._firestore=e,t}var jm=(zm.prototype.enableIndexedDbPersistence=function(e,t){return function(e,t){jp(e=sp(e,Bp));var n=Hm(e),r=e._freezeSettings();return Up(n,e=new Rd,new kd(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})},zm.prototype.enableMultiTabIndexedDbPersistence=function(e){return function(e){jp(e=sp(e,Bp));var t=Hm(e),n=e._freezeSettings();return Up(t,e=new Rd,new xd(e,n.cacheSizeBytes))}(e._delegate)},zm.prototype.clearIndexedDbPersistence=function(e){return function(n){var e=this;if(n._initialized&&!n._terminated)throw new Dr(Cr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new tc;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return m(e,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,function(n){return m(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return rc.isAvailable()?(t=n+pl,[4,rc.delete(t)]):[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(El(n._databaseId,n._persistenceKey))];case 1:return e.sent(),r.resolve(),[3,3];case 2:return t=e.sent(),r.reject(t),[3,3];case 3:return[2]}})})}),r.promise}(e._delegate)},zm);function zm(){}var Qm,Gm=(n(Wm,Qm=pp),Object.defineProperty(Wm.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),Wm.prototype.settings=function(e){e.merge&&delete(e=Object.assign(Object.assign({},this._delegate._getSettings()),e)).merge,this._delegate._setSettings(e)},Wm.prototype.useEmulator=function(e,t){"firestore.googleapis.com"!==this._delegate._getSettings().host&&Rr("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:e+":"+t,ssl:!1,merge:!0})},Wm.prototype.enableNetwork=function(){return function(r){var e=this;return r.asyncQueue.enqueue(function(){return m(e,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return[4,Hd(r)];case 1:return t=e.sent(),[4,Xd(r)];case 2:return n=e.sent(),t.setNetworkEnabled(!0),[2,((e=Fr(e=n,rh)).offlineCauses.delete(0),ih(e))]}})})})}(Hm(sp(this._delegate,Bp)))},Wm.prototype.disableNetwork=function(){return function(r){var e=this;return r.asyncQueue.enqueue(function(){return m(e,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return[4,Hd(r)];case 1:return t=e.sent(),[4,Xd(r)];case 2:return n=e.sent(),t.setNetworkEnabled(!1),[2,function(n){return m(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return(t=Fr(n,rh)).offlineCauses.add(0),[4,oh(t)];case 1:return e.sent(),t.onlineStateTracker.set("Offline"),[2]}})})}(n)]}})})})}(Hm(sp(this._delegate,Bp)))},Wm.prototype.enablePersistence=function(e){var t=!1,n=!1;return e&&rp("synchronizeTabs",t=!!e.synchronizeTabs,"experimentalForceOwningTab",n=!!e.experimentalForceOwningTab),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)},Wm.prototype.clearPersistence=function(){return this._persistenceProvider.clearIndexedDbPersistence(this)},Wm.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._delegate._delete()},Wm.prototype.waitForPendingWrites=function(){return Kp(this._delegate)},Wm.prototype.onSnapshotsInSync=function(e){return function(n,e){var t=this,r=new Pd(e);return n.asyncQueue.enqueueAndForget(function(){return m(t,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return[4,$d(n)];case 1:return t=e.sent(),[2,(e=r,Fr(t,Bh).snapshotsInSyncListeners.add(e),void e.next())]}})})}),function(){r.mute(),n.asyncQueue.enqueueAndForget(function(){return m(t,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return[4,$d(n)];case 1:return t=e.sent(),[2,(e=r,void Fr(t,Bh).snapshotsInSyncListeners.delete(e))]}})})})}}(Hm(sp(this._delegate,Bp)),cp(e)?e:{next:e})},Object.defineProperty(Wm.prototype,"app",{get:function(){if(!this._appCompat)throw new Dr(Cr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat},enumerable:!1,configurable:!0}),Wm.prototype.collection=function(e){try{return new Dg(this,dm(this._delegate,e))}catch(e){throw og(e,"collection()","Firestore.collection()")}},Wm.prototype.doc=function(e){try{return new rg(this,pm(this._delegate,e))}catch(e){throw og(e,"doc()","Firestore.doc()")}},Wm.prototype.collectionGroup=function(e){try{return new gg(this,function(e,t){if(e=sp(e,Mp),tp("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new Dr(Cr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Uy(e,null,new Xi(ii.emptyPath(),t))}(this._delegate,e))}catch(e){throw og(e,"collectionGroup()","Firestore.collectionGroup()")}},Wm.prototype.runTransaction=function(t){var n=this,r=this._delegate,i=function(e){return t(new Jm(n,e))};return function(n,r){var e=this,i=new tc;return n.asyncQueue.enqueueAndForget(function(){return m(e,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return[4,Wd(n).then(function(e){return e.datastore})];case 1:return t=e.sent(),new Bd(n.asyncQueue,t,r,i).run(),[2]}})})}),i.promise}(Hm(r),function(e){return i(new Um(r,e))})},Wm.prototype.batch=function(){var t=this;return Hm(this._delegate),new eg(new Mm(this._delegate,function(e){return qy(t._delegate,e)}))},Wm);function Wm(e,t,n){var r=Qm.call(this,t)||this;return r._persistenceProvider=n,r.INTERNAL={delete:function(){return r.terminate()}},e instanceof wr||(r._appCompat=e),r}function Hm(e){return e._firestoreClient||Ym(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Ym(e){qr(!!(r=e._freezeSettings()).host,"FirestoreSettings.host is not set"),qr(!e._firestoreClient,"configureFirestore() called multiple times");var t,n,r=(t=e._databaseId,n=e._persistenceKey,new vr(t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));e._firestoreClient=new Kd(e._credentials,e._queue,r)}var Xm,Jm=(n($m,Xm=pp),$m.prototype.get=function(e){var t=this,e=kg(e);return this._delegate.get(e).then(function(e){return new hg(t._firestore,e)})},$m.prototype.set=function(e,t,n){return e=kg(e),n?(np("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this},$m.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=kg(e);return 2===arguments.length?this._delegate.update(o,t):(e=this._delegate).update.apply(e,a([o,t,n],r)),this},$m.prototype.delete=function(e){return e=kg(e),this._delegate.delete(e),this},$m);function $m(e,t){return(t=Xm.call(this,t)||this)._firestore=e,t}var Zm,eg=(n(tg,Zm=pp),tg.prototype.set=function(e,t,n){return e=kg(e),n?(np("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this},tg.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=kg(e);return 2===arguments.length?this._delegate.update(o,t):(e=this._delegate).update.apply(e,a([o,t,n],r)),this},tg.prototype.delete=function(e){return e=kg(e),this._delegate.delete(e),this},tg.prototype.commit=function(){return this._delegate.commit()},tg);function tg(){return null!==Zm&&Zm.apply(this,arguments)||this}var ng,rg=(n(ig,ng=pp),ig.forPath=function(e,t,n){if(e.length%2!=0)throw new Dr(Cr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new ig(t,new By(t._delegate,n,new li(e)))},ig.forKey=function(e,t,n){return new ig(t,new By(t._delegate,n,e))},Object.defineProperty(ig.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(ig.prototype,"parent",{get:function(){return new Dg(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(ig.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),ig.prototype.collection=function(e){try{return new Dg(this.firestore,dm(this._delegate,e))}catch(e){throw og(e,"collection()","DocumentReference.collection()")}},ig.prototype.isEqual=function(e){return e instanceof pp&&(e=e._delegate),e instanceof By&&vm(this._delegate,e)},ig.prototype.set=function(e,t){t=np("DocumentReference.set",t);try{return function(e,t,n){e=sp(e,By);var r=sp(e.firestore,Bp),t=Ag(e._converter,t,n);return qy(r,by(wm(r),"setDoc",e._key,t,null!==e._converter,n).toMutations(e._key,_s.none()))}(this._delegate,e,t)}catch(e){throw og(e,"setDoc()","DocumentReference.set()")}},ig.prototype.update=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Py(this._delegate,e):Py.apply(void 0,a([this._delegate,e,t],n))}catch(e){throw og(e,"updateDoc()","DocumentReference.update()")}},ig.prototype.delete=function(){return qy(sp((e=this._delegate).firestore,Bp),[new Hs(e._key,_s.none())]);var e},ig.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ag(e),i=sg(e,function(e){return new hg(t.firestore,new km(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))});return My(this._delegate,r,i)},ig.prototype.get=function(e){var t=this;return(e=("cache"===(null==e?void 0:e.source)?function(t){t=sp(t,By);var n=sp(t.firestore,Bp),e=Hm(n),r=new Ry(n);return function(t,n){var e=this,r=new tc;return t.asyncQueue.enqueueAndForget(function(){return m(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,Yd(t)];case 1:return[2,function(i,o,a){return m(this,void 0,void 0,function(){var r;return g(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(t=o,(n=Fr(i,_l)).persistence.runTransaction("read document","readonly",function(e){return n.localDocuments.getDocument(e,t)}))];case 1:return(r=e.sent())instanceof qi?a.resolve(r):r instanceof Vi?a.resolve(null):a.reject(new Dr(Cr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=Nh(r=e.sent(),"Failed to get document '"+o+" from cache"),a.reject(r),[3,3];case 3:return[2]}var t,n})})}(e.sent(),n,r)]}})})}),r.promise}(e,t._key).then(function(e){return new km(n,r,t._key,e,new ug(e instanceof qi&&e.hasLocalMutations,!0),t._converter)})}:"server"===(null==e?void 0:e.source)?function(t){t=sp(t,By);var n=sp(t.firestore,Bp);return Zd(Hm(n),t._key,{source:"server"}).then(function(e){return Fy(n,t,e)})}:function(t){t=sp(t,By);var n=sp(t.firestore,Bp);return Zd(Hm(n),t._key).then(function(e){return Fy(n,t,e)})})(this._delegate)).then(function(e){return new hg(t.firestore,new km(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))})},ig.prototype.withConverter=function(e){return new ig(this.firestore,this._delegate.withConverter(e))},ig);function ig(e,t){return(t=ng.call(this,t)||this).firestore=e,t._userDataWriter=new Sp(e),t}function og(e,t,n){return e.message=e.message.replace(t,n),e}function ag(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if("object"==typeof r&&!cp(r))return r}return{}}function sg(e,t){var n=cp(e[0])?e[0]:cp(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]};return{next:function(e){n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}var ug=(cg.prototype.isEqual=function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache},cg);function cg(e,t){this.hasPendingWrites=e,this.fromCache=t}var lg,hg=(n(fg,lg=pp),Object.defineProperty(fg.prototype,"ref",{get:function(){return new rg(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(fg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(fg.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(fg.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),fg.prototype.data=function(e){return this._delegate.data(e)},fg.prototype.get=function(e,t){return this._delegate.get(e,t)},fg.prototype.isEqual=function(e){return Pm(this._delegate,e._delegate)},fg);function fg(e,t){return(t=lg.call(this,t)||this)._firestore=e,t}var dg,pg=(n(yg,dg=hg),yg.prototype.data=function(e){return qr(void 0!==(e=this._delegate.data(e)),"Document in a QueryDocumentSnapshot should exist"),e},yg);function yg(){return null!==dg&&dg.apply(this,arguments)||this}var mg,gg=(n(vg,mg=pp),vg.prototype.where=function(e,t,n){try{return new vg(this.firestore,jy(this._delegate,(i=t,o=n,r=Dm("where",e),new Qy(r,i,o))))}catch(e){throw og(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},vg.prototype.orderBy=function(e,t){try{return new vg(this.firestore,jy(this._delegate,(void 0===(r=t)&&(r="asc"),n=Dm("orderBy",e),new Hy(n,r))))}catch(e){throw og(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},vg.prototype.limit=function(e){try{return new vg(this.firestore,jy(this._delegate,(up("limit",t=e),new Jy("limit",t,"F"))))}catch(e){throw og(e,"limit()","Query.limit()")}var t},vg.prototype.limitToLast=function(e){try{return new vg(this.firestore,jy(this._delegate,(up("limitToLast",t=e),new Jy("limitToLast",t,"L"))))}catch(e){throw og(e,"limitToLast()","Query.limitToLast()")}var t},vg.prototype.startAt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new vg(this.firestore,jy(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new em("startAt",e,!0)}.apply(void 0,e)))}catch(e){throw og(e,"startAt()","Query.startAt()")}},vg.prototype.startAfter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new vg(this.firestore,jy(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new em("startAfter",e,!1)}.apply(void 0,e)))}catch(e){throw og(e,"startAfter()","Query.startAfter()")}},vg.prototype.endBefore=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new vg(this.firestore,jy(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new rm("endBefore",e,!0)}.apply(void 0,e)))}catch(e){throw og(e,"endBefore()","Query.endBefore()")}},vg.prototype.endAt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return new vg(this.firestore,jy(this._delegate,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new rm("endAt",e,!1)}.apply(void 0,e)))}catch(e){throw og(e,"endAt()","Query.endAt()")}},vg.prototype.isEqual=function(e){return bm(this._delegate,e._delegate)},vg.prototype.get=function(e){var t=this;return(e=("cache"===(null==e?void 0:e.source)?function(t){t=sp(t,Uy);var n=sp(t.firestore,Bp),e=Hm(n),r=new Ry(n);return function(t,n){var e=this,r=new tc;return t.asyncQueue.enqueueAndForget(function(){return m(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,Yd(t)];case 1:return[2,function(r,i,o){return m(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Ml(r,i,!0)];case 1:return n=e.sent(),t=new Zh(i,n.remoteKeys),n=t.computeDocChanges(n.documents),n=t.applyChanges(n,!1),o.resolve(n.snapshot),[3,3];case 2:return n=Nh(n=e.sent(),"Failed to execute query '"+i+" against cache"),o.reject(n),[3,3];case 3:return[2]}})})}(e.sent(),n,r)]}})})}),r.promise}(e,t._query).then(function(e){return new Rm(n,r,t,e)})}:"server"===(null==e?void 0:e.source)?function(t){t=sp(t,Uy);var n=sp(t.firestore,Bp),e=Hm(n),r=new Ry(n);return ep(e,t._query,{source:"server"}).then(function(e){return new Rm(n,r,t,e)})}:function(t){t=sp(t,Uy);var n=sp(t.firestore,Bp),e=Hm(n),r=new Ry(n);return cm(t._query),ep(e,t._query).then(function(e){return new Rm(n,r,t,e)})})(this._delegate)).then(function(e){return new Ig(t.firestore,new Rm(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))})},vg.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ag(e),i=sg(e,function(e){return new Ig(t.firestore,new Rm(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return My(this._delegate,r,i)},vg.prototype.withConverter=function(e){return new vg(this.firestore,this._delegate.withConverter(e))},vg);function vg(e,t){return(t=mg.call(this,t)||this).firestore=e,t._userDataWriter=new Sp(e),t}var bg,wg=(n(Tg,bg=pp),Object.defineProperty(Tg.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(Tg.prototype,"doc",{get:function(){return new pg(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Tg.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Tg.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),Tg);function Tg(e,t){return(t=bg.call(this,t)||this)._firestore=e,t}var Sg,Ig=(n(Eg,Sg=pp),Object.defineProperty(Eg.prototype,"query",{get:function(){return new gg(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(Eg.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Eg.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(Eg.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(Eg.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new pg(t._firestore,e)})},enumerable:!1,configurable:!0}),Eg.prototype.docChanges=function(e){var t=this;return this._delegate.docChanges(e).map(function(e){return new wg(t._firestore,e)})},Eg.prototype.forEach=function(t,n){var r=this;this._delegate.forEach(function(e){t.call(n,new pg(r._firestore,e))})},Eg.prototype.isEqual=function(e){return Pm(this._delegate,e._delegate)},Eg);function Eg(e,t){return(t=Sg.call(this,t)||this)._firestore=e,t}var Cg,Dg=(n(_g,Cg=gg),Object.defineProperty(_g.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(_g.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(_g.prototype,"parent",{get:function(){var e=this._delegate.parent;return e?new rg(this.firestore,e):null},enumerable:!1,configurable:!0}),_g.prototype.doc=function(e){try{return new rg(this.firestore,void 0===e?pm(this._delegate):pm(this._delegate,e))}catch(e){throw og(e,"doc()","CollectionReference.doc()")}},_g.prototype.add=function(e){var t,n=this,r=this._delegate,i=e;return e=sp(r.firestore,Bp),t=pm(r),i=Ag(r._converter,i),qy(e,by(wm(r.firestore),"addDoc",t._key,i,null!==r._converter,{}).toMutations(t._key,_s.exists(!1))).then(function(){return t}).then(function(e){return new rg(n.firestore,e)})},_g.prototype.isEqual=function(e){return vm(this._delegate,e._delegate)},_g.prototype.withConverter=function(e){return new _g(this.firestore,this._delegate.withConverter(e))},_g);function _g(e,t){var n=Cg.call(this,e,t)||this;return n.firestore=e,n._delegate=t,n}function kg(e){return e instanceof pp&&(e=e._delegate),sp(e,By)}function Ag(e,t,n){return t=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Ng,gt=(n(xg,Ng=pp),xg.documentId=function(){return new xg(ui.keyField().canonicalString())},xg.prototype.isEqual=function(e){return e instanceof pp&&(e=e._delegate),e instanceof sy&&this._delegate._internalPath.isEqual(e._internalPath)},xg);function xg(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ng.call(this,new(sy.bind.apply(sy,a([void 0],e))))||this}var Og,vt=(n(Rg,Og=pp),Rg.serverTimestamp=function(){var e=new Xp("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Rg(e)},Rg.delete=function(){var e=new Gp("deleteField");return e._methodName="FieldValue.delete",new Rg(e)},Rg.arrayUnion=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Zp("arrayUnion",e)}.apply(void 0,e);return n._methodName="FieldValue.arrayUnion",new Rg(n)},Rg.arrayRemove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new ny("arrayRemove",e)}.apply(void 0,e);return n._methodName="FieldValue.arrayRemove",new Rg(n)},Rg.increment=function(e){return(e=new oy("increment",e))._methodName="FieldValue.increment",new Rg(e)},Rg.prototype.isEqual=function(e){return this._delegate.isEqual(e._delegate)},Rg);function Rg(){return null!==Og&&Og.apply(this,arguments)||this}var vt={Firestore:Gm,GeoPoint:lp,Timestamp:Qr,Blob:vp,Transaction:Jm,WriteBatch:eg,DocumentReference:rg,DocumentSnapshot:hg,Query:gg,QueryDocumentSnapshot:pg,QuerySnapshot:Ig,CollectionReference:Dg,FieldPath:gt,FieldValue:vt,setLogLevel:function(e){Ar.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1},t=t.default,Lg=function(e,t){return new Gm(e,new Bp(e,t),new jm)};t.INTERNAL.registerComponent(new C("firestore",function(e){var t=e.getProvider("app").getImmediate();return Lg(t,e.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},vt))),t.registerVersion("@firebase/firestore","2.0.4-1.0.0-eap-firestore-debug.9c6096f43")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});