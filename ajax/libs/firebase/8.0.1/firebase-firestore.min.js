!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(iy){"use strict";try{(function(){var f,t,e=(t=iy)&&"object"==typeof t&&"default"in t?t:{default:t},r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=c[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(ge=f=f||{})[ge.DEBUG=0]="DEBUG",ge[ge.VERBOSE=1]="VERBOSE",ge[ge.INFO=2]="INFO",ge[ge.WARN=3]="WARN",ge[ge.ERROR=4]="ERROR",ge[ge.SILENT=5]="SILENT";var u={debug:f.DEBUG,verbose:f.VERBOSE,info:f.INFO,warn:f.WARN,error:f.ERROR,silent:f.SILENT},a=f.INFO,c=((me={})[f.DEBUG]="log",me[f.VERBOSE]="log",me[f.INFO]="info",me[f.WARN]="warn",me[f.ERROR]="error",me),h=(Object.defineProperty(l.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in f))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),l.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?u[t]:t},Object.defineProperty(l.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),l.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.DEBUG],t)),this._logHandler.apply(this,s([this,f.DEBUG],t))},l.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.VERBOSE],t)),this._logHandler.apply(this,s([this,f.VERBOSE],t))},l.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.INFO],t)),this._logHandler.apply(this,s([this,f.INFO],t))},l.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.WARN],t)),this._logHandler.apply(this,s([this,f.WARN],t))},l.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.ERROR],t)),this._logHandler.apply(this,s([this,f.ERROR],t))},l);function l(t){this.name=t,this._logLevel=a,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,g="FirebaseError",m=(n(w,d=Error),w);function w(t,e,n){return(e=d.call(this,e)||this).code=t,e.customData=n,e.name=g,Object.setPrototypeOf(e,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,b.prototype.create),e}var b=(I.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=(t=this.errors[t])?(r=i,t.replace(E,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},I);function I(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g,T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function _(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=A||self;function D(){}function S(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function O(t){var e=S(t);return"array"==e||"object"==e&&"number"==typeof t.length}function x(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var k="closure_uid_"+(1e9*Math.random()>>>0),P=0;function L(t,e,n){return t.call.apply(t.bind,arguments)}function R(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:R).apply(null,arguments)}function V(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var U=Date.now;function M(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&(Object.prototype.hasOwnProperty.call(this,k)&&this[k]||(this[k]=++P))},q.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},j=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(){return Array.prototype.concat.apply([],arguments)}function G(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t){return/^[\s\xa0]*$/.test(t)}var K=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function H(t,e){return-1!=t.indexOf(e)}function W(t,e){return t<e?-1:e<t?1:0}var Q=N.navigator;function Y(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function X(t){var e,n={};for(e in t)n[e]=t[e];return n}at=(Q=Q&&Q.userAgent)?Q:"";var J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<J.length;i++)e=J[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Z(t){return Z[" "](t),t}Z[" "]=D;var tt,et=H(at,"Opera"),nt=H(at,"Trident")||H(at,"MSIE"),rt=H(at,"Edge"),it=rt||nt,ot=H(at,"Gecko")&&!(H(at.toLowerCase(),"webkit")&&!H(at,"Edge"))&&!(H(at,"Trident")||H(at,"MSIE"))&&!H(at,"Edge"),st=H(at.toLowerCase(),"webkit")&&!H(at,"Edge");function ut(){var t=N.document;return t?t.documentMode:void 0}var Q="",at=(at=at,ot?/rv:([^\);]+)(\)|;)/.exec(at):rt?/Edge\/([\d\.]+)/.exec(at):nt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(at):st?/WebKit\/(\S+)/.exec(at):et?/(?:Version)[ \/]?(\S+)/.exec(at):void 0);at&&(Q=at?at[1]:""),tt=nt&&null!=(at=ut())&&at>parseFloat(Q)?String(at):Q;var ct={};function ht(u){return t=u,e=function(){for(var t=0,e=K(String(tt)).split("."),n=K(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=W(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||W(0==o[2].length,0==s[2].length)||W(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=ct,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var lt=N.document&&nt&&(ut()||parseInt(tt,10))||void 0,ft=!nt||9<=Number(lt),pt=nt&&!ht("9"),dt=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{N.addEventListener("test",D,e),N.removeEventListener("test",D,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function vt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ot){t:{try{Z(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:gt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}yt.prototype.b=function(){this.defaultPrevented=!0},M(vt,yt);var gt={2:"touch",3:"pen",4:"mouse"};vt.prototype.b=function(){vt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,pt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var mt="closure_listenable_"+(1e6*Math.random()|0),wt=0;function bt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++wt,this.Y=this.Z=!1}function It(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Et(t){this.src=t,this.a={},this.b=0}function Tt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=F(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(It(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function _t(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Et.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=_t(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new bt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var At="closure_lm_"+(1e6*Math.random()|0),Nt={};function Dt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ct(r),e&&e[mt]?e.wa(n,r,x(i)?!!i.capture:!!i,o):St(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Dt(t,e[o],n,r,i);return null}return n=Ct(n),t&&t[mt]?t.va(e,n,x(r)?!!r.capture:!!r,i):St(t,e,n,!1,r,i)}function St(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=x(i)?!!i.capture:!!i;if(s&&!ft)return null;var u,a,c=Lt(t);if(c||(t[At]=c=new Et(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=Pt,r=a=ft?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)dt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(xt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ot(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[mt]?Tt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(xt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Lt(e))?(Tt(n,t),0==n.b&&(n.src=null,e[At]=null)):It(t)))}function xt(t){return t in Nt?Nt[t]:Nt[t]="on"+t}function kt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ot(t),n.call(r,e)}function Pt(t,e){if(t.Y)return!0;if(ft)return kt(t,new vt(e,this));if(!e)t:{e=["window","event"];for(var n=N,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return kt(t,e=new vt(e,this))}function Lt(t){return(t=t[At])instanceof Et?t:null}var Rt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ct(e){return"function"==S(e)?e:(e[Rt]||(e[Rt]=function(t){return e.handleEvent(t)}),e[Rt])}function Vt(){q.call(this),this.c=new Et(this),(this.J=this).C=null}function Ut(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new yt(e,t):e instanceof yt?e.target=e.target||t:(s=e,$(e=new yt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Mt(o,r,!0,e)&&s;if(s=Mt(o=e.a=t,r,!0,e)&&s,s=Mt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Mt(o=e.a=n[i],r,!1,e)&&s}function Mt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&Tt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}M(Vt,q),Vt.prototype[mt]=!0,(at=Vt.prototype).addEventListener=function(t,e,n,r){Dt(this,t,e,n,r)},at.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=x(i)?!!i.capture:!!i,r=Ct(r),e&&e[mt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=_t(s=e.a[n],r,i,o))&&(It(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Lt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=_t(n,r,i,o)),(r=-1<e?n[e]:null)&&Ot(r))}(this,t,e,n,r)},at.G=function(){if(Vt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)It(n[r]);delete e.a[t],e.b--}}this.C=null},at.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},at.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var qt=N.JSON.stringify;function Ft(){this.b=this.a=null}var jt,Bt=(Gt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Gt(function(){return new zt},function(t){t.reset()},100));function Gt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function zt(){this.next=this.b=this.a=null}function Kt(t,e){var n;jt||(n=N.Promise.resolve(void 0),jt=function(){n.then(Qt)}),Ht||(jt(),Ht=!0),Wt.add(t,e)}Ft.prototype.add=function(t,e){var n=Bt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Ht=!(zt.prototype.reset=function(){this.next=this.b=this.a=null}),Wt=new Ft;function Qt(){for(var t,e;n=e=void 0,n=null,(e=Wt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){N.setTimeout(function(){throw t},0)}(t)}var n=Bt;n.g(t),n.b<n.f&&(n.b++,t.next=n.a,n.a=t)}Ht=!1}function Yt(t,e){Vt.call(this),this.b=t||1,this.a=e||N,this.f=C(this.Xa,this),this.g=U()}function Xt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Jt(t,e,n){if("function"==S(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}M(Yt,Vt),(at=Yt.prototype).aa=!1,at.M=null,at.Xa=function(){var t;this.aa&&(0<(t=U()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ut(this,"tick"),this.aa&&(Xt(this),this.start())))},at.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=U())},at.G=function(){Yt.X.G.call(this),Xt(this),delete this.a};var $t,Zt,te=(T(Zt=ne,Q=$t=q),Zt.prototype=null===Q?Object.create(Q):(ee.prototype=Q.prototype,new ee),ne.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Jt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},ne.prototype.G=function(){$t.prototype.G.call(this),this.a&&(N.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},ne);function ee(){this.constructor=Zt}function ne(t,e,n){var r=$t.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function re(t){q.call(this),this.b=t,this.a={}}M(re,q);var ie=[];function oe(t,e,n,r){Array.isArray(n)||(n&&(ie[0]=n.toString()),n=ie);for(var i=0;i<n.length;i++){var o=Dt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function se(t){Y(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ot(t)},t),t.a={}}function ue(){this.a=!0}function ae(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)&&"noop"!=(r=i[0])&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}return qt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}re.prototype.G=function(){re.X.G.call(this),se(this)},re.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ue.prototype.info=function(){};var ce=null;function he(){return ce=ce||new Vt}function le(t){yt.call(this,"serverreachability",t)}function fe(){var t=he();Ut(t,new le(t))}function pe(t){yt.call(this,"statevent",t)}function de(){var t=he();Ut(t,new pe(t))}function ye(t){yt.call(this,"timingevent",t)}function ve(t,e){if("function"!=S(t))throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){t()},e)}M(le,yt),M(pe,yt),M(ye,yt);var ge={NO_ERROR:0,Ya:1,fb:2,eb:3,ab:4,cb:5,gb:6,Da:7,TIMEOUT:8,jb:9},me={$a:"complete",nb:"success",Ea:"error",Da:"abort",lb:"ready",mb:"readystatechange",TIMEOUT:"timeout",hb:"incrementaldata",kb:"progress",bb:"downloadprogress",ob:"uploadprogress"};function we(){}function be(t){var e;return(e=t.a)||(e=t.a={}),e}function Ie(){}we.prototype.a=null;var Ee,A={OPEN:"a",Za:"b",Ea:"c",ib:"d"};function Te(){yt.call(this,"d")}function _e(){yt.call(this,"c")}function Ae(){}function Ne(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new re(this),this.P=De,t=it?125:void 0,this.R=new Yt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}M(Te,yt),M(_e,yt),M(Ae,we),Ee=new Ae;var De=45e3,Se={},Oe={};function xe(t,e,n){t.H=1,t.i=Je(Ke(e)),t.j=n,t.I=!0,ke(t,null)}function ke(t,e){t.u=U(),Le(t),t.l=Ke(t.i);var s,u,a,c,h,l,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),ln(n.b,"t",r),t.D=0,t.a=ir(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(C(t.Ca,t,t.a),t.O)),oe(t.J,t.a,"readystatechange",t.Va),e=t.B?X(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),fe(),s=t.c,u=t.m,a=t.l,c=t.f,h=t.S,l=t.j,s.info(function(){if(s.a)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Pe(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var u=(u=n,o=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?Oe:(i=Number(u.substring(i,o)),isNaN(i)?Se:(o+=1)+i>u.length?Oe:(u=u.substr(o,i),r.D=o+i,u)));if(u==Oe){4==e&&(t.h=4,de(),s=!1),ae(t.c,t.f,null,"[Incomplete Response]");break}if(u==Se){t.h=4,de(),ae(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}ae(t.c,t.f,u,null),Me(t,u)}4==e&&0==n.length&&(t.h=1,de(),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xn(e),e.F=!0,de())):(ae(t.c,t.f,n,"[Invalid Chunked Response]"),Ue(t),Ve(t))}function Le(t){t.T=U()+t.P,Re(t,t.P)}function Re(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ve(C(t.Ta,t),e)}function Ce(t){t.o&&(N.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||Zn(t.g,t)}function Ue(t){Ce(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Xt(t.R),se(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Me(t,e){try{var n,r,i,o,s,u=t.g;if(0!=u.v&&(u.a==t||mn(u.b,t)))if(u.I=t.N,!t.C&&mn(u.b,t)&&3==u.v){try{var a=u.ka.a.parse(e)}catch(t){a=null}if(Array.isArray(a)&&3==a.length){var c=a;if(0==c[0]){t:if(!u.j){if(u.a){if(!(u.a.u+3e3<t.u))break t;$n(u),jn(u)}Yn(u),de()}}else u.oa=c[1],0<u.oa-u.P&&c[2]<37500&&u.H&&0==u.o&&!u.m&&(u.m=ve(C(u.Qa,u),6e3));if(gn(u.b)<=1&&u.ea){try{u.ea()}catch(t){}u.ea=void 0}}else er(u,11)}else if(!t.C&&u.a!=t||$n(u),!z(e))for(e=a=u.ka.a.parse(e),a=0;a<e.length;a++)c=e[a],u.P=c[0],c=c[1],2==u.v?"c"==c[0]?(u.J=c[1],u.ga=c[2],null!=(r=c[3])&&(u.ha=r,u.c.info("VER="+u.ha)),null!=(o=c[4])&&(u.pa=o,u.c.info("SVER="+u.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,u.D=n,u.c.info("backChannelRequestTimeoutMs_="+n)),n=u,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(H(r,"spdy")||H(r,"quic")||H(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(wn(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,Xe(n.B,n.A,s))),u.v=3,u.f&&u.f.ta(),u.U&&(u.N=U()-t.u,u.c.info("Handshake RTT: "+u.N+"ms")),i=t,(n=u).la=rr(n,n.C?n.ga:null,n.fa),i.C?(bn(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Ce(o),Le(o)),n.a=i):Qn(n),0<u.g.length&&zn(u)):"stop"!=c[0]&&"close"!=c[0]||er(u,7):3==u.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?er(u,7):Fn(u):"noop"!=c[0]&&u.f&&u.f.sa(c),u.o=0);fe()}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(O(t)||"string"==typeof t)j(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(O(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(O(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Fe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Be(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Be(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(at=Ne.prototype).setTimeout=function(t){this.P=t},at.Va=function(t){t=t.target;var e=this.F;e&&3==Vn(t)?e.f():this.Ca(t)},at.Ca=function(t){try{if(t==this.a)t:{var e=Vn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!it&&!this.a.$())){this.A||4!=e||7==n||fe(),Ce(this);var i=this.a.W();if(this.N=i,n=this.a.$(),this.b=200==i,r=this.c,u=this.m,a=this.l,c=this.f,h=this.S,l=e,f=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+u+"\n"+a+"\n"+l+" "+f}),this.b){if(this.U&&!this.C){e:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.h=3,de(),Ue(this),Ve(this);break t}ae(this.c,this.f,s,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Me(this,s)}this.I?(Pe(this,e,n),it&&this.b&&3==e&&(oe(this.J,this.R,"tick",this.Ua),this.R.start())):(ae(this.c,this.f,n,null),Me(this,n)),4==e&&Ue(this),this.b&&!this.A&&(4==e?Zn(this.g,this):(this.b=!1,Le(this)))}else 400==i&&0<n.indexOf("Unknown SID")?this.h=3:this.h=0,de(),Ue(this),Ve(this)}}}catch(t){}var u,a,c,h,l,f},at.Ua=function(){var t,e;this.a&&(t=Vn(this.a),e=this.a.$(),this.D<e.length&&(Ce(this),Pe(this,t,e),this.b&&4!=t&&Le(this)))},at.cancel=function(){this.A=!0,Ue(this)},at.Ta=function(){this.o=null;var t,e,n=U();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(fe(),de()),Ue(this),this.h=2,Ve(this)):Re(this,this.T-n)},(at=Fe.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},at.L=function(){return je(this),this.a.concat()},at.get=function(t,e){return Be(this.b,t)?this.b[t]:e},at.set=function(t,e){Be(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},at.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ge=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ze(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof ze?(this.a=void 0!==e?e:t.a,He(this,t.f),this.j=t.j,We(this,t.c),Qe(this,t.h),this.g=t.g,e=t.b,(n=new un).c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Ye(this,n),this.i=t.i):t&&(n=String(t).match(Ge))?(this.a=!!e,He(this,n[1]||"",!0),this.j=$e(n[2]||""),We(this,n[3]||"",!0),Qe(this,n[4]),this.g=$e(n[5]||"",!0),Ye(this,n[6]||"",!0),this.i=$e(n[7]||"")):(this.a=!!e,this.b=new un(null,this.a))}function Ke(t){return new ze(t)}function He(t,e,n){t.f=n?$e(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function We(t,e,n){t.c=n?$e(e,!0):e}function Qe(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ye(t,e,n){var r,i;e instanceof un?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(an(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),ln(this,n,t))},r)),r.f=i):(n||(e=Ze(e,on)),t.b=new un(e,t.a))}function Xe(t,e,n){t.b.set(e,n)}function Je(t){return Xe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^U()).toString(36)),t}function $e(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,sn)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,sn=/#/g;function un(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function an(o){o.a||(o.a=new Fe,o.b=0,o.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",o.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(o.c))}function cn(t,e){an(t),e=fn(t,e),Be(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Be((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function hn(t,e){return an(t),e=fn(t,e),Be(t.a.b,e)}function ln(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(fn(t,e),G(n)),t.b+=n.length)}function fn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function pn(t,e){this.b=t,this.a=e}function dn(t){this.g=t||yn,t=N.PerformanceNavigationTiming?0<(t=N.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(N.ia&&N.ia.ya&&N.ia.ya()&&N.ia.ya().pb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(at=un.prototype).add=function(t,e){an(this),this.c=null,t=fn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},at.forEach=function(n,r){an(this),this.a.forEach(function(t,e){j(t,function(t){n.call(r,t,e,this)},this)},this)},at.L=function(){an(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},at.K=function(t){an(this);var e=[];if("string"==typeof t)hn(this,t)&&(e=B(e,this.a.get(fn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},at.set=function(t,e){return an(this),this.c=null,hn(this,t=fn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},at.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},at.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var yn=10;function vn(t){return t.b||t.a&&t.a.size>=t.f}function gn(t){return t.b?1:t.a?t.a.size:0}function mn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function bn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function In(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return G(t.c);var r=t.c;try{for(var i=_(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function En(){}function Tn(){this.a=new En}function _n(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=In(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=_(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return N.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return N.JSON.parse(t,void 0)};var An=N.JSON.parse;function Nn(t){Vt.call(this),this.headers=new Fe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Dn,this.D=this.F=!1}M(Nn,Vt);var Dn="",Sn=/^https?$/i,On=["POST","PUT"];function xn(t){return"content-type"==t.toLowerCase()}function kn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Pn(t),Rn(t)}function Pn(t){t.u||(t.u=!0,Ut(t,"complete"),Ut(t,"error"))}function Ln(t){if(t.b&&(!t.s[1]||4!=Vn(t)||2!=t.W()))if(t.l&&4==Vn(t))Jt(t.za,0,t);else if(Ut(t,"readystatechange"),4==Vn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(Ge)[1]||null)&&N.self&&N.self.location&&(i=(r=N.self.location.protocol).substr(0,r.length-1)),n=!Sn.test(i?i.toLowerCase():"")),e=n),e)Ut(t,"complete"),Ut(t,"success");else{t.h=6;try{var u=2<Vn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.W()+"]",Pn(t)}}finally{Rn(t)}}}function Rn(t,e){if(t.a){Cn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||Ut(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Cn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(N.clearTimeout(t.m),t.m=null)}function Vn(t){return t.a?t.a.readyState:0}function Un(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Y(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Xe(t,e,n))}function Mn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function qn(t){this.pa=0,this.g=[],this.c=new ue,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Ma=this.R=0,this.Ja=Mn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Fa=Mn("baseRetryDelayMs",5e3,t),this.Pa=Mn("retryDelaySeedMs",1e4,t),this.Ka=Mn("forwardChannelMaxRetries",2,t),this.ma=Mn("forwardChannelRequestTimeoutMs",2e4,t),this.La=t&&t.h||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new Tn,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.g&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ia=t&&t.f||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Fn(t){var e,n;Bn(t),3==t.v&&(e=t.R++,Xe(n=Ke(t.B),"SID",t.J),Xe(n,"RID",e),Xe(n,"TYPE","terminate"),Hn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Je(Ke(n)),n=!1,N.navigator&&N.navigator.sendBeacon&&(n=N.navigator.sendBeacon(e.i.toString(),"")),!n&&N.Image&&((new Image).src=e.i,n=!0),n||(e.a=ir(e.g,null),e.a.ba(e.i)),e.u=U(),Le(e)),nr(t)}function jn(t){t.a&&(Xn(t),t.a.cancel(),t.a=null)}function Bn(t){jn(t),t.j&&(N.clearTimeout(t.j),t.j=null),$n(t),t.b.cancel(),t.h&&("number"==typeof t.h&&N.clearTimeout(t.h),t.h=null)}function Gn(t,e){t.g.push(new pn(t.Ma++,e)),3==t.v&&zn(t)}function zn(t){vn(t.b)||t.h||(t.h=!0,Kt(t.Ba,t),t.u=0)}function Kn(t,e){var n=e?e.f:t.R++,r=Ke(t.B);Xe(r,"SID",t.J),Xe(r,"RID",n),Xe(r,"AID",t.P),Hn(t,r),t.i&&t.l&&Un(r,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Wn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),xe(n,r,e)}function Hn(t,n){t.f&&qe({},function(t,e){Xe(n,e,t)})}function Wn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?C(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r){var i="req"+c+"_"||"";try{qe(t,function(t,e){var n=t;x(t)&&(n=qt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s)}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Qn(t){t.a||t.j||(t.T=1,Kt(t.Aa,t),t.o=0)}function Yn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ve(C(t.Aa,t),tr(t,t.o)),t.o++,1)}function Xn(t){null!=t.s&&(N.clearTimeout(t.s),t.s=null)}function Jn(t){t.a=new Ne(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ke(t.la);Xe(e,"RID","rpc"),Xe(e,"SID",t.J),Xe(e,"CI",t.H?"0":"1"),Xe(e,"AID",t.P),Hn(t,e),Xe(e,"TYPE","xmlhttp"),t.i&&t.l&&Un(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Je(Ke(e)),n.j=null,n.I=!0,ke(n,t)}function $n(t){null!=t.m&&(N.clearTimeout(t.m),t.m=null)}function Zn(t,e){var n,r,i,o=null;if(t.a==e){$n(t),Xn(t),t.a=null;var s=2}else{if(!mn(t.b,e))return;o=e.s,bn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=U()-e.u,n=t.u,Ut(s=he(),new ye(s)),zn(t)):Qn(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,gn((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.Ja?0:r.Ka)||(r.h=ve(C(r.Ba,r,i),tr(r,r.u)),r.u++,0))))&&(2!=s||!Yn(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:er(t,5);break;case 4:er(t,10);break;case 3:er(t,6);break;default:er(t,2)}}function tr(t,e){var n=t.Fa+Math.floor(Math.random()*t.Pa);return t.f||(n*=2),n*e}function er(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=C(t.Wa,t),r||(r=new ze("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||He(r,"https"),Je(r)),n=r.toString(),r=o,o=new ue,N.Image?((i=new Image).onload=V(_n,o,i,"TestLoadImage: loaded",!0,r),i.onerror=V(_n,o,i,"TestLoadImage: error",!1,r),i.onabort=V(_n,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=V(_n,o,i,"TestLoadImage: timeout",!1,r),N.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):de(),t.v=0,t.f&&t.f.ra(e),nr(t),Bn(t)}function nr(t){t.v=0,t.I=-1,t.f&&(0==In(t.b).length&&0==t.g.length||(t.b.c.length=0,G(t.g),t.g.length=0),t.f.qa())}function rr(t,e,n){var r,i,o,s,u,a=(s=n)instanceof ze?Ke(s):new ze(s,void 0);return""!=a.c?(e&&We(a,e+"."+a.c),Qe(a,a.h)):(r=(u=N.location).protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new ze(null,void 0),r&&He(u,r),i&&We(u,i),o&&Qe(u,o),s&&(u.g=s),a=u),t.V&&Y(t.V,function(t,e){Xe(a,e,t)}),e=t.A,n=t.na,e&&n&&Xe(a,e,n),Xe(a,"VER",t.ha),Hn(t,a),a}function ir(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nn(t.La)).F=t.C,e}function or(){}function sr(){if(nt&&!(10<=Number(lt)))throw Error("Environmental error: no available transport.")}function ur(t,e){Vt.call(this),this.a=new qn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!z(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!z(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new hr(this)}function ar(t){Te.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){_e.call(this),this.status=1}function hr(t){this.a=t}(at=Nn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?be(this.H):be(Ee),this.a.onreadystatechange=C(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void kn(this,t)}t=n||"";var i,o=new Fe(this.headers);r&&qe(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=xn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=N.FormData&&t instanceof N.FormData,0<=F(On,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Cn(this),0<this.o&&((this.D=(i=this.a,nt&&ht(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.xa,this)):this.m=Jt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){kn(this,t)}},at.xa=function(){this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ut(this,"timeout"),this.abort(8))},at.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ut(this,"complete"),Ut(this,"abort"),Rn(this))},at.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Rn(this,!0)),Nn.X.G.call(this)},at.za=function(){this.j||(this.A||this.l||this.g?Ln(this):this.Sa())},at.Sa=function(){Ln(this)},at.W=function(){try{return 2<Vn(this)?this.a.status:-1}catch(t){return-1}},at.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},at.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),An(e)}},at.ua=function(){return this.h},at.Oa=function(){return"string"==typeof this.f?this.f:String(this.f)},(at=qn.prototype).ha=8,at.v=1,at.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),r=this.l;if(this.O&&(r?$(r=X(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Wn(this,n,e),Xe(i=Ke(this.B),"RID",t),Xe(i,"CVER",22),this.A&&Xe(i,"X-HTTP-Session-Id",this.A),Hn(this,i),this.i&&r&&Un(i,this.i,r),wn(this.b,n),this.Ga&&Xe(i,"TYPE","init"),this.da?(Xe(i,"$req",e),Xe(i,"SID","null"),n.U=!0,xe(n,i,null)):xe(n,i,e),this.v=2}}else 3==this.v&&(t?Kn(this,t):0==this.g.length||vn(this.b)||Kn(this))},at.Aa=function(){var t;this.j=null,Jn(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=ve(C(this.Ra,this),t))},at.Ra=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,de(),jn(this),Jn(this))},at.Qa=function(){null!=this.m&&(this.m=null,jn(this),Yn(this),de())},at.Wa=function(t){t?this.c.info("Successfully pinged google.com"):this.c.info("Failed to ping google.com"),de()},(at=or.prototype).ta=function(){},at.sa=function(){},at.ra=function(){},at.qa=function(){},at.Ha=function(){},sr.prototype.a=function(t,e){return new ur(t,e)},M(ur,Vt),ur.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;de(),t.fa=e,t.V=n||{},t.H=t.S,t.B=rr(t,null,t.fa),zn(t)},ur.prototype.close=function(){Fn(this.a)},ur.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,Gn(this.a,e)):this.l?((e={}).__data__=qt(t),Gn(this.a,e)):Gn(this.a,t)},ur.prototype.G=function(){this.a.f=null,delete this.f,Fn(this.a),delete this.a,ur.X.G.call(this)},M(ar,Te),M(cr,_e),M(hr,or),hr.prototype.ta=function(){Ut(this.a,"a")},hr.prototype.sa=function(t){Ut(this.a,new ar(t))},hr.prototype.ra=function(t){Ut(this.a,new cr)},hr.prototype.qa=function(){Ut(this.a,"b")},sr.prototype.createWebChannel=sr.prototype.a,ur.prototype.send=ur.prototype.h,ur.prototype.open=ur.prototype.g,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",(Ie.EventType=A).OPEN="a",A.CLOSE="b",A.ERROR="c",A.MESSAGE="d",Vt.prototype.listen=Vt.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Oa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.W,Nn.prototype.getResponseJson=Nn.prototype.Na,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var lr=ge,fr=me,pr=Ie,dr=Nn,A=(yr.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},yr.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},yr.prototype.setServiceProps=function(t){return this.serviceProps=t,this},yr);function yr(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var vr,gr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},mr=(n(br,vr=Error),br),wr=new h("@firebase/firestore");function br(t,e){var n=this;return(n=vr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Ir(){return wr.logLevel}function Er(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];wr.logLevel<=f.DEBUG&&(e=n.map(Ar),wr.debug.apply(wr,i(["Firestore (8.0.1): "+t],e)))}function Tr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];wr.logLevel<=f.ERROR&&(e=n.map(Ar),wr.error.apply(wr,i(["Firestore (8.0.1): "+t],e)))}function _r(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];wr.logLevel<=f.WARN&&(e=n.map(Ar),wr.warn.apply(wr,i(["Firestore (8.0.1): "+t],e)))}function Ar(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Nr(t){throw void 0===t&&(t="Unexpected state"),Tr(t="FIRESTORE (8.0.1) INTERNAL ASSERTION FAILED: "+t),new Error(t)}function Dr(t){t||Nr()}var Sr=(Or.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(var n=0;n<40;n++)e[n]=Math.floor(256*Math.random());return e}(),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Or);function Or(){}function xr(t,e){return t<e?-1:e<t?1:0}function kr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Pr(t){return t+"\0"}var Lr=(Rr.fromBase64String=function(t){return new Rr(atob(t))},Rr.fromUint8Array=function(t){return new Rr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Rr.prototype.toBase64=function(){return t=this.i,btoa(t);var t},Rr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},Rr.prototype.o=function(){return 2*this.i.length},Rr.prototype.u=function(t){return xr(this.i,t.i)},Rr.prototype.isEqual=function(t){return this.i===t.i},Rr);function Rr(t){this.i=t}Lr.h=new Lr("");var Cr=(Vr.fromBase64String=function(t){try{return new Vr(Lr.fromBase64String(t))}catch(t){throw new mr(gr.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},Vr.fromUint8Array=function(t){return new Vr(Lr.fromUint8Array(t))},Vr.prototype.toBase64=function(){return this.l.toBase64()},Vr.prototype.toUint8Array=function(){return this.l.toUint8Array()},Vr.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Vr.prototype.isEqual=function(t){return this.l.isEqual(t.l)},Vr);function Vr(t){this.l=t}function Ur(){if("undefined"==typeof Uint8Array)throw new mr(gr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Mr(){if("undefined"==typeof atob)throw new mr(gr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var qr,Fr=(n(zr,qr=Cr),zr.fromBase64String=function(t){Mr();try{return new zr(Lr.fromBase64String(t))}catch(t){throw new mr(gr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},zr.fromUint8Array=function(t){return Ur(),new zr(Lr.fromUint8Array(t))},zr.prototype.toBase64=function(){return Mr(),qr.prototype.toBase64.call(this)},zr.prototype.toUint8Array=function(){return Ur(),qr.prototype.toUint8Array.call(this)},zr.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},zr),jr=function(t,e,n,r,i,o){this._=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.T=o},Br=(Object.defineProperty(Gr.prototype,"I",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Gr.prototype.isEqual=function(t){return t instanceof Gr&&t.projectId===this.projectId&&t.database===this.database},Gr.prototype.u=function(t){return xr(this.projectId,t.projectId)||xr(this.database,t.database)},Gr);function Gr(t,e){this.projectId=t,this.database=e||"(default)"}function zr(){return null!==qr&&qr.apply(this,arguments)||this}function Kr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Hr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Wr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Qr,Yr,Xr=(ci.prototype.get=function(t){var e=this.m(t);if(void 0!==(e=this.R[e]))for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.A(i,t))return o}},ci.prototype.has=function(t){return void 0!==this.get(t)},ci.prototype.set=function(t,e){var n=this.m(t),r=this.R[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.A(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.R[n]=[[t,e]]},ci.prototype.delete=function(t){var e=this.m(t),n=this.R[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.A(n[r][0],t))return 1===n.length?delete this.R[e]:n.splice(r,1),!0;return!1},ci.prototype.forEach=function(s){Hr(this.R,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];s(i,o)}})},ci.prototype.P=function(){return Wr(this.R)},ci),Jr=(ai.now=function(){return ai.fromMillis(Date.now())},ai.fromDate=function(t){return ai.fromMillis(t.getTime())},ai.fromMillis=function(t){var e=Math.floor(t/1e3);return new ai(e,1e6*(t-1e3*e))},ai.prototype.toDate=function(){return new Date(this.toMillis())},ai.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ai.prototype.g=function(t){return this.seconds===t.seconds?xr(this.nanoseconds,t.nanoseconds):xr(this.seconds,t.seconds)},ai.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ai.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ai.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ai.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ai),$r=(ui.V=function(t){return new ui(t)},ui.min=function(){return new ui(new Jr(0,0))},ui.prototype.u=function(t){return this.timestamp.g(t.timestamp)},ui.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ui.prototype.p=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ui.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ui.prototype.v=function(){return this.timestamp},ui),ge=(Object.defineProperty(si.prototype,"length",{get:function(){return this.S},enumerable:!1,configurable:!0}),si.prototype.isEqual=function(t){return 0===si.D(this,t)},si.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof si?t.forEach(function(t){e.push(t)}):e.push(t),this.C(e)},si.prototype.limit=function(){return this.offset+this.length},si.prototype.N=function(t){return t=void 0===t?1:t,this.C(this.segments,this.offset+t,this.length-t)},si.prototype.F=function(){return this.C(this.segments,this.offset,this.length-1)},si.prototype.O=function(){return this.segments[this.offset]},si.prototype.k=function(){return this.get(this.length-1)},si.prototype.get=function(t){return this.segments[this.offset+t]},si.prototype.P=function(){return 0===this.length},si.prototype.M=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},si.prototype.$=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},si.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},si.prototype.L=function(){return this.segments.slice(this.offset,this.limit())},si.D=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},si),Zr=(n(oi,Yr=ge),oi.prototype.C=function(t,e,n){return new oi(t,e,n)},oi.prototype.B=function(){return this.L().join("/")},oi.prototype.toString=function(){return this.B()},oi.q=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new mr(gr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new oi(n)},oi.U=function(){return new oi([])},oi),ti=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ei=(n(ii,Qr=ge),ii.prototype.C=function(t,e,n){return new ii(t,e,n)},ii.K=function(t){return ti.test(t)},ii.prototype.B=function(){return this.L().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),ii.K(t)||(t="`"+t+"`"),t}).join(".")},ii.prototype.toString=function(){return this.B()},ii.prototype.W=function(){return 1===this.length&&"__name__"===this.get(0)},ii.j=function(){return new ii(["__name__"])},ii.G=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new mr(gr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new mr(gr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new mr(gr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new mr(gr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ii(e)},ii.U=function(){return new ii([])},ii),ni=(ri.H=function(t){return new ri(Zr.q(t))},ri.Y=function(t){return new ri(Zr.q(t).N(5))},ri.prototype.J=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ri.prototype.isEqual=function(t){return null!==t&&0===Zr.D(this.path,t.path)},ri.prototype.toString=function(){return this.path.toString()},ri.D=function(t,e){return Zr.D(t.path,e.path)},ri.X=function(t){return t.length%2==0},ri.Z=function(t){return new ri(new Zr(t.slice()))},ri);function ri(t){this.path=t}function ii(){return null!==Qr&&Qr.apply(this,arguments)||this}function oi(){return null!==Yr&&Yr.apply(this,arguments)||this}function si(t,e,n){void 0===e?e=0:e>t.length&&Nr(),void 0===n?n=t.length-e:n>t.length-e&&Nr(),this.segments=t,this.offset=e,this.S=n}function ui(t){this.timestamp=t}function ai(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new mr(gr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new mr(gr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new mr(gr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new mr(gr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ci(t,e){this.m=t,this.A=e,this.R={}}function hi(t){return null==t}function li(t){return 0===t&&1/t==-1/0}function fi(t){return"number"==typeof t&&Number.isInteger(t)&&!li(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var pi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.tt=null};function di(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new pi(t,e,n,r,i,o,s)}function yi(t){var e=t;return null===e.tt&&(t=e.path.B(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return t.field.B()+t.op.toString()+yo(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return t.field.B()+t.dir}).join(","),hi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Hu(e.startAt)),e.endAt&&(t+="|ub:",t+=Hu(e.endAt)),e.tt=t),e.tt}function vi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!ho(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Qu(t.startAt,e.startAt)&&Qu(t.endAt,e.endAt)}function gi(t){return ni.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}function mi(t){this.count=t}var wi,bi=(Ii.prototype.st=function(t){return new Ii(this.target,this.targetId,this.et,t,this.nt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Ii.prototype.it=function(t,e){return new Ii(this.target,this.targetId,this.et,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Ii.prototype.rt=function(t){return new Ii(this.target,this.targetId,this.et,this.sequenceNumber,this.nt,t,this.resumeToken)},Ii);function Ii(t,e,n,r,i,o,s){void 0===i&&(i=$r.min()),void 0===o&&(o=$r.min()),void 0===s&&(s=Lr.h),this.target=t,this.targetId=e,this.et=n,this.sequenceNumber=r,this.nt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ei(t){switch(t){case gr.OK:return Nr(),0;case gr.CANCELLED:case gr.UNKNOWN:case gr.DEADLINE_EXCEEDED:case gr.RESOURCE_EXHAUSTED:case gr.INTERNAL:case gr.UNAVAILABLE:case gr.UNAUTHENTICATED:return;case gr.INVALID_ARGUMENT:case gr.NOT_FOUND:case gr.ALREADY_EXISTS:case gr.PERMISSION_DENIED:case gr.FAILED_PRECONDITION:case gr.ABORTED:case gr.OUT_OF_RANGE:case gr.UNIMPLEMENTED:case gr.DATA_LOSS:return 1;default:return Nr(),0}}function Ti(t){if(void 0===t)return Tr("GRPC error has no .code"),gr.UNKNOWN;switch(t){case wi.OK:return gr.OK;case wi.CANCELLED:return gr.CANCELLED;case wi.UNKNOWN:return gr.UNKNOWN;case wi.DEADLINE_EXCEEDED:return gr.DEADLINE_EXCEEDED;case wi.RESOURCE_EXHAUSTED:return gr.RESOURCE_EXHAUSTED;case wi.INTERNAL:return gr.INTERNAL;case wi.UNAVAILABLE:return gr.UNAVAILABLE;case wi.UNAUTHENTICATED:return gr.UNAUTHENTICATED;case wi.INVALID_ARGUMENT:return gr.INVALID_ARGUMENT;case wi.NOT_FOUND:return gr.NOT_FOUND;case wi.ALREADY_EXISTS:return gr.ALREADY_EXISTS;case wi.PERMISSION_DENIED:return gr.PERMISSION_DENIED;case wi.FAILED_PRECONDITION:return gr.FAILED_PRECONDITION;case wi.ABORTED:return gr.ABORTED;case wi.OUT_OF_RANGE:return gr.OUT_OF_RANGE;case wi.UNIMPLEMENTED:return gr.UNIMPLEMENTED;case wi.DATA_LOSS:return gr.DATA_LOSS;default:return Nr()}}(me=wi={})[me.OK=0]="OK",me[me.CANCELLED=1]="CANCELLED",me[me.UNKNOWN=2]="UNKNOWN",me[me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",me[me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",me[me.NOT_FOUND=5]="NOT_FOUND",me[me.ALREADY_EXISTS=6]="ALREADY_EXISTS",me[me.PERMISSION_DENIED=7]="PERMISSION_DENIED",me[me.UNAUTHENTICATED=16]="UNAUTHENTICATED",me[me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",me[me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",me[me.ABORTED=10]="ABORTED",me[me.OUT_OF_RANGE=11]="OUT_OF_RANGE",me[me.UNIMPLEMENTED=12]="UNIMPLEMENTED",me[me.INTERNAL=13]="INTERNAL",me[me.UNAVAILABLE=14]="UNAVAILABLE",me[me.DATA_LOSS=15]="DATA_LOSS";var _i=(Oi.prototype.ot=function(t,e){return new Oi(this.D,this.root.ot(t,e,this.D).copy(null,null,Ni.at,null,null))},Oi.prototype.remove=function(t){return new Oi(this.D,this.root.remove(t,this.D).copy(null,null,Ni.at,null,null))},Oi.prototype.get=function(t){for(var e=this.root;!e.P();){var n=this.D(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Oi.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.P();){var r=this.D(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Oi.prototype.P=function(){return this.root.P()},Object.defineProperty(Oi.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Oi.prototype.ct=function(){return this.root.ct()},Oi.prototype.ut=function(){return this.root.ut()},Oi.prototype.ht=function(t){return this.root.ht(t)},Oi.prototype.forEach=function(n){this.ht(function(t,e){return n(t,e),!1})},Oi.prototype.toString=function(){var n=[];return this.ht(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Oi.prototype.lt=function(t){return this.root.lt(t)},Oi.prototype._t=function(){return new Ai(this.root,null,this.D,!1)},Oi.prototype.ft=function(t){return new Ai(this.root,t,this.D,!1)},Oi.prototype.dt=function(){return new Ai(this.root,null,this.D,!0)},Oi.prototype.wt=function(t){return new Ai(this.root,t,this.D,!0)},Oi),Ai=(Si.prototype.It=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.Et)for(t=t.left;!t.P();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.P();)this.Tt.push(t),t=t.left;return e},Si.prototype.At=function(){return 0<this.Tt.length},Si.prototype.Rt=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},Si),Ni=(Di.prototype.copy=function(t,e,n,r,i){return new Di(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Di.prototype.P=function(){return!1},Di.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},Di.prototype.lt=function(t){return this.right.lt(t)||t(this.key,this.value)||this.left.lt(t)},Di.prototype.min=function(){return this.left.P()?this:this.left.min()},Di.prototype.ct=function(){return this.min().key},Di.prototype.ut=function(){return this.right.P()?this.key:this.right.ut()},Di.prototype.ot=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.ot(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ot(t,e,n))).Pt()},Di.prototype.gt=function(){if(this.left.P())return Di.EMPTY;var t=this;return t.left.yt()||t.left.left.yt()||(t=t.Vt()),(t=t.copy(null,null,null,t.left.gt(),null)).Pt()},Di.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.P()||r.left.yt()||r.left.left.yt()||(r=r.Vt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.yt()&&(r=r.bt()),r.right.P()||r.right.yt()||r.right.left.yt()||(r=r.vt()),0===e(t,r.key)){if(r.right.P())return Di.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.gt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Pt()},Di.prototype.yt=function(){return this.color},Di.prototype.Pt=function(){var t=this;return t.right.yt()&&!t.left.yt()&&(t=t.St()),t.left.yt()&&t.left.left.yt()&&(t=t.bt()),t.left.yt()&&t.right.yt()&&(t=t.Dt()),t},Di.prototype.Vt=function(){var t=this.Dt();return t.right.left.yt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.bt())).St()).Dt()),t},Di.prototype.vt=function(){var t=this.Dt();return t.left.left.yt()&&(t=(t=t.bt()).Dt()),t},Di.prototype.St=function(){var t=this.copy(null,null,Di.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Di.prototype.bt=function(){var t=this.copy(null,null,Di.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Di.prototype.Dt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Di.prototype.Ct=function(){var t=this.Nt();return Math.pow(2,t)<=this.size+1},Di.prototype.Nt=function(){if(this.yt()&&this.left.yt())throw Nr();if(this.right.yt())throw Nr();var t=this.left.Nt();if(t!==this.right.Nt())throw Nr();return t+(this.yt()?0:1)},Di);function Di(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Di.RED,this.left=null!=r?r:Di.EMPTY,this.right=null!=i?i:Di.EMPTY,this.size=this.left.size+1+this.right.size}function Si(t,e,n,r){this.Et=r,this.Tt=[];for(var i=1;!t.P();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Et?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.Et?t.right:t.left}}function Oi(t,e){this.D=t,this.root=e||Ni.EMPTY}function xi(){this.size=0}Ni.EMPTY=null,Ni.RED=!0,Ni.at=!1,Ni.EMPTY=(Object.defineProperty(xi.prototype,"key",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"value",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"color",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"left",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"right",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),xi.prototype.copy=function(t,e,n,r,i){return this},xi.prototype.ot=function(t,e,n){return new Ni(t,e)},xi.prototype.remove=function(t,e){return this},xi.prototype.P=function(){return!0},xi.prototype.ht=function(t){return!1},xi.prototype.lt=function(t){return!1},xi.prototype.ct=function(){return null},xi.prototype.ut=function(){return null},xi.prototype.yt=function(){return!1},xi.prototype.Ct=function(){return!0},xi.prototype.Nt=function(){return 0},new xi);var ki=(Ci.prototype.has=function(t){return null!==this.data.get(t)},Ci.prototype.first=function(){return this.data.ct()},Ci.prototype.last=function(){return this.data.ut()},Object.defineProperty(Ci.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Ci.prototype.indexOf=function(t){return this.data.indexOf(t)},Ci.prototype.forEach=function(n){this.data.ht(function(t,e){return n(t),!1})},Ci.prototype.xt=function(t,e){for(var n=this.data.ft(t[0]);n.At();){var r=n.It();if(0<=this.D(r.key,t[1]))return;e(r.key)}},Ci.prototype.Ft=function(t,e){for(var n=void 0!==e?this.data.ft(e):this.data._t();n.At();)if(!t(n.It().key))return},Ci.prototype.Ot=function(t){return(t=this.data.ft(t)).At()?t.It().key:null},Ci.prototype._t=function(){return new Pi(this.data._t())},Ci.prototype.ft=function(t){return new Pi(this.data.ft(t))},Ci.prototype.add=function(t){return this.copy(this.data.remove(t).ot(t,!0))},Ci.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Ci.prototype.P=function(){return this.data.P()},Ci.prototype.kt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Ci.prototype.isEqual=function(t){if(!(t instanceof Ci))return!1;if(this.size!==t.size)return!1;for(var e=this.data._t(),n=t.data._t();e.At();){var r=e.It().key,i=n.It().key;if(0!==this.D(r,i))return!1}return!0},Ci.prototype.L=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Ci.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Ci.prototype.copy=function(t){var e=new Ci(this.D);return e.data=t,e},Ci),Pi=(Ri.prototype.It=function(){return this.Mt.It().key},Ri.prototype.At=function(){return this.Mt.At()},Ri),Li=new _i(ni.D);function Ri(t){this.Mt=t}function Ci(t){this.D=t,this.data=new _i(this.D)}var Vi=new _i(ni.D),Ui=new _i(ni.D),Mi=new ki(ni.D);function qi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Mi,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Fi=new ki(xr),ji=(ro.Bt=function(t){return new ro(t.D)},ro.prototype.has=function(t){return null!=this.$t.get(t)},ro.prototype.get=function(t){return this.$t.get(t)},ro.prototype.first=function(){return this.Lt.ct()},ro.prototype.last=function(){return this.Lt.ut()},ro.prototype.P=function(){return this.Lt.P()},ro.prototype.indexOf=function(t){return(t=this.$t.get(t))?this.Lt.indexOf(t):-1},Object.defineProperty(ro.prototype,"size",{get:function(){return this.Lt.size},enumerable:!1,configurable:!0}),ro.prototype.forEach=function(n){this.Lt.ht(function(t,e){return n(t),!1})},ro.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.$t.ot(t.key,t),e.Lt.ot(t,null))},ro.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.$t.remove(t),this.Lt.remove(e)):this},ro.prototype.isEqual=function(t){if(!(t instanceof ro))return!1;if(this.size!==t.size)return!1;for(var e=this.Lt._t(),n=t.Lt._t();e.At();){var r=e.It().key,i=n.It().key;if(!r.isEqual(i))return!1}return!0},ro.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ro.prototype.copy=function(t,e){var n=new ro;return n.D=this.D,n.$t=t,n.Lt=e,n},ro),Bi=(no.prototype.track=function(t){var e=t.doc.key,n=this.qt.get(e);!n||0!==t.type&&3===n.type?this.qt=this.qt.ot(e,t):3===t.type&&1!==n.type?this.qt=this.qt.ot(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.qt=this.qt.ot(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.qt=this.qt.remove(e):1===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):Nr()},no.prototype.Ut=function(){var n=[];return this.qt.ht(function(t,e){n.push(e)}),n},no),Gi=(eo.Gt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new eo(t,e,ji.Bt(e),i,n,r,!0,!1)},Object.defineProperty(eo.prototype,"hasPendingWrites",{get:function(){return!this.Qt.P()},enumerable:!1,configurable:!0}),eo.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&yu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Kt.isEqual(t.Kt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},eo),zi=(to.Xt=function(t,e){var n=new Map;return n.set(t,Ki.Zt(t,e)),new to($r.min(),n,Fi,Li,qi())},to),Ki=(Zi.Zt=function(t,e){return new Zi(Lr.h,e,qi(),qi(),qi())},Zi),Hi=function(t,e,n,r){this.ie=t,this.removedTargetIds=e,this.key=n,this.re=r},Wi=function(t,e){this.targetId=t,this.oe=e},Qi=function(t,e,n,r){void 0===n&&(n=Lr.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Yi=(Object.defineProperty($i.prototype,"te",{get:function(){return this.he},enumerable:!1,configurable:!0}),Object.defineProperty($i.prototype,"resumeToken",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty($i.prototype,"_e",{get:function(){return 0!==this.ae},enumerable:!1,configurable:!0}),Object.defineProperty($i.prototype,"fe",{get:function(){return this.le},enumerable:!1,configurable:!0}),$i.prototype.de=function(t){0<t.o()&&(this.le=!0,this.ue=t)},$i.prototype.we=function(){var n=qi(),r=qi(),i=qi();return this.ce.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Nr()}}),new Ki(this.ue,this.he,n,r,i)},$i.prototype.Ee=function(){this.le=!1,this.ce=oo()},$i.prototype.Te=function(t,e){this.le=!0,this.ce=this.ce.ot(t,e)},$i.prototype.Ie=function(t){this.le=!0,this.ce=this.ce.remove(t)},$i.prototype.me=function(){this.ae+=1},$i.prototype.Ae=function(){--this.ae},$i.prototype.Re=function(){this.le=!0,this.he=!0},$i),Xi=(Ji.prototype.be=function(t){for(var e=0,n=t.ie;e<n.length;e++){var r=n[e];t.re instanceof Xs?this.ve(r,t.re):t.re instanceof Js&&this.Se(r,t.key,t.re)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Se(s,t.key,t.re)}},Ji.prototype.De=function(n){var r=this;this.Ce(n,function(t){var e=r.Ne(t);switch(n.state){case 0:r.xe(t)&&e.de(n.resumeToken);break;case 1:e.Ae(),e._e||e.Ee(),e.de(n.resumeToken);break;case 2:e.Ae(),e._e||r.removeTarget(t);break;case 3:r.xe(t)&&(e.Re(),e.de(n.resumeToken));break;case 4:r.xe(t)&&(r.Fe(t),e.de(n.resumeToken));break;default:Nr()}})},Ji.prototype.Ce=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.ge.forEach(function(t,e){r.xe(e)&&n(e)})},Ji.prototype.Oe=function(t){var e=t.targetId,n=t.oe.count;(t=this.ke(e))&&(gi(t=t.target)?0===n?(t=new ni(t.path),this.Se(e,t,new Js(t,$r.min()))):Dr(1===n):this.Me(e)!==n&&(this.Fe(e),this.pe=this.pe.add(e)))},Ji.prototype.$e=function(r){var i=this,o=new Map;this.ge.forEach(function(t,e){var n=i.ke(e);n&&(t.te&&gi(n.target)&&(n=new ni(n.target.path),null!==i.ye.get(n)||i.Le(e,n)||i.Se(e,n,new Js(n,r))),t.fe&&(o.set(e,t.we()),t.Ee()))});var s=qi();this.Ve.forEach(function(t,e){var n=!0;e.Ft(function(t){return!(t=i.ke(t))||2===t.et||(n=!1)}),n&&(s=s.add(t))});var t=new zi(r,o,this.pe,this.ye,s);return this.ye=Li,this.Ve=io(),this.pe=new ki(xr),t},Ji.prototype.ve=function(t,e){var n;this.xe(t)&&(n=this.Le(t,e.key)?2:0,this.Ne(t).Te(e.key,n),this.ye=this.ye.ot(e.key,e),this.Ve=this.Ve.ot(e.key,this.Be(e.key).add(t)))},Ji.prototype.Se=function(t,e,n){var r;this.xe(t)&&(r=this.Ne(t),this.Le(t,e)?r.Te(e,1):r.Ie(e),this.Ve=this.Ve.ot(e,this.Be(e).delete(t)),n&&(this.ye=this.ye.ot(e,n)))},Ji.prototype.removeTarget=function(t){this.ge.delete(t)},Ji.prototype.Me=function(t){var e=this.Ne(t).we();return this.Pe.qe(t).size+e.ee.size-e.se.size},Ji.prototype.me=function(t){this.Ne(t).me()},Ji.prototype.Ne=function(t){var e=this.ge.get(t);return e||(e=new Yi,this.ge.set(t,e)),e},Ji.prototype.Be=function(t){var e=this.Ve.get(t);return e||(e=new ki(xr),this.Ve=this.Ve.ot(t,e)),e},Ji.prototype.xe=function(t){var e=null!==this.ke(t);return e||Er("WatchChangeAggregator","Detected inactive target",t),e},Ji.prototype.ke=function(t){var e=this.ge.get(t);return e&&e._e?null:this.Pe.Ue(t)},Ji.prototype.Fe=function(e){var n=this;this.ge.set(e,new Yi),this.Pe.qe(e).forEach(function(t){n.Se(e,t,null)})},Ji.prototype.Le=function(t,e){return this.Pe.qe(t).has(e)},Ji);function Ji(t){this.Pe=t,this.ge=new Map,this.ye=Li,this.Ve=io(),this.pe=new ki(xr)}function $i(){this.ae=0,this.ce=oo(),this.ue=Lr.h,this.he=!1,this.le=!0}function Zi(t,e,n,r,i){this.resumeToken=t,this.te=e,this.ee=n,this.ne=r,this.se=i}function to(t,e,n,r,i){this.nt=t,this.zt=e,this.Ht=n,this.Yt=r,this.Jt=i}function eo(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Kt=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}function no(){this.qt=new _i(ni.D)}function ro(n){this.D=n?function(t,e){return n(t,e)||ni.D(t.key,e.key)}:function(t,e){return ni.D(t.key,e.key)},this.$t=Vi,this.Lt=new _i(this.D)}function io(){return new _i(ni.D)}function oo(){return new _i(ni.D)}function so(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function uo(t){return t=vo(t.mapValue.fields.__local_write_time__.timestampValue),new Jr(t.seconds,t.nanos)}var ao=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function co(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?so(t)?4:10:Nr()}function ho(r,i){var t,e=co(r);if(e!==co(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return uo(r).isEqual(uo(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=vo(r.timestampValue),t=vo(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,mo(r.bytesValue).isEqual(mo(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,go((t=r).geoPointValue.latitude)===go(e.geoPointValue.latitude)&&go(t.geoPointValue.longitude)===go(e.geoPointValue.longitude);case 2:return t=i,"integerValue"in(e=r)&&"integerValue"in t?go(e.integerValue)===go(t.integerValue):"doubleValue"in e&&"doubleValue"in t&&((e=go(e.doubleValue))===(t=go(t.doubleValue))?li(e)===li(t):isNaN(e)&&isNaN(t));case 9:return kr(r.arrayValue.values||[],i.arrayValue.values||[],ho);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Kr(e)!==Kr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!ho(e[t],n[t])))return!1;return!0}();default:return Nr()}}function lo(t,e){return void 0!==(t.values||[]).find(function(t){return ho(t,e)})}function fo(t,e){var n,r,i,o=co(t),s=co(e);if(o!==s)return xr(o,s);switch(o){case 0:return 0;case 1:return xr(t.booleanValue,e.booleanValue);case 2:return n=e,(r=go(t.integerValue||t.doubleValue))<(n=go(n.integerValue||n.doubleValue))?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return po(t.timestampValue,e.timestampValue);case 4:return po(uo(t),uo(e));case 5:return xr(t.stringValue,e.stringValue);case 6:return i=t.bytesValue,s=e.bytesValue,i=mo(i),s=mo(s),i.u(s);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=xr(n[i],r[i]);if(0!==o)return o}return xr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return o=t.geoPointValue,r=e.geoPointValue,0!==(n=xr(go(o.latitude),go(r.latitude)))?n:xr(go(o.longitude),go(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=fo(n[i],r[i]);if(o)return o}return xr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=xr(r[s],o[s]);if(0!==u)return u;if(0!==(u=fo(n[r[s]],i[o[s]])))return u}return xr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Nr()}}function po(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return xr(t,e);var n=vo(t),t=vo(e);return 0!==(e=xr(n.seconds,t.seconds))?e:xr(n.nanos,t.nanos)}function yo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=vo(t=i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?mo(i.bytesValue).toBase64():"referenceValue"in i?(e=i.referenceValue,ni.Y(e).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Nr();var t,e}(t)}function vo(t){if(Dr(!!t),"string"!=typeof t)return{seconds:go(t.seconds),nanos:go(t.nanos)};var e=0,n=ao.exec(t);return Dr(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n)),t=new Date(t),{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function go(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function mo(t){return"string"==typeof t?Lr.fromBase64String(t):Lr.fromUint8Array(t)}function wo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.B()}}function bo(t){return t&&"integerValue"in t}function Io(t){return!!t&&"arrayValue"in t}function Eo(t){return t&&"nullValue"in t}function To(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function _o(t){return t&&"mapValue"in t}var Ao={asc:"ASCENDING",desc:"DESCENDING"},No={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Do=function(t,e){this._=t,this.Ke=e};function So(t){return{integerValue:""+t}}function Oo(t,e){if(t.Ke){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:li(e)?"-0":e}}function xo(t,e){return fi(e)?So(e):Oo(t,e)}function ko(t,e){return t.Ke?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Po(t,e){return t.Ke?e.toBase64():e.toUint8Array()}function Lo(t){return Dr(!!t),$r.V((t=vo(t),new Jr(t.seconds,t.nanos)))}function Ro(t,e){return new Zr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).B()}function Co(t){return Dr($o(t=Zr.q(t))),t}function Vo(t,e){return Ro(t._,e.path)}function Uo(t,e){return Dr((e=Co(e)).get(1)===t._.projectId),Dr(!e.get(3)&&!t._.database||e.get(3)===t._.database),new ni(jo(e))}function Mo(t,e){return Ro(t._,e)}function qo(t){return 4===(t=Co(t)).length?Zr.U():jo(t)}function Fo(t){return new Zr(["projects",t._.projectId,"databases",t._.database]).B()}function jo(t){return Dr(4<t.length&&"documents"===t.get(4)),t.N(5)}function Bo(t,e,n){return{name:Vo(t,e),fields:n.proto.mapValue.fields}}function Go(t,e){var n,r,i;if(e instanceof Ss)n={update:Bo(t,e.key,e.value)};else if(e instanceof qs)n={delete:Vo(t,e.key)};else if(e instanceof Os)n={update:Bo(t,e.key,e.data),updateMask:(i=e.Qe,r=[],i.fields.forEach(function(t){return r.push(t.B())}),{fieldPaths:r})};else if(e instanceof Rs)n={transform:{document:Vo(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof ns)return{fieldPath:t.field.B(),setToServerValue:"REQUEST_TIME"};if(e instanceof rs)return{fieldPath:t.field.B(),appendMissingElements:{values:e.elements}};if(e instanceof as)return{fieldPath:t.field.B(),removeAllFromArray:{values:e.elements}};if(e instanceof fs)return{fieldPath:t.field.B(),increment:e.We};throw Nr()})}};else{if(!(e instanceof Fs))return Nr();n={verify:Vo(t,e.key)}}return e.Ge.je||(n.currentDocument=void 0!==(i=e.Ge).updateTime?{updateTime:ko(e=t,(t=i.updateTime).v())}:void 0!==i.exists?{exists:i.exists}:Nr()),n}function zo(i,t){var e=t.currentDocument?void 0!==(o=t.currentDocument).updateTime?bs.updateTime(Lo(o.updateTime)):void 0!==o.exists?bs.exists(o.exists):bs.ze():bs.ze();if(t.update){t.update.name;var n=Uo(i,t.update.name),r=new js({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=(o=t.updateMask.fieldPaths||[],new vs(o.map(function(t){return ei.G(t)})));return new Os(n,r,o,e)}return new Ss(n,r,e)}if(t.delete){var s=Uo(i,t.delete);return new qs(s,e)}return t.transform?(r=Uo(i,t.transform.document),s=t.transform.fieldTransforms.map(function(t){return e=i,r=null,"setToServerValue"in(t=t)?(Dr("REQUEST_TIME"===t.setToServerValue),r=new ns):"appendMissingElements"in t?(n=t.appendMissingElements.values||[],r=new rs(n)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new as(n)):"increment"in t?r=new fs(e,t.increment):Nr(),t=ei.G(t.fieldPath),new gs(t,r);var e,n,r}),Dr(!0===e.exists),new Rs(r,s)):t.verify?(t=Uo(i,t.verify),new Fs(t,e)):Nr()}function Ko(t,e){return{documents:[Mo(t,e.path)]}}function Ho(t,e){var n={structuredQuery:{}},r=e.path;return null!==e.collectionGroup?(n.parent=Mo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Mo(t,r.F()),n.structuredQuery.from=[{collectionId:r.k()}]),(r=function(t){if(0!==t.length)return 1===(t=t.map(function(t){if("=="===t.op){if(To(t.value))return{unaryFilter:{field:Xo(t.field),op:"IS_NAN"}};if(Eo(t.value))return{unaryFilter:{field:Xo(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(To(t.value))return{unaryFilter:{field:Xo(t.field),op:"IS_NOT_NAN"}};if(Eo(t.value))return{unaryFilter:{field:Xo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xo(t.field),op:(e=t.op,No[e]),value:t.value}};var e})).length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(e.filters))&&(n.structuredQuery.where=r),(r=function(t){if(0!==t.length)return t.map(function(t){return{field:Xo(t.field),direction:(t=t.dir,Ao[t])}})}(e.orderBy))&&(n.structuredQuery.orderBy=r),r=e.limit,null!==(r=t.Ke||hi(r)?r:{value:r})&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Qo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Qo(e.endAt)),n}function Wo(t){var e=qo(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Dr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Jo(t.unaryFilter.field);return Iu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Jo(t.unaryFilter.field);return Iu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":return n=Jo(t.unaryFilter.field),Iu.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return t=Jo(t.unaryFilter.field),Iu.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Nr()}}(e)]:void 0!==e.fieldFilter?[(n=e,Iu.create(Jo(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Nr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Nr():[];var n}(n.where)),t=[],n.orderBy&&(t=n.orderBy.map(function(t){return new Xu(Jo((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e})),r=null,n.limit&&(r=hi(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=Yo(n.startAt));var u=null;return n.endAt&&(u=Yo(n.endAt)),lu(ru(e,i,t,o,r,"F",s,u))}function Qo(t){return{before:t.before,values:t.position}}function Yo(t){var e=!!t.before,t=t.values||[];return new ju(t,e)}function Xo(t){return{fieldPath:t.B()}}function Jo(t){return ei.G(t.fieldPath)}function $o(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Zo(t,e){return t instanceof fs?bo(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var ts,es,ns=(n(os,es=h=function(){this.He=void 0}),os),rs=(n(is,ts=h),is);function is(t){var e=this;return(e=ts.call(this)||this).elements=t,e}function os(){return null!==es&&es.apply(this,arguments)||this}function ss(t,e){for(var n=ys(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return ho(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var us,as=(n(cs,us=h),cs);function cs(t){var e=this;return(e=us.call(this)||this).elements=t,e}function hs(t,e){for(var n=ys(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!ho(t,e)})}(i[r]);return{arrayValue:{values:n}}}var ls,fs=(n(ps,ls=h),ps);function ps(t,e){var n=this;return(n=ls.call(this)||this).serializer=t,n.We=e,n}function ds(t){return go(t.integerValue||t.doubleValue)}function ys(t){return Io(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var vs=(ms.prototype.Ye=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].M(t))return!0;return!1},ms.prototype.isEqual=function(t){return kr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ms),gs=function(t,e){this.field=t,this.transform=e};function ms(t){(this.fields=t).sort(ei.D)}function ws(t,e){this.version=t,this.transformResults=e}var bs=(Is.ze=function(){return new Is},Is.exists=function(t){return new Is(void 0,t)},Is.updateTime=function(t){return new Is(t)},Object.defineProperty(Is.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Is.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Is);function Is(t,e){this.updateTime=t,this.exists=e}function Es(t,e){return void 0!==t.updateTime?e instanceof Xs&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Xs}function Ts(t,e,n,r){return t instanceof Ss?(o=e,Es((i=t).Ge,o)?(o=As(o),new Xs(i.key,o,i.value,{Je:!0})):o):t instanceof Os?function(t,e){if(!Es(t.Ge,e))return e;var n=As(e),e=Ps(t,e);return new Xs(t.key,n,e,{Je:!0})}(t,e):t instanceof Rs?function(t,e,n,r){if(!Es(t.Ge,e))return e;var i=e,r=function(t,e,n,r){for(var i,o=[],s=0,u=t;s<u.length;s++){var a=u[s],c=a.transform,h=null;n instanceof Xs&&(h=n.field(a.field)),null===h&&r instanceof Xs&&(h=r.field(a.field)),o.push((i=h,a=e,h=void 0,c instanceof ns?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},i&&(h.fields.__previous_value__=i),{mapValue:h}):c instanceof rs?ss(c,i):c instanceof as?hs(c,i):(i=ds(c=Zo(h=c,i))+ds(h.We),bo(c)&&bo(h.We)?So(i):Oo(h.serializer,i))))}return o}(t.fieldTransforms,n,e,r),r=Vs(t,i.data(),r);return new Xs(t.key,i.version,r,{Je:!0})}(t,e,r,n):Es(t.Ge,e)?new Js(t.key,$r.min()):e;var i,o}function _s(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ge.isEqual(e.Ge)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||kr(t.fieldTransforms,t.fieldTransforms,function(t,e){return t.field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof rs&&e instanceof rs||t instanceof as&&e instanceof as?kr(t.elements,e.elements,ho):t instanceof fs&&e instanceof fs?ho(t.We,e.We):t instanceof ns&&e instanceof ns)}))}function As(t){return t instanceof Xs?t.version:$r.min()}var Ns,Ds,Ss=(n(ks,Ds=ge=function(){}),ks),Os=(n(xs,Ns=ge),xs);function xs(t,e,n,r){var i=this;return(i=Ns.call(this)||this).key=t,i.data=e,i.Qe=n,i.Ge=r,i.type=1,i}function ks(t,e,n){var r=this;return(r=Ds.call(this)||this).key=t,r.value=e,r.Ge=n,r.type=0,r}function Ps(t,e){return n=t,e=e instanceof Xs?e.data():js.empty(),r=new Bs(e),n.Qe.fields.forEach(function(t){var e;t.P()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.Xe();var n,r}var Ls,Rs=(n(Cs,Ls=ge),Cs);function Cs(t,e){var n=this;return(n=Ls.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ge=bs.exists(!0),n}function Vs(t,e,n){for(var r=new Bs(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Xe()}var Us,Ms,qs=(n(Hs,Ms=ge),Hs),Fs=(n(Ks,Us=ge),Ks),js=(zs.empty=function(){return new zs({mapValue:{}})},zs.prototype.field=function(t){if(t.P())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!_o(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.k()])||null},zs.prototype.isEqual=function(t){return ho(this.proto,t.proto)},zs),Bs=(Gs.prototype.set=function(t,e){return this.en(t,e),this},Gs.prototype.delete=function(t){return this.en(t,null),this},Gs.prototype.en=function(t,e){for(var n=this.tn,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===co(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.k(),e)},Gs.prototype.Xe=function(){var t=this.nn(ei.U(),this.tn);return null!=t?new js(t):this.Ze},Gs.prototype.nn=function(r,t){var i=this,o=!1,e=this.Ze.field(r),s=_o(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.nn(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Gs);function Gs(t){void 0===t&&(t=js.empty()),this.Ze=t,this.tn=new Map}function zs(t){this.proto=t}function Ks(t,e){var n=this;return(n=Us.call(this)||this).key=t,n.Ge=e,n.type=4,n}function Hs(t,e){var n=this;return(n=Ms.call(this)||this).key=t,n.Ge=e,n.type=3,n}var Ws,Qs,Ys,Xs=(n(nu,Ys=me=function(t,e){this.key=t,this.version=e}),nu.prototype.field=function(t){return this.sn.field(t)},nu.prototype.data=function(){return this.sn},nu.prototype.rn=function(){return this.sn.proto},nu.prototype.isEqual=function(t){return t instanceof nu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Je===t.Je&&this.hasCommittedMutations===t.hasCommittedMutations&&this.sn.isEqual(t.sn)},nu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.sn.toString()+", {hasLocalMutations: "+this.Je+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(nu.prototype,"hasPendingWrites",{get:function(){return this.Je||this.hasCommittedMutations},enumerable:!1,configurable:!0}),nu),Js=(n(eu,Qs=me),eu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(eu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),eu.prototype.isEqual=function(t){return t instanceof eu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},eu),$s=(n(tu,Ws=me),tu.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(tu.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),tu.prototype.isEqual=function(t){return t instanceof tu&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},tu),Zs=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.on=n,this.filters=r,this.limit=i,this.an=o,this.startAt=s,this.endAt=u,this.cn=null,this.un=null,this.startAt,this.endAt};function tu(){return null!==Ws&&Ws.apply(this,arguments)||this}function eu(t,e,n){var r=this;return(r=Qs.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function nu(t,e,n,r){var i=this;return(i=Ys.call(this,t,e)||this).sn=n,i.Je=!!r.Je,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function ru(t,e,n,r,i,o,s,u){return new Zs(t,e,n,r,i,o,s,u)}function iu(t){return new Zs(t)}function ou(t){return!hi(t.limit)&&"F"===t.an}function su(t){return!hi(t.limit)&&"L"===t.an}function uu(t){return 0<t.on.length?t.on[0].field:null}function au(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.hn())return r.field}return null}function cu(t){return null!==t.collectionGroup}function hu(t){var e=t;if(null===e.cn){e.cn=[];var n=au(e),t=uu(e);if(null!==n&&null===t)n.W()||e.cn.push(new Xu(n)),e.cn.push(new Xu(ei.j(),"asc"));else{for(var r=!1,i=0,o=e.on;i<o.length;i++){var s=o[i];e.cn.push(s),s.field.W()&&(r=!0)}r||(n=0<e.on.length?e.on[e.on.length-1].dir:"asc",e.cn.push(new Xu(ei.j(),n)))}}return e.cn}function lu(t){var e=t;if(!e.un)if("F"===e.an)e.un=di(e.path,e.collectionGroup,hu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=hu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Xu(o.field,s))}var u=e.endAt?new ju(e.endAt.position,!e.endAt.before):null,t=e.startAt?new ju(e.startAt.position,!e.startAt.before):null;e.un=di(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.un}function fu(t,e,n){return new Zs(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function pu(t,e){return new Zs(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,e,t.endAt)}function du(t,e){return new Zs(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,e)}function yu(t,e){return vi(lu(t),lu(e))&&t.an===e.an}function vu(t){return yi(lu(t))+"|lt:"+t.an}function gu(t){return"Query(target="+(n=(e=lu(t)).path.B(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return t.field.B()+" "+t.op+" "+yo(t.value)}).join(", ")+"]"),hi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return t.field.B()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Hu(e.startAt)),e.endAt&&(n+=", endAt: "+Hu(e.endAt)),"Target("+n+")")+"; limitType="+t.an+")";var e,n}function mu(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.J(e.collectionGroup)&&e.path.M(n):ni.X(e.path)?e.path.isEqual(n):e.path.$(n))&&function(t){for(var e=0,n=i.on;e<n.length;e++){var r=n[e];if(!r.field.W()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||Wu(t.startAt,hu(t),n))&&(!t.endAt||!Wu(t.endAt,hu(t),n)));var e,n}function wu(u){return function(t,e){for(var n=!1,r=0,i=hu(u);r<i.length;r++){var o=i[r],s=function(t,e,n){var r,i;switch(n=t.field.W()?ni.D(e.key,n.key):(r=t.field,i=n,e=e.field(r),r=i.field(r),null!==e&&null!==r?fo(e,r):Nr()),t.dir){case"asc":return n;case"desc":return-1*n;default:return Nr()}}(o,t,e);if(0!==s)return s;n=n||o.field.W()}return 0}}var bu,Iu=(n(Eu,bu=function(){}),Eu.create=function(t,e,n){return t.W()?"in"===e||"not-in"===e?this.ln(t,e,n):new Nu(t,e,n):"array-contains"===e?new Uu(t,n):"in"===e?new Mu(t,n):"not-in"===e?new qu(t,n):"array-contains-any"===e?new Fu(t,n):new Eu(t,e,n)},Eu.ln=function(t,e,n){return new("in"===e?Du:Su)(t,n)},Eu.prototype.matches=function(t){return t=t.field(this.field),"!="===this.op?null!==t&&this._n(fo(t,this.value)):null!==t&&co(this.value)===co(t)&&this._n(fo(t,this.value))},Eu.prototype._n=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Nr()}},Eu.prototype.hn=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Eu);function Eu(t,e,n){var r=this;return(r=bu.call(this)||this).field=t,r.op=e,r.value=n,r}var Tu,_u,Au,Nu=(n(ku,Au=Iu),ku.prototype.matches=function(t){return t=ni.D(t.key,this.key),this._n(t)},ku),Du=(n(xu,_u=Iu),xu.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},xu),Su=(n(Ou,Tu=Iu),Ou.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Ou);function Ou(t,e){var n=this;return(n=Tu.call(this,t,"not-in",e)||this).keys=Pu(0,e),n}function xu(t,e){var n=this;return(n=_u.call(this,t,"in",e)||this).keys=Pu(0,e),n}function ku(t,e,n){var r=this;return(r=Au.call(this,t,e,n)||this).key=ni.Y(n.referenceValue),r}function Pu(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return ni.Y(t.referenceValue)})}var Lu,Ru,Cu,Vu,Uu=(n(Ku,Vu=Iu),Ku.prototype.matches=function(t){return Io(t=t.field(this.field))&&lo(t.arrayValue,this.value)},Ku),Mu=(n(zu,Cu=Iu),zu.prototype.matches=function(t){return null!==(t=t.field(this.field))&&lo(this.value.arrayValue,t)},zu),qu=(n(Gu,Ru=Iu),Gu.prototype.matches=function(t){return!lo(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(t=t.field(this.field))&&!lo(this.value.arrayValue,t))},Gu),Fu=(n(Bu,Lu=Iu),Bu.prototype.matches=function(t){var e=this;return!(!Io(t=t.field(this.field))||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return lo(e.value.arrayValue,t)})},Bu),ju=function(t,e){this.position=t,this.before=e};function Bu(t,e){return Lu.call(this,t,"array-contains-any",e)||this}function Gu(t,e){return Ru.call(this,t,"not-in",e)||this}function zu(t,e){return Cu.call(this,t,"in",e)||this}function Ku(t,e){return Vu.call(this,t,"array-contains",e)||this}function Hu(t){return(t.before?"b":"a")+":"+t.position.map(yo).join(",")}function Wu(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.W()?ni.D(ni.Y(s.referenceValue),n.key):fo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Qu(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ho(t.position[n],e.position[n]))return!1;return!0}var Yu,Xu=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e},Ju=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},$u=(ua.prototype.reset=function(){this.In=0},ua.prototype.Rn=function(){this.In=this.Tn},ua.prototype.Pn=function(t){var e=this;this.cancel();var n=Math.floor(this.In+this.gn()),r=Math.max(0,Date.now()-this.An),i=Math.max(0,n-r);0<i&&Er("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.In+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.mn=this.fn.yn(this.dn,i,function(){return e.An=Date.now(),t()}),this.In*=this.En,this.In<this.wn&&(this.In=this.wn),this.In>this.Tn&&(this.In=this.Tn)},ua.prototype.Vn=function(){null!==this.mn&&(this.mn.pn(),this.mn=null)},ua.prototype.cancel=function(){null!==this.mn&&(this.mn.cancel(),this.mn=null)},ua.prototype.gn=function(){return(Math.random()-.5)*this.In},ua),Zu=(sa.prototype.catch=function(t){return this.next(void 0,t)},sa.prototype.next=function(r,i){var o=this;return this.Dn&&Nr(),this.Dn=!0,this.Sn?this.error?this.Cn(i,this.error):this.Nn(r,this.result):new sa(function(e,n){o.bn=function(t){o.Nn(r,t).next(e,n)},o.vn=function(t){o.Cn(i,t).next(e,n)}})},sa.prototype.xn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},sa.prototype.Fn=function(t){try{var e=t();return e instanceof sa?e:sa.resolve(e)}catch(t){return sa.reject(t)}},sa.prototype.Nn=function(t,e){return t?this.Fn(function(){return t(e)}):sa.resolve(e)},sa.prototype.Cn=function(t,e){return t?this.Fn(function(){return t(e)}):sa.reject(e)},sa.resolve=function(n){return new sa(function(t,e){t(n)})},sa.reject=function(n){return new sa(function(t,e){e(n)})},sa.On=function(t){return new sa(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},sa.kn=function(t){for(var n=sa.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?sa.resolve(t):e()})}(r[e]);return n},sa.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.On(i)},sa),ta=(oa.delete=function(t){return Er("SimpleDb","Removing database:",t),pa(window.indexedDB.deleteDatabase(t)).xn()},oa.Ln=function(){if("undefined"==typeof indexedDB)return!1;if(oa.Bn())return!0;var t=p(),e=0<(n=oa.$n(t))&&n<10,n=0<(n=oa.qn(t))&&n<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||n)},oa.Bn=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Un)},oa.Kn=function(t,e){return t.store(e)},oa.$n=function(t){return t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1",Number(t)},oa.qn=function(t){return t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1",Number(t)},oa.prototype.Qn=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Er("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result,e(t)},r.onblocked=function(){n(new na(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){"VersionError"===(t=t.target.error).name?n(new mr(gr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new na(o,t))},r.onupgradeneeded=function(t){Er("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.Mn.createOrUpgrade(e,r.transaction,t.oldVersion,i.version).next(function(){Er("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return i.Wn(t)}),this.db)]}})})},oa.prototype.jn=function(e){this.Wn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},oa.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Qn(u)];case 2:return s.db=t.sent(),e=ca.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),Zu.reject(t)}).xn(),r={},n.catch(function(){}),[4,e.Gn];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,Er("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},oa.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},oa),ea=(Object.defineProperty(ia.prototype,"Sn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(ia.prototype,"Jn",{get:function(){return this.Yn},enumerable:!1,configurable:!0}),Object.defineProperty(ia.prototype,"cursor",{set:function(t){this.zn=t},enumerable:!1,configurable:!0}),ia.prototype.done=function(){this.Hn=!0},ia.prototype.Xn=function(t){this.Yn=t},ia.prototype.delete=function(){return pa(this.zn.delete())},ia),na=(n(ra,Yu=mr),ra);function ra(t,e){var n=this;return(n=Yu.call(this,gr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function ia(t){this.zn=t,this.Hn=!1,this.Yn=null}function oa(t,e,n){this.name=t,this.version=e,this.Mn=n,12.2===oa.$n(p())&&Tr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function sa(t){var e=this;this.bn=null,this.vn=null,this.result=void 0,this.error=void 0,this.Sn=!1,this.Dn=!1,t(function(t){e.Sn=!0,e.result=t,e.bn&&e.bn(t)},function(t){e.Sn=!0,e.error=t,e.vn&&e.vn(t)})}function ua(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.fn=t,this.dn=e,this.wn=n,this.En=r,this.Tn=i,this.In=0,this.mn=null,this.An=Date.now(),this.reset()}function aa(t){return"IndexedDbTransactionError"===t.name}var ca=(fa.open=function(t,e,n,r){try{return new fa(e,t.transaction(r,n))}catch(t){throw new na(e,t)}},Object.defineProperty(fa.prototype,"Gn",{get:function(){return this.Zn.promise},enumerable:!1,configurable:!0}),fa.prototype.abort=function(t){t&&this.Zn.reject(t),this.aborted||(Er("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},fa.prototype.store=function(t){return t=this.transaction.objectStore(t),new ha(t)},fa),ha=(la.prototype.put=function(t,e){return pa(t=void 0!==e?(Er("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Er("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},la.prototype.add=function(t){return Er("SimpleDb","ADD",this.store.name,t,t),pa(this.store.add(t))},la.prototype.get=function(e){var n=this;return pa(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Er("SimpleDb","GET",n.store.name,e,t),t})},la.prototype.delete=function(t){return Er("SimpleDb","DELETE",this.store.name,t),pa(this.store.delete(t))},la.prototype.count=function(){return Er("SimpleDb","COUNT",this.store.name),pa(this.store.count())},la.prototype.ts=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.es(e,function(t,e){n.push(e)}).next(function(){return n})},la.prototype.ns=function(t,e){return Er("SimpleDb","DELETE ALL",this.store.name),(e=this.options(t,e)).ss=!1,e=this.cursor(e),this.es(e,function(t,e,n){return n.delete()})},la.prototype.rs=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.es(n,e)},la.prototype.os=function(r){var t=this.cursor({});return new Zu(function(n,e){t.onerror=function(t){t=ya(t.target.error),e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},la.prototype.es=function(t,i){var o=[];return new Zu(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new ea(n),(t=i(n.primaryKey,n.value,e))instanceof Zu&&(t=t.catch(function(t){return e.done(),Zu.reject(t)}),o.push(t)),e.Sn?r():null===e.Jn?n.continue():n.continue(e.Jn)):r()}}).next(function(){return Zu.On(o)})},la.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},la.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ss?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},la);function la(t){this.store=t}function fa(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.Zn=new Ju,this.transaction.oncomplete=function(){n.Zn.resolve()},this.transaction.onabort=function(){t.error?n.Zn.reject(new na(e,t.error)):n.Zn.resolve()},this.transaction.onerror=function(t){t=ya(t.target.error),n.Zn.reject(new na(e,t))}}function pa(t){return new Zu(function(e,n){t.onsuccess=function(t){t=t.target.result,e(t)},t.onerror=function(t){t=ya(t.target.error),n(t)}})}var da=!1;function ya(t){var e=ta.$n(p());if(12.2<=e&&e<13&&(e="An internal error was encountered in the Indexed Database server",0<=t.message.indexOf(e))){var n=new mr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return da||(da=!0,setTimeout(function(){throw n},0)),n}return t}function va(){return"undefined"!=typeof window?window:null}function ga(){return"undefined"!=typeof document?document:null}var ma=(Ia._s=function(t,e,n,r,i){return(i=new Ia(t,e,Date.now()+n,r,i)).start(n),i},Ia.prototype.start=function(t){var e=this;this.fs=setTimeout(function(){return e.ds()},t)},Ia.prototype.pn=function(){return this.ds()},Ia.prototype.cancel=function(t){null!==this.fs&&(this.clearTimeout(),this.ls.reject(new mr(gr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ia.prototype.ds=function(){var e=this;this.cs.ws(function(){return null!==e.fs?(e.clearTimeout(),e.op().then(function(t){return e.ls.resolve(t)})):Promise.resolve()})},Ia.prototype.clearTimeout=function(){null!==this.fs&&(this.hs(this),clearTimeout(this.fs),this.fs=null)},Ia),wa=(Object.defineProperty(ba.prototype,"ps",{get:function(){return this.Is},enumerable:!1,configurable:!0}),ba.prototype.ws=function(t){this.enqueue(t)},ba.prototype.bs=function(t){this.vs(),this.Ss(t)},ba.prototype.Ds=function(){var t;this.Is||(this.Is=!0,(t=ga())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vs))},ba.prototype.enqueue=function(t){return this.vs(),this.Is?new Promise(function(t){}):this.Ss(t)},ba.prototype.Cs=function(t){var e=this;this.ws(function(){return e.Ts.push(t),e.Ns()})},ba.prototype.Ns=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.Ts.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return t.sent(),this.Ts.shift(),this.ys.reset(),[3,4];case 3:if(!aa(e=t.sent()))throw e;return Er("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Ts.length&&this.ys.Pn(function(){return n.Ns()}),t.label=5;case 5:return[2]}})})},ba.prototype.Ss=function(t){var r=this,e=this.Es.then(function(){return r.Ps=!0,t().catch(function(t){throw r.Rs=t,r.Ps=!1,Tr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Ps=!1,t})});return this.Es=e},ba.prototype.yn=function(t,e,n){var r=this;return this.vs(),-1<this.gs.indexOf(t)&&(e=0),n=ma._s(this,t,e,n,function(t){return r.xs(t)}),this.As.push(n),n},ba.prototype.vs=function(){this.Rs&&Nr()},ba.prototype.Fs=function(){},ba.prototype.Os=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Es];case 1:t.sent(),t.label=2;case 2:if(e!==this.Es)return[3,0];t.label=3;case 3:return[2]}})})},ba.prototype.ks=function(t){for(var e=0,n=this.As;e<n.length;e++)if(n[e].dn===t)return!0;return!1},ba.prototype.Ms=function(r){var i=this;return this.Os().then(function(){i.As.sort(function(t,e){return t.us-e.us});for(var t=0,e=i.As;t<e.length;t++){var n=e[t];if(n.pn(),"all"!==r&&n.dn===r)break}return i.Os()})},ba.prototype.$s=function(t){this.gs.push(t)},ba.prototype.xs=function(t){t=this.As.indexOf(t),this.As.splice(t,1)},ba);function ba(){var e=this;this.Es=Promise.resolve(),this.Ts=[],this.Is=!1,this.As=[],this.Rs=null,this.Ps=!1,this.gs=[],this.ys=new $u(this,"async_queue_retry"),this.Vs=function(){var t=ga();t&&Er("AsyncQueue","Visibility state changed to "+t.visibilityState),e.ys.Vn()};var t=ga();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vs)}function Ia(t,e,n,r,i){this.cs=t,this.dn=e,this.us=n,this.op=r,this.hs=i,this.ls=new Ju,this.then=this.ls.promise.then.bind(this.ls.promise),this.ls.promise.catch(function(t){})}function Ea(t,e){if(Tr("AsyncQueue",e+": "+t),aa(t))return new mr(gr.UNAVAILABLE,e+": "+t);throw t}function Ta(){this.Bs=new Xr(vu,yu),this.onlineState="Unknown",this.qs=new Set}var _a=function(){this.Ls=void 0,this.listeners=[]};function Aa(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.Bs.get(n))||(r=!0,i=new _a),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.Us(n)];case 2:return o.Ls=t.sent(),[3,4];case 3:return o=Ea(o=t.sent(),"Initialization of query '"+gu(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.Bs.set(n,i),i.listeners.push(u),u.Ks(e.onlineState),i.Ls&&u.Qs(i.Ls)&&Da(e),[2]}})})}function Na(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.Bs.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.Bs.delete(n),e.Ws(n))]:[2]})})}function Da(t){t.qs.forEach(function(t){t.next()})}var Sa=(ka.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Gi(t.query,t.docs,t.Kt,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Gs?this.Hs(t)&&(this.js.next(t),o=!0):this.Ys(t,this.onlineState)&&(this.Js(t),o=!0),this.zs=t,o},ka.prototype.onError=function(t){this.js.error(t)},ka.prototype.Ks=function(t){this.onlineState=t;var e=!1;return this.zs&&!this.Gs&&this.Ys(this.zs,t)&&(this.Js(this.zs),e=!0),e},ka.prototype.Ys=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Xs&&n||t.docs.P()&&"Offline"!==e)},ka.prototype.Hs=function(t){if(0<t.docChanges.length)return!0;var e=this.zs&&this.zs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},ka.prototype.Js=function(t){t=Gi.Gt(t.query,t.docs,t.Qt,t.fromCache),this.Gs=!0,this.js.next(t)},ka),Oa=(xa.prototype.Zs=function(){return null!=this.uid},xa.prototype.ti=function(){return this.Zs()?"uid:"+this.uid:"anonymous-user"},xa.prototype.isEqual=function(t){return t.uid===this.uid},xa);function xa(t){this.uid=t}function ka(t,e,n){this.query=t,this.js=e,this.Gs=!1,this.zs=null,this.onlineState="Unknown",this.options=n||{}}function Pa(t,e){this.user=e,this.type="OAuth",this.si={},this.si.Authorization="Bearer "+t}Oa.UNAUTHENTICATED=new Oa(null),Oa.ei=new Oa("google-credentials-uid"),Oa.ni=new Oa("first-party-uid");var La=(Za.prototype.getToken=function(){return Promise.resolve(null)},Za.prototype.ri=function(){},Za.prototype.oi=function(t){(this.ii=t)(Oa.UNAUTHENTICATED)},Za.prototype.ai=function(){this.ii=null},Za),Ra=($a.prototype.getToken=function(){var e=this,n=this.hi,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.hi!==n?(Er("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Dr("string"==typeof t.accessToken),new Pa(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},$a.prototype.ri=function(){this.forceRefresh=!0},$a.prototype.oi=function(t){this.ii=t,this.ui&&t(this.currentUser)},$a.prototype.ai=function(){this.auth&&this.auth.removeAuthTokenListener(this.ci),this.ci=null,this.ii=null},$a.prototype.li=function(){var t=this.auth&&this.auth.getUid();return Dr(null===t||"string"==typeof t),new Oa(t)},$a),Ca=(Object.defineProperty(Ja.prototype,"si",{get:function(){var t={"X-Goog-AuthUser":this.fi},e=this._i.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),Ja),Va=(Xa.prototype.getToken=function(){return Promise.resolve(new Ca(this._i,this.fi))},Xa.prototype.oi=function(t){t(Oa.ni)},Xa.prototype.ai=function(){},Xa.prototype.ri=function(){},Xa),Ua=(Ya.prototype.wi=function(t,e,n){for(var r,i,o,s,u,a=n.Ei,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t)&&(r=h,i=e,o=a[c],h=u=s=void 0,e=r instanceof Ss?new Xs(r.key,o.version,r.value,{hasCommittedMutations:!0}):r instanceof Os?(u=i,h=o,Es((s=r).Ge,u)?(u=Ps(s,u),new Xs(s.key,h.version,u,{hasCommittedMutations:!0})):new $s(s.key,h.version)):r instanceof Rs?function(t,e,n){if(Dr(null!=n.transformResults),!Es(t.Ge,e))return new $s(t.key,n.version);var r=e,e=function(t,e,n){var r=[];Dr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof Xs&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof rs?ss(o,s):o instanceof as?hs(o,s):u))}return r}(t.fieldTransforms,e,n.transformResults),n=n.version,e=Vs(t,r.data(),e);return new Xs(t.key,n,e,{hasCommittedMutations:!0})}(r,i,o):new Js(r.key,o.version,{hasCommittedMutations:!0}))}return e},Ya.prototype.Ti=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Ts(i,e,e,this.di))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Ts(a,e,o,this.di))}return e},Ya.prototype.Ii=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Ti(t.key,n.get(t.key));e&&(i=i.ot(t.key,e))}),i},Ya.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},qi())},Ya.prototype.isEqual=function(t){return this.batchId===t.batchId&&kr(this.mutations,t.mutations,_s)&&kr(this.baseMutations,t.baseMutations,_s)},Ya),Ma=(Qa.from=function(t,e,n){Dr(t.mutations.length===n.length);for(var r=Ui,i=t.mutations,o=0;o<i.length;o++)r=r.ot(i[o].key,n[o].version);return new Qa(t,e,n,r)},Qa),h=(Object.defineProperty(Wa.prototype,"readTime",{get:function(){return this.gi},set:function(t){this.gi=t},enumerable:!1,configurable:!0}),Wa.prototype.yi=function(t,e){this.Vi(),this.readTime=e,this.Ri.set(t.key,t)},Wa.prototype.pi=function(t,e){this.Vi(),e&&(this.readTime=e),this.Ri.set(t,null)},Wa.prototype.bi=function(t,e){this.Vi();var n=this.Ri.get(e);return void 0!==n?Zu.resolve(n):this.vi(t,e)},Wa.prototype.getEntries=function(t,e){return this.Si(t,e)},Wa.prototype.apply=function(t){return this.Vi(),this.Pi=!0,this.Di(t)},Wa.prototype.Vi=function(){},Wa),qa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ge=(Ha.prototype.Ni=function(t){this.Ci.push(t)},Ha.prototype.xi=function(){this.Ci.forEach(function(t){return t()})},Ha),Fa=(Ka.prototype.Mi=function(e,n){var r=this;return this.Oi.$i(e,n).next(function(t){return r.Li(e,n,t)})},Ka.prototype.Li=function(t,r,i){return this.Fi.bi(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Ti(r,t);return t})},Ka.prototype.Bi=function(t,e,i){var o=Li;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Ti(t,e);o=o.ot(t,e)}),o},Ka.prototype.qi=function(e,t){var n=this;return this.Fi.getEntries(e,t).next(function(t){return n.Ui(e,t)})},Ka.prototype.Ui=function(e,r){var i=this;return this.Oi.Ki(e,r).next(function(t){var t=i.Bi(e,r,t),n=Li;return t.forEach(function(t,e){e=e||new Js(t,$r.min()),n=n.ot(t,e)}),n})},Ka.prototype.Qi=function(t,e,n){return r=e,ni.X(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Wi(t,e.path):cu(e)?this.ji(t,e,n):this.Gi(t,e,n);var r},Ka.prototype.Wi=function(t,e){return this.Mi(t,new ni(e)).next(function(t){var e=Vi;return t instanceof Xs&&(e=e.ot(t.key,t)),e})},Ka.prototype.ji=function(n,r,i){var o=this,s=r.collectionGroup,u=Vi;return this.ki.zi(n,s).next(function(t){return Zu.forEach(t,function(t){var e=(e=r,t=t.child(s),new Zs(t,null,e.on.slice(),e.filters.slice(),e.limit,e.an,e.startAt,e.endAt));return o.Gi(n,e,i).next(function(t){t.forEach(function(t,e){u=u.ot(t,e)})})}).next(function(){return u})})},Ka.prototype.Gi=function(e,n,t){var a,c,r=this;return this.Fi.Qi(e,n,t).next(function(t){return a=t,r.Oi.Hi(e,n)}).next(function(t){return c=t,r.Yi(e,c,a).next(function(t){a=t;for(var e=0,n=c;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,s=Ts(s,s=a.get(u),s,r.di);a=s instanceof Xs?a.ot(u,s):a.remove(u)}})}).next(function(){return a.forEach(function(t,e){mu(n,e)||(a=a.remove(t))}),a})},Ka.prototype.Yi=function(t,e,n){for(var r=qi(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Os&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Fi.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Xs&&(c=c.ot(t,e))}),c})},Ka),ja=(za.Zi=function(t,e){for(var n=qi(),r=qi(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new za(t,e.fromCache,n,r)},za),Ba=(Ga.prototype.er=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ga.prototype.next=function(){var t=++this.previousValue;return this.nr&&this.nr(t),t},Ga);function Ga(t,e){var n=this;this.previousValue=t,e&&(e.tr=function(t){return n.er(t)},this.nr=function(t){return e.sr(t)})}function za(t,e,n,r){this.targetId=t,this.fromCache=e,this.Ji=n,this.Xi=r}function Ka(t,e,n){this.Fi=t,this.Oi=e,this.ki=n}function Ha(){this.Ci=[]}function Wa(){this.Ri=new Xr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.Pi=!1}function Qa(t,e,n,r){this.batch=t,this.mi=e,this.Ei=n,this.Ai=r}function Ya(t,e,n,r){this.batchId=t,this.di=e,this.baseMutations=n,this.mutations=r}function Xa(t,e){this._i=t,this.fi=e}function Ja(t,e){this._i=t,this.fi=e,this.type="FirstParty",this.user=Oa.ni}function $a(t){var e=this;this.ci=null,this.currentUser=Oa.UNAUTHENTICATED,this.ui=!1,this.hi=0,this.ii=null,this.forceRefresh=!1,this.ci=function(){e.hi++,e.currentUser=e.li(),e.ui=!0,e.ii&&e.ii(e.currentUser)},this.hi=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.ci):(this.ci(null),t.get().then(function(t){e.auth=t,e.ci&&e.auth.addAuthTokenListener(e.ci)},function(){}))}function Za(){this.ii=null}function tc(t,e){var n=t[0],r=t[1],t=e[0],e=e[1];return 0===(t=xr(n,t))?xr(r,e):t}Ba.ir=-1;var ec=(oc.prototype.cr=function(){return++this.ar},oc.prototype.ur=function(t){var e=[t,this.cr()];this.buffer.size<this.rr?this.buffer=this.buffer.add(e):tc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(oc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),oc),nc={hr:!1,lr:0,_r:0,dr:0},rc=(ic.Ir=function(t){return new ic(t,ic.mr,ic.Ar)},ic);function ic(t,e,n){this.wr=t,this.Er=e,this.Tr=n}function oc(t){this.rr=t,this.buffer=new ki(tc),this.ar=0}rc.mr=10,rc.Ar=1e3,rc.Rr=new rc(41943040,rc.mr,rc.Ar),rc.Pr=new rc(-1,0,0);var sc=(cc.prototype.start=function(t){-1!==this.gr.params.wr&&this.pr(t)},cc.prototype.stop=function(){this.Vr&&(this.Vr.cancel(),this.Vr=null)},Object.defineProperty(cc.prototype,"br",{get:function(){return null!==this.Vr},enumerable:!1,configurable:!0}),cc.prototype.pr=function(n){var t=this,e=this.yr?3e5:6e4;Er("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Vr=this.cs.yn("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Vr=null,this.yr=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.vr(this.gr)];case 2:return t.sent(),[3,7];case 3:return aa(e=t.sent())?(Er("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Mh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.pr(n)];case 8:return t.sent(),[2]}})})})},cc),uc=(ac.prototype.Dr=function(t,e){return this.Sr.Cr(t).next(function(t){return Math.floor(e/100*t)})},ac.prototype.Nr=function(t,e){var n=this;if(0===e)return Zu.resolve(Ba.ir);var r=new ec(e);return this.Sr.Ce(t,function(t){return r.ur(t.sequenceNumber)}).next(function(){return n.Sr.Fr(t,function(t){return r.ur(t)})}).next(function(){return r.maxValue})},ac.prototype.Or=function(t,e,n){return this.Sr.Or(t,e,n)},ac.prototype.kr=function(t,e){return this.Sr.kr(t,e)},ac.prototype.Mr=function(e,n){var r=this;return-1===this.params.wr?(Er("LruGarbageCollector","Garbage collection skipped; disabled"),Zu.resolve(nc)):this.$r(e).next(function(t){return t<r.params.wr?(Er("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.wr),nc):r.Lr(e,n)})},ac.prototype.$r=function(t){return this.Sr.$r(t)},ac.prototype.Lr=function(e,n){var r,i,o,s,u,a,c,h=this,l=Date.now();return this.Dr(e,this.params.Er).next(function(t){return i=t>h.params.Tr?(Er("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Tr+" from "+t),h.params.Tr):t,s=Date.now(),h.Nr(e,i)}).next(function(t){return r=t,u=Date.now(),h.Or(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.kr(e,r)}).next(function(t){return c=Date.now(),Ir()<=f.DEBUG&&Er("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-l)+"ms"),Zu.resolve({hr:!0,lr:i,_r:o,dr:t})})},ac);function ac(t,e){this.Sr=t,this.params=e}function cc(t,e){this.gr=t,this.cs=e,this.yr=!1,this.Vr=null}function hc(t){for(var o="",e=0;e<t.length;e++)0<o.length&&(o=lc(o)),o=function(t){for(var e=o,n=t.length,r=0;r<n;r++){var i=t.charAt(r);switch(i){case"\0":e+="";break;case"":e+="";break;default:e+=i}}return e}(t.get(e));return lc(o)}function lc(t){return t+""}function fc(t){var e=t.length;if(Dr(2<=e),2===e)return Dr(""===t.charAt(0)&&""===t.charAt(1)),Zr.U();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Nr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Nr()}o=s+2}return new Zr(r)}var pc=function(t){this.Br=t};function dc(t,e){if(e.document)return n=t.Br,r=e.document,i=!!e.hasCommittedMutations,t=Uo(n,r.name),n=Lo(r.updateTime),r=new js({mapValue:{fields:r.fields}}),new Xs(t,n,r,{hasCommittedMutations:!!i});var n,r;if(e.noDocument){var i=ni.Z(e.noDocument.path),o=wc(e.noDocument.readTime);return new Js(i,o,{hasCommittedMutations:!!e.hasCommittedMutations})}return e.unknownDocument?(o=ni.Z(e.unknownDocument.path),e=wc(e.unknownDocument.version),new $s(o,e)):Nr()}function yc(t,e,n){var r=vc(n),n=e.key.path.F().L();if(e instanceof Xs){var i={name:Vo(i=t.Br,(o=e).key),fields:o.rn().mapValue.fields,updateTime:ko(i,o.version.v())},o=e.hasCommittedMutations;return new Zc(null,null,i,o,r,n)}if(e instanceof Js){var i=e.key.path.L(),o=mc(e.version),s=e.hasCommittedMutations;return new Zc(null,new Jc(i,o),null,s,r,n)}return e instanceof $s?(s=e.key.path.L(),e=mc(e.version),new Zc(new $c(s,e),null,null,!0,r,n)):Nr()}function vc(t){return[(t=t.v()).seconds,t.nanoseconds]}function gc(t){return t=new Jr(t[0],t[1]),$r.V(t)}function mc(t){return t=t.v(),new Bc(t.seconds,t.nanoseconds)}function wc(t){return t=new Jr(t.seconds,t.nanoseconds),$r.V(t)}function bc(e,t){var n=(t.baseMutations||[]).map(function(t){return zo(e.Br,t)}),r=t.mutations.map(function(t){return zo(e.Br,t)}),i=Jr.fromMillis(t.localWriteTimeMs);return new Ua(t.batchId,i,n,r)}function Ic(t){var e=wc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?wc(t.lastLimboFreeSnapshotVersion):$r.min(),r=void 0!==t.query.documents?(Dr(1===(r=t.query).documents.length),lu(iu(qo(r.documents[0])))):Wo(t.query);return new bi(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Lr.fromBase64String(t.resumeToken))}function Ec(t,e){var n=mc(e.nt),r=mc(e.lastLimboFreeSnapshotVersion),i=(gi(e.target)?Ko:Ho)(t.Br,e.target),t=e.resumeToken.toBase64();return new eh(e.targetId,yi(e.target),n,t,e.sequenceNumber,r,i)}var Tc=(_c.Kr=function(t,e,n,r){return Dr(""!==t.uid),new _c(t.Zs()?t.uid:"",e,n,r)},_c.prototype.Qr=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Dc(t).rs({index:Qc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},_c.prototype.Wr=function(d,y,v,g){var m=this,w=Sc(d),b=Dc(d);return b.add({}).next(function(t){Dr("number"==typeof t);for(var e,n,r,i,o,s=new Ua(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return Go(e.Br,t)}),o=r.mutations.map(function(t){return Go(e.Br,t)}),new Qc(n,r.batchId,r.di.toMillis(),i,o)),a=[],c=new ki(function(t,e){return xr(t.B(),e.B())}),h=0,l=g;h<l.length;h++){var f=l[h],p=Yc.key(m.userId,f.key.path,t),c=c.add(f.key.path.F());a.push(b.put(u)),a.push(w.put(p,Yc.PLACEHOLDER))}return c.forEach(function(t){a.push(m.ki.jr(d,t))}),d.Ni(function(){m.Ur[t]=s.keys()}),Zu.On(a).next(function(){return s})})},_c.prototype.Gr=function(t,e){var n=this;return Dc(t).get(e).next(function(t){return t?(Dr(t.userId===n.userId),bc(n.serializer,t)):null})},_c.prototype.zr=function(t,e){var n=this;return this.Ur[e]?Zu.resolve(this.Ur[e]):this.Gr(t,e).next(function(t){return t?(t=t.keys(),n.Ur[e]=t):null})},_c.prototype.Hr=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Dc(t).rs({index:Qc.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Dr(e.batchId>=i),o=bc(r.serializer,e)),n.done()}).next(function(){return o})},_c.prototype.Yr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Dc(t).rs({index:Qc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},_c.prototype.Jr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Dc(t).ts(Qc.userMutationsIndex,n).next(function(t){return t.map(function(t){return bc(e.serializer,t)})})},_c.prototype.$i=function(o,s){var u=this,t=Yc.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return Sc(o).rs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=fc(i);if(r===u.userId&&s.path.isEqual(i))return Dc(o).get(t).next(function(t){if(!t)throw Nr();Dr(t.userId===u.userId),a.push(bc(u.serializer,t))});n.done()}).next(function(){return a})},_c.prototype.Ki=function(e,t){var s=this,u=new ki(xr),n=[];return t.forEach(function(o){var t=Yc.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=Sc(e).rs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=fc(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),Zu.On(n).next(function(){return s.Xr(e,u)})},_c.prototype.Hi=function(t,e){var o=this,s=e.path,u=s.length+1,e=Yc.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new ki(xr);return Sc(t).rs({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=fc(i);r===o.userId&&s.M(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.Xr(t,a)})},_c.prototype.Xr=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Dc(e).get(t).next(function(t){if(null===t)throw Nr();Dr(t.userId===n.userId),r.push(bc(n.serializer,t))}))}),Zu.On(i).next(function(){return r})},_c.prototype.Zr=function(e,n){var r=this;return Nc(e.eo,this.userId,n).next(function(t){return e.Ni(function(){r.no(n.batchId)}),Zu.forEach(t,function(t){return r.qr.so(e,t)})})},_c.prototype.no=function(t){delete this.Ur[t]},_c.prototype.io=function(e){var i=this;return this.Qr(e).next(function(t){if(!t)return Zu.resolve();var t=IDBKeyRange.lowerBound(Yc.prefixForUser(i.userId)),r=[];return Sc(e).rs({range:t},function(t,e,n){t[0]===i.userId?(t=fc(t[1]),r.push(t)):n.done()}).next(function(){Dr(0===r.length)})})},_c.prototype.ro=function(t,e){return Ac(t,this.userId,e)},_c.prototype.oo=function(t){var e=this;return Oc(t).get(this.userId).next(function(t){return t||new Wc(e.userId,-1,"")})},_c);function _c(t,e,n,r){this.userId=t,this.serializer=e,this.ki=n,this.qr=r,this.Ur={}}function Ac(t,o,e){var s=(e=Yc.prefixForPath(o,e.path))[1],e=IDBKeyRange.lowerBound(e),u=!1;return Sc(t).rs({range:e,ss:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Nc(t,e,n){var r=t.store(Qc.store),i=t.store(Yc.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.rs({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Dr(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],l=Yc.key(e,h.key.path,n.batchId);o.push(i.delete(l)),u.push(h.key)}return Zu.On(o).next(function(){return u})}function Dc(t){return Ih.Kn(t,Qc.store)}function Sc(t){return Ih.Kn(t,Yc.store)}function Oc(t){return Ih.Kn(t,Wc.store)}var xc,kc=(Rc.prototype.yi=function(t,e,n){return Vc(t).put(Uc(e),n)},Rc.prototype.pi=function(t,e){return t=Vc(t),e=Uc(e),t.delete(e)},Rc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.ao(e,t)})},Rc.prototype.bi=function(t,e){var n=this;return Vc(t).get(Uc(e)).next(function(t){return n.co(t)})},Rc.prototype.uo=function(t,e){var n=this;return Vc(t).get(Uc(e)).next(function(t){var e=n.co(t);return e?{ho:e,size:Mc(t)}:null})},Rc.prototype.getEntries=function(t,e){var n=this,r=Li;return this.lo(t,e,function(t,e){e=n.co(e),r=r.ot(t,e)}).next(function(){return r})},Rc.prototype._o=function(t,e){var r=this,i=Li,o=new _i(ni.D);return this.lo(t,e,function(t,e){var n=r.co(e);o=n?(i=i.ot(t,n),o.ot(t,Mc(e))):(i=i.ot(t,null),o.ot(t,0))}).next(function(){return{fo:i,do:o}})},Rc.prototype.lo=function(t,e,i){if(e.P())return Zu.resolve();var n=IDBKeyRange.bound(e.first().path.L(),e.last().path.L()),o=e._t(),s=o.It();return Vc(t).rs({range:n},function(t,e,n){for(var r=ni.Z(t);s&&ni.D(s,r)<0;)i(s,null),s=o.It();s&&s.isEqual(r)&&(i(s,e),s=o.At()?o.It():null),s?n.Xn(s.path.L()):n.done()}).next(function(){for(;s;)i(s,null),s=o.At()?o.It():null})},Rc.prototype.Qi=function(t,r,e){var n,i=this,o=Vi,s=r.path.length+1,u={};return e.isEqual($r.min())?(n=r.path.L(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.L(),e=vc(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=Zc.collectionReadTimeIndex),Vc(t).rs(u,function(t,e,n){t.length===s&&(e=dc(i.serializer,e),r.path.M(e.key.path)?e instanceof Xs&&mu(r,e)&&(o=o.ot(e.key,e)):n.done())}).next(function(){return o})},Rc.prototype.wo=function(t){return new Pc(this,!!t&&t.Eo)},Rc.prototype.To=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Rc.prototype.getMetadata=function(t){return Cc(t).get(th.key).next(function(t){return Dr(!!t),t})},Rc.prototype.ao=function(t,e){return Cc(t).put(th.key,e)},Rc.prototype.co=function(t){return!t||(t=dc(this.serializer,t))instanceof Js&&t.version.isEqual($r.min())?null:t},Rc),Pc=(n(Lc,xc=h),Lc.prototype.Di=function(i){var o=this,s=[],u=0,a=new ki(function(t,e){return xr(t.B(),e.B())});return this.Ri.forEach(function(t,e){var n,r=o.mo.get(t);e?(n=yc(o.Io.serializer,e,o.readTime),a=a.add(t.path.F()),e=Mc(n),u+=e-r,s.push(o.Io.yi(i,t,n))):(u-=r,o.Eo?(r=yc(o.Io.serializer,new Js(t,$r.min()),o.readTime),s.push(o.Io.yi(i,t,r))):s.push(o.Io.pi(i,t)))}),a.forEach(function(t){s.push(o.Io.ki.jr(i,t))}),s.push(this.Io.updateMetadata(i,u)),Zu.On(s)},Lc.prototype.vi=function(t,e){var n=this;return this.Io.uo(t,e).next(function(t){return null===t?(n.mo.set(e,0),null):(n.mo.set(e,t.size),t.ho)})},Lc.prototype.Si=function(t,e){var n=this;return this.Io._o(t,e).next(function(t){var e=t.fo;return t.do.forEach(function(t,e){n.mo.set(t,e)}),e})},Lc);function Lc(t,e){var n=this;return(n=xc.call(this)||this).Io=t,n.Eo=e,n.mo=new Xr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function Rc(t,e){this.serializer=t,this.ki=e}function Cc(t){return Ih.Kn(t,th.store)}function Vc(t){return Ih.Kn(t,Zc.store)}function Uc(t){return t.path.L()}function Mc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Nr();e=t.noDocument}return JSON.stringify(e).length}var qc=(Hc.prototype.jr=function(t,e){return this.Ao.add(e),Zu.resolve()},Hc.prototype.zi=function(t,e){return Zu.resolve(this.Ao.getEntries(e))},Hc),Fc=(Kc.prototype.add=function(t){var e=t.k(),n=t.F(),r=this.index[e]||new ki(Zr.D),t=!r.has(n);return this.index[e]=r.add(n),t},Kc.prototype.has=function(t){var e=t.k(),t=t.F();return(e=this.index[e])&&e.has(t)},Kc.prototype.getEntries=function(t){return(this.index[t]||new ki(Zr.D)).L()},Kc),jc=(zc.prototype.createOrUpgrade=function(e,n,t,r){var i=this;Dr(t<r&&0<=t&&r<=10);var o=new ca("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(Gc.store),(s=e).createObjectStore(Wc.store,{keyPath:Wc.keyPath}),s.createObjectStore(Qc.store,{keyPath:Qc.keyPath,autoIncrement:!0}).createIndex(Qc.userMutationsIndex,Qc.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Yc.store),oh(e),e.createObjectStore(Zc.store));var s,u=Zu.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(nh.store),s.deleteObjectStore(eh.store),s.deleteObjectStore(rh.store),oh(e)),u=u.next(function(){return t=o.store(rh.store),e=new rh(0,0,$r.min().v(),0),t.put(rh.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(Qc.store).ts().next(function(t){n.deleteObjectStore(Qc.store),n.createObjectStore(Qc.store,{keyPath:Qc.keyPath,autoIncrement:!0}).createIndex(Qc.userMutationsIndex,Qc.userMutationsKeyPath,{unique:!0});var e=r.store(Qc.store),t=t.map(function(t){return e.put(t)});return Zu.On(t)});var n,r})),u=u.next(function(){e.createObjectStore(sh.store,{keyPath:sh.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.removeAcknowledgedMutations(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore(th.store),i.addDocumentGlobal(o)})),t<7&&7<=r&&(u=u.next(function(){return i.ensureSequenceNumbers(o)})),t<8&&8<=r&&(u=u.next(function(){return i.createCollectionParentIndex(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Zc.store)).createIndex(Zc.readTimeIndex,Zc.readTimeIndexPath,{unique:!1}),t.createIndex(Zc.collectionReadTimeIndex,Zc.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.rewriteCanonicalIds(o)})),u},zc.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Zc.store).rs(function(t,e){n+=Mc(e)}).next(function(){var t=new th(n);return e.store(th.store).put(th.key,t)})},zc.prototype.removeAcknowledgedMutations=function(n){var r=this,t=n.store(Wc.store),i=n.store(Qc.store);return t.ts().next(function(t){return Zu.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.ts(Qc.userMutationsIndex,t).next(function(t){return Zu.forEach(t,function(t){return Dr(t.userId===e.userId),t=bc(r.serializer,t),Nc(n,e.userId,t).next(function(){})})})})})},zc.prototype.ensureSequenceNumbers=function(t){var o=t.store(nh.store),e=t.store(Zc.store);return t.store(rh.store).get(rh.key).next(function(r){var i=[];return e.rs(function(t,e){var n=new Zr(t),t=[0,hc(n)];i.push(o.get(t).next(function(t){return t?Zu.resolve():o.put(new nh(0,hc(n),r.highestListenSequenceNumber))}))}).next(function(){return Zu.On(i)})})},zc.prototype.createCollectionParentIndex=function(t,e){function r(t){if(i.add(t)){var e=t.k(),t=t.F();return n.put({collectionId:e,parent:hc(t)})}}t.createObjectStore(ih.store,{keyPath:ih.keyPath});var n=e.store(ih.store),i=new Fc;return e.store(Zc.store).rs({ss:!0},function(t,e){return r((t=new Zr(t)).F())}).next(function(){return e.store(Yc.store).rs({ss:!0},function(t,e){t[0];var n=t[1];return r((n=(t[2],fc(n))).F())})})},zc.prototype.rewriteCanonicalIds=function(t){var n=this,r=t.store(eh.store);return r.rs(function(t,e){return e=Ic(e),e=Ec(n.serializer,e),r.put(e)})},zc),Bc=function(t,e){this.seconds=t,this.nanoseconds=e},Gc=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function zc(t){this.serializer=t}function Kc(){this.index={}}function Hc(){this.Ao=new Fc}Gc.store="owner",Gc.key="owner";var Wc=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Wc.store="mutationQueues",Wc.keyPath="userId";var Qc=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Qc.store="mutations",Qc.keyPath="batchId",Qc.userMutationsIndex="userMutationsIndex",Qc.userMutationsKeyPath=["userId","batchId"];var Yc=(Xc.prefixForUser=function(t){return[t]},Xc.prefixForPath=function(t,e){return[t,hc(e)]},Xc.key=function(t,e,n){return[t,hc(e),n]},Xc);function Xc(){}Yc.store="documentMutations",Yc.PLACEHOLDER=new Yc;var Jc=function(t,e){this.path=t,this.readTime=e},$c=function(t,e){this.path=t,this.version=e},Zc=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Zc.store="remoteDocuments",Zc.readTimeIndex="readTimeIndex",Zc.readTimeIndexPath="readTime",Zc.collectionReadTimeIndex="collectionReadTimeIndex",Zc.collectionReadTimeIndexPath=["parentPath","readTime"];var th=function(t){this.byteSize=t};th.store="remoteDocumentGlobal",th.key="remoteDocumentGlobalKey";var eh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};eh.store="targets",eh.keyPath="targetId",eh.queryTargetsIndexName="queryTargetsIndex",eh.queryTargetsKeyPath=["canonicalId","targetId"];var nh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};nh.store="targetDocuments",nh.keyPath=["targetId","path"],nh.documentTargetsIndex="documentTargetsIndex",nh.documentTargetsKeyPath=["path","targetId"];var rh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};rh.key="targetGlobalKey",rh.store="targetGlobal";var ih=function(t,e){this.collectionId=t,this.parent=e};function oh(t){t.createObjectStore(nh.store,{keyPath:nh.keyPath}).createIndex(nh.documentTargetsIndex,nh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(eh.store,{keyPath:eh.keyPath}).createIndex(eh.queryTargetsIndexName,eh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(rh.store)}ih.store="collectionParents",ih.keyPath=["collectionId","parent"];var sh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};sh.store="clientMetadata",sh.keyPath="clientId";var uh=i(i(i([Wc.store,Qc.store,Yc.store,Zc.store,eh.store,Gc.store,rh.store,nh.store],[sh.store]),[th.store]),[ih.store]),ah=(ch.prototype.jr=function(t,e){var n=this;if(this.Ro.has(e))return Zu.resolve();var r=e.k(),i=e.F();return t.Ni(function(){n.Ro.add(e)}),i={collectionId:r,parent:hc(i)},hh(t).put(i)},ch.prototype.zi=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Pr(i),""],!1,!0);return hh(t).ts(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(fc(r.parent))}return o})},ch);function ch(){this.Ro=new Fc}function hh(t){return Ih.Kn(t,ih.store)}var lh=(dh.prototype.next=function(){return this.Po+=2,this.Po},dh.yo=function(){return new dh(0)},dh.Vo=function(){return new dh(-1)},dh),fh=(ph.prototype.po=function(n){var r=this;return this.bo(n).next(function(t){var e=new lh(t.highestTargetId);return t.highestTargetId=e.next(),r.vo(n,t).next(function(){return t.highestTargetId})})},ph.prototype.So=function(t){return this.bo(t).next(function(t){return $r.V(new Jr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},ph.prototype.Do=function(t){return this.bo(t).next(function(t){return t.highestListenSequenceNumber})},ph.prototype.Co=function(e,n,r){var i=this;return this.bo(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.v()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.vo(e,t)})},ph.prototype.No=function(e,n){var r=this;return this.xo(e,n).next(function(){return r.bo(e).next(function(t){return t.targetCount+=1,r.Fo(n,t),r.vo(e,t)})})},ph.prototype.Oo=function(t,e){return this.xo(t,e)},ph.prototype.ko=function(e,t){var n=this;return this.Mo(e,t.targetId).next(function(){return yh(e).delete(t.targetId)}).next(function(){return n.bo(e)}).next(function(t){return Dr(0<t.targetCount),--t.targetCount,n.vo(e,t)})},ph.prototype.Or=function(n,r,i){var o=this,s=0,u=[];return yh(n).rs(function(t,e){(e=Ic(e)).sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.ko(n,e)))}).next(function(){return Zu.On(u)}).next(function(){return s})},ph.prototype.Ce=function(t,n){return yh(t).rs(function(t,e){e=Ic(e),n(e)})},ph.prototype.bo=function(t){return vh(t).get(rh.key).next(function(t){return Dr(null!==t),t})},ph.prototype.vo=function(t,e){return vh(t).put(rh.key,e)},ph.prototype.xo=function(t,e){return yh(t).put(Ec(this.serializer,e))},ph.prototype.Fo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},ph.prototype.$o=function(t){return this.bo(t).next(function(t){return t.targetCount})},ph.prototype.Lo=function(t,r){var e=yi(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return yh(t).rs({range:e,index:eh.queryTargetsIndexName},function(t,e,n){e=Ic(e),vi(r,e.target)&&(i=e,n.done())}).next(function(){return i})},ph.prototype.Bo=function(n,t,r){var i=this,o=[],s=gh(n);return t.forEach(function(t){var e=hc(t.path);o.push(s.put(new nh(r,e))),o.push(i.qr.qo(n,r,t))}),Zu.On(o)},ph.prototype.Uo=function(n,t,r){var i=this,o=gh(n);return Zu.forEach(t,function(t){var e=hc(t.path);return Zu.On([o.delete([r,e]),i.qr.Ko(n,r,t)])})},ph.prototype.Mo=function(t,e){return t=gh(t),e=IDBKeyRange.bound([e],[e+1],!1,!0),t.delete(e)},ph.prototype.Qo=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=gh(t),r=qi();return t.rs({range:e,ss:!0},function(t,e,n){t=fc(t[1]),t=new ni(t),r=r.add(t)}).next(function(){return r})},ph.prototype.ro=function(t,e){var e=hc(e.path),e=IDBKeyRange.bound([e],[Pr(e)],!1,!0),i=0;return gh(t).rs({index:nh.documentTargetsIndex,ss:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},ph.prototype.Ue=function(t,e){return yh(t).get(e).next(function(t){return t?Ic(t):null})},ph);function ph(t,e){this.qr=t,this.serializer=e}function dh(t){this.Po=t}function yh(t){return Ih.Kn(t,eh.store)}function vh(t){return Ih.Kn(t,rh.store)}function gh(t){return Ih.Kn(t,nh.store)}var mh,wh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",bh=(n(Th,mh=ge),Th),Ih=(Eh.Kn=function(t,e){if(t instanceof bh)return ta.Kn(t.eo,e);throw Nr()},Eh.prototype.start=function(){var e=this;return this.ra().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new mr(gr.FAILED_PRECONDITION,wh);return e.oa(),e.aa(),e.ca(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.sa.Do(t)})}).then(function(t){e.zo=new Ba(t,e.jo)}).then(function(){e.Ho=!0}).catch(function(t){return e.na&&e.na.close(),Promise.reject(t)})},Eh.prototype.ua=function(n){var t=this;return this.ta=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.br?[2,n(e)]:[2]})})},n(this.isPrimary)},Eh.prototype.ha=function(n){var t=this;this.na.jn(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Eh.prototype.la=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fn.ws(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.br?[4,this.ra()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Eh.prototype.ra=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Ah(e).put(new sh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n._a(e).next(function(t){t||(n.isPrimary=!1,n.fn.Cs(function(){return n.ta(!1)}))})}).next(function(){return n.fa(e)}).next(function(t){return n.isPrimary&&!t?n.da(e).next(function(){return!1}):!!t&&n.wa(e).next(function(){return!0})})}).catch(function(t){if(aa(t))return Er("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Er("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.fn.Cs(function(){return n.ta(t)}),n.isPrimary=t})},Eh.prototype._a=function(t){var e=this;return _h(t).get(Gc.key).next(function(t){return Zu.resolve(e.Ea(t))})},Eh.prototype.Ta=function(t){return Ah(t).delete(this.clientId)},Eh.prototype.Ia=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.ma(this.Zo,18e5)?[3,2]:(this.Zo=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Eh.Kn(t,sh.store);return r.ts().next(function(t){var e=o.Aa(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Zu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.ia)for(n=0,r=e;n<r.length;n++)i=r[n],this.ia.removeItem(this.Ra(i.clientId));t.label=2;case 2:return[2]}})})},Eh.prototype.ca=function(){var t=this;this.Xo=this.fn.yn("client_metadata_refresh",4e3,function(){return t.ra().then(function(){return t.Ia()}).then(function(){return t.ca()})})},Eh.prototype.Ea=function(t){return!!t&&t.ownerId===this.clientId},Eh.prototype.fa=function(e){var r=this;return this.Go?Zu.resolve(!0):_h(e).get(Gc.key).next(function(t){if(null!==t&&r.ma(t.leaseTimestampMs,5e3)&&!r.Pa(t.ownerId)){if(r.Ea(t)&&r.networkEnabled)return!0;if(!r.Ea(t)){if(!t.allowTabSynchronization)throw new mr(gr.FAILED_PRECONDITION,wh);return!1}}return!(!r.networkEnabled||!r.inForeground)||Ah(e).ts().next(function(t){return void 0===r.Aa(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&Er("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Eh.prototype.ga=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.Ho=!1,this.ya(),this.Xo&&(this.Xo.cancel(),this.Xo=null),this.Va(),this.pa(),[4,this.na.runTransaction("shutdown","readwrite",[Gc.store,sh.store],function(t){var e=new bh(t,Ba.ir);return n.da(e).next(function(){return n.Ta(e)})})];case 1:return t.sent(),this.na.close(),this.ba(),[2]}})})},Eh.prototype.Aa=function(t,e){var n=this;return t.filter(function(t){return n.ma(t.updateTimeMs,e)&&!n.Pa(t.clientId)})},Eh.prototype.va=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return Ah(t).ts().next(function(t){return e.Aa(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(Eh.prototype,"br",{get:function(){return this.Ho},enumerable:!1,configurable:!0}),Eh.prototype.Sa=function(t){return Tc.Kr(t,this.serializer,this.ki,this.qr)},Eh.prototype.Da=function(){return this.sa},Eh.prototype.Ca=function(){return this.Fi},Eh.prototype.Na=function(){return this.ki},Eh.prototype.runTransaction=function(e,n,r){var i=this;Er("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.na.runTransaction(e,t,uh,function(t){return o=new bh(t,i.zo?i.zo.next():Ba.ir),"readwrite-primary"===n?i._a(o).next(function(t){return!!t||i.fa(o)}).next(function(t){if(!t)throw Tr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.fn.Cs(function(){return i.ta(!1)}),new mr(gr.FAILED_PRECONDITION,qa);return r(o)}).next(function(t){return i.wa(o).next(function(){return t})}):i.xa(o).next(function(){return r(o)})}).then(function(t){return o.xi(),t})},Eh.prototype.xa=function(t){var e=this;return _h(t).get(Gc.key).next(function(t){if(null!==t&&e.ma(t.leaseTimestampMs,5e3)&&!e.Pa(t.ownerId)&&!e.Ea(t)&&!(e.Go||e.allowTabSynchronization&&t.allowTabSynchronization))throw new mr(gr.FAILED_PRECONDITION,wh)})},Eh.prototype.wa=function(t){var e=new Gc(this.clientId,this.allowTabSynchronization,Date.now());return _h(t).put(Gc.key,e)},Eh.Ln=function(){return ta.Ln()},Eh.prototype.da=function(t){var e=this,n=_h(t);return n.get(Gc.key).next(function(t){return e.Ea(t)?(Er("IndexedDbPersistence","Releasing primary lease."),n.delete(Gc.key)):Zu.resolve()})},Eh.prototype.ma=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Tr("Detected an update time that is in the future: "+t+" > "+n),1))},Eh.prototype.oa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Jo=function(){t.fn.ws(function(){return t.inForeground="visible"===t.document.visibilityState,t.ra()})},this.document.addEventListener("visibilitychange",this.Jo),this.inForeground="visible"===this.document.visibilityState)},Eh.prototype.Va=function(){this.Jo&&(this.document.removeEventListener("visibilitychange",this.Jo),this.Jo=null)},Eh.prototype.aa=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Yo=function(){e.ya(),e.fn.ws(function(){return e.ga()})},this.window.addEventListener("unload",this.Yo))},Eh.prototype.pa=function(){this.Yo&&(this.window.removeEventListener("unload",this.Yo),this.Yo=null)},Eh.prototype.Pa=function(t){try{var e=null!==(null===(e=this.ia)||void 0===e?void 0:e.getItem(this.Ra(t)));return Er("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Tr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Eh.prototype.ya=function(){if(this.ia)try{this.ia.setItem(this.Ra(this.clientId),String(Date.now()))}catch(t){Tr("Failed to set zombie client id.",t)}},Eh.prototype.ba=function(){if(this.ia)try{this.ia.removeItem(this.Ra(this.clientId))}catch(t){}},Eh.prototype.Ra=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Eh);function Eh(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.fn=i,this.window=o,this.document=s,this.jo=a,this.Go=c,this.zo=null,this.Ho=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Yo=null,this.inForeground=!1,this.Jo=null,this.Xo=null,this.Zo=Number.NEGATIVE_INFINITY,this.ta=function(t){return Promise.resolve()},!Eh.Ln())throw new mr(gr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.qr=new Nh(this,r),this.ea=e+"main",this.serializer=new pc(u),this.na=new ta(this.ea,10,new jc(this.serializer)),this.sa=new fh(this.qr,this.serializer),this.ki=new ah,this.Fi=(e=this.serializer,u=this.ki,new kc(e,u)),this.window&&this.window.localStorage?this.ia=this.window.localStorage:(this.ia=null,!1===c&&Tr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Th(t,e){var n=this;return(n=mh.call(this)||this).eo=t,n.Wo=e,n}function _h(t){return Ih.Kn(t,Gc.store)}function Ah(t){return Ih.Kn(t,sh.store)}var Nh=(Dh.prototype.Cr=function(t){var n=this.Fa(t);return this.db.Da().$o(t).next(function(e){return n.next(function(t){return e+t})})},Dh.prototype.Fa=function(t){var e=0;return this.Fr(t,function(t){e++}).next(function(){return e})},Dh.prototype.Ce=function(t,e){return this.db.Da().Ce(t,e)},Dh.prototype.Fr=function(t,n){return this.Oa(t,function(t,e){return n(e)})},Dh.prototype.qo=function(t,e,n){return Sh(t,n)},Dh.prototype.Ko=function(t,e,n){return Sh(t,n)},Dh.prototype.Or=function(t,e,n){return this.db.Da().Or(t,e,n)},Dh.prototype.so=Sh,Dh.prototype.ka=function(t,e){return r=e,i=!1,Oc(n=t).os(function(t){return Ac(n,t,r).next(function(t){return t&&(i=!0),Zu.resolve(!t)})}).next(function(){return i});var n,r,i},Dh.prototype.kr=function(n,r){var i=this,o=this.db.Ca().wo(),s=[],u=0;return this.Oa(n,function(e,t){t<=r&&(t=i.ka(n,e).next(function(t){if(!t)return u++,o.bi(n,e).next(function(){return o.pi(e),gh(n).delete([0,hc(e.path)])})}),s.push(t))}).next(function(){return Zu.On(s)}).next(function(){return o.apply(n)}).next(function(){return u})},Dh.prototype.removeTarget=function(t,e){return e=e.st(t.Wo),this.db.Da().Oo(t,e)},Dh.prototype.Ma=Sh,Dh.prototype.Oa=function(t,r){var i,t=gh(t),o=Ba.ir;return t.rs({index:nh.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==Ba.ir&&r(new ni(fc(i)),o),o=e,i=t):o=Ba.ir}).next(function(){o!==Ba.ir&&r(new ni(fc(i)),o)})},Dh.prototype.$r=function(t){return this.db.Ca().To(t)},Dh);function Dh(t,e){this.db=t,this.gr=new uc(this,e)}function Sh(t,e){return gh(t).put((t=t.Wo,new nh(0,hc(e.path),t)))}function Oh(t,e){var n=t.projectId;return t.I||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var xh=(kh.prototype.vr=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Mr(t,n.La)})},kh);function kh(t,e,n){this.persistence=t,this.$a=e,this.La=new _i(xr),this.Ba=new Xr(yi,vi),this.qa=$r.min(),this.Oi=t.Sa(n),this.Ua=t.Ca(),this.sa=t.Da(),this.Ka=new Fa(this.Ua,this.Oi,this.persistence.Na()),this.$a.Qa(this.Ka)}function Ph(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Oi,m=e.Ka,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Oi.Jr(v).next(function(t){return g=t,n=e.persistence.Sa(o),m=new Fa(e.Ua,n,e.persistence.Na()),n.Jr(v)}).next(function(t){for(var e=[],n=[],r=qi(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var p=0,d=f.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.qi(v,r).next(function(t){return{Wa:t,ja:e,Ga:n}})})})];case 1:return r=t.sent(),[2,(e.Oi=n,e.Ka=m,e.$a.Qa(e.Ka),r)]}})})}function Lh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.sa.So(t)})}function Rh(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.sa.Lo(e,r).next(function(t){return t?(n=t,Zu.resolve(n)):i.sa.po(e).next(function(t){return n=new bi(r,t,0,e.Wo),i.sa.No(e,n).next(function(){return n})})})}).then(function(t){var e=i.La.get(t.targetId);return(null===e||0<t.nt.u(e.nt))&&(i.La=i.La.ot(t.targetId,t),i.Ba.set(r,t.targetId)),t})}function Ch(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).La.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.qr.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!aa(r=t.sent()))throw r;return Er("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.La=e.La.remove(o),e.Ba.delete(n.target),[2]}})})}function Vh(t,o,s){var u=t,a=$r.min(),c=qi();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=lu(o),(void 0!==(t=(i=t).Ba.get(r))?Zu.resolve(i.La.get(t)):i.sa.Lo(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.sa.Qo(e,t.targetId).next(function(t){c=t})}).next(function(){return u.$a.Qi(e,o,s?a:$r.min(),s?c:qi())}).next(function(t){return{documents:t,za:c}});var t,n,r,i})}function Uh(t,e){var n=t,r=n.sa;return(t=n.La.get(e))?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Ue(t,e).next(function(t){return t?t.target:null})})}function Mh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==gr.FAILED_PRECONDITION||e.message!==qa)throw e;return Er("LocalStore","Unexpectedly lost primary lease"),[2]})})}function qh(t,e,n,r,i){var o=this;this.Bc=t,this.qc=e,this.cs=n,this.Uc={},this.Kc=[],this.Qc=new Map,this.Wc=new Set,this.jc=[],this.Gc=i,this.Gc.zc(function(t){n.ws(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return sl(this)?(Er("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Wc.add(4),[4,Zh(e)];case 1:return t.sent(),e.Hc.set("Unknown"),e.Wc.delete(4),[4,$h(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Hc=new Hh(n,r)}var Fh,jh,Bh,me=(Jh.prototype.ec=function(){return 1===this.state||2===this.state||4===this.state},Jh.prototype.nc=function(){return 2===this.state},Jh.prototype.start=function(){3!==this.state?this.auth():this.sc()},Jh.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ec()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Jh.prototype.ic=function(){this.state=0,this.ys.reset()},Jh.prototype.rc=function(){var t=this;this.nc()&&null===this.tc&&(this.tc=this.fn.yn(this.Ya,6e4,function(){return t.oc()}))},Jh.prototype.ac=function(t){this.cc(),this.stream.send(t)},Jh.prototype.oc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.nc()?[2,this.close(0)]:[2]})})},Jh.prototype.cc=function(){this.tc&&(this.tc.cancel(),this.tc=null)},Jh.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.cc(),this.ys.cancel(),this.Za++,3!==e?this.ys.reset():n&&n.code===gr.RESOURCE_EXHAUSTED?(Tr(n.toString()),Tr("Using maximum backoff delay to prevent overloading the backend."),this.ys.Rn()):n&&n.code===gr.UNAUTHENTICATED&&this.Xa.ri(),null!==this.stream&&(this.uc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.hc(n)];case 1:return t.sent(),[2]}})})},Jh.prototype.uc=function(){},Jh.prototype.auth=function(){var n=this;this.state=1;var t=this.lc(this.Za),e=this.Za;this.Xa.getToken().then(function(t){n.Za===e&&n._c(t)},function(e){t(function(){var t=new mr(gr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.fc(t)})})},Jh.prototype._c=function(t){var e=this,n=this.lc(this.Za);this.stream=this.dc(t),this.stream.wc(function(){n(function(){return e.state=2,e.listener.wc()})}),this.stream.hc(function(t){n(function(){return e.fc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Jh.prototype.sc=function(){var t=this;this.state=4,this.ys.Pn(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Jh.prototype.fc=function(t){return Er("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Jh.prototype.lc=function(e){var n=this;return function(t){n.fn.ws(function(){return n.Za===e?t():(Er("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Jh),Gh=(n(Xh,Bh=me),Xh.prototype.dc=function(t){return this.Ja.Ec("Listen",t)},Xh.prototype.onMessage=function(t){this.ys.reset();var e,n=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(i=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:Nr(),r=e.targetChange.targetIds||[],i=(o=e.targetChange.resumeToken,t.Ke?(Dr(void 0===o||"string"==typeof o),Lr.fromBase64String(o||"")):(Dr(void 0===o||o instanceof Uint8Array),Lr.fromUint8Array(o||new Uint8Array))),o=e.targetChange.cause,s=o&&(o=void 0===(s=o).code?gr.UNKNOWN:Ti(s.code),new mr(o,s.message||"")),r=new Qi(n,r,i,s||null)}else if("documentChange"in e){e.documentChange,(a=e.documentChange).document,a.document.name,a.document.updateTime;var i=Uo(t,a.document.name),u=Lo(a.document.updateTime),s=new js({mapValue:{fields:a.document.fields}}),u=new Xs(i,u,s,{}),s=a.targetIds||[],a=a.removedTargetIds||[];r=new Hi(s,a,u.key,u)}else if("documentDelete"in e){e.documentDelete,(a=e.documentDelete).document;var u=Uo(t,a.document),c=a.readTime?Lo(a.readTime):$r.min(),c=new Js(u,c),a=a.removedTargetIds||[];r=new Hi([],a,c.key,c)}else if("documentRemove"in e){e.documentRemove,(c=e.documentRemove).document;var h=Uo(t,c.document),c=c.removedTargetIds||[];r=new Hi([],c,h,null)}else{if(!("filter"in e))return Nr();e.filter,(h=e.filter).targetId,e=new mi(e=h.count||0),h=h.targetId,r=new Wi(h,e)}return r}(this.serializer,t),t=!("targetChange"in(e=t))||(e=e.targetChange).targetIds&&e.targetIds.length||!e.readTime?$r.min():Lo(e.readTime);return this.listener.Tc(n,t)},Xh.prototype.Ic=function(t){var e,n,r,i,o={};o.database=Fo(this.serializer),o.addTarget=(e=this.serializer,(r=gi(r=(n=t).target)?{documents:Ko(e,r)}:{query:Ho(e,r)}).targetId=n.targetId,0<n.resumeToken.o()&&(r.resumeToken=Po(e,n.resumeToken)),r),(t=(this.serializer,i=t,null==(t=function(){switch(i.et){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Nr()}}())?null:{"goog-listen-tags":t}))&&(o.labels=t),this.ac(o)},Xh.prototype.mc=function(t){var e={};e.database=Fo(this.serializer),e.removeTarget=t,this.ac(e)},Xh),zh=(n(Yh,jh=me),Object.defineProperty(Yh.prototype,"Rc",{get:function(){return this.Ac},enumerable:!1,configurable:!0}),Yh.prototype.start=function(){this.Ac=!1,this.lastStreamToken=void 0,jh.prototype.start.call(this)},Yh.prototype.uc=function(){this.Ac&&this.Pc([])},Yh.prototype.dc=function(t){return this.Ja.Ec("Write",t)},Yh.prototype.onMessage=function(t){if(Dr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Ac){this.ys.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Dr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?Lo(e.updateTime):Lo(n)).isEqual($r.min())&&(t=Lo(n)),n=null,e.transformResults&&0<e.transformResults.length&&(n=e.transformResults),new ws(t,n);var e,n})):[]),n=Lo(t.commitTime);return this.listener.gc(n,e)}var r;return Dr(!t.writeResults||0===t.writeResults.length),this.Ac=!0,this.listener.yc()},Yh.prototype.Vc=function(){var t={};t.database=Fo(this.serializer),this.ac(t)},Yh.prototype.Pc=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return Go(e.serializer,t)})};this.ac(t)},Yh),Kh=(n(Qh,Fh=function(){}),Qh.prototype.vc=function(){if(this.bc)throw new mr(gr.FAILED_PRECONDITION,"The client has already been terminated.")},Qh.prototype.Sc=function(e,n,r){var i=this;return this.vc(),this.credentials.getToken().then(function(t){return i.Ja.Sc(e,n,r,t)}).catch(function(t){throw t.code===gr.UNAUTHENTICATED&&i.credentials.ri(),t})},Qh.prototype.Dc=function(e,n,r){var i=this;return this.vc(),this.credentials.getToken().then(function(t){return i.Ja.Dc(e,n,r,t)}).catch(function(t){throw t.code===gr.UNAUTHENTICATED&&i.credentials.ri(),t})},Qh.prototype.terminate=function(){this.bc=!1},Qh),Hh=(Wh.prototype.Oc=function(){var t=this;0===this.Nc&&(this.kc("Unknown"),this.xc=this.cs.yn("online_state_timeout",1e4,function(){return t.xc=null,t.Mc("Backend didn't respond within 10 seconds."),t.kc("Offline"),Promise.resolve()}))},Wh.prototype.$c=function(t){"Online"===this.state?this.kc("Unknown"):(this.Nc++,1<=this.Nc&&(this.Lc(),this.Mc("Connection failed 1 times. Most recent error: "+t.toString()),this.kc("Offline")))},Wh.prototype.set=function(t){this.Lc(),this.Nc=0,"Online"===t&&(this.Fc=!1),this.kc(t)},Wh.prototype.kc=function(t){t!==this.state&&(this.state=t,this.Cc(t))},Wh.prototype.Mc=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.Fc?(Tr(t),this.Fc=!1):Er("OnlineStateTracker",t)},Wh.prototype.Lc=function(){null!==this.xc&&(this.xc.cancel(),this.xc=null)},Wh);function Wh(t,e){this.cs=t,this.Cc=e,this.state="Unknown",this.Nc=0,this.xc=null,this.Fc=!0}function Qh(t,e,n){var r=this;return(r=Fh.call(this)||this).credentials=t,r.Ja=e,r.serializer=n,r.bc=!1,r}function Yh(t,e,n,r,i){var o=this;return(o=jh.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Ac=!1,o}function Xh(t,e,n,r,i){var o=this;return(o=Bh.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Jh(t,e,n,r,i,o){this.fn=t,this.Ya=n,this.Ja=r,this.Xa=i,this.listener=o,this.state=0,this.Za=0,this.tc=null,this.stream=null,this.ys=new $u(t,e)}function $h(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!sl(r))return[3,4];e=0,n=r.jc,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Zh(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.jc,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function tl(t,e){t.Qc.has(e.targetId)||(t.Qc.set(e.targetId,e),ol(t)?il(t):dl(t).nc()&&nl(t,e))}function el(t,e){var n=t,t=dl(n);n.Qc.delete(e),t.nc()&&rl(n,e),0===n.Qc.size&&(t.nc()?t.rc():sl(n)&&n.Hc.set("Unknown"))}function nl(t,e){t.Yc.me(e.targetId),dl(t).Ic(e)}function rl(t,e){t.Yc.me(e),dl(t).mc(e)}function il(e){e.Yc=new Xi({qe:function(t){return e.Uc.qe(t)},Ue:function(t){return e.Qc.get(t)||null}}),dl(e).start(),e.Hc.Oc()}function ol(t){return sl(t)&&!dl(t).ec()&&0<t.Qc.size}function sl(t){return 0===t.Wc.size}function ul(t){t.Yc=void 0}function al(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!aa(r))throw r;return n.Wc.add(1),[4,Zh(n)];case 1:return t.sent(),n.Hc.set("Offline"),i=i||function(){return Lh(n.Bc)},n.cs.Cs(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Er("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Wc.delete(1),[4,$h(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function cl(e,n){return n().catch(function(t){return al(e,t,n)})}function hl(c){return y(this,void 0,void 0,function(){var o,s,u,a;return v(this,function(t){switch(t.label){case 0:s=yl(o=c),u=0<o.Kc.length?o.Kc[o.Kc.length-1].batchId:-1,t.label=1;case 1:if(!(sl(o)&&o.Kc.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(n=o.Bc,r=u,(i=n).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===r&&(r=-1),i.Oi.Hr(t,r)}))];case 3:return null===(a=t.sent())?(0===o.Kc.length&&s.rc(),[3,7]):(u=a.batchId,e=a,(n=o).Kc.push(e),(n=yl(n)).nc()&&n.Rc&&n.Pc(e.mutations),[3,6]);case 4:return a=t.sent(),[4,al(o,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return ll(o)&&fl(o),[2]}var e,n,r,i})})}function ll(t){return sl(t)&&!yl(t).ec()&&0<t.Kc.length}function fl(t){yl(t).start()}function pl(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Wc.delete(2),[4,$h(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Wc.add(2),[4,Zh(e)]);case 3:t.sent(),e.Hc.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function dl(n){var t,e,r,i=this;return n.eu||(n.eu=(t=n.qc,e=n.cs,r={wc:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.Qc.forEach(function(t,e){nl(n,t)}),[2]})})}.bind(null,n),hc:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return ul(e),ol(e)?(e.Hc.$c(n),il(e)):e.Hc.set("Unknown"),[2]})})}.bind(null,n),Tc:function(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Hc.set("Online"),!(u instanceof Qi&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Qc.has(i)?[4,o.Uc.Jc(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Qc.delete(i),o.Yc.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Er("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,al(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof Hi?s.Yc.be(u):u instanceof Wi?s.Yc.Oe(u):s.Yc.De(u),a.isEqual($r.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,Lh(s.Bc)];case 8:return o=t.sent(),0<=a.u(o)?[4,(i=a,(e=(r=s).Yc.$e(i)).zt.forEach(function(t,e){var n;0<t.resumeToken.o()&&(n=r.Qc.get(e))&&r.Qc.set(e,n.it(t.resumeToken,i))}),e.Ht.forEach(function(t){var e=r.Qc.get(t);e&&(r.Qc.set(t,e.it(Lr.h,e.nt)),rl(r,t),e=new bi(e.target,t,1,e.sequenceNumber),nl(r,e))}),r.Uc.Xc(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Er("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,al(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}.bind(null,n)},t.vc(),new Gh(e,t.Ja,t.credentials,t.serializer,r)),n.jc.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.eu.ic(),ol(n)?il(n):n.Hc.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.eu.stop()];case 2:t.sent(),ul(n),t.label=3;case 3:return[2]}})})})),n.eu}function yl(n){var t,e,r,i=this;return n.nu||(n.nu=(t=n.qc,e=n.cs,r={wc:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return yl(e).Vc(),[2]})})}.bind(null,n),hc:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&yl(e).Rc?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return Ei(n=i.code)&&n!==gr.ABORTED?(e=r.Kc.shift(),yl(r).ic(),[4,cl(r,function(){return r.Uc.tu(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,hl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return ll(e)&&fl(e),[2]}})})}.bind(null,n),yc:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=yl(o),n=0,r=o.Kc;n<r.length;n++)i=r[n],e.Pc(i.mutations);return[2]})})}.bind(null,n),gc:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Kc.shift(),n=Ma.from(e,i,o),[4,cl(r,function(){return r.Uc.Zc(n)})];case 1:return t.sent(),[4,hl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.vc(),new zh(e,t.Ja,t.credentials,t.serializer,r)),n.jc.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.nu.ic(),[4,hl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.nu.stop()];case 3:t.sent(),0<n.Kc.length&&(Er("RemoteStore","Stopping write stream with "+n.Kc.length+" pending writes"),n.Kc=[]),t.label=4;case 4:return[2]}})})})),n.nu}var vl=(wl.prototype.P=function(){return this.su.P()},wl.prototype.qo=function(t,e){e=new gl(t,e),this.su=this.su.add(e),this.ru=this.ru.add(e)},wl.prototype.au=function(t,e){var n=this;t.forEach(function(t){return n.qo(t,e)})},wl.prototype.Ko=function(t,e){this.cu(new gl(t,e))},wl.prototype.uu=function(t,e){var n=this;t.forEach(function(t){return n.Ko(t,e)})},wl.prototype.hu=function(t){var e=this,n=new ni(new Zr([])),r=new gl(n,t),t=new gl(n,t+1),i=[];return this.ru.xt([r,t],function(t){e.cu(t),i.push(t.key)}),i},wl.prototype.lu=function(){var e=this;this.su.forEach(function(t){return e.cu(t)})},wl.prototype.cu=function(t){this.su=this.su.delete(t),this.ru=this.ru.delete(t)},wl.prototype._u=function(t){var e=new ni(new Zr([])),n=new gl(e,t),t=new gl(e,t+1),r=qi();return this.ru.xt([n,t],function(t){r=r.add(t.key)}),r},wl.prototype.ro=function(t){var e=new gl(t,0);return null!==(e=this.su.Ot(e))&&t.isEqual(e.key)},wl),gl=(ml.iu=function(t,e){return ni.D(t.key,e.key)||xr(t.fu,e.fu)},ml.ou=function(t,e){return xr(t.fu,e.fu)||ni.D(t.key,e.key)},ml);function ml(t,e){this.key=t,this.fu=e}function wl(){this.su=new ki(gl.iu),this.ru=new ki(gl.ou)}function bl(t,e){return"firestore_clients_"+t+"_"+e}function Il(t,e,n){return n="firestore_mutations_"+t+"_"+n,e.Zs()&&(n+="_"+e.uid),n}function El(t,e){return"firestore_targets_"+t+"_"+e}var Tl=(zl.du=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new mr(r.error.code,r.error.message)),i?new zl(t,e,r.state,o):(Tr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},zl.prototype.wu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},zl),_l=(Gl.du=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new mr(n.error.code,n.error.message)),r?new Gl(t,n.state,i):(Tr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Gl.prototype.wu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Gl),Al=(Bl.du=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Fi,o=0;r&&o<n.activeTargetIds.length;++o)r=fi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Bl(t,i):(Tr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Bl),Nl=(jl.du=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new jl(e.clientId,e.onlineState):(Tr("SharedClientState","Failed to parse online state: "+t),null)},jl),Dl=(Fl.prototype.Eu=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Fl.prototype.Tu=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Fl.prototype.wu=function(){var t={activeTargetIds:this.activeTargetIds.L(),updateTimeMs:Date.now()};return JSON.stringify(t)},Fl),Sl=(ql.Ln=function(t){return!(!t||!t.localStorage)},ql.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.mu.va()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Iu&&(i=this.getItem(bl(this.persistenceKey,r)))&&(o=Al.du(r,i))&&(this.Pu=this.Pu.ot(o.clientId,o));for(this.Du(),(s=this.storage.getItem(this.Su))&&(u=this.Cu(s))&&this.Nu(u),a=0,c=this.gu;a<c.length;a++)h=c[a],this.Ru(h);return this.gu=[],this.window.addEventListener("unload",function(){return l.ga()}),this.br=!0,[2]}})})},ql.prototype.sr=function(t){this.setItem(this.Vu,JSON.stringify(t))},ql.prototype.xu=function(){return this.Fu(this.Pu)},ql.prototype.Ou=function(n){var r=!1;return this.Pu.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},ql.prototype.ku=function(t){this.Mu(t,"pending")},ql.prototype.$u=function(t,e,n){this.Mu(t,e,n),this.Lu(t)},ql.prototype.Bu=function(t){var e,n="not-current";return this.Ou(t)&&(!(e=this.storage.getItem(El(this.persistenceKey,t)))||(e=_l.du(t,e))&&(n=e.state)),this.qu.Eu(t),this.Du(),n},ql.prototype.Uu=function(t){this.qu.Tu(t),this.Du()},ql.prototype.Ku=function(t){return this.qu.activeTargetIds.has(t)},ql.prototype.Qu=function(t){this.removeItem(El(this.persistenceKey,t))},ql.prototype.Wu=function(t,e,n){this.ju(t,e,n)},ql.prototype.Gu=function(t,e,n){var r=this;e.forEach(function(t){r.Lu(t)}),this.currentUser=t,n.forEach(function(t){r.ku(t)})},ql.prototype.zu=function(t){this.Hu(t)},ql.prototype.ga=function(){this.br&&(this.window.removeEventListener("storage",this.Au),this.removeItem(this.yu),this.br=!1)},ql.prototype.getItem=function(t){var e=this.storage.getItem(t);return Er("SharedClientState","READ",t,e),e},ql.prototype.setItem=function(t,e){Er("SharedClientState","SET",t,e),this.storage.setItem(t,e)},ql.prototype.removeItem=function(t){Er("SharedClientState","REMOVE",t),this.storage.removeItem(t)},ql.prototype.Ru=function(t){var e=this,s=t;s.storageArea===this.storage&&(Er("SharedClientState","EVENT",s.key,s.newValue),s.key!==this.yu?this.fn.Cs(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){if(this.br){if(null!==s.key)if(this.pu.test(s.key)){if(null==s.newValue)return e=this.Yu(s.key),[2,this.Ju(e,null)];if(e=this.Xu(s.key,s.newValue))return[2,this.Ju(e.clientId,e)]}else if(this.bu.test(s.key)){if(null!==s.newValue&&(n=this.Zu(s.key,s.newValue)))return[2,this.th(n)]}else if(this.vu.test(s.key)){if(null!==s.newValue&&(r=this.eh(s.key,s.newValue)))return[2,this.nh(r)]}else if(s.key===this.Su){if(null!==s.newValue&&(i=this.Cu(s.newValue)))return[2,this.Nu(i)]}else s.key===this.Vu&&(o=function(t){var e=Ba.ir;if(null!=t)try{var n=JSON.parse(t);Dr("number"==typeof n),e=n}catch(t){Tr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Ba.ir&&this.tr(o)}else this.gu.push(s);return[2]})})}):Tr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(ql.prototype,"qu",{get:function(){return this.Pu.get(this.Iu)},enumerable:!1,configurable:!0}),ql.prototype.Du=function(){this.setItem(this.yu,this.qu.wu())},ql.prototype.Mu=function(t,e,n){n=new Tl(this.currentUser,t,e,n),t=Il(this.persistenceKey,this.currentUser,t),this.setItem(t,n.wu())},ql.prototype.Lu=function(t){t=Il(this.persistenceKey,this.currentUser,t),this.removeItem(t)},ql.prototype.Hu=function(t){t={clientId:this.Iu,onlineState:t},this.storage.setItem(this.Su,JSON.stringify(t))},ql.prototype.ju=function(t,e,n){var r=El(this.persistenceKey,t),n=new _l(t,e,n);this.setItem(r,n.wu())},ql.prototype.Yu=function(t){return(t=this.pu.exec(t))?t[1]:null},ql.prototype.Xu=function(t,e){return t=this.Yu(t),Al.du(t,e)},ql.prototype.Zu=function(t,e){var n=this.bu.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Tl.du(new Oa(n),t,e)},ql.prototype.eh=function(t,e){return t=this.vu.exec(t),t=Number(t[1]),_l.du(t,e)},ql.prototype.Cu=function(t){return Nl.du(t)},ql.prototype.th=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.mu.sh(e.batchId,e.state,e.error)]:(Er("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},ql.prototype.nh=function(t){return this.mu.ih(t.targetId,t.state,t.error)},ql.prototype.Ju=function(t,e){var n=this,r=e?this.Pu.ot(t,e):this.Pu.remove(t),i=this.Fu(this.Pu),o=this.Fu(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.mu.rh(s,u).then(function(){n.Pu=r})},ql.prototype.Nu=function(t){this.Pu.get(t.clientId)&&this.Cc(t.onlineState)},ql.prototype.Fu=function(t){var n=Fi;return t.forEach(function(t,e){n=n.kt(e.activeTargetIds)}),n},ql),Ol=(Ml.prototype.ku=function(t){},Ml.prototype.$u=function(t,e,n){},Ml.prototype.Bu=function(t){return this.oh.Eu(t),this.ah[t]||"not-current"},Ml.prototype.Wu=function(t,e,n){this.ah[t]=e},Ml.prototype.Uu=function(t){this.oh.Tu(t)},Ml.prototype.Ku=function(t){return this.oh.activeTargetIds.has(t)},Ml.prototype.Qu=function(t){delete this.ah[t]},Ml.prototype.xu=function(){return this.oh.activeTargetIds},Ml.prototype.Ou=function(t){return this.oh.activeTargetIds.has(t)},Ml.prototype.start=function(){return this.oh=new Dl,Promise.resolve()},Ml.prototype.Gu=function(t,e,n){},Ml.prototype.zu=function(t){},Ml.prototype.ga=function(){},Ml.prototype.sr=function(t){},Ml),xl=function(t){this.key=t},kl=function(t){this.key=t},Pl=(Object.defineProperty(Ul.prototype,"dh",{get:function(){return this.uh},enumerable:!1,configurable:!0}),Ul.prototype.wh=function(t,e){var s=this,u=e?e.Eh:new Bi,a=(e||this).fh,c=(e||this).Qt,h=a,l=!1,f=ou(this.query)&&a.size===this.query.limit?a.last():null,p=su(this.query)&&a.size===this.query.limit?a.first():null;if(t.ht(function(t,e){var n=a.get(t),r=(r=e instanceof Xs?e:null)&&(mu(s.query,r)?r:null),i=!!n&&s.Qt.has(n.key),o=!!r&&(r.Je||s.Qt.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.Th(n,r)||(u.track({type:2,doc:r}),e=!0,(f&&0<s._h(r,f)||p&&s._h(r,p)<0)&&(l=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(f||p)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),ou(this.query)||su(this.query))for(;h.size>this.query.limit;){var n=ou(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{fh:h,Eh:u,Ih:l,Qt:c}},Ul.prototype.Th=function(t,e){return t.Je&&e.hasCommittedMutations&&!e.Je},Ul.prototype.Di=function(t,e,n){var o=this,r=this.fh;this.fh=t.fh,this.Qt=t.Qt;var i=t.Eh.Ut();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o._h(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Nr()}}var r,i}),this.mh(n);var s=e?this.Ah():[],e=(n=0===this.lh.size&&this.te?1:0)!==this.hh;return this.hh=n,0!==i.length||e?{snapshot:new Gi(this.query,t.fh,r,i,t.Qt,0==n,e,!1),Rh:s}:{Rh:s}},Ul.prototype.Ks=function(t){return this.te&&"Offline"===t?(this.te=!1,this.Di({fh:this.fh,Eh:new Bi,Qt:this.Qt,Ih:!1},!1)):{Rh:[]}},Ul.prototype.Ph=function(t){return!this.uh.has(t)&&!!this.fh.has(t)&&!this.fh.get(t).Je},Ul.prototype.mh=function(t){var e=this;t&&(t.ee.forEach(function(t){return e.uh=e.uh.add(t)}),t.ne.forEach(function(t){}),t.se.forEach(function(t){return e.uh=e.uh.delete(t)}),this.te=t.te)},Ul.prototype.Ah=function(){var e=this;if(!this.te)return[];var n=this.lh;this.lh=qi(),this.fh.forEach(function(t){e.Ph(t.key)&&(e.lh=e.lh.add(t.key))});var r=[];return n.forEach(function(t){e.lh.has(t)||r.push(new kl(t))}),this.lh.forEach(function(t){n.has(t)||r.push(new xl(t))}),r},Ul.prototype.gh=function(t){return this.uh=t.za,this.lh=qi(),t=this.wh(t.documents),this.Di(t,!0)},Ul.prototype.yh=function(){return Gi.Gt(this.query,this.fh,this.Qt,0===this.hh)},Ul),Ll=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Rl=function(t){this.key=t,this.Vh=!1},Cl=(Object.defineProperty(Vl.prototype,"Uh",{get:function(){return!0===this.qh},enumerable:!1,configurable:!0}),Vl);function Vl(t,e,n,r,i,o){this.Bc=t,this.ph=e,this.bh=n,this.Sh=r,this.currentUser=i,this.Dh=o,this.Ch={},this.Nh=new Xr(vu,yu),this.xh=new Map,this.Fh=[],this.Oh=new _i(ni.D),this.kh=new Map,this.Mh=new vl,this.$h={},this.Lh=new Map,this.Bh=lh.Vo(),this.onlineState="Unknown",this.qh=void 0}function Ul(t,e){this.query=t,this.uh=e,this.hh=null,this.te=!1,this.lh=qi(),this.Qt=qi(),this._h=wu(t),this.fh=new ji(this._h)}function Ml(){this.oh=new Dl,this.ah={},this.Cc=null,this.tr=null}function ql(t,e,n,r,i){this.window=t,this.fn=e,this.persistenceKey=n,this.Iu=r,this.mu=null,this.Cc=null,this.tr=null,this.Au=this.Ru.bind(this),this.Pu=new _i(xr),this.br=!1,this.gu=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.yu=bl(this.persistenceKey,this.Iu),this.Vu="firestore_sequence_number_"+this.persistenceKey,this.Pu=this.Pu.ot(this.Iu,new Dl),this.pu=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.bu=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.vu=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Su="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.Au)}function Fl(){this.activeTargetIds=Fi}function jl(t,e){this.clientId=t,this.onlineState=e}function Bl(t,e){this.clientId=t,this.activeTargetIds=e}function Gl(t,e,n){this.targetId=t,this.state=e,this.error=n}function zl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Kl(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Kh=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.wh(o)).Ih?[4,Vh(r.Bc,i.query,!1).then(function(t){return t=t.documents,i.view.wh(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.zt.get(i.targetId),n=i.view.Di(e,r.Uh,n),[2,(tf(r,i.targetId,n.Rh),n.snapshot)]}})})}(i,t,e,n)},[4,Vh(i.Bc,o,!0)];case 1:return n=t.sent(),r=new Pl(o,n.za),e=r.wh(n.documents),n=Ki.Zt(s,u&&"Offline"!==i.onlineState),n=r.Di(e,i.Uh,n),tf(i,s,n.Rh),r=new Ll(o,s,r),[2,(i.Nh.set(o,r),i.xh.has(s)?i.xh.get(s).push(o):i.xh.set(s,[o]),n.snapshot)]}})})}function Hl(f,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=uf(f),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.Bc,a=p,h=i,l=Jr.now(),o=a.reduce(function(t,e){return t.add(e.key)},qi()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Ka.qi(u,o).next(function(t){c=t;for(var s,e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=(s=i,o=c.get(i.key),s instanceof Rs?function(t){for(var e=null,n=0,r=s.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Xs?t.field(i.field):void 0;null!=(o=Zo(i.transform,o||null))&&(e=(null==e?new Bs:e).set(i.field,o))}return e?e.Xe():null}(o):null);null!=o&&e.push(new Os(i.key,o,function s(t){var u=[];return Hr(t.fields||{},function(t,e){var n=new ei([t]);if(_o(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new vs(u)}(o.proto.mapValue),bs.exists(!0)))}return h.Oi.Wr(u,l,e,a)})}).then(function(t){var e=t.Ii(c);return{batchId:t.batchId,Ri:e}}))];case 2:return s=t.sent(),u.Sh.ku(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.$h[e.currentUser.ti()])||new _i(xr)).ot(n,r),e.$h[e.currentUser.ti()]=i,[4,nf(u,s.Ri)];case 3:return t.sent(),[4,hl(u.ph)];case 4:return t.sent(),[3,6];case 5:return u=Ea(u=t.sent(),"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,l,o})})}function Wl(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:n=i,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Bc,c=e,h=(a=o).nt,l=c.La,c.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var i=c.Ua.wo({Eo:!0});l=c.La;var u=[];a.zt.forEach(function(t,e){var n,r,i,o=l.get(e);o&&(u.push(c.sa.Uo(s,t.se,e).next(function(){return c.sa.Bo(s,t.ee,e)})),0<(i=t.resumeToken).o()&&(n=o.it(i,h).st(s.Wo),l=l.ot(e,n),r=o,i=t,Dr(0<(o=n).resumeToken.o()),(0===r.resumeToken.o()||3e8<=o.nt.p()-r.nt.p()||0<i.ee.size+i.ne.size+i.se.size)&&u.push(c.sa.Oo(s,n))))});var t,o=Li,n=qi();return a.Yt.forEach(function(t,e){n=n.add(t)}),u.push(i.getEntries(s,n).next(function(r){a.Yt.forEach(function(t,e){var n=r.get(t);e instanceof Js&&e.version.isEqual($r.min())?(i.pi(t,h),o=o.ot(t,e)):null==n||0<e.version.u(n.version)||0===e.version.u(n.version)&&n.hasPendingWrites?(i.yi(e,h),o=o.ot(t,e)):Er("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Jt.has(t)&&u.push(c.persistence.qr.Ma(s,t))})})),h.isEqual($r.min())||(t=c.sa.So(s).next(function(t){return c.sa.Co(s,s.Wo,h)}),u.push(t)),Zu.On(u).next(function(){return i.apply(s)}).next(function(){return c.Ka.Ui(s,o)})}).then(function(t){return c.La=l,t}))];case 2:return r=t.sent(),o.zt.forEach(function(t,e){(e=n.kh.get(e))&&(Dr(t.ee.size+t.ne.size+t.se.size<=1),0<t.ee.size?e.Vh=!0:0<t.ne.size?Dr(e.Vh):0<t.se.size&&(Dr(e.Vh),e.Vh=!1))}),[4,nf(n,r,o)];case 3:return t.sent(),[3,6];case 4:return[4,Mh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,a,c,h,l})})}function Ql(t,n,e){var r;((t=t).Uh&&0===e||!t.Uh&&1===e)&&(r=[],t.Nh.forEach(function(t,e){(e=e.view.Ks(n)).snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.Bs.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Ks(i)&&(o=!0)}),o&&Da(t)}(t.bh,n),r.length&&t.Ch.Tc(r),t.onlineState=n,t.Uh&&t.Sh.zu(n))}function Yl(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:sl((n=o).ph)||Er("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.Bc).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Oi.Yr(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Lh.get(r)||[]).push(s),n.Lh.set(r,i),[3,4]);case 3:return i=Ea(i=t.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function Xl(t,e){(t.Lh.get(e)||[]).forEach(function(t){t.resolve()}),t.Lh.delete(e)}function Jl(t,e,n){var r=t,i=r.$h[r.currentUser.ti()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.$h[r.currentUser.ti()]=i)}function $l(e,t,n){void 0===n&&(n=null),e.Sh.Uu(t);for(var r=0,i=e.xh.get(t);r<i.length;r++){var o=i[r];e.Nh.delete(o),n&&e.Ch.Qh(o,n)}e.xh.delete(t),e.Uh&&e.Mh.hu(t).forEach(function(t){e.Mh.ro(t)||Zl(e,t)})}function Zl(t,e){var n=t.Oh.get(e);null!==n&&(el(t.ph,n),t.Oh=t.Oh.remove(e),t.kh.delete(n),ef(t))}function tf(t,e,n){for(var r,i,o=0,s=n;o<s.length;o++){var u=s[o];u instanceof xl?(t.Mh.qo(u.key,e),r=t,i=(i=u).key,r.Oh.get(i)||(Er("SyncEngine","New document in limbo: "+i),r.Fh.push(i),ef(r))):u instanceof kl?(Er("SyncEngine","Document no longer in limbo: "+u.key),t.Mh.Ko(u.key,e),t.Mh.ro(u.key)||Zl(t,u.key)):Nr()}}function ef(t){for(;0<t.Fh.length&&t.Oh.size<t.Dh;){var e=t.Fh.shift(),n=t.Bh.next();t.kh.set(n,new Rl(e)),t.Oh=t.Oh.ot(e,n),tl(t.ph,new bi(lu(iu(e.path)),n,2,Ba.ir))}}function nf(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Nh.P()?[3,3]:(n.Nh.forEach(function(t,e){o.push(n.Kh(e,s,u).then(function(t){t&&(n.Uh&&n.Sh.Wu(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=ja.Zi(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.Ch.Tc(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Zu.forEach(c,function(e){return Zu.forEach(e.Ji,function(t){return r.persistence.qr.qo(n,e.targetId,t)}).next(function(){return Zu.forEach(e.Xi,function(t){return r.persistence.qr.Ko(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!aa(e=t.sent()))throw e;return Er("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.La.get(o),u=s.nt,u=s.rt(u),r.La=r.La.ot(o,u));return[2]}})})}(n.Bc,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function rf(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,l,f;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.xh.get(s))&&0!==a.length?[4,Rh(e.Bc,lu(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(l=h[c],l=e.Nh.get(l),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Vh((e=r).Bc,i.query,!0)];case 1:return n=t.sent(),n=i.view.gh(n),[2,(e.Uh&&tf(e,i.targetId,n.Rh),n)]}})})}(e,l)]):[3,6];case 4:(l=t.sent()).snapshot&&r.push(l.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Uh(e.Bc,s)];case 8:return f=t.sent(),[4,Rh(e.Bc,f)];case 9:return u=t.sent(),[4,Kl(e,of(f),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Ch.Tc(r),n)]}})})}function of(t){return ru(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function sf(t){return t.ph.Uc.Xc=Wl.bind(null,t),t.ph.Uc.qe=function(t,e){var n=t;if((t=n.kh.get(e))&&t.Vh)return qi().add(t.key);var r=qi();if(!(e=n.xh.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Nh.get(s),r=r.kt(s.view.dh);return r}.bind(null,t),t.ph.Uc.Jc=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).Sh.Wu(s,"rejected",u),i=e.kh.get(s),(n=i&&i.key)?(r=(r=new _i(ni.D)).ot(n,new Js(n,$r.min())),i=qi().add(n),i=new zi($r.min(),new Map,new ki(xr),r,i),[4,Wl(e,i)]):[3,2];case 1:return t.sent(),e.Oh=e.Oh.remove(n),e.kh.delete(s),ef(e),[3,4];case 2:return[4,Ch(e.Bc,s,!1).then(function(){return $l(e,s,u)}).catch(Mh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.Ch.Tc=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query;if(u=n.Bs.get(u)){for(var a=0,c=u.listeners;a<c.length;a++)c[a].Qs(s)&&(r=!0);u.Ls=s}}r&&Da(n)}.bind(null,t.bh),t.Ch.Qh=function(t,e,n){var r=t;if(t=r.Bs.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.Bs.delete(e)}.bind(null,t.bh),t}function uf(t){return t.ph.Uc.Zc=function(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:n=o,r=s.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Bc,h=s,(l=e).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r,e=h.batch.keys(),n=l.Ua.wo({Eo:!0}),i=l,o=t,s=n,u=(r=h).batch,a=u.keys(),c=Zu.resolve();return a.forEach(function(n){c=c.next(function(){return s.bi(o,n)}).next(function(t){var e=t;Dr(null!==(t=r.Ai.get(n))),(!e||e.version.u(t)<0)&&(e=u.wi(n,e,r))&&s.yi(e,r.mi)})}),c.next(function(){return i.Oi.Zr(o,u)}).next(function(){return n.apply(t)}).next(function(){return l.Oi.io(t)}).next(function(){return l.Ka.qi(t,e)})}))];case 2:return i=t.sent(),Jl(n,r,null),Xl(n,r),n.Sh.$u(r,"acknowledged"),[4,nf(n,i)];case 3:return t.sent(),[3,6];case 4:return[4,Mh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,h,l})})}.bind(null,t),t.ph.Uc.tu=function(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Bc,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Oi.Gr(e,r).next(function(t){return Dr(null!==t),n=t.keys(),i.Oi.Zr(e,t)}).next(function(){return i.Oi.io(e)}).next(function(){return i.Ka.qi(e,n)})}))];case 2:return o=t.sent(),Jl(n,u,a),Xl(n,u),n.Sh.$u(u,"rejected",a),[4,nf(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Mh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,t),t}var af,cf,hf,lf=(Vf.prototype.Qa=function(t){this.Wh=t},Vf.prototype.Qi=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.on.length||1===r.on.length&&r.on[0].field.W())||i.isEqual($r.min())?this.jh(e,r):this.Wh.qi(e,o).next(function(t){var n=s.Gh(r,t);return(ou(r)||su(r))&&s.Ih(r.an,n,o,i)?s.jh(e,r):(Ir()<=f.DEBUG&&Er("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),gu(r)),s.Wh.Qi(e,r,i).next(function(e){return n.forEach(function(t){e=e.ot(t.key,t)}),e}))})},Vf.prototype.Gh=function(n,t){var r=new ki(wu(n));return t.forEach(function(t,e){e instanceof Xs&&mu(n,e)&&(r=r.add(e))}),r},Vf.prototype.Ih=function(t,e,n,r){return n.size!==e.size||!!(e="F"===t?e.last():e.first())&&(e.hasPendingWrites||0<e.version.u(r))},Vf.prototype.jh=function(t,e){return Ir()<=f.DEBUG&&Er("IndexFreeQueryEngine","Using full collection scan to execute query:",gu(e)),this.Wh.Qi(t,e,$r.min())},Vf),ff=(Cf.prototype.Qr=function(t){return Zu.resolve(0===this.Oi.length)},Cf.prototype.Wr=function(t,e,n,r){var i=this.zh;this.zh++,0<this.Oi.length&&this.Oi[this.Oi.length-1],n=new Ua(i,e,n,r),this.Oi.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this.Hh=this.Hh.add(new gl(u.key,i)),this.ki.jr(t,u.key.path.F())}return Zu.resolve(n)},Cf.prototype.Gr=function(t,e){return Zu.resolve(this.Yh(e))},Cf.prototype.Hr=function(t,e){return e+=1,e=(e=this.Jh(e))<0?0:e,Zu.resolve(this.Oi.length>e?this.Oi[e]:null)},Cf.prototype.Yr=function(){return Zu.resolve(0===this.Oi.length?-1:this.zh-1)},Cf.prototype.Jr=function(t){return Zu.resolve(this.Oi.slice())},Cf.prototype.$i=function(t,e){var n=this,r=new gl(e,0),e=new gl(e,Number.POSITIVE_INFINITY),i=[];return this.Hh.xt([r,e],function(t){t=n.Yh(t.fu),i.push(t)}),Zu.resolve(i)},Cf.prototype.Ki=function(t,e){var n=this,r=new ki(xr);return e.forEach(function(t){var e=new gl(t,0),t=new gl(t,Number.POSITIVE_INFINITY);n.Hh.xt([e,t],function(t){r=r.add(t.fu)})}),Zu.resolve(this.Xh(r))},Cf.prototype.Hi=function(t,e){var n=e.path,r=n.length+1,e=n;ni.X(e)||(e=e.child(""));var e=new gl(new ni(e),0),i=new ki(xr);return this.Hh.Ft(function(t){var e=t.key.path;return!!n.M(e)&&(e.length===r&&(i=i.add(t.fu)),!0)},e),Zu.resolve(this.Xh(i))},Cf.prototype.Xh=function(t){var e=this,n=[];return t.forEach(function(t){null!==(t=e.Yh(t))&&n.push(t)}),n},Cf.prototype.Zr=function(n,r){var i=this;Dr(0===this.Zh(r.batchId,"removed")),this.Oi.shift();var o=this.Hh;return Zu.forEach(r.mutations,function(t){var e=new gl(t.key,r.batchId);return o=o.delete(e),i.qr.so(n,t.key)}).next(function(){i.Hh=o})},Cf.prototype.no=function(t){},Cf.prototype.ro=function(t,e){var n=new gl(e,0),n=this.Hh.Ot(n);return Zu.resolve(e.isEqual(n&&n.key))},Cf.prototype.io=function(t){return this.Oi.length,Zu.resolve()},Cf.prototype.Zh=function(t,e){return this.Jh(t)},Cf.prototype.Jh=function(t){return 0===this.Oi.length?0:t-this.Oi[0].batchId},Cf.prototype.Yh=function(t){return(t=this.Jh(t))<0||t>=this.Oi.length?null:this.Oi[t]},Cf),pf=(Rf.prototype.yi=function(t,e,n){var r=e.key,i=(o=this.docs.get(r))?o.size:0,o=this.tl(e);return this.docs=this.docs.ot(r,{ho:e,size:o,readTime:n}),this.size+=o-i,this.ki.jr(t,r.path.F())},Rf.prototype.pi=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Rf.prototype.bi=function(t,e){return e=this.docs.get(e),Zu.resolve(e?e.ho:null)},Rf.prototype.getEntries=function(t,e){var n=this,r=Li;return e.forEach(function(t){var e=n.docs.get(t);r=r.ot(t,e?e.ho:null)}),Zu.resolve(r)},Rf.prototype.Qi=function(t,e,n){for(var r=Vi,i=new ni(e.path.child("")),o=this.docs.ft(i);o.At();){var s=(u=o.It()).key,u=(a=u.value).ho,a=a.readTime;if(!e.path.M(s.path))break;a.u(n)<=0||u instanceof Xs&&mu(e,u)&&(r=r.ot(u.key,u))}return Zu.resolve(r)},Rf.prototype.el=function(t,e){return Zu.forEach(this.docs,function(t){return e(t)})},Rf.prototype.wo=function(t){return new df(this)},Rf.prototype.To=function(t){return Zu.resolve(this.size)},Rf),df=(n(Lf,hf=h),Lf.prototype.Di=function(n){var r=this,i=[];return this.Ri.forEach(function(t,e){e?i.push(r.Io.yi(n,e,r.readTime)):r.Io.pi(t)}),Zu.On(i)},Lf.prototype.vi=function(t,e){return this.Io.bi(t,e)},Lf.prototype.Si=function(t,e){return this.Io.getEntries(t,e)},Lf),yf=(Pf.prototype.Ce=function(t,n){return this.nl.forEach(function(t,e){return n(e)}),Zu.resolve()},Pf.prototype.So=function(t){return Zu.resolve(this.lastRemoteSnapshotVersion)},Pf.prototype.Do=function(t){return Zu.resolve(this.sl)},Pf.prototype.po=function(t){return this.highestTargetId=this.rl.next(),Zu.resolve(this.highestTargetId)},Pf.prototype.Co=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.sl&&(this.sl=e),Zu.resolve()},Pf.prototype.xo=function(t){this.nl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.rl=new lh(e),this.highestTargetId=e),t.sequenceNumber>this.sl&&(this.sl=t.sequenceNumber)},Pf.prototype.No=function(t,e){return this.xo(e),this.targetCount+=1,Zu.resolve()},Pf.prototype.Oo=function(t,e){return this.xo(e),Zu.resolve()},Pf.prototype.ko=function(t,e){return this.nl.delete(e.target),this.il.hu(e.targetId),--this.targetCount,Zu.resolve()},Pf.prototype.Or=function(n,r,i){var o=this,s=0,u=[];return this.nl.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.nl.delete(t),u.push(o.Mo(n,e.targetId)),s++)}),Zu.On(u).next(function(){return s})},Pf.prototype.$o=function(t){return Zu.resolve(this.targetCount)},Pf.prototype.Lo=function(t,e){return e=this.nl.get(e)||null,Zu.resolve(e)},Pf.prototype.Bo=function(t,e,n){return this.il.au(e,n),Zu.resolve()},Pf.prototype.Uo=function(e,t,n){this.il.uu(t,n);var r=this.persistence.qr,i=[];return r&&t.forEach(function(t){i.push(r.so(e,t))}),Zu.On(i)},Pf.prototype.Mo=function(t,e){return this.il.hu(e),Zu.resolve()},Pf.prototype.Qo=function(t,e){return e=this.il._u(e),Zu.resolve(e)},Pf.prototype.ro=function(t,e){return Zu.resolve(this.il.ro(e))},Pf),vf=(kf.prototype.start=function(){return Promise.resolve()},kf.prototype.ga=function(){return this.Ho=!1,Promise.resolve()},Object.defineProperty(kf.prototype,"br",{get:function(){return this.Ho},enumerable:!1,configurable:!0}),kf.prototype.ha=function(){},kf.prototype.la=function(){},kf.prototype.Na=function(){return this.ki},kf.prototype.Sa=function(t){var e=this.ol[t.ti()];return e||(e=new ff(this.ki,this.qr),this.ol[t.ti()]=e),e},kf.prototype.Da=function(){return this.sa},kf.prototype.Ca=function(){return this.Fi},kf.prototype.runTransaction=function(t,e,n){var r=this;Er("MemoryPersistence","Starting transaction:",t);var i=new gf(this.zo.next());return this.qr.cl(),n(i).next(function(t){return r.qr.ul(i).next(function(){return t})}).xn().then(function(t){return i.xi(),t})},kf.prototype.hl=function(e,n){return Zu.kn(Object.values(this.ol).map(function(t){return function(){return t.ro(e,n)}}))},kf),gf=(n(xf,cf=ge),xf),mf=(Of.fl=function(t){return new Of(t)},Object.defineProperty(Of.prototype,"dl",{get:function(){if(this._l)return this._l;throw Nr()},enumerable:!1,configurable:!0}),Of.prototype.qo=function(t,e,n){return this.ll.qo(n,e),this.dl.delete(n.toString()),Zu.resolve()},Of.prototype.Ko=function(t,e,n){return this.ll.Ko(n,e),this.dl.add(n.toString()),Zu.resolve()},Of.prototype.so=function(t,e){return this.dl.add(e.toString()),Zu.resolve()},Of.prototype.removeTarget=function(t,e){var n=this;this.ll.hu(e.targetId).forEach(function(t){return n.dl.add(t.toString())});var r=this.persistence.Da();return r.Qo(t,e.targetId).next(function(t){t.forEach(function(t){return n.dl.add(t.toString())})}).next(function(){return r.ko(t,e)})},Of.prototype.cl=function(){this._l=new Set},Of.prototype.ul=function(n){var r=this,i=this.persistence.Ca().wo();return Zu.forEach(this.dl,function(t){var e=ni.H(t);return r.wl(n,e).next(function(t){t||i.pi(e)})}).next(function(){return r._l=null,i.apply(n)})},Of.prototype.Ma=function(t,e){var n=this;return this.wl(t,e).next(function(t){t?n.dl.delete(e.toString()):n.dl.add(e.toString())})},Of.prototype.al=function(t){return 0},Of.prototype.wl=function(t,e){var n=this;return Zu.kn([function(){return Zu.resolve(n.ll.ro(e))},function(){return n.persistence.Da().ro(t,e)},function(){return n.persistence.hl(t,e)}])},Of),wf=(Sf.prototype.wc=function(t){this.Il=t},Sf.prototype.hc=function(t){this.ml=t},Sf.prototype.onMessage=function(t){this.Al=t},Sf.prototype.close=function(){this.Tl()},Sf.prototype.send=function(t){this.El(t)},Sf.prototype.Rl=function(){this.Il()},Sf.prototype.Pl=function(t){this.ml(t)},Sf.prototype.gl=function(t){this.Al(t)},Sf),bf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},If=(Df.prototype.Sc=function(e,t,n,r){var i=this.bl(e,t);return Er("RestConnection","Sending: ",i,n),t={},this.vl(t,r),this.Sl(e,i,t,n).then(function(t){return Er("RestConnection","Received: ",t),t},function(t){throw _r("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Df.prototype.Dc=function(t,e,n,r){return this.Sc(t,e,n,r)},Df.prototype.vl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.0.1",t["Content-Type"]="text/plain",e)for(var n in e.si)e.si.hasOwnProperty(n)&&(t[n]=e.si[n])},Df.prototype.bl=function(t,e){return t=bf[t],this.Vl+"/v1/"+e+":"+t},n(Nf,af=Df),Nf.prototype.Sl=function(o,e,s,u){return new Promise(function(n,r){var i=new dr;i.listenOnce(fr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case lr.NO_ERROR:var t=i.getResponseJson();Er("Connection","XHR received:",JSON.stringify(t)),n(t);break;case lr.TIMEOUT:Er("Connection",'RPC "'+o+'" timed out'),r(new mr(gr.DEADLINE_EXCEEDED,"Request time out"));break;case lr.HTTP_ERROR:var e=i.getStatus();Er("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace("_","-"),e=0<=Object.values(gr).indexOf(e)?e:gr.UNKNOWN,r(new mr(e,t.message))):r(new mr(gr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new mr(gr.UNAVAILABLE,"Connection failed."));break;default:Nr()}}finally{Er("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},Nf.prototype.Ec=function(t,e){var n,r=[this.Vl,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new sr,t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this._.projectId+"/databases/"+this._.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.T};this.vl(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(n=p()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders"),Er("Connection","Creating WebChannel: "+(r=r.join("")),t);var o=i.createWebChannel(r,t),s=!1,u=!1,a=new wf({El:function(t){u?Er("Connection","Not sending because WebChannel is closed:",t):(s||(Er("Connection","Opening WebChannel transport."),o.open(),s=!0),Er("Connection","WebChannel sending:",t),o.send(t))},Tl:function(){return o.close()}});return(t=function(t,e){o.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})})(pr.EventType.OPEN,function(){u||Er("Connection","WebChannel transport opened.")}),t(pr.EventType.CLOSE,function(){u||(u=!0,Er("Connection","WebChannel transport closed"),a.Pl())}),t(pr.EventType.ERROR,function(t){u||(u=!0,_r("Connection","WebChannel transport errored:",t),a.Pl(new mr(gr.UNAVAILABLE,"The operation could not be completed")))}),t(pr.EventType.MESSAGE,function(t){var e,n,r,i;u||(Dr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Er("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=wi[r];if(void 0!==t)return Ti(t)}(),i=n.message,void 0===t&&(t=gr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,a.Pl(new mr(t,i)),o.close()):(Er("Connection","WebChannel received:",e),a.gl(e)))}),setTimeout(function(){a.Rl()},0),a},Nf),Ef=(Af.prototype.zc=function(t){this.Fl.push(t)},Af.prototype.ga=function(){window.removeEventListener("online",this.Dl),window.removeEventListener("offline",this.Nl)},Af.prototype.Ol=function(){window.addEventListener("online",this.Dl),window.addEventListener("offline",this.Nl)},Af.prototype.Cl=function(){Er("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Fl;t<e.length;t++)(0,e[t])(0)},Af.prototype.xl=function(){Er("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Fl;t<e.length;t++)(0,e[t])(1)},Af.Ln=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Af),Tf=(_f.prototype.zc=function(t){},_f.prototype.ga=function(){},_f);function _f(){}function Af(){var t=this;this.Dl=function(){return t.Cl()},this.Nl=function(){return t.xl()},this.Fl=[],this.Ol()}function Nf(t){var e=this;return(e=af.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.T=t.T,e}function Df(t){this.yl=t,this._=t._;var e=t.ssl?"https":"http";this.Vl=e+"://"+t.host,this.pl="projects/"+this._.projectId+"/databases/"+this._.database+"/documents"}function Sf(t){this.El=t.El,this.Tl=t.Tl}function Of(t){this.persistence=t,this.ll=new vl,this._l=null}function xf(t){var e=this;return(e=cf.call(this)||this).Wo=t,e}function kf(t){var e=this;this.ol={},this.zo=new Ba(0),this.Ho=!1,this.Ho=!0,this.qr=t(this),this.sa=new yf(this),this.ki=new qc,this.Fi=(t=this.ki,new pf(t,function(t){return e.qr.al(t)}))}function Pf(t){this.persistence=t,this.nl=new Xr(yi,vi),this.lastRemoteSnapshotVersion=$r.min(),this.highestTargetId=0,this.sl=0,this.il=new vl,this.targetCount=0,this.rl=lh.yo()}function Lf(t){var e=this;return(e=hf.call(this)||this).Io=t,e}function Rf(t,e){this.ki=t,this.tl=e,this.docs=new _i(ni.D),this.size=0}function Cf(t,e){this.ki=t,this.qr=e,this.Oi=[],this.zh=1,this.Hh=new ki(gl.iu)}function Vf(){}function Uf(t){return new Do(t,!0)}var Mf,qf,Ff=(Yf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Sh=this.kl(e),this.persistence=this.Ml(e),[4,this.persistence.start()];case 1:return t.sent(),this.$l=this.Ll(e),this.Bc=this.Bl(e),[2]}})})},Yf.prototype.Ll=function(t){return null},Yf.prototype.Bl=function(t){return e=this.persistence,n=new lf,t=t.ql,new xh(e,n,t);var e,n},Yf.prototype.Ml=function(t){return new vf(mf.fl)},Yf.prototype.kl=function(t){return new Ol},Yf.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.$l&&this.$l.stop(),[4,this.Sh.ga()];case 1:return t.sent(),[4,this.persistence.ga()];case 2:return t.sent(),[2]}})})},Yf),jf=(n(Qf,qf=Ff),Qf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,qf.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=Vc(t),r=$r.min(),t.rs({index:Zc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=gc(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.qa=t})]})})}(this.Bc)];case 2:return t.sent(),[4,this.Ul.initialize(this,e)];case 3:return t.sent(),[4,uf(this.Ul.mu)];case 4:return t.sent(),[4,hl(this.Ul.ph)];case 5:return t.sent(),[2]}})})},Qf.prototype.Ll=function(t){var e=this.persistence.qr.gr;return new sc(e,t.cs)},Qf.prototype.Ml=function(t){var e=Oh(t.yl._,t.yl.persistenceKey),n=void 0!==this.cacheSizeBytes?rc.Ir(this.cacheSizeBytes):rc.Rr,r=Uf(t.yl._);return new Ih(this.synchronizeTabs,e,t.clientId,n,t.cs,va(),ga(),r,this.Sh,!!this.forceOwnership)},Qf.prototype.kl=function(t){return new Ol},Qf),Bf=(n(Wf,Mf=jf),Wf.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,Mf.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Ul.mu,this.Sh instanceof Sl?(this.Sh.mu={sh:function(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).Bc,n=a,i=(r=e).Oi,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.zr(e,n).next(function(t){return t?r.Ka.qi(e,t):Zu.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,hl(o.ph)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Jl(o,a,h||null),Xl(o,a),o.Bc.Oi.no(a)):Nr(),t.label=4;case 4:return[4,nf(o,s)];case 5:return t.sent(),[3,7];case 6:Er("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}.bind(null,e),ih:function(o,u,a,c){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:return(n=o).qh?(Er("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.xh.has(u))return[3,8];switch(a){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(e=n.Bc,(s=e).persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Ua,n=t,t=s.qa,r=e,i=Li,o=vc(t),t=Vc(n),n=IDBKeyRange.lowerBound(o,!0),t.rs({index:Zc.readTimeIndex,range:n},function(t,e){var n=dc(r.serializer,e);i=i.ot(n.key,n),o=e.readTime}).next(function(){return{Ha:i,readTime:gc(o)}});var e,n,r,i,o}).then(function(t){var e=t.Ha,t=t.readTime;return s.qa=t,e}))];case 3:return r=t.sent(),i=zi.Xt(u,"current"===a),[4,nf(n,r,i)];case 4:return t.sent(),[3,8];case 5:return[4,Ch(n.Bc,u,!0)];case 6:return t.sent(),$l(n,u,c),[3,8];case 7:Nr(),t.label=8;case 8:return[2]}var e,s})})}.bind(null,e),rh:function(c,h,l){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=sf(c)).qh)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.xh.has(r)?(Er("SyncEngine","Adding an already active target "+r),[3,5]):[4,Uh(n.Bc,r)]):[3,6];case 2:return i=t.sent(),[4,Rh(n.Bc,i)];case 3:return o=t.sent(),[4,Kl(n,of(i),o.targetId,!1)];case 4:t.sent(),tl(n.ph,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.xh.has(e)?[4,Ch(n.Bc,e,!1).then(function(){el(n.ph,e),$l(n,e)}).catch(Mh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=l,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),va:function(t){return t.Bc.persistence.va()}.bind(null,e)},[4,this.Sh.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.ua(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,function(h,l){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return sf(r=h),uf(r),!0!==l||!0===r.qh?[3,3]:(e=r.Sh.xu(),[4,rf(r,e.L())]);case 1:return i=t.sent(),r.qh=!0,[4,pl(r.ph,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],tl(r.ph,u);return[3,7];case 3:return!1!==l||!1===r.qh?[3,7]:(a=[],c=Promise.resolve(),r.xh.forEach(function(t,e){r.Sh.Ku(e)?a.push(e):c=c.then(function(){return $l(r,e),Ch(r.Bc,e,!0)}),el(r.ph,e)}),[4,c]);case 4:return t.sent(),[4,rf(r,a)];case 5:return t.sent(),(n=r).kh.forEach(function(t,e){el(n.ph,e)}),n.Mh.lu(),n.kh=new Map,n.Oh=new _i(ni.D),r.qh=!1,[4,pl(r.ph,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}(this.Ul.mu,e)];case 1:return t.sent(),this.$l&&(e&&!this.$l.br?this.$l.start(this.Bc):e||this.$l.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Wf.prototype.kl=function(t){var e=va();if(!Sl.Ln(e))throw new mr(gr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Oh(t.yl._,t.yl.persistenceKey);return new Sl(e,t.cs,n,t.clientId,t.ql)},Wf),Gf=(Hf.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Bc?[3,2]:(this.Bc=n.Bc,this.Sh=n.Sh,this.qc=this.Kl(r),this.ph=this.Ql(r),this.bh=this.Wl(r),this.mu=this.jl(r,!n.synchronizeTabs),this.Sh.Cc=function(t){return Ql(e.mu,t,1)},this.ph.Uc.Gl=function(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Er("SyncEngine","User change. New user:",o.ti()),[4,Ph(n.Bc,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Lh.forEach(function(t){t.forEach(function(t){t.reject(new mr(gr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Lh.clear(),n.Sh.Gu(o,r.ja,r.Ga),[4,nf(n,r.Wa)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}.bind(null,this.mu),[4,pl(this.ph,this.mu.Uh)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Hf.prototype.Wl=function(t){return new Ta},Hf.prototype.Kl=function(t){var e=Uf(t.yl._),n=(n=t.yl,new If(n));return t=t.credentials,new Kh(t,n,e)},Hf.prototype.Ql=function(t){var e=this;return new qh(this.Bc,this.qc,t.cs,function(t){return Ql(e.mu,t,0)},t=new(Ef.Ln()?Ef:Tf))},Hf.prototype.jl=function(t,e){return n=this.Bc,r=this.ph,i=this.bh,o=this.Sh,s=t.ql,t=t.Dh,e=e,t=new Cl(n,r,i,o,s,t),e&&(t.qh=!0),t;var n,r,i,o,s},Hf.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,Er("RemoteStore","RemoteStore shutting down."),e.Wc.add(5),[4,Zh(e)];case 1:return t.sent(),e.Gc.ga(),e.Hc.set("Unknown"),[2]}})})}(this.ph)},Hf),zf=(Kf.prototype.next=function(t){this.observer.next&&this.zl(this.observer.next,t)},Kf.prototype.error=function(t){this.observer.error?this.zl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Kf.prototype.Hl=function(){this.muted=!0},Kf.prototype.zl=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Kf);function Kf(t){this.observer=t,this.muted=!1}function Hf(){}function Wf(t,e){var n=this;return(n=Mf.call(this,t,e,!1)||this).Ul=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function Qf(t,e,n){var r=this;return(r=qf.call(this)||this).Ul=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function Yf(){this.synchronizeTabs=!1}function Xf(t,e,n){if(!n)throw new mr(gr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Jf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new mr(gr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function $f(t,e,n,r){if(!0===e&&!0===r)throw new mr(gr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Zf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Nr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function tp(t,e){if(e<=0)throw new mr(gr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var ep,np,rp=function(t){for(var e=0;e<t.length;++e)if(0===t[e].length)throw new mr(gr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Yl=new ei(t)},ip=(n(cp,np=rp),cp.documentId=function(){return new cp(ei.j().B())},cp.prototype.isEqual=function(t){return t instanceof cp&&this.Yl.isEqual(t.Yl)},cp),op=new RegExp("[~\\*/\\[\\]]"),sp=function(t){this.Jl=t},up=(n(ap,ep=sp),ap.prototype.Xl=function(t){if(2!==t.Zl)throw 1===t.Zl?t.t_(this.Jl+"() can only appear at the top level of your update data"):t.t_(this.Jl+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},ap.prototype.isEqual=function(t){return t instanceof ap},ap);function ap(){return null!==ep&&ep.apply(this,arguments)||this}function cp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return np.call(this,t)||this}function hp(t,e,n){return new Lp({Zl:3,e_:e.settings.e_,methodName:t.Jl,n_:n},e._,e.serializer,e.ignoreUndefinedProperties)}var lp,fp,pp,dp,yp=(n(kp,dp=sp),kp.prototype.Xl=function(t){return new gs(t.path,new ns)},kp.prototype.isEqual=function(t){return t instanceof kp},kp),vp=(n(xp,pp=sp),xp.prototype.Xl=function(t){var e=hp(this,t,!0),n=this.s_.map(function(t){return jp(t,e)}),n=new rs(n);return new gs(t.path,n)},xp.prototype.isEqual=function(t){return this===t},xp),gp=(n(Op,fp=sp),Op.prototype.Xl=function(t){var e=hp(this,t,!0),n=this.s_.map(function(t){return jp(t,e)}),n=new as(n);return new gs(t.path,n)},Op.prototype.isEqual=function(t){return this===t},Op),mp=(n(Sp,lp=sp),Sp.prototype.Xl=function(t){var e=new fs(t.serializer,xo(t.serializer,this.i_));return new gs(t.path,e)},Sp.prototype.isEqual=function(t){return this===t},Sp),wp=(Object.defineProperty(Dp.prototype,"latitude",{get:function(){return this.r_},enumerable:!1,configurable:!0}),Object.defineProperty(Dp.prototype,"longitude",{get:function(){return this.o_},enumerable:!1,configurable:!0}),Dp.prototype.isEqual=function(t){return this.r_===t.r_&&this.o_===t.o_},Dp.prototype.toJSON=function(){return{latitude:this.r_,longitude:this.o_}},Dp.prototype.g=function(t){return xr(this.r_,t.r_)||xr(this.o_,t.o_)},Dp),bp=function(t){this.a_=t},Ip=/^__.*__$/,Ep=function(t,e,n){this.c_=t,this.u_=e,this.h_=n},Tp=(Np.prototype.l_=function(t,e){var n=[];return null!==this.Qe?n.push(new Os(t,this.data,this.Qe,e)):n.push(new Ss(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Rs(t,this.fieldTransforms)),n},Np),_p=(Ap.prototype.l_=function(t,e){return e=[new Os(t,this.data,this.Qe,e)],0<this.fieldTransforms.length&&e.push(new Rs(t,this.fieldTransforms)),e},Ap);function Ap(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function Np(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function Dp(t,e){if(!isFinite(t)||t<-90||90<t)throw new mr(gr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new mr(gr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.r_=t,this.o_=e}function Sp(t,e){var n=this;return(n=lp.call(this,t)||this).i_=e,n}function Op(t,e){var n=this;return(n=fp.call(this,t)||this).s_=e,n}function xp(t,e){var n=this;return(n=pp.call(this,t)||this).s_=e,n}function kp(){return null!==dp&&dp.apply(this,arguments)||this}function Pp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Nr()}}var Lp=(Object.defineProperty(Vp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Vp.prototype,"Zl",{get:function(){return this.settings.Zl},enumerable:!1,configurable:!0}),Vp.prototype.f_=function(t){return new Vp(Object.assign(Object.assign({},this.settings),t),this._,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},Vp.prototype.d_=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t);return(e=this.f_({path:e,n_:!1})).w_(t),e},Vp.prototype.E_=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t);return(t=this.f_({path:t,n_:!1})).__(),t},Vp.prototype.T_=function(t){return this.f_({path:void 0,n_:!0})},Vp.prototype.t_=function(t){return Wp(t,this.settings.methodName,this.settings.I_||!1,this.path,this.settings.e_)},Vp.prototype.contains=function(e){return void 0!==this.Qe.find(function(t){return e.M(t)})||void 0!==this.fieldTransforms.find(function(t){return e.M(t.field)})},Vp.prototype.__=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.w_(this.path.get(t))},Vp.prototype.w_=function(t){if(0===t.length)throw this.t_("Document fields must not be empty");if(Pp(this.Zl)&&Ip.test(t))throw this.t_('Document fields cannot begin and end with "__"')},Vp),Rp=(Cp.prototype.m_=function(t,e,n,r){return void 0===r&&(r=!1),new Lp({Zl:t,methodName:e,e_:n,path:ei.U(),n_:!1,I_:r},this._,this.serializer,this.ignoreUndefinedProperties)},Cp);function Cp(t,e,n){this._=t,this.ignoreUndefinedProperties=e,this.serializer=n||Uf(t)}function Vp(t,e,n,r,i,o){this.settings=t,this._=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.__(),this.fieldTransforms=i||[],this.Qe=o||[]}function Up(t,e,n,r,i,o){void 0===o&&(o={});var s=t.m_(o.merge||o.mergeFields?2:0,e,n,i);zp("Data must be an object, but it was:",s,r);var u,a,r=Bp(r,s);if(o.merge)u=new vs(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=l[h],p=void 0;if(f instanceof rp)p=f.Yl;else{if("string"!=typeof f)throw Nr();p=Hp(e,f,n)}if(!s.contains(p))throw new mr(gr.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Qp(c,p)||c.push(p)}u=new vs(c),a=s.fieldTransforms.filter(function(t){return u.Ye(t.field)})}else u=null,a=s.fieldTransforms;return new Tp(new js(r),u,a)}function Mp(t,r,i,e){var o=t.m_(1,r,i);zp("Data must be an object, but it was:",o,e);var s=[],u=new Bs;return Hr(e,function(t,e){var n=Hp(r,t,i),t=o.E_(n);e instanceof up||e instanceof bp&&e.a_ instanceof up?s.push(n):null!=(t=jp(e,t))&&(s.push(n),u.set(n,t))}),e=new vs(s),new _p(u.Xe(),e,o.fieldTransforms)}function qp(t,e,n,r,i,o){var s=t.m_(1,e,n),u=[Kp(e,r,n)],a=[i];if(o.length%2!=0)throw new mr(gr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Kp(e,o[c])),a.push(o[c+1]);for(var h,l,f,p=[],d=new Bs,y=u.length-1;0<=y;--y)Qp(p,u[y])||(h=u[y],l=a[y],f=s.E_(h),l instanceof up||l instanceof bp&&l.a_ instanceof up?p.push(h):null!=(f=jp(l,f))&&(p.push(h),d.set(h,f)));return i=new vs(p),new _p(d.Xe(),i,s.fieldTransforms)}function Fp(t,e,n,r){return void 0===r&&(r=!1),jp(n,t.m_(r?4:3,e))}function jp(s,t){if(s instanceof bp&&(s=s.a_),Gp(s))return zp("Unsupported field value:",t,s),Bp(s,t);if(s instanceof sp)return function(t,e){if(!Pp(e.Zl))throw e.t_(t.Jl+"() can only be used with update() and set()");if(!e.path)throw e.t_(t.Jl+"() is not currently supported inside arrays");(t=t.Xl(e))&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.Qe.push(t.path),s instanceof Array){if(t.settings.n_&&4!==t.Zl)throw t.t_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=jp(i[r],t.T_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return xo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Jr.fromDate(t);return{timestampValue:ko(e.serializer,n)}}if(t instanceof Jr){var r=new Jr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ko(e.serializer,r)}}if(t instanceof wp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Cr)return{bytesValue:Po(e.serializer,t.l)};if(t instanceof Ep){if(n=e._,!(r=t.c_).isEqual(n))throw e.t_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ro(t.c_||e._,t.u_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.t_("Unsupported field value: "+Zf(t))}(s,t)}function Bp(t,n){var r={};return Wr(t)?n.path&&0<n.path.length&&n.Qe.push(n.path):Hr(t,function(t,e){null!=(e=jp(e,n.d_(t)))&&(r[t]=e)}),{mapValue:{fields:r}}}function Gp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Jr||t instanceof wp||t instanceof Cr||t instanceof Ep||t instanceof sp)}function zp(t,e,n){if(!Gp(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=Zf(n))?e.t_(t+" a custom object"):e.t_(t+" "+n);var r}function Kp(t,e,n){if(e instanceof rp)return e.Yl;if("string"==typeof e)return Hp(t,e);throw Wp("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Hp(t,e,n){try{return function(e){if(0<=e.search(op))throw new mr(gr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(ip.bind.apply(ip,i([void 0],e.split("."))))}catch(t){throw new mr(gr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).Yl}catch(e){throw Wp(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Wp(t,e,n,r,i){var o=r&&!r.P(),s=void 0!==i,e="Function "+e+"() called with invalid data";return n&&(e+=" (via `toFirestore()`)"),n="",(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new mr(gr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Qp(t,e){return t.some(function(t){return t.isEqual(e)})}var Yp=(td.prototype.y_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.V_(),0<this.mutations.length)throw new mr(gr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var r,e,n,i,o;return v(this,function(t){switch(t.label){case 0:return e=Fo((r=s).serializer)+"/documents",n={documents:u.map(function(t){return Vo(r.serializer,t)})},[4,r.Dc("BatchGetDocuments",e,n)];case 1:return n=t.sent(),i=new Map,n.forEach(function(t){var e,n,t=(n=r.serializer,"found"in t?function(t,e){Dr(!!e.found),e.found.name,e.found.updateTime;var n=Uo(t,e.found.name),t=Lo(e.found.updateTime),e=new js({mapValue:{fields:e.found.fields}});return new Xs(n,t,e,{})}(n,t):"missing"in t?(e=n,Dr(!!(n=t).missing),Dr(!!n.readTime),e=Uo(e,n.missing),n=Lo(n.readTime),new Js(e,n)):Nr());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){Dr(!!(t=i.get(t.toString()))),o.push(t)}),o)]}})})}(this.qc,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Js||t instanceof Xs?n.p_(t):Nr()}),e)]}})})},td.prototype.set=function(t,e){this.write(e.l_(t,this.Ge(t))),this.g_.add(t.toString())},td.prototype.update=function(t,e){try{this.write(e.l_(t,this.b_(t)))}catch(t){this.P_=t}this.g_.add(t.toString())},td.prototype.delete=function(t){this.write([new qs(t,this.Ge(t))]),this.g_.add(t.toString())},td.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.V_(),this.P_)throw this.P_;return e=this.A_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=ni.H(e),n.mutations.push(new Fs(e,n.Ge(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=Fo((e=i).serializer)+"/documents",r={writes:o.map(function(t){return Go(e.serializer,t)})},[4,e.Sc("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.qc,this.mutations)];case 1:return t.sent(),this.R_=!0,[2]}})})},td.prototype.p_=function(t){var e;if(t instanceof Xs)e=t.version;else{if(!(t instanceof Js))throw Nr();e=$r.min()}var n=this.A_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new mr(gr.ABORTED,"Document version changed between two reads.")}else this.A_.set(t.key.toString(),e)},td.prototype.Ge=function(t){var e=this.A_.get(t.toString());return!this.g_.has(t.toString())&&e?bs.updateTime(e):bs.ze()},td.prototype.b_=function(t){var e=this.A_.get(t.toString());if(this.g_.has(t.toString())||!e)return bs.exists(!0);if(e.isEqual($r.min()))throw new mr(gr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return bs.updateTime(e)},td.prototype.write=function(t){this.V_(),this.mutations=this.mutations.concat(t)},td.prototype.V_=function(){},td),Xp=(Zp.prototype.run=function(){this.S_()},Zp.prototype.S_=function(){var t=this;this.ys.Pn(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Yp(this.qc),(n=this.D_(e))&&n.then(function(t){r.cs.ws(function(){return e.commit().then(function(){r.ls.resolve(t)}).catch(function(t){r.C_(t)})})}).catch(function(t){r.C_(t)}),[2]})})})},Zp.prototype.D_=function(t){try{var e=this.updateFunction(t);return!hi(e)&&e.catch&&e.then?e:(this.ls.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ls.reject(t),null}},Zp.prototype.C_=function(t){var e=this;0<this.v_&&this.N_(t)?(--this.v_,this.cs.ws(function(){return e.S_(),Promise.resolve()})):this.ls.reject(t)},Zp.prototype.N_=function(t){return"FirebaseError"===t.name&&("aborted"===(t=t.code)||"failed-precondition"===t||!Ei(t))},Zp),Jp=($p.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.ui.promise];case 1:return[2,(t.sent(),{cs:this.cs,yl:this.yl,clientId:this.clientId,credentials:this.credentials,ql:this.user,Dh:100})]}})})},$p.prototype.F_=function(t){var e=this;this.x_=t,this.ui.promise.then(function(){return e.x_(e.user)})},$p.prototype.O_=function(){if(this.cs.ps)throw new mr(gr.FAILED_PRECONDITION,"The client has already been terminated.")},$p.prototype.terminate=function(){var t=this;this.cs.Ds();var n=new Ju;return this.cs.bs(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.k_?[4,this.k_.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.M_?[4,this.M_.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.ai(),n.resolve(),[3,6];case 5:return e=Ea(t.sent(),"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},$p);function $p(t,e,n){var r=this;this.credentials=t,this.cs=e,this.yl=n,this.user=Oa.UNAUTHENTICATED,this.clientId=Sr.t(),this.x_=function(){},this.ui=new Ju,this.credentials.oi(function(t){Er("FirestoreClient","Received user=",t.uid),r.user.isEqual(t)||(r.user=t,r.x_(t)),r.ui.resolve()})}function Zp(t,e,n,r){this.cs=t,this.qc=e,this.updateFunction=n,this.ls=r,this.v_=5,this.ys=new $u(this.cs,"transaction_retry")}function td(t){this.qc=t,this.A_=new Map,this.mutations=[],this.R_=!1,this.P_=null,this.g_=new Set}function ed(r,i){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return r.cs.Fs(),Er("FirestoreClient","Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return e=t.sent(),[4,i.initialize(e)];case 2:return t.sent(),r.F_(function(e){return r.cs.Cs(function(){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Ph(i.Bc,e)];case 1:return t.sent(),[2]}})})})}),i.persistence.ha(function(){return r.terminate()}),r.M_=i,[2]}})})}function nd(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return r.cs.Fs(),[4,rd(r)];case 1:return e=t.sent(),Er("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.F_(function(t){return r.cs.Cs(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).cs.Fs(),Er("RemoteStore","RemoteStore received new credentials"),n=sl(e),e.Wc.add(3),[4,Zh(e)];case 1:return t.sent(),n&&e.Hc.set("Unknown"),[4,e.Uc.Gl(i)];case 2:return t.sent(),e.Wc.delete(3),[4,$h(e)];case 3:return t.sent(),[2]}})})}(i.ph,t)})}),r.k_=i,[2]}})})}function rd(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.M_?[3,2]:(Er("FirestoreClient","Using default OfflineComponentProvider"),[4,ed(e,new Ff)]);case 1:t.sent(),t.label=2;case 2:return[2,e.M_]}})})}function id(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.k_?[3,2]:(Er("FirestoreClient","Using default OnlineComponentProvider"),[4,nd(e,new Gf)]);case 1:t.sent(),t.label=2;case 2:return[2,e.k_]}})})}function od(t){return rd(t).then(function(t){return t.persistence})}function sd(t){return rd(t).then(function(t){return t.Bc})}function ud(t){return id(t).then(function(t){return t.ph})}function ad(t){return id(t).then(function(t){return t.mu})}function cd(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,id(r)];case 1:return e=t.sent(),[2,((n=e.bh).Us=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=sf(s),(o=e.Nh.get(u))?(n=o.targetId,e.Sh.Bu(n),r=o.view.yh(),[3,4]):[3,1];case 1:return[4,Rh(e.Bc,lu(u))];case 2:return i=t.sent(),o=e.Sh.Bu(i.targetId),n=i.targetId,[4,Kl(e,u,n,"current"===o)];case 3:r=t.sent(),e.Uh&&tl(e.ph,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.mu),n.Ws=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Nh.get(o),1<(r=e.xh.get(n.targetId)).length?[2,(e.xh.set(n.targetId,r.filter(function(t){return!yu(t,o)})),void e.Nh.delete(o))]:e.Uh?(e.Sh.Uu(n.targetId),e.Sh.Ou(n.targetId)?[3,2]:[4,Ch(e.Bc,n.targetId,!1).then(function(){e.Sh.Qu(n.targetId),el(e.ph,n.targetId),$l(e,n.targetId)}).catch(Mh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return $l(e,n.targetId),[4,Ch(e.Bc,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.mu),n)]}})})}function hd(n,t,e,r){var i=this,o=new zf(r),s=new Sa(t,o,e);return n.cs.ws(function(){return y(i,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Aa,[4,cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),s])]}})})}),function(){o.Hl(),n.cs.ws(function(){return y(i,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Na,[4,cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),s])]}})})})}}function ld(n,r){var t=this,i=new Ju;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Hl,[4,ad(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}function fd(n,t){var e=this,r=new zf(t);return n.cs.ws(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.qs.add(e),e.next()},[4,cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Hl(),n.cs.ws(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.qs.delete(e)},[4,cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}function pd(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var dd=(gd.prototype.U_=function(t){switch(co(t)){case 0:return null;case 1:return t.booleanValue;case 2:return go(t.integerValue||t.doubleValue);case 3:return this.K_(t.timestampValue);case 4:return this.Q_(t);case 5:return t.stringValue;case 6:return this.q_(mo(t.bytesValue));case 7:return this.W_(t.referenceValue);case 8:return this.j_(t.geoPointValue);case 9:return this.G_(t.arrayValue);case 10:return this.z_(t.mapValue);default:throw Nr()}},gd.prototype.z_=function(t){var n=this,r={};return Hr(t.fields||{},function(t,e){r[t]=n.U_(e)}),r},gd.prototype.j_=function(t){return new wp(go(t.latitude),go(t.longitude))},gd.prototype.G_=function(t){var e=this;return(t.values||[]).map(function(t){return e.U_(t)})},gd.prototype.Q_=function(t){switch(this.L_){case"previous":var e=function t(e){return so(e=e.mapValue.fields.__previous_value__)?t(e):e}(t);return null==e?null:this.U_(e);case"estimate":return this.K_(uo(t));default:return null}},gd.prototype.K_=function(t){return t=vo(t),new Jr(t.seconds,t.nanos)},gd.prototype.W_=function(t){var e=Zr.q(t);return Dr($o(e)),t=new Br(e.get(1),e.get(3)),e=new ni(e.N(5)),t.isEqual(this._)||Tr("Document "+e+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+this._.projectId+"/"+this._.database+") instead."),this.B_(e)},gd),yd=(vd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},vd);function vd(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new mr(gr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new mr(gr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,$f("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function gd(t,e,n,r){this._=t,this.L_=e,this.B_=n,this.q_=r}function md(n,r,i){var t=this,o=new Ju;return n.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,ed(n,i)];case 1:return t.sent(),[4,nd(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===gr.FAILED_PRECONDITION||t.code===gr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function wd(t){if(t.Y_||t.J_)throw new mr(gr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var bd="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Id=(Nd.prototype.enableIndexedDbPersistence=function(t,e){throw new mr(gr.FAILED_PRECONDITION,bd)},Nd.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new mr(gr.FAILED_PRECONDITION,bd)},Nd.prototype.clearIndexedDbPersistence=function(t){throw new mr(gr.FAILED_PRECONDITION,bd)},Nd),Ed=(Ad.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){wd(t);var n=Dd(t),r=t.H_();return md(n,t=new Gf,new jf(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t,{forceOwnership:e})},Ad),Td=(Object.defineProperty(_d.prototype,"Y_",{get:function(){return!!this.nf},enumerable:!1,configurable:!0}),Object.defineProperty(_d.prototype,"J_",{get:function(){return this.X_.ps},enumerable:!1,configurable:!0}),Object.defineProperty(_d.prototype,"af",{get:function(){return this.cf||(this.cf=new Rp(this.c_,this.rf.ignoreUndefinedProperties)),this.cf},enumerable:!1,configurable:!0}),_d.prototype.settings=function(t){if(t.merge&&delete(t=Object.assign(Object.assign({},this.rf),t)).merge,t=new yd(t),this.nf&&!this.rf.isEqual(t))throw new mr(gr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");void 0!==(this.rf=t).credentials&&(this.if=function(t){if(!t)return new La;switch(t.type){case"gapi":var e=t.client;return Dr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Va(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new mr(gr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},_d.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this.rf.host&&_r("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},_d.prototype.enableNetwork=function(){return Dd(this),function(r){var t=this;return r.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,od(r)];case 1:return e=t.sent(),[4,ud(r)];case 2:return n=t.sent(),[2,(e.la(!0),(t=n).Wc.delete(0),$h(t))]}})})})}(this.nf)},_d.prototype.disableNetwork=function(){return Dd(this),function(r){var t=this;return r.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,od(r)];case 1:return e=t.sent(),[4,ud(r)];case 2:return n=t.sent(),[2,(e.la(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Wc.add(0),[4,Zh(e)];case 1:return t.sent(),e.Hc.set("Offline"),[2]}})})}(n))]}})})})}(this.nf)},_d.prototype.enablePersistence=function(t){if(this.nf)throw new mr(gr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1,n=!1;return t&&$f("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.tf.enableMultiTabIndexedDbPersistence(this):this.tf.enableIndexedDbPersistence(this,n)},_d.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2,this.tf.clearIndexedDbPersistence(this)]})})},_d.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},_d.prototype.waitForPendingWrites=function(){return Dd(this),function(n){var t=this,r=new Ju;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Yl,[4,ad(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(this.nf)},_d.prototype.onSnapshotsInSync=function(t){return Dd(this),pd(t)||(t={next:t}),fd(this.nf,t)},_d.sf=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new mr(gr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e;if(!(t=t.options.projectId)||"string"!=typeof t)throw new mr(gr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Br(t)},Object.defineProperty(_d.prototype,"app",{get:function(){if(!this.ef)throw new mr(gr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.ef},enumerable:!1,configurable:!0}),_d.prototype.collection=function(t){return Xf("Firestore.collection","path",t),Dd(this),new Xd(Zr.q(t),this,null)},_d.prototype.doc=function(t){return Xf("Firestore.doc","path",t),Dd(this),Ld.uf(Zr.q(t),this,null)},_d.prototype.collectionGroup=function(t){if(Xf("Firestore.collectionGroup","collectionId",t),0<=t.indexOf("/"))throw new mr(gr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return Dd(this),new Qd(new Zs(Zr.U(),t),this,null)},_d.prototype.runTransaction=function(e){var n=this;return function(n,r){var t=this,i=new Ju;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,id(n).then(function(t){return t.qc})];case 1:return e=t.sent(),new Xp(n.cs,e,r,i).run(),[2]}})})}),i.promise}(Dd(this),function(t){return e(new kd(n,t))})},_d.prototype.batch=function(){return Dd(this),new Pd(this)},_d.prototype.H_=function(){return this.rf},_d);function _d(t,e,n){var r=this;if(void 0===n&&(n=new Id),this.tf=n,this.ef=null,this.X_=new wa,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.nf||Sd(this),[4,this.nf.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options)n=t,this.ef=n,this.c_=_d.sf(n),this.Z_=n.name,this.if=new Ra(e);else{if(!t.projectId)throw new mr(gr.INVALID_ARGUMENT,"Must provide projectId");this.c_=new Br(t.projectId,t.database),this.Z_="[DEFAULT]",this.if=new La}this.rf=new yd({})}function Ad(){this.enableMultiTabIndexedDbPersistence=function(t){wd(t);var e=Dd(t),n=t.H_();return md(e,t=new Gf,new Bf(t,n.cacheSizeBytes))}.bind(null),this.clearIndexedDbPersistence=function(n){var t=this;if(n.Y_&&!n.J_)throw new mr(gr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new Ju;return n.X_.bs(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return ta.Ln()?(e=n+"main",[4,ta.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(Oh(n.c_,n.Z_))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}.bind(null)}function Nd(){}function Dd(t){return t.nf||Sd(t),t.nf.O_(),t.nf}function Sd(t){var e,n,r=t.H_(),r=(e=t.c_,n=t.Z_,new jr(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.nf=new Jp(t.if,t.X_,r)}var Od,xd,kd=(Bd.prototype.get=function(t){var e=this,n=ty(0,t,this.hf);return this.lf.y_([n.u_]).then(function(t){if(!t||1!==t.length)return Nr();if((t=t[0])instanceof Js)return new Cd(e.hf,n.u_,null,!1,!1,n.h_);if(t instanceof Xs)return new Cd(e.hf,n.u_,t,!1,!1,n.h_);throw Nr()})},Bd.prototype.set=function(t,e,n){return t=ty(0,t,this.hf),n=Jf("Transaction.set",n),e=ey(t.h_,e,n),n=Up(this.hf.af,"Transaction.set",t.u_,e,null!==t.h_,n),this.lf.set(t.u_,n),this},Bd.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return e="string"==typeof e||e instanceof ip?(r=ty(0,t,this.hf),qp(this.hf.af,"Transaction.update",r.u_,e,n,i)):(r=ty(0,t,this.hf),Mp(this.hf.af,"Transaction.update",r.u_,e)),this.lf.update(r.u_,e),this},Bd.prototype.delete=function(t){return t=ty(0,t,this.hf),this.lf.delete(t.u_),this},Bd),Pd=(jd.prototype.set=function(t,e,n){return this.df(),t=ty(0,t,this.hf),n=Jf("WriteBatch.set",n),e=ey(t.h_,e,n),n=Up(this.hf.af,"WriteBatch.set",t.u_,e,null!==t.h_,n),this._f=this._f.concat(n.l_(t.u_,bs.ze())),this},jd.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return this.df(),e="string"==typeof e||e instanceof ip?(r=ty(0,t,this.hf),qp(this.hf.af,"WriteBatch.update",r.u_,e,n,i)):(r=ty(0,t,this.hf),Mp(this.hf.af,"WriteBatch.update",r.u_,e)),this._f=this._f.concat(e.l_(r.u_,bs.exists(!0))),this},jd.prototype.delete=function(t){return this.df(),t=ty(0,t,this.hf),this._f=this._f.concat(new qs(t.u_,bs.ze())),this},jd.prototype.commit=function(){return this.df(),this.ff=!0,0<this._f.length?ld(Dd(this.hf),this._f):Promise.resolve()},jd.prototype.df=function(){if(this.ff)throw new mr(gr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},jd),Ld=(n(Fd,xd=Ep),Fd.uf=function(t,e,n){if(t.length%2!=0)throw new mr(gr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.B()+" has "+t.length);return new Fd(new ni(t),e,n)},Object.defineProperty(Fd.prototype,"id",{get:function(){return this.u_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(Fd.prototype,"parent",{get:function(){return new Xd(this.u_.path.F(),this.firestore,this.h_)},enumerable:!1,configurable:!0}),Object.defineProperty(Fd.prototype,"path",{get:function(){return this.u_.path.B()},enumerable:!1,configurable:!0}),Fd.prototype.collection=function(t){if(Xf("DocumentReference.collection","path",t),!t)throw new mr(gr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");return t=Zr.q(t),new Xd(this.u_.path.child(t),this.firestore,null)},Fd.prototype.isEqual=function(t){return t instanceof Fd&&this.firestore===t.firestore&&this.u_.isEqual(t.u_)&&this.h_===t.h_},Fd.prototype.set=function(t,e){return e=Jf("DocumentReference.set",e),t=ey(this.h_,t,e),e=Up(this.firestore.af,"DocumentReference.set",this.u_,t,null!==this.h_,e),ld(this.nf,e.l_(this.u_,bs.ze()))},Fd.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return t="string"==typeof t||t instanceof ip?qp(this.firestore.af,"DocumentReference.update",this.u_,t,e,n):Mp(this.firestore.af,"DocumentReference.update",this.u_,t),ld(this.nf,t.l_(this.u_,bs.exists(!0)))},Fd.prototype.delete=function(){return ld(this.nf,[new qs(this.u_,bs.ze())])},Fd.prototype.onSnapshot=function(){for(var e=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||pd(n[i])||(r=n[i],i++);var o={includeMetadataChanges:r.includeMetadataChanges};pd(n[i])&&(s=n[i],n[i]=null===(r=s.next)||void 0===r?void 0:r.bind(s),n[i+1]=null===(r=s.error)||void 0===r?void 0:r.bind(s),n[i+2]=null===(r=s.complete)||void 0===r?void 0:r.bind(s));var s={next:function(t){n[i]&&n[i](e.wf(t))},error:n[i+1],complete:n[i+2]};return hd(this.nf,iu(this.u_.path),o,s)},Fd.prototype.get=function(t){var e=this;return t&&"cache"===t.source?function(n,r){var t=this,i=new Ju;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=o,(n=i).persistence.runTransaction("read document","readonly",function(t){return n.Ka.Mi(t,e)}))];case 1:return(r=t.sent())instanceof Xs?s.resolve(r):r instanceof Js?s.resolve(null):s.reject(new mr(gr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=Ea(r=t.sent(),"Failed to get document '"+o+" from cache"),s.reject(r),[3,3];case 3:return[2]}var e,n})})},[4,sd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(this.nf,this.u_).then(function(t){return new Cd(e.firestore,e.u_,t,!0,t instanceof Xs&&t.Je,e.h_)}):function(n,r,i){var t=this;void 0===i&&(i={});var o=new Ju;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new zf({next:function(t){r.ws(function(){return Na(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new mr(gr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new mr(gr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new Sa(iu(i.path),t,{includeMetadataChanges:!0,Xs:!0});return Aa(n,u)},[4,cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.cs,r,i,o])]}})})}),o.promise}(this.nf,this.u_,t).then(function(t){return e.wf(t)})},Fd.prototype.withConverter=function(t){return new Fd(this.u_,this.firestore,t)},Fd.prototype.wf=function(t){var e=t.docs.get(this.u_);return new Cd(this.firestore,this.u_,e,t.fromCache,t.hasPendingWrites,this.h_)},Fd),Rd=(qd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},qd),Cd=(Md.prototype.data=function(t){var e=this;if(void 0===t&&(t={}),this.Ef){if(this.h_){var n=new Vd(this.hf,this.u_,this.Ef,this.Tf,this.If,null);return this.h_.fromFirestore(n,t)}return new dd(this.hf.c_,t.serverTimestamps||"none",function(t){return new Ld(t,e.hf,null)},function(t){return new Fr(t)}).U_(this.Ef.rn())}},Md.prototype.get=function(t,e){var n=this;if(void 0===e&&(e={}),this.Ef&&null!==(t=this.Ef.data().field(Kp("DocumentSnapshot.get",t,this.u_))))return new dd(this.hf.c_,e.serverTimestamps||"none",function(t){return new Ld(t,n.hf,n.h_)},function(t){return new Fr(t)}).U_(t)},Object.defineProperty(Md.prototype,"id",{get:function(){return this.u_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(Md.prototype,"ref",{get:function(){return new Ld(this.u_,this.hf,this.h_)},enumerable:!1,configurable:!0}),Object.defineProperty(Md.prototype,"exists",{get:function(){return null!==this.Ef},enumerable:!1,configurable:!0}),Object.defineProperty(Md.prototype,"metadata",{get:function(){return new Rd(this.If,this.Tf)},enumerable:!1,configurable:!0}),Md.prototype.isEqual=function(t){return t instanceof Md&&this.hf===t.hf&&this.Tf===t.Tf&&this.u_.isEqual(t.u_)&&(null===this.Ef?null===t.Ef:this.Ef.isEqual(t.Ef))&&this.h_===t.h_},Md),Vd=(n(Ud,Od=Cd),Ud.prototype.data=function(t){return Od.prototype.data.call(this,t)},Ud);function Ud(){return null!==Od&&Od.apply(this,arguments)||this}function Md(t,e,n,r,i,o){this.hf=t,this.u_=e,this.Ef=n,this.Tf=r,this.If=i,this.h_=o}function qd(t,e){this.hasPendingWrites=t,this.fromCache=e}function Fd(t,e,n){var r=this;return(r=xd.call(this,e.c_,t,n)||this).u_=t,r.firestore=e,r.h_=n,r.nf=Dd(e),r}function jd(t){this.hf=t,this._f=[],this.ff=!1}function Bd(t,e){this.hf=t,this.lf=e}function Gd(t,e,n){if("string"==typeof n){if(""===n)throw new mr(gr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!cu(e)&&-1!==n.indexOf("/"))throw new mr(gr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(e=e.path.child(Zr.q(n)),!ni.X(e))throw new mr(gr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return wo(t,new ni(e))}if(n instanceof Ep)return wo(t,n.u_);throw new mr(gr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Zf(n)+".")}function zd(t,e){if(!Array.isArray(t)||0===t.length)throw new mr(gr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new mr(gr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Kd(t,e,n){if(!n.isEqual(e))throw new mr(gr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Hd(t){if(su(t)&&0===t.on.length)throw new mr(gr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Wd,Qd=(Zd.prototype.where=function(t,e,n){return t=Kp("Query.where",t),e=function(t,e,n,r,i,o){if(r.W()){if("array-contains"===i||"array-contains-any"===i)throw new mr(gr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){zd(o,i);for(var s=[],u=0,a=o;u<a.length;u++){var c=a[u];s.push(Gd(n,t,c))}h={arrayValue:{values:s}}}else h=Gd(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||zd(o,i),h=Fp(e,"Query.where",o,"in"===i||"not-in"===i);var h=Iu.create(r,i,h);return function(t,e){if(e.hn()){var n=au(t);if(null!==n&&!n.isEqual(e.field))throw new mr(gr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");null!==(n=uu(t))&&Kd(0,e.field,n)}if(null!==(t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw t===e.op?new mr(gr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new mr(gr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(this.mf,this.firestore.af,this.firestore.c_,t,e,n),new Zd((e=(n=this.mf).filters.concat([e]),new Zs(n.path,n.collectionGroup,n.on.slice(),e,n.limit,n.an,n.startAt,n.endAt)),this.firestore,this.h_)},Zd.prototype.orderBy=function(t,e){if(void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new mr(gr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var n,t=Kp("Query.orderBy",t),t=function(t,e,n){if(null!==t.startAt)throw new mr(gr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new mr(gr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return n=e=new Xu(e,n),null!==uu(t)||null!==(t=au(t))&&Kd(0,t,n.field),e}(this.mf,t,n);return new Zd((t=(n=this.mf).on.concat([t]),new Zs(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.an,n.startAt,n.endAt)),this.firestore,this.h_)},Zd.prototype.limit=function(t){return tp("Query.limit",t),new Zd(fu(this.mf,t,"F"),this.firestore,this.h_)},Zd.prototype.limitToLast=function(t){return tp("Query.limitToLast",t),new Zd(fu(this.mf,t,"L"),this.firestore,this.h_)},Zd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t=this.Af("Query.startAt",t,e,!0),new Zd(pu(this.mf,t),this.firestore,this.h_)},Zd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t=this.Af("Query.startAfter",t,e,!1),new Zd(pu(this.mf,t),this.firestore,this.h_)},Zd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t=this.Af("Query.endBefore",t,e,!0),new Zd(du(this.mf,t),this.firestore,this.h_)},Zd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t=this.Af("Query.endAt",t,e,!1),new Zd(du(this.mf,t),this.firestore,this.h_)},Zd.prototype.isEqual=function(t){return t instanceof Zd&&this.firestore===t.firestore&&yu(this.mf,t.mf)&&this.h_===t.h_},Zd.prototype.withConverter=function(t){return new Zd(this.mf,this.firestore,t)},Zd.prototype.Af=function(c,t,e,n){return t instanceof Cd?function(t,e,n,r){if(!n)throw new mr(gr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=hu(t);o<s.length;o++){var u=s[o];if(u.field.W())i.push(wo(e,n.key));else{var a=n.field(u.field);if(so(a))throw new mr(gr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a)throw u=u.field.B(),new mr(gr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.");i.push(a)}}return new ju(i,r)}(this.mf,this.firestore.c_,t.Ef,n):(e=[t].concat(e),function(t,e,n,r,i,o){var s=t.on;if(i.length>s.length)throw new mr(gr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.W()){if("string"!=typeof c)throw new mr(gr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!cu(t)&&-1!==c.indexOf("/"))throw new mr(gr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Zr.q(c));if(!ni.X(h))throw new mr(gr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new ni(h),u.push(wo(e,h))}else c=Fp(n,r,c),u.push(c)}return new ju(u,o)}(this.mf,this.firestore.c_,this.firestore.af,c,e,n))},Zd.prototype.onSnapshot=function(){for(var t,e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i={},o=0;"object"!=typeof n[o]||pd(n[o])||(i=n[o],o++),pd(n[o])&&(s=n[o],n[o]=null===(t=s.next)||void 0===t?void 0:t.bind(s),n[o+1]=null===(t=s.error)||void 0===t?void 0:t.bind(s),n[o+2]=null===(t=s.complete)||void 0===t?void 0:t.bind(s));var s={next:function(t){n[o]&&n[o](new Yd(e.firestore,e.mf,t,e.h_))},error:n[o+1],complete:n[o+2]};return Hd(this.mf),hd(Dd(this.firestore),this.mf,i,s)},Zd.prototype.get=function(t){var e=this;Hd(this.mf);var n=Dd(this.firestore);return(t&&"cache"===t.source?function(n,r){var t=this,i=new Ju;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Vh(r,i,!0)];case 1:return n=t.sent(),e=new Pl(i,n.za),n=e.wh(n.documents),n=e.Di(n,!1),o.resolve(n.snapshot),[3,3];case 2:return n=Ea(n=t.sent(),"Failed to execute query '"+i+" against cache"),o.reject(n),[3,3];case 3:return[2]}})})},[4,sd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(n,this.mf):function(n,r,i){var t=this;void 0===i&&(i={});var o=new Ju;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new zf({next:function(t){n.ws(function(){return Na(e,s)}),t.fromCache&&"server"===r.source?i.reject(new mr(gr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new Sa(t,o,{includeMetadataChanges:!0,Xs:!0});return Aa(e,s)},[4,cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.cs,r,i,o])]}})})}),o.promise}(n,this.mf,t)).then(function(t){return new Yd(e.firestore,e.mf,t,e.h_)})},Zd),Yd=(Object.defineProperty($d.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty($d.prototype,"empty",{get:function(){return this.Pf.docs.P()},enumerable:!1,configurable:!0}),Object.defineProperty($d.prototype,"size",{get:function(){return this.Pf.docs.size},enumerable:!1,configurable:!0}),$d.prototype.forEach=function(e,n){var r=this;this.Pf.docs.forEach(function(t){e.call(n,r.Vf(t,r.metadata.fromCache,r.Pf.Qt.has(t.key)))})},Object.defineProperty($d.prototype,"query",{get:function(){return new Qd(this.Rf,this.hf,this.h_)},enumerable:!1,configurable:!0}),$d.prototype.docChanges=function(t){if((t=!(!t||!t.includeMetadataChanges))&&this.Pf.jt)throw new mr(gr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.gf&&this.yf===t||(this.gf=function(i,e,o){if(i.Kt.P()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Kt;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Nr()}}(),doc:e,oldIndex:n,newIndex:r}})}(this.Pf,t,this.Vf.bind(this)),this.yf=t),this.gf},$d.prototype.isEqual=function(t){return t instanceof $d&&this.hf===t.hf&&yu(this.Rf,t.Rf)&&this.Pf.isEqual(t.Pf)&&this.h_===t.h_},$d.prototype.Vf=function(t,e,n){return new Vd(this.hf,t.key,t,e,n,this.h_)},$d),Xd=(n(Jd,Wd=Qd),Object.defineProperty(Jd.prototype,"id",{get:function(){return this.mf.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(Jd.prototype,"parent",{get:function(){var t=this.mf.path.F();return t.P()?null:new Ld(new ni(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(Jd.prototype,"path",{get:function(){return this.mf.path.B()},enumerable:!1,configurable:!0}),Jd.prototype.doc=function(t){return 0===arguments.length&&(t=Sr.t()),Xf("CollectionReference.doc","path",t),t=Zr.q(t),Ld.uf(this.mf.path.child(t),this.firestore,this.h_)},Jd.prototype.add=function(t){var t=this.h_?this.h_.toFirestore(t):t,e=this.doc();return new Ld(e.u_,this.firestore,null).set(t).then(function(){return e})},Jd.prototype.withConverter=function(t){return new Jd(this.pf,this.firestore,t)},Jd);function Jd(t,e,n){var r=this;if(((r=Wd.call(this,iu(t),e,n)||this).pf=t).length%2!=1)throw new mr(gr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.B()+" has "+t.length);return r}function $d(t,e,n,r){this.hf=t,this.Rf=e,this.Pf=n,this.h_=r,this.gf=null,this.yf=null,this.metadata=new Rd(n.hasPendingWrites,n.fromCache)}function Zd(t,e,n){this.mf=t,this.firestore=e,this.h_=n}function ty(t,e,n){if((e=function(t,e){if(t instanceof e)return t;if(e.name===t.constructor.name)throw new mr(gr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw t=Zf(t),new mr(gr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}(e,Ld)).firestore!==n)throw new mr(gr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function ey(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var ny,ge=(n(ry,ny=bp),ry.serverTimestamp=function(){var t=new yp("serverTimestamp");return t.Jl="FieldValue.serverTimestamp",new ry(t)},ry.delete=function(){var t=new up("deleteField");return t.Jl="FieldValue.delete",new ry(t)},ry.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vp("arrayUnion",t)}.apply(void 0,t);return n.Jl="FieldValue.arrayUnion",new ry(n)},ry.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gp("arrayRemove",t)}.apply(void 0,t);return n.Jl="FieldValue.arrayRemove",new ry(n)},ry.increment=function(t){return(t=new mp("increment",t)).Jl="FieldValue.increment",new ry(t)},ry.prototype.isEqual=function(t){return this.a_.isEqual(t.a_)},ry),ge={Firestore:Td,GeoPoint:wp,Timestamp:Jr,Blob:Fr,Transaction:kd,WriteBatch:Pd,DocumentReference:Ld,DocumentSnapshot:Cd,Query:Qd,QueryDocumentSnapshot:Vd,QuerySnapshot:Yd,CollectionReference:Xd,FieldPath:ip,FieldValue:ge,setLogLevel:function(t){wr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function ry(){return null!==ny&&ny.apply(this,arguments)||this}(e=e.default).INTERNAL.registerComponent(new A("firestore",function(t){return e=t.getProvider("app").getImmediate(),t=t.getProvider("auth-internal"),new Td(e,t,new Ed);var e},"PUBLIC").setServiceProps(Object.assign({},ge))),e.registerVersion("@firebase/firestore","2.0.1")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});