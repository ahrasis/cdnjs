!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Qg){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var l,e=t(Qg);function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(Je=l=l||{})[Je.DEBUG=0]="DEBUG",Je[Je.VERBOSE=1]="VERBOSE",Je[Je.INFO=2]="INFO",Je[Je.WARN=3]="WARN",Je[Je.ERROR=4]="ERROR",Je[Je.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=u[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var r={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},i=l.INFO,u=((We={})[l.DEBUG]="log",We[l.VERBOSE]="log",We[l.INFO]="info",We[l.WARN]="warn",We[l.ERROR]="error",We),o=(Object.defineProperty(a.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),a.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?r[t]:t},Object.defineProperty(a.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),a.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},a.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},a.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},a.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},a.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},a);function a(t){this.name=t,this._logLevel=i,this._logHandler=n,this._userLogHandler=null}var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function h(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function f(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,g="FirebaseError",m=(h(b,d=Error),b);function b(t,e,n){e=d.call(this,e)||this;return e.code=t,e.customData=n,e.name=g,Object.setPrototypeOf(e,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,w.prototype.create),e}var w=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(I,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I=/\{\$([^}]+)}/g,_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function T(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},x={},S=A||self;function O(){}function D(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function k(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),P=0;function C(t,e,n){return t.call.apply(t.bind,arguments)}function R(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function M(t,e,n){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?C:R).apply(null,arguments)}function V(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function U(){return Date.now()}function F(t,o){function e(){}e.prototype=o.prototype,t.Y=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Kb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},j=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function G(t){return/^[\s\xa0]*$/.test(t)}var K,z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function W(t,e){return t<e?-1:e<t?1:0}t:{var X=S.navigator;if(X){X=X.userAgent;if(X){K=X;break t}}K=""}function Y(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Q(t){var e,n={};for(e in t)n[e]=t[e];return n}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Z.length;i++)e=Z[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function tt(t){return tt[" "](t),t}tt[" "]=O;var et,nt=J(K,"Opera"),rt=J(K,"Trident")||J(K,"MSIE"),it=J(K,"Edge"),ot=it||rt,st=J(K,"Gecko")&&!(J(K.toLowerCase(),"webkit")&&!J(K,"Edge"))&&!(J(K,"Trident")||J(K,"MSIE"))&&!J(K,"Edge"),ut=J(K.toLowerCase(),"webkit")&&!J(K,"Edge");function at(){var t=S.document;return t?t.documentMode:void 0}t:{var ct="",ht=(ht=K,st?/rv:([^\);]+)(\)|;)/.exec(ht):it?/Edge\/([\d\.]+)/.exec(ht):rt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ht):ut?/WebKit\/(\S+)/.exec(ht):nt?/(?:Version)[ \/]?(\S+)/.exec(ht):void 0);if(ht&&(ct=ht?ht[1]:""),rt){ht=at();if(null!=ht&&ht>parseFloat(ct)){et=String(ht);break t}}et=ct}var ft={};function lt(u){return t=u,e=function(){for(var t=0,e=z(String(et)).split("."),n=z(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=W(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||W(0==o[2].length,0==s[2].length)||W(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=ft,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var pt=S.document&&rt?at()||(parseInt(et,10)||void 0):void 0;function dt(t,e,n){this.reset(t,e,n,void 0,void 0)}function yt(t){this.g=t,this.a=this.f=this.b=this.c=null}function vt(t,e){this.name=t,this.value=e}dt.prototype.a=null,dt.prototype.reset=function(t,e,n,r,i){this.c=r||U(),this.f=t,this.g=e,this.b=n,delete this.a},vt.prototype.toString=function(){return this.name};var gt=new vt("SEVERE",1e3),mt=new vt("WARNING",900),bt=new vt("INFO",800),wt=new vt("CONFIG",700),Et=new vt("FINE",500);yt.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.b?e.b:e.c?t(e.c):null}(this).value)for("function"==typeof e&&(e=e()),t=new dt(t,String(e),this.g),n&&(t.a=n),n=this;n;){var r=n,i=t;if(r.a)for(var o=0;e=r.a[o];o++)e(i);n=n.c}},yt.prototype.info=function(t,e){this.log(bt,t,e)};var It={},_t=null;function Tt(t){var e,n,r;return _t||(_t=new yt(""),(It[""]=_t).b=wt),(e=It[t])||(e=new yt(t),r=t.lastIndexOf("."),n=t.substr(r+1),(r=Tt(t.substr(0,r))).f||(r.f={}),(r.f[n]=e).c=r,It[t]=e),e}function Nt(){this.a=U()}var At=null;function xt(t){this.f=t||"",At=At||new Nt,this.g=At}function St(t){return t<10?"0"+t:String(t)}function Ot(t){xt.call(this,t)}function Dt(t,e){var n,r=[];return r.push(t.f," "),t.b&&(n=new Date(e.c),r.push("[",St(n.getFullYear()-2e3)+St(n.getMonth()+1)+St(n.getDate())+" "+St(n.getHours())+":"+St(n.getMinutes())+":"+St(n.getSeconds())+"."+St(Math.floor(n.getMilliseconds()/10)),"] ")),r.push("[",function(t,e){e=(t=(t.c-e)/1e3).toFixed(3);var n=0;if(t<1)n=2;else for(;t<100;)n++,t*=10;for(;0<n--;)e=" "+e;return e}(e,t.g.get()),"s] "),r.push("[",e.b,"] "),r.push(e.g),t.c&&(e=e.a)&&r.push("\n",e instanceof Error?e.message:e.toString()),t.a&&r.push("\n"),r.join("")}function kt(t,e){t&&t.log(mt,e,void 0)}function Lt(t,e){t&&t.info(e,void 0)}function Pt(t,e){t&&t.log(Et,e,void 0)}function Ct(){this.g=M(this.c,this),this.a=new Ot,this.a.b=!1,this.a.c=!1,this.b=this.a.a=!1,this.f={}}Nt.prototype.set=function(t){this.a=t},Nt.prototype.reset=function(){this.set(U())},Nt.prototype.get=function(){return this.a},xt.prototype.a=!0,xt.prototype.b=!0,xt.prototype.c=!1,F(Ot,xt),Ct.prototype.c=function(t){var e,n,r;this.f[t.b]||(r=Dt(this.a,t),Rt&&(n=function(t){if(t){if(t.value>=gt.value)return"error";if(t.value>=mt.value)return"warn";if(t.value>=wt.value)return"log"}return"debug"}(t.f),e=Rt,n=n,r=r,t=t.a,e[n]?e[n](r,t||""):e.log(r,t||"")))};var Rt=S.console;function Mt(){this.m=this.m,this.j=this.j}Mt.prototype.m=!1,Mt.prototype.ja=function(){var t;!this.m&&(this.m=!0,this.H(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,L)&&t[L]||(t[L]=++P))},Mt.prototype.H=function(){if(this.j)for(;this.j.length;)this.j.shift()()};var Vt=!rt||9<=Number(pt),Ut=rt&&!lt("9"),Ft=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",O,e),S.removeEventListener("test",O,e)}catch(t){}return t}();function qt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function jt(t,e){if(qt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(st){t:{try{tt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Bt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}qt.prototype.b=function(){this.defaultPrevented=!0},F(jt,qt);var Bt={2:"touch",3:"pen",4:"mouse"};jt.prototype.b=function(){jt.Y.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Ut)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Ht="closure_listenable_"+(1e6*Math.random()|0),Gt=0;function Kt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Gt,this.Z=this.$=!1}function zt(t){t.Z=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Jt(t){this.src=t,this.a={},this.b=0}function Wt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=q(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(zt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Xt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Z&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Jt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Xt(t,e,r,i);return-1<s?(e=t[s],n||(e.$=!1)):((e=new Kt(e,this.src,o,!!r,i)).$=n,t.push(e)),e};var Yt="closure_lm_"+(1e6*Math.random()|0),Qt={};function Zt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=se(r);return e&&e[Ht]?e.wa(n,r,k(i)?!!i.capture:!!i,o):$t(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Zt(t,e[o],n,r,i);return null}return n=se(n),t&&t[Ht]?t.va(e,n,k(r)?!!r.capture:!!r,i):$t(t,e,n,!1,r,i)}function $t(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=k(i)?!!i.capture:!!i;if(s&&!Vt)return null;var u,a,c=ie(t);if(c||(t[Yt]=c=new Jt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=re,r=a=Vt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Ft||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(ee(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function te(t){var e,n,r;"number"!=typeof t&&t&&!t.Z&&((e=t.src)&&e[Ht]?Wt(e.f,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(ee(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ie(e))?(Wt(n,t),0==n.b&&(n.src=null,e[Yt]=null)):zt(t)))}function ee(t){return t in Qt?Qt[t]:Qt[t]="on"+t}function ne(t,e){var n=t.listener,r=t.ca||t.src;return t.$&&te(t),n.call(r,e)}function re(t,e){if(t.Z)return!0;if(Vt)return ne(t,new jt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return ne(t,e=new jt(e,this))}function ie(t){return(t=t[Yt])instanceof Jt?t:null}var oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function se(e){return"function"==typeof e?e:(e[oe]||(e[oe]=function(t){return e.handleEvent(t)}),e[oe])}function ue(){Mt.call(this),this.f=new Jt(this),(this.L=this).F=null}function ae(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.L,r=e.type||e,"string"==typeof e?e=new qt(e,t):e instanceof qt?e.target=e.target||t:(s=e,$(e=new qt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=ce(o,r,!0,e)&&s;if(s=ce(o=e.a=t,r,!0,e)&&s,s=ce(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=ce(o=e.a=n[i],r,!1,e)&&s}function ce(t,e,n,r){if(!(e=t.f.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Z&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.$&&Wt(t.f,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}F(ue,Mt),ue.prototype[Ht]=!0,(N=ue.prototype).addEventListener=function(t,e,n,r){Zt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=k(i)?!!i.capture:!!i,r=se(r),e&&e[Ht]?(e=e.f,(n=String(n).toString())in e.a&&-1<(r=Xt(s=e.a[n],r,i,o))&&(zt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&ie(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Xt(n,r,i,o)),(r=-1<e?n[e]:null)&&te(r))}(this,t,e,n,r)},N.H=function(){if(ue.Y.H.call(this),this.f){var t,e=this.f;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)zt(n[r]);delete e.a[t],e.b--}}this.F=null},N.va=function(t,e,n,r){return this.f.add(String(t),e,!1,n,r)},N.wa=function(t,e,n,r){return this.f.add(String(t),e,!0,n,r)};var he=S.JSON.stringify;function fe(){this.b=this.a=null}var le,pe=(de.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new de(function(){return new ye},function(t){t.reset()}));function de(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function ye(){this.next=this.b=this.a=null}function ve(t,e){var n;le||(n=S.Promise.resolve(void 0),le=function(){n.then(be)}),ge||(le(),ge=!0),me.add(t,e)}fe.prototype.add=function(t,e){var n=pe.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},ye.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ge=!(ye.prototype.reset=function(){this.next=this.b=this.a=null}),me=new fe;function be(){for(var t,e;n=e=void 0,n=null,(e=me).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){S.setTimeout(function(){throw t},0)}(t)}var n=pe;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}ge=!1}function we(t,e){ue.call(this),this.b=t||1,this.a=e||S,this.c=M(this.Za,this),this.g=U()}function Ee(t){t.aa=!1,t.O&&(t.a.clearTimeout(t.O),t.O=null)}function Ie(t,e,n){if("function"==typeof t)n&&(t=M(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=M(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}F(we,ue),(N=we.prototype).aa=!1,N.O=null,N.Za=function(){var t;this.aa&&(0<(t=U()-this.g)&&t<.8*this.b?this.O=this.a.setTimeout(this.c,this.b-t):(this.O&&(this.a.clearTimeout(this.O),this.O=null),ae(this,"tick"),this.aa&&(Ee(this),this.start())))},N.start=function(){this.aa=!0,this.O||(this.O=this.a.setTimeout(this.c,this.b),this.g=U())},N.H=function(){we.Y.H.call(this),Ee(this),delete this.a};var _e,Te,Ne,Ae=(_(Te=Se,Ne=_e=Mt),Te.prototype=null===Ne?Object.create(Ne):(xe.prototype=Ne.prototype,new xe),Se.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Ie(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},Se.prototype.H=function(){_e.prototype.H.call(this),this.a&&(S.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},Se);function xe(){this.constructor=Te}function Se(t,e){var n=_e.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function Oe(t){Mt.call(this),this.b=t,this.a={}}F(Oe,Mt);var De=[];function ke(t,e,n,r){Array.isArray(n)||(n&&(De[0]=n.toString()),n=De);for(var i=0;i<n.length;i++){var o=Zt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Le(t){Y(t.a,function(t,e){this.a.hasOwnProperty(e)&&te(t)},t),t.a={}}function Pe(){this.a=Tt("goog.labs.net.webChannel.WebChannelDebug"),this.b=!0}function Ce(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(e,n){if(!e.b)return n;if(!n)return null;try{var t=JSON.parse(n);if(t)for(var r=0;r<t.length;r++)if(Array.isArray(t[r])){var i=t[r];if(!(i.length<2)){var o=i[1];if(Array.isArray(o)&&!(o.length<1)){i=o[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var s=1;s<o.length;s++)o[s]=""}}}return he(t)}catch(t){return Re(e,"Exception parsing expected JS array - probably was not JS"),n}}(t,n)+(r?" "+r:"")})}function Re(t,e){Pt(t.a,e)}function Me(t,e,n){(t=t.a)&&t.log(gt,n||"Exception",e)}function Ve(t,e){(t=t.a)&&t.log(gt,e,void 0)}Oe.prototype.H=function(){Oe.Y.H.call(this),Le(this)},Oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Pe.prototype.info=function(t){Lt(this.a,t)};var Ue={},Fe=null;function qe(){return Fe=Fe||new ue}function je(t){qt.call(this,Ue.Fa,t)}function Be(t){var e=qe();ae(e,new je(e))}function He(t,e){qt.call(this,Ue.STAT_EVENT,t),this.stat=e}function Ge(t){var e=qe();ae(e,new He(e,t))}function Ke(t){qt.call(this,Ue.Ga,t)}function ze(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}Ue.Fa="serverreachability",F(je,qt),Ue.STAT_EVENT="statevent",F(He,qt),Ue.Ga="timingevent",F(Ke,qt);var Je={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},We={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Xe(){}function Ye(t){var e;return(e=t.a)||(e=t.a={}),e}function Qe(){}Xe.prototype.a=null;var Ze,A={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function $e(){qt.call(this,"d")}function tn(){qt.call(this,"c")}function en(){}function nn(t,e,n,r){this.g=t,this.b=e,this.c=n,this.S=r||1,this.J=new Oe(this),this.P=rn,t=ot?125:void 0,this.R=new we(t),this.A=null,this.f=!1,this.m=this.i=this.j=this.G=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.l=null,this.K=-1,this.v=!1,this.L=0,this.F=null,this.X=this.C=this.W=this.I=!1}F($e,qt),F(tn,qt),F(en,Xe),Ze=new en;var rn=45e3;var on={},sn={};function un(t,e,n){t.G=1,t.j=Sn(In(e)),t.m=n,t.I=!0,an(t,null)}function an(t,e){t.u=U(),hn(t),t.i=In(t.j);var s,u,a,c,h,f,n=t.i,r=t.S;Array.isArray(r)||(r=[String(r)]),jn(n.b,"t",r),t.D=0,t.a=Rr(t.g,t.g.F?e:null),0<t.L&&(t.F=new Ae(M(t.Ca,t,t.a),t.L)),ke(t.J,t.a,"readystatechange",t.Xa),e=t.A?Q(t.A):{},t.m?(t.l||(t.l="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.i,t.l,t.m,e)):(t.l="GET",t.a.ba(t.i,t.l,null,e)),Be(1),s=t.b,u=t.l,a=t.i,c=t.c,h=t.S,f=t.m,s.info(function(){if(s.b)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function cn(t,e,n){for(var r,i,o,s=!0;!t.v&&t.D<n.length;){var u=(u=n,o=i=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?sn:(i=Number(u.substring(i,o)),isNaN(i)?on:(o+=1)+i>u.length?sn:(u=u.substr(o,i),r.D=o+i,u)));if(u==sn){4==e&&(t.h=4,Ge(14),s=!1),Ce(t.b,t.c,null,"[Incomplete Response]");break}if(u==on){t.h=4,Ge(15),Ce(t.b,t.c,n,"[Invalid Chunk]"),s=!1;break}Ce(t.b,t.c,u,null),yn(t,u)}4==e&&0==n.length&&(t.h=1,Ge(16),s=!1),t.f=t.f&&s,s?0<n.length&&!t.X&&(t.X=!0,(e=t.g).b==t&&e.W&&!e.I&&(e.a.info("Great, no buffering proxy detected. Bytes received: "+n.length),xr(e),e.I=!0,Ge(11))):(Ce(t.b,t.c,n,"[Invalid Chunked Response]"),dn(t),pn(t))}function hn(t){t.T=U()+t.P,fn(t,t.P)}function fn(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ze(M(t.Va,t),e)}function ln(t){t.o&&(S.clearTimeout(t.o),t.o=null)}function pn(t){0==t.g.B||t.v||Dr(t.g,t)}function dn(t){ln(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Ee(t.R),Le(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function yn(e,t){try{var n,r,i,o,s=e.g;if(0!=s.B&&(s.b==e||Wn(s.f,e)))if(s.C=e.K,!e.C&&Wn(s.f,e)&&3==s.B){try{var u=s.ka.a.parse(t)}catch(t){u=null}if(Array.isArray(u)&&3==u.length){var a=u;if(0==a[0])t:if(Re(s.a,"Server claims our backchannel is missing."),s.j)Re(s.a,"But we are currently starting the request.");else{if(s.b){if(!(s.b.u+3e3<e.u))break t;Or(s),mr(s)}else kt(s.a.a,"We do not have a BackChannel established");Ar(s),Ge(18)}else{s.oa=a[1];var c,h=s.oa-s.P;0<h&&(c=a[2],Re(s.a,c+" bytes (in "+h+" arrays) are outstanding on the BackChannel"),c<37500&&s.J&&0==s.o&&!s.l&&(s.l=ze(M(s.Sa,s),6e3)))}if(Jn(s.f)<=1&&s.ea){try{s.ea()}catch(t){Me(s.a,t,"Exception from forwardChannelFlushedCallback_ ")}s.ea=void 0}}else Re(s.a,"Bad POST response data returned"),Lr(s,11)}else if(!e.C&&s.b!=e||Or(s),!G(t))for(h=u=s.ka.a.parse(t),c=0;c<h.length;c++){a=h[c],s.P=a[0],a=a[1],2==s.B?"c"==a[0]?(s.K=a[1],s.ga=a[2],null!=(n=a[3])&&(s.ha=n,s.a.info("VER="+s.ha)),null!=(i=a[4])&&(s.pa=i,s.a.info("SVER="+s.pa)),null!=(n=a[5])&&"number"==typeof n&&0<n&&(t=1.5*n,s.G=t,s.a.info("backChannelRequestTimeoutMs_="+t)),t=s,(i=e.a)&&(!(n=i.a?i.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(r=t.f).a&&(J(n,"spdy")||J(n,"quic")||J(n,"h2"))&&(r.f=r.g,r.a=new Set,r.b&&(Xn(r,r.b),r.b=null)),t.v&&((o=i.a?i.a.getResponseHeader("X-HTTP-Session-Id"):null)?(t.na=o,xn(t.A,t.v,o)):kt(t.a.a,"Missing X_HTTP_SESSION_ID in the handshake response"))),s.B=3,s.g&&s.g.ta(),s.W&&(s.D=U()-e.u,s.a.info("Handshake RTT: "+s.D+"ms")),u=e,r=t=s,o=Cr(i=t,i.F?t.ga:null,t.fa),Re(i.a,"GetBackChannelUri: "+o),r.la=o,u.C?(Re(t.a,"Upgrade the handshake request to a backchannel."),Yn(t.f,u),r=u,(o=t.G)&&r.setTimeout(o),r.o&&(ln(r),hn(r)),t.b=u):Nr(t),0<s.c.length&&Er(s)):"stop"!=a[0]&&"close"!=a[0]||Lr(s,7):3==s.B&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?Lr(s,7):gr(s):"noop"!=a[0]&&s.g&&s.g.sa(a),s.o=0)}Be(4)}catch(t){Me(e.b,t,"Error in httprequest callback")}}function vn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(D(t)||"string"==typeof t)j(t,e,void 0);else{if(t.N&&"function"==typeof t.N)var n=t.N();else if(t.M&&"function"==typeof t.M)n=void 0;else if(D(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.M&&"function"==typeof t.M)return t.M();if("string"==typeof t)return t.split("");if(D(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function gn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof gn)for(n=t.N(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function mn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];bn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)bn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function bn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=nn.prototype).setTimeout=function(t){this.P=t},N.Xa=function(t){t=t.target;var e=this.F;e&&3==lr(t)?(Re(this.b,"Throttling readystatechange."),e.f()):this.Ca(t)},N.Ca=function(t){try{t==this.a?function(t){var e=lr(t.a),n=t.a.ua(),r=t.a.V();if(!(e<3||3==e&&!ot&&!t.a.U())){t.v||4!=e||7==n||Be(8==n||r<=0?3:2),ln(t);var i=t.a.V();if(t.K=i,(n=t.a.U())||Re(t.b,function(){return"No response text for uri "+t.i+" status "+i}),t.f=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(t.b,t.l,t.i,t.c,t.S,e,i),t.f){if(t.W&&!t.C){if(!(r=function(t){return t.a&&(t=(t=t.a).a?t.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(t)?t:null}(t)))return t.f=!1,t.h=3,Ge(12),kt(t.b.a,"XMLHTTP Missing X_HTTP_INITIAL_RESPONSE ("+t.c+")"),dn(t),pn(t);Ce(t.b,t.c,r,"Initial handshake response via X-HTTP-Initial-Response"),t.C=!0,yn(t,r)}t.I?(cn(t,e,n),ot&&t.f&&3==e&&function(t){ke(t.J,t.R,"tick",t.Wa),t.R.start()}(t)):(Ce(t.b,t.c,n,null),yn(t,n)),4==e&&dn(t),t.f&&!t.v&&(4==e?Dr(t.g,t):(t.f=!1,hn(t)))}else 400==i&&0<n.indexOf("Unknown SID")?(t.h=3,Ge(12),kt(t.b.a,"XMLHTTP Unknown SID ("+t.c+")")):(t.h=0,Ge(13),kt(t.b.a,"XMLHTTP Bad status "+i+" ("+t.c+")")),dn(t),pn(t)}}(this):kt(this.b.a,"Called back with an unexpected xmlhttp")}catch(t){var e;Re(this.b,"Failed call to OnXmlHttpReadyStateChanged_"),this.a&&this.a.U()?Me((e=this).b,t,function(){return"ResponseText: "+e.a.U()}):Me(this.b,t,"No response text")}},N.Wa=function(){var t,e;this.a&&(t=lr(this.a),e=this.a.U(),this.D<e.length&&(ln(this),cn(this,t,e),this.f&&4!=t&&hn(this)))},N.cancel=function(){this.v=!0,dn(this)},N.Va=function(){this.o=null;var t,e,n=U();0<=n-this.T?(this.f&&Ve(this.b,"Received watchdog timeout even though request loaded successfully"),t=this.b,e=this.i,t.info(function(){return"TIMEOUT: "+e}),2!=this.G&&(Be(3),Ge(17)),dn(this),this.h=2,pn(this)):(kt(this.b.a,"WatchDog timer called too early"),fn(this,this.T-n))},(N=gn.prototype).M=function(){mn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.N=function(){return mn(this),this.a.concat()},N.get=function(t,e){return bn(this.b,t)?this.b[t]:e},N.set=function(t,e){bn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.N(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var wn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function En(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof En?(this.a=void 0!==e?e:t.a,_n(this,t.f),this.j=t.j,Tn(this,t.c),Nn(this,t.h),this.g=t.g,e=t.b,(n=new Vn).c=e.c,e.a&&(n.a=new gn(e.a),n.b=e.b),An(this,n),this.i=t.i):t&&(n=String(t).match(wn))?(this.a=!!e,_n(this,n[1]||"",!0),this.j=On(n[2]||""),Tn(this,n[3]||"",!0),Nn(this,n[4]),this.g=On(n[5]||"",!0),An(this,n[6]||"",!0),this.i=On(n[7]||"")):(this.a=!!e,this.b=new Vn(null,this.a))}function In(t){return new En(t)}function _n(t,e,n){t.f=n?On(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Tn(t,e,n){t.c=n?On(e,!0):e}function Nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function An(t,e,n){var r,i;e instanceof Vn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(Un(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Fn(this,e),jn(this,n,t))},r)),r.f=i):(n||(e=Dn(e,Rn)),t.b=new Vn(e,t.a))}function xn(t,e,n){t.b.set(e,n)}function Sn(t){return xn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^U()).toString(36)),t}function On(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Dn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,kn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function kn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}En.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Dn(e,Ln,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Dn(e,Ln,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Dn(n,"/"==n.charAt(0)?Cn:Pn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Dn(n,Mn)),t.join("")};var Ln=/[#\/\?@]/g,Pn=/[#\?:]/g,Cn=/[#\?]/g,Rn=/[#\?@]/g,Mn=/#/g;function Vn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Un(n){n.a||(n.a=new gn,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Fn(t,e){Un(t),e=Bn(t,e),bn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,bn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&mn(t)))}function qn(t,e){return Un(t),e=Bn(t,e),bn(t.a.b,e)}function jn(t,e,n){Fn(t,e),0<n.length&&(t.c=null,t.a.set(Bn(t,e),H(n)),t.b+=n.length)}function Bn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(N=Vn.prototype).add=function(t,e){Un(this),this.c=null,t=Bn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){Un(this),this.a.forEach(function(t,e){j(t,function(t){n.call(r,t,e,this)},this)},this)},N.N=function(){Un(this);for(var t=this.a.M(),e=this.a.N(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.M=function(t){Un(this);var e=[];if("string"==typeof t)qn(this,t)&&(e=B(e,this.a.get(Bn(this,t))));else{t=this.a.M();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},N.set=function(t,e){return Un(this),this.c=null,qn(this,t=Bn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.M(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.N(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.M(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var Hn=function(t,e){this.b=t,this.a=e};function Gn(t){this.g=t||Kn,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ia&&S.ia.ya&&S.ia.ya()&&S.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Kn=10;function zn(t){return t.b||t.a&&t.a.size>=t.f}function Jn(t){return t.b?1:t.a?t.a.size:0}function Wn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Xn(t,e){t.a?t.a.add(e):t.b=e}function Yn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Qn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return H(t.c);var r=t.c;try{for(var i=T(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Zn(){}function $n(){this.a=new Zn}function tr(e,t,n,r,i){try{Re(e,n),t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(t){Me(e,t)}}Gn.prototype.cancel=function(){var e,t;if(this.c=Qn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=T(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Zn.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},Zn.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var er=S.JSON.parse;function nr(t){ue.call(this),this.headers=new gn,this.I=t||null,this.c=!1,this.A=this.a=null,this.J=this.s="",this.i=0,this.g="",this.h=this.D=this.o=this.C=!1,this.l=0,this.u=null,this.K=rr,this.v=this.G=!1}F(nr,ue);var rr="";nr.prototype.b=Tt("goog.net.XhrIo");var ir=/^https?$/i,or=["POST","PUT"];function sr(t){return"content-type"==t.toLowerCase()}function ur(t,e){t.c=!1,t.a&&(t.h=!0,t.a.abort(),t.h=!1),t.g=e,t.i=5,ar(t),hr(t)}function ar(t){t.C||(t.C=!0,ae(t,"complete"),ae(t,"error"))}function cr(t){if(t.c&&void 0!==x)if(t.A[1]&&4==lr(t)&&2==t.V())Pt(t.b,pr(t,"Local request error detected and ignored"));else if(t.o&&4==lr(t))Ie(t.za,0,t);else if(ae(t,"readystatechange"),4==lr(t)){Pt(t.b,pr(t,"Request complete")),t.c=!1;try{var e,n,r,i,o=t.V();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}(e=s)||((n=0===o)&&(!(i=String(t.s).match(wn)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!ir.test(i?i.toLowerCase():"")),e=n);if(e)ae(t,"complete"),ae(t,"success");else{t.i=6;try{var u=2<lr(t)?t.a.statusText:""}catch(o){Pt(t.b,"Can not get status: "+o.message),u=""}t.g=u+" ["+t.V()+"]",ar(t)}}finally{hr(t)}}}function hr(e,t){if(e.a){fr(e);var n=e.a,r=e.A[0]?O:null;e.a=null,e.A=null,t||ae(e,"ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(gt,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function fr(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(S.clearTimeout(t.u),t.u=null)}function lr(t){return t.a?t.a.readyState:0}function pr(t,e){return e+" ["+t.J+" "+t.s+" "+t.V()+"]"}function dr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Y(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):xn(t,e,n))}function yr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function vr(t){this.pa=0,this.c=[],this.a=new Pe,this.ga=this.la=this.A=this.fa=this.b=this.na=this.v=this.X=this.i=this.L=this.m=null,this.Oa=this.R=0,this.La=yr("failFast",!1,t),this.J=this.l=this.j=this.h=this.g=null,this.S=!0,this.C=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=yr("baseRetryDelayMs",5e3,t),this.Ra=yr("retryDelaySeedMs",1e4,t),this.Ma=yr("forwardChannelMaxRetries",2,t),this.ma=yr("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.G=void 0,this.F=t&&t.supportsCrossDomainXhr||!1,this.K="",this.f=new Gn(t&&t.concurrentRequestLimit),this.ka=new $n,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.a.b=!1),t&&t.forceLongPolling&&(this.S=!1),this.W=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.D=0,this.I=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.a.info("Opt-in to enable Chrome Origin Trials.")}function gr(t){var e,n;Re(t.a,"disconnect()"),br(t),3==t.B&&(e=t.R++,xn(n=In(t.A),"SID",t.K),xn(n,"RID",e),xn(n,"TYPE","terminate"),_r(t,n),(e=new nn(t,t.a,e,void 0)).G=2,e.j=Sn(In(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.j.toString(),"")),!n&&S.Image&&((new Image).src=e.j,n=!0),n||(e.a=Rr(e.g,null),e.a.ba(e.j)),e.u=U(),hn(e)),Pr(t)}function mr(t){t.b&&(xr(t),t.b.cancel(),t.b=null)}function br(t){mr(t),t.j&&(S.clearTimeout(t.j),t.j=null),Or(t),t.f.cancel(),t.h&&("number"==typeof t.h&&S.clearTimeout(t.h),t.h=null)}function wr(t,e){1e3==t.c.length&&Ve(t.a,function(){return"Already have 1000 queued maps upon queueing "+he(e)}),t.c.push(new Hn(t.Oa++,e)),3==t.B&&Er(t)}function Er(t){zn(t.f)||t.h||(t.h=!0,ve(t.Ba,t),t.u=0)}function Ir(t,e){var n=e?e.c:t.R++,r=In(t.A);xn(r,"SID",t.K),xn(r,"RID",n),xn(r,"AID",t.P),_r(t,r),t.i&&t.m&&dr(r,t.i,t.m),n=new nn(t,t.a,n,t.u+1),null===t.i&&(n.A=t.m),e&&(t.c=e.s.concat(t.c)),e=Tr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Xn(t.f,n),un(n,r,e)}function _r(t,n){t.g&&vn({},function(t,e){xn(n,e,t)})}function Tr(t,e,n){n=Math.min(t.c.length,n);var r=t.g?M(t.g.Ja,t.g,t):null;t:for(var i=t.c,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{vn(t,function(t,e){var n=t;k(t)&&(n=he(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.c.splice(0,n),e.s=t,r}function Nr(t){t.b||t.j||(t.T=1,ve(t.Aa,t),t.o=0)}function Ar(t){return t.b||t.j?(Ve(t.a,"Request already in progress"),0):!(3<=t.o)&&(Re(t.a,"Going to retry GET"),t.T++,t.j=ze(M(t.Aa,t),kr(t,t.o)),t.o++,1)}function xr(t){null!=t.s&&(Re(t.a,"Cancel the BP detection timer."),S.clearTimeout(t.s),t.s=null)}function Sr(t){Re(t.a,"Creating new HttpRequest"),t.b=new nn(t,t.a,"rpc",t.T),null===t.i&&(t.b.A=t.m),t.b.L=0;var e=In(t.la);xn(e,"RID","rpc"),xn(e,"SID",t.K),xn(e,"CI",t.J?"0":"1"),xn(e,"AID",t.P),_r(t,e),xn(e,"TYPE","xmlhttp"),t.i&&t.m&&dr(e,t.i,t.m),t.G&&t.b.setTimeout(t.G);var n=t.b,r=t.ga;n.G=1,n.j=Sn(In(e)),n.m=null,n.I=!0,an(n,r),Re(t.a,"New Request created")}function Or(t){null!=t.l&&(S.clearTimeout(t.l),t.l=null)}function Dr(t,e){Re(t.a,"Request complete");var n,r,i,o,s=null;if(t.b==e){Or(t),xr(t),t.b=null;var u=2}else{if(!Wn(t.f,e))return;s=e.s,Yn(t.f,e),u=1}if(t.C=e.K,0!=t.B)if(e.f)1==u?(n=e.m?e.m.length:0,r=U()-e.u,i=t.u,ae(o=qe(),new Ke(o)),Er(t)):Nr(t);else{var a=e.h;if(3==a||0==a&&0<t.C)Re(t.a,"Not retrying due to error type");else{if(Re(t.a,function(){return"Maybe retrying, last error: "+function(t,e){switch(t){case 0:return"Non-200 return code ("+e+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}(a,t.C)}),1==u&&(i=e,Jn((e=t).f)>=e.f.f-(e.h?1:0)?(Ve(e.a,"Unexpected retry request is scheduled."),0):e.h?(Re(e.a,"Use the retry request that is already scheduled."),e.c=i.s.concat(e.c),1):!(1==e.B||2==e.B||e.u>=(e.La?0:e.Ma))&&(Re(e.a,"Going to retry POST"),e.h=ze(M(e.Ba,e,i),kr(e,e.u)),e.u++,1))||2==u&&Ar(t))return;Re(t.a,"Exceeded max number of retries")}switch(s&&0<s.length&&(u=t.f,s=s,u.c=u.c.concat(s)),Re(t.a,"Error: HTTP request failed"),a){case 1:Lr(t,5);break;case 4:Lr(t,10);break;case 3:Lr(t,6);break;default:Lr(t,2)}}}function kr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.g||(Re(t.a,"Inactive channel"),n*=2),n*e}function Lr(t,e){var n,r,i,o;t.a.info("Error code "+e),2==e?(r=null,t.g&&(r=null),o=M(t.Ya,t),r||(r=new En("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||_n(r,"https"),Sn(r)),n=r.toString(),r=o,Re(o=new Pe,"TestLoadImage: loading "+n),S.Image?((i=new Image).onload=V(tr,o,i,"TestLoadImage: loaded",!0,r),i.onerror=V(tr,o,i,"TestLoadImage: error",!1,r),i.onabort=V(tr,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=V(tr,o,i,"TestLoadImage: timeout",!1,r),S.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):Ge(2),Re(t.a,"HttpChannel: error - "+e),t.B=0,t.g&&t.g.ra(e),Pr(t),br(t)}function Pr(t){var e;t.B=0,t.C=-1,t.g&&(0==(e=Qn(t.f)).length&&0==t.c.length||(Re(t.a,function(){return"Number of undelivered maps, pending: "+e.length+", outgoing: "+t.c.length}),t.f.c.length=0,H(t.c),t.c.length=0),t.g.qa())}function Cr(t,e,n){var r,i,o,s,u,a=(s=n)instanceof En?In(s):new En(s,void 0);return""!=a.c?(e&&Tn(a,e+"."+a.c),Nn(a,a.h)):(u=S.location,r=u.protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new En(null,void 0),r&&_n(u,r),i&&Tn(u,i),o&&Nn(u,o),s&&(u.g=s),a=u),t.X&&Y(t.X,function(t,e){xn(a,e,t)}),e=t.v,n=t.na,e&&n&&xn(a,e,n),xn(a,"VER",t.ha),_r(t,a),a}function Rr(t,e){if(e&&!t.F)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new nr(t.Na)).G=t.F,e}function Mr(){}function Vr(){if(rt&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function Ur(t,e){ue.call(this),this.a=new vr(e),this.c=t,this.b=Tt("goog.labs.net.webChannel.WebChannelBaseTransport"),this.g=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.m=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.L=t,(t=e&&e.httpHeadersOverwriteParam)&&!G(t)&&(this.a.i=t),this.s=e&&e.supportsCrossDomainXhr||!1,this.o=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!G(e)&&(this.a.v=e,null!==(t=this.g)&&e in t&&(e in(t=this.g)&&delete t[e],kt(this.b,"Ignore httpSessionIdParam also specified with messageUrlParams: "+e))),this.h=new jr(this)}function Fr(t){$e.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function qr(){tn.call(this),this.status=1}function jr(t){this.a=t}(N=nr.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.s+"; newUri="+t);e=e?e.toUpperCase():"GET",this.s=t,this.g="",this.i=0,this.J=e,this.C=!1,this.c=!0,this.a=new XMLHttpRequest,this.A=this.I?Ye(this.I):Ye(Ze),this.a.onreadystatechange=M(this.za,this);try{Pt(this.b,pr(this,"Opening Xhr")),this.D=!0,this.a.open(e,String(t),!0),this.D=!1}catch(t){return Pt(this.b,pr(this,"Error opening Xhr: "+t.message)),void ur(this,t)}t=n||"";var i,o=new gn(this.headers);r&&vn(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=sr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.N()),n=S.FormData&&t instanceof S.FormData,0<=q(or,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.K&&(this.a.responseType=this.K),"withCredentials"in this.a&&this.a.withCredentials!==this.G&&(this.a.withCredentials=this.G);try{fr(this),0<this.l&&(this.v=(i=this.a,rt&&lt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout),Pt(this.b,pr(this,"Will abort after "+this.l+"ms if incomplete, xhr2 "+this.v)),this.v?(this.a.timeout=this.l,this.a.ontimeout=M(this.xa,this)):this.u=Ie(this.xa,this.l,this)),Pt(this.b,pr(this,"Sending request")),this.o=!0,this.a.send(t),this.o=!1}catch(t){Pt(this.b,pr(this,"Send error: "+t.message)),ur(this,t)}},N.xa=function(){void 0!==x&&this.a&&(this.g="Timed out after "+this.l+"ms, aborting",this.i=8,Pt(this.b,pr(this,this.g)),ae(this,"timeout"),this.abort(8))},N.abort=function(t){this.a&&this.c&&(Pt(this.b,pr(this,"Aborting")),this.c=!1,this.h=!0,this.a.abort(),this.h=!1,this.i=t||7,ae(this,"complete"),ae(this,"abort"),hr(this))},N.H=function(){this.a&&(this.c&&(this.c=!1,this.h=!0,this.a.abort(),this.h=!1),hr(this,!0)),nr.Y.H.call(this)},N.za=function(){this.m||(this.D||this.o||this.h?cr(this):this.Ua())},N.Ua=function(){cr(this)},N.V=function(){try{return 2<lr(this)?this.a.status:-1}catch(t){return-1}},N.U=function(){try{return this.a?this.a.responseText:""}catch(t){return Pt(this.b,"Can not get responseText: "+t.message),""}},N.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),er(e)}},N.ua=function(){return this.i},N.Qa=function(){return"string"==typeof this.g?this.g:String(this.g)},(N=vr.prototype).ha=8,N.B=1,N.Ba=function(t){if(this.h)if(this.h=null,Re(this.a,"startForwardChannel_"),1==this.B)if(t)Ve(this.a,"Not supposed to retry the open");else{Re(this.a,"open_()"),this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new nn(this,this.a,t,void 0),r=this.m;if(this.L&&(r?$(r=Q(r),this.L):r=this.L),null===this.i&&(n.A=r),this.da)t:{for(var i=e=0;i<this.c.length;i++){var o=this.c[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.c.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Tr(this,n,e),xn(i=In(this.A),"RID",t),xn(i,"CVER",22),this.v&&xn(i,"X-HTTP-Session-Id",this.v),_r(this,i),this.i&&r&&dr(i,this.i,r),Xn(this.f,n),this.Ia&&xn(i,"TYPE","init"),this.da?(xn(i,"$req",e),xn(i,"SID","null"),n.W=!0,un(n,i,null)):un(n,i,e),this.B=2}else 3==this.B&&(t?Ir(this,t):0==this.c.length?Re(this.a,"startForwardChannel_ returned: nothing to send"):zn(this.f)?Ve(this.a,"startForwardChannel_ returned: connection already in progress"):(Ir(this),Re(this.a,"startForwardChannel_ finished, sent request")))},N.Aa=function(){var t;this.j=null,Sr(this),this.W&&!this.I&&(null==this.b||this.D<=0?kt(this.a.a,"Skip bpDetectionTimerId_ "+this.b+" "+this.D):(t=2*this.D,this.a.info("BP detection timer enabled: "+t),this.s=ze(M(this.Ta,this),t)))},N.Ta=function(){var t;this.s?(this.s=null,this.a.info("BP detection timeout reached."),null==this.b.a||(t=this.b.a.U())&&kt(this.a.a,"Timer should have been cancelled : "+t),this.a.info("Buffering proxy detected and switch to long-polling!"),this.J=!1,this.I=!0,Ge(10),mr(this),Sr(this)):kt(this.a.a,"Invalid operation.")},N.Sa=function(){null!=this.l&&(this.l=null,mr(this),Ar(this),Ge(19))},N.Ya=function(t){t?(this.a.info("Successfully pinged google.com"),Ge(2)):(this.a.info("Failed to ping google.com"),Ge(1))},(N=Mr.prototype).ta=function(){},N.sa=function(){},N.ra=function(){},N.qa=function(){},N.Ja=function(){},Vr.prototype.a=function(t,e){return new Ur(t,e)},F(Ur,ue),Ur.prototype.i=function(){this.a.g=this.h,this.s&&(this.a.F=!0);var t=this.a,e=this.c,n=this.g||void 0;Re(t.a,"connect()"),Ge(0),t.fa=e,t.X=n||{},t.J=t.S,Re(t.a,"connectChannel_()"),e=Cr(t,null,t.fa),Re(t.a,"GetForwardChannelUri: "+e),t.A=e,Er(t)},Ur.prototype.close=function(){gr(this.a)},Ur.prototype.l=function(t){var e;"string"==typeof t?((e={}).__data__=t,wr(this.a,e)):this.o?((e={}).__data__=he(t),wr(this.a,e)):wr(this.a,t)},Ur.prototype.H=function(){this.a.g=null,delete this.h,gr(this.a),delete this.a,Ur.Y.H.call(this)},F(Fr,$e),F(qr,tn),F(jr,Mr),jr.prototype.ta=function(){Lt(this.a.b,"WebChannel opened on "+this.a.c),ae(this.a,"a")},jr.prototype.sa=function(t){ae(this.a,new Fr(t))},jr.prototype.ra=function(t){Lt(this.a.b,"WebChannel aborted on "+this.a.c+" due to channel error: "+t),ae(this.a,new qr)},jr.prototype.qa=function(){Lt(this.a.b,"WebChannel closed on "+this.a.c),ae(this.a,"b")},Vr.prototype.createWebChannel=Vr.prototype.a,Ur.prototype.send=Ur.prototype.l,Ur.prototype.open=Ur.prototype.i,Je.NO_ERROR=0,Je.TIMEOUT=8,Je.HTTP_ERROR=6,We.COMPLETE="complete",(Qe.EventType=A).OPEN="a",A.CLOSE="b",A.ERROR="c",A.MESSAGE="d",ue.prototype.listen=ue.prototype.va,nr.prototype.listenOnce=nr.prototype.wa,nr.prototype.getLastError=nr.prototype.Qa,nr.prototype.getLastErrorCode=nr.prototype.ua,nr.prototype.getStatus=nr.prototype.V,nr.prototype.getResponseJson=nr.prototype.Pa,nr.prototype.getResponseText=nr.prototype.U,nr.prototype.send=nr.prototype.ba;var Br=qe,Hr=Je,Gr=We,Kr=Ue,zr=10,Jr=11,Wr=Qe,Xr=nr,A=Tt("goog.labs.net.webChannel.WebChannelDebug");A&&(A.b=Et);Je=new Ct;1!=Je.b&&(We=Tt(""),A=Je.g,We&&(We.a||(We.a=[]),We.a.push(A)),Je.b=!0);var Yr="8.2.2-longpoll.66863f547",Qr=new o("@firebase/firestore");function Zr(){return Qr.logLevel}function $r(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Qr.logLevel<=l.DEBUG&&(e=n.map(ni),Qr.debug.apply(Qr,f(["Firestore ("+Yr+"): "+t],e)))}function ti(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Qr.logLevel<=l.ERROR&&(e=n.map(ni),Qr.error.apply(Qr,f(["Firestore ("+Yr+"): "+t],e)))}function ei(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Qr.logLevel<=l.WARN&&(e=n.map(ni),Qr.warn.apply(Qr,f(["Firestore ("+Yr+"): "+t],e)))}function ni(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function ri(t){void 0===t&&(t="Unexpected state");t="FIRESTORE ("+Yr+") INTERNAL ASSERTION FAILED: "+t;throw ti(t),new Error(t)}function ii(t){t||ri()}var oi=(si.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},si);function si(){}function ui(t,e){return t<e?-1:e<t?1:0}function ai(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function ci(t){return t+"\0"}var hi=(fi.fromBase64String=function(t){return new fi(atob(t))},fi.fromUint8Array=function(t){return new fi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},fi.prototype.toBase64=function(){return t=this.i,btoa(t);var t},fi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},fi.prototype.o=function(){return 2*this.i.length},fi.prototype.u=function(t){return ui(this.i,t.i)},fi.prototype.isEqual=function(t){return this.i===t.i},fi);function fi(t){this.i=t}hi.h=new hi("");var li,pi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},di=(h(mi,li=Error),mi),yi=(gi.fromBase64String=function(t){try{return new gi(hi.fromBase64String(t))}catch(t){throw new di(pi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},gi.fromUint8Array=function(t){return new gi(hi.fromUint8Array(t))},gi.prototype.toBase64=function(){return this.l.toBase64()},gi.prototype.toUint8Array=function(){return this.l.toUint8Array()},gi.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},gi.prototype.isEqual=function(t){return this.l.isEqual(t.l)},gi),vi=function(t){this._=t};function gi(t){this.l=t}function mi(t,e){var n=this;return(n=li.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function bi(){if("undefined"==typeof Uint8Array)throw new di(pi.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function wi(){if("undefined"==typeof atob)throw new di(pi.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ei,Ii=(h(Si,Ei=vi),Si.fromBase64String=function(t){return wi(),new Si(yi.fromBase64String(t))},Si.fromUint8Array=function(t){return bi(),new Si(yi.fromUint8Array(t))},Si.prototype.toBase64=function(){return wi(),this._.toBase64()},Si.prototype.toUint8Array=function(){return bi(),this._.toUint8Array()},Si.prototype.isEqual=function(t){return this._.isEqual(t._)},Si.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Si),_i=function(t,e,n,r,i,o){this.T=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.I=o},Ti=(Object.defineProperty(xi.prototype,"m",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),xi.prototype.isEqual=function(t){return t instanceof xi&&t.projectId===this.projectId&&t.database===this.database},xi),Ni=(Ai.prototype.A=function(){return null!=this.uid},Ai.prototype.R=function(){return this.A()?"uid:"+this.uid:"anonymous-user"},Ai.prototype.isEqual=function(t){return t.uid===this.uid},Ai);function Ai(t){this.uid=t}function xi(t,e){this.projectId=t,this.database=e||"(default)"}function Si(){return null!==Ei&&Ei.apply(this,arguments)||this}Ni.UNAUTHENTICATED=new Ni(null),Ni.P=new Ni("google-credentials-uid"),Ni.g=new Ni("first-party-uid");function Oi(t,e){this.user=e,this.type="OAuth",this.V={},this.V.Authorization="Bearer "+t}var Di=(Fi.prototype.getToken=function(){return Promise.resolve(null)},Fi.prototype.v=function(){},Fi.prototype.S=function(t){(this.p=t)(Ni.UNAUTHENTICATED)},Fi.prototype.D=function(){this.p=null},Fi),ki=(Ui.prototype.getToken=function(){var e=this,n=this.F,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.F!==n?($r("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(ii("string"==typeof t.accessToken),new Oi(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Ui.prototype.v=function(){this.forceRefresh=!0},Ui.prototype.S=function(t){this.p=t,this.N&&t(this.currentUser)},Ui.prototype.D=function(){this.auth&&this.auth.removeAuthTokenListener(this.C),this.C=null,this.p=null},Ui.prototype.O=function(){var t=this.auth&&this.auth.getUid();return ii(null===t||"string"==typeof t),new Ni(t)},Ui),Li=(Object.defineProperty(Vi.prototype,"V",{get:function(){var t={"X-Goog-AuthUser":this.M},e=this.k.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),Vi),Pi=(Mi.prototype.getToken=function(){return Promise.resolve(new Li(this.k,this.M))},Mi.prototype.S=function(t){t(Ni.g)},Mi.prototype.D=function(){},Mi.prototype.v=function(){},Mi),Ci=(Ri.prototype.L=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ri.prototype.next=function(){var t=++this.previousValue;return this.B&&this.B(t),t},Ri);function Ri(t,e){var n=this;this.previousValue=t,e&&(e.$=function(t){return n.L(t)},this.B=function(t){return e.q(t)})}function Mi(t,e){this.k=t,this.M=e}function Vi(t,e){this.k=t,this.M=e,this.type="FirstParty",this.user=Ni.g}function Ui(t){var e=this;this.C=null,this.currentUser=Ni.UNAUTHENTICATED,this.N=!1,this.F=0,this.p=null,this.forceRefresh=!1,this.C=function(){e.F++,e.currentUser=e.O(),e.N=!0,e.p&&e.p(e.currentUser)},this.F=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.C):(this.C(null),t.get().then(function(t){e.auth=t,e.C&&e.auth.addAuthTokenListener(e.C)},function(){}))}function Fi(){this.p=null}Ci.U=-1;var qi,ji,Bi=($i.now=function(){return $i.fromMillis(Date.now())},$i.fromDate=function(t){return $i.fromMillis(t.getTime())},$i.fromMillis=function(t){var e=Math.floor(t/1e3);return new $i(e,1e6*(t-1e3*e))},$i.prototype.toDate=function(){return new Date(this.toMillis())},$i.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},$i.prototype.K=function(t){return this.seconds===t.seconds?ui(this.nanoseconds,t.nanoseconds):ui(this.seconds,t.seconds)},$i.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},$i.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},$i.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},$i.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},$i),Hi=(Zi.j=function(t){return new Zi(t)},Zi.min=function(){return new Zi(new Bi(0,0))},Zi.prototype.u=function(t){return this.timestamp.K(t.timestamp)},Zi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Zi.prototype.W=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Zi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Zi.prototype.G=function(){return this.timestamp},Zi),Je=(Object.defineProperty(Qi.prototype,"length",{get:function(){return this.H},enumerable:!1,configurable:!0}),Qi.prototype.isEqual=function(t){return 0===Qi.J(this,t)},Qi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Qi?t.forEach(function(t){e.push(t)}):e.push(t),this.Y(e)},Qi.prototype.limit=function(){return this.offset+this.length},Qi.prototype.X=function(t){return t=void 0===t?1:t,this.Y(this.segments,this.offset+t,this.length-t)},Qi.prototype.Z=function(){return this.Y(this.segments,this.offset,this.length-1)},Qi.prototype.tt=function(){return this.segments[this.offset]},Qi.prototype.et=function(){return this.get(this.length-1)},Qi.prototype.get=function(t){return this.segments[this.offset+t]},Qi.prototype.nt=function(){return 0===this.length},Qi.prototype.st=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Qi.prototype.it=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Qi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Qi.prototype.rt=function(){return this.segments.slice(this.offset,this.limit())},Qi.J=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Qi),Gi=(h(Yi,ji=Je),Yi.prototype.Y=function(t,e,n){return new Yi(t,e,n)},Yi.prototype.ot=function(){return this.rt().join("/")},Yi.prototype.toString=function(){return this.ot()},Yi.ct=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new di(pi.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new Yi(n)},Yi.at=function(){return new Yi([])},Yi),Ki=/^[_a-zA-Z][_a-zA-Z0-9]*$/,zi=(h(Xi,qi=Je),Xi.prototype.Y=function(t,e,n){return new Xi(t,e,n)},Xi.ut=function(t){return Ki.test(t)},Xi.prototype.ot=function(){return this.rt().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xi.ut(t)||(t="`"+t+"`"),t}).join(".")},Xi.prototype.toString=function(){return this.ot()},Xi.prototype.ht=function(){return 1===this.length&&"__name__"===this.get(0)},Xi.lt=function(){return new Xi(["__name__"])},Xi._t=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new di(pi.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new di(pi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new di(pi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new di(pi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Xi(e)},Xi.at=function(){return new Xi([])},Xi),Ji=(Wi.ft=function(t){return new Wi(Gi.ct(t))},Wi.dt=function(t){return new Wi(Gi.ct(t).X(5))},Wi.prototype.wt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Wi.prototype.isEqual=function(t){return null!==t&&0===Gi.J(this.path,t.path)},Wi.prototype.toString=function(){return this.path.toString()},Wi.J=function(t,e){return Gi.J(t.path,e.path)},Wi.Tt=function(t){return t.length%2==0},Wi.Et=function(t){return new Wi(new Gi(t.slice()))},Wi);function Wi(t){this.path=t}function Xi(){return null!==qi&&qi.apply(this,arguments)||this}function Yi(){return null!==ji&&ji.apply(this,arguments)||this}function Qi(t,e,n){void 0===e?e=0:e>t.length&&ri(),void 0===n?n=t.length-e:n>t.length-e&&ri(),this.segments=t,this.offset=e,this.H=n}function Zi(t){this.timestamp=t}function $i(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new di(pi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new di(pi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new di(pi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new di(pi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function to(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function eo(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function no(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ro=(oo.prototype.It=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].st(t))return!0;return!1},oo.prototype.isEqual=function(t){return ai(this.fields,t.fields,function(t,e){return t.isEqual(e)})},oo),io=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oo(t){(this.fields=t).sort(zi.J)}function so(t){if(ii(!!t),"string"!=typeof t)return{seconds:uo(t.seconds),nanos:uo(t.nanos)};var e=0,n=io.exec(t);ii(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function uo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ao(t){return"string"==typeof t?hi.fromBase64String(t):hi.fromUint8Array(t)}function co(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function ho(t){t=so(t.mapValue.fields.__local_write_time__.timestampValue);return new Bi(t.seconds,t.nanos)}function fo(t){return null==t}function lo(t){return 0===t&&1/t==-1/0}function po(t){return"number"==typeof t&&Number.isInteger(t)&&!lo(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function yo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?co(t)?4:10:ri()}function vo(r,i){var t,e=yo(r);if(e!==yo(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return ho(r).isEqual(ho(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=so(r.timestampValue),t=so(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,ao(r.bytesValue).isEqual(ao(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,uo((t=r).geoPointValue.latitude)===uo(e.geoPointValue.latitude)&&uo(t.geoPointValue.longitude)===uo(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return uo(t.integerValue)===uo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=uo(t.doubleValue),e=uo(e.doubleValue);return t===e?lo(t)===lo(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return ai(r.arrayValue.values||[],i.arrayValue.values||[],vo);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(to(e)!==to(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!vo(e[t],n[t])))return!1;return!0}();default:return ri()}}function go(t,e){return void 0!==(t.values||[]).find(function(t){return vo(t,e)})}function mo(t,e){var n,r,i=yo(t),o=yo(e);if(i!==o)return ui(i,o);switch(i){case 0:return 0;case 1:return ui(t.booleanValue,e.booleanValue);case 2:return n=e,r=uo(t.integerValue||t.doubleValue),n=uo(n.integerValue||n.doubleValue),r<n?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return bo(t.timestampValue,e.timestampValue);case 4:return bo(ho(t),ho(e));case 5:return ui(t.stringValue,e.stringValue);case 6:return function(t,e){t=ao(t),e=ao(e);return t.u(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ui(n[i],r[i]);if(0!==o)return o}return ui(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return i=t.geoPointValue,r=e.geoPointValue,0!==(n=ui(uo(i.latitude),uo(r.latitude)))?n:ui(uo(i.longitude),uo(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=mo(n[i],r[i]);if(o)return o}return ui(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=ui(r[s],o[s]);if(0!==u)return u;u=mo(n[r[s]],i[o[s]]);if(0!==u)return u}return ui(r.length,o.length)}(t.mapValue,e.mapValue);default:throw ri()}}function bo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ui(t,e);var n=so(t),t=so(e),e=ui(n.seconds,t.seconds);return 0!==e?e:ui(n.nanos,t.nanos)}function wo(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var t=so(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ao(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,Ji.dt(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):ri();var e}(t)}function Eo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.ot()}}function Io(t){return t&&"integerValue"in t}function _o(t){return!!t&&"arrayValue"in t}function To(t){return t&&"nullValue"in t}function No(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ao(t){return t&&"mapValue"in t}var xo=(Do.empty=function(){return new Do({mapValue:{}})},Do.prototype.field=function(t){if(t.nt())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ao(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.et()])||null},Do.prototype.isEqual=function(t){return vo(this.proto,t.proto)},Do),So=(Oo.prototype.set=function(t,e){return this.Pt(t,e),this},Oo.prototype.delete=function(t){return this.Pt(t,null),this},Oo.prototype.Pt=function(t,e){for(var n=this.Rt,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===yo(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.et(),e)},Oo.prototype.yt=function(){var t=this.gt(zi.at(),this.Rt);return null!=t?new xo(t):this.At},Oo.prototype.gt=function(r,t){var i=this,o=!1,e=this.At.field(r),s=Ao(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.gt(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Oo);function Oo(t){void 0===t&&(t=xo.empty()),this.At=t,this.Rt=new Map}function Do(t){this.proto=t}var ko,Lo,Po,o=function(t,e){this.key=t,this.version=e},Co=(h(qo,Po=o),qo.prototype.field=function(t){return this.Vt.field(t)},qo.prototype.data=function(){return this.Vt},qo.prototype.vt=function(){return this.Vt.proto},qo.prototype.isEqual=function(t){return t instanceof qo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.bt===t.bt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Vt.isEqual(t.Vt)},qo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Vt.toString()+", {hasLocalMutations: "+this.bt+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(qo.prototype,"hasPendingWrites",{get:function(){return this.bt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),qo),Ro=(h(Fo,Lo=o),Fo.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Fo.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Fo.prototype.isEqual=function(t){return t instanceof Fo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Fo),Mo=(h(Uo,ko=o),Uo.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Uo.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Uo.prototype.isEqual=function(t){return t instanceof Uo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Uo),Vo=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.St=null};function Uo(){return null!==ko&&ko.apply(this,arguments)||this}function Fo(t,e,n){var r=this;return(r=Lo.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function qo(t,e,n,r){var i=this;return(i=Po.call(this,t,e)||this).Vt=n,i.bt=!!r.bt,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function jo(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Vo(t,e,n,r,i,o,s)}function Bo(t){var e=t;return null===e.St&&(t=e.path.ot(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.ot()+t.op.toString()+wo(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.ot()+t.dir}).join(","),fo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=gs(e.startAt)),e.endAt&&(t+="|ub:",t+=gs(e.endAt)),e.St=t),e.St}function Ho(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!vo(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ws(t.startAt,e.startAt)&&ws(t.endAt,e.endAt)}function Go(t){return Ji.Tt(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ko,zo=(h(Jo,Ko=function(){}),Jo.create=function(t,e,n){return t.ht()?"in"===e||"not-in"===e?this.Dt(t,e,n):new Qo(t,e,n):"array-contains"===e?new as(t,n):"in"===e?new cs(t,n):"not-in"===e?new hs(t,n):"array-contains-any"===e?new fs(t,n):new Jo(t,e,n)},Jo.Dt=function(t,e,n){return new("in"===e?Zo:$o)(t,n)},Jo.prototype.matches=function(t){t=t.field(this.field);return"!="===this.op?null!==t&&this.Ct(mo(t,this.value)):null!==t&&yo(this.value)===yo(t)&&this.Ct(mo(t,this.value))},Jo.prototype.Ct=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return ri()}},Jo.prototype.xt=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Jo);function Jo(t,e,n){var r=this;return(r=Ko.call(this)||this).field=t,r.op=e,r.value=n,r}var Wo,Xo,Yo,Qo=(h(ns,Yo=zo),ns.prototype.matches=function(t){t=Ji.J(t.key,this.key);return this.Ct(t)},ns),Zo=(h(es,Xo=zo),es.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},es),$o=(h(ts,Wo=zo),ts.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},ts);function ts(t,e){var n=this;return(n=Wo.call(this,t,"not-in",e)||this).keys=rs(0,e),n}function es(t,e){var n=this;return(n=Xo.call(this,t,"in",e)||this).keys=rs(0,e),n}function ns(t,e,n){var r=this;return(r=Yo.call(this,t,e,n)||this).key=Ji.dt(n.referenceValue),r}function rs(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Ji.dt(t.referenceValue)})}var is,os,ss,us,as=(h(vs,us=zo),vs.prototype.matches=function(t){t=t.field(this.field);return _o(t)&&go(t.arrayValue,this.value)},vs),cs=(h(ys,ss=zo),ys.prototype.matches=function(t){t=t.field(this.field);return null!==t&&go(this.value.arrayValue,t)},ys),hs=(h(ds,os=zo),ds.prototype.matches=function(t){if(go(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.field(this.field);return null!==t&&!go(this.value.arrayValue,t)},ds),fs=(h(ps,is=zo),ps.prototype.matches=function(t){var e=this,t=t.field(this.field);return!(!_o(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return go(e.value.arrayValue,t)})},ps),ls=function(t,e){this.position=t,this.before=e};function ps(t,e){return is.call(this,t,"array-contains-any",e)||this}function ds(t,e){return os.call(this,t,"not-in",e)||this}function ys(t,e){return ss.call(this,t,"in",e)||this}function vs(t,e){return us.call(this,t,"array-contains",e)||this}function gs(t){return(t.before?"b":"a")+":"+t.position.map(wo).join(",")}var ms=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function bs(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.ht()?Ji.J(Ji.dt(s.referenceValue),n.key):mo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ws(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!vo(t.position[n],e.position[n]))return!1;return!0}var Es=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Nt=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.Ft=null,this.Ot=null,this.startAt,this.endAt};function Is(t,e,n,r,i,o,s,u){return new Es(t,e,n,r,i,o,s,u)}function _s(t){return new Es(t)}function Ts(t){return!fo(t.limit)&&"F"===t.limitType}function Ns(t){return!fo(t.limit)&&"L"===t.limitType}function As(t){return 0<t.Nt.length?t.Nt[0].field:null}function xs(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.xt())return r.field}return null}function Ss(t){return null!==t.collectionGroup}function Os(t){var e=t;if(null===e.Ft){e.Ft=[];var n=xs(e),t=As(e);if(null!==n&&null===t)n.ht()||e.Ft.push(new ms(n)),e.Ft.push(new ms(zi.lt(),"asc"));else{for(var r=!1,i=0,o=e.Nt;i<o.length;i++){var s=o[i];e.Ft.push(s),s.field.ht()&&(r=!0)}r||(n=0<e.Nt.length?e.Nt[e.Nt.length-1].dir:"asc",e.Ft.push(new ms(zi.lt(),n)))}}return e.Ft}function Ds(t){var e=t;if(!e.Ot)if("F"===e.limitType)e.Ot=jo(e.path,e.collectionGroup,Os(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Os(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new ms(o.field,s))}var u=e.endAt?new ls(e.endAt.position,!e.endAt.before):null,t=e.startAt?new ls(e.startAt.position,!e.startAt.before):null;e.Ot=jo(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.Ot}function ks(t,e,n){return new Es(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ls(t,e){return Ho(Ds(t),Ds(e))&&t.limitType===e.limitType}function Ps(t){return Bo(Ds(t))+"|lt:"+t.limitType}function Cs(t){return"Query(target="+(e=Ds(t),n=e.path.ot(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.ot()+" "+t.op+" "+wo(t.value)}).join(", ")+"]"),fo(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.ot()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+gs(e.startAt)),e.endAt&&(n+=", endAt: "+gs(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function Rs(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.wt(e.collectionGroup)&&e.path.st(n):Ji.Tt(e.path)?e.path.isEqual(n):e.path.it(n))&&function(t){for(var e=0,n=i.Nt;e<n.length;e++){var r=n[e];if(!r.field.ht()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||bs(t.startAt,Os(t),n))&&(!t.endAt||!bs(t.endAt,Os(t),n)));var e,n}function Ms(u){return function(t,e){for(var n=!1,r=0,i=Os(u);r<i.length;r++){var o=i[r],s=function(t,r,e){e=t.field.ht()?Ji.J(r.key,e.key):function(t,e){var n=r.field(t),t=e.field(t);return null!==n&&null!==t?mo(n,t):ri()}(t.field,e);switch(t.dir){case"asc":return e;case"desc":return-1*e;default:return ri()}}(o,t,e);if(0!==s)return s;n=n||o.field.ht()}return 0}}var Vs=(Us.prototype.$t=function(t){return new Us(this.target,this.targetId,this.kt,t,this.Mt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Us.prototype.Lt=function(t,e){return new Us(this.target,this.targetId,this.kt,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Us.prototype.Bt=function(t){return new Us(this.target,this.targetId,this.kt,this.sequenceNumber,this.Mt,t,this.resumeToken)},Us);function Us(t,e,n,r,i,o,s){void 0===i&&(i=Hi.min()),void 0===o&&(o=Hi.min()),void 0===s&&(s=hi.h),this.target=t,this.targetId=e,this.kt=n,this.sequenceNumber=r,this.Mt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Fs(t,e){if(t.qt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:lo(e)?"-0":e}}function qs(t){return{integerValue:""+t}}function js(t,e){return po(e)?qs(e):Fs(t,e)}Je=function(){this.Ut=void 0};function Bs(t,e){return t instanceof eu?Io(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Hs,Gs,Ks=(h(Ws,Gs=Je),Ws),zs=(h(Js,Hs=Je),Js);function Js(t){var e=this;return(e=Hs.call(this)||this).elements=t,e}function Ws(){return null!==Gs&&Gs.apply(this,arguments)||this}function Xs(t,e){for(var n=iu(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return vo(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Ys,Qs=(h(Zs,Ys=Je),Zs);function Zs(t){var e=this;return(e=Ys.call(this)||this).elements=t,e}function $s(t,e){for(var n=iu(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!vo(t,e)})}(i[r]);return{arrayValue:{values:n}}}var tu,eu=(h(nu,tu=Je),nu);function nu(t,e){var n=this;return(n=tu.call(this)||this).Kt=t,n.Qt=e,n}function ru(t){return uo(t.integerValue||t.doubleValue)}function iu(t){return _o(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function ou(t,e){this.version=t,this.transformResults=e}var su=function(t,e){this.field=t,this.transform=e},uu=(au.jt=function(){return new au},au.exists=function(t){return new au(void 0,t)},au.updateTime=function(t){return new au(t)},Object.defineProperty(au.prototype,"Wt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),au.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},au);function au(t,e){this.updateTime=t,this.exists=e}function cu(t,e){return void 0!==t.updateTime?e instanceof Co&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Co}o=function(){};function hu(t,e,n,r){return t instanceof yu?function(t,e,n){if(!cu(t.Gt,e))return e;var r=t.value,n=Eu(t.fieldTransforms,n,e),r=Iu(t.fieldTransforms,r,n),e=lu(e);return new Co(t.key,e,r,{bt:!0})}(t,e,r):t instanceof vu?function(t,e,n){if(!cu(t.Gt,e))return e;var r=lu(e),e=bu(t,e,Eu(t.fieldTransforms,n,e));return new Co(t.key,r,e,{bt:!0})}(t,e,r):(e=e,cu((t=t).Gt,e)?new Ro(t.key,Hi.min()):e)}function fu(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Gt.isEqual(e.Gt)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ai(n,r,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof zs&&e instanceof zs||t instanceof Qs&&e instanceof Qs?ai(t.elements,e.elements,vo):t instanceof eu&&e instanceof eu?vo(t.Qt,e.Qt):t instanceof Ks&&e instanceof Ks)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.zt.isEqual(e.zt));var n,r}function lu(t){return t instanceof Co?t.version:Hi.min()}var pu,du,yu=(h(mu,du=o),mu),vu=(h(gu,pu=o),gu);function gu(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=pu.call(this)||this).key=t,o.data=e,o.zt=n,o.Gt=r,o.fieldTransforms=i,o.type=1,o}function mu(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=du.call(this)||this).key=t,i.value=e,i.Gt=n,i.fieldTransforms=r,i.type=0,i}function bu(t,e,n){var r,i,o;return i=t,e=r=e instanceof Co?e.data():xo.empty(),o=new So(e),i.zt.fields.forEach(function(t){var e;t.nt()||(null!==(e=i.data.field(t))?o.set(t,e):o.delete(t))}),r=o.yt(),Iu(t.fieldTransforms,r,n)}function wu(t,e,n){var r=[];ii(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof Co&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof zs?Xs(o,s):o instanceof Qs?$s(o,s):u))}return r}function Eu(t,e,n){for(var r,i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof Co&&(c=n.field(u.field)),i.push((r=c,u=e,c=void 0,(a=a)instanceof Ks?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:u.seconds,nanos:u.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):a instanceof zs?Xs(a,r):a instanceof Qs?$s(a,r):(a=Bs(c=a,r),r=ru(a)+ru(c.Qt),Io(a)&&Io(c.Qt)?qs(r):Fs(c.Kt,r))))}return i}function Iu(t,e,n){for(var r=new So(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.yt()}function _u(t){this.count=t}var Tu,Nu,Au,xu=(h(Du,Au=o),Du),Su=(h(Ou,Nu=o),Ou);function Ou(t,e){var n=this;return(n=Nu.call(this)||this).key=t,n.Gt=e,n.type=3,n.fieldTransforms=[],n}function Du(t,e){var n=this;return(n=Au.call(this)||this).key=t,n.Gt=e,n.type=2,n.fieldTransforms=[],n}function ku(t){switch(t){case pi.OK:return ri(),0;case pi.CANCELLED:case pi.UNKNOWN:case pi.DEADLINE_EXCEEDED:case pi.RESOURCE_EXHAUSTED:case pi.INTERNAL:case pi.UNAVAILABLE:case pi.UNAUTHENTICATED:return;case pi.INVALID_ARGUMENT:case pi.NOT_FOUND:case pi.ALREADY_EXISTS:case pi.PERMISSION_DENIED:case pi.FAILED_PRECONDITION:case pi.ABORTED:case pi.OUT_OF_RANGE:case pi.UNIMPLEMENTED:case pi.DATA_LOSS:return 1;default:return ri(),0}}function Lu(t){if(void 0===t)return ti("GRPC error has no .code"),pi.UNKNOWN;switch(t){case Tu.OK:return pi.OK;case Tu.CANCELLED:return pi.CANCELLED;case Tu.UNKNOWN:return pi.UNKNOWN;case Tu.DEADLINE_EXCEEDED:return pi.DEADLINE_EXCEEDED;case Tu.RESOURCE_EXHAUSTED:return pi.RESOURCE_EXHAUSTED;case Tu.INTERNAL:return pi.INTERNAL;case Tu.UNAVAILABLE:return pi.UNAVAILABLE;case Tu.UNAUTHENTICATED:return pi.UNAUTHENTICATED;case Tu.INVALID_ARGUMENT:return pi.INVALID_ARGUMENT;case Tu.NOT_FOUND:return pi.NOT_FOUND;case Tu.ALREADY_EXISTS:return pi.ALREADY_EXISTS;case Tu.PERMISSION_DENIED:return pi.PERMISSION_DENIED;case Tu.FAILED_PRECONDITION:return pi.FAILED_PRECONDITION;case Tu.ABORTED:return pi.ABORTED;case Tu.OUT_OF_RANGE:return pi.OUT_OF_RANGE;case Tu.UNIMPLEMENTED:return pi.UNIMPLEMENTED;case Tu.DATA_LOSS:return pi.DATA_LOSS;default:return ri()}}(Je=Tu=Tu||{})[Je.OK=0]="OK",Je[Je.CANCELLED=1]="CANCELLED",Je[Je.UNKNOWN=2]="UNKNOWN",Je[Je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Je[Je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Je[Je.NOT_FOUND=5]="NOT_FOUND",Je[Je.ALREADY_EXISTS=6]="ALREADY_EXISTS",Je[Je.PERMISSION_DENIED=7]="PERMISSION_DENIED",Je[Je.UNAUTHENTICATED=16]="UNAUTHENTICATED",Je[Je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Je[Je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Je[Je.ABORTED=10]="ABORTED",Je[Je.OUT_OF_RANGE=11]="OUT_OF_RANGE",Je[Je.UNIMPLEMENTED=12]="UNIMPLEMENTED",Je[Je.INTERNAL=13]="INTERNAL",Je[Je.UNAVAILABLE=14]="UNAVAILABLE",Je[Je.DATA_LOSS=15]="DATA_LOSS";var Pu=(Uu.prototype.Ht=function(t,e){return new Uu(this.J,this.root.Ht(t,e,this.J).copy(null,null,Ru.Jt,null,null))},Uu.prototype.remove=function(t){return new Uu(this.J,this.root.remove(t,this.J).copy(null,null,Ru.Jt,null,null))},Uu.prototype.get=function(t){for(var e=this.root;!e.nt();){var n=this.J(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Uu.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.nt();){var r=this.J(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Uu.prototype.nt=function(){return this.root.nt()},Object.defineProperty(Uu.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Uu.prototype.Yt=function(){return this.root.Yt()},Uu.prototype.Xt=function(){return this.root.Xt()},Uu.prototype.Zt=function(t){return this.root.Zt(t)},Uu.prototype.forEach=function(n){this.Zt(function(t,e){return n(t,e),!1})},Uu.prototype.toString=function(){var n=[];return this.Zt(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Uu.prototype.te=function(t){return this.root.te(t)},Uu.prototype.ee=function(){return new Cu(this.root,null,this.J,!1)},Uu.prototype.ne=function(t){return new Cu(this.root,t,this.J,!1)},Uu.prototype.se=function(){return new Cu(this.root,null,this.J,!0)},Uu.prototype.ie=function(t){return new Cu(this.root,t,this.J,!0)},Uu),Cu=(Vu.prototype.ce=function(){var t=this.oe.pop(),e={key:t.key,value:t.value};if(this.re)for(t=t.left;!t.nt();)this.oe.push(t),t=t.right;else for(t=t.right;!t.nt();)this.oe.push(t),t=t.left;return e},Vu.prototype.ae=function(){return 0<this.oe.length},Vu.prototype.ue=function(){if(0===this.oe.length)return null;var t=this.oe[this.oe.length-1];return{key:t.key,value:t.value}},Vu),Ru=(Mu.prototype.copy=function(t,e,n,r,i){return new Mu(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Mu.prototype.nt=function(){return!1},Mu.prototype.Zt=function(t){return this.left.Zt(t)||t(this.key,this.value)||this.right.Zt(t)},Mu.prototype.te=function(t){return this.right.te(t)||t(this.key,this.value)||this.left.te(t)},Mu.prototype.min=function(){return this.left.nt()?this:this.left.min()},Mu.prototype.Yt=function(){return this.min().key},Mu.prototype.Xt=function(){return this.right.nt()?this.key:this.right.Xt()},Mu.prototype.Ht=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Ht(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Ht(t,e,n))).he()},Mu.prototype.le=function(){if(this.left.nt())return Mu.EMPTY;var t=this;return t.left._e()||t.left.left._e()||(t=t.fe()),(t=t.copy(null,null,null,t.left.le(),null)).he()},Mu.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.nt()||r.left._e()||r.left.left._e()||(r=r.fe()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left._e()&&(r=r.de()),r.right.nt()||r.right._e()||r.right.left._e()||(r=r.we()),0===e(t,r.key)){if(r.right.nt())return Mu.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.le())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.he()},Mu.prototype._e=function(){return this.color},Mu.prototype.he=function(){var t=this;return t.right._e()&&!t.left._e()&&(t=t.Te()),t.left._e()&&t.left.left._e()&&(t=t.de()),t.left._e()&&t.right._e()&&(t=t.Ee()),t},Mu.prototype.fe=function(){var t=this.Ee();return t.right.left._e()&&(t=(t=(t=t.copy(null,null,null,null,t.right.de())).Te()).Ee()),t},Mu.prototype.we=function(){var t=this.Ee();return t.left.left._e()&&(t=(t=t.de()).Ee()),t},Mu.prototype.Te=function(){var t=this.copy(null,null,Mu.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Mu.prototype.de=function(){var t=this.copy(null,null,Mu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Mu.prototype.Ee=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Mu.prototype.Ie=function(){var t=this.me();return Math.pow(2,t)<=this.size+1},Mu.prototype.me=function(){if(this._e()&&this.left._e())throw ri();if(this.right._e())throw ri();var t=this.left.me();if(t!==this.right.me())throw ri();return t+(this._e()?0:1)},Mu);function Mu(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Mu.RED,this.left=null!=r?r:Mu.EMPTY,this.right=null!=i?i:Mu.EMPTY,this.size=this.left.size+1+this.right.size}function Vu(t,e,n,r){this.re=r,this.oe=[];for(var i=1;!t.nt();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.re?t.left:t.right;else{if(0===i){this.oe.push(t);break}this.oe.push(t),t=this.re?t.right:t.left}}function Uu(t,e){this.J=t,this.root=e||Ru.EMPTY}function Fu(){this.size=0}Ru.EMPTY=null,Ru.RED=!0,Ru.Jt=!1,Ru.EMPTY=(Object.defineProperty(Fu.prototype,"key",{get:function(){throw ri()},enumerable:!1,configurable:!0}),Object.defineProperty(Fu.prototype,"value",{get:function(){throw ri()},enumerable:!1,configurable:!0}),Object.defineProperty(Fu.prototype,"color",{get:function(){throw ri()},enumerable:!1,configurable:!0}),Object.defineProperty(Fu.prototype,"left",{get:function(){throw ri()},enumerable:!1,configurable:!0}),Object.defineProperty(Fu.prototype,"right",{get:function(){throw ri()},enumerable:!1,configurable:!0}),Fu.prototype.copy=function(t,e,n,r,i){return this},Fu.prototype.Ht=function(t,e,n){return new Ru(t,e)},Fu.prototype.remove=function(t,e){return this},Fu.prototype.nt=function(){return!0},Fu.prototype.Zt=function(t){return!1},Fu.prototype.te=function(t){return!1},Fu.prototype.Yt=function(){return null},Fu.prototype.Xt=function(){return null},Fu.prototype._e=function(){return!1},Fu.prototype.Ie=function(){return!0},Fu.prototype.me=function(){return 0},new Fu);var qu=(Gu.prototype.has=function(t){return null!==this.data.get(t)},Gu.prototype.first=function(){return this.data.Yt()},Gu.prototype.last=function(){return this.data.Xt()},Object.defineProperty(Gu.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Gu.prototype.indexOf=function(t){return this.data.indexOf(t)},Gu.prototype.forEach=function(n){this.data.Zt(function(t,e){return n(t),!1})},Gu.prototype.Ae=function(t,e){for(var n=this.data.ne(t[0]);n.ae();){var r=n.ce();if(0<=this.J(r.key,t[1]))return;e(r.key)}},Gu.prototype.Re=function(t,e){for(var n=void 0!==e?this.data.ne(e):this.data.ee();n.ae();)if(!t(n.ce().key))return},Gu.prototype.Pe=function(t){t=this.data.ne(t);return t.ae()?t.ce().key:null},Gu.prototype.ee=function(){return new ju(this.data.ee())},Gu.prototype.ne=function(t){return new ju(this.data.ne(t))},Gu.prototype.add=function(t){return this.copy(this.data.remove(t).Ht(t,!0))},Gu.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Gu.prototype.nt=function(){return this.data.nt()},Gu.prototype.ye=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Gu.prototype.isEqual=function(t){if(!(t instanceof Gu))return!1;if(this.size!==t.size)return!1;for(var e=this.data.ee(),n=t.data.ee();e.ae();){var r=e.ce().key,i=n.ce().key;if(0!==this.J(r,i))return!1}return!0},Gu.prototype.rt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Gu.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Gu.prototype.copy=function(t){var e=new Gu(this.J);return e.data=t,e},Gu),ju=(Hu.prototype.ce=function(){return this.ge.ce().key},Hu.prototype.ae=function(){return this.ge.ae()},Hu),Bu=new Pu(Ji.J);function Hu(t){this.ge=t}function Gu(t){this.J=t,this.data=new Pu(this.J)}var Ku=new Pu(Ji.J);var zu=new Pu(Ji.J);var Ju=new qu(Ji.J);function Wu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ju,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Xu=new qu(ui);var Yu=(la.be=function(t){return new la(t.J)},la.prototype.has=function(t){return null!=this.Ve.get(t)},la.prototype.get=function(t){return this.Ve.get(t)},la.prototype.first=function(){return this.pe.Yt()},la.prototype.last=function(){return this.pe.Xt()},la.prototype.nt=function(){return this.pe.nt()},la.prototype.indexOf=function(t){t=this.Ve.get(t);return t?this.pe.indexOf(t):-1},Object.defineProperty(la.prototype,"size",{get:function(){return this.pe.size},enumerable:!1,configurable:!0}),la.prototype.forEach=function(n){this.pe.Zt(function(t,e){return n(t),!1})},la.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ve.Ht(t.key,t),e.pe.Ht(t,null))},la.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ve.remove(t),this.pe.remove(e)):this},la.prototype.isEqual=function(t){if(!(t instanceof la))return!1;if(this.size!==t.size)return!1;for(var e=this.pe.ee(),n=t.pe.ee();e.ae();){var r=e.ce().key,i=n.ce().key;if(!r.isEqual(i))return!1}return!0},la.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},la.prototype.copy=function(t,e){var n=new la;return n.J=this.J,n.Ve=t,n.pe=e,n},la),Qu=(fa.prototype.track=function(t){var e=t.doc.key,n=this.ve.get(e);!n||0!==t.type&&3===n.type?this.ve=this.ve.Ht(e,t):3===t.type&&1!==n.type?this.ve=this.ve.Ht(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ve=this.ve.Ht(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ve=this.ve.Ht(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ve=this.ve.remove(e):1===t.type&&2===n.type?this.ve=this.ve.Ht(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ve=this.ve.Ht(e,{type:2,doc:t.doc}):ri()},fa.prototype.Se=function(){var n=[];return this.ve.Zt(function(t,e){n.push(e)}),n},fa),Zu=(ha.Fe=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new ha(t,e,Yu.be(e),i,n,r,!0,!1)},Object.defineProperty(ha.prototype,"hasPendingWrites",{get:function(){return!this.Ce.nt()},enumerable:!1,configurable:!0}),ha.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.xe===t.xe&&this.Ce.isEqual(t.Ce)&&Ls(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.De.isEqual(t.De)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},ha),$u=(ca.Le=function(t,e){var n=new Map;return n.set(t,ta.Be(t,e)),new ca(Hi.min(),n,Xu,Bu,Wu())},ca),ta=(aa.Be=function(t,e){return new aa(hi.h,e,Wu(),Wu(),Wu())},aa),ea=function(t,e,n,r){this.je=t,this.removedTargetIds=e,this.key=n,this.We=r},na=function(t,e){this.targetId=t,this.Ge=e},ra=function(t,e,n,r){void 0===n&&(n=hi.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ia=(Object.defineProperty(ua.prototype,"qe",{get:function(){return this.Ye},enumerable:!1,configurable:!0}),Object.defineProperty(ua.prototype,"resumeToken",{get:function(){return this.Je},enumerable:!1,configurable:!0}),Object.defineProperty(ua.prototype,"Ze",{get:function(){return 0!==this.ze},enumerable:!1,configurable:!0}),Object.defineProperty(ua.prototype,"tn",{get:function(){return this.Xe},enumerable:!1,configurable:!0}),ua.prototype.en=function(t){0<t.o()&&(this.Xe=!0,this.Je=t)},ua.prototype.nn=function(){var n=Wu(),r=Wu(),i=Wu();return this.He.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:ri()}}),new ta(this.Je,this.Ye,n,r,i)},ua.prototype.sn=function(){this.Xe=!1,this.He=da()},ua.prototype.rn=function(t,e){this.Xe=!0,this.He=this.He.Ht(t,e)},ua.prototype.on=function(t){this.Xe=!0,this.He=this.He.remove(t)},ua.prototype.cn=function(){this.ze+=1},ua.prototype.an=function(){--this.ze},ua.prototype.un=function(){this.Xe=!0,this.Ye=!0},ua),oa=(sa.prototype.wn=function(t){for(var e=0,n=t.je;e<n.length;e++){var r=n[e];t.We instanceof Co?this.Tn(r,t.We):t.We instanceof Ro&&this.En(r,t.key,t.We)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.En(r,t.key,t.We)},sa.prototype.In=function(n){var r=this;this.mn(n,function(t){var e=r.An(t);switch(n.state){case 0:r.Rn(t)&&e.en(n.resumeToken);break;case 1:e.an(),e.Ze||e.sn(),e.en(n.resumeToken);break;case 2:e.an(),e.Ze||r.removeTarget(t);break;case 3:r.Rn(t)&&(e.un(),e.en(n.resumeToken));break;case 4:r.Rn(t)&&(r.Pn(t),e.en(n.resumeToken));break;default:ri()}})},sa.prototype.mn=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.ln.forEach(function(t,e){r.Rn(e)&&n(e)})},sa.prototype.yn=function(t){var e=t.targetId,n=t.Ge.count,t=this.gn(e);t&&(Go(t=t.target)?0===n?(t=new Ji(t.path),this.En(e,t,new Ro(t,Hi.min()))):ii(1===n):this.Vn(e)!==n&&(this.Pn(e),this.dn=this.dn.add(e)))},sa.prototype.pn=function(r){var i=this,o=new Map;this.ln.forEach(function(t,e){var n=i.gn(e);n&&(t.qe&&Go(n.target)&&(n=new Ji(n.target.path),null!==i._n.get(n)||i.bn(e,n)||i.En(e,n,new Ro(n,r))),t.tn&&(o.set(e,t.nn()),t.sn()))});var s=Wu();this.fn.forEach(function(t,e){var n=!0;e.Re(function(t){t=i.gn(t);return!t||2===t.kt||(n=!1)}),n&&(s=s.add(t))});var t=new $u(r,o,this.dn,this._n,s);return this._n=Bu,this.fn=pa(),this.dn=new qu(ui),t},sa.prototype.Tn=function(t,e){var n;this.Rn(t)&&(n=this.bn(t,e.key)?2:0,this.An(t).rn(e.key,n),this._n=this._n.Ht(e.key,e),this.fn=this.fn.Ht(e.key,this.vn(e.key).add(t)))},sa.prototype.En=function(t,e,n){var r;this.Rn(t)&&(r=this.An(t),this.bn(t,e)?r.rn(e,1):r.on(e),this.fn=this.fn.Ht(e,this.vn(e).delete(t)),n&&(this._n=this._n.Ht(e,n)))},sa.prototype.removeTarget=function(t){this.ln.delete(t)},sa.prototype.Vn=function(t){var e=this.An(t).nn();return this.hn.Sn(t).size+e.Ue.size-e.Ke.size},sa.prototype.cn=function(t){this.An(t).cn()},sa.prototype.An=function(t){var e=this.ln.get(t);return e||(e=new ia,this.ln.set(t,e)),e},sa.prototype.vn=function(t){var e=this.fn.get(t);return e||(e=new qu(ui),this.fn=this.fn.Ht(t,e)),e},sa.prototype.Rn=function(t){var e=null!==this.gn(t);return e||$r("WatchChangeAggregator","Detected inactive target",t),e},sa.prototype.gn=function(t){var e=this.ln.get(t);return e&&e.Ze?null:this.hn.Dn(t)},sa.prototype.Pn=function(e){var n=this;this.ln.set(e,new ia),this.hn.Sn(e).forEach(function(t){n.En(e,t,null)})},sa.prototype.bn=function(t,e){return this.hn.Sn(t).has(e)},sa);function sa(t){this.hn=t,this.ln=new Map,this._n=Bu,this.fn=pa(),this.dn=new qu(ui)}function ua(){this.ze=0,this.He=da(),this.Je=hi.h,this.Ye=!1,this.Xe=!0}function aa(t,e,n,r,i){this.resumeToken=t,this.qe=e,this.Ue=n,this.Qe=r,this.Ke=i}function ca(t,e,n,r,i){this.Mt=t,this.Oe=e,this.ke=n,this.Me=r,this.$e=i}function ha(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.De=n,this.docChanges=r,this.Ce=i,this.fromCache=o,this.xe=s,this.Ne=u}function fa(){this.ve=new Pu(Ji.J)}function la(n){this.J=n?function(t,e){return n(t,e)||Ji.J(t.key,e.key)}:function(t,e){return Ji.J(t.key,e.key)},this.Ve=Ku,this.pe=new Pu(this.J)}function pa(){return new Pu(Ji.J)}function da(){return new Pu(Ji.J)}var ya={asc:"ASCENDING",desc:"DESCENDING"},va={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ga=function(t,e){this.T=t,this.qt=e};function ma(t,e){return t.qt?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ba(t,e){return t.qt?e.toBase64():e.toUint8Array()}function wa(t){return ii(!!t),Hi.j((t=so(t),new Bi(t.seconds,t.nanos)))}function Ea(t,e){return new Gi(["projects",t.projectId,"databases",t.database]).child("documents").child(e).ot()}function Ia(t){t=Gi.ct(t);return ii(ja(t)),t}function _a(t,e){return Ea(t.T,e.path)}function Ta(t,e){e=Ia(e);if(e.get(1)!==t.T.projectId)throw new di(pi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.T.projectId);if(e.get(3)!==t.T.database)throw new di(pi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.T.database);return new Ji(Sa(e))}function Na(t,e){return Ea(t.T,e)}function Aa(t){t=Ia(t);return 4===t.length?Gi.at():Sa(t)}function xa(t){return new Gi(["projects",t.T.projectId,"databases",t.T.database]).ot()}function Sa(t){return ii(4<t.length&&"documents"===t.get(4)),t.X(5)}function Oa(t,e,n){return{name:_a(t,e),fields:n.proto.mapValue.fields}}function Da(t,e,n){var r=Ta(t,e.name),t=wa(e.updateTime),e=new xo({mapValue:{fields:e.fields}});return new Co(r,t,e,{hasCommittedMutations:!!n})}function ka(t,e){var n,r,i;if(e instanceof yu)n={update:Oa(t,e.key,e.value)};else if(e instanceof xu)n={delete:_a(t,e.key)};else if(e instanceof vu)n={update:Oa(t,e.key,e.data),updateMask:(i=e.zt,r=[],i.fields.forEach(function(t){return r.push(t.ot())}),{fieldPaths:r})};else{if(!(e instanceof Su))return ri();n={verify:_a(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Ks)return{fieldPath:t.field.ot(),setToServerValue:"REQUEST_TIME"};if(e instanceof zs)return{fieldPath:t.field.ot(),appendMissingElements:{values:e.elements}};if(e instanceof Qs)return{fieldPath:t.field.ot(),removeAllFromArray:{values:e.elements}};if(e instanceof eu)return{fieldPath:t.field.ot(),increment:e.Qt};throw ri()})),e.Gt.Wt||(n.currentDocument=void 0!==(i=e.Gt).updateTime?{updateTime:(e=t,t=i.updateTime,ma(e,t.G()))}:void 0!==i.exists?{exists:i.exists}:ri()),n}function La(e,t){var n=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?uu.updateTime(wa(s.updateTime)):void 0!==s.exists?uu.exists(s.exists):uu.jt():uu.jt(),r=t.updateTransforms?t.updateTransforms.map(function(t){return function(t,e){var n,r=null;"setToServerValue"in e?(ii("REQUEST_TIME"===e.setToServerValue),r=new Ks):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new zs(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new Qs(n)):"increment"in e?r=new eu(t,e.increment):ri();e=zi._t(e.fieldPath);return new su(e,r)}(e,t)}):[];if(t.update){t.update.name;var i=Ta(e,t.update.name),o=new xo({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(s=t.updateMask.fieldPaths||[],new ro(s.map(function(t){return zi._t(t)})));return new vu(i,o,s,n,r)}return new yu(i,o,n,r)}if(t.delete){r=Ta(e,t.delete);return new xu(r,n)}if(t.verify){t=Ta(e,t.verify);return new Su(t,n)}return ri()}function Pa(t,e){return{documents:[Na(t,e.path)]}}function Ca(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Na(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Na(t,r.Z()),n.structuredQuery.from=[{collectionId:r.et()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(No(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NAN"}};if(To(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(No(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NOT_NAN"}};if(To(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ua(t.field),op:(e=t.op,va[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:Ua((t=t).field),direction:(t=t.dir,ya[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.qt||fo(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Ma(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ma(e.endAt)),n}function Ra(t){var e=Aa(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(ii(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[qa(t)]:void 0!==t.fieldFilter?[(n=t,zo.create(Fa(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return ri()}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):ri():[];var n}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new ms(Fa((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=fo(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=Va(n.startAt));var u=null;return n.endAt&&(u=Va(n.endAt)),Is(e,i,t,o,r,"F",s,u)}function Ma(t){return{before:t.before,values:t.position}}function Va(t){var e=!!t.before,t=t.values||[];return new ls(t,e)}function Ua(t){return{fieldPath:t.ot()}}function Fa(t){return zi._t(t.fieldPath)}function qa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Fa(t.unaryFilter.field);return zo.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Fa(t.unaryFilter.field);return zo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":n=Fa(t.unaryFilter.field);return zo.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":t=Fa(t.unaryFilter.field);return zo.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return ri()}}function ja(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Ba,Ha=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Ga=($a.prototype.catch=function(t){return this.next(void 0,t)},$a.prototype.next=function(r,i){var o=this;return this.Fn&&ri(),this.Fn=!0,this.Nn?this.error?this.On(i,this.error):this.kn(r,this.result):new $a(function(e,n){o.Cn=function(t){o.kn(r,t).next(e,n)},o.xn=function(t){o.On(i,t).next(e,n)}})},$a.prototype.Mn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},$a.prototype.$n=function(t){try{var e=t();return e instanceof $a?e:$a.resolve(e)}catch(t){return $a.reject(t)}},$a.prototype.kn=function(t,e){return t?this.$n(function(){return t(e)}):$a.resolve(e)},$a.prototype.On=function(t,e){return t?this.$n(function(){return t(e)}):$a.reject(e)},$a.resolve=function(n){return new $a(function(t,e){t(n)})},$a.reject=function(n){return new $a(function(t,e){e(n)})},$a.Ln=function(t){return new $a(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},$a.Bn=function(t){for(var n=$a.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?$a.resolve(t):e()})}(r[e]);return n},$a.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Ln(i)},$a),Ka=(Za.open=function(t,e,n,r){try{return new Za(e,t.transaction(r,n))}catch(t){throw new Wa(e,t)}},Object.defineProperty(Za.prototype,"Un",{get:function(){return this.qn.promise},enumerable:!1,configurable:!0}),Za.prototype.abort=function(t){t&&this.qn.reject(t),this.aborted||($r("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Za.prototype.store=function(t){t=this.transaction.objectStore(t);return new ec(t)},Za),za=(Qa.delete=function(t){return $r("SimpleDb","Removing database:",t),rc(window.indexedDB.deleteDatabase(t)).Mn()},Qa.jn=function(){if("undefined"==typeof indexedDB)return!1;if(Qa.Wn())return!0;var t=p(),e=Qa.Kn(t),n=0<e&&e<10,e=Qa.Gn(t),e=0<e&&e<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||e)},Qa.Wn=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.zn)},Qa.Hn=function(t,e){return t.store(e)},Qa.Kn=function(t){t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)},Qa.Gn=function(t){t=t.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)},Qa.prototype.Jn=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:($r("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result;e(t)},r.onblocked=function(){n(new Wa(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){t=t.target.error;"VersionError"===t.name?n(new di(pi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Wa(o,t))},r.onupgradeneeded=function(t){$r("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.Qn.Yn(e,r.transaction,t.oldVersion,i.version).next(function(){$r("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Xn&&(this.db.onversionchange=function(t){return i.Xn(t)}),this.db)]}})})},Qa.prototype.Zn=function(e){this.Xn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Qa.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Jn(u)];case 2:return s.db=t.sent(),e=Ka.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),Ga.reject(t)}).Mn(),r={},n.catch(function(){}),[4,e.Un];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,$r("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Qa.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Qa),Ja=(Object.defineProperty(Ya.prototype,"Nn",{get:function(){return this.es},enumerable:!1,configurable:!0}),Object.defineProperty(Ya.prototype,"ss",{get:function(){return this.ns},enumerable:!1,configurable:!0}),Object.defineProperty(Ya.prototype,"cursor",{set:function(t){this.ts=t},enumerable:!1,configurable:!0}),Ya.prototype.done=function(){this.es=!0},Ya.prototype.rs=function(t){this.ns=t},Ya.prototype.delete=function(){return rc(this.ts.delete())},Ya),Wa=(h(Xa,Ba=di),Xa);function Xa(t,e){var n=this;return(n=Ba.call(this,pi.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function Ya(t){this.ts=t,this.es=!1,this.ns=null}function Qa(t,e,n){this.name=t,this.version=e,this.Qn=n,12.2===Qa.Kn(p())&&ti("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Za(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.qn=new Ha,this.transaction.oncomplete=function(){n.qn.resolve()},this.transaction.onabort=function(){t.error?n.qn.reject(new Wa(e,t.error)):n.qn.resolve()},this.transaction.onerror=function(t){t=oc(t.target.error);n.qn.reject(new Wa(e,t))}}function $a(t){var e=this;this.Cn=null,this.xn=null,this.result=void 0,this.error=void 0,this.Nn=!1,this.Fn=!1,t(function(t){e.Nn=!0,e.result=t,e.Cn&&e.Cn(t)},function(t){e.Nn=!0,e.error=t,e.xn&&e.xn(t)})}function tc(t){return"IndexedDbTransactionError"===t.name}var ec=(nc.prototype.put=function(t,e){t=void 0!==e?($r("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):($r("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return rc(t)},nc.prototype.add=function(t){return $r("SimpleDb","ADD",this.store.name,t,t),rc(this.store.add(t))},nc.prototype.get=function(e){var n=this;return rc(this.store.get(e)).next(function(t){return void 0===t&&(t=null),$r("SimpleDb","GET",n.store.name,e,t),t})},nc.prototype.delete=function(t){return $r("SimpleDb","DELETE",this.store.name,t),rc(this.store.delete(t))},nc.prototype.count=function(){return $r("SimpleDb","COUNT",this.store.name),rc(this.store.count())},nc.prototype.os=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.cs(e,function(t,e){n.push(e)}).next(function(){return n})},nc.prototype.us=function(t,e){$r("SimpleDb","DELETE ALL",this.store.name);e=this.options(t,e);e.hs=!1;e=this.cursor(e);return this.cs(e,function(t,e,n){return n.delete()})},nc.prototype.ls=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.cs(n,e)},nc.prototype._s=function(r){var t=this.cursor({});return new Ga(function(n,e){t.onerror=function(t){t=oc(t.target.error);e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},nc.prototype.cs=function(t,i){var o=[];return new Ga(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new Ja(n),(t=i(n.primaryKey,n.value,e))instanceof Ga&&(t=t.catch(function(t){return e.done(),Ga.reject(t)}),o.push(t)),e.Nn?r():null===e.ss?n.continue():n.continue(e.ss)):r()}}).next(function(){return Ga.Ln(o)})},nc.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},nc.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.hs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},nc);function nc(t){this.store=t}function rc(t){return new Ga(function(e,n){t.onsuccess=function(t){t=t.target.result;e(t)},t.onerror=function(t){t=oc(t.target.error);n(t)}})}var ic=!1;function oc(t){var e=za.Kn(p());if(12.2<=e&&e<13){e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){var n=new di("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ic||(ic=!0,setTimeout(function(){throw n},0)),n}}return t}var sc=(uc.Is=function(t,e,n,r,i){i=new uc(t,e,Date.now()+n,r,i);return i.start(n),i},uc.prototype.start=function(t){var e=this;this.As=setTimeout(function(){return e.Rs()},t)},uc.prototype.Ps=function(){return this.Rs()},uc.prototype.cancel=function(t){null!==this.As&&(this.clearTimeout(),this.Es.reject(new di(pi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},uc.prototype.Rs=function(){var e=this;this.fs.ys(function(){return null!==e.As?(e.clearTimeout(),e.op().then(function(t){return e.Es.resolve(t)})):Promise.resolve()})},uc.prototype.clearTimeout=function(){null!==this.As&&(this.Ts(this),clearTimeout(this.As),this.As=null)},uc);function uc(t,e,n,r,i){this.fs=t,this.ds=e,this.ws=n,this.op=r,this.Ts=i,this.Es=new Ha,this.then=this.Es.promise.then.bind(this.Es.promise),this.Es.promise.catch(function(t){})}function ac(t,e){if(ti("AsyncQueue",e+": "+t),tc(t))return new di(pi.UNAVAILABLE,e+": "+t);throw t}var cc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",o=(hc.prototype.Vs=function(t){this.gs.push(t)},hc.prototype.ps=function(){this.gs.forEach(function(t){return t()})},hc);function hc(){this.gs=[]}function fc(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=lc(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return lc(e)}function lc(t){return t+"\x01\x01"}function pc(t){var e=t.length;if(ii(2<=e),2===e)return ii("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Gi.at();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&ri(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:ri()}o=s+2}return new Gi(r)}function dc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var yc=function(t,e){this.seconds=t,this.nanoseconds=e};dc.store="owner",dc.key="owner";function vc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}vc.store="mutationQueues",vc.keyPath="userId";function gc(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}gc.store="mutations",gc.keyPath="batchId",gc.userMutationsIndex="userMutationsIndex",gc.userMutationsKeyPath=["userId","batchId"];var mc=(bc.prefixForUser=function(t){return[t]},bc.prefixForPath=function(t,e){return[t,fc(e)]},bc.key=function(t,e,n){return[t,fc(e),n]},bc);function bc(){}mc.store="documentMutations",mc.PLACEHOLDER=new mc;function wc(t,e){this.path=t,this.readTime=e}function Ec(t,e){this.path=t,this.version=e}var Ic=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ic.store="remoteDocuments",Ic.readTimeIndex="readTimeIndex",Ic.readTimeIndexPath="readTime",Ic.collectionReadTimeIndex="collectionReadTimeIndex",Ic.collectionReadTimeIndexPath=["parentPath","readTime"];function _c(t){this.byteSize=t}_c.store="remoteDocumentGlobal",_c.key="remoteDocumentGlobalKey";function Tc(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}Tc.store="targets",Tc.keyPath="targetId",Tc.queryTargetsIndexName="queryTargetsIndex",Tc.queryTargetsKeyPath=["canonicalId","targetId"];var Nc=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Nc.store="targetDocuments",Nc.keyPath=["targetId","path"],Nc.documentTargetsIndex="documentTargetsIndex",Nc.documentTargetsKeyPath=["path","targetId"];function Ac(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}Ac.key="targetGlobalKey",Ac.store="targetGlobal";function xc(t,e){this.collectionId=t,this.parent=e}xc.store="collectionParents",xc.keyPath=["collectionId","parent"];function Sc(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}Sc.store="clientMetadata",Sc.keyPath="clientId";function Oc(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}Oc.store="bundles",Oc.keyPath="bundleId";function Dc(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}Dc.store="namedQueries",Dc.keyPath="name";var kc,Lc=f(f(f(f([vc.store,gc.store,mc.store,Ic.store,Tc.store,dc.store,Ac.store,Nc.store],[Sc.store]),[_c.store]),[xc.store]),[Oc.store,Dc.store]),Pc=(h(Cc,kc=o),Cc);function Cc(t,e){var n=this;return(n=kc.call(this)||this).bs=t,n.vs=e,n}function Rc(t,e){return za.Hn(t.bs,e)}var Mc=(qc.prototype.Ds=function(t,e,n){for(var r,i,o,s,u,a,c=n.Cs,h=0;h<this.mutations.length;h++){var f=this.mutations[h];f.key.isEqual(t)&&(r=f,i=e,o=c[h],f=a=u=s=void 0,e=r instanceof yu?(u=o,f=(s=r).value,u.transformResults&&(a=wu(s.fieldTransforms,i,u.transformResults),f=Iu(s.fieldTransforms,f,a)),new Co(s.key,u.version,f,{hasCommittedMutations:!0})):r instanceof vu?function(t,e,n){if(!cu(t.Gt,e))return new Mo(t.key,n.version);e=bu(t,e,n.transformResults?wu(t.fieldTransforms,e,n.transformResults):[]);return new Co(t.key,n.version,e,{hasCommittedMutations:!0})}(r,i,o):new Ro(r.key,o.version,{hasCommittedMutations:!0}))}return e},qc.prototype.xs=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(i=r[n]).key.isEqual(t)&&(e=hu(i,e,0,this.Ss));for(var i,o=0,s=this.mutations;o<s.length;o++){(i=s[o]).key.isEqual(t)&&(e=hu(i,e,0,this.Ss))}return e},qc.prototype.Ns=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.xs(t.key,n.get(t.key));e&&(i=i.Ht(t.key,e))}),i},qc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Wu())},qc.prototype.isEqual=function(t){return this.batchId===t.batchId&&ai(this.mutations,t.mutations,fu)&&ai(this.baseMutations,t.baseMutations,fu)},qc),Vc=(Fc.from=function(t,e,n){ii(t.mutations.length===n.length);for(var r=zu,i=t.mutations,o=0;o<i.length;o++)r=r.Ht(i[o].key,n[o].version);return new Fc(t,e,n,r)},Fc),Uc=function(t){this.ks=t};function Fc(t,e,n,r){this.batch=t,this.Fs=e,this.Cs=n,this.Os=r}function qc(t,e,n,r){this.batchId=t,this.Ss=e,this.baseMutations=n,this.mutations=r}function jc(t,e){if(e.document)return Da(t.ks,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ji.Et(e.noDocument.path),r=zc(e.noDocument.readTime);return new Ro(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){n=Ji.Et(e.unknownDocument.path),r=zc(e.unknownDocument.version);return new Mo(n,r)}return ri()}function Bc(t,e,n){var r=Hc(n),n=e.key.path.Z().rt();if(e instanceof Co){var i={name:_a(o=t.ks,(s=e).key),fields:s.vt().mapValue.fields,updateTime:ma(o,s.version.G())},o=e.hasCommittedMutations;return new Ic(null,null,i,o,r,n)}if(e instanceof Ro){var s=e.key.path.rt(),i=Kc(e.version),o=e.hasCommittedMutations;return new Ic(null,new wc(s,i),null,o,r,n)}if(e instanceof Mo){o=e.key.path.rt(),e=Kc(e.version);return new Ic(new Ec(o,e),null,null,!0,r,n)}return ri()}function Hc(t){t=t.G();return[t.seconds,t.nanoseconds]}function Gc(t){t=new Bi(t[0],t[1]);return Hi.j(t)}function Kc(t){t=t.G();return new yc(t.seconds,t.nanoseconds)}function zc(t){t=new Bi(t.seconds,t.nanoseconds);return Hi.j(t)}function Jc(e,t){for(var n=(t.baseMutations||[]).map(function(t){return La(e.ks,t)}),r=t.mutations.length-1;0<=r;--r){var i=t.mutations[r];void 0!==(null==i?void 0:i.transform)&&(t.mutations[r-1].updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r,1),--r)}var o=t.mutations.map(function(t){return La(e.ks,t)}),s=Bi.fromMillis(t.localWriteTimeMs);return new Mc(t.batchId,s,n,o)}function Wc(t){var e=zc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?zc(t.lastLimboFreeSnapshotVersion):Hi.min(),r=void 0!==t.query.documents?(ii(1===(r=t.query).documents.length),Ds(_s(Aa(r.documents[0])))):Ds(Ra(t.query));return new Vs(r,t.targetId,0,t.lastListenSequenceNumber,e,n,hi.fromBase64String(t.resumeToken))}function Xc(t,e){var n=Kc(e.Mt),r=Kc(e.lastLimboFreeSnapshotVersion),i=(Go(e.target)?Pa:Ca)(t.ks,e.target),t=e.resumeToken.toBase64();return new Tc(e.targetId,Bo(e.target),n,t,e.sequenceNumber,r,i)}function Yc(t){var e=Ra({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?ks(e,e.limit,"L"):e}var Qc=(Zc.prototype.Ms=function(t,e){return $c(t).get(e).next(function(t){if(t)return{id:(t=t).bundleId,createTime:zc(t.createTime),version:t.version}})},Zc.prototype.$s=function(t,e){return $c(t).put({bundleId:(e=e).id,createTime:Kc(wa(e.createTime)),version:e.version})},Zc.prototype.Ls=function(t,e){return th(t).get(e).next(function(t){if(t)return{name:(t=t).name,query:Yc(t.bundledQuery),readTime:zc(t.readTime)}})},Zc.prototype.Bs=function(t,e){return th(t).put({name:(e=e).name,readTime:Kc(wa(e.readTime)),bundledQuery:e.bundledQuery})},Zc);function Zc(){}function $c(t){return Rc(t,Oc.store)}function th(t){return Rc(t,Dc.store)}var eh=(sh.prototype.Us=function(t,e){return this.qs.add(e),Ga.resolve()},sh.prototype.Qs=function(t,e){return Ga.resolve(this.qs.getEntries(e))},sh),nh=(oh.prototype.add=function(t){var e=t.et(),n=t.Z(),r=this.index[e]||new qu(Gi.J),t=!r.has(n);return this.index[e]=r.add(n),t},oh.prototype.has=function(t){var e=t.et(),t=t.Z(),e=this.index[e];return e&&e.has(t)},oh.prototype.getEntries=function(t){return(this.index[t]||new qu(Gi.J)).rt()},oh),rh=(ih.prototype.Us=function(t,e){var n=this;if(this.Ks.has(e))return Ga.resolve();var r=e.et(),i=e.Z();t.Vs(function(){n.Ks.add(e)});i={collectionId:r,parent:fc(i)};return uh(t).put(i)},ih.prototype.Qs=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[ci(i),""],!1,!0);return uh(t).os(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(pc(r.parent))}return o})},ih);function ih(){this.Ks=new nh}function oh(){this.index={}}function sh(){this.qs=new nh}function uh(t){return Rc(t,xc.store)}var ah={js:!1,Ws:0,Gs:0,zs:0},ch=(hh.Xs=function(t){return new hh(t,hh.Zs,hh.ti)},hh);function hh(t,e,n){this.Hs=t,this.Js=e,this.Ys=n}function fh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==pi.FAILED_PRECONDITION||e.message!==cc)throw e;return $r("LocalStore","Unexpectedly lost primary lease"),[2]})})}ch.Zs=10,ch.ti=1e3,ch.ei=new ch(41943040,ch.Zs,ch.ti),ch.ni=new ch(-1,0,0);var lh=(dh.prototype.get=function(t){var e=this.si(t),e=this.ri[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.ii(o,t))return i}},dh.prototype.has=function(t){return void 0!==this.get(t)},dh.prototype.set=function(t,e){var n=this.si(t),r=this.ri[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.ii(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.ri[n]=[[t,e]]},dh.prototype.delete=function(t){var e=this.si(t),n=this.ri[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.ii(n[r][0],t))return 1===n.length?delete this.ri[e]:n.splice(r,1),!0;return!1},dh.prototype.forEach=function(s){eo(this.ri,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},dh.prototype.nt=function(){return no(this.ri)},dh),Je=(ph.prototype.ai=function(t){t=this.oi.get(t);return t?t.readTime:Hi.min()},ph.prototype.ui=function(t,e){this.hi(),this.oi.set(t.key,{li:t,readTime:e})},ph.prototype._i=function(t,e){void 0===e&&(e=null),this.hi(),this.oi.set(t,{li:null,readTime:e})},ph.prototype.fi=function(t,e){this.hi();var n=this.oi.get(e);return void 0!==n?Ga.resolve(n.li):this.di(t,e)},ph.prototype.getEntries=function(t,e){return this.wi(t,e)},ph.prototype.apply=function(t){return this.hi(),this.ci=!0,this.Ti(t)},ph.prototype.hi=function(){},ph);function ph(){this.oi=new lh(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.ci=!1}function dh(t,e){this.si=t,this.ii=e,this.ri={}}function yh(t,e,n){var r=t.store(gc.store),i=t.store(mc.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.ls({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){ii(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],f=mc.key(e,h.key.path,n.batchId);o.push(i.delete(f)),u.push(h.key)}return Ga.Ln(o).next(function(){return u})}function vh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ri();e=t.noDocument}return JSON.stringify(e).length}var gh=(mh.Ai=function(t,e,n,r){return ii(""!==t.uid),new mh(t.A()?t.uid:"",e,n,r)},mh.prototype.Ri=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wh(t).ls({index:gc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},mh.prototype.Pi=function(d,y,v,g){var m=this,b=Eh(d),w=wh(d);return w.add({}).next(function(t){ii("number"==typeof t);for(var e,n,r,i,o,s=new Mc(t,y,v,g),u=(e=m.Kt,n=m.userId,i=(r=s).baseMutations.map(function(t){return ka(e.ks,t)}),o=r.mutations.map(function(t){return ka(e.ks,t)}),new gc(n,r.batchId,r.Ss.toMillis(),i,o)),a=[],c=new qu(function(t,e){return ui(t.ot(),e.ot())}),h=0,f=g;h<f.length;h++){var l=f[h],p=mc.key(m.userId,l.key.path,t),c=c.add(l.key.path.Z());a.push(w.put(u)),a.push(b.put(p,mc.PLACEHOLDER))}return c.forEach(function(t){a.push(m.Ei.Us(d,t))}),d.Vs(function(){m.mi[t]=s.keys()}),Ga.Ln(a).next(function(){return s})})},mh.prototype.yi=function(t,e){var n=this;return wh(t).get(e).next(function(t){return t?(ii(t.userId===n.userId),Jc(n.Kt,t)):null})},mh.prototype.gi=function(t,e){var n=this;return this.mi[e]?Ga.resolve(this.mi[e]):this.yi(t,e).next(function(t){if(t){t=t.keys();return n.mi[e]=t}return null})},mh.prototype.Vi=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return wh(t).ls({index:gc.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(ii(e.batchId>=i),o=Jc(r.Kt,e)),n.done()}).next(function(){return o})},mh.prototype.pi=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return wh(t).ls({index:gc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},mh.prototype.bi=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return wh(t).os(gc.userMutationsIndex,n).next(function(t){return t.map(function(t){return Jc(e.Kt,t)})})},mh.prototype.vi=function(o,s){var u=this,t=mc.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return Eh(o).ls({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=pc(i);if(r===u.userId&&s.path.isEqual(i))return wh(o).get(t).next(function(t){if(!t)throw ri();ii(t.userId===u.userId),a.push(Jc(u.Kt,t))});n.done()}).next(function(){return a})},mh.prototype.Si=function(e,t){var s=this,u=new qu(ui),n=[];return t.forEach(function(o){var t=mc.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=Eh(e).ls({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=pc(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),Ga.Ln(n).next(function(){return s.Di(e,u)})},mh.prototype.Ci=function(t,e){var o=this,s=e.path,u=s.length+1,e=mc.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new qu(ui);return Eh(t).ls({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=pc(i);r===o.userId&&s.st(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.Di(t,a)})},mh.prototype.Di=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(wh(e).get(t).next(function(t){if(null===t)throw ri();ii(t.userId===n.userId),r.push(Jc(n.Kt,t))}))}),Ga.Ln(i).next(function(){return r})},mh.prototype.xi=function(e,n){var r=this;return yh(e.bs,this.userId,n).next(function(t){return e.Vs(function(){r.Ni(n.batchId)}),Ga.forEach(t,function(t){return r.Ii.Fi(e,t)})})},mh.prototype.Ni=function(t){delete this.mi[t]},mh.prototype.Oi=function(e){var i=this;return this.Ri(e).next(function(t){if(!t)return Ga.resolve();var t=IDBKeyRange.lowerBound(mc.prefixForUser(i.userId)),r=[];return Eh(e).ls({range:t},function(t,e,n){t[0]===i.userId?(t=pc(t[1]),r.push(t)):n.done()}).next(function(){ii(0===r.length)})})},mh.prototype.ki=function(t,e){return bh(t,this.userId,e)},mh.prototype.Mi=function(t){var e=this;return Ih(t).get(this.userId).next(function(t){return t||new vc(e.userId,-1,"")})},mh);function mh(t,e,n,r){this.userId=t,this.Kt=e,this.Ei=n,this.Ii=r,this.mi={}}function bh(t,o,e){var e=mc.prefixForPath(o,e.path),s=e[1],e=IDBKeyRange.lowerBound(e),u=!1;return Eh(t).ls({range:e,hs:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function wh(t){return Rc(t,gc.store)}function Eh(t){return Rc(t,mc.store)}function Ih(t){return Rc(t,vc.store)}var _h=(Ah.prototype.next=function(){return this.$i+=2,this.$i},Ah.Li=function(){return new Ah(0)},Ah.Bi=function(){return new Ah(-1)},Ah),Th=(Nh.prototype.qi=function(n){var r=this;return this.Ui(n).next(function(t){var e=new _h(t.highestTargetId);return t.highestTargetId=e.next(),r.Qi(n,t).next(function(){return t.highestTargetId})})},Nh.prototype.Ki=function(t){return this.Ui(t).next(function(t){return Hi.j(new Bi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Nh.prototype.ji=function(t){return this.Ui(t).next(function(t){return t.highestListenSequenceNumber})},Nh.prototype.Wi=function(e,n,r){var i=this;return this.Ui(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.G()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Qi(e,t)})},Nh.prototype.Gi=function(e,n){var r=this;return this.zi(e,n).next(function(){return r.Ui(e).next(function(t){return t.targetCount+=1,r.Hi(n,t),r.Qi(e,t)})})},Nh.prototype.Ji=function(t,e){return this.zi(t,e)},Nh.prototype.Yi=function(e,t){var n=this;return this.Xi(e,t.targetId).next(function(){return xh(e).delete(t.targetId)}).next(function(){return n.Ui(e)}).next(function(t){return ii(0<t.targetCount),--t.targetCount,n.Qi(e,t)})},Nh.prototype.Zi=function(n,r,i){var o=this,s=0,u=[];return xh(n).ls(function(t,e){e=Wc(e);e.sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.Yi(n,e)))}).next(function(){return Ga.Ln(u)}).next(function(){return s})},Nh.prototype.mn=function(t,n){return xh(t).ls(function(t,e){e=Wc(e);n(e)})},Nh.prototype.Ui=function(t){return Sh(t).get(Ac.key).next(function(t){return ii(null!==t),t})},Nh.prototype.Qi=function(t,e){return Sh(t).put(Ac.key,e)},Nh.prototype.zi=function(t,e){return xh(t).put(Xc(this.Kt,e))},Nh.prototype.Hi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Nh.prototype.tr=function(t){return this.Ui(t).next(function(t){return t.targetCount})},Nh.prototype.er=function(t,r){var e=Bo(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return xh(t).ls({range:e,index:Tc.queryTargetsIndexName},function(t,e,n){e=Wc(e);Ho(r,e.target)&&(i=e,n.done())}).next(function(){return i})},Nh.prototype.nr=function(n,t,r){var i=this,o=[],s=Oh(n);return t.forEach(function(t){var e=fc(t.path);o.push(s.put(new Nc(r,e))),o.push(i.Ii.sr(n,r,t))}),Ga.Ln(o)},Nh.prototype.ir=function(n,t,r){var i=this,o=Oh(n);return Ga.forEach(t,function(t){var e=fc(t.path);return Ga.Ln([o.delete([r,e]),i.Ii.rr(n,r,t)])})},Nh.prototype.Xi=function(t,e){t=Oh(t),e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)},Nh.prototype.cr=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Oh(t),r=Wu();return t.ls({range:e,hs:!0},function(t,e,n){t=pc(t[1]),t=new Ji(t);r=r.add(t)}).next(function(){return r})},Nh.prototype.ki=function(t,e){var e=fc(e.path),e=IDBKeyRange.bound([e],[ci(e)],!1,!0),i=0;return Oh(t).ls({index:Nc.documentTargetsIndex,hs:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Nh.prototype.Dn=function(t,e){return xh(t).get(e).next(function(t){return t?Wc(t):null})},Nh);function Nh(t,e){this.Ii=t,this.Kt=e}function Ah(t){this.$i=t}function xh(t){return Rc(t,Tc.store)}function Sh(t){return Rc(t,Ac.store)}function Oh(t){return Rc(t,Nc.store)}function Dh(t,e){var n=t[0],r=t[1],t=e[0],e=e[1],t=ui(n,t);return 0===t?ui(r,e):t}var kh=(Uh.prototype.hr=function(){return++this.ur},Uh.prototype.lr=function(t){var e=[t,this.hr()];this.buffer.size<this.ar?this.buffer=this.buffer.add(e):Dh(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Uh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Uh),Lh=(Vh.prototype.start=function(t){-1!==this._r.params.Hs&&this.Tr(t)},Vh.prototype.stop=function(){this.wr&&(this.wr.cancel(),this.wr=null)},Object.defineProperty(Vh.prototype,"Er",{get:function(){return null!==this.wr},enumerable:!1,configurable:!0}),Vh.prototype.Tr=function(n){var t=this,e=this.dr?3e5:6e4;$r("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.wr=this.fs.Ir("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.wr=null,this.dr=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.mr(this._r)];case 2:return t.sent(),[3,7];case 3:return tc(e=t.sent())?($r("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,fh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Tr(n)];case 8:return t.sent(),[2]}})})})},Vh),Ph=(Mh.prototype.Rr=function(t,e){return this.Ar.Pr(t).next(function(t){return Math.floor(e/100*t)})},Mh.prototype.yr=function(t,e){var n=this;if(0===e)return Ga.resolve(Ci.U);var r=new kh(e);return this.Ar.mn(t,function(t){return r.lr(t.sequenceNumber)}).next(function(){return n.Ar.gr(t,function(t){return r.lr(t)})}).next(function(){return r.maxValue})},Mh.prototype.Zi=function(t,e,n){return this.Ar.Zi(t,e,n)},Mh.prototype.Vr=function(t,e){return this.Ar.Vr(t,e)},Mh.prototype.pr=function(e,n){var r=this;return-1===this.params.Hs?($r("LruGarbageCollector","Garbage collection skipped; disabled"),Ga.resolve(ah)):this.br(e).next(function(t){return t<r.params.Hs?($r("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Hs),ah):r.vr(e,n)})},Mh.prototype.br=function(t){return this.Ar.br(t)},Mh.prototype.vr=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.Rr(e,this.params.Js).next(function(t){return i=t>h.params.Ys?($r("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Ys+" from "+t),h.params.Ys):t,s=Date.now(),h.yr(e,i)}).next(function(t){return r=t,u=Date.now(),h.Zi(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.Vr(e,r)}).next(function(t){return c=Date.now(),Zr()<=l.DEBUG&&$r("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),Ga.resolve({js:!0,Ws:i,Gs:o,zs:t})})},Mh),Ch=(Rh.prototype.Pr=function(t){var n=this.Sr(t);return this.db.Dr().tr(t).next(function(e){return n.next(function(t){return e+t})})},Rh.prototype.Sr=function(t){var e=0;return this.gr(t,function(t){e++}).next(function(){return e})},Rh.prototype.mn=function(t,e){return this.db.Dr().mn(t,e)},Rh.prototype.gr=function(t,n){return this.Cr(t,function(t,e){return n(e)})},Rh.prototype.sr=function(t,e,n){return Fh(t,n)},Rh.prototype.rr=function(t,e,n){return Fh(t,n)},Rh.prototype.Zi=function(t,e,n){return this.db.Dr().Zi(t,e,n)},Rh.prototype.Fi=Fh,Rh.prototype.Nr=function(t,e){return r=e,i=!1,Ih(n=t)._s(function(t){return bh(n,t,r).next(function(t){return t&&(i=!0),Ga.resolve(!t)})}).next(function(){return i});var n,r,i},Rh.prototype.Vr=function(n,r){var i=this,o=this.db.Or().Fr(),s=[],u=0;return this.Cr(n,function(e,t){t<=r&&(t=i.Nr(n,e).next(function(t){if(!t)return u++,o.fi(n,e).next(function(){return o._i(e),Oh(n).delete([0,fc(e.path)])})}),s.push(t))}).next(function(){return Ga.Ln(s)}).next(function(){return o.apply(n)}).next(function(){return u})},Rh.prototype.removeTarget=function(t,e){e=e.$t(t.vs);return this.db.Dr().Ji(t,e)},Rh.prototype.kr=Fh,Rh.prototype.Cr=function(t,r){var i,t=Oh(t),o=Ci.U;return t.ls({index:Nc.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==Ci.U&&r(new Ji(pc(i)),o),o=e,i=t):o=Ci.U}).next(function(){o!==Ci.U&&r(new Ji(pc(i)),o)})},Rh.prototype.br=function(t){return this.db.Or().Mr(t)},Rh);function Rh(t,e){this.db=t,this._r=new Ph(this,e)}function Mh(t,e){this.Ar=t,this.params=e}function Vh(t,e){this._r=t,this.fs=e,this.dr=!1,this.wr=null}function Uh(t){this.ar=t,this.buffer=new qu(Dh),this.ur=0}function Fh(t,e){return Oh(t).put((t=t.vs,new Nc(0,fc(e.path),t)))}var qh,jh=(Gh.prototype.ui=function(t,e,n){return zh(t).put(Jh(e),n)},Gh.prototype._i=function(t,e){t=zh(t),e=Jh(e);return t.delete(e)},Gh.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.$r(e,t)})},Gh.prototype.fi=function(t,e){var n=this;return zh(t).get(Jh(e)).next(function(t){return n.Lr(t)})},Gh.prototype.Br=function(t,e){var n=this;return zh(t).get(Jh(e)).next(function(t){var e=n.Lr(t);return e?{li:e,size:vh(t)}:null})},Gh.prototype.getEntries=function(t,e){var n=this,r=Bu;return this.qr(t,e,function(t,e){e=n.Lr(e);r=r.Ht(t,e)}).next(function(){return r})},Gh.prototype.Ur=function(t,e){var r=this,i=Bu,o=new Pu(Ji.J);return this.qr(t,e,function(t,e){var n=r.Lr(e);o=n?(i=i.Ht(t,n),o.Ht(t,vh(e))):(i=i.Ht(t,null),o.Ht(t,0))}).next(function(){return{Qr:i,Kr:o}})},Gh.prototype.qr=function(t,e,i){if(e.nt())return Ga.resolve();var n=IDBKeyRange.bound(e.first().path.rt(),e.last().path.rt()),o=e.ee(),s=o.ce();return zh(t).ls({range:n},function(t,e,n){for(var r=Ji.Et(t);s&&Ji.J(s,r)<0;)i(s,null),s=o.ce();s&&s.isEqual(r)&&(i(s,e),s=o.ae()?o.ce():null),s?n.rs(s.path.rt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.ae()?o.ce():null})},Gh.prototype.jr=function(t,r,e){var n,i=this,o=Ku,s=r.path.length+1,u={};return e.isEqual(Hi.min())?(n=r.path.rt(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.rt(),e=Hc(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=Ic.collectionReadTimeIndex),zh(t).ls(u,function(t,e,n){t.length===s&&(e=jc(i.Kt,e),r.path.st(e.key.path)?e instanceof Co&&Rs(r,e)&&(o=o.Ht(e.key,e)):n.done())}).next(function(){return o})},Gh.prototype.Fr=function(t){return new Bh(this,!!t&&t.Wr)},Gh.prototype.Mr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Gh.prototype.getMetadata=function(t){return Kh(t).get(_c.key).next(function(t){return ii(!!t),t})},Gh.prototype.$r=function(t,e){return Kh(t).put(_c.key,e)},Gh.prototype.Lr=function(t){if(t){t=jc(this.Kt,t);return t instanceof Ro&&t.version.isEqual(Hi.min())?null:t}return null},Gh),Bh=(h(Hh,qh=Je),Hh.prototype.Ti=function(i){var o=this,s=[],u=0,a=new qu(function(t,e){return ui(t.ot(),e.ot())});return this.oi.forEach(function(t,e){var n,r=o.zr.get(t);e.li?(n=Bc(o.Gr.Kt,e.li,o.ai(t)),a=a.add(t.path.Z()),e=vh(n),u+=e-r,s.push(o.Gr.ui(i,t,n))):(u-=r,o.Wr?(r=Bc(o.Gr.Kt,new Ro(t,Hi.min()),o.ai(t)),s.push(o.Gr.ui(i,t,r))):s.push(o.Gr._i(i,t)))}),a.forEach(function(t){s.push(o.Gr.Ei.Us(i,t))}),s.push(this.Gr.updateMetadata(i,u)),Ga.Ln(s)},Hh.prototype.di=function(t,e){var n=this;return this.Gr.Br(t,e).next(function(t){return null===t?(n.zr.set(e,0),null):(n.zr.set(e,t.size),t.li)})},Hh.prototype.wi=function(t,e){var n=this;return this.Gr.Ur(t,e).next(function(t){var e=t.Qr;return t.Kr.forEach(function(t,e){n.zr.set(t,e)}),e})},Hh);function Hh(t,e){var n=this;return(n=qh.call(this)||this).Gr=t,n.Wr=e,n.zr=new lh(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function Gh(t,e){this.Kt=t,this.Ei=e}function Kh(t){return Rc(t,_c.store)}function zh(t){return Rc(t,Ic.store)}function Jh(t){return t.path.rt()}var Wh=(Xh.prototype.Yn=function(e,n,t,r){var i=this;ii(t<r&&0<=t&&r<=11);var o=new Ka("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(dc.store),(s=e).createObjectStore(vc.store,{keyPath:vc.keyPath}),s.createObjectStore(gc.store,{keyPath:gc.keyPath,autoIncrement:!0}).createIndex(gc.userMutationsIndex,gc.userMutationsKeyPath,{unique:!0}),s.createObjectStore(mc.store),Yh(e),e.createObjectStore(Ic.store));var s,u=Ga.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(Nc.store),s.deleteObjectStore(Tc.store),s.deleteObjectStore(Ac.store),Yh(e)),u=u.next(function(){return t=o.store(Ac.store),e=new Ac(0,0,Hi.min().G(),0),t.put(Ac.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(gc.store).os().next(function(t){n.deleteObjectStore(gc.store),n.createObjectStore(gc.store,{keyPath:gc.keyPath,autoIncrement:!0}).createIndex(gc.userMutationsIndex,gc.userMutationsKeyPath,{unique:!0});var e=r.store(gc.store),t=t.map(function(t){return e.put(t)});return Ga.Ln(t)});var n,r})),u=u.next(function(){e.createObjectStore(Sc.store,{keyPath:Sc.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.Hr(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore(_c.store),i.Jr(o)})),t<7&&7<=r&&(u=u.next(function(){return i.Yr(o)})),t<8&&8<=r&&(u=u.next(function(){return i.Xr(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Ic.store)).createIndex(Ic.readTimeIndex,Ic.readTimeIndexPath,{unique:!1}),t.createIndex(Ic.collectionReadTimeIndex,Ic.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.Zr(o)})),t<11&&11<=r&&(u=u.next(function(){e.createObjectStore(Oc.store,{keyPath:Oc.keyPath}),e.createObjectStore(Dc.store,{keyPath:Dc.keyPath})})),u},Xh.prototype.Jr=function(e){var n=0;return e.store(Ic.store).ls(function(t,e){n+=vh(e)}).next(function(){var t=new _c(n);return e.store(_c.store).put(_c.key,t)})},Xh.prototype.Hr=function(n){var r=this,t=n.store(vc.store),i=n.store(gc.store);return t.os().next(function(t){return Ga.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.os(gc.userMutationsIndex,t).next(function(t){return Ga.forEach(t,function(t){ii(t.userId===e.userId);t=Jc(r.Kt,t);return yh(n,e.userId,t).next(function(){})})})})})},Xh.prototype.Yr=function(t){var o=t.store(Nc.store),e=t.store(Ic.store);return t.store(Ac.store).get(Ac.key).next(function(r){var i=[];return e.ls(function(t,e){var n=new Gi(t),t=[0,fc(n)];i.push(o.get(t).next(function(t){return t?Ga.resolve():o.put(new Nc(0,fc(n),r.highestListenSequenceNumber))}))}).next(function(){return Ga.Ln(i)})})},Xh.prototype.Xr=function(t,e){t.createObjectStore(xc.store,{keyPath:xc.keyPath});function r(t){if(i.add(t)){var e=t.et(),t=t.Z();return n.put({collectionId:e,parent:fc(t)})}}var n=e.store(xc.store),i=new nh;return e.store(Ic.store).ls({hs:!0},function(t,e){t=new Gi(t);return r(t.Z())}).next(function(){return e.store(mc.store).ls({hs:!0},function(t,e){t[0];var n=t[1],n=(t[2],pc(n));return r(n.Z())})})},Xh.prototype.Zr=function(t){var n=this,r=t.store(Tc.store);return r.ls(function(t,e){e=Wc(e),e=Xc(n.Kt,e);return r.put(e)})},Xh);function Xh(t){this.Kt=t}function Yh(t){t.createObjectStore(Nc.store,{keyPath:Nc.keyPath}).createIndex(Nc.documentTargetsIndex,Nc.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Tc.store,{keyPath:Tc.keyPath}).createIndex(Tc.queryTargetsIndexName,Tc.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ac.store)}var Qh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Zh=($h.prototype.start=function(){var e=this;return this.Io().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new di(pi.FAILED_PRECONDITION,Qh);return e.mo(),e.Ao(),e.Ro(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.fo.ji(t)})}).then(function(t){e.io=new Ci(t,e.no)}).then(function(){e.ro=!0}).catch(function(t){return e._o&&e._o.close(),Promise.reject(t)})},$h.prototype.Po=function(n){var t=this;return this.ho=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.Er?[2,n(e)]:[2]})})},n(this.isPrimary)},$h.prototype.yo=function(n){var t=this;this._o.Zn(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},$h.prototype.Vo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.eo.ys(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Er?[4,this.Io()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},$h.prototype.Io=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return ef(e).put(new Sc(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.po(e).next(function(t){t||(n.isPrimary=!1,n.eo.bo(function(){return n.ho(!1)}))})}).next(function(){return n.vo(e)}).next(function(t){return n.isPrimary&&!t?n.So(e).next(function(){return!1}):!!t&&n.Do(e).next(function(){return!0})})}).catch(function(t){if(tc(t))return $r("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return $r("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.eo.bo(function(){return n.ho(t)}),n.isPrimary=t})},$h.prototype.po=function(t){var e=this;return tf(t).get(dc.key).next(function(t){return Ga.resolve(e.Co(t))})},$h.prototype.xo=function(t){return ef(t).delete(this.clientId)},$h.prototype.No=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Fo(this.uo,18e5)?[3,2]:(this.uo=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Rc(t,Sc.store);return r.os().next(function(t){var e=o.Oo(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Ga.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Eo)for(n=0,r=e;n<r.length;n++)i=r[n],this.Eo.removeItem(this.ko(i.clientId));t.label=2;case 2:return[2]}})})},$h.prototype.Ro=function(){var t=this;this.ao=this.eo.Ir("client_metadata_refresh",4e3,function(){return t.Io().then(function(){return t.No()}).then(function(){return t.Ro()})})},$h.prototype.Co=function(t){return!!t&&t.ownerId===this.clientId},$h.prototype.vo=function(e){var r=this;return this.so?Ga.resolve(!0):tf(e).get(dc.key).next(function(t){if(null!==t&&r.Fo(t.leaseTimestampMs,5e3)&&!r.Mo(t.ownerId)){if(r.Co(t)&&r.networkEnabled)return!0;if(!r.Co(t)){if(!t.allowTabSynchronization)throw new di(pi.FAILED_PRECONDITION,Qh);return!1}}return!(!r.networkEnabled||!r.inForeground)||ef(e).os().next(function(t){return void 0===r.Oo(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&$r("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},$h.prototype.$o=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.ro=!1,this.Lo(),this.ao&&(this.ao.cancel(),this.ao=null),this.Bo(),this.qo(),[4,this._o.runTransaction("shutdown","readwrite",[dc.store,Sc.store],function(t){var e=new Pc(t,Ci.U);return n.So(e).next(function(){return n.xo(e)})})];case 1:return t.sent(),this._o.close(),this.Uo(),[2]}})})},$h.prototype.Oo=function(t,e){var n=this;return t.filter(function(t){return n.Fo(t.updateTimeMs,e)&&!n.Mo(t.clientId)})},$h.prototype.Qo=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return ef(t).os().next(function(t){return e.Oo(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty($h.prototype,"Er",{get:function(){return this.ro},enumerable:!1,configurable:!0}),$h.prototype.Ko=function(t){return gh.Ai(t,this.Kt,this.Ei,this.Ii)},$h.prototype.Dr=function(){return this.fo},$h.prototype.Or=function(){return this.wo},$h.prototype.jo=function(){return this.Ei},$h.prototype.Wo=function(){return this.To},$h.prototype.runTransaction=function(e,n,r){var i=this;$r("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this._o.runTransaction(e,t,Lc,function(t){return o=new Pc(t,i.io?i.io.next():Ci.U),"readwrite-primary"===n?i.po(o).next(function(t){return!!t||i.vo(o)}).next(function(t){if(!t)throw ti("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.eo.bo(function(){return i.ho(!1)}),new di(pi.FAILED_PRECONDITION,cc);return r(o)}).next(function(t){return i.Do(o).next(function(){return t})}):i.Go(o).next(function(){return r(o)})}).then(function(t){return o.ps(),t})},$h.prototype.Go=function(t){var e=this;return tf(t).get(dc.key).next(function(t){if(null!==t&&e.Fo(t.leaseTimestampMs,5e3)&&!e.Mo(t.ownerId)&&!e.Co(t)&&!(e.so||e.allowTabSynchronization&&t.allowTabSynchronization))throw new di(pi.FAILED_PRECONDITION,Qh)})},$h.prototype.Do=function(t){var e=new dc(this.clientId,this.allowTabSynchronization,Date.now());return tf(t).put(dc.key,e)},$h.jn=function(){return za.jn()},$h.prototype.So=function(t){var e=this,n=tf(t);return n.get(dc.key).next(function(t){return e.Co(t)?($r("IndexedDbPersistence","Releasing primary lease."),n.delete(dc.key)):Ga.resolve()})},$h.prototype.Fo=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(ti("Detected an update time that is in the future: "+t+" > "+n),1))},$h.prototype.mo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.co=function(){t.eo.ys(function(){return t.inForeground="visible"===t.document.visibilityState,t.Io()})},this.document.addEventListener("visibilitychange",this.co),this.inForeground="visible"===this.document.visibilityState)},$h.prototype.Bo=function(){this.co&&(this.document.removeEventListener("visibilitychange",this.co),this.co=null)},$h.prototype.Ao=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.oo=function(){e.Lo(),e.eo.ys(function(){return e.$o()})},this.window.addEventListener("unload",this.oo))},$h.prototype.qo=function(){this.oo&&(this.window.removeEventListener("unload",this.oo),this.oo=null)},$h.prototype.Mo=function(t){try{var e=null!==(null===(e=this.Eo)||void 0===e?void 0:e.getItem(this.ko(t)));return $r("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return ti("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},$h.prototype.Lo=function(){if(this.Eo)try{this.Eo.setItem(this.ko(this.clientId),String(Date.now()))}catch(t){ti("Failed to set zombie client id.",t)}},$h.prototype.Uo=function(){if(this.Eo)try{this.Eo.removeItem(this.ko(this.clientId))}catch(t){}},$h.prototype.ko=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},$h);function $h(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.eo=i,this.window=o,this.document=s,this.no=a,this.so=c,this.io=null,this.ro=!1,this.isPrimary=!1,this.networkEnabled=!0,this.oo=null,this.inForeground=!1,this.co=null,this.ao=null,this.uo=Number.NEGATIVE_INFINITY,this.ho=function(t){return Promise.resolve()},!$h.jn())throw new di(pi.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Ii=new Ch(this,r),this.lo=e+"main",this.Kt=new Uc(u),this._o=new za(this.lo,11,new Wh(this.Kt)),this.fo=new Th(this.Ii,this.Kt),this.Ei=new rh,this.wo=(e=this.Kt,u=this.Ei,new jh(e,u)),this.To=new Qc,this.window&&this.window.localStorage?this.Eo=this.window.localStorage:(this.Eo=null,!1===c&&ti("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function tf(t){return Rc(t,dc.store)}function ef(t){return Rc(t,Sc.store)}function nf(t,e){var n=t.projectId;return t.m||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function rf(t,e){this.progress=t,this.zo=e}var of=(lf.prototype.Jo=function(e,n){var r=this;return this.Ho.vi(e,n).next(function(t){return r.Yo(e,n,t)})},lf.prototype.Yo=function(t,r,i){return this.wo.fi(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].xs(r,t);return t})},lf.prototype.Xo=function(t,e,i){var o=Bu;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].xs(t,e);o=o.Ht(t,e)}),o},lf.prototype.Zo=function(e,t){var n=this;return this.wo.getEntries(e,t).next(function(t){return n.tc(e,t)})},lf.prototype.tc=function(e,r){var i=this;return this.Ho.Si(e,r).next(function(t){var t=i.Xo(e,r,t),n=Bu;return t.forEach(function(t,e){e=e||new Ro(t,Hi.min()),n=n.Ht(t,e)}),n})},lf.prototype.jr=function(t,e,n){return r=e,Ji.Tt(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.ec(t,e.path):Ss(e)?this.nc(t,e,n):this.sc(t,e,n);var r},lf.prototype.ec=function(t,e){return this.Jo(t,new Ji(e)).next(function(t){var e=Ku;return t instanceof Co&&(e=e.Ht(t.key,t)),e})},lf.prototype.nc=function(n,r,i){var o=this,s=r.collectionGroup,u=Ku;return this.Ei.Qs(n,s).next(function(t){return Ga.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new Es(t,null,e.Nt.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.sc(n,e,i).next(function(t){t.forEach(function(t,e){u=u.Ht(t,e)})})}).next(function(){return u})})},lf.prototype.sc=function(e,n,t){var a,c,r=this;return this.wo.jr(e,n,t).next(function(t){return a=t,r.Ho.Ci(e,n)}).next(function(t){return c=t,r.ic(e,c,a).next(function(t){a=t;for(var e=0,n=c;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,s=hu(s,a.get(u),0,r.Ss);a=s instanceof Co?a.Ht(u,s):a.remove(u)}})}).next(function(){return a.forEach(function(t,e){Rs(n,e)||(a=a.remove(t))}),a})},lf.prototype.ic=function(t,e,n){for(var r=Wu(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof vu&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.wo.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Co&&(c=c.Ht(t,e))}),c})},lf),sf=(ff.cc=function(t,e){for(var n=Wu(),r=Wu(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new ff(t,e.fromCache,n,r)},ff),uf=(hf.prototype.ac=function(t){this.uc=t},hf.prototype.jr=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.Nt.length||1===r.Nt.length&&r.Nt[0].field.ht())||i.isEqual(Hi.min())?this.hc(e,r):this.uc.Zo(e,o).next(function(t){var n=s.lc(r,t);return(Ts(r)||Ns(r))&&s._c(r.limitType,n,o,i)?s.hc(e,r):(Zr()<=l.DEBUG&&$r("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Cs(r)),s.uc.jr(e,r,i).next(function(e){return n.forEach(function(t){e=e.Ht(t.key,t)}),e}))})},hf.prototype.lc=function(n,t){var r=new qu(Ms(n));return t.forEach(function(t,e){e instanceof Co&&Rs(n,e)&&(r=r.add(e))}),r},hf.prototype._c=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.u(r))},hf.prototype.hc=function(t,e){return Zr()<=l.DEBUG&&$r("QueryEngine","Using full collection scan to execute query:",Cs(e)),this.uc.jr(t,e,Hi.min())},hf),af=(cf.prototype.mr=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.pr(t,n.dc)})},cf);function cf(t,e,n,r){this.persistence=t,this.fc=e,this.Kt=r,this.dc=new Pu(ui),this.wc=new lh(Bo,Ho),this.Tc=Hi.min(),this.Ho=t.Ko(n),this.Ec=t.Or(),this.fo=t.Dr(),this.Ic=new of(this.Ec,this.Ho,this.persistence.jo()),this.To=t.Wo(),this.fc.ac(this.Ic)}function hf(){}function ff(t,e,n,r){this.targetId=t,this.fromCache=e,this.rc=n,this.oc=r}function lf(t,e,n){this.wo=t,this.Ho=e,this.Ei=n}function pf(t,e,n,r){return new af(t,e,n,r)}function df(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ho,m=e.Ic,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Ho.bi(v).next(function(t){return g=t,n=e.persistence.Ko(o),m=new of(e.Ec,n,e.persistence.jo()),n.bi(v)}).next(function(t){for(var e=[],n=[],r=Wu(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Zo(v,r).next(function(t){return{mc:t,Ac:e,Rc:n}})})})];case 1:return r=t.sent(),[2,(e.Ho=n,e.Ic=m,e.fc.ac(e.Ic),r)]}})})}function yf(t,h){var f=t;return f.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,u,a=h.batch.keys(),c=f.Ec.Fr({Wr:!0});return e=f,r=t,o=c,s=(i=h).batch,n=s.keys(),u=Ga.resolve(),n.forEach(function(n){u=u.next(function(){return o.fi(r,n)}).next(function(t){var e=t,t=i.Os.get(n);ii(null!==t),(!e||e.version.u(t)<0)&&(e=s.Ds(n,e,i))&&o.ui(e,i.Fs)})}),u.next(function(){return e.Ho.xi(r,s)}).next(function(){return c.apply(t)}).next(function(){return f.Ho.Oi(t)}).next(function(){return f.Ic.Zo(t,a)})})}function vf(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.fo.Ki(t)})}function gf(t,r){var a=t,c=r.Mt,h=a.dc;return a.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=a.Ec.Fr({Wr:!0});h=a.dc;var u=[];r.Oe.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(u.push(a.fo.ir(s,t.Ke,e).next(function(){return a.fo.nr(s,t.Ue,e)})),0<(i=t.resumeToken).o()&&(n=o.Lt(i,c).$t(s.vs),h=h.Ht(e,n),r=o,i=t,ii(0<(o=n).resumeToken.o()),(0===r.resumeToken.o()||3e8<=o.Mt.W()-r.Mt.W()||0<i.Ue.size+i.Qe.size+i.Ke.size)&&u.push(a.fo.Ji(s,n))))});var e,n=Bu;return r.Me.forEach(function(t,e){r.$e.has(t)&&u.push(a.persistence.Ii.kr(s,t))}),u.push(mf(s,t,r.Me,c,void 0).next(function(t){n=t})),c.isEqual(Hi.min())||(e=a.fo.Ki(s).next(function(t){return a.fo.Wi(s,s.vs,c)}),u.push(e)),Ga.Ln(u).next(function(){return t.apply(s)}).next(function(){return a.Ic.tc(s,n)})}).then(function(t){return a.dc=h,t})}function mf(t,s,e,u,a){var n=Wu();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Bu;return e.forEach(function(t,e){var n=i.get(t),r=(null==a?void 0:a.get(t))||u;e instanceof Ro&&e.version.isEqual(Hi.min())?(s._i(t,r),o=o.Ht(t,e)):null==n||0<e.version.u(n.version)||0===e.version.u(n.version)&&n.hasPendingWrites?(s.ui(e,r),o=o.Ht(t,e)):$r("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function bf(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.fo.er(e,r).next(function(t){return t?(n=t,Ga.resolve(n)):i.fo.qi(e).next(function(t){return n=new Vs(r,t,0,e.vs),i.fo.Gi(e,n).next(function(){return n})})})}).then(function(t){var e=i.dc.get(t.targetId);return(null===e||0<t.Mt.u(e.Mt))&&(i.dc=i.dc.Ht(t.targetId,t),i.wc.set(r,t.targetId)),t})}function wf(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).dc.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Ii.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!tc(r=t.sent()))throw r;return $r("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.dc=e.dc.remove(o),e.wc.delete(n.target),[2]}})})}function Ef(t,o,s){var u=t,a=Hi.min(),c=Wu();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=Ds(o),(void 0!==(t=(i=t).wc.get(r))?Ga.resolve(i.dc.get(t)):i.fo.er(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.fo.cr(e,t.targetId).next(function(t){c=t})}).next(function(){return u.fc.jr(e,o,s?a:Hi.min(),s?c:Wu())}).next(function(t){return{documents:t,Pc:c}});var t,n,r,i})}function If(t,e){var n=t,r=n.fo,t=n.dc.get(e);return t?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Dn(t,e).next(function(t){return t?t.target:null})})}function _f(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Ec,n=t,t=s.Tc,r=e,i=Bu,o=Hc(t),t=zh(n),n=IDBKeyRange.lowerBound(o,!0),t.ls({index:Ic.readTimeIndex,range:n},function(t,e){var n=jc(r.Kt,e);i=i.Ht(n.key,n),o=e.readTime}).next(function(){return{zo:i,readTime:Gc(o)}});var e,n,r,i,o}).then(function(t){var e=t.zo,t=t.readTime;return s.Tc=t,e})}function Tf(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=zh(t),r=Hi.min(),t.ls({index:Ic.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=Gc(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.Tc=t})]})})}var Nf,Af,xf=(zf.prototype.Ms=function(t,e){return Ga.resolve(this.bc.get(e))},zf.prototype.$s=function(t,e){return this.bc.set(e.id,{id:e.id,version:e.version,createTime:wa(e.createTime)}),Ga.resolve()},zf.prototype.Ls=function(t,e){return Ga.resolve(this.vc.get(e))},zf.prototype.Bs=function(t,e){return this.vc.set(e.name,{name:(e=e).name,query:Yc(e.bundledQuery),readTime:wa(e.readTime)}),Ga.resolve()},zf),Sf=(Kf.prototype.nt=function(){return this.Sc.nt()},Kf.prototype.sr=function(t,e){e=new Of(t,e);this.Sc=this.Sc.add(e),this.Cc=this.Cc.add(e)},Kf.prototype.Nc=function(t,e){var n=this;t.forEach(function(t){return n.sr(t,e)})},Kf.prototype.rr=function(t,e){this.Fc(new Of(t,e))},Kf.prototype.Oc=function(t,e){var n=this;t.forEach(function(t){return n.rr(t,e)})},Kf.prototype.kc=function(t){var e=this,n=new Ji(new Gi([])),r=new Of(n,t),t=new Of(n,t+1),i=[];return this.Cc.Ae([r,t],function(t){e.Fc(t),i.push(t.key)}),i},Kf.prototype.Mc=function(){var e=this;this.Sc.forEach(function(t){return e.Fc(t)})},Kf.prototype.Fc=function(t){this.Sc=this.Sc.delete(t),this.Cc=this.Cc.delete(t)},Kf.prototype.$c=function(t){var e=new Ji(new Gi([])),n=new Of(e,t),t=new Of(e,t+1),r=Wu();return this.Cc.Ae([n,t],function(t){r=r.add(t.key)}),r},Kf.prototype.ki=function(t){var e=new Of(t,0),e=this.Sc.Pe(e);return null!==e&&t.isEqual(e.key)},Kf),Of=(Gf.Dc=function(t,e){return Ji.J(t.key,e.key)||ui(t.Lc,e.Lc)},Gf.xc=function(t,e){return ui(t.Lc,e.Lc)||Ji.J(t.key,e.key)},Gf),Df=(Hf.prototype.Ri=function(t){return Ga.resolve(0===this.Ho.length)},Hf.prototype.Pi=function(t,e,n,r){var i=this.Bc;this.Bc++,0<this.Ho.length&&this.Ho[this.Ho.length-1];n=new Mc(i,e,n,r);this.Ho.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this.qc=this.qc.add(new Of(u.key,i)),this.Ei.Us(t,u.key.path.Z())}return Ga.resolve(n)},Hf.prototype.yi=function(t,e){return Ga.resolve(this.Uc(e))},Hf.prototype.Vi=function(t,e){e+=1,e=this.Qc(e),e=e<0?0:e;return Ga.resolve(this.Ho.length>e?this.Ho[e]:null)},Hf.prototype.pi=function(){return Ga.resolve(0===this.Ho.length?-1:this.Bc-1)},Hf.prototype.bi=function(t){return Ga.resolve(this.Ho.slice())},Hf.prototype.vi=function(t,e){var n=this,r=new Of(e,0),e=new Of(e,Number.POSITIVE_INFINITY),i=[];return this.qc.Ae([r,e],function(t){t=n.Uc(t.Lc);i.push(t)}),Ga.resolve(i)},Hf.prototype.Si=function(t,e){var n=this,r=new qu(ui);return e.forEach(function(t){var e=new Of(t,0),t=new Of(t,Number.POSITIVE_INFINITY);n.qc.Ae([e,t],function(t){r=r.add(t.Lc)})}),Ga.resolve(this.Kc(r))},Hf.prototype.Ci=function(t,e){var n=e.path,r=n.length+1,e=n;Ji.Tt(e)||(e=e.child(""));var e=new Of(new Ji(e),0),i=new qu(ui);return this.qc.Re(function(t){var e=t.key.path;return!!n.st(e)&&(e.length===r&&(i=i.add(t.Lc)),!0)},e),Ga.resolve(this.Kc(i))},Hf.prototype.Kc=function(t){var e=this,n=[];return t.forEach(function(t){t=e.Uc(t);null!==t&&n.push(t)}),n},Hf.prototype.xi=function(n,r){var i=this;ii(0===this.jc(r.batchId,"removed")),this.Ho.shift();var o=this.qc;return Ga.forEach(r.mutations,function(t){var e=new Of(t.key,r.batchId);return o=o.delete(e),i.Ii.Fi(n,t.key)}).next(function(){i.qc=o})},Hf.prototype.Ni=function(t){},Hf.prototype.ki=function(t,e){var n=new Of(e,0),n=this.qc.Pe(n);return Ga.resolve(e.isEqual(n&&n.key))},Hf.prototype.Oi=function(t){return this.Ho.length,Ga.resolve()},Hf.prototype.jc=function(t,e){return this.Qc(t)},Hf.prototype.Qc=function(t){return 0===this.Ho.length?0:t-this.Ho[0].batchId},Hf.prototype.Uc=function(t){t=this.Qc(t);return t<0||t>=this.Ho.length?null:this.Ho[t]},Hf),kf=(Bf.prototype.ui=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.Wc(e);return this.docs=this.docs.Ht(r,{li:e,size:i,readTime:n}),this.size+=i-o,this.Ei.Us(t,r.path.Z())},Bf.prototype._i=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Bf.prototype.fi=function(t,e){e=this.docs.get(e);return Ga.resolve(e?e.li:null)},Bf.prototype.getEntries=function(t,e){var n=this,r=Bu;return e.forEach(function(t){var e=n.docs.get(t);r=r.Ht(t,e?e.li:null)}),Ga.resolve(r)},Bf.prototype.jr=function(t,e,n){for(var r=Ku,i=new Ji(e.path.child("")),o=this.docs.ne(i);o.ae();){var s=o.ce(),u=s.key,a=s.value,s=a.li,a=a.readTime;if(!e.path.st(u.path))break;a.u(n)<=0||s instanceof Co&&Rs(e,s)&&(r=r.Ht(s.key,s))}return Ga.resolve(r)},Bf.prototype.Gc=function(t,e){return Ga.forEach(this.docs,function(t){return e(t)})},Bf.prototype.Fr=function(t){return new Lf(this)},Bf.prototype.Mr=function(t){return Ga.resolve(this.size)},Bf),Lf=(h(jf,Af=Je),jf.prototype.Ti=function(n){var r=this,i=[];return this.oi.forEach(function(t,e){e&&e.li?i.push(r.Gr.ui(n,e.li,r.ai(t))):r.Gr._i(t)}),Ga.Ln(i)},jf.prototype.di=function(t,e){return this.Gr.fi(t,e)},jf.prototype.wi=function(t,e){return this.Gr.getEntries(t,e)},jf),Pf=(qf.prototype.mn=function(t,n){return this.zc.forEach(function(t,e){return n(e)}),Ga.resolve()},qf.prototype.Ki=function(t){return Ga.resolve(this.lastRemoteSnapshotVersion)},qf.prototype.ji=function(t){return Ga.resolve(this.Hc)},qf.prototype.qi=function(t){return this.highestTargetId=this.Yc.next(),Ga.resolve(this.highestTargetId)},qf.prototype.Wi=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Hc&&(this.Hc=e),Ga.resolve()},qf.prototype.zi=function(t){this.zc.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Yc=new _h(e),this.highestTargetId=e),t.sequenceNumber>this.Hc&&(this.Hc=t.sequenceNumber)},qf.prototype.Gi=function(t,e){return this.zi(e),this.targetCount+=1,Ga.resolve()},qf.prototype.Ji=function(t,e){return this.zi(e),Ga.resolve()},qf.prototype.Yi=function(t,e){return this.zc.delete(e.target),this.Jc.kc(e.targetId),--this.targetCount,Ga.resolve()},qf.prototype.Zi=function(n,r,i){var o=this,s=0,u=[];return this.zc.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.zc.delete(t),u.push(o.Xi(n,e.targetId)),s++)}),Ga.Ln(u).next(function(){return s})},qf.prototype.tr=function(t){return Ga.resolve(this.targetCount)},qf.prototype.er=function(t,e){e=this.zc.get(e)||null;return Ga.resolve(e)},qf.prototype.nr=function(t,e,n){return this.Jc.Nc(e,n),Ga.resolve()},qf.prototype.ir=function(e,t,n){this.Jc.Oc(t,n);var r=this.persistence.Ii,i=[];return r&&t.forEach(function(t){i.push(r.Fi(e,t))}),Ga.Ln(i)},qf.prototype.Xi=function(t,e){return this.Jc.kc(e),Ga.resolve()},qf.prototype.cr=function(t,e){e=this.Jc.$c(e);return Ga.resolve(e)},qf.prototype.ki=function(t,e){return Ga.resolve(this.Jc.ki(e))},qf),Cf=(Ff.prototype.start=function(){return Promise.resolve()},Ff.prototype.$o=function(){return this.ro=!1,Promise.resolve()},Object.defineProperty(Ff.prototype,"Er",{get:function(){return this.ro},enumerable:!1,configurable:!0}),Ff.prototype.yo=function(){},Ff.prototype.Vo=function(){},Ff.prototype.jo=function(){return this.Ei},Ff.prototype.Ko=function(t){var e=this.Xc[t.R()];return e||(e=new Df(this.Ei,this.Ii),this.Xc[t.R()]=e),e},Ff.prototype.Dr=function(){return this.fo},Ff.prototype.Or=function(){return this.wo},Ff.prototype.Wo=function(){return this.To},Ff.prototype.runTransaction=function(t,e,n){var r=this;$r("MemoryPersistence","Starting transaction:",t);var i=new Rf(this.io.next());return this.Ii.ta(),n(i).next(function(t){return r.Ii.ea(i).next(function(){return t})}).Mn().then(function(t){return i.ps(),t})},Ff.prototype.na=function(e,n){return Ga.Bn(Object.values(this.Xc).map(function(t){return function(){return t.ki(e,n)}}))},Ff),Rf=(h(Uf,Nf=o),Uf),Mf=(Vf.ra=function(t){return new Vf(t)},Object.defineProperty(Vf.prototype,"oa",{get:function(){if(this.ia)return this.ia;throw ri()},enumerable:!1,configurable:!0}),Vf.prototype.sr=function(t,e,n){return this.sa.sr(n,e),this.oa.delete(n.toString()),Ga.resolve()},Vf.prototype.rr=function(t,e,n){return this.sa.rr(n,e),this.oa.add(n.toString()),Ga.resolve()},Vf.prototype.Fi=function(t,e){return this.oa.add(e.toString()),Ga.resolve()},Vf.prototype.removeTarget=function(t,e){var n=this;this.sa.kc(e.targetId).forEach(function(t){return n.oa.add(t.toString())});var r=this.persistence.Dr();return r.cr(t,e.targetId).next(function(t){t.forEach(function(t){return n.oa.add(t.toString())})}).next(function(){return r.Yi(t,e)})},Vf.prototype.ta=function(){this.ia=new Set},Vf.prototype.ea=function(n){var r=this,i=this.persistence.Or().Fr();return Ga.forEach(this.oa,function(t){var e=Ji.ft(t);return r.ca(n,e).next(function(t){t||i._i(e)})}).next(function(){return r.ia=null,i.apply(n)})},Vf.prototype.kr=function(t,e){var n=this;return this.ca(t,e).next(function(t){t?n.oa.delete(e.toString()):n.oa.add(e.toString())})},Vf.prototype.Zc=function(t){return 0},Vf.prototype.ca=function(t,e){var n=this;return Ga.Bn([function(){return Ga.resolve(n.sa.ki(e))},function(){return n.persistence.Dr().ki(t,e)},function(){return n.persistence.na(t,e)}])},Vf);function Vf(t){this.persistence=t,this.sa=new Sf,this.ia=null}function Uf(t){var e=this;return(e=Nf.call(this)||this).vs=t,e}function Ff(t,e){var n=this;this.Xc={},this.io=new Ci(0),this.ro=!1,this.ro=!0,this.Ii=t(this),this.fo=new Pf(this),this.Ei=new eh,this.wo=(t=this.Ei,new kf(t,function(t){return n.Ii.Zc(t)})),this.Kt=new Uc(e),this.To=new xf(this.Kt)}function qf(t){this.persistence=t,this.zc=new lh(Bo,Ho),this.lastRemoteSnapshotVersion=Hi.min(),this.highestTargetId=0,this.Hc=0,this.Jc=new Sf,this.targetCount=0,this.Yc=_h.Li()}function jf(t){var e=this;return(e=Af.call(this)||this).Gr=t,e}function Bf(t,e){this.Ei=t,this.Wc=e,this.docs=new Pu(Ji.J),this.size=0}function Hf(t,e){this.Ei=t,this.Ii=e,this.Ho=[],this.Bc=1,this.qc=new qu(Of.Dc)}function Gf(t,e){this.key=t,this.Lc=e}function Kf(){this.Sc=new qu(Of.Dc),this.Cc=new qu(Of.xc)}function zf(t){this.Kt=t,this.bc=new Map,this.vc=new Map}function Jf(t,e){return"firestore_clients_"+t+"_"+e}function Wf(t,e,n){n="firestore_mutations_"+t+"_"+n;return e.A()&&(n+="_"+e.uid),n}function Xf(t,e){return"firestore_targets_"+t+"_"+e}var Yf,Qf=(wl.aa=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new di(r.error.code,r.error.message)),i?new wl(t,e,r.state,o):(ti("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},wl.prototype.ua=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},wl),Zf=(bl.aa=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new di(n.error.code,n.error.message)),r?new bl(t,n.state,i):(ti("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},bl.prototype.ua=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},bl),$f=(ml.aa=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Xu,o=0;r&&o<n.activeTargetIds.length;++o)r=po(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new ml(t,i):(ti("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},ml),tl=(gl.aa=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new gl(e.clientId,e.onlineState):(ti("SharedClientState","Failed to parse online state: "+t),null)},gl),el=(vl.prototype.ha=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},vl.prototype.la=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},vl.prototype.ua=function(){var t={activeTargetIds:this.activeTargetIds.rt(),updateTimeMs:Date.now()};return JSON.stringify(t)},vl),nl=(yl.jn=function(t){return!(!t||!t.localStorage)},yl.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f=this;return v(this,function(t){switch(t.label){case 0:return[4,this.fa.Qo()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this._a&&(i=this.getItem(Jf(this.persistenceKey,r)))&&(o=$f.aa(r,i))&&(this.Ea=this.Ea.Ht(o.clientId,o));for(this.pa(),(s=this.storage.getItem(this.ga))&&(u=this.ba(s))&&this.va(u),a=0,c=this.Ia;a<c.length;a++)h=c[a],this.Ta(h);return this.Ia=[],this.window.addEventListener("unload",function(){return f.$o()}),this.Er=!0,[2]}})})},yl.prototype.q=function(t){this.setItem(this.Aa,JSON.stringify(t))},yl.prototype.Sa=function(){return this.Da(this.Ea)},yl.prototype.Ca=function(n){var r=!1;return this.Ea.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},yl.prototype.xa=function(t){this.Na(t,"pending")},yl.prototype.Fa=function(t,e,n){this.Na(t,e,n),this.Oa(t)},yl.prototype.ka=function(t){var e,n="not-current";return this.Ca(t)&&(!(e=this.storage.getItem(Xf(this.persistenceKey,t)))||(e=Zf.aa(t,e))&&(n=e.state)),this.Ma.ha(t),this.pa(),n},yl.prototype.$a=function(t){this.Ma.la(t),this.pa()},yl.prototype.La=function(t){return this.Ma.activeTargetIds.has(t)},yl.prototype.Ba=function(t){this.removeItem(Xf(this.persistenceKey,t))},yl.prototype.qa=function(t,e,n){this.Ua(t,e,n)},yl.prototype.Qa=function(t,e,n){var r=this;e.forEach(function(t){r.Oa(t)}),this.currentUser=t,n.forEach(function(t){r.xa(t)})},yl.prototype.Ka=function(t){this.ja(t)},yl.prototype.Wa=function(){this.Ga()},yl.prototype.$o=function(){this.Er&&(this.window.removeEventListener("storage",this.wa),this.removeItem(this.ma),this.Er=!1)},yl.prototype.getItem=function(t){var e=this.storage.getItem(t);return $r("SharedClientState","READ",t,e),e},yl.prototype.setItem=function(t,e){$r("SharedClientState","SET",t,e),this.storage.setItem(t,e)},yl.prototype.removeItem=function(t){$r("SharedClientState","REMOVE",t),this.storage.removeItem(t)},yl.prototype.Ta=function(t){var e=this,o=t;if(o.storageArea===this.storage){if($r("SharedClientState","EVENT",o.key,o.newValue),o.key===this.ma)return void ti("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.eo.bo(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){if(this.Er){if(null!==o.key)if(this.Ra.test(o.key)){if(null==o.newValue)return e=this.za(o.key),[2,this.Ha(e,null)];if(e=this.Ja(o.key,o.newValue))return[2,this.Ha(e.clientId,e)]}else if(this.Pa.test(o.key)){if(null!==o.newValue&&(n=this.Ya(o.key,o.newValue)))return[2,this.Xa(n)]}else if(this.ya.test(o.key)){if(null!==o.newValue&&(r=this.Za(o.key,o.newValue)))return[2,this.tu(r)]}else if(o.key===this.ga){if(null!==o.newValue&&(i=this.ba(o.newValue)))return[2,this.va(i)]}else if(o.key===this.Aa)(i=function(t){var e=Ci.U;if(null!=t)try{var n=JSON.parse(t);ii("number"==typeof n),e=n}catch(t){ti("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==Ci.U&&this.$(i);else if(o.key===this.Va)return[2,this.fa.eu()]}else this.Ia.push(o);return[2]})})})}},Object.defineProperty(yl.prototype,"Ma",{get:function(){return this.Ea.get(this._a)},enumerable:!1,configurable:!0}),yl.prototype.pa=function(){this.setItem(this.ma,this.Ma.ua())},yl.prototype.Na=function(t,e,n){n=new Qf(this.currentUser,t,e,n),t=Wf(this.persistenceKey,this.currentUser,t);this.setItem(t,n.ua())},yl.prototype.Oa=function(t){t=Wf(this.persistenceKey,this.currentUser,t);this.removeItem(t)},yl.prototype.ja=function(t){t={clientId:this._a,onlineState:t};this.storage.setItem(this.ga,JSON.stringify(t))},yl.prototype.Ua=function(t,e,n){var r=Xf(this.persistenceKey,t),n=new Zf(t,e,n);this.setItem(r,n.ua())},yl.prototype.Ga=function(){this.setItem(this.Va,"value-not-used")},yl.prototype.za=function(t){t=this.Ra.exec(t);return t?t[1]:null},yl.prototype.Ja=function(t,e){t=this.za(t);return $f.aa(t,e)},yl.prototype.Ya=function(t,e){var n=this.Pa.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Qf.aa(new Ni(n),t,e)},yl.prototype.Za=function(t,e){t=this.ya.exec(t),t=Number(t[1]);return Zf.aa(t,e)},yl.prototype.ba=function(t){return tl.aa(t)},yl.prototype.Xa=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.fa.nu(e.batchId,e.state,e.error)]:($r("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},yl.prototype.tu=function(t){return this.fa.su(t.targetId,t.state,t.error)},yl.prototype.Ha=function(t,e){var n=this,r=e?this.Ea.Ht(t,e):this.Ea.remove(t),i=this.Da(this.Ea),o=this.Da(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.fa.iu(s,u).then(function(){n.Ea=r})},yl.prototype.va=function(t){this.Ea.get(t.clientId)&&this.da(t.onlineState)},yl.prototype.Da=function(t){var n=Xu;return t.forEach(function(t,e){n=n.ye(e.activeTargetIds)}),n},yl),rl=(dl.prototype.xa=function(t){},dl.prototype.Fa=function(t,e,n){},dl.prototype.ka=function(t){return this.ru.ha(t),this.ou[t]||"not-current"},dl.prototype.qa=function(t,e,n){this.ou[t]=e},dl.prototype.$a=function(t){this.ru.la(t)},dl.prototype.La=function(t){return this.ru.activeTargetIds.has(t)},dl.prototype.Ba=function(t){delete this.ou[t]},dl.prototype.Sa=function(){return this.ru.activeTargetIds},dl.prototype.Ca=function(t){return this.ru.activeTargetIds.has(t)},dl.prototype.start=function(){return this.ru=new el,Promise.resolve()},dl.prototype.Qa=function(t,e,n){},dl.prototype.Ka=function(t){},dl.prototype.$o=function(){},dl.prototype.q=function(t){},dl.prototype.Wa=function(){},dl),il=(pl.prototype.cu=function(t){},pl.prototype.$o=function(){},pl),ol=(ll.prototype.cu=function(t){this._u.push(t)},ll.prototype.$o=function(){window.removeEventListener("online",this.au),window.removeEventListener("offline",this.hu)},ll.prototype.fu=function(){window.addEventListener("online",this.au),window.addEventListener("offline",this.hu)},ll.prototype.uu=function(){$r("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this._u;t<e.length;t++)(0,e[t])(0)},ll.prototype.lu=function(){$r("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this._u;t<e.length;t++)(0,e[t])(1)},ll.jn=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},ll),sl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ul=(fl.prototype.Tu=function(t){this.Eu=t},fl.prototype.Iu=function(t){this.mu=t},fl.prototype.onMessage=function(t){this.Au=t},fl.prototype.Ru=function(t){this.Pu=t},fl.prototype.close=function(){this.wu()},fl.prototype.send=function(t){this.du(t)},fl.prototype.yu=function(){this.Eu()},fl.prototype.gu=function(t){this.mu(t)},fl.prototype.Vu=function(t){this.Au(t)},fl.prototype.pu=function(t,e){this.Pu(t,e)},fl),al=(hl.prototype.Du=function(e,t,n,r){var i=this.Cu(e,t);$r("RestConnection","Sending: ",i,n);t={};return this.xu(t,r),this.Nu(e,i,t,n).then(function(t){return $r("RestConnection","Received: ",t),t},function(t){throw ei("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},hl.prototype.Fu=function(t,e,n,r){return this.Du(t,e,n,r)},hl.prototype.xu=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.2-longpoll.66863f547",t["Content-Type"]="text/plain",e)for(var n in e.V)e.V.hasOwnProperty(n)&&(t[n]=e.V[n])},hl.prototype.Cu=function(t,e){t=sl[t];return this.vu+"/v1/"+e+":"+t},h(cl,Yf=hl),cl.prototype.Nu=function(o,e,s,u){return new Promise(function(n,r){var i=new Xr;i.listenOnce(Gr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case Hr.NO_ERROR:var t=i.getResponseJson();$r("Connection","XHR received:",JSON.stringify(t)),n(t);break;case Hr.TIMEOUT:$r("Connection",'RPC "'+o+'" timed out'),r(new di(pi.DEADLINE_EXCEEDED,"Request time out"));break;case Hr.HTTP_ERROR:var e=i.getStatus();$r("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(pi).indexOf(e)?e:pi.UNKNOWN,r(new di(e,t.message))):r(new di(pi.UNKNOWN,"Server responded with status "+i.getStatus())):r(new di(pi.UNAVAILABLE,"Connection failed."));break;default:ri()}}finally{$r("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},cl.prototype.Ou=function(t,e){var n,r=[this.vu,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new Vr,o=Br(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.T.projectId+"/databases/"+this.T.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.I};this.xu(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||(0<=(n=p()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");$r("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),u=!1,a=!1,c=(new Date).getTime(),h=new ul({du:function(t){a?$r("Connection","Not sending because WebChannel is closed:",t):(u||($r("Connection","Opening WebChannel transport."),s.open(),u=!0),$r("Connection","WebChannel sending:",t),s.send(t))},wu:function(){return s.close()}}),t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(s,Wr.EventType.OPEN,function(){a||$r("Connection","WebChannel transport opened.")}),t(s,Wr.EventType.CLOSE,function(){a||(a=!0,$r("Connection","WebChannel transport closed"),h.gu())}),t(s,Wr.EventType.ERROR,function(t){a||(a=!0,ei("Connection","WebChannel transport errored:",t),h.gu(new di(pi.UNAVAILABLE,"The operation could not be completed")))}),t(s,Wr.EventType.MESSAGE,function(t){var e,n,r,i;a||(ii(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?($r("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Tu[r];if(void 0!==t)return Lu(t)}(),i=n.message,void 0===t&&(t=pi.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),a=!0,h.gu(new di(t,i)),s.close()):($r("Connection","WebChannel received:",e),h.Vu(e)))}),t(o,Kr.STAT_EVENT,function(t){var e=(new Date).getTime()-c;t.stat===zr?($r("Connection","Detected buffering proxy"),h.pu(!0,e)):t.stat===Jr&&($r("Connection","Detected no buffering proxy"),h.pu(!1,e))}),setTimeout(function(){h.yu()},0),h},cl);function cl(t){var e=this;return(e=Yf.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.I=t.I,e}function hl(t){this.bu=t,this.T=t.T;var e=t.ssl?"https":"http";this.vu=e+"://"+t.host,this.Su="projects/"+this.T.projectId+"/databases/"+this.T.database+"/documents"}function fl(t){this.du=t.du,this.wu=t.wu}function ll(){var t=this;this.au=function(){return t.uu()},this.hu=function(){return t.lu()},this._u=[],this.fu()}function pl(){}function dl(){this.ru=new el,this.ou={},this.da=null,this.$=null}function yl(t,e,n,r,i){this.window=t,this.eo=e,this.persistenceKey=n,this._a=r,this.fa=null,this.da=null,this.$=null,this.wa=this.Ta.bind(this),this.Ea=new Pu(ui),this.Er=!1,this.Ia=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ma=Jf(this.persistenceKey,this._a),this.Aa="firestore_sequence_number_"+this.persistenceKey,this.Ea=this.Ea.Ht(this._a,new el),this.Ra=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Pa=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.ya=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.ga="firestore_online_state_"+this.persistenceKey,this.Va="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.wa)}function vl(){this.activeTargetIds=Xu}function gl(t,e){this.clientId=t,this.onlineState=e}function ml(t,e){this.clientId=t,this.activeTargetIds=e}function bl(t,e,n){this.targetId=t,this.state=e,this.error=n}function wl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function El(){return"undefined"!=typeof window?window:null}function Il(){return"undefined"!=typeof document?document:null}function _l(t){return new ga(t,!0)}function Tl(t,e,n,r,i){var o=this;this.xh=t,this.Nh=e,this.fs=n,this.Fh={},this.Oh=[],this.kh=new Map,this.Mh=new Set,this.$h=[],this.Lh=i,this.Lh.cu(function(t){n.ys(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Jl(this)?($r("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Mh.add(4),[4,ql(e)];case 1:return t.sent(),e.Bh.set("Unknown"),e.Mh.delete(4),[4,Fl(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Bh=new Ll(n,r)}var Nl,Al,xl,Sl=(Ul.prototype.reset=function(){this.Lu=0},Ul.prototype.Uu=function(){this.Lu=this.$u},Ul.prototype.Qu=function(t){var e=this;this.cancel();var n=Math.floor(this.Lu+this.Ku()),r=Math.max(0,Date.now()-this.qu),i=Math.max(0,n-r);0<i&&$r("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Lu+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Bu=this.eo.Ir(this.ds,i,function(){return e.qu=Date.now(),t()}),this.Lu*=this.Mu,this.Lu<this.ku&&(this.Lu=this.ku),this.Lu>this.$u&&(this.Lu=this.$u)},Ul.prototype.ju=function(){null!==this.Bu&&(this.Bu.Ps(),this.Bu=null)},Ul.prototype.cancel=function(){null!==this.Bu&&(this.Bu.cancel(),this.Bu=null)},Ul.prototype.Ku=function(){return(Math.random()-.5)*this.Lu},Ul),Je=(Vl.prototype.Xu=function(){return 1===this.state||2===this.state||4===this.state},Vl.prototype.Zu=function(){return 2===this.state},Vl.prototype.start=function(){3!==this.state?this.auth():this.th()},Vl.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Xu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Vl.prototype.eh=function(){this.state=0,this.Yu.reset()},Vl.prototype.nh=function(){var t=this;this.Zu()&&null===this.Ju&&(this.Ju=this.eo.Ir(this.Wu,6e4,function(){return t.sh()}))},Vl.prototype.ih=function(t){this.rh(),this.stream.send(t)},Vl.prototype.sh=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.Zu()?[2,this.close(0)]:[2]})})},Vl.prototype.rh=function(){this.Ju&&(this.Ju.cancel(),this.Ju=null)},Vl.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.rh(),this.Yu.cancel(),this.Hu++,3!==e?this.Yu.reset():n&&n.code===pi.RESOURCE_EXHAUSTED?(ti(n.toString()),ti("Using maximum backoff delay to prevent overloading the backend."),this.Yu.Uu()):n&&n.code===pi.UNAUTHENTICATED&&this.zu.v(),null!==this.stream&&(this.oh(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Iu(n)];case 1:return t.sent(),[2]}})})},Vl.prototype.oh=function(){},Vl.prototype.Ru=function(t,e){this.listener.Ru(t,e)},Vl.prototype.auth=function(){var n=this;this.state=1;var t=this.ah(this.Hu),e=this.Hu;this.zu.getToken().then(function(t){n.Hu===e&&n.uh(t)},function(e){t(function(){var t=new di(pi.UNKNOWN,"Fetching auth token failed: "+e.message);return n.hh(t)})})},Vl.prototype.uh=function(t){var r=this,i=this.ah(this.Hu);this.stream=this.lh(t),this.stream.Tu(function(){i(function(){return r.state=2,r.listener.Tu()})}),this.stream.Iu(function(t){i(function(){return r.hh(t)})}),this.stream.onMessage(function(t){i(function(){return r.onMessage(t)})}),this.stream.Ru(function(e,n){i(function(){return y(r,void 0,void 0,function(){return v(this,function(t){return[2,this.Ru(e,n)]})})})})},Vl.prototype.th=function(){var t=this;this.state=4,this.Yu.Qu(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Vl.prototype.hh=function(t){return $r("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Vl.prototype.ah=function(e){var n=this;return function(t){n.eo.ys(function(){return n.Hu===e?t():($r("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Vl),Ol=(h(Ml,xl=Je),Ml.prototype.lh=function(t){return this.Gu.Ou("Listen",t)},Ml.prototype.onMessage=function(t){this.Yu.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:ri(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.qt?(ii(void 0===s||"string"==typeof s),hi.fromBase64String(s||"")):(ii(void 0===s||s instanceof Uint8Array),hi.fromUint8Array(s||new Uint8Array))),o=(u=e.targetChange.cause)&&(a=void 0===(c=u).code?pi.UNKNOWN:Lu(c.code),new di(a,c.message||"")),s=new ra(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime,r=Ta(t,n.document.name),i=wa(n.document.updateTime);var u=new xo({mapValue:{fields:n.document.fields}}),a=(o=new Co(r,i,u,{}),n.targetIds||[]),c=n.removedTargetIds||[];s=new ea(a,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=Ta(t,n.document),i=n.readTime?wa(n.readTime):Hi.min(),u=new Ro(r,i),o=n.removedTargetIds||[],s=new ea([],o,u.key,u);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=Ta(t,n.document),i=n.removedTargetIds||[],s=new ea([],i,r,null);else{if(!("filter"in e))return ri();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new _u(n),i=e.targetId,s=new na(i,r)}return s}(this.Kt,t),t=function(t){if(!("targetChange"in t))return Hi.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?wa(t.readTime):Hi.min()}(t);return this.listener._h(e,t)},Ml.prototype.fh=function(t){var e,n,r,i={};i.database=xa(this.Kt),i.addTarget=(e=this.Kt,(r=Go(r=(n=t).target)?{documents:Pa(e,r)}:{query:Ca(e,r)}).targetId=n.targetId,0<n.resumeToken.o()?r.resumeToken=ba(e,n.resumeToken):0<n.Mt.u(Hi.min())&&(r.readTime=ma(e,n.Mt.G())),r);var o,t=(this.Kt,o=t,null==(t=function(){switch(o.kt){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ri()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.ih(i)},Ml.prototype.dh=function(t){var e={};e.database=xa(this.Kt),e.removeTarget=t,this.ih(e)},Ml),Dl=(h(Rl,Al=Je),Object.defineProperty(Rl.prototype,"Th",{get:function(){return this.wh},enumerable:!1,configurable:!0}),Rl.prototype.start=function(){this.wh=!1,this.lastStreamToken=void 0,Al.prototype.start.call(this)},Rl.prototype.oh=function(){this.wh&&this.Eh([])},Rl.prototype.lh=function(t){return this.Gu.Ou("Write",t)},Rl.prototype.onMessage=function(t){if(ii(!!t.streamToken),this.lastStreamToken=t.streamToken,this.wh){this.Yu.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(ii(void 0!==r),n.map(function(t){return function(t,e){var n=t.updateTime?wa(t.updateTime):wa(e);n.isEqual(Hi.min())&&(n=wa(e));e=null;return t.transformResults&&0<t.transformResults.length&&(e=t.transformResults),new ou(n,e)}(t,r)})):[]),n=wa(t.commitTime);return this.listener.Ih(n,e)}var n,r;return ii(!t.writeResults||0===t.writeResults.length),this.wh=!0,this.listener.mh()},Rl.prototype.Ah=function(){var t={};t.database=xa(this.Kt),this.ih(t)},Rl.prototype.Eh=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return ka(e.Kt,t)})};this.ih(t)},Rl),kl=(h(Cl,Nl=function(){}),Cl.prototype.Ph=function(){if(this.Rh)throw new di(pi.FAILED_PRECONDITION,"The client has already been terminated.")},Cl.prototype.Du=function(e,n,r){var i=this;return this.Ph(),this.credentials.getToken().then(function(t){return i.Gu.Du(e,n,r,t)}).catch(function(t){throw t.code===pi.UNAUTHENTICATED&&i.credentials.v(),t})},Cl.prototype.Fu=function(e,n,r){var i=this;return this.Ph(),this.credentials.getToken().then(function(t){return i.Gu.Fu(e,n,r,t)}).catch(function(t){throw t.code===pi.UNAUTHENTICATED&&i.credentials.v(),t})},Cl.prototype.terminate=function(){this.Rh=!1},Cl),Ll=(Pl.prototype.ph=function(){var t=this;0===this.yh&&(this.bh("Unknown"),this.gh=this.fs.Ir("online_state_timeout",1e4,function(){return t.gh=null,t.Sh("Backend didn't respond within 10 seconds."),t.bh("Offline"),Promise.resolve()}))},Pl.prototype.Dh=function(t){"Online"===this.state?this.bh("Unknown"):(this.yh++,1<=this.yh&&(this.Ch(),this.Sh("Connection failed 1 times. Most recent error: "+t.toString()),this.bh("Offline")))},Pl.prototype.set=function(t){this.Ch(),this.yh=0,"Online"===t&&(this.Vh=!1),this.bh(t)},Pl.prototype.bh=function(t){t!==this.state&&(this.state=t,this.da(t))},Pl.prototype.Sh=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vh?(ti(t),this.Vh=!1):$r("OnlineStateTracker",t)},Pl.prototype.Ch=function(){null!==this.gh&&(this.gh.cancel(),this.gh=null)},Pl);function Pl(t,e){this.fs=t,this.da=e,this.state="Unknown",this.yh=0,this.gh=null,this.Vh=!0}function Cl(t,e,n){var r=this;return(r=Nl.call(this)||this).credentials=t,r.Gu=e,r.Kt=n,r.Rh=!1,r}function Rl(t,e,n,r,i){var o=this;return(o=Al.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).Kt=r,o.wh=!1,o}function Ml(t,e,n,r,i){var o=this;return(o=xl.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).Kt=r,o}function Vl(t,e,n,r,i,o){this.eo=t,this.Wu=n,this.Gu=r,this.zu=i,this.listener=o,this.state=0,this.Hu=0,this.Ju=null,this.stream=null,this.Yu=new Sl(t,e)}function Ul(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.eo=t,this.ds=e,this.ku=n,this.Mu=r,this.$u=i,this.Lu=0,this.Bu=null,this.qu=Date.now(),this.reset()}function Fl(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!Jl(r))return[3,4];e=0,n=r.$h,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ql(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.$h,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function jl(t,e){t.kh.has(e.targetId)||(t.kh.set(e.targetId,e),zl(t)?Kl(t):rp(t).Zu()&&Hl(t,e))}function Bl(t,e){var n=t,t=rp(n);n.kh.delete(e),t.Zu()&&Gl(n,e),0===n.kh.size&&(t.Zu()?t.nh():Jl(n)&&n.Bh.set("Unknown"))}function Hl(t,e){t.qh.cn(e.targetId),rp(t).fh(e)}function Gl(t,e){t.qh.cn(e),rp(t).dh(e)}function Kl(e){e.qh=new oa({Sn:function(t){return e.Fh.Sn(t)},Dn:function(t){return e.kh.get(t)||null}}),rp(e).start(),e.Bh.ph()}function zl(t){return Jl(t)&&!rp(t).Xu()&&0<t.kh.size}function Jl(t){return 0===t.Mh.size}function Wl(t){t.qh=void 0}function Xl(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Bh.set("Online"),!(u instanceof ra&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.kh.has(i)?[4,o.Fh.Uh(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.kh.delete(i),o.qh.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),$r("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,Yl(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof ea?s.qh.wn(u):u instanceof na?s.qh.yn(u):s.qh.In(u),a.isEqual(Hi.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,vf(s.xh)];case 8:return o=t.sent(),0<=a.u(o)?[4,(i=a,(e=(r=s).qh.pn(i)).Oe.forEach(function(t,e){var n;0<t.resumeToken.o()&&((n=r.kh.get(e))&&r.kh.set(e,n.Lt(t.resumeToken,i)))}),e.ke.forEach(function(t){var e=r.kh.get(t);e&&(r.kh.set(t,e.Lt(hi.h,e.Mt)),Gl(r,t),e=new Vs(e.target,t,1,e.sequenceNumber),Hl(r,e))}),r.Fh.Qh(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return $r("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Yl(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function Yl(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!tc(r))throw r;return n.Mh.add(1),[4,ql(n)];case 1:return t.sent(),n.Bh.set("Offline"),i=i||function(){return vf(n.xh)},n.fs.bo(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return $r("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Mh.delete(1),[4,Fl(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Ql(e,n){return n().catch(function(t){return Yl(e,t,n)})}function Zl(a){return y(this,void 0,void 0,function(){var i,o,s,u;return v(this,function(t){switch(t.label){case 0:o=ip(i=a),s=0<i.Oh.length?i.Oh[i.Oh.length-1].batchId:-1,t.label=1;case 1:if(!(Jl(i)&&i.Oh.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.xh,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.Ho.Vi(t,n)}))];case 3:return null===(u=t.sent())?(0===i.Oh.length&&o.nh(),[3,7]):(s=u.batchId,function(t,e){t.Oh.push(e);t=ip(t);t.Zu()&&t.Th&&t.Eh(e.mutations)}(i,u),[3,6]);case 4:return u=t.sent(),[4,Yl(i,u)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return $l(i)&&tp(i),[2]}var e,n,r})})}function $l(t){return Jl(t)&&!ip(t).Xu()&&0<t.Oh.length}function tp(t){ip(t).start()}function ep(t,e,n){t.Fh.Kh&&t.Fh.Kh(e,n)}function np(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Mh.delete(2),[4,Fl(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Mh.add(2),[4,ql(e)]);case 3:t.sent(),e.Bh.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function rp(n){var t,e,r,i=this;return n.Gh||(n.Gh=(t=n.Nh,e=n.fs,r={Tu:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.kh.forEach(function(t,e){Hl(n,t)}),[2]})})}.bind(null,n),Iu:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return Wl(e),zl(e)?(e.Bh.Dh(n),Kl(e)):e.Bh.set("Unknown"),[2]})})}.bind(null,n),_h:Xl.bind(null,n),Ru:ep.bind(null,n)},t.Ph(),new Ol(e,t.Gu,t.credentials,t.Kt,r)),n.$h.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.Gh.eh(),zl(n)?Kl(n):n.Bh.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.Gh.stop()];case 2:t.sent(),Wl(n),t.label=3;case 3:return[2]}})})})),n.Gh}function ip(n){var t,e,r,i=this;return n.zh||(n.zh=(t=n.Nh,e=n.fs,r={Tu:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return ip(e).Ah(),[2]})})}.bind(null,n),Iu:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&ip(e).Th?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return ku(n=i.code)&&n!==pi.ABORTED?(e=r.Oh.shift(),ip(r).eh(),[4,Ql(r,function(){return r.Fh.Wh(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Zl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return $l(e)&&tp(e),[2]}})})}.bind(null,n),mh:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=ip(o),n=0,r=o.Oh;n<r.length;n++)i=r[n],e.Eh(i.mutations);return[2]})})}.bind(null,n),Ih:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Oh.shift(),n=Vc.from(e,i,o),[4,Ql(r,function(){return r.Fh.jh(n)})];case 1:return t.sent(),[4,Zl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n),Ru:ep.bind(null,n)},t.Ph(),new Dl(e,t.Gu,t.credentials,t.Kt,r)),n.$h.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.zh.eh(),[4,Zl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.zh.stop()];case 3:t.sent(),0<n.Oh.length&&($r("RemoteStore","Stopping write stream with "+n.Oh.length+" pending writes"),n.Oh=[]),t.label=4;case 4:return[2]}})})})),n.zh}function op(){this.queries=new lh(Ps,Ls),this.onlineState="Unknown",this.Jh=new Set}var sp=function(){this.Hh=void 0,this.listeners=[]};function up(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new sp),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.Yh(n)];case 2:return o.Hh=t.sent(),[3,4];case 3:return o=t.sent(),o=ac(o,"Initialization of query '"+Cs(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(u),u.Xh(e.onlineState),i.Hh&&u.Zh(i.Hh)&&cp(e),[2]}})})}function ap(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.tl(n))]:[2]})})}function cp(t){t.Jh.forEach(function(t){t.next()})}var hp=(gp.prototype.Zh=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Zu(t.query,t.docs,t.De,e,t.Ce,t.fromCache,t.xe,!0)}var o=!1;return this.nl?this.il(t)&&(this.el.next(t),o=!0):this.rl(t,this.onlineState)&&(this.ol(t),o=!0),this.sl=t,o},gp.prototype.onError=function(t){this.el.error(t)},gp.prototype.Xh=function(t){this.onlineState=t;var e=!1;return this.sl&&!this.nl&&this.rl(this.sl,t)&&(this.ol(this.sl),e=!0),e},gp.prototype.rl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.cl&&n||t.docs.nt()&&"Offline"!==e)},gp.prototype.il=function(t){if(0<t.docChanges.length)return!0;var e=this.sl&&this.sl.hasPendingWrites!==t.hasPendingWrites;return!(!t.xe&&!e)&&!0===this.options.includeMetadataChanges},gp.prototype.ol=function(t){t=Zu.Fe(t.query,t.docs,t.Ce,t.fromCache),this.nl=!0,this.el.next(t)},gp),fp=(vp.prototype.al=function(){return"metadata"in this.payload},vp),lp=(yp.prototype.yc=function(t){return Ta(this.Kt,t)},yp.prototype.gc=function(t){return t.metadata.exists?Da(this.Kt,t.document,!1):new Ro(this.yc(t.metadata.name),this.Vc(t.metadata.readTime))},yp.prototype.Vc=wa,yp),pp=(dp.prototype.hl=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},dp.prototype.ll=function(t){for(var e=new Map,n=new lp(this.Kt),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.yc(o.metadata.name),u=0,a=o.metadata.queries;u<a.length;u++){var c=a[u],h=(e.get(c)||Wu()).add(s);e.set(c,h)}}return e},dp.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return[4,function(f,l,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,u,a,c,h;return v(this,function(t){switch(t.label){case 0:for(n=f,r=Wu(),i=Bu,o=zu,e=0,s=p;e<s.length;e++)u=s[e],a=l.yc(u.metadata.name),u.document&&(r=r.add(a)),i=i.Ht(a,l.gc(u)),o=o.Ht(a,l.Vc(u.metadata.readTime));return c=n.Ec.Fr({Wr:!0}),[4,bf(n,Ds(_s(Gi.ct("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return mf(e,c,i,Hi.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.fo.Xi(e,h.targetId).next(function(){return n.fo.nr(e,r,h.targetId)}).next(function(){return n.Ic.tc(e,t)})})})]}})})}(this.xh,new lp(this.Kt),this.documents,this.ul.id)];case 1:e=t.sent(),n=this.ll(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Wu()),y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return[4,bf(e,Ds(Yc(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=wa(i.readTime);if(0<=n.Mt.u(e))return r.To.Bs(t,i);e=n.Lt(hi.h,e);return r.dc=r.dc.Ht(e.targetId,e),r.fo.Ji(t,e).next(function(){return r.fo.Xi(t,n.targetId)}).next(function(){return r.fo.nr(t,o,n.targetId)}).next(function(){return r.To.Bs(t,i)})})]}})})}(this.xh,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new rf(Object.assign({},this.progress),e))]}})})},dp);function dp(t,e,n){this.ul=t,this.xh=e,this.Kt=n,this.queries=[],this.documents=[],this.progress=mp(t)}function yp(t){this.Kt=t}function vp(t,e){this.payload=t,this.byteLength=e}function gp(t,e,n){this.query=t,this.el=e,this.nl=!1,this.sl=null,this.onlineState="Unknown",this.options=n||{}}function mp(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var bp=function(t){this.key=t},wp=function(t){this.key=t},Ep=(Object.defineProperty(Ap.prototype,"El",{get:function(){return this._l},enumerable:!1,configurable:!0}),Ap.prototype.Il=function(t,e){var s=this,u=e?e.ml:new Qu,a=(e||this).Tl,c=(e||this).Ce,h=a,f=!1,l=Ts(this.query)&&a.size===this.query.limit?a.last():null,p=Ns(this.query)&&a.size===this.query.limit?a.first():null;if(t.Zt(function(t,e){var n=a.get(t),r=(r=e instanceof Co?e:null)&&(Rs(s.query,r)?r:null),i=!!n&&s.Ce.has(n.key),o=!!r&&(r.bt||s.Ce.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.Al(n,r)||(u.track({type:2,doc:r}),e=!0,(l&&0<s.wl(r,l)||p&&s.wl(r,p)<0)&&(f=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(l||p)&&(f=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),Ts(this.query)||Ns(this.query))for(;h.size>this.query.limit;){var n=Ts(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{Tl:h,ml:u,_c:f,Ce:c}},Ap.prototype.Al=function(t,e){return t.bt&&e.hasCommittedMutations&&!e.bt},Ap.prototype.Ti=function(t,e,n){var o=this,r=this.Tl;this.Tl=t.Tl,this.Ce=t.Ce;var i=t.ml.Se();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.wl(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ri()}}var r,i}),this.Rl(n);var s=e?this.Pl():[],n=0===this.dl.size&&this.qe?1:0,e=n!==this.fl;return this.fl=n,0!==i.length||e?{snapshot:new Zu(this.query,t.Tl,r,i,t.Ce,0==n,e,!1),yl:s}:{yl:s}},Ap.prototype.Xh=function(t){return this.qe&&"Offline"===t?(this.qe=!1,this.Ti({Tl:this.Tl,ml:new Qu,Ce:this.Ce,_c:!1},!1)):{yl:[]}},Ap.prototype.gl=function(t){return!this._l.has(t)&&!!this.Tl.has(t)&&!this.Tl.get(t).bt},Ap.prototype.Rl=function(t){var e=this;t&&(t.Ue.forEach(function(t){return e._l=e._l.add(t)}),t.Qe.forEach(function(t){}),t.Ke.forEach(function(t){return e._l=e._l.delete(t)}),this.qe=t.qe)},Ap.prototype.Pl=function(){var e=this;if(!this.qe)return[];var n=this.dl;this.dl=Wu(),this.Tl.forEach(function(t){e.gl(t.key)&&(e.dl=e.dl.add(t.key))});var r=[];return n.forEach(function(t){e.dl.has(t)||r.push(new wp(t))}),this.dl.forEach(function(t){n.has(t)||r.push(new bp(t))}),r},Ap.prototype.Vl=function(t){this._l=t.Pc,this.dl=Wu();t=this.Il(t.documents);return this.Ti(t,!0)},Ap.prototype.pl=function(){return Zu.Fe(this.query,this.Tl,this.Ce,0===this.fl)},Ap),Ip=function(t,e,n){this.query=t,this.targetId=e,this.view=n},_p=function(t){this.key=t,this.bl=!1},Tp=(Object.defineProperty(Np.prototype,"jl",{get:function(){return!0===this.Kl},enumerable:!1,configurable:!0}),Np);function Np(t,e,n,r,i,o,s){this.xh=t,this.vl=e,this.Sl=n,this.Dl=r,this.currentUser=i,this.Cl=o,this.xl=s,this.Nl={},this.Fl=!1,this.Ol=new lh(Ps,Ls),this.kl=new Map,this.Ml=[],this.$l=new Pu(Ji.J),this.Ll=new Map,this.Bl=new Sf,this.ql={},this.Ul=new Map,this.Ql=_h.Bi(),this.onlineState="Unknown",this.Kl=void 0}function Ap(t,e){this.query=t,this._l=e,this.fl=null,this.qe=!1,this.dl=Wu(),this.Ce=Wu(),this.wl=Ms(t),this.Tl=new Yu(this.wl)}function xp(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Wl=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.Il(o))._c?[4,Ef(r.xh,i.query,!1).then(function(t){t=t.documents;return i.view.Il(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.Oe.get(i.targetId),n=i.view.Ti(e,r.jl,n),[2,(Vp(r,i.targetId,n.yl),n.snapshot)]}})})}(i,t,e,n)},[4,Ef(i.xh,o,!0)];case 1:return n=t.sent(),r=new Ep(o,n.Pc),e=r.Il(n.documents),n=ta.Be(s,u&&"Offline"!==i.onlineState),n=r.Ti(e,i.jl,n),Vp(i,s,n.yl),r=new Ip(o,s,r),[2,(i.Ol.set(o,r),i.kl.has(s)?i.kl.get(s).push(o):i.kl.set(s,[o]),n.snapshot)]}})})}function Sp(l,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=zp(l),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.xh,a=p,h=i,f=Bi.now(),o=a.reduce(function(t,e){return t.add(e.key)},Wu()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Ic.Zo(u,o).next(function(t){c=t;for(var e,n=[],r=0,i=a;r<i.length;r++){var o=i[r],s=(e=o,s=c.get(o.key),function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof Co?e.field(o.field):void 0,s=Bs(o.transform,s||null);null!=s&&(n=(null==n?new So:n).set(o.field,s))}return n?n.yt():null}(e.fieldTransforms,s));null!=s&&n.push(new vu(o.key,s,function s(t){var u=[];return eo(t.fields||{},function(t,e){var n=new zi([t]);if(Ao(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new ro(u)}(s.proto.mapValue),uu.exists(!0)))}return h.Ho.Pi(u,f,n,a)})}).then(function(t){var e=t.Ns(c);return{batchId:t.batchId,oi:e}}))];case 2:return s=t.sent(),u.Dl.xa(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.ql[e.currentUser.R()])||new Pu(ui)).Ht(n,r),e.ql[e.currentUser.R()]=i,[4,Fp(u,s.oi)];case 3:return t.sent(),[4,Zl(u.vl)];case 4:return t.sent(),[3,6];case 5:return u=t.sent(),u=ac(u,"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,f,o})})}function Op(r,i){return y(this,void 0,void 0,function(){var n,e;return v(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,gf(n.xh,i)];case 2:return e=t.sent(),i.Oe.forEach(function(t,e){e=n.Ll.get(e);e&&(ii(t.Ue.size+t.Qe.size+t.Ke.size<=1),0<t.Ue.size?e.bl=!0:0<t.Qe.size?ii(e.bl):0<t.Ke.size&&(ii(e.bl),e.bl=!1))}),[4,Fp(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,fh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function Dp(t,n,e){var r,t=t;(t.jl&&0===e||!t.jl&&1===e)&&(r=[],t.Ol.forEach(function(t,e){e=e.view.Xh(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Xh(i)&&(o=!0)}),o&&cp(t)}(t.Sl,n),r.length&&t.Nl._h(r),t.onlineState=n,t.jl&&t.Dl.Ka(n))}function kp(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.xh,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Ho.yi(e,r).next(function(t){return ii(null!==t),n=t.keys(),i.Ho.xi(e,t)}).next(function(){return i.Ho.Oi(e)}).next(function(){return i.Ic.Zo(e,n)})}))];case 2:return o=t.sent(),Cp(n,u,a),Pp(n,u),n.Dl.Fa(u,"rejected",a),[4,Fp(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,fh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function Lp(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:Jl((n=o).vl)||$r("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.xh).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Ho.pi(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Ul.get(r)||[]).push(s),n.Ul.set(r,i),[3,4]);case 3:return i=t.sent(),i=ac(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function Pp(t,e){(t.Ul.get(e)||[]).forEach(function(t){t.resolve()}),t.Ul.delete(e)}function Cp(t,e,n){var r=t,i=r.ql[r.currentUser.R()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.ql[r.currentUser.R()]=i)}function Rp(e,t,n){void 0===n&&(n=null),e.Dl.$a(t);for(var r=0,i=e.kl.get(t);r<i.length;r++){var o=i[r];e.Ol.delete(o),n&&e.Nl.Gl(o,n)}e.kl.delete(t),e.jl&&e.Bl.kc(t).forEach(function(t){e.Bl.ki(t)||Mp(e,t)})}function Mp(t,e){var n=t.$l.get(e);null!==n&&(Bl(t.vl,n),t.$l=t.$l.remove(e),t.Ll.delete(n),Up(t))}function Vp(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof bp?(t.Bl.sr(o.key,e),function(t,e){e=e.key;t.$l.get(e)||($r("SyncEngine","New document in limbo: "+e),t.Ml.push(e),Up(t))}(t,o)):o instanceof wp?($r("SyncEngine","Document no longer in limbo: "+o.key),t.Bl.rr(o.key,e),t.Bl.ki(o.key)||Mp(t,o.key)):ri()}}function Up(t){for(;0<t.Ml.length&&t.$l.size<t.Cl;){var e=t.Ml.shift(),n=t.Ql.next();t.Ll.set(n,new _p(e)),t.$l=t.$l.Ht(e,n),jl(t.vl,new Vs(Ds(_s(e.path)),n,2,Ci.U))}}function Fp(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Ol.nt()?[3,3]:(n.Ol.forEach(function(t,e){o.push(n.Wl(e,s,u).then(function(t){t&&(n.jl&&n.Dl.qa(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=sf.cc(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.Nl._h(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Ga.forEach(c,function(e){return Ga.forEach(e.rc,function(t){return r.persistence.Ii.sr(n,e.targetId,t)}).next(function(){return Ga.forEach(e.oc,function(t){return r.persistence.Ii.rr(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!tc(e=t.sent()))throw e;return $r("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.dc.get(o),u=s.Mt,u=s.Bt(u),r.dc=r.dc.Ht(o,u));return[2]}})})}(n.xh,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function qp(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:($r("SyncEngine","User change. New user:",o.R()),[4,df(n.xh,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Ul.forEach(function(t){t.forEach(function(t){t.reject(new di(pi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ul.clear(),n.Dl.Qa(o,r.Ac,r.Rc),[4,Fp(n,r.mc)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function jp(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).xh,n=a,i=(r=e).Ho,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.gi(e,n).next(function(t){return t?r.Ic.Zo(e,t):Ga.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,Zl(o.vl)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Cp(o,a,h||null),Pp(o,a),o.xh.Ho.Ni(a)):ri(),t.label=4;case 4:return[4,Fp(o,s)];case 5:return t.sent(),[3,7];case 6:$r("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function Bp(h,f){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return Kp(r=h),zp(r),!0!==f||!0===r.Kl?[3,3]:(e=r.Dl.Sa(),[4,Hp(r,e.rt())]);case 1:return i=t.sent(),r.Kl=!0,[4,np(r.vl,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],jl(r.vl,u);return[3,7];case 3:return!1!==f||!1===r.Kl?[3,7]:(a=[],c=Promise.resolve(),r.kl.forEach(function(t,e){r.Dl.La(e)?a.push(e):c=c.then(function(){return Rp(r,e),wf(r.xh,e,!0)}),Bl(r.vl,e)}),[4,c]);case 4:return t.sent(),[4,Hp(r,a)];case 5:return t.sent(),(n=r).Ll.forEach(function(t,e){Bl(n.vl,e)}),n.Bl.Mc(),n.Ll=new Map,n.$l=new Pu(Ji.J),r.Kl=!1,[4,np(r.vl,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Hp(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.kl.get(s))&&0!==a.length?[4,bf(e.xh,Ds(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],f=e.Ol.get(f),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Ef((e=r).xh,i.query,!0)];case 1:return n=t.sent(),n=i.view.Vl(n),[2,(e.jl&&Vp(e,i.targetId,n.yl),n)]}})})}(e,f)]):[3,6];case 4:(f=t.sent()).snapshot&&r.push(f.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,If(e.xh,s)];case 8:return l=t.sent(),[4,bf(e.xh,l)];case 9:return u=t.sent(),[4,xp(e,Gp(l),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Nl._h(r),n)]}})})}function Gp(t){return Is(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Kp(t){var n=t;return n.vl.Fh.Qh=Op.bind(null,n),n.vl.Fh.Sn=function(t,e){var n=t;if((t=n.Ll.get(e))&&t.bl)return Wu().add(t.key);var r=Wu();if(!(e=n.kl.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Ol.get(s),r=r.ye(s.view.El);return r}.bind(null,n),n.vl.Fh.Uh=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).Dl.qa(s,"rejected",u),i=e.Ll.get(s),(n=i&&i.key)?(r=(r=new Pu(Ji.J)).Ht(n,new Ro(n,Hi.min())),i=Wu().add(n),i=new $u(Hi.min(),new Map,new qu(ui),r,i),[4,Op(e,i)]):[3,2];case 1:return t.sent(),e.$l=e.$l.remove(n),e.Ll.delete(s),Up(e),[3,4];case 2:return[4,wf(e.xh,s,!1).then(function(){return Rp(e,s,u)}).catch(fh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,n),n.vl.Fh.Kh=function(t,e){!n.Fl&&n.xl&&(n.Fl=!0,n.xl(t,e))},n.Nl._h=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,u=n.queries.get(u);if(u){for(var a=0,c=u.listeners;a<c.length;a++)c[a].Zh(s)&&(r=!0);u.Hh=s}}r&&cp(n)}.bind(null,n.Sl),n.Nl.Gl=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,n.Sl),n}function zp(t){return t.vl.Fh.jh=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,yf(e.xh,o)];case 2:return r=t.sent(),Cp(e,n,null),Pp(e,n),e.Dl.Fa(n,"acknowledged"),[4,Fp(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,fh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,t),t.vl.Fh.Wh=kp.bind(null,t),t}function Jp(t,e,n){var r=t;(function(l,p,d){return y(this,void 0,void 0,function(){var u,a,c,h,f;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return u=t.sent(),[4,(r=l.xh,o=r,s=wa((i=u).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.To.Ms(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.u(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d.zl({taskState:"Success",documentsLoaded:u.totalDocuments,bytesLoaded:u.totalBytes,totalDocuments:u.totalDocuments,totalBytes:u.totalBytes}))];case 4:return d.Hl(mp(u)),a=new pp(u,l.xh,p.Kt),[4,p.Jl()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,a.hl(c)]:[3,10];case 7:return(h=t.sent())&&d.Hl(h),[4,p.Jl()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,a.complete()];case 11:return f=t.sent(),[4,Fp(l,f.zo,void 0)];case 12:return t.sent(),[4,(r=l.xh,e=u,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.To.$s(t,e)}))];case 13:return t.sent(),d.zl(f.progress),[3,15];case 14:return ei("SyncEngine","Loading bundle failed with "+(f=t.sent())),d.Yl(f),[3,15];case 15:return[2]}var e,n,r,i,o,s})})})(r,e,n).then(function(){r.Dl.Wa()})}var Wp,Xp,Yp=(rd.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Kt=_l(e.bu.T),this.Dl=this.Xl(e),this.persistence=this.Zl(e),[4,this.persistence.start()];case 1:return t.sent(),this.t_=this.e_(e),this.xh=this.n_(e),[2]}})})},rd.prototype.e_=function(t){return null},rd.prototype.n_=function(t){return pf(this.persistence,new uf,t.s_,this.Kt)},rd.prototype.Zl=function(t){return new Cf(Mf.ra,this.Kt)},rd.prototype.Xl=function(t){return new rl},rd.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.t_&&this.t_.stop(),[4,this.Dl.$o()];case 1:return t.sent(),[4,this.persistence.$o()];case 2:return t.sent(),[2]}})})},rd),Qp=(h(nd,Xp=Yp),nd.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Xp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,Tf(this.xh)];case 2:return t.sent(),[4,this.i_.initialize(this,e)];case 3:return t.sent(),[4,zp(this.i_.fa)];case 4:return t.sent(),[4,Zl(this.i_.vl)];case 5:return t.sent(),[2]}})})},nd.prototype.n_=function(t){return pf(this.persistence,new uf,t.s_,this.Kt)},nd.prototype.e_=function(t){var e=this.persistence.Ii._r;return new Lh(e,t.fs)},nd.prototype.Zl=function(t){var e=nf(t.bu.T,t.bu.persistenceKey),n=void 0!==this.cacheSizeBytes?ch.Xs(this.cacheSizeBytes):ch.ei;return new Zh(this.synchronizeTabs,e,t.clientId,n,t.fs,El(),Il(),this.Kt,this.Dl,!!this.forceOwnership)},nd.prototype.Xl=function(t){return new rl},nd),Zp=(h(ed,Wp=Qp),ed.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,Wp.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.i_.fa,this.Dl instanceof nl?(this.Dl.fa={nu:jp.bind(null,e),su:function(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return(e=i).Kl?($r("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.kl.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,_f(e.xh)];case 3:return n=t.sent(),r=$u.Le(o,"current"===s),[4,Fp(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,wf(e.xh,o,!0)];case 6:return t.sent(),Rp(e,o,u),[3,8];case 7:ri(),t.label=8;case 8:return[2]}})})}.bind(null,e),iu:function(c,h,f){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=Kp(c)).Kl)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.kl.has(r)?($r("SyncEngine","Adding an already active target "+r),[3,5]):[4,If(n.xh,r)]):[3,6];case 2:return i=t.sent(),[4,bf(n.xh,i)];case 3:return o=t.sent(),[4,xp(n,Gp(i),o.targetId,!1)];case 4:t.sent(),jl(n.vl,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.kl.has(e)?[4,wf(n.xh,e,!1).then(function(){Bl(n.vl,e),Rp(n,e)}).catch(fh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=f,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),Qo:function(t){return t.xh.persistence.Qo()}.bind(null,e),eu:function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,_f((e=n).xh).then(function(t){return Fp(e,t)})]})})}.bind(null,e)},[4,this.Dl.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.Po(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Bp(this.i_.fa,e)];case 1:return t.sent(),this.t_&&(e&&!this.t_.Er?this.t_.start(this.xh):e||this.t_.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},ed.prototype.Xl=function(t){var e=El();if(!nl.jn(e))throw new di(pi.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=nf(t.bu.T,t.bu.persistenceKey);return new nl(e,t.fs,n,t.clientId,t.s_)},ed),$p=(td.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.xh?[3,2]:(this.xh=n.xh,this.Dl=n.Dl,this.Nh=this.r_(r),this.vl=this.o_(r),this.Sl=this.c_(r),this.fa=this.a_(r,!n.synchronizeTabs),this.Dl.da=function(t){return Dp(e.fa,t,1)},this.vl.Fh.u_=qp.bind(null,this.fa),[4,np(this.vl,this.fa.jl)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},td.prototype.c_=function(t){return new op},td.prototype.r_=function(t){var e=_l(t.bu.T),n=(n=t.bu,new al(n));return t=t.credentials,new kl(t,n,e)},td.prototype.o_=function(t){var e=this,n=this.xh,r=this.Nh,i=t.fs,o=function(t){return Dp(e.fa,t,0)},t=new(ol.jn()?ol:il);return new Tl(n,r,i,o,t)},td.prototype.a_=function(t,e){return function(t,e,n,r,i,o,s,u){u=new Tp(t,e,n,r,i,o,u);return s&&(u.Kl=!0),u}(this.xh,this.vl,this.Sl,this.Dl,t.s_,t.Cl,e,t.xl)},td.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,$r("RemoteStore","RemoteStore shutting down."),e.Mh.add(5),[4,ql(e)];case 1:return t.sent(),e.Lh.$o(),e.Bh.set("Unknown"),[2]}})})}(this.vl)},td);function td(){}function ed(t,e){var n=this;return(n=Wp.call(this,t,e,!1)||this).i_=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function nd(t,e,n){var r=this;return(r=Xp.call(this)||this).i_=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function rd(){this.synchronizeTabs=!1}function id(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2]})})},releaseLock:function(){}}}var od=(fd.prototype.next=function(t){this.observer.next&&this.h_(this.observer.next,t)},fd.prototype.error=function(t){this.observer.error?this.h_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},fd.prototype.l_=function(){this.muted=!0},fd.prototype.h_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},fd),sd=(hd.prototype.close=function(){return this.__.cancel()},hd.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2,this.metadata.promise]})})},hd.prototype.Jl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.d_())]}})})},hd.prototype.d_=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.w_()];case 1:return null===(e=t.sent())?[2,null]:(r=this.f_.decode(e),n=Number(r),isNaN(n)&&this.T_("length string ("+r+") is not valid number"),[4,this.E_(n)]);case 2:return r=t.sent(),[2,new fp(JSON.parse(r),e.length+n)]}})})},hd.prototype.I_=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},hd.prototype.w_=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.I_()<0?[4,this.m_()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.I_())<0&&this.T_("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},hd.prototype.E_=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.m_()]:[3,3];case 1:t.sent()&&this.T_("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.f_.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},hd.prototype.T_=function(t){throw this.__.cancel(),new Error("Invalid bundle format: "+t)},hd.prototype.m_=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.__.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},hd),ud=(cd.prototype.isEqual=function(t){return this.A_.isEqual(t.A_)},cd),ad=function(t){this._methodName=t};function cd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new di(pi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.A_=new zi(t)}function hd(t,e){var n=this;this.__=t,this.Kt=e,this.metadata=new Ha,this.buffer=new Uint8Array,this.f_=new TextDecoder("utf-8"),this.d_().then(function(t){t&&t.al()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function fd(t){this.observer=t,this.muted=!1}function ld(t,e,n){if(!n)throw new di(pi.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function pd(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new di(pi.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function dd(t,e,n,r){if(!0===e&&!0===r)throw new di(pi.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function yd(t){if(!Ji.Tt(t))throw new di(pi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function vd(t){if(Ji.Tt(t))throw new di(pi.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function gd(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":ri();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function md(t,e){if("_delegate"in t&&(t=t._),t instanceof e)return t;if(e.name===t.constructor.name)throw new di(pi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=gd(t);throw new di(pi.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function bd(t,e){if(e<=0)throw new di(pi.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var wd,Ed=(kd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},kd),Id=new Map,_d=(Object.defineProperty(Dd.prototype,"app",{get:function(){if(!this.p_)throw new di(pi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.p_},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"b_",{get:function(){return this.y_},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"v_",{get:function(){return void 0!==this.S_},enumerable:!1,configurable:!0}),Dd.prototype.D_=function(t){if(this.y_)throw new di(pi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.P_=new Ed(t),void 0!==t.credentials&&(this.V_=function(t){if(!t)return new Di;switch(t.type){case"gapi":var e=t.client;return ii(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Pi(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new di(pi.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},Dd.prototype.C_=function(){return this.P_},Dd.prototype.x_=function(){return this.y_=!0,this.P_},Dd.prototype._delete=function(){return this.S_||(this.S_=this.N_()),this.S_},Dd.prototype.N_=function(){return(t=Id.get(this))&&($r("ComponentProvider","Removing Datastore"),Id.delete(this),t.terminate()),Promise.resolve();var t},Dd),Td=(Object.defineProperty(Od.prototype,"k_",{get:function(){return this.O_.path},enumerable:!1,configurable:!0}),Object.defineProperty(Od.prototype,"id",{get:function(){return this.O_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(Od.prototype,"path",{get:function(){return this.O_.path.ot()},enumerable:!1,configurable:!0}),Object.defineProperty(Od.prototype,"parent",{get:function(){return new Ad(this.firestore,this.F_,this.O_.path.Z())},enumerable:!1,configurable:!0}),Od.prototype.withConverter=function(t){return new Od(this.firestore,t,this.O_)},Od),Nd=(Sd.prototype.withConverter=function(t){return new Sd(this.firestore,t,this.M_)},Sd),Ad=(h(xd,wd=Nd),Object.defineProperty(xd.prototype,"id",{get:function(){return this.M_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(xd.prototype,"path",{get:function(){return this.M_.path.ot()},enumerable:!1,configurable:!0}),Object.defineProperty(xd.prototype,"parent",{get:function(){var t=this.k_.Z();return t.nt()?null:new Td(this.firestore,null,new Ji(t))},enumerable:!1,configurable:!0}),xd.prototype.withConverter=function(t){return new xd(this.firestore,t,this.k_)},xd);function xd(t,e,n){var r=this;return(r=wd.call(this,t,e,_s(n))||this).firestore=t,r.k_=n,r.type="collection",r}function Sd(t,e,n){this.F_=e,this.M_=n,this.type="query",this.firestore=t}function Od(t,e,n){this.F_=e,this.O_=n,this.type="document",this.firestore=t}function Dd(t,e){this.R_="(lite)",this.P_=new Ed({}),this.y_=!1,t instanceof Ti?(this.g_=t,this.V_=new Di):(this.p_=t,this.g_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new di(pi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ti(t.options.projectId)}(t),this.V_=new ki(e))}function kd(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new di(pi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new di(pi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,dd("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Ld(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof vi&&(t=t._),ld("collection","path",e),t instanceof _d)return vd(n=Gi.ct.apply(Gi,f([e],r))),new Ad(t,null,n);if(!(t instanceof Td||t instanceof Ad))throw new di(pi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return vd(n=Gi.ct.apply(Gi,f([t.path],r)).child(Gi.ct(e))),new Ad(t.firestore,null,n)}function Pd(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof vi&&(t=t._),1===arguments.length&&(e=oi.t()),ld("doc","path",e),t instanceof _d)return yd(n=Gi.ct.apply(Gi,f([e],r))),new Td(t,null,new Ji(n));if(!(t instanceof Td||t instanceof Ad))throw new di(pi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return yd(n=t.k_.child(Gi.ct.apply(Gi,f([e],r)))),new Td(t.firestore,t instanceof Ad?t.F_:null,new Ji(n))}function Cd(t,e){return t instanceof vi&&(t=t._),e instanceof vi&&(e=e._),(t instanceof Td||t instanceof Ad)&&(e instanceof Td||e instanceof Ad)&&t.firestore===e.firestore&&t.path===e.path&&t.F_===e.F_}function Rd(t,e){return t instanceof vi&&(t=t._),e instanceof vi&&(e=e._),t instanceof Nd&&e instanceof Nd&&t.firestore===e.firestore&&Ls(t.M_,e.M_)&&t.F_===e.F_}var Md=(Object.defineProperty(Bd.prototype,"latitude",{get:function(){return this.L_},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"longitude",{get:function(){return this.B_},enumerable:!1,configurable:!0}),Bd.prototype.isEqual=function(t){return this.L_===t.L_&&this.B_===t.B_},Bd.prototype.toJSON=function(){return{latitude:this.L_,longitude:this.B_}},Bd.prototype.K=function(t){return ui(this.L_,t.L_)||ui(this.B_,t.B_)},Bd),Vd=/^__.*__$/,Ud=(jd.prototype.q_=function(t,e){return null!==this.zt?new vu(t,this.data,this.zt,e,this.fieldTransforms):new yu(t,this.data,e,this.fieldTransforms)},jd),Fd=(qd.prototype.q_=function(t,e){return new vu(t,this.data,this.zt,e,this.fieldTransforms)},qd);function qd(t,e,n){this.data=t,this.zt=e,this.fieldTransforms=n}function jd(t,e,n){this.data=t,this.zt=e,this.fieldTransforms=n}function Bd(t,e){if(!isFinite(t)||t<-90||90<t)throw new di(pi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new di(pi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.L_=t,this.B_=e}function Hd(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw ri()}}var Gd=(Object.defineProperty(Jd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Jd.prototype,"Q_",{get:function(){return this.settings.Q_},enumerable:!1,configurable:!0}),Jd.prototype.K_=function(t){return new Jd(Object.assign(Object.assign({},this.settings),t),this.T,this.Kt,this.ignoreUndefinedProperties,this.fieldTransforms,this.zt)},Jd.prototype.j_=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.K_({path:e,W_:!1});return e.G_(t),e},Jd.prototype.z_=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.K_({path:t,W_:!1});return t.U_(),t},Jd.prototype.H_=function(t){return this.K_({path:void 0,W_:!0})},Jd.prototype.J_=function(t){return Iy(t,this.settings.methodName,this.settings.Y_||!1,this.path,this.settings.X_)},Jd.prototype.contains=function(e){return void 0!==this.zt.find(function(t){return e.st(t)})||void 0!==this.fieldTransforms.find(function(t){return e.st(t.field)})},Jd.prototype.U_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.G_(this.path.get(t))},Jd.prototype.G_=function(t){if(0===t.length)throw this.J_("Document fields must not be empty");if(Hd(this.Q_)&&Vd.test(t))throw this.J_('Document fields cannot begin and end with "__"')},Jd),Kd=(zd.prototype.Z_=function(t,e,n,r){return void 0===r&&(r=!1),new Gd({Q_:t,methodName:e,X_:n,path:zi.at(),W_:!1,Y_:r},this.T,this.Kt,this.ignoreUndefinedProperties)},zd);function zd(t,e,n){this.T=t,this.ignoreUndefinedProperties=e,this.Kt=n||_l(t)}function Jd(t,e,n,r,i,o){this.settings=t,this.T=e,this.Kt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.U_(),this.fieldTransforms=i||[],this.zt=o||[]}function Wd(t){var e=t.x_(),n=_l(t.g_);return new Kd(t.g_,!!e.ignoreUndefinedProperties,n)}function Xd(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Z_(o.merge||o.mergeFields?2:0,e,n,i);my("Data must be an object, but it was:",s,r);var u,a,r=vy(r,s);if(o.merge)u=new ro(s.zt),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,f=o.mergeFields;h<f.length;h++){var l=by(e,f[h],n);if(!s.contains(l))throw new di(pi.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");_y(c,l)||c.push(l)}u=new ro(c),a=s.fieldTransforms.filter(function(t){return u.It(t.field)})}else u=null,a=s.fieldTransforms;return new Ud(new xo(r),u,a)}var Yd,Qd=(h(Zd,Yd=ad),Zd.prototype.tf=function(t){if(2!==t.Q_)throw 1===t.Q_?t.J_(this._methodName+"() can only appear at the top level of your update data"):t.J_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.zt.push(t.path),null},Zd.prototype.isEqual=function(t){return t instanceof Zd},Zd);function Zd(){return null!==Yd&&Yd.apply(this,arguments)||this}function $d(t,e,n){return new Gd({Q_:3,X_:e.settings.X_,methodName:t._methodName,W_:n},e.T,e.Kt,e.ignoreUndefinedProperties)}var ty,ey,ny,ry,iy=(h(fy,ry=ad),fy.prototype.tf=function(t){return new su(t.path,new Ks)},fy.prototype.isEqual=function(t){return t instanceof fy},fy),oy=(h(hy,ny=ad),hy.prototype.tf=function(t){var e=$d(this,t,!0),n=this.ef.map(function(t){return yy(t,e)}),n=new zs(n);return new su(t.path,n)},hy.prototype.isEqual=function(t){return this===t},hy),sy=(h(cy,ey=ad),cy.prototype.tf=function(t){var e=$d(this,t,!0),n=this.ef.map(function(t){return yy(t,e)}),n=new Qs(n);return new su(t.path,n)},cy.prototype.isEqual=function(t){return this===t},cy),uy=(h(ay,ty=ad),ay.prototype.tf=function(t){var e=new eu(t.Kt,js(t.Kt,this.nf));return new su(t.path,e)},ay.prototype.isEqual=function(t){return this===t},ay);function ay(t,e){var n=this;return(n=ty.call(this,t)||this).nf=e,n}function cy(t,e){var n=this;return(n=ey.call(this,t)||this).ef=e,n}function hy(t,e){var n=this;return(n=ny.call(this,t)||this).ef=e,n}function fy(){return null!==ry&&ry.apply(this,arguments)||this}function ly(t,r,i,e){var o=t.Z_(1,r,i);my("Data must be an object, but it was:",o,e);var s=[],u=new So;eo(e,function(t,e){var n=Ey(r,t,i);e instanceof vi&&(e=e._);t=o.z_(n);e instanceof Qd?s.push(n):null!=(t=yy(e,t))&&(s.push(n),u.set(n,t))});e=new ro(s);return new Fd(u.yt(),e,o.fieldTransforms)}function py(t,e,n,r,i,o){var s=t.Z_(1,e,n),u=[by(e,r,n)],a=[i];if(o.length%2!=0)throw new di(pi.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(by(e,o[c])),a.push(o[c+1]);for(var h,f,l,p=[],d=new So,y=u.length-1;0<=y;--y){_y(p,u[y])||(h=u[y],(f=a[y])instanceof vi&&(f=f._),l=s.z_(h),f instanceof Qd?p.push(h):null!=(l=yy(f,l))&&(p.push(h),d.set(h,l)))}i=new ro(p);return new Fd(d.yt(),i,s.fieldTransforms)}function dy(t,e,n,r){return void 0===r&&(r=!1),yy(n,t.Z_(r?4:3,e))}function yy(s,t){if(s instanceof vi&&(s=s._),gy(s))return my("Unsupported field value:",t,s),vy(s,t);if(s instanceof ad)return function(t,e){if(!Hd(e.Q_))throw e.J_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.J_(t._methodName+"() is not currently supported inside arrays");t=t.tf(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.zt.push(t.path),s instanceof Array){if(t.settings.W_&&4!==t.Q_)throw t.J_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=yy(i[r],t.H_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(t instanceof vi&&(t=t._),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return js(e.Kt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Bi.fromDate(t);return{timestampValue:ma(e.Kt,n)}}if(t instanceof Bi)return n=new Bi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ma(e.Kt,n)};if(t instanceof Md)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof yi)return{bytesValue:ba(e.Kt,t.l)};if(t instanceof Td){n=e.T;var r=t.firestore.g_;if(!r.isEqual(n))throw e.J_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ea(t.firestore.g_||e.T,t.O_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.J_("Unsupported field value: "+gd(t))}(s,t)}function vy(t,n){var r={};return no(t)?n.path&&0<n.path.length&&n.zt.push(n.path):eo(t,function(t,e){e=yy(e,n.j_(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function gy(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Bi||t instanceof Md||t instanceof yi||t instanceof Td||t instanceof ad)}function my(t,e,n){if(!gy(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=gd(n);throw"an object"===n?e.J_(t+" a custom object"):e.J_(t+" "+n)}var r}function by(t,e,n){if(e instanceof vi&&(e=e._),e instanceof ud)return e.A_;if("string"==typeof e)return Ey(t,e);throw Iy("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var wy=new RegExp("[~\\*/\\[\\]]");function Ey(e,n,r){if(0<=n.search(wy))throw Iy("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(ud.bind.apply(ud,f([void 0],n.split("."))))).A_}catch(t){throw Iy("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Iy(t,e,n,r,i){var o=r&&!r.nt(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new di(pi.INVALID_ARGUMENT,(e+=". ")+t+n)}function _y(t,e){return t.some(function(t){return t.isEqual(e)})}var Ty=(Oy.prototype.uf=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.hf(),0<this.mutations.length)throw new di(pi.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=xa((n=s).Kt)+"/documents",r={documents:u.map(function(t){return _a(n.Kt,t)})},[4,n.Fu("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.Kt,"found"in(t=t)?function(t,e){ii(!!e.found),e.found.name,e.found.updateTime;var n=Ta(t,e.found.name),t=wa(e.found.updateTime),e=new xo({mapValue:{fields:e.found.fields}});return new Co(n,t,e,{})}(e,t):"missing"in t?function(t,e){ii(!!e.missing),ii(!!e.readTime);t=Ta(t,e.missing),e=wa(e.readTime);return new Ro(t,e)}(e,t):ri());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){t=i.get(t.toString());ii(!!t),o.push(t)}),o)]}})})}(this.Nh,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Ro||t instanceof Co?n.lf(t):ri()}),e)]}})})},Oy.prototype.set=function(t,e){this.write(e.q_(t,this.Gt(t))),this.af.add(t.toString())},Oy.prototype.update=function(t,e){try{this.write(e.q_(t,this._f(t)))}catch(t){this.cf=t}this.af.add(t.toString())},Oy.prototype.delete=function(t){this.write(new xu(t,this.Gt(t))),this.af.add(t.toString())},Oy.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.hf(),this.cf)throw this.cf;return e=this.sf,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Ji.ft(e);n.mutations.push(new Su(e,n.Gt(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=xa((e=i).Kt)+"/documents",r={writes:o.map(function(t){return ka(e.Kt,t)})},[4,e.Du("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.Nh,this.mutations)];case 1:return t.sent(),this.rf=!0,[2]}})})},Oy.prototype.lf=function(t){var e;if(t instanceof Co)e=t.version;else{if(!(t instanceof Ro))throw ri();e=Hi.min()}var n=this.sf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new di(pi.ABORTED,"Document version changed between two reads.")}else this.sf.set(t.key.toString(),e)},Oy.prototype.Gt=function(t){var e=this.sf.get(t.toString());return!this.af.has(t.toString())&&e?uu.updateTime(e):uu.jt()},Oy.prototype._f=function(t){var e=this.sf.get(t.toString());if(this.af.has(t.toString())||!e)return uu.exists(!0);if(e.isEqual(Hi.min()))throw new di(pi.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return uu.updateTime(e)},Oy.prototype.write=function(t){this.hf(),this.mutations.push(t)},Oy.prototype.hf=function(){},Oy),Ny=(Sy.prototype.run=function(){this.df()},Sy.prototype.df=function(){var t=this;this.Yu.Qu(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Ty(this.Nh),(n=this.wf(e))&&n.then(function(t){r.fs.ys(function(){return e.commit().then(function(){r.Es.resolve(t)}).catch(function(t){r.Tf(t)})})}).catch(function(t){r.Tf(t)}),[2]})})})},Sy.prototype.wf=function(t){try{var e=this.updateFunction(t);return!fo(e)&&e.catch&&e.then?e:(this.Es.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Es.reject(t),null}},Sy.prototype.Tf=function(t){var e=this;0<this.ff&&this.Ef(t)?(--this.ff,this.fs.ys(function(){return e.df(),Promise.resolve()})):this.Es.reject(t)},Sy.prototype.Ef=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!ku(t)},Sy),Ay=(xy.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.N.promise];case 1:return[2,(t.sent(),{fs:this.fs,bu:this.bu,clientId:this.clientId,credentials:this.credentials,s_:this.user,Cl:100,xl:this.xl})]}})})},xy.prototype.mf=function(t){var e=this;this.If=t,this.N.promise.then(function(){return e.If(e.user)})},xy.prototype.Af=function(){if(this.fs.Rf)throw new di(pi.FAILED_PRECONDITION,"The client has already been terminated.")},xy.prototype.terminate=function(){var t=this;this.fs.Pf();var n=new Ha;return this.fs.yf(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.gf?[4,this.gf.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Vf?[4,this.Vf.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.D(),n.resolve(),[3,6];case 5:return e=t.sent(),e=ac(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},xy);function xy(t,e,n,r){var i=this;this.credentials=t,this.fs=e,this.bu=n,this.xl=r,this.user=Ni.UNAUTHENTICATED,this.clientId=oi.t(),this.If=function(){},this.N=new Ha,this.credentials.S(function(t){$r("FirestoreClient","Received user=",t.uid),i.user=t,i.If(t),i.N.resolve()})}function Sy(t,e,n,r){this.fs=t,this.Nh=e,this.updateFunction=n,this.Es=r,this.ff=5,this.Yu=new Sl(this.fs,"transaction_retry")}function Oy(t){this.Nh=t,this.sf=new Map,this.mutations=[],this.rf=!1,this.cf=null,this.af=new Set}function Dy(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return i.fs.pf(),$r("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.s_,i.mf(function(e){n.isEqual(e)||(n=e,i.fs.bo(function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,df(o.xh,e)];case 1:return t.sent(),[2]}})})}))}),o.persistence.yo(function(){return i.terminate()}),i.Vf=o,[2]}})})}function ky(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return r.fs.pf(),[4,Ly(r)];case 1:return e=t.sent(),$r("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.mf(function(t){return r.fs.bo(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).fs.pf(),$r("RemoteStore","RemoteStore received new credentials"),n=Jl(e),e.Mh.add(3),[4,ql(e)];case 1:return t.sent(),n&&e.Bh.set("Unknown"),[4,e.Fh.u_(i)];case 2:return t.sent(),e.Mh.delete(3),[4,Fl(e)];case 3:return t.sent(),[2]}})})}(i.vl,t)})}),r.gf=i,[2]}})})}function Ly(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.Vf?[3,2]:($r("FirestoreClient","Using default OfflineComponentProvider"),[4,Dy(e,new Yp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.Vf]}})})}function Py(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.gf?[3,2]:($r("FirestoreClient","Using default OnlineComponentProvider"),[4,ky(e,new $p)]);case 1:t.sent(),t.label=2;case 2:return[2,e.gf]}})})}function Cy(t){return Ly(t).then(function(t){return t.persistence})}function Ry(t){return Ly(t).then(function(t){return t.xh})}function My(t){return Py(t).then(function(t){return t.vl})}function Vy(t){return Py(t).then(function(t){return t.fa})}function Uy(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Py(r)];case 1:return e=t.sent(),[2,((n=e.Sl).Yh=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=Kp(s),(o=e.Ol.get(u))?(n=o.targetId,e.Dl.ka(n),r=o.view.pl(),[3,4]):[3,1];case 1:return[4,bf(e.xh,Ds(u))];case 2:return i=t.sent(),o=e.Dl.ka(i.targetId),n=i.targetId,[4,xp(e,u,n,"current"===o)];case 3:r=t.sent(),e.jl&&jl(e.vl,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.fa),n.tl=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ol.get(o),1<(r=e.kl.get(n.targetId)).length?[2,(e.kl.set(n.targetId,r.filter(function(t){return!Ls(t,o)})),void e.Ol.delete(o))]:e.jl?(e.Dl.$a(n.targetId),e.Dl.Ca(n.targetId)?[3,2]:[4,wf(e.xh,n.targetId,!1).then(function(){e.Dl.Ba(n.targetId),Bl(e.vl,n.targetId),Rp(e,n.targetId)}).catch(fh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Rp(e,n.targetId),[4,wf(e.xh,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.fa),n)]}})})}function Fy(n,r,i){var t=this;void 0===i&&(i={});var o=new Ha;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new od({next:function(t){r.ys(function(){return ap(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new di(pi.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new di(pi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new hp(_s(i.path),t,{includeMetadataChanges:!0,cl:!0});return up(n,u)},[4,Uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.fs,r,i,o])]}})})}),o.promise}function qy(n,r,i){var t=this;void 0===i&&(i={});var o=new Ha;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new od({next:function(t){n.ys(function(){return ap(e,s)}),t.fromCache&&"server"===r.source?i.reject(new di(pi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new hp(t,o,{includeMetadataChanges:!0,cl:!0});return up(e,s)},[4,Uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.fs,r,i,o])]}})})}),o.promise}var jy,By=(Object.defineProperty(Ky.prototype,"Rf",{get:function(){return this.Sf},enumerable:!1,configurable:!0}),Ky.prototype.ys=function(t){this.enqueue(t)},Ky.prototype.yf=function(t){this.Of(),this.kf(t)},Ky.prototype.Pf=function(){var t;this.Sf||(this.Sf=!0,(t=Il())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ff))},Ky.prototype.enqueue=function(t){return this.Of(),this.Sf?new Promise(function(t){}):this.kf(t)},Ky.prototype.bo=function(t){var e=this;this.ys(function(){return e.vf.push(t),e.Mf()})},Ky.prototype.Mf=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.vf.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.vf[0]()];case 2:return t.sent(),this.vf.shift(),this.Yu.reset(),[3,4];case 3:if(!tc(e=t.sent()))throw e;return $r("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.vf.length&&this.Yu.Qu(function(){return n.Mf()}),t.label=5;case 5:return[2]}})})},Ky.prototype.kf=function(t){var r=this,e=this.bf.then(function(){return r.xf=!0,t().catch(function(t){throw r.Cf=t,r.xf=!1,ti("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.xf=!1,t})});return this.bf=e},Ky.prototype.Ir=function(t,e,n){var r=this;this.Of(),-1<this.Nf.indexOf(t)&&(e=0);n=sc.Is(this,t,e,n,function(t){return r.$f(t)});return this.Df.push(n),n},Ky.prototype.Of=function(){this.Cf&&ri()},Ky.prototype.pf=function(){},Ky.prototype.Lf=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.bf];case 1:t.sent(),t.label=2;case 2:if(e!==this.bf)return[3,0];t.label=3;case 3:return[2]}})})},Ky.prototype.Bf=function(t){for(var e=0,n=this.Df;e<n.length;e++)if(n[e].ds===t)return!0;return!1},Ky.prototype.qf=function(r){var i=this;return this.Lf().then(function(){i.Df.sort(function(t,e){return t.ws-e.ws});for(var t=0,e=i.Df;t<e.length;t++){var n=e[t];if(n.Ps(),"all"!==r&&n.ds===r)break}return i.Lf()})},Ky.prototype.Uf=function(t){this.Nf.push(t)},Ky.prototype.$f=function(t){t=this.Df.indexOf(t);this.Df.splice(t,1)},Ky),Hy=(h(Gy,jy=_d),Gy.prototype.N_=function(){return this.jf||Jy(this),this.jf.terminate()},Gy);function Gy(t,e,n){var r=this;return(r=jy.call(this,t,e)||this).Qf=n,r.Kf=new By,r.R_="name"in t?t.name:"[DEFAULT]",r}function Ky(){var e=this;this.bf=Promise.resolve(),this.vf=[],this.Sf=!1,this.Df=[],this.Cf=null,this.xf=!1,this.Nf=[],this.Yu=new Sl(this,"async_queue_retry"),this.Ff=function(){var t=Il();t&&$r("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Yu.ju()};var t=Il();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ff)}function zy(t){return t.jf||Jy(t),t.jf.Af(),t.jf}function Jy(t){var e,n,r=t.x_(),r=(e=t.g_,n=t.R_,new _i(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.jf=new Ay(t.V_,t.Kf,r,t.Qf)}function Wy(n,r,i){var t=this,o=new Ha;return n.fs.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,Dy(n,i)];case 1:return t.sent(),[4,ky(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===pi.FAILED_PRECONDITION||t.code===pi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function Xy(t){if(t.b_||t.v_)throw new di(pi.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Yy,o=(ev.prototype.Wf=function(t,e){switch(void 0===e&&(e="none"),yo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return uo(t.integerValue||t.doubleValue);case 3:return this.Gf(t.timestampValue);case 4:return this.zf(t,e);case 5:return t.stringValue;case 6:return this.Hf(ao(t.bytesValue));case 7:return this.Jf(t.referenceValue);case 8:return this.Yf(t.geoPointValue);case 9:return this.Xf(t.arrayValue,e);case 10:return this.Zf(t.mapValue,e);default:throw ri()}},ev.prototype.Zf=function(t,n){var r=this,i={};return eo(t.fields||{},function(t,e){i[t]=r.Wf(e,n)}),i},ev.prototype.Yf=function(t){return new Md(uo(t.latitude),uo(t.longitude))},ev.prototype.Xf=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.Wf(t,e)})},ev.prototype.zf=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return co(e)?t(e):e}(t);return null==n?null:this.Wf(n,e);case"estimate":return this.Gf(ho(t));default:return null}},ev.prototype.Gf=function(t){t=so(t);return new Bi(t.seconds,t.nanos)},ev.prototype.td=function(t,e){var n=Gi.ct(t);ii(ja(n));t=new Ti(n.get(1),n.get(3)),n=new Ji(n.X(5));return t.isEqual(e)||ti("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},ev),Qy=(Object.defineProperty(tv.prototype,"id",{get:function(){return this.O_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(tv.prototype,"ref",{get:function(){return new Td(this.ed,this.F_,this.O_)},enumerable:!1,configurable:!0}),tv.prototype.exists=function(){return null!==this.sd},tv.prototype.data=function(){if(this.sd){if(this.F_){var t=new Zy(this.ed,this.nd,this.O_,this.sd,null);return this.F_.fromFirestore(t)}return this.nd.Wf(this.sd.vt())}},tv.prototype.get=function(t){if(this.sd){t=this.sd.data().field(nv("DocumentSnapshot.get",t));if(null!==t)return this.nd.Wf(t)}},tv),Zy=(h($y,Yy=Qy),$y.prototype.data=function(){return Yy.prototype.data.call(this)},$y);function $y(){return null!==Yy&&Yy.apply(this,arguments)||this}function tv(t,e,n,r,i){this.ed=t,this.nd=e,this.O_=n,this.sd=r,this.F_=i}function ev(){}function nv(t,e){return"string"==typeof e?Ey(t,e):(e instanceof vi?e._:e).A_}function rv(t){if(Ns(t)&&0===t.Nt.length)throw new di(pi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}Je=function(){};function iv(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){t=i[r].rd(t)}return t}var ov,sv,uv,av,cv,hv=(h(bv,cv=Je),bv.prototype.rd=function(t){var e=Wd(t.firestore),e=function(t,e,n,r,i,o){if(r.ht()){if("array-contains"===i||"array-contains-any"===i)throw new di(pi.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Iv(o,i);for(var s=[],u=0,a=o;u<a.length;u++){var c=a[u];s.push(Ev(n,t,c))}h={arrayValue:{values:s}}}else h=Ev(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Iv(o,i),h=dy(e,"where",o,"in"===i||"not-in"===i);var h=zo.create(r,i,h);return function(t,e){if(e.xt()){var n=xs(t);if(null!==n&&!n.isEqual(e.field))throw new di(pi.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=As(t);null!==n&&_v(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new di(pi.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new di(pi.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t.M_,e,t.firestore.g_,this.od,this.ad,this.ud);return new Nd(t.firestore,t.F_,(t=t.M_,e=t.filters.concat([e]),new Es(t.path,t.collectionGroup,t.Nt.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},bv),fv=(h(mv,av=Je),mv.prototype.rd=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new di(pi.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new di(pi.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new ms(e,n);return e=r,null!==As(n=t)||null!==(t=xs(n))&&_v(0,t,e.field),r}(t.M_,this.od,this.hd);return new Nd(t.firestore,t.F_,(t=t.M_,e=t.Nt.concat([e]),new Es(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},mv),lv=(h(gv,uv=Je),gv.prototype.rd=function(t){return new Nd(t.firestore,t.F_,ks(t.M_,this.ld,this._d))},gv),pv=(h(vv,sv=Je),vv.prototype.rd=function(t){var e=wv(t,this.type,this.fd,this.dd);return new Nd(t.firestore,t.F_,(t=t.M_,e=e,new Es(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},vv),dv=(h(yv,ov=Je),yv.prototype.rd=function(t){var e=wv(t,this.type,this.fd,this.dd);return new Nd(t.firestore,t.F_,(t=t.M_,e=e,new Es(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},yv);function yv(t,e,n){var r=this;return(r=ov.call(this)||this).type=t,r.fd=e,r.dd=n,r}function vv(t,e,n){var r=this;return(r=sv.call(this)||this).type=t,r.fd=e,r.dd=n,r}function gv(t,e,n){var r=this;return(r=uv.call(this)||this).type=t,r.ld=e,r._d=n,r}function mv(t,e){var n=this;return(n=av.call(this)||this).od=t,n.hd=e,n.type="orderBy",n}function bv(t,e,n){var r=this;return(r=cv.call(this)||this).od=t,r.ad=e,r.ud=n,r.type="where",r}function wv(t,c,e,n){if(e[0]instanceof vi&&(e[0]=e[0]._),e[0]instanceof Qy)return function(t,e,n,r){if(!n)throw new di(pi.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Os(t);o<s.length;o++){var u=s[o];if(u.field.ht())i.push(Eo(e,n.key));else{var a=n.field(u.field);if(co(a))throw new di(pi.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){u=u.field.ot();throw new di(pi.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}i.push(a)}}return new ls(i,r)}(t.M_,t.firestore.g_,e[0].sd,n);var r=Wd(t.firestore);return function(t,e,n,r,i,o){var s=t.Nt;if(i.length>s.length)throw new di(pi.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.ht()){if("string"!=typeof c)throw new di(pi.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ss(t)&&-1!==c.indexOf("/"))throw new di(pi.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Gi.ct(c));if(!Ji.Tt(h))throw new di(pi.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Ji(h);u.push(Eo(e,h))}else{c=dy(n,r,c);u.push(c)}}return new ls(u,o)}(t.M_,t.firestore.g_,r,c,e,n)}function Ev(t,e,n){if(n instanceof vi&&(n=n._),"string"==typeof n){if(""===n)throw new di(pi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ss(e)&&-1!==n.indexOf("/"))throw new di(pi.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(Gi.ct(n));if(!Ji.Tt(e))throw new di(pi.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Eo(t,new Ji(e))}if(n instanceof Td)return Eo(t,n.O_);throw new di(pi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+gd(n)+".")}function Iv(t,e){if(!Array.isArray(t)||0===t.length)throw new di(pi.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new di(pi.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function _v(t,e,n){if(!n.isEqual(e))throw new di(pi.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Tv(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}function Nv(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Av,xv,Sv,Ov=(h(Uv,Sv=o),Uv.prototype.Hf=function(t){return new yi(t)},Uv.prototype.Jf=function(t){t=this.td(t,this.firestore.g_);return new Td(this.firestore,null,t)},Uv),Dv=(Vv.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Vv),kv=(h(Mv,xv=Qy),Mv.prototype.exists=function(){return xv.prototype.exists.call(this)},Mv.prototype.data=function(t){if(void 0===t&&(t={}),this.sd){if(this.F_){var e=new Lv(this.ed,this.nd,this.O_,this.sd,this.metadata,null);return this.F_.fromFirestore(e,t)}return this.nd.Wf(this.sd.vt(),t.serverTimestamps)}},Mv.prototype.get=function(t,e){if(void 0===e&&(e={}),this.sd){t=this.sd.data().field(nv("DocumentSnapshot.get",t));if(null!==t)return this.nd.Wf(t,e.serverTimestamps)}},Mv),Lv=(h(Rv,Av=kv),Rv.prototype.data=function(t){return void 0===t&&(t={}),Av.prototype.data.call(this,t)},Rv),Pv=(Object.defineProperty(Cv.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Cv.prototype,"size",{get:function(){return this.Td.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Cv.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Cv.prototype.forEach=function(e,n){var r=this;this.Td.docs.forEach(function(t){e.call(n,new Lv(r.ed,r.nd,t.key,t,new Dv(r.Td.Ce.has(t.key),r.Td.fromCache),r.query.F_))})},Cv.prototype.docChanges=function(t){void 0===t&&(t={});t=!!t.includeMetadataChanges;if(t&&this.Td.Ne)throw new di(pi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Ed&&this.Id===t||(this.Ed=function(i,e){if(i.Td.De.nt()){var n=0;return i.Td.docChanges.map(function(t){var e=new Lv(i.ed,i.nd,t.doc.key,t.doc,new Dv(i.Td.Ce.has(t.doc.key),i.Td.fromCache),i.query.F_);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i.Td.De;return i.Td.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new Lv(i.ed,i.nd,t.doc.key,t.doc,new Dv(i.Td.Ce.has(t.doc.key),i.Td.fromCache),i.query.F_),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ri()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this,t),this.Id=t),this.Ed},Cv);function Cv(t,e,n,r){this.ed=t,this.nd=e,this.Td=r,this.metadata=new Dv(r.hasPendingWrites,r.fromCache),this.query=n}function Rv(){return null!==Av&&Av.apply(this,arguments)||this}function Mv(t,e,n,r,i,o){var s=this;return(s=xv.call(this,t,e,n,r,o)||this).ed=t,s.wd=t,s.metadata=i,s}function Vv(t,e){this.hasPendingWrites=t,this.fromCache=e}function Uv(t){var e=this;return(e=Sv.call(this)||this).firestore=t,e}function Fv(t,e){return t instanceof kv&&e instanceof kv?t.ed===e.ed&&t.O_.isEqual(e.O_)&&(null===t.sd?null===e.sd:t.sd.isEqual(e.sd))&&t.F_===e.F_:t instanceof Pv&&e instanceof Pv&&t.ed===e.ed&&Rd(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.Td.isEqual(e.Td)}var qv,jv=(h(Bv,qv=o),Bv.prototype.Hf=function(t){return new yi(t)},Bv.prototype.Jf=function(t){t=this.td(t,this.firestore.g_);return new Td(this.firestore,null,t)},Bv);function Bv(t){var e=this;return(e=qv.call(this)||this).firestore=t,e}function Hv(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=md(t,Td);var o=md(t.firestore,Hy),s=Wd(o);return e instanceof vi&&(e=e._),Kv(o,[("string"==typeof e||e instanceof ud?py(s,"updateDoc",t.O_,e,n,r):ly(s,"updateDoc",t.O_,e)).q_(t.O_,uu.exists(!0))])}function Gv(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e instanceof vi&&(e=e._);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||Tv(n[i])||(r=n[i],i++);var o,s,u,a,c,h,f={includeMetadataChanges:r.includeMetadataChanges};return Tv(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof Td?(u=md(e.firestore,Hy),a=_s(e.O_.path),h={next:function(t){n[i]&&n[i](zv(u,e,t))},error:n[i+1],complete:n[i+2]}):(s=md(e,Nd),u=md(s.firestore,Hy),a=s.M_,c=new jv(u),h={next:function(t){n[i]&&n[i](new Pv(u,c,s,t))},error:n[i+1],complete:n[i+2]},rv(e.M_)),function(n,t,e){var r=this,i=new od(h),o=new hp(t,i,e);return n.fs.ys(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=up,[4,Uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.l_(),n.fs.ys(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=ap,[4,Uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(zy(u),a,f)}function Kv(t,e){return function(n,r){var t=this,i=new Ha;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Sp,[4,Vy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(zy(t),e)}function zv(t,e,n){var r=n.docs.get(e.O_),i=new jv(t);return new kv(t,i,e.O_,r,new Dv(n.hasPendingWrites,n.fromCache),e.F_)}var Jv=(Wv.prototype.set=function(t,e,n){this.yd();t=Xv(t,this.ed),e=Nv(t.F_,e,n),n=Xd(this.Pd,"WriteBatch.set",t.O_,e,null!==t.F_,n);return this.Ad.push(n.q_(t.O_,uu.jt())),this},Wv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.yd();t=Xv(t,this.ed);return e instanceof vi&&(e=e._),e="string"==typeof e||e instanceof ud?py(this.Pd,"WriteBatch.update",t.O_,e,n,r):ly(this.Pd,"WriteBatch.update",t.O_,e),this.Ad.push(e.q_(t.O_,uu.exists(!0))),this},Wv.prototype.delete=function(t){this.yd();t=Xv(t,this.ed);return this.Ad=this.Ad.concat(new xu(t.O_,uu.jt())),this},Wv.prototype.commit=function(){return this.yd(),this.Rd=!0,0<this.Ad.length?this.md(this.Ad):Promise.resolve()},Wv.prototype.yd=function(){if(this.Rd)throw new di(pi.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Wv);function Wv(t,e){this.ed=t,this.md=e,this.Ad=[],this.Rd=!1,this.Pd=Wd(t)}function Xv(t,e){if(t instanceof vi&&(t=t._),t.firestore!==e)throw new di(pi.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Yv,Qv,Zv,$v=(ug.prototype.get=function(t){var e=this,n=Xv(t,this.ed),r=new Ov(this.ed);return this.gd.uf([n.O_]).then(function(t){if(!t||1!==t.length)return ri();t=t[0];if(t instanceof Ro)return new Qy(e.ed,r,n.O_,null,n.F_);if(t instanceof Co)return new Qy(e.ed,r,t.key,t,n.F_);throw ri()})},ug.prototype.set=function(t,e,n){t=Xv(t,this.ed),e=Nv(t.F_,e,n),n=Xd(this.Pd,"Transaction.set",t.O_,e,null!==t.F_,n);return this.gd.set(t.O_,n),this},ug.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Xv(t,this.ed);return e instanceof vi&&(e=e._),e="string"==typeof e||e instanceof ud?py(this.Pd,"Transaction.update",t.O_,e,n,r):ly(this.Pd,"Transaction.update",t.O_,e),this.gd.update(t.O_,e),this},ug.prototype.delete=function(t){t=Xv(t,this.ed);return this.gd.delete(t.O_),this},h(sg,Zv=ug),sg.prototype.get=function(t){var e=this,n=Xv(t,this.ed),r=new jv(this.ed);return Zv.prototype.get.call(this,t).then(function(t){return new kv(e.ed,r,n.O_,t.sd,new Dv(!1,!1),n.F_)})},sg),tg=(og.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Xy(t=md(t,Hy));var n=zy(t),r=t.x_(),t=new $p;return Wy(n,t,new Qp(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._,{forceOwnership:e})},og.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Xy(t=md(t,Hy));var e=zy(t),n=t.x_(),t=new $p;return Wy(e,t,new Zp(t,n.cacheSizeBytes))}(t._)},og.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n.b_&&!n.v_)throw new di(pi.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new Ha;return n.Kf.yf(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return za.jn()?(e=n+"main",[4,za.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(nf(n.g_,n.R_))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t._)},og),eg=(h(ig,Qv=vi),Object.defineProperty(ig.prototype,"g_",{get:function(){return this._.g_},enumerable:!1,configurable:!0}),ig.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._.C_()),t)).merge,this._.D_(t)},ig.prototype.useEmulator=function(t,e){var n,r;n=this._,r=t,t=e,"firestore.googleapis.com"!==(e=(n=md(n,_d)).C_()).host&&e.host!==r&&ei("Host has been set in both settings() and useEmulator(), emulator host will be used"),n.D_(Object.assign(Object.assign({},e),{host:r+":"+t,ssl:!1}))},ig.prototype.enableNetwork=function(){return function(r){var t=this;return r.fs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Cy(r)];case 1:return e=t.sent(),[4,My(r)];case 2:return n=t.sent(),[2,(e.Vo(!0),(t=n).Mh.delete(0),Fl(t))]}})})})}(zy(md(this._,Hy)))},ig.prototype.disableNetwork=function(){return function(r){var t=this;return r.fs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Cy(r)];case 1:return e=t.sent(),[4,My(r)];case 2:return n=t.sent(),[2,(e.Vo(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Mh.add(0),[4,ql(e)];case 1:return t.sent(),e.Bh.set("Offline"),[2]}})})}(n))]}})})})}(zy(md(this._,Hy)))},ig.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&dd("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Vd.enableMultiTabIndexedDbPersistence(this):this.Vd.enableIndexedDbPersistence(this,n)},ig.prototype.clearPersistence=function(){return this.Vd.clearIndexedDbPersistence(this)},ig.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._._delete()},ig.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new Ha;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Lp,[4,Vy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(zy(md(this._,Hy)))},ig.prototype.onSnapshotsInSync=function(t){return e=this._,t=t,function(n,t){var e=this,r=new od(t);return n.fs.ys(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Jh.add(e),e.next()},[4,Uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.l_(),n.fs.ys(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Jh.delete(e)},[4,Uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(zy(md(e,Hy)),Tv(t)?t:{next:t});var e},Object.defineProperty(ig.prototype,"app",{get:function(){if(!this.pd)throw new di(pi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.pd},enumerable:!1,configurable:!0}),ig.prototype.collection=function(t){try{return new kg(this,Ld(this._,t))}catch(t){throw gg(t,"collection()","Firestore.collection()")}},ig.prototype.doc=function(t){try{return new pg(this,Pd(this._,t))}catch(t){throw gg(t,"doc()","Firestore.doc()")}},ig.prototype.collectionGroup=function(t){try{return new Sg(this,function(t,e){if(t=md(t,_d),ld("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new di(pi.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Nd(t,null,(e=e,new Es(Gi.at(),e)))}(this._,t))}catch(t){throw gg(t,"collectionGroup()","Firestore.collectionGroup()")}},ig.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new Ha;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,Py(n).then(function(t){return t.Nh})];case 1:return e=t.sent(),new Ny(n.fs,e,r,i).run(),[2]}})})}),i.promise}(zy(n=this._),function(t){return t=new $v(n,t),e(new fg(r,t))})},ig.prototype.batch=function(){var e=this;return zy(this._),new lg(new Jv(this._,function(t){return Kv(e._,t)}))},ig.prototype.loadBundle=function(t){throw new di(pi.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},ig.prototype.namedQuery=function(t){throw new di(pi.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},ig),ng=(h(rg,Yv=o),rg.prototype.Hf=function(t){return new Ii(new yi(t))},rg.prototype.Jf=function(t){t=this.td(t,this.firestore.g_);return pg.bd(t,this.firestore,null)},rg);function rg(t){var e=this;return(e=Yv.call(this)||this).firestore=t,e}function ig(t,e,n){var r=this;return(r=Qv.call(this,e)||this).Vd=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof Ti||(r.pd=t),r}function og(){}function sg(t,e){var n=this;return(n=Zv.call(this,t,e)||this).ed=t,n}function ug(t,e){this.ed=t,this.gd=e,this.Pd=Wd(t)}var ag,cg,hg,fg=(h(vg,hg=vi),vg.prototype.get=function(t){var e=this,n=Ug(t);return this._.get(n).then(function(t){return new Ag(e.ed,new kv(e.ed._,e.nd,t.O_,t.sd,t.metadata,n.F_))})},vg.prototype.set=function(t,e,n){t=Ug(t);return n?(pd("Transaction.set",n),this._.set(t,e,n)):this._.set(t,e),this},vg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Ug(t);return 2===arguments.length?this._.update(o,e):(t=this._).update.apply(t,f([o,e,n],r)),this},vg.prototype.delete=function(t){t=Ug(t);return this._.delete(t),this},vg),lg=(h(yg,cg=vi),yg.prototype.set=function(t,e,n){t=Ug(t);return n?(pd("WriteBatch.set",n),this._.set(t,e,n)):this._.set(t,e),this},yg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Ug(t);return 2===arguments.length?this._.update(o,e):(t=this._).update.apply(t,f([o,e,n],r)),this},yg.prototype.delete=function(t){t=Ug(t);return this._.delete(t),this},yg.prototype.commit=function(){return this._.commit()},yg),pg=(h(dg,ag=vi),dg.vd=function(t,e,n){if(t.length%2!=0)throw new di(pi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.ot()+" has "+t.length);return new dg(e,new Td(e._,n,new Ji(t)))},dg.bd=function(t,e,n){return new dg(e,new Td(e._,n,t))},Object.defineProperty(dg.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(dg.prototype,"parent",{get:function(){return new kg(this.firestore,this._.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(dg.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),dg.prototype.collection=function(t){try{return new kg(this.firestore,Ld(this._,t))}catch(t){throw gg(t,"collection()","DocumentReference.collection()")}},dg.prototype.isEqual=function(t){return t instanceof vi&&(t=t._),t instanceof Td&&Cd(this._,t)},dg.prototype.set=function(t,e){e=pd("DocumentReference.set",e);try{return function(t,e,n){t=md(t,Td);var r=md(t.firestore,Hy),e=Nv(t.F_,e,n);return Kv(r,[Xd(Wd(r),"setDoc",t.O_,e,null!==t.F_,n).q_(t.O_,uu.jt())])}(this._,t,e)}catch(t){throw gg(t,"setDoc()","DocumentReference.set()")}},dg.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Hv(this._,t):Hv.apply(void 0,f([this._,t,e],n))}catch(t){throw gg(t,"updateDoc()","DocumentReference.update()")}},dg.prototype.delete=function(){return Kv(md((t=this._).firestore,Hy),[new xu(t.O_,uu.jt())]);var t},dg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=mg(t),i=bg(t,function(t){return new Ag(e.firestore,new kv(e.firestore._,e.nd,t.O_,t.sd,t.metadata,e._.F_))});return Gv(this._,r,i)},dg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=md(e,Td);var n=md(e.firestore,Hy),t=zy(n),r=new jv(n);return function(n,r){var t=this,i=new Ha;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(o,s,u){return y(this,void 0,void 0,function(){var r,i;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Ic.Jo(t,e)}))];case 1:return(i=t.sent())instanceof Co?u.resolve(i):i instanceof Ro?u.resolve(null):u.reject(new di(pi.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=ac(r,"Failed to get document '"+s+" from cache"),u.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,Ry(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e.O_).then(function(t){return new kv(n,r,e.O_,t,new Dv(t instanceof Co&&t.bt,!0),e.F_)})}:"server"===(null==t?void 0:t.source)?function(e){e=md(e,Td);var n=md(e.firestore,Hy);return Fy(zy(n),e.O_,{source:"server"}).then(function(t){return zv(n,e,t)})}:function(e){e=md(e,Td);var n=md(e.firestore,Hy);return Fy(zy(n),e.O_).then(function(t){return zv(n,e,t)})})(this._).then(function(t){return new Ag(e.firestore,new kv(e.firestore._,e.nd,t.O_,t.sd,t.metadata,e._.F_))})},dg.prototype.withConverter=function(t){return new dg(this.firestore,this._.withConverter(t))},dg);function dg(t,e){var n=this;return(n=ag.call(this,e)||this).firestore=t,n.nd=new ng(t),n}function yg(){return null!==cg&&cg.apply(this,arguments)||this}function vg(t,e){var n=this;return(n=hg.call(this,e)||this).ed=t,n.nd=new ng(t),n}function gg(t,e,n){return t.message=t.message.replace(e,n),t}function mg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Tv(r))return r}return{}}function bg(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=Tv(t[0])?t[0]:Tv(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var wg,Eg,Ig,_g,Tg,Ng,Ag=(h(Vg,Ng=vi),Object.defineProperty(Vg.prototype,"ref",{get:function(){return new pg(this.ed,this._.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(Vg.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(Vg.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Vg.prototype,"exists",{get:function(){return this._.exists()},enumerable:!1,configurable:!0}),Vg.prototype.data=function(t){return this._.data(t)},Vg.prototype.get=function(t,e){return this._.get(t,e)},Vg.prototype.isEqual=function(t){return Fv(this._,t._)},Vg),xg=(h(Mg,Tg=Ag),Mg.prototype.data=function(t){return this._.data(t)},Mg),Sg=(h(Rg,_g=vi),Rg.prototype.where=function(t,e,n){try{return new Rg(this.firestore,iv(this._,(r=n,i=e,o=nv("where",t),new hv(o,i,r))))}catch(t){throw gg(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},Rg.prototype.orderBy=function(n,t){try{return new Rg(this.firestore,iv(this._,function(t){void 0===t&&(t="asc");var e=t,t=nv("orderBy",n);return new fv(t,e)}(t)))}catch(n){throw gg(n,/(orderBy|where)\(\)/,"Query.$1()")}},Rg.prototype.limit=function(t){try{return new Rg(this.firestore,iv(this._,(bd("limit",e=t),new lv("limit",e,"F"))))}catch(t){throw gg(t,"limit()","Query.limit()")}var e},Rg.prototype.limitToLast=function(t){try{return new Rg(this.firestore,iv(this._,(bd("limitToLast",e=t),new lv("limitToLast",e,"L"))))}catch(t){throw gg(t,"limitToLast()","Query.limitToLast()")}var e},Rg.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Rg(this.firestore,iv(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new pv("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw gg(t,"startAt()","Query.startAt()")}},Rg.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Rg(this.firestore,iv(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new pv("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw gg(t,"startAfter()","Query.startAfter()")}},Rg.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Rg(this.firestore,iv(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new dv("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw gg(t,"endBefore()","Query.endBefore()")}},Rg.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Rg(this.firestore,iv(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new dv("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw gg(t,"endAt()","Query.endAt()")}},Rg.prototype.isEqual=function(t){return Rd(this._,t._)},Rg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=md(e,Nd);var n=md(e.firestore,Hy),t=zy(n),r=new jv(n);return function(n,r){var t=this,i=new Ha;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Ef(i,o,!0)];case 1:return r=t.sent(),e=new Ep(o,r.Pc),n=e.Il(r.documents),n=e.Ti(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=ac(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,Ry(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e.M_).then(function(t){return new Pv(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=md(e,Nd);var n=md(e.firestore,Hy),t=zy(n),r=new jv(n);return qy(t,e.M_,{source:"server"}).then(function(t){return new Pv(n,r,e,t)})}:function(e){e=md(e,Nd);var n=md(e.firestore,Hy),t=zy(n),r=new jv(n);return rv(e.M_),qy(t,e.M_).then(function(t){return new Pv(n,r,e,t)})})(this._).then(function(t){return new Dg(e.firestore,new Pv(e.firestore._,e.nd,e._,t.Td))})},Rg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=mg(t),i=bg(t,function(t){return new Dg(e.firestore,new Pv(e.firestore._,e.nd,e._,t.Td))});return Gv(this._,r,i)},Rg.prototype.withConverter=function(t){return new Rg(this.firestore,this._.withConverter(t))},Rg),Og=(h(Cg,Ig=vi),Object.defineProperty(Cg.prototype,"type",{get:function(){return this._.type},enumerable:!1,configurable:!0}),Object.defineProperty(Cg.prototype,"doc",{get:function(){return new xg(this.ed,this._.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Cg.prototype,"oldIndex",{get:function(){return this._.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Cg.prototype,"newIndex",{get:function(){return this._.newIndex},enumerable:!1,configurable:!0}),Cg),Dg=(h(Pg,Eg=vi),Object.defineProperty(Pg.prototype,"query",{get:function(){return new Sg(this.ed,this._.query)},enumerable:!1,configurable:!0}),Object.defineProperty(Pg.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Pg.prototype,"size",{get:function(){return this._.size},enumerable:!1,configurable:!0}),Object.defineProperty(Pg.prototype,"empty",{get:function(){return this._.empty},enumerable:!1,configurable:!0}),Object.defineProperty(Pg.prototype,"docs",{get:function(){var e=this;return this._.docs.map(function(t){return new xg(e.ed,t)})},enumerable:!1,configurable:!0}),Pg.prototype.docChanges=function(t){var e=this;return this._.docChanges(t).map(function(t){return new Og(e.ed,t)})},Pg.prototype.forEach=function(e,n){var r=this;this._.forEach(function(t){e.call(n,new xg(r.ed,t))})},Pg.prototype.isEqual=function(t){return Fv(this._,t._)},Pg),kg=(h(Lg,wg=Sg),Object.defineProperty(Lg.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(Lg.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Object.defineProperty(Lg.prototype,"parent",{get:function(){var t=this._.parent;return t?new pg(this.firestore,t):null},enumerable:!1,configurable:!0}),Lg.prototype.doc=function(t){try{return new pg(this.firestore,void 0===t?Pd(this._):Pd(this._,t))}catch(t){throw gg(t,"doc()","CollectionReference.doc()")}},Lg.prototype.add=function(t){var e,n,r,i=this;return e=this._,n=t,t=md(e.firestore,Hy),r=Pd(e),n=Nv(e.F_,n),Kv(t,[Xd(Wd(e.firestore),"addDoc",r.O_,n,null!==e.F_,{}).q_(r.O_,uu.exists(!1))]).then(function(){return r}).then(function(t){return new pg(i.firestore,t)})},Lg.prototype.isEqual=function(t){return Cd(this._,t._)},Lg.prototype.withConverter=function(t){return new Lg(this.firestore,this._.withConverter(t))},Lg);function Lg(t,e){var n=this;return(n=wg.call(this,t,e)||this).firestore=t,n._=e,n}function Pg(t,e){var n=this;return(n=Eg.call(this,e)||this).ed=t,n}function Cg(t,e){var n=this;return(n=Ig.call(this,e)||this).ed=t,n}function Rg(t,e){var n=this;return(n=_g.call(this,e)||this).firestore=t,n.nd=new ng(t),n}function Mg(){return null!==Tg&&Tg.apply(this,arguments)||this}function Vg(t,e){var n=this;return(n=Ng.call(this,e)||this).ed=t,n}function Ug(t){return t instanceof vi&&(t=t._),md(t,Td)}var Fg,qg,Je=(h(Gg,qg=vi),Gg.documentId=function(){return new Gg(zi.lt().ot())},Gg.prototype.isEqual=function(t){return t instanceof vi&&(t=t._),t instanceof ud&&this._.A_.isEqual(t.A_)},Gg),o=(h(Hg,Fg=vi),Hg.serverTimestamp=function(){var t=new iy("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Hg(t)},Hg.delete=function(){var t=new Qd("deleteField");return t._methodName="FieldValue.delete",new Hg(t)},Hg.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new oy("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new Hg(n)},Hg.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sy("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new Hg(n)},Hg.increment=function(t){t=new uy("increment",t);return t._methodName="FieldValue.increment",new Hg(t)},Hg.prototype.isEqual=function(t){return this._.isEqual(t._)},Hg),jg=(Bg.prototype.onProgress=function(t,e,n){this.Sd={next:t,error:e,complete:n}},Bg.prototype.catch=function(t){return this.Dd.promise.catch(t)},Bg.prototype.then=function(t,e){return this.Dd.promise.then(t,e)},Bg.prototype.zl=function(t){this.Hl(t),this.Sd.complete&&this.Sd.complete(),this.Dd.resolve(t)},Bg.prototype.Yl=function(t){this.Cd.taskState="Error",this.Sd.next&&this.Sd.next(this.Cd),this.Sd.error&&this.Sd.error(t),this.Dd.reject(t)},Bg.prototype.Hl=function(t){this.Cd=t,this.Sd.next&&this.Sd.next(t)},Bg);function Bg(){this.Sd={},this.Dd=new Ha,this.Cd={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Hg(){return null!==Fg&&Fg.apply(this,arguments)||this}function Gg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return qg.call(this,new(ud.bind.apply(ud,f([void 0],t))))||this}function Kg(t,s){var e=new jg;return function(n,t,r){var e,i=this,o=(e=s,t=_l(t),e=function(t){if(t instanceof Uint8Array)return id(t,void 0);if(t instanceof ArrayBuffer)return id(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new sd(e,t));n.fs.ys(function(){return y(i,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Jp,[4,Vy(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(zy(t._),t.g_,e),e}var zg=(Jg.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Jg.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Jg.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Jg);function Jg(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Wg,Xg,Yg={Firestore:eg,GeoPoint:Md,Timestamp:Bi,Blob:Ii,Transaction:fg,WriteBatch:lg,DocumentReference:pg,DocumentSnapshot:Ag,Query:Sg,QueryDocumentSnapshot:xg,QuerySnapshot:Dg,CollectionReference:kg,FieldPath:Je,FieldValue:o,setLogLevel:function(t){Qr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(Wg=e.default).INTERNAL.registerComponent(new zg("firestore",function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new eg(e,new Hy(e,t),new tg)},"PUBLIC").setServiceProps(Object.assign({},Yg))),Wg.registerVersion("@firebase/firestore","2.1.2-longpoll.66863f547"),(Xg=eg).prototype.loadBundle=function(t){return Kg(this,t)},Xg.prototype.namedQuery=function(t){return t=t,function(n,r){var t=this;return n.fs.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.To.Ls(t,e)})},[4,Ry(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(zy((e=this)._),t).then(function(t){return t?new Sg(e,new Nd(e._,null,t.query)):null});var e}}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
