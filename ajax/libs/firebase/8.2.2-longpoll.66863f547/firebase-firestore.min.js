!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Og){"use strict";try{(function(){var l,t,e=(t=Og)&&"object"==typeof t&&"default"in t?t:{default:t};function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=u[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(je=l=l||{})[je.DEBUG=0]="DEBUG",je[je.VERBOSE=1]="VERBOSE",je[je.INFO=2]="INFO",je[je.WARN=3]="WARN",je[je.ERROR=4]="ERROR",je[je.SILENT=5]="SILENT";var r={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},i=l.INFO,u=((Be={})[l.DEBUG]="log",Be[l.VERBOSE]="log",Be[l.INFO]="info",Be[l.WARN]="warn",Be[l.ERROR]="error",Be),o=(Object.defineProperty(a.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),a.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?r[t]:t},Object.defineProperty(a.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),a.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},a.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},a.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},a.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},a.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},a);function a(t){this.name=t,this._logLevel=i,this._logHandler=n,this._userLogHandler=null}var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function h(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function f(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,g="FirebaseError",m=(h(b,d=Error),b);function b(t,e,n){return(e=d.call(this,e)||this).code=t,e.customData=n,e.name=g,Object.setPrototypeOf(e,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,w.prototype.create),e}var w=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=(t=this.errors[t])?(r=i,t.replace(I,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I=/\{\$([^}]+)}/g,_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function T(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=N||self;function x(){}function S(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var D="closure_uid_"+(1e9*Math.random()>>>0),k=0;function L(t,e,n){return t.call.apply(t.bind,arguments)}function P(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:P).apply(null,arguments)}function R(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function M(){return Date.now()}function V(t,o){function e(){}e.prototype=o.prototype,t.Y=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Kb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}var U=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function q(){return Array.prototype.concat.apply([],arguments)}function j(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function B(t){return/^[\s\xa0]*$/.test(t)}var H=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function G(t,e){return-1!=t.indexOf(e)}function K(t,e){return t<e?-1:e<t?1:0}var z=A.navigator;function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function W(t){var e,n={};for(e in t)n[e]=t[e];return n}st=(z=z&&z.userAgent)?z:"";var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<X.length;i++)e=X[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Q(t){return Q[" "](t),t}Q[" "]=x;var Z,$=G(st,"Opera"),tt=G(st,"Trident")||G(st,"MSIE"),et=G(st,"Edge"),nt=et||tt,rt=G(st,"Gecko")&&!(G(st.toLowerCase(),"webkit")&&!G(st,"Edge"))&&!(G(st,"Trident")||G(st,"MSIE"))&&!G(st,"Edge"),it=G(st.toLowerCase(),"webkit")&&!G(st,"Edge");function ot(){var t=A.document;return t?t.documentMode:void 0}var z="",st=(st=st,rt?/rv:([^\);]+)(\)|;)/.exec(st):et?/Edge\/([\d\.]+)/.exec(st):tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):it?/WebKit\/(\S+)/.exec(st):$?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);st&&(z=st?st[1]:""),Z=tt&&null!=(st=ot())&&st>parseFloat(z)?String(st):z;var ut={};function at(u){return t=u,e=function(){for(var t=0,e=H(String(Z)).split("."),n=H(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=K(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||K(0==o[2].length,0==s[2].length)||K(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=ut,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var ct=A.document&&tt&&(ot()||parseInt(Z,10))||void 0;function ht(t,e,n){this.reset(t,e,n,void 0,void 0)}function ft(t){this.g=t,this.a=this.f=this.b=this.c=null}function lt(t,e){this.name=t,this.value=e}ht.prototype.a=null,ht.prototype.reset=function(t,e,n,r,i){this.c=r||M(),this.f=t,this.g=e,this.b=n,delete this.a},lt.prototype.toString=function(){return this.name};var pt=new lt("SEVERE",1e3),dt=new lt("WARNING",900),yt=new lt("INFO",800),vt=new lt("CONFIG",700),gt=new lt("FINE",500);ft.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.b||(e.c?t(e.c):null)}(this).value)for("function"==typeof e&&(e=e()),t=new ht(t,String(e),this.g),n&&(t.a=n),n=this;n;){var r=n,i=t;if(r.a)for(var o=0;e=r.a[o];o++)e(i);n=n.c}},ft.prototype.info=function(t,e){this.log(yt,t,e)};var mt={},bt=null;function wt(t){var e,n,r;return bt||(bt=new ft(""),(mt[""]=bt).b=vt),(e=mt[t])||(e=new ft(t),r=t.lastIndexOf("."),n=t.substr(r+1),(r=wt(t.substr(0,r))).f||(r.f={}),(r.f[n]=e).c=r,mt[t]=e),e}function Et(){this.a=M()}var It=null;function _t(t){this.f=t||"",It=It||new Et,this.g=It}function Tt(t){return t<10?"0"+t:String(t)}function Nt(t){_t.call(this,t)}function At(t,e){t&&t.log(dt,e,void 0)}function xt(t,e){t&&t.info(e,void 0)}function St(t,e){t&&t.log(gt,e,void 0)}function Ot(){this.g=C(this.c,this),this.a=new Nt,this.a.b=!1,this.a.c=!1,this.b=this.a.a=!1,this.f={}}Et.prototype.set=function(t){this.a=t},Et.prototype.reset=function(){this.set(M())},Et.prototype.get=function(){return this.a},_t.prototype.a=!0,_t.prototype.b=!0,_t.prototype.c=!1,V(Nt,_t),Ot.prototype.c=function(t){var e,n,r,i;this.f[t.b]||(e=this.a,n=t,(i=[]).push(e.f," "),e.b&&(r=new Date(n.c),i.push("[",Tt(r.getFullYear()-2e3)+Tt(r.getMonth()+1)+Tt(r.getDate())+" "+Tt(r.getHours())+":"+Tt(r.getMinutes())+":"+Tt(r.getSeconds())+"."+Tt(Math.floor(r.getMilliseconds()/10)),"] ")),i.push("[",function(t,e){e=(t=(t.c-e)/1e3).toFixed(3);var n=0;if(t<1)n=2;else for(;t<100;)n++,t*=10;for(;0<n--;)e=" "+e;return e}(n,e.g.get()),"s] "),i.push("[",n.b,"] "),i.push(n.g),e.c&&(n=n.a)&&i.push("\n",n instanceof Error?n.message:n.toString()),e.a&&i.push("\n"),n=i.join(""),Dt&&(e=function(t){if(t){if(t.value>=pt.value)return"error";if(t.value>=dt.value)return"warn";if(t.value>=vt.value)return"log"}return"debug"}(t.f),i=Dt,t=t.a,i[e]?i[e](n,t||""):i.log(n,t||"")))};var Dt=A.console;function kt(){this.m=this.m,this.j=this.j}kt.prototype.m=!1,kt.prototype.ja=function(){!this.m&&(this.m=!0,this.H(),0)&&(Object.prototype.hasOwnProperty.call(this,D)&&this[D]||(this[D]=++k))},kt.prototype.H=function(){if(this.j)for(;this.j.length;)this.j.shift()()};var Lt=!tt||9<=Number(ct),Pt=tt&&!at("9"),Ct=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",x,e),A.removeEventListener("test",x,e)}catch(t){}return t}();function Rt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Mt(t,e){if(Rt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(rt){t:{try{Q(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Vt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Rt.prototype.b=function(){this.defaultPrevented=!0},V(Mt,Rt);var Vt={2:"touch",3:"pen",4:"mouse"};Mt.prototype.b=function(){Mt.Y.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Pt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Ut="closure_listenable_"+(1e6*Math.random()|0),Ft=0;function qt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Ft,this.Z=this.$=!1}function jt(t){t.Z=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Bt(t){this.src=t,this.a={},this.b=0}function Ht(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=U(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(jt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Gt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Z&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Bt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Gt(t,e,r,i);return-1<s?(e=t[s],n||(e.$=!1)):((e=new qt(e,this.src,o,!!r,i)).$=n,t.push(e)),e};var Kt="closure_lm_"+(1e6*Math.random()|0),zt={};function Jt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=ee(r),e&&e[Ut]?e.wa(n,r,O(i)?!!i.capture:!!i,o):Wt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Jt(t,e[o],n,r,i);return null}return n=ee(n),t&&t[Ut]?t.va(e,n,O(r)?!!r.capture:!!r,i):Wt(t,e,n,!1,r,i)}function Wt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!Lt)return null;var u,a,c=$t(t);if(c||(t[Kt]=c=new Bt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=Zt,r=a=Lt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Ct||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Yt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Xt(t){var e,n,r;"number"!=typeof t&&t&&!t.Z&&((e=t.src)&&e[Ut]?Ht(e.f,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Yt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=$t(e))?(Ht(n,t),0==n.b&&(n.src=null,e[Kt]=null)):jt(t)))}function Yt(t){return t in zt?zt[t]:zt[t]="on"+t}function Qt(t,e){var n=t.listener,r=t.ca||t.src;return t.$&&Xt(t),n.call(r,e)}function Zt(t,e){if(t.Z)return!0;if(Lt)return Qt(t,new Mt(e,this));if(!e)t:{e=["window","event"];for(var n=A,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Qt(t,e=new Mt(e,this))}function $t(t){return(t=t[Kt])instanceof Bt?t:null}var te="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[te]||(e[te]=function(t){return e.handleEvent(t)}),e[te])}function ne(){kt.call(this),this.f=new Bt(this),(this.L=this).F=null}function re(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.L,r=e.type||e,"string"==typeof e?e=new Rt(e,t):e instanceof Rt?e.target=e.target||t:(s=e,Y(e=new Rt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=ie(o,r,!0,e)&&s;if(s=ie(o=e.a=t,r,!0,e)&&s,s=ie(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=ie(o=e.a=n[i],r,!1,e)&&s}function ie(t,e,n,r){if(!(e=t.f.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Z&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.$&&Ht(t.f,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}V(ne,kt),ne.prototype[Ut]=!0,(st=ne.prototype).addEventListener=function(t,e,n,r){Jt(this,t,e,n,r)},st.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=ee(r),e&&e[Ut]?(e=e.f,(n=String(n).toString())in e.a&&-1<(r=Gt(s=e.a[n],r,i,o))&&(jt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&$t(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Gt(n,r,i,o)),(r=-1<e?n[e]:null)&&Xt(r))}(this,t,e,n,r)},st.H=function(){if(ne.Y.H.call(this),this.f){var t,e=this.f;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)jt(n[r]);delete e.a[t],e.b--}}this.F=null},st.va=function(t,e,n,r){return this.f.add(String(t),e,!1,n,r)},st.wa=function(t,e,n,r){return this.f.add(String(t),e,!0,n,r)};var oe=A.JSON.stringify;function se(){this.b=this.a=null}var ue,ae=(ce.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new ce(function(){return new he},function(t){t.reset()}));function ce(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function he(){this.next=this.b=this.a=null}function fe(t,e){var n;ue||(n=A.Promise.resolve(void 0),ue=function(){n.then(de)}),le||(ue(),le=!0),pe.add(t,e)}se.prototype.add=function(t,e){var n=ae.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},he.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var le=!(he.prototype.reset=function(){this.next=this.b=this.a=null}),pe=new se;function de(){for(var t,e;n=e=void 0,n=null,(e=pe).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){A.setTimeout(function(){throw t},0)}(t)}var n=ae;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}le=!1}function ye(t,e){ne.call(this),this.b=t||1,this.a=e||A,this.c=C(this.Za,this),this.g=M()}function ve(t){t.aa=!1,t.O&&(t.a.clearTimeout(t.O),t.O=null)}function ge(t,e,n){if("function"==typeof t)n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}V(ye,ne),(st=ye.prototype).aa=!1,st.O=null,st.Za=function(){var t;this.aa&&(0<(t=M()-this.g)&&t<.8*this.b?this.O=this.a.setTimeout(this.c,this.b-t):(this.O&&(this.a.clearTimeout(this.O),this.O=null),re(this,"tick"),this.aa&&(ve(this),this.start())))},st.start=function(){this.aa=!0,this.O||(this.O=this.a.setTimeout(this.c,this.b),this.g=M())},st.H=function(){ye.Y.H.call(this),ve(this),delete this.a};var me,be,we=(_(be=Ie,z=me=kt),be.prototype=null===z?Object.create(z):(Ee.prototype=z.prototype,new Ee),Ie.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=ge(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},Ie.prototype.H=function(){me.prototype.H.call(this),this.a&&(A.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},Ie);function Ee(){this.constructor=be}function Ie(t,e){var n=me.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function _e(t){kt.call(this),this.b=t,this.a={}}V(_e,kt);var Te=[];function Ne(t,e,n,r){Array.isArray(n)||(n&&(Te[0]=n.toString()),n=Te);for(var i=0;i<n.length;i++){var o=Jt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Ae(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Xt(t)},t),t.a={}}function xe(){this.a=wt("goog.labs.net.webChannel.WebChannelDebug"),this.b=!0}function Se(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.b)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(var r=0;r<n.length;r++)if(Array.isArray(n[r])){var i=n[r];if(!(i.length<2)){var o=i[1];if(Array.isArray(o)&&!(o.length<1)&&"noop"!=(i=o[0])&&"stop"!=i&&"close"!=i)for(var s=1;s<o.length;s++)o[s]=""}}return oe(n)}catch(n){return Oe(t,"Exception parsing expected JS array - probably was not JS"),e}}(t,n)+(r?" "+r:"")})}function Oe(t,e){St(t.a,e)}function De(t,e,n){(t=t.a)&&t.log(pt,n||"Exception",e)}function ke(t,e){(t=t.a)&&t.log(pt,e,void 0)}_e.prototype.H=function(){_e.Y.H.call(this),Ae(this)},_e.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},xe.prototype.info=function(t){xt(this.a,t)};var Le={},Pe=null;function Ce(){return Pe=Pe||new ne}function Re(t){Rt.call(this,Le.Fa,t)}function Me(){var t=Ce();re(t,new Re(t))}function Ve(t,e){Rt.call(this,Le.STAT_EVENT,t),this.stat=e}function Ue(t){var e=Ce();re(e,new Ve(e,t))}function Fe(t){Rt.call(this,Le.Ga,t)}function qe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}Le.Fa="serverreachability",V(Re,Rt),Le.STAT_EVENT="statevent",V(Ve,Rt),Le.Ga="timingevent",V(Fe,Rt);var je={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Be={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function He(){}function Ge(t){var e;return(e=t.a)||(e=t.a={}),e}function Ke(){}He.prototype.a=null;var ze,N={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Je(){Rt.call(this,"d")}function We(){Rt.call(this,"c")}function Xe(){}function Ye(t,e,n,r){this.g=t,this.b=e,this.c=n,this.S=r||1,this.J=new _e(this),this.P=Qe,t=nt?125:void 0,this.R=new ye(t),this.A=null,this.f=!1,this.m=this.i=this.j=this.G=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.l=null,this.K=-1,this.v=!1,this.L=0,this.F=null,this.X=this.C=this.W=this.I=!1}V(Je,Rt),V(We,Rt),V(Xe,He),ze=new Xe;var Qe=45e3,Ze={},$e={};function tn(t,e,n){t.G=1,t.j=In(vn(e)),t.m=n,t.I=!0,en(t,null)}function en(t,e){t.u=M(),rn(t),t.i=vn(t.j);var s,u,a,c,h,f,n=t.i,r=t.S;Array.isArray(r)||(r=[String(r)]),Rn(n.b,"t",r),t.D=0,t.a=Or(t.g,t.g.F?e:null),0<t.L&&(t.F=new we(C(t.Ca,t,t.a),t.L)),Ne(t.J,t.a,"readystatechange",t.Xa),e=t.A?W(t.A):{},t.m?(t.l||(t.l="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.i,t.l,t.m,e)):(t.l="GET",t.a.ba(t.i,t.l,null,e)),Me(),s=t.b,u=t.l,a=t.i,c=t.c,h=t.S,f=t.m,s.info(function(){if(s.b)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function nn(t,e,n){for(var r,i,o,s=!0;!t.v&&t.D<n.length;){var u=(u=n,o=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?$e:(i=Number(u.substring(i,o)),isNaN(i)?Ze:(o+=1)+i>u.length?$e:(u=u.substr(o,i),r.D=o+i,u)));if(u==$e){4==e&&(t.h=4,Ue(14),s=!1),Se(t.b,t.c,null,"[Incomplete Response]");break}if(u==Ze){t.h=4,Ue(15),Se(t.b,t.c,n,"[Invalid Chunk]"),s=!1;break}Se(t.b,t.c,u,null),cn(t,u)}4==e&&0==n.length&&(t.h=1,Ue(16),s=!1),t.f=t.f&&s,s?0<n.length&&!t.X&&(t.X=!0,(e=t.g).b==t&&e.W&&!e.I&&(e.a.info("Great, no buffering proxy detected. Bytes received: "+n.length),Er(e),e.I=!0,Ue(11))):(Se(t.b,t.c,n,"[Invalid Chunked Response]"),an(t),un(t))}function rn(t){t.T=M()+t.P,on(t,t.P)}function on(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=qe(C(t.Va,t),e)}function sn(t){t.o&&(A.clearTimeout(t.o),t.o=null)}function un(t){0==t.g.B||t.v||Tr(t.g,t)}function an(t){sn(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ve(t.R),Ae(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function cn(t,e){try{var n,r,i,o,s=t.g;if(0!=s.B&&(s.b==t||Bn(s.f,t)))if(s.C=t.K,!t.C&&Bn(s.f,t)&&3==s.B){try{var u=s.ka.a.parse(e)}catch(e){u=null}if(Array.isArray(u)&&3==u.length){var a=u;if(0==a[0])t:if(Oe(s.a,"Server claims our backchannel is missing."),s.j)Oe(s.a,"But we are currently starting the request.");else{if(s.b){if(!(s.b.u+3e3<t.u))break t;_r(s),lr(s)}else At(s.a.a,"We do not have a BackChannel established");wr(s),Ue(18)}else{s.oa=a[1];var c,h=s.oa-s.P;0<h&&(c=a[2],Oe(s.a,c+" bytes (in "+h+" arrays) are outstanding on the BackChannel"),c<37500&&s.J&&0==s.o&&!s.l&&(s.l=qe(C(s.Sa,s),6e3)))}if(jn(s.f)<=1&&s.ea){try{s.ea()}catch(e){De(s.a,e,"Exception from forwardChannelFlushedCallback_ ")}s.ea=void 0}}else Oe(s.a,"Bad POST response data returned"),Ar(s,11)}else if(!t.C&&s.b!=t||_r(s),!B(e))for(h=u=s.ka.a.parse(e),c=0;c<h.length;c++)a=h[c],s.P=a[0],a=a[1],2==s.B?"c"==a[0]?(s.K=a[1],s.ga=a[2],null!=(n=a[3])&&(s.ha=n,s.a.info("VER="+s.ha)),null!=(i=a[4])&&(s.pa=i,s.a.info("SVER="+s.pa)),null!=(n=a[5])&&"number"==typeof n&&0<n&&(e=1.5*n,s.G=e,s.a.info("backChannelRequestTimeoutMs_="+e)),e=s,(i=t.a)&&(!(n=i.a?i.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(r=e.f).a&&(G(n,"spdy")||G(n,"quic")||G(n,"h2"))&&(r.f=r.g,r.a=new Set,r.b&&(Hn(r,r.b),r.b=null)),e.v&&((o=i.a?i.a.getResponseHeader("X-HTTP-Session-Id"):null)?(e.na=o,En(e.A,e.v,o)):At(e.a.a,"Missing X_HTTP_SESSION_ID in the handshake response"))),s.B=3,s.g&&s.g.ta(),s.W&&(s.D=M()-t.u,s.a.info("Handshake RTT: "+s.D+"ms")),u=t,r=e=s,o=Sr(i=e,i.F?e.ga:null,e.fa),Oe(i.a,"GetBackChannelUri: "+o),r.la=o,u.C?(Oe(e.a,"Upgrade the handshake request to a backchannel."),Gn(e.f,u),r=u,(o=e.G)&&r.setTimeout(o),r.o&&(sn(r),rn(r)),e.b=u):br(e),0<s.c.length&&yr(s)):"stop"!=a[0]&&"close"!=a[0]||Ar(s,7):3==s.B&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?Ar(s,7):fr(s):"noop"!=a[0]&&s.g&&s.g.sa(a),s.o=0);Me()}catch(e){De(t.b,e,"Error in httprequest callback")}}function hn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(S(t)||"string"==typeof t)F(t,e,void 0);else{if(t.N&&"function"==typeof t.N)var n=t.N();else if(t.M&&"function"==typeof t.M)n=void 0;else if(S(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.M&&"function"==typeof t.M)return t.M();if("string"==typeof t)return t.split("");if(S(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function fn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof fn)for(n=t.N(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ln(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(st=Ye.prototype).setTimeout=function(t){this.P=t},st.Xa=function(t){t=t.target;var e=this.F;e&&3==sr(t)?(Oe(this.b,"Throttling readystatechange."),e.f()):this.Ca(t)},st.Ca=function(t){try{t==this.a?function(t){var e,n,r,i,o,s,u,a=sr(t.a),c=t.a.ua(),h=t.a.V();if(!(a<3||3==a&&!nt&&!t.a.U())){t.v||4!=a||7==c||Me(),sn(t);var f=t.a.V();if(t.K=f,(c=t.a.U())||Oe(t.b,function(){return"No response text for uri "+t.i+" status "+f}),t.f=200==f,e=t.b,n=t.l,r=t.i,i=t.c,o=t.S,s=a,u=f,e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+o+"]: "+n+"\n"+r+"\n"+s+" "+u}),t.f){if(t.W&&!t.C){if(!(h=(e=t).a&&(e=(e=e.a).a?e.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(e)?e:null))return t.f=!1,t.h=3,Ue(12),At(t.b.a,"XMLHTTP Missing X_HTTP_INITIAL_RESPONSE ("+t.c+")"),an(t),un(t);Se(t.b,t.c,h,"Initial handshake response via X-HTTP-Initial-Response"),t.C=!0,cn(t,h)}t.I?(nn(t,a,c),nt&&t.f&&3==a&&(Ne((h=t).J,h.R,"tick",h.Wa),h.R.start())):(Se(t.b,t.c,c,null),cn(t,c)),4==a&&an(t),t.f&&!t.v&&(4==a?Tr(t.g,t):(t.f=!1,rn(t)))}else 400==f&&0<c.indexOf("Unknown SID")?(t.h=3,Ue(12),At(t.b.a,"XMLHTTP Unknown SID ("+t.c+")")):(t.h=0,Ue(13),At(t.b.a,"XMLHTTP Bad status "+f+" ("+t.c+")")),an(t),un(t)}}(this):At(this.b.a,"Called back with an unexpected xmlhttp")}catch(t){var e;Oe(this.b,"Failed call to OnXmlHttpReadyStateChanged_"),this.a&&this.a.U()?De((e=this).b,t,function(){return"ResponseText: "+e.a.U()}):De(this.b,t,"No response text")}},st.Wa=function(){var t,e;this.a&&(t=sr(this.a),e=this.a.U(),this.D<e.length&&(sn(this),nn(this,t,e),this.f&&4!=t&&rn(this)))},st.cancel=function(){this.v=!0,an(this)},st.Va=function(){this.o=null;var t,e,n=M();0<=n-this.T?(this.f&&ke(this.b,"Received watchdog timeout even though request loaded successfully"),t=this.b,e=this.i,t.info(function(){return"TIMEOUT: "+e}),2!=this.G&&(Me(),Ue(17)),an(this),this.h=2,un(this)):(At(this.b.a,"WatchDog timer called too early"),on(this,this.T-n))},(st=fn.prototype).M=function(){ln(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},st.N=function(){return ln(this),this.a.concat()},st.get=function(t,e){return pn(this.b,t)?this.b[t]:e},st.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},st.forEach=function(t,e){for(var n=this.N(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof yn?(this.a=void 0!==e?e:t.a,gn(this,t.f),this.j=t.j,mn(this,t.c),bn(this,t.h),this.g=t.g,e=t.b,(n=new kn).c=e.c,e.a&&(n.a=new fn(e.a),n.b=e.b),wn(this,n),this.i=t.i):t&&(n=String(t).match(dn))?(this.a=!!e,gn(this,n[1]||"",!0),this.j=_n(n[2]||""),mn(this,n[3]||"",!0),bn(this,n[4]),this.g=_n(n[5]||"",!0),wn(this,n[6]||"",!0),this.i=_n(n[7]||"")):(this.a=!!e,this.b=new kn(null,this.a))}function vn(t){return new yn(t)}function gn(t,e,n){t.f=n?_n(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function mn(t,e,n){t.c=n?_n(e,!0):e}function bn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function wn(t,e,n){var r,i;e instanceof kn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(Ln(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Pn(this,e),Rn(this,n,t))},r)),r.f=i):(n||(e=Tn(e,On)),t.b=new kn(e,t.a))}function En(t,e,n){t.b.set(e,n)}function In(t){return En(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^M()).toString(36)),t}function _n(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Nn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Nn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Tn(e,An,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Tn(e,An,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Tn(n,"/"==n.charAt(0)?Sn:xn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Tn(n,Dn)),t.join("")};var An=/[#\/\?@]/g,xn=/[#\?:]/g,Sn=/[#\?]/g,On=/[#\?@]/g,Dn=/#/g;function kn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Ln(o){o.a||(o.a=new fn,o.b=0,o.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",o.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(o.c))}function Pn(t,e){Ln(t),e=Mn(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ln(t)))}function Cn(t,e){return Ln(t),e=Mn(t,e),pn(t.a.b,e)}function Rn(t,e,n){Pn(t,e),0<n.length&&(t.c=null,t.a.set(Mn(t,e),j(n)),t.b+=n.length)}function Mn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(st=kn.prototype).add=function(t,e){Ln(this),this.c=null,t=Mn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},st.forEach=function(n,r){Ln(this),this.a.forEach(function(t,e){F(t,function(t){n.call(r,t,e,this)},this)},this)},st.N=function(){Ln(this);for(var t=this.a.M(),e=this.a.N(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},st.M=function(t){Ln(this);var e=[];if("string"==typeof t)Cn(this,t)&&(e=q(e,this.a.get(Mn(this,t))));else{t=this.a.M();for(var n=0;n<t.length;n++)e=q(e,t[n])}return e},st.set=function(t,e){return Ln(this),this.c=null,Cn(this,t=Mn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},st.get=function(t,e){return t&&0<(t=this.M(t)).length?String(t[0]):e},st.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.N(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.M(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};function Vn(t,e){this.b=t,this.a=e}function Un(t){this.g=t||Fn,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ia&&A.ia.ya&&A.ia.ya()&&A.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Fn=10;function qn(t){return t.b||t.a&&t.a.size>=t.f}function jn(t){return t.b?1:t.a?t.a.size:0}function Bn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Hn(t,e){t.a?t.a.add(e):t.b=e}function Gn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Kn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return j(t.c);var r=t.c;try{for(var i=T(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function zn(){}function Jn(){this.a=new zn}function Wn(t,e,n,r,i){try{Oe(t,n),e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(e){De(t,e)}}Un.prototype.cancel=function(){var t,e;if(this.c=Kn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=T(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},zn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},zn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var Xn=A.JSON.parse;function Yn(t){ne.call(this),this.headers=new fn,this.I=t||null,this.c=!1,this.A=this.a=null,this.J=this.s="",this.i=0,this.g="",this.h=this.D=this.o=this.C=!1,this.l=0,this.u=null,this.K=Qn,this.v=this.G=!1}V(Yn,ne);var Qn="";Yn.prototype.b=wt("goog.net.XhrIo");var Zn=/^https?$/i,$n=["POST","PUT"];function tr(t){return"content-type"==t.toLowerCase()}function er(t,e){t.c=!1,t.a&&(t.h=!0,t.a.abort(),t.h=!1),t.g=e,t.i=5,nr(t),ir(t)}function nr(t){t.C||(t.C=!0,re(t,"complete"),re(t,"error"))}function rr(t){if(t.c)if(t.A[1]&&4==sr(t)&&2==t.V())St(t.b,ur(t,"Local request error detected and ignored"));else if(t.o&&4==sr(t))ge(t.za,0,t);else if(re(t,"readystatechange"),4==sr(t)){St(t.b,ur(t,"Request complete")),t.c=!1;try{var e,n,r,i,o=t.V();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.s).match(dn)[1]||null)&&A.self&&A.self.location&&(i=(r=A.self.location.protocol).substr(0,r.length-1)),n=!Zn.test(i?i.toLowerCase():"")),e=n),e)re(t,"complete"),re(t,"success");else{t.i=6;try{var u=2<sr(t)?t.a.statusText:""}catch(o){St(t.b,"Can not get status: "+o.message),u=""}t.g=u+" ["+t.V()+"]",nr(t)}}finally{ir(t)}}}function ir(t,e){if(t.a){or(t);var n=t.a,r=t.A[0]?x:null;t.a=null,t.A=null,e||re(t,"ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(pt,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function or(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(A.clearTimeout(t.u),t.u=null)}function sr(t){return t.a?t.a.readyState:0}function ur(t,e){return e+" ["+t.J+" "+t.s+" "+t.V()+"]"}function ar(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):En(t,e,n))}function cr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function hr(t){this.pa=0,this.c=[],this.a=new xe,this.ga=this.la=this.A=this.fa=this.b=this.na=this.v=this.X=this.i=this.L=this.m=null,this.Oa=this.R=0,this.La=cr("failFast",!1,t),this.J=this.l=this.j=this.h=this.g=null,this.S=!0,this.C=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=cr("baseRetryDelayMs",5e3,t),this.Ra=cr("retryDelaySeedMs",1e4,t),this.Ma=cr("forwardChannelMaxRetries",2,t),this.ma=cr("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.G=void 0,this.F=t&&t.supportsCrossDomainXhr||!1,this.K="",this.f=new Un(t&&t.concurrentRequestLimit),this.ka=new Jn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.a.b=!1),t&&t.forceLongPolling&&(this.S=!1),this.W=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.D=0,this.I=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.a.info("Opt-in to enable Chrome Origin Trials.")}function fr(t){var e,n;Oe(t.a,"disconnect()"),pr(t),3==t.B&&(e=t.R++,En(n=vn(t.A),"SID",t.K),En(n,"RID",e),En(n,"TYPE","terminate"),gr(t,n),(e=new Ye(t,t.a,e,void 0)).G=2,e.j=In(vn(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.j.toString(),"")),!n&&A.Image&&((new Image).src=e.j,n=!0),n||(e.a=Or(e.g,null),e.a.ba(e.j)),e.u=M(),rn(e)),xr(t)}function lr(t){t.b&&(Er(t),t.b.cancel(),t.b=null)}function pr(t){lr(t),t.j&&(A.clearTimeout(t.j),t.j=null),_r(t),t.f.cancel(),t.h&&("number"==typeof t.h&&A.clearTimeout(t.h),t.h=null)}function dr(t,e){1e3==t.c.length&&ke(t.a,function(){return"Already have 1000 queued maps upon queueing "+oe(e)}),t.c.push(new Vn(t.Oa++,e)),3==t.B&&yr(t)}function yr(t){qn(t.f)||t.h||(t.h=!0,fe(t.Ba,t),t.u=0)}function vr(t,e){var n=e?e.c:t.R++,r=vn(t.A);En(r,"SID",t.K),En(r,"RID",n),En(r,"AID",t.P),gr(t,r),t.i&&t.m&&ar(r,t.i,t.m),n=new Ye(t,t.a,n,t.u+1),null===t.i&&(n.A=t.m),e&&(t.c=e.s.concat(t.c)),e=mr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Hn(t.f,n),tn(n,r,e)}function gr(t,n){t.g&&hn({},function(t,e){En(n,e,t)})}function mr(t,e,n){n=Math.min(t.c.length,n);var r=t.g?C(t.g.Ja,t.g,t):null;t:for(var i=t.c,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r){var i="req"+c+"_"||"";try{hn(t,function(t,e){var n=t;O(t)&&(n=oe(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s)}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.c.splice(0,n),e.s=t,r}function br(t){t.b||t.j||(t.T=1,fe(t.Aa,t),t.o=0)}function wr(t){return t.b||t.j?(ke(t.a,"Request already in progress"),0):!(3<=t.o)&&(Oe(t.a,"Going to retry GET"),t.T++,t.j=qe(C(t.Aa,t),Nr(t,t.o)),t.o++,1)}function Er(t){null!=t.s&&(Oe(t.a,"Cancel the BP detection timer."),A.clearTimeout(t.s),t.s=null)}function Ir(t){Oe(t.a,"Creating new HttpRequest"),t.b=new Ye(t,t.a,"rpc",t.T),null===t.i&&(t.b.A=t.m),t.b.L=0;var e=vn(t.la);En(e,"RID","rpc"),En(e,"SID",t.K),En(e,"CI",t.J?"0":"1"),En(e,"AID",t.P),gr(t,e),En(e,"TYPE","xmlhttp"),t.i&&t.m&&ar(e,t.i,t.m),t.G&&t.b.setTimeout(t.G);var n=t.b,r=t.ga;n.G=1,n.j=In(vn(e)),n.m=null,n.I=!0,en(n,r),Oe(t.a,"New Request created")}function _r(t){null!=t.l&&(A.clearTimeout(t.l),t.l=null)}function Tr(t,e){Oe(t.a,"Request complete");var n,r,i=null;if(t.b==e){_r(t),Er(t),t.b=null;var o=2}else{if(!Bn(t.f,e))return;i=e.s,Gn(t.f,e),o=1}if(t.C=e.K,0!=t.B)if(e.f)1==o?(e.m&&e.m.length,M(),e.u,n=t.u,re(r=Ce(),new Fe(r)),yr(t)):br(t);else{var s=e.h;if(3==s||0==s&&0<t.C)Oe(t.a,"Not retrying due to error type");else{if(Oe(t.a,function(){return"Maybe retrying, last error: "+function(t){switch(s){case 0:return"Non-200 return code ("+t+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}(t.C)}),1==o&&(n=e,jn((e=t).f)>=e.f.f-(e.h?1:0)?(ke(e.a,"Unexpected retry request is scheduled."),0):e.h?(Oe(e.a,"Use the retry request that is already scheduled."),e.c=n.s.concat(e.c),1):!(1==e.B||2==e.B||e.u>=(e.La?0:e.Ma))&&(Oe(e.a,"Going to retry POST"),e.h=qe(C(e.Ba,e,n),Nr(e,e.u)),e.u++,1))||2==o&&wr(t))return;Oe(t.a,"Exceeded max number of retries")}switch(i&&0<i.length&&((o=t.f).c=o.c.concat(i)),Oe(t.a,"Error: HTTP request failed"),s){case 1:Ar(t,5);break;case 4:Ar(t,10);break;case 3:Ar(t,6);break;default:Ar(t,2)}}}function Nr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.g||(Oe(t.a,"Inactive channel"),n*=2),n*e}function Ar(t,e){var n,r,i,o;t.a.info("Error code "+e),2==e?(r=null,t.g&&(r=null),o=C(t.Ya,t),r||(r=new yn("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||gn(r,"https"),In(r)),n=r.toString(),r=o,Oe(o=new xe,"TestLoadImage: loading "+n),A.Image?((i=new Image).onload=R(Wn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=R(Wn,o,i,"TestLoadImage: error",!1,r),i.onabort=R(Wn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=R(Wn,o,i,"TestLoadImage: timeout",!1,r),A.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):Ue(2),Oe(t.a,"HttpChannel: error - "+e),t.B=0,t.g&&t.g.ra(e),xr(t),pr(t)}function xr(t){var e;t.B=0,t.C=-1,t.g&&(0==(e=Kn(t.f)).length&&0==t.c.length||(Oe(t.a,function(){return"Number of undelivered maps, pending: "+e.length+", outgoing: "+t.c.length}),t.f.c.length=0,j(t.c),t.c.length=0),t.g.qa())}function Sr(t,e,n){var r,i,o,s,u,a=(s=n)instanceof yn?vn(s):new yn(s,void 0);return""!=a.c?(e&&mn(a,e+"."+a.c),bn(a,a.h)):(r=(u=A.location).protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new yn(null,void 0),r&&gn(u,r),i&&mn(u,i),o&&bn(u,o),s&&(u.g=s),a=u),t.X&&J(t.X,function(t,e){En(a,e,t)}),e=t.v,n=t.na,e&&n&&En(a,e,n),En(a,"VER",t.ha),gr(t,a),a}function Or(t,e){if(e&&!t.F)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Yn(t.Na)).G=t.F,e}function Dr(){}function kr(){if(tt&&!(10<=Number(ct)))throw Error("Environmental error: no available transport.")}function Lr(t,e){ne.call(this),this.a=new hr(e),this.c=t,this.b=wt("goog.labs.net.webChannel.WebChannelBaseTransport"),this.g=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.m=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.L=t,(t=e&&e.httpHeadersOverwriteParam)&&!B(t)&&(this.a.i=t),this.s=e&&e.supportsCrossDomainXhr||!1,this.o=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!B(e)&&(this.a.v=e,null!==(t=this.g)&&e in t&&(e in(t=this.g)&&delete t[e],At(this.b,"Ignore httpSessionIdParam also specified with messageUrlParams: "+e))),this.h=new Rr(this)}function Pr(t){Je.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Cr(){We.call(this),this.status=1}function Rr(t){this.a=t}(st=Yn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.s+"; newUri="+t);e=e?e.toUpperCase():"GET",this.s=t,this.g="",this.i=0,this.J=e,this.C=!1,this.c=!0,this.a=new XMLHttpRequest,this.A=this.I?Ge(this.I):Ge(ze),this.a.onreadystatechange=C(this.za,this);try{St(this.b,ur(this,"Opening Xhr")),this.D=!0,this.a.open(e,String(t),!0),this.D=!1}catch(t){return St(this.b,ur(this,"Error opening Xhr: "+t.message)),void er(this,t)}t=n||"";var i,o=new fn(this.headers);r&&hn(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=tr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.N()),n=A.FormData&&t instanceof A.FormData,0<=U($n,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.K&&(this.a.responseType=this.K),"withCredentials"in this.a&&this.a.withCredentials!==this.G&&(this.a.withCredentials=this.G);try{or(this),0<this.l&&(this.v=(i=this.a,tt&&at(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout),St(this.b,ur(this,"Will abort after "+this.l+"ms if incomplete, xhr2 "+this.v)),this.v?(this.a.timeout=this.l,this.a.ontimeout=C(this.xa,this)):this.u=ge(this.xa,this.l,this)),St(this.b,ur(this,"Sending request")),this.o=!0,this.a.send(t),this.o=!1}catch(t){St(this.b,ur(this,"Send error: "+t.message)),er(this,t)}},st.xa=function(){this.a&&(this.g="Timed out after "+this.l+"ms, aborting",this.i=8,St(this.b,ur(this,this.g)),re(this,"timeout"),this.abort(8))},st.abort=function(t){this.a&&this.c&&(St(this.b,ur(this,"Aborting")),this.c=!1,this.h=!0,this.a.abort(),this.h=!1,this.i=t||7,re(this,"complete"),re(this,"abort"),ir(this))},st.H=function(){this.a&&(this.c&&(this.c=!1,this.h=!0,this.a.abort(),this.h=!1),ir(this,!0)),Yn.Y.H.call(this)},st.za=function(){this.m||(this.D||this.o||this.h?rr(this):this.Ua())},st.Ua=function(){rr(this)},st.V=function(){try{return 2<sr(this)?this.a.status:-1}catch(t){return-1}},st.U=function(){try{return this.a?this.a.responseText:""}catch(t){return St(this.b,"Can not get responseText: "+t.message),""}},st.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Xn(e)}},st.ua=function(){return this.i},st.Qa=function(){return"string"==typeof this.g?this.g:String(this.g)},(st=hr.prototype).ha=8,st.B=1,st.Ba=function(t){if(this.h)if(this.h=null,Oe(this.a,"startForwardChannel_"),1==this.B)if(t)ke(this.a,"Not supposed to retry the open");else{Oe(this.a,"open_()"),this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ye(this,this.a,t,void 0),r=this.m;if(this.L&&(r?Y(r=W(r),this.L):r=this.L),null===this.i&&(n.A=r),this.da)t:{for(var i=e=0;i<this.c.length;i++){var o=this.c[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.c.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=mr(this,n,e),En(i=vn(this.A),"RID",t),En(i,"CVER",22),this.v&&En(i,"X-HTTP-Session-Id",this.v),gr(this,i),this.i&&r&&ar(i,this.i,r),Hn(this.f,n),this.Ia&&En(i,"TYPE","init"),this.da?(En(i,"$req",e),En(i,"SID","null"),n.W=!0,tn(n,i,null)):tn(n,i,e),this.B=2}else 3==this.B&&(t?vr(this,t):0==this.c.length?Oe(this.a,"startForwardChannel_ returned: nothing to send"):qn(this.f)?ke(this.a,"startForwardChannel_ returned: connection already in progress"):(vr(this),Oe(this.a,"startForwardChannel_ finished, sent request")))},st.Aa=function(){var t;this.j=null,Ir(this),this.W&&!this.I&&(null==this.b||this.D<=0?At(this.a.a,"Skip bpDetectionTimerId_ "+this.b+" "+this.D):(t=2*this.D,this.a.info("BP detection timer enabled: "+t),this.s=qe(C(this.Ta,this),t)))},st.Ta=function(){var t;this.s?(this.s=null,this.a.info("BP detection timeout reached."),null==this.b.a||(t=this.b.a.U())&&At(this.a.a,"Timer should have been cancelled : "+t),this.a.info("Buffering proxy detected and switch to long-polling!"),this.J=!1,this.I=!0,Ue(10),lr(this),Ir(this)):At(this.a.a,"Invalid operation.")},st.Sa=function(){null!=this.l&&(this.l=null,lr(this),wr(this),Ue(19))},st.Ya=function(t){t?(this.a.info("Successfully pinged google.com"),Ue(2)):(this.a.info("Failed to ping google.com"),Ue(1))},(st=Dr.prototype).ta=function(){},st.sa=function(){},st.ra=function(){},st.qa=function(){},st.Ja=function(){},kr.prototype.a=function(t,e){return new Lr(t,e)},V(Lr,ne),Lr.prototype.i=function(){this.a.g=this.h,this.s&&(this.a.F=!0);var t=this.a,e=this.c,n=this.g||void 0;Oe(t.a,"connect()"),Ue(0),t.fa=e,t.X=n||{},t.J=t.S,Oe(t.a,"connectChannel_()"),e=Sr(t,null,t.fa),Oe(t.a,"GetForwardChannelUri: "+e),t.A=e,yr(t)},Lr.prototype.close=function(){fr(this.a)},Lr.prototype.l=function(t){var e;"string"==typeof t?((e={}).__data__=t,dr(this.a,e)):this.o?((e={}).__data__=oe(t),dr(this.a,e)):dr(this.a,t)},Lr.prototype.H=function(){this.a.g=null,delete this.h,fr(this.a),delete this.a,Lr.Y.H.call(this)},V(Pr,Je),V(Cr,We),V(Rr,Dr),Rr.prototype.ta=function(){xt(this.a.b,"WebChannel opened on "+this.a.c),re(this.a,"a")},Rr.prototype.sa=function(t){re(this.a,new Pr(t))},Rr.prototype.ra=function(t){xt(this.a.b,"WebChannel aborted on "+this.a.c+" due to channel error: "+t),re(this.a,new Cr)},Rr.prototype.qa=function(){xt(this.a.b,"WebChannel closed on "+this.a.c),re(this.a,"b")},kr.prototype.createWebChannel=kr.prototype.a,Lr.prototype.send=Lr.prototype.l,Lr.prototype.open=Lr.prototype.i,je.NO_ERROR=0,je.TIMEOUT=8,je.HTTP_ERROR=6,Be.COMPLETE="complete",(Ke.EventType=N).OPEN="a",N.CLOSE="b",N.ERROR="c",N.MESSAGE="d",ne.prototype.listen=ne.prototype.va,Yn.prototype.listenOnce=Yn.prototype.wa,Yn.prototype.getLastError=Yn.prototype.Qa,Yn.prototype.getLastErrorCode=Yn.prototype.ua,Yn.prototype.getStatus=Yn.prototype.V,Yn.prototype.getResponseJson=Yn.prototype.Pa,Yn.prototype.getResponseText=Yn.prototype.U,Yn.prototype.send=Yn.prototype.ba;var Mr=Ce,Vr=je,Ur=Be,Fr=Le,qr=Ke,jr=Yn;(N=wt("goog.labs.net.webChannel.WebChannelDebug"))&&(N.b=gt),1!=(je=new Ot).b&&(Be=wt(""),N=je.g,Be&&(Be.a||(Be.a=[]),Be.a.push(N)),je.b=!0);var Br="8.2.2-longpoll.66863f547",Hr=new o("@firebase/firestore");function Gr(){return Hr.logLevel}function Kr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Hr.logLevel<=l.DEBUG&&(e=n.map(Wr),Hr.debug.apply(Hr,f(["Firestore ("+Br+"): "+t],e)))}function zr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Hr.logLevel<=l.ERROR&&(e=n.map(Wr),Hr.error.apply(Hr,f(["Firestore ("+Br+"): "+t],e)))}function Jr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Hr.logLevel<=l.WARN&&(e=n.map(Wr),Hr.warn.apply(Hr,f(["Firestore ("+Br+"): "+t],e)))}function Wr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Xr(t){throw void 0===t&&(t="Unexpected state"),zr(t="FIRESTORE ("+Br+") INTERNAL ASSERTION FAILED: "+t),new Error(t)}function Yr(t){t||Xr()}var Qr=(Zr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(var n=0;n<40;n++)e[n]=Math.floor(256*Math.random());return e}(),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Zr);function Zr(){}function $r(t,e){return t<e?-1:e<t?1:0}function ti(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function ei(t){return t+"\0"}var ni=(ri.fromBase64String=function(t){return new ri(atob(t))},ri.fromUint8Array=function(t){return new ri(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ri.prototype.toBase64=function(){return t=this.i,btoa(t);var t},ri.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},ri.prototype.o=function(){return 2*this.i.length},ri.prototype.u=function(t){return $r(this.i,t.i)},ri.prototype.isEqual=function(t){return this.i===t.i},ri);function ri(t){this.i=t}ni.h=new ni("");var ii,oi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},si=(h(hi,ii=Error),hi),ui=(ci.fromBase64String=function(t){try{return new ci(ni.fromBase64String(t))}catch(t){throw new si(oi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},ci.fromUint8Array=function(t){return new ci(ni.fromUint8Array(t))},ci.prototype.toBase64=function(){return this.l.toBase64()},ci.prototype.toUint8Array=function(){return this.l.toUint8Array()},ci.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},ci.prototype.isEqual=function(t){return this.l.isEqual(t.l)},ci),ai=function(t){this._=t};function ci(t){this.l=t}function hi(t,e){var n=this;return(n=ii.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function fi(){if("undefined"==typeof Uint8Array)throw new si(oi.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function li(){if("undefined"==typeof atob)throw new si(oi.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var pi,di=(h(wi,pi=ai),wi.fromBase64String=function(t){return li(),new wi(ui.fromBase64String(t))},wi.fromUint8Array=function(t){return fi(),new wi(ui.fromUint8Array(t))},wi.prototype.toBase64=function(){return li(),this._.toBase64()},wi.prototype.toUint8Array=function(){return fi(),this._.toUint8Array()},wi.prototype.isEqual=function(t){return this._.isEqual(t._)},wi.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},wi),yi=function(t,e,n,r,i,o){this.T=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.I=o},vi=(Object.defineProperty(bi.prototype,"m",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),bi.prototype.isEqual=function(t){return t instanceof bi&&t.projectId===this.projectId&&t.database===this.database},bi),gi=(mi.prototype.A=function(){return null!=this.uid},mi.prototype.R=function(){return this.A()?"uid:"+this.uid:"anonymous-user"},mi.prototype.isEqual=function(t){return t.uid===this.uid},mi);function mi(t){this.uid=t}function bi(t,e){this.projectId=t,this.database=e||"(default)"}function wi(){return null!==pi&&pi.apply(this,arguments)||this}function Ei(t,e){this.user=e,this.type="OAuth",this.V={},this.V.Authorization="Bearer "+t}gi.UNAUTHENTICATED=new gi(null),gi.P=new gi("google-credentials-uid"),gi.g=new gi("first-party-uid");var Ii=(ki.prototype.getToken=function(){return Promise.resolve(null)},ki.prototype.v=function(){},ki.prototype.S=function(t){(this.p=t)(gi.UNAUTHENTICATED)},ki.prototype.D=function(){this.p=null},ki),_i=(Di.prototype.getToken=function(){var e=this,n=this.F,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.F!==n?(Kr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Yr("string"==typeof t.accessToken),new Ei(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Di.prototype.v=function(){this.forceRefresh=!0},Di.prototype.S=function(t){this.p=t,this.N&&t(this.currentUser)},Di.prototype.D=function(){this.auth&&this.auth.removeAuthTokenListener(this.C),this.C=null,this.p=null},Di.prototype.O=function(){var t=this.auth&&this.auth.getUid();return Yr(null===t||"string"==typeof t),new gi(t)},Di),Ti=(Object.defineProperty(Oi.prototype,"V",{get:function(){var t={"X-Goog-AuthUser":this.M},e=this.k.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),Oi),Ni=(Si.prototype.getToken=function(){return Promise.resolve(new Ti(this.k,this.M))},Si.prototype.S=function(t){t(gi.g)},Si.prototype.D=function(){},Si.prototype.v=function(){},Si),Ai=(xi.prototype.L=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},xi.prototype.next=function(){var t=++this.previousValue;return this.B&&this.B(t),t},xi);function xi(t,e){var n=this;this.previousValue=t,e&&(e.$=function(t){return n.L(t)},this.B=function(t){return e.q(t)})}function Si(t,e){this.k=t,this.M=e}function Oi(t,e){this.k=t,this.M=e,this.type="FirstParty",this.user=gi.g}function Di(t){var e=this;this.C=null,this.currentUser=gi.UNAUTHENTICATED,this.N=!1,this.F=0,this.p=null,this.forceRefresh=!1,this.C=function(){e.F++,e.currentUser=e.O(),e.N=!0,e.p&&e.p(e.currentUser)},this.F=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.C):(this.C(null),t.get().then(function(t){e.auth=t,e.C&&e.auth.addAuthTokenListener(e.C)},function(){}))}function ki(){this.p=null}Ai.U=-1;var Li,Pi,Ci=(Ki.now=function(){return Ki.fromMillis(Date.now())},Ki.fromDate=function(t){return Ki.fromMillis(t.getTime())},Ki.fromMillis=function(t){var e=Math.floor(t/1e3);return new Ki(e,1e6*(t-1e3*e))},Ki.prototype.toDate=function(){return new Date(this.toMillis())},Ki.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Ki.prototype.K=function(t){return this.seconds===t.seconds?$r(this.nanoseconds,t.nanoseconds):$r(this.seconds,t.seconds)},Ki.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Ki.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Ki.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Ki.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Ki),Ri=(Gi.j=function(t){return new Gi(t)},Gi.min=function(){return new Gi(new Ci(0,0))},Gi.prototype.u=function(t){return this.timestamp.K(t.timestamp)},Gi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Gi.prototype.W=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Gi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Gi.prototype.G=function(){return this.timestamp},Gi),je=(Object.defineProperty(Hi.prototype,"length",{get:function(){return this.H},enumerable:!1,configurable:!0}),Hi.prototype.isEqual=function(t){return 0===Hi.J(this,t)},Hi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Hi?t.forEach(function(t){e.push(t)}):e.push(t),this.Y(e)},Hi.prototype.limit=function(){return this.offset+this.length},Hi.prototype.X=function(t){return t=void 0===t?1:t,this.Y(this.segments,this.offset+t,this.length-t)},Hi.prototype.Z=function(){return this.Y(this.segments,this.offset,this.length-1)},Hi.prototype.tt=function(){return this.segments[this.offset]},Hi.prototype.et=function(){return this.get(this.length-1)},Hi.prototype.get=function(t){return this.segments[this.offset+t]},Hi.prototype.nt=function(){return 0===this.length},Hi.prototype.st=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Hi.prototype.it=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Hi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Hi.prototype.rt=function(){return this.segments.slice(this.offset,this.limit())},Hi.J=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Hi),Mi=(h(Bi,Pi=je),Bi.prototype.Y=function(t,e,n){return new Bi(t,e,n)},Bi.prototype.ot=function(){return this.rt().join("/")},Bi.prototype.toString=function(){return this.ot()},Bi.ct=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new si(oi.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new Bi(n)},Bi.at=function(){return new Bi([])},Bi),Vi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ui=(h(ji,Li=je),ji.prototype.Y=function(t,e,n){return new ji(t,e,n)},ji.ut=function(t){return Vi.test(t)},ji.prototype.ot=function(){return this.rt().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ji.ut(t)||(t="`"+t+"`"),t}).join(".")},ji.prototype.toString=function(){return this.ot()},ji.prototype.ht=function(){return 1===this.length&&"__name__"===this.get(0)},ji.lt=function(){return new ji(["__name__"])},ji._t=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new si(oi.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new si(oi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new si(oi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new si(oi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ji(e)},ji.at=function(){return new ji([])},ji),Fi=(qi.ft=function(t){return new qi(Mi.ct(t))},qi.dt=function(t){return new qi(Mi.ct(t).X(5))},qi.prototype.wt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},qi.prototype.isEqual=function(t){return null!==t&&0===Mi.J(this.path,t.path)},qi.prototype.toString=function(){return this.path.toString()},qi.J=function(t,e){return Mi.J(t.path,e.path)},qi.Tt=function(t){return t.length%2==0},qi.Et=function(t){return new qi(new Mi(t.slice()))},qi);function qi(t){this.path=t}function ji(){return null!==Li&&Li.apply(this,arguments)||this}function Bi(){return null!==Pi&&Pi.apply(this,arguments)||this}function Hi(t,e,n){void 0===e?e=0:e>t.length&&Xr(),void 0===n?n=t.length-e:n>t.length-e&&Xr(),this.segments=t,this.offset=e,this.H=n}function Gi(t){this.timestamp=t}function Ki(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new si(oi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new si(oi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new si(oi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new si(oi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function zi(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Ji(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Wi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Xi=(Qi.prototype.It=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].st(t))return!0;return!1},Qi.prototype.isEqual=function(t){return ti(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Qi),Yi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qi(t){(this.fields=t).sort(Ui.J)}function Zi(t){if(Yr(!!t),"string"!=typeof t)return{seconds:$i(t.seconds),nanos:$i(t.nanos)};var e=0,n=Yi.exec(t);return Yr(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n)),t=new Date(t),{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function $i(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function to(t){return"string"==typeof t?ni.fromBase64String(t):ni.fromUint8Array(t)}function eo(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function no(t){return t=Zi(t.mapValue.fields.__local_write_time__.timestampValue),new Ci(t.seconds,t.nanos)}function ro(t){return null==t}function io(t){return 0===t&&1/t==-1/0}function oo(t){return"number"==typeof t&&Number.isInteger(t)&&!io(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function so(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?eo(t)?4:10:Xr()}function uo(r,i){var t,e=so(r);if(e!==so(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return no(r).isEqual(no(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Zi(r.timestampValue),t=Zi(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,to(r.bytesValue).isEqual(to(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,$i((t=r).geoPointValue.latitude)===$i(e.geoPointValue.latitude)&&$i(t.geoPointValue.longitude)===$i(e.geoPointValue.longitude);case 2:return t=i,"integerValue"in(e=r)&&"integerValue"in t?$i(e.integerValue)===$i(t.integerValue):"doubleValue"in e&&"doubleValue"in t&&((e=$i(e.doubleValue))===(t=$i(t.doubleValue))?io(e)===io(t):isNaN(e)&&isNaN(t));case 9:return ti(r.arrayValue.values||[],i.arrayValue.values||[],uo);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(zi(e)!==zi(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!uo(e[t],n[t])))return!1;return!0}();default:return Xr()}}function ao(t,e){return void 0!==(t.values||[]).find(function(t){return uo(t,e)})}function co(t,e){var n,r,i,o=so(t),s=so(e);if(o!==s)return $r(o,s);switch(o){case 0:return 0;case 1:return $r(t.booleanValue,e.booleanValue);case 2:return n=e,(r=$i(t.integerValue||t.doubleValue))<(n=$i(n.integerValue||n.doubleValue))?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return ho(t.timestampValue,e.timestampValue);case 4:return ho(no(t),no(e));case 5:return $r(t.stringValue,e.stringValue);case 6:return i=t.bytesValue,s=e.bytesValue,i=to(i),s=to(s),i.u(s);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=$r(n[i],r[i]);if(0!==o)return o}return $r(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return o=t.geoPointValue,r=e.geoPointValue,0!==(n=$r($i(o.latitude),$i(r.latitude)))?n:$r($i(o.longitude),$i(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=co(n[i],r[i]);if(o)return o}return $r(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=$r(r[s],o[s]);if(0!==u)return u;if(0!==(u=co(n[r[s]],i[o[s]])))return u}return $r(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Xr()}}function ho(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return $r(t,e);var n=Zi(t),t=Zi(e);return 0!==(e=$r(n.seconds,t.seconds))?e:$r(n.nanos,t.nanos)}function fo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=Zi(t=i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?to(i.bytesValue).toBase64():"referenceValue"in i?(e=i.referenceValue,Fi.dt(e).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Xr();var t,e}(t)}function lo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.ot()}}function po(t){return t&&"integerValue"in t}function yo(t){return!!t&&"arrayValue"in t}function vo(t){return t&&"nullValue"in t}function go(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function mo(t){return t&&"mapValue"in t}var bo=(Io.empty=function(){return new Io({mapValue:{}})},Io.prototype.field=function(t){if(t.nt())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!mo(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.et()])||null},Io.prototype.isEqual=function(t){return uo(this.proto,t.proto)},Io),wo=(Eo.prototype.set=function(t,e){return this.Pt(t,e),this},Eo.prototype.delete=function(t){return this.Pt(t,null),this},Eo.prototype.Pt=function(t,e){for(var n=this.Rt,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===so(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.et(),e)},Eo.prototype.yt=function(){var t=this.gt(Ui.at(),this.Rt);return null!=t?new bo(t):this.At},Eo.prototype.gt=function(r,t){var i=this,o=!1,e=this.At.field(r),s=mo(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.gt(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Eo);function Eo(t){void 0===t&&(t=bo.empty()),this.At=t,this.Rt=new Map}function Io(t){this.proto=t}var _o,To,No,Ao=(h(Lo,No=o=function(t,e){this.key=t,this.version=e}),Lo.prototype.field=function(t){return this.Vt.field(t)},Lo.prototype.data=function(){return this.Vt},Lo.prototype.vt=function(){return this.Vt.proto},Lo.prototype.isEqual=function(t){return t instanceof Lo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.bt===t.bt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Vt.isEqual(t.Vt)},Lo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Vt.toString()+", {hasLocalMutations: "+this.bt+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Lo.prototype,"hasPendingWrites",{get:function(){return this.bt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Lo),xo=(h(ko,To=o),ko.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(ko.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),ko.prototype.isEqual=function(t){return t instanceof ko&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ko),So=(h(Do,_o=o),Do.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Do.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Do.prototype.isEqual=function(t){return t instanceof Do&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Do),Oo=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.St=null};function Do(){return null!==_o&&_o.apply(this,arguments)||this}function ko(t,e,n){var r=this;return(r=To.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Lo(t,e,n,r){var i=this;return(i=No.call(this,t,e)||this).Vt=n,i.bt=!!r.bt,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Po(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Oo(t,e,n,r,i,o,s)}function Co(t){var e=t;return null===e.St&&(t=e.path.ot(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return t.field.ot()+t.op.toString()+fo(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return t.field.ot()+t.dir}).join(","),ro(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=cs(e.startAt)),e.endAt&&(t+="|ub:",t+=cs(e.endAt)),e.St=t),e.St}function Ro(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!uo(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ls(t.startAt,e.startAt)&&ls(t.endAt,e.endAt)}function Mo(t){return Fi.Tt(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Vo,Uo=(h(Fo,Vo=function(){}),Fo.create=function(t,e,n){return t.ht()?"in"===e||"not-in"===e?this.Dt(t,e,n):new Ho(t,e,n):"array-contains"===e?new ts(t,n):"in"===e?new es(t,n):"not-in"===e?new ns(t,n):"array-contains-any"===e?new rs(t,n):new Fo(t,e,n)},Fo.Dt=function(t,e,n){return new("in"===e?Go:Ko)(t,n)},Fo.prototype.matches=function(t){return t=t.field(this.field),"!="===this.op?null!==t&&this.Ct(co(t,this.value)):null!==t&&so(this.value)===so(t)&&this.Ct(co(t,this.value))},Fo.prototype.Ct=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Xr()}},Fo.prototype.xt=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Fo);function Fo(t,e,n){var r=this;return(r=Vo.call(this)||this).field=t,r.op=e,r.value=n,r}var qo,jo,Bo,Ho=(h(Wo,Bo=Uo),Wo.prototype.matches=function(t){return t=Fi.J(t.key,this.key),this.Ct(t)},Wo),Go=(h(Jo,jo=Uo),Jo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Jo),Ko=(h(zo,qo=Uo),zo.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},zo);function zo(t,e){var n=this;return(n=qo.call(this,t,"not-in",e)||this).keys=Xo(0,e),n}function Jo(t,e){var n=this;return(n=jo.call(this,t,"in",e)||this).keys=Xo(0,e),n}function Wo(t,e,n){var r=this;return(r=Bo.call(this,t,e,n)||this).key=Fi.dt(n.referenceValue),r}function Xo(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Fi.dt(t.referenceValue)})}var Yo,Qo,Zo,$o,ts=(h(as,$o=Uo),as.prototype.matches=function(t){return yo(t=t.field(this.field))&&ao(t.arrayValue,this.value)},as),es=(h(us,Zo=Uo),us.prototype.matches=function(t){return null!==(t=t.field(this.field))&&ao(this.value.arrayValue,t)},us),ns=(h(ss,Qo=Uo),ss.prototype.matches=function(t){return!ao(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(t=t.field(this.field))&&!ao(this.value.arrayValue,t))},ss),rs=(h(os,Yo=Uo),os.prototype.matches=function(t){var e=this;return!(!yo(t=t.field(this.field))||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return ao(e.value.arrayValue,t)})},os),is=function(t,e){this.position=t,this.before=e};function os(t,e){return Yo.call(this,t,"array-contains-any",e)||this}function ss(t,e){return Qo.call(this,t,"not-in",e)||this}function us(t,e){return Zo.call(this,t,"in",e)||this}function as(t,e){return $o.call(this,t,"array-contains",e)||this}function cs(t){return(t.before?"b":"a")+":"+t.position.map(fo).join(",")}var hs=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function fs(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.ht()?Fi.J(Fi.dt(s.referenceValue),n.key):co(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ls(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!uo(t.position[n],e.position[n]))return!1;return!0}var ps=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Nt=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.Ft=null,this.Ot=null,this.startAt,this.endAt};function ds(t,e,n,r,i,o,s,u){return new ps(t,e,n,r,i,o,s,u)}function ys(t){return new ps(t)}function vs(t){return!ro(t.limit)&&"F"===t.limitType}function gs(t){return!ro(t.limit)&&"L"===t.limitType}function ms(t){return 0<t.Nt.length?t.Nt[0].field:null}function bs(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.xt())return r.field}return null}function ws(t){return null!==t.collectionGroup}function Es(t){var e=t;if(null===e.Ft){e.Ft=[];var n=bs(e),t=ms(e);if(null!==n&&null===t)n.ht()||e.Ft.push(new hs(n)),e.Ft.push(new hs(Ui.lt(),"asc"));else{for(var r=!1,i=0,o=e.Nt;i<o.length;i++){var s=o[i];e.Ft.push(s),s.field.ht()&&(r=!0)}r||(n=0<e.Nt.length?e.Nt[e.Nt.length-1].dir:"asc",e.Ft.push(new hs(Ui.lt(),n)))}}return e.Ft}function Is(t){var e=t;if(!e.Ot)if("F"===e.limitType)e.Ot=Po(e.path,e.collectionGroup,Es(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Es(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new hs(o.field,s))}var u=e.endAt?new is(e.endAt.position,!e.endAt.before):null,t=e.startAt?new is(e.startAt.position,!e.startAt.before):null;e.Ot=Po(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.Ot}function _s(t,e,n){return new ps(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ts(t,e){return Ro(Is(t),Is(e))&&t.limitType===e.limitType}function Ns(t){return Co(Is(t))+"|lt:"+t.limitType}function As(t){return"Query(target="+(n=(e=Is(t)).path.ot(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return t.field.ot()+" "+t.op+" "+fo(t.value)}).join(", ")+"]"),ro(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return t.field.ot()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+cs(e.startAt)),e.endAt&&(n+=", endAt: "+cs(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function xs(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.wt(e.collectionGroup)&&e.path.st(n):Fi.Tt(e.path)?e.path.isEqual(n):e.path.it(n))&&function(t){for(var e=0,n=i.Nt;e<n.length;e++){var r=n[e];if(!r.field.ht()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||fs(t.startAt,Es(t),n))&&(!t.endAt||!fs(t.endAt,Es(t),n)));var e,n}function Ss(u){return function(t,e){for(var n=!1,r=0,i=Es(u);r<i.length;r++){var o=i[r],s=function(t,e,n){var r,i;switch(n=t.field.ht()?Fi.J(e.key,n.key):(r=t.field,i=n,e=e.field(r),r=i.field(r),null!==e&&null!==r?co(e,r):Xr()),t.dir){case"asc":return n;case"desc":return-1*n;default:return Xr()}}(o,t,e);if(0!==s)return s;n=n||o.field.ht()}return 0}}var Os=(Ds.prototype.$t=function(t){return new Ds(this.target,this.targetId,this.kt,t,this.Mt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Ds.prototype.Lt=function(t,e){return new Ds(this.target,this.targetId,this.kt,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Ds.prototype.Bt=function(t){return new Ds(this.target,this.targetId,this.kt,this.sequenceNumber,this.Mt,t,this.resumeToken)},Ds);function Ds(t,e,n,r,i,o,s){void 0===i&&(i=Ri.min()),void 0===o&&(o=Ri.min()),void 0===s&&(s=ni.h),this.target=t,this.targetId=e,this.kt=n,this.sequenceNumber=r,this.Mt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function ks(t,e){if(t.qt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:io(e)?"-0":e}}function Ls(t){return{integerValue:""+t}}function Ps(t,e){return oo(e)?Ls(e):ks(t,e)}function Cs(t,e){return t instanceof Js?po(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Rs,Ms,Vs=(h(qs,Ms=je=function(){this.Ut=void 0}),qs),Us=(h(Fs,Rs=je),Fs);function Fs(t){var e=this;return(e=Rs.call(this)||this).elements=t,e}function qs(){return null!==Ms&&Ms.apply(this,arguments)||this}function js(t,e){for(var n=Ys(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return uo(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Bs,Hs=(h(Gs,Bs=je),Gs);function Gs(t){var e=this;return(e=Bs.call(this)||this).elements=t,e}function Ks(t,e){for(var n=Ys(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!uo(t,e)})}(i[r]);return{arrayValue:{values:n}}}var zs,Js=(h(Ws,zs=je),Ws);function Ws(t,e){var n=this;return(n=zs.call(this)||this).Kt=t,n.Qt=e,n}function Xs(t){return $i(t.integerValue||t.doubleValue)}function Ys(t){return yo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Qs(t,e){this.version=t,this.transformResults=e}var Zs=function(t,e){this.field=t,this.transform=e},$s=(tu.jt=function(){return new tu},tu.exists=function(t){return new tu(void 0,t)},tu.updateTime=function(t){return new tu(t)},Object.defineProperty(tu.prototype,"Wt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),tu.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},tu);function tu(t,e){this.updateTime=t,this.exists=e}function eu(t,e){return void 0!==t.updateTime?e instanceof Ao&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Ao}function nu(t,e,n,r){return t instanceof uu?function(t,e,n){if(!eu(t.Gt,e))return e;var r=t.value,n=pu(t.fieldTransforms,n,e),r=du(t.fieldTransforms,r,n),e=iu(e);return new Ao(t.key,e,r,{bt:!0})}(t,e,r):t instanceof au?function(t,e,n){if(!eu(t.Gt,e))return e;var r=iu(e),e=fu(t,e,pu(t.fieldTransforms,n,e));return new Ao(t.key,r,e,{bt:!0})}(t,e,r):eu(t.Gt,e)?new xo(t.key,Ri.min()):e}function ru(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Gt.isEqual(e.Gt)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ti(n,r,function(t,e){return t.field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Us&&e instanceof Us||t instanceof Hs&&e instanceof Hs?ti(t.elements,e.elements,uo):t instanceof Js&&e instanceof Js?uo(t.Qt,e.Qt):t instanceof Vs&&e instanceof Vs)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.zt.isEqual(e.zt));var n,r}function iu(t){return t instanceof Ao?t.version:Ri.min()}var ou,su,uu=(h(hu,su=o=function(){}),hu),au=(h(cu,ou=o),cu);function cu(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=ou.call(this)||this).key=t,o.data=e,o.zt=n,o.Gt=r,o.fieldTransforms=i,o.type=1,o}function hu(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=su.call(this)||this).key=t,i.value=e,i.Gt=n,i.fieldTransforms=r,i.type=0,i}function fu(t,e,n){var r,i,o=t;return e=e instanceof Ao?e.data():bo.empty(),i=new wo(e),o.zt.fields.forEach(function(t){var e;t.nt()||(null!==(e=o.data.field(t))?i.set(t,e):i.delete(t))}),r=i.yt(),du(t.fieldTransforms,r,n)}function lu(t,e,n){var r=[];Yr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof Ao&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof Us?js(o,s):o instanceof Hs?Ks(o,s):u))}return r}function pu(t,e,n){for(var r,i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof Ao&&(c=n.field(u.field)),i.push((r=c,u=e,c=void 0,a instanceof Vs?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:u.seconds,nanos:u.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):a instanceof Us?js(a,r):a instanceof Hs?Ks(a,r):(r=Xs(a=Cs(c=a,r))+Xs(c.Qt),po(a)&&po(c.Qt)?Ls(r):ks(c.Kt,r))))}return i}function du(t,e,n){for(var r=new wo(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.yt()}function yu(t){this.count=t}var vu,gu,mu,bu=(h(Iu,mu=o),Iu),wu=(h(Eu,gu=o),Eu);function Eu(t,e){var n=this;return(n=gu.call(this)||this).key=t,n.Gt=e,n.type=3,n.fieldTransforms=[],n}function Iu(t,e){var n=this;return(n=mu.call(this)||this).key=t,n.Gt=e,n.type=2,n.fieldTransforms=[],n}function _u(t){switch(t){case oi.OK:return Xr(),0;case oi.CANCELLED:case oi.UNKNOWN:case oi.DEADLINE_EXCEEDED:case oi.RESOURCE_EXHAUSTED:case oi.INTERNAL:case oi.UNAVAILABLE:case oi.UNAUTHENTICATED:return;case oi.INVALID_ARGUMENT:case oi.NOT_FOUND:case oi.ALREADY_EXISTS:case oi.PERMISSION_DENIED:case oi.FAILED_PRECONDITION:case oi.ABORTED:case oi.OUT_OF_RANGE:case oi.UNIMPLEMENTED:case oi.DATA_LOSS:return 1;default:return Xr(),0}}function Tu(t){if(void 0===t)return zr("GRPC error has no .code"),oi.UNKNOWN;switch(t){case vu.OK:return oi.OK;case vu.CANCELLED:return oi.CANCELLED;case vu.UNKNOWN:return oi.UNKNOWN;case vu.DEADLINE_EXCEEDED:return oi.DEADLINE_EXCEEDED;case vu.RESOURCE_EXHAUSTED:return oi.RESOURCE_EXHAUSTED;case vu.INTERNAL:return oi.INTERNAL;case vu.UNAVAILABLE:return oi.UNAVAILABLE;case vu.UNAUTHENTICATED:return oi.UNAUTHENTICATED;case vu.INVALID_ARGUMENT:return oi.INVALID_ARGUMENT;case vu.NOT_FOUND:return oi.NOT_FOUND;case vu.ALREADY_EXISTS:return oi.ALREADY_EXISTS;case vu.PERMISSION_DENIED:return oi.PERMISSION_DENIED;case vu.FAILED_PRECONDITION:return oi.FAILED_PRECONDITION;case vu.ABORTED:return oi.ABORTED;case vu.OUT_OF_RANGE:return oi.OUT_OF_RANGE;case vu.UNIMPLEMENTED:return oi.UNIMPLEMENTED;case vu.DATA_LOSS:return oi.DATA_LOSS;default:return Xr()}}(je=vu={})[je.OK=0]="OK",je[je.CANCELLED=1]="CANCELLED",je[je.UNKNOWN=2]="UNKNOWN",je[je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",je[je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",je[je.NOT_FOUND=5]="NOT_FOUND",je[je.ALREADY_EXISTS=6]="ALREADY_EXISTS",je[je.PERMISSION_DENIED=7]="PERMISSION_DENIED",je[je.UNAUTHENTICATED=16]="UNAUTHENTICATED",je[je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",je[je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",je[je.ABORTED=10]="ABORTED",je[je.OUT_OF_RANGE=11]="OUT_OF_RANGE",je[je.UNIMPLEMENTED=12]="UNIMPLEMENTED",je[je.INTERNAL=13]="INTERNAL",je[je.UNAVAILABLE=14]="UNAVAILABLE",je[je.DATA_LOSS=15]="DATA_LOSS";var Nu=(Du.prototype.Ht=function(t,e){return new Du(this.J,this.root.Ht(t,e,this.J).copy(null,null,xu.Jt,null,null))},Du.prototype.remove=function(t){return new Du(this.J,this.root.remove(t,this.J).copy(null,null,xu.Jt,null,null))},Du.prototype.get=function(t){for(var e=this.root;!e.nt();){var n=this.J(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Du.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.nt();){var r=this.J(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Du.prototype.nt=function(){return this.root.nt()},Object.defineProperty(Du.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Du.prototype.Yt=function(){return this.root.Yt()},Du.prototype.Xt=function(){return this.root.Xt()},Du.prototype.Zt=function(t){return this.root.Zt(t)},Du.prototype.forEach=function(n){this.Zt(function(t,e){return n(t,e),!1})},Du.prototype.toString=function(){var n=[];return this.Zt(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Du.prototype.te=function(t){return this.root.te(t)},Du.prototype.ee=function(){return new Au(this.root,null,this.J,!1)},Du.prototype.ne=function(t){return new Au(this.root,t,this.J,!1)},Du.prototype.se=function(){return new Au(this.root,null,this.J,!0)},Du.prototype.ie=function(t){return new Au(this.root,t,this.J,!0)},Du),Au=(Ou.prototype.ce=function(){var t=this.oe.pop(),e={key:t.key,value:t.value};if(this.re)for(t=t.left;!t.nt();)this.oe.push(t),t=t.right;else for(t=t.right;!t.nt();)this.oe.push(t),t=t.left;return e},Ou.prototype.ae=function(){return 0<this.oe.length},Ou.prototype.ue=function(){if(0===this.oe.length)return null;var t=this.oe[this.oe.length-1];return{key:t.key,value:t.value}},Ou),xu=(Su.prototype.copy=function(t,e,n,r,i){return new Su(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Su.prototype.nt=function(){return!1},Su.prototype.Zt=function(t){return this.left.Zt(t)||t(this.key,this.value)||this.right.Zt(t)},Su.prototype.te=function(t){return this.right.te(t)||t(this.key,this.value)||this.left.te(t)},Su.prototype.min=function(){return this.left.nt()?this:this.left.min()},Su.prototype.Yt=function(){return this.min().key},Su.prototype.Xt=function(){return this.right.nt()?this.key:this.right.Xt()},Su.prototype.Ht=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Ht(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Ht(t,e,n))).he()},Su.prototype.le=function(){if(this.left.nt())return Su.EMPTY;var t=this;return t.left._e()||t.left.left._e()||(t=t.fe()),(t=t.copy(null,null,null,t.left.le(),null)).he()},Su.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.nt()||r.left._e()||r.left.left._e()||(r=r.fe()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left._e()&&(r=r.de()),r.right.nt()||r.right._e()||r.right.left._e()||(r=r.we()),0===e(t,r.key)){if(r.right.nt())return Su.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.le())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.he()},Su.prototype._e=function(){return this.color},Su.prototype.he=function(){var t=this;return t.right._e()&&!t.left._e()&&(t=t.Te()),t.left._e()&&t.left.left._e()&&(t=t.de()),t.left._e()&&t.right._e()&&(t=t.Ee()),t},Su.prototype.fe=function(){var t=this.Ee();return t.right.left._e()&&(t=(t=(t=t.copy(null,null,null,null,t.right.de())).Te()).Ee()),t},Su.prototype.we=function(){var t=this.Ee();return t.left.left._e()&&(t=(t=t.de()).Ee()),t},Su.prototype.Te=function(){var t=this.copy(null,null,Su.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Su.prototype.de=function(){var t=this.copy(null,null,Su.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Su.prototype.Ee=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Su.prototype.Ie=function(){var t=this.me();return Math.pow(2,t)<=this.size+1},Su.prototype.me=function(){if(this._e()&&this.left._e())throw Xr();if(this.right._e())throw Xr();var t=this.left.me();if(t!==this.right.me())throw Xr();return t+(this._e()?0:1)},Su);function Su(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Su.RED,this.left=null!=r?r:Su.EMPTY,this.right=null!=i?i:Su.EMPTY,this.size=this.left.size+1+this.right.size}function Ou(t,e,n,r){this.re=r,this.oe=[];for(var i=1;!t.nt();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.re?t.left:t.right;else{if(0===i){this.oe.push(t);break}this.oe.push(t),t=this.re?t.right:t.left}}function Du(t,e){this.J=t,this.root=e||xu.EMPTY}function ku(){this.size=0}xu.EMPTY=null,xu.RED=!0,xu.Jt=!1,xu.EMPTY=(Object.defineProperty(ku.prototype,"key",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),Object.defineProperty(ku.prototype,"value",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),Object.defineProperty(ku.prototype,"color",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),Object.defineProperty(ku.prototype,"left",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),Object.defineProperty(ku.prototype,"right",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),ku.prototype.copy=function(t,e,n,r,i){return this},ku.prototype.Ht=function(t,e,n){return new xu(t,e)},ku.prototype.remove=function(t,e){return this},ku.prototype.nt=function(){return!0},ku.prototype.Zt=function(t){return!1},ku.prototype.te=function(t){return!1},ku.prototype.Yt=function(){return null},ku.prototype.Xt=function(){return null},ku.prototype._e=function(){return!1},ku.prototype.Ie=function(){return!0},ku.prototype.me=function(){return 0},new ku);var Lu=(Mu.prototype.has=function(t){return null!==this.data.get(t)},Mu.prototype.first=function(){return this.data.Yt()},Mu.prototype.last=function(){return this.data.Xt()},Object.defineProperty(Mu.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Mu.prototype.indexOf=function(t){return this.data.indexOf(t)},Mu.prototype.forEach=function(n){this.data.Zt(function(t,e){return n(t),!1})},Mu.prototype.Ae=function(t,e){for(var n=this.data.ne(t[0]);n.ae();){var r=n.ce();if(0<=this.J(r.key,t[1]))return;e(r.key)}},Mu.prototype.Re=function(t,e){for(var n=void 0!==e?this.data.ne(e):this.data.ee();n.ae();)if(!t(n.ce().key))return},Mu.prototype.Pe=function(t){return(t=this.data.ne(t)).ae()?t.ce().key:null},Mu.prototype.ee=function(){return new Pu(this.data.ee())},Mu.prototype.ne=function(t){return new Pu(this.data.ne(t))},Mu.prototype.add=function(t){return this.copy(this.data.remove(t).Ht(t,!0))},Mu.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Mu.prototype.nt=function(){return this.data.nt()},Mu.prototype.ye=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Mu.prototype.isEqual=function(t){if(!(t instanceof Mu))return!1;if(this.size!==t.size)return!1;for(var e=this.data.ee(),n=t.data.ee();e.ae();){var r=e.ce().key,i=n.ce().key;if(0!==this.J(r,i))return!1}return!0},Mu.prototype.rt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Mu.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Mu.prototype.copy=function(t){var e=new Mu(this.J);return e.data=t,e},Mu),Pu=(Ru.prototype.ce=function(){return this.ge.ce().key},Ru.prototype.ae=function(){return this.ge.ae()},Ru),Cu=new Nu(Fi.J);function Ru(t){this.ge=t}function Mu(t){this.J=t,this.data=new Nu(this.J)}var Vu=new Nu(Fi.J),Uu=new Nu(Fi.J),Fu=new Lu(Fi.J);function qu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Fu,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var ju=new Lu($r),Bu=(ia.be=function(t){return new ia(t.J)},ia.prototype.has=function(t){return null!=this.Ve.get(t)},ia.prototype.get=function(t){return this.Ve.get(t)},ia.prototype.first=function(){return this.pe.Yt()},ia.prototype.last=function(){return this.pe.Xt()},ia.prototype.nt=function(){return this.pe.nt()},ia.prototype.indexOf=function(t){return(t=this.Ve.get(t))?this.pe.indexOf(t):-1},Object.defineProperty(ia.prototype,"size",{get:function(){return this.pe.size},enumerable:!1,configurable:!0}),ia.prototype.forEach=function(n){this.pe.Zt(function(t,e){return n(t),!1})},ia.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ve.Ht(t.key,t),e.pe.Ht(t,null))},ia.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ve.remove(t),this.pe.remove(e)):this},ia.prototype.isEqual=function(t){if(!(t instanceof ia))return!1;if(this.size!==t.size)return!1;for(var e=this.pe.ee(),n=t.pe.ee();e.ae();){var r=e.ce().key,i=n.ce().key;if(!r.isEqual(i))return!1}return!0},ia.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ia.prototype.copy=function(t,e){var n=new ia;return n.J=this.J,n.Ve=t,n.pe=e,n},ia),Hu=(ra.prototype.track=function(t){var e=t.doc.key,n=this.ve.get(e);!n||0!==t.type&&3===n.type?this.ve=this.ve.Ht(e,t):3===t.type&&1!==n.type?this.ve=this.ve.Ht(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ve=this.ve.Ht(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ve=this.ve.Ht(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ve=this.ve.remove(e):1===t.type&&2===n.type?this.ve=this.ve.Ht(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ve=this.ve.Ht(e,{type:2,doc:t.doc}):Xr()},ra.prototype.Se=function(){var n=[];return this.ve.Zt(function(t,e){n.push(e)}),n},ra),Gu=(na.Fe=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new na(t,e,Bu.be(e),i,n,r,!0,!1)},Object.defineProperty(na.prototype,"hasPendingWrites",{get:function(){return!this.Ce.nt()},enumerable:!1,configurable:!0}),na.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.xe===t.xe&&this.Ce.isEqual(t.Ce)&&Ts(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.De.isEqual(t.De)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},na),Ku=(ea.Le=function(t,e){var n=new Map;return n.set(t,zu.Be(t,e)),new ea(Ri.min(),n,ju,Cu,qu())},ea),zu=(ta.Be=function(t,e){return new ta(ni.h,e,qu(),qu(),qu())},ta),Ju=function(t,e,n,r){this.je=t,this.removedTargetIds=e,this.key=n,this.We=r},Wu=function(t,e){this.targetId=t,this.Ge=e},Xu=function(t,e,n,r){void 0===n&&(n=ni.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Yu=(Object.defineProperty($u.prototype,"qe",{get:function(){return this.Ye},enumerable:!1,configurable:!0}),Object.defineProperty($u.prototype,"resumeToken",{get:function(){return this.Je},enumerable:!1,configurable:!0}),Object.defineProperty($u.prototype,"Ze",{get:function(){return 0!==this.ze},enumerable:!1,configurable:!0}),Object.defineProperty($u.prototype,"tn",{get:function(){return this.Xe},enumerable:!1,configurable:!0}),$u.prototype.en=function(t){0<t.o()&&(this.Xe=!0,this.Je=t)},$u.prototype.nn=function(){var n=qu(),r=qu(),i=qu();return this.He.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Xr()}}),new zu(this.Je,this.Ye,n,r,i)},$u.prototype.sn=function(){this.Xe=!1,this.He=sa()},$u.prototype.rn=function(t,e){this.Xe=!0,this.He=this.He.Ht(t,e)},$u.prototype.on=function(t){this.Xe=!0,this.He=this.He.remove(t)},$u.prototype.cn=function(){this.ze+=1},$u.prototype.an=function(){--this.ze},$u.prototype.un=function(){this.Xe=!0,this.Ye=!0},$u),Qu=(Zu.prototype.wn=function(t){for(var e=0,n=t.je;e<n.length;e++){var r=n[e];t.We instanceof Ao?this.Tn(r,t.We):t.We instanceof xo&&this.En(r,t.key,t.We)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.En(r,t.key,t.We)},Zu.prototype.In=function(n){var r=this;this.mn(n,function(t){var e=r.An(t);switch(n.state){case 0:r.Rn(t)&&e.en(n.resumeToken);break;case 1:e.an(),e.Ze||e.sn(),e.en(n.resumeToken);break;case 2:e.an(),e.Ze||r.removeTarget(t);break;case 3:r.Rn(t)&&(e.un(),e.en(n.resumeToken));break;case 4:r.Rn(t)&&(r.Pn(t),e.en(n.resumeToken));break;default:Xr()}})},Zu.prototype.mn=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.ln.forEach(function(t,e){r.Rn(e)&&n(e)})},Zu.prototype.yn=function(t){var e=t.targetId,n=t.Ge.count;(t=this.gn(e))&&(Mo(t=t.target)?0===n?(t=new Fi(t.path),this.En(e,t,new xo(t,Ri.min()))):Yr(1===n):this.Vn(e)!==n&&(this.Pn(e),this.dn=this.dn.add(e)))},Zu.prototype.pn=function(r){var i=this,o=new Map;this.ln.forEach(function(t,e){var n=i.gn(e);n&&(t.qe&&Mo(n.target)&&(n=new Fi(n.target.path),null!==i._n.get(n)||i.bn(e,n)||i.En(e,n,new xo(n,r))),t.tn&&(o.set(e,t.nn()),t.sn()))});var s=qu();this.fn.forEach(function(t,e){var n=!0;e.Re(function(t){return!(t=i.gn(t))||2===t.kt||(n=!1)}),n&&(s=s.add(t))});var t=new Ku(r,o,this.dn,this._n,s);return this._n=Cu,this.fn=oa(),this.dn=new Lu($r),t},Zu.prototype.Tn=function(t,e){var n;this.Rn(t)&&(n=this.bn(t,e.key)?2:0,this.An(t).rn(e.key,n),this._n=this._n.Ht(e.key,e),this.fn=this.fn.Ht(e.key,this.vn(e.key).add(t)))},Zu.prototype.En=function(t,e,n){var r;this.Rn(t)&&(r=this.An(t),this.bn(t,e)?r.rn(e,1):r.on(e),this.fn=this.fn.Ht(e,this.vn(e).delete(t)),n&&(this._n=this._n.Ht(e,n)))},Zu.prototype.removeTarget=function(t){this.ln.delete(t)},Zu.prototype.Vn=function(t){var e=this.An(t).nn();return this.hn.Sn(t).size+e.Ue.size-e.Ke.size},Zu.prototype.cn=function(t){this.An(t).cn()},Zu.prototype.An=function(t){var e=this.ln.get(t);return e||(e=new Yu,this.ln.set(t,e)),e},Zu.prototype.vn=function(t){var e=this.fn.get(t);return e||(e=new Lu($r),this.fn=this.fn.Ht(t,e)),e},Zu.prototype.Rn=function(t){var e=null!==this.gn(t);return e||Kr("WatchChangeAggregator","Detected inactive target",t),e},Zu.prototype.gn=function(t){var e=this.ln.get(t);return e&&e.Ze?null:this.hn.Dn(t)},Zu.prototype.Pn=function(e){var n=this;this.ln.set(e,new Yu),this.hn.Sn(e).forEach(function(t){n.En(e,t,null)})},Zu.prototype.bn=function(t,e){return this.hn.Sn(t).has(e)},Zu);function Zu(t){this.hn=t,this.ln=new Map,this._n=Cu,this.fn=oa(),this.dn=new Lu($r)}function $u(){this.ze=0,this.He=sa(),this.Je=ni.h,this.Ye=!1,this.Xe=!0}function ta(t,e,n,r,i){this.resumeToken=t,this.qe=e,this.Ue=n,this.Qe=r,this.Ke=i}function ea(t,e,n,r,i){this.Mt=t,this.Oe=e,this.ke=n,this.Me=r,this.$e=i}function na(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.De=n,this.docChanges=r,this.Ce=i,this.fromCache=o,this.xe=s,this.Ne=u}function ra(){this.ve=new Nu(Fi.J)}function ia(n){this.J=n?function(t,e){return n(t,e)||Fi.J(t.key,e.key)}:function(t,e){return Fi.J(t.key,e.key)},this.Ve=Vu,this.pe=new Nu(this.J)}function oa(){return new Nu(Fi.J)}function sa(){return new Nu(Fi.J)}var ua={asc:"ASCENDING",desc:"DESCENDING"},aa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ca=function(t,e){this.T=t,this.qt=e};function ha(t,e){return t.qt?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function fa(t,e){return t.qt?e.toBase64():e.toUint8Array()}function la(t){return Yr(!!t),Ri.j((t=Zi(t),new Ci(t.seconds,t.nanos)))}function pa(t,e){return new Mi(["projects",t.projectId,"databases",t.database]).child("documents").child(e).ot()}function da(t){return Yr(La(t=Mi.ct(t))),t}function ya(t,e){return pa(t.T,e.path)}function va(t,e){if((e=da(e)).get(1)!==t.T.projectId)throw new si(oi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.T.projectId);if(e.get(3)!==t.T.database)throw new si(oi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.T.database);return new Fi(wa(e))}function ga(t,e){return pa(t.T,e)}function ma(t){return 4===(t=da(t)).length?Mi.at():wa(t)}function ba(t){return new Mi(["projects",t.T.projectId,"databases",t.T.database]).ot()}function wa(t){return Yr(4<t.length&&"documents"===t.get(4)),t.X(5)}function Ea(t,e,n){return{name:ya(t,e),fields:n.proto.mapValue.fields}}function Ia(t,e,n){var r=va(t,e.name),t=la(e.updateTime),e=new bo({mapValue:{fields:e.fields}});return new Ao(r,t,e,{hasCommittedMutations:!!n})}function _a(t,e){var n,r,i;if(e instanceof uu)n={update:Ea(t,e.key,e.value)};else if(e instanceof bu)n={delete:ya(t,e.key)};else if(e instanceof au)n={update:Ea(t,e.key,e.data),updateMask:(i=e.zt,r=[],i.fields.forEach(function(t){return r.push(t.ot())}),{fieldPaths:r})};else{if(!(e instanceof wu))return Xr();n={verify:ya(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Vs)return{fieldPath:t.field.ot(),setToServerValue:"REQUEST_TIME"};if(e instanceof Us)return{fieldPath:t.field.ot(),appendMissingElements:{values:e.elements}};if(e instanceof Hs)return{fieldPath:t.field.ot(),removeAllFromArray:{values:e.elements}};if(e instanceof Js)return{fieldPath:t.field.ot(),increment:e.Qt};throw Xr()})),e.Gt.Wt||(n.currentDocument=void 0!==(i=e.Gt).updateTime?{updateTime:ha(e=t,(t=i.updateTime).G())}:void 0!==i.exists?{exists:i.exists}:Xr()),n}function Ta(i,t){var e=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?$s.updateTime(la(s.updateTime)):void 0!==s.exists?$s.exists(s.exists):$s.jt():$s.jt(),n=t.updateTransforms?t.updateTransforms.map(function(t){return e=i,r=null,"setToServerValue"in(t=t)?(Yr("REQUEST_TIME"===t.setToServerValue),r=new Vs):"appendMissingElements"in t?(n=t.appendMissingElements.values||[],r=new Us(n)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new Hs(n)):"increment"in t?r=new Js(e,t.increment):Xr(),t=Ui._t(t.fieldPath),new Zs(t,r);var e,n,r}):[];if(t.update){t.update.name;var r=va(i,t.update.name),o=new bo({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(s=t.updateMask.fieldPaths||[],new Xi(s.map(function(t){return Ui._t(t)})));return new au(r,o,s,e,n)}return new uu(r,o,e,n)}return t.delete?(n=va(i,t.delete),new bu(n,e)):t.verify?(t=va(i,t.verify),new wu(t,e)):Xr()}function Na(t,e){return{documents:[ga(t,e.path)]}}function Aa(t,e){var n={structuredQuery:{}},r=e.path;return null!==e.collectionGroup?(n.parent=ga(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ga(t,r.Z()),n.structuredQuery.from=[{collectionId:r.et()}]),(r=function(t){if(0!==t.length)return 1===(t=t.map(function(t){if("=="===t.op){if(go(t.value))return{unaryFilter:{field:Da(t.field),op:"IS_NAN"}};if(vo(t.value))return{unaryFilter:{field:Da(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(go(t.value))return{unaryFilter:{field:Da(t.field),op:"IS_NOT_NAN"}};if(vo(t.value))return{unaryFilter:{field:Da(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Da(t.field),op:(e=t.op,aa[e]),value:t.value}};var e})).length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(e.filters))&&(n.structuredQuery.where=r),(r=function(t){if(0!==t.length)return t.map(function(t){return{field:Da(t.field),direction:(t=t.dir,ua[t])}})}(e.orderBy))&&(n.structuredQuery.orderBy=r),r=e.limit,null!==(r=t.qt||ro(r)?r:{value:r})&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Sa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Sa(e.endAt)),n}function xa(t){var e=ma(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Yr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ka(t.unaryFilter.field);return Uo.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ka(t.unaryFilter.field);return Uo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":return n=ka(t.unaryFilter.field),Uo.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return t=ka(t.unaryFilter.field),Uo.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Xr()}}(e)]:void 0!==e.fieldFilter?[(n=e,Uo.create(ka(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Xr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Xr():[];var n}(n.where)),t=[],n.orderBy&&(t=n.orderBy.map(function(t){return new hs(ka((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e})),r=null,n.limit&&(r=ro(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=Oa(n.startAt));var u=null;return n.endAt&&(u=Oa(n.endAt)),ds(e,i,t,o,r,"F",s,u)}function Sa(t){return{before:t.before,values:t.position}}function Oa(t){var e=!!t.before,t=t.values||[];return new is(t,e)}function Da(t){return{fieldPath:t.ot()}}function ka(t){return Ui._t(t.fieldPath)}function La(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Pa,Ca=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Ra=(Ga.prototype.catch=function(t){return this.next(void 0,t)},Ga.prototype.next=function(r,i){var o=this;return this.Fn&&Xr(),this.Fn=!0,this.Nn?this.error?this.On(i,this.error):this.kn(r,this.result):new Ga(function(e,n){o.Cn=function(t){o.kn(r,t).next(e,n)},o.xn=function(t){o.On(i,t).next(e,n)}})},Ga.prototype.Mn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Ga.prototype.$n=function(t){try{var e=t();return e instanceof Ga?e:Ga.resolve(e)}catch(t){return Ga.reject(t)}},Ga.prototype.kn=function(t,e){return t?this.$n(function(){return t(e)}):Ga.resolve(e)},Ga.prototype.On=function(t,e){return t?this.$n(function(){return t(e)}):Ga.reject(e)},Ga.resolve=function(n){return new Ga(function(t,e){t(n)})},Ga.reject=function(n){return new Ga(function(t,e){e(n)})},Ga.Ln=function(t){return new Ga(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Ga.Bn=function(t){for(var n=Ga.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Ga.resolve(t):e()})}(r[e]);return n},Ga.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Ln(i)},Ga),Ma=(Ha.open=function(t,e,n,r){try{return new Ha(e,t.transaction(r,n))}catch(t){throw new Fa(e,t)}},Object.defineProperty(Ha.prototype,"Un",{get:function(){return this.qn.promise},enumerable:!1,configurable:!0}),Ha.prototype.abort=function(t){t&&this.qn.reject(t),this.aborted||(Kr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ha.prototype.store=function(t){return t=this.transaction.objectStore(t),new za(t)},Ha),Va=(Ba.delete=function(t){return Kr("SimpleDb","Removing database:",t),Wa(window.indexedDB.deleteDatabase(t)).Mn()},Ba.jn=function(){if("undefined"==typeof indexedDB)return!1;if(Ba.Wn())return!0;var t=p(),e=0<(n=Ba.Kn(t))&&n<10,n=0<(n=Ba.Gn(t))&&n<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||n)},Ba.Wn=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.zn)},Ba.Hn=function(t,e){return t.store(e)},Ba.Kn=function(t){return t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1",Number(t)},Ba.Gn=function(t){return t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1",Number(t)},Ba.prototype.Jn=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Kr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result,e(t)},r.onblocked=function(){n(new Fa(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){"VersionError"===(t=t.target.error).name?n(new si(oi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Fa(o,t))},r.onupgradeneeded=function(t){Kr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.Qn.Yn(e,r.transaction,t.oldVersion,i.version).next(function(){Kr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Xn&&(this.db.onversionchange=function(t){return i.Xn(t)}),this.db)]}})})},Ba.prototype.Zn=function(e){this.Xn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Ba.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Jn(u)];case 2:return s.db=t.sent(),e=Ma.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),Ra.reject(t)}).Mn(),r={},n.catch(function(){}),[4,e.Un];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,Kr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Ba.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Ba),Ua=(Object.defineProperty(ja.prototype,"Nn",{get:function(){return this.es},enumerable:!1,configurable:!0}),Object.defineProperty(ja.prototype,"ss",{get:function(){return this.ns},enumerable:!1,configurable:!0}),Object.defineProperty(ja.prototype,"cursor",{set:function(t){this.ts=t},enumerable:!1,configurable:!0}),ja.prototype.done=function(){this.es=!0},ja.prototype.rs=function(t){this.ns=t},ja.prototype.delete=function(){return Wa(this.ts.delete())},ja),Fa=(h(qa,Pa=si),qa);function qa(t,e){var n=this;return(n=Pa.call(this,oi.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function ja(t){this.ts=t,this.es=!1,this.ns=null}function Ba(t,e,n){this.name=t,this.version=e,this.Qn=n,12.2===Ba.Kn(p())&&zr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Ha(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.qn=new Ca,this.transaction.oncomplete=function(){n.qn.resolve()},this.transaction.onabort=function(){t.error?n.qn.reject(new Fa(e,t.error)):n.qn.resolve()},this.transaction.onerror=function(t){t=Ya(t.target.error),n.qn.reject(new Fa(e,t))}}function Ga(t){var e=this;this.Cn=null,this.xn=null,this.result=void 0,this.error=void 0,this.Nn=!1,this.Fn=!1,t(function(t){e.Nn=!0,e.result=t,e.Cn&&e.Cn(t)},function(t){e.Nn=!0,e.error=t,e.xn&&e.xn(t)})}function Ka(t){return"IndexedDbTransactionError"===t.name}var za=(Ja.prototype.put=function(t,e){return Wa(t=void 0!==e?(Kr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Kr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Ja.prototype.add=function(t){return Kr("SimpleDb","ADD",this.store.name,t,t),Wa(this.store.add(t))},Ja.prototype.get=function(e){var n=this;return Wa(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Kr("SimpleDb","GET",n.store.name,e,t),t})},Ja.prototype.delete=function(t){return Kr("SimpleDb","DELETE",this.store.name,t),Wa(this.store.delete(t))},Ja.prototype.count=function(){return Kr("SimpleDb","COUNT",this.store.name),Wa(this.store.count())},Ja.prototype.os=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.cs(e,function(t,e){n.push(e)}).next(function(){return n})},Ja.prototype.us=function(t,e){return Kr("SimpleDb","DELETE ALL",this.store.name),(e=this.options(t,e)).hs=!1,e=this.cursor(e),this.cs(e,function(t,e,n){return n.delete()})},Ja.prototype.ls=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.cs(n,e)},Ja.prototype._s=function(r){var t=this.cursor({});return new Ra(function(n,e){t.onerror=function(t){t=Ya(t.target.error),e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Ja.prototype.cs=function(t,i){var o=[];return new Ra(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new Ua(n),(t=i(n.primaryKey,n.value,e))instanceof Ra&&(t=t.catch(function(t){return e.done(),Ra.reject(t)}),o.push(t)),e.Nn?r():null===e.ss?n.continue():n.continue(e.ss)):r()}}).next(function(){return Ra.Ln(o)})},Ja.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Ja.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.hs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Ja);function Ja(t){this.store=t}function Wa(t){return new Ra(function(e,n){t.onsuccess=function(t){t=t.target.result,e(t)},t.onerror=function(t){t=Ya(t.target.error),n(t)}})}var Xa=!1;function Ya(t){var e=Va.Kn(p());if(12.2<=e&&e<13&&(e="An internal error was encountered in the Indexed Database server",0<=t.message.indexOf(e))){var n=new si("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Xa||(Xa=!0,setTimeout(function(){throw n},0)),n}return t}var Qa=(Za.Is=function(t,e,n,r,i){return(i=new Za(t,e,Date.now()+n,r,i)).start(n),i},Za.prototype.start=function(t){var e=this;this.As=setTimeout(function(){return e.Rs()},t)},Za.prototype.Ps=function(){return this.Rs()},Za.prototype.cancel=function(t){null!==this.As&&(this.clearTimeout(),this.Es.reject(new si(oi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Za.prototype.Rs=function(){var e=this;this.fs.ys(function(){return null!==e.As?(e.clearTimeout(),e.op().then(function(t){return e.Es.resolve(t)})):Promise.resolve()})},Za.prototype.clearTimeout=function(){null!==this.As&&(this.Ts(this),clearTimeout(this.As),this.As=null)},Za);function Za(t,e,n,r,i){this.fs=t,this.ds=e,this.ws=n,this.op=r,this.Ts=i,this.Es=new Ca,this.then=this.Es.promise.then.bind(this.Es.promise),this.Es.promise.catch(function(t){})}function $a(t,e){if(zr("AsyncQueue",e+": "+t),Ka(t))return new si(oi.UNAVAILABLE,e+": "+t);throw t}var tc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",o=(ec.prototype.Vs=function(t){this.gs.push(t)},ec.prototype.ps=function(){this.gs.forEach(function(t){return t()})},ec);function ec(){this.gs=[]}function nc(t){for(var o="",e=0;e<t.length;e++)0<o.length&&(o=rc(o)),o=function(t){for(var e=o,n=t.length,r=0;r<n;r++){var i=t.charAt(r);switch(i){case"\0":e+="";break;case"":e+="";break;default:e+=i}}return e}(t.get(e));return rc(o)}function rc(t){return t+""}function ic(t){var e=t.length;if(Yr(2<=e),2===e)return Yr(""===t.charAt(0)&&""===t.charAt(1)),Mi.at();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Xr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Xr()}o=s+2}return new Mi(r)}function oc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var sc=function(t,e){this.seconds=t,this.nanoseconds=e};function uc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}function ac(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}oc.store="owner",oc.key="owner",uc.store="mutationQueues",uc.keyPath="userId",ac.store="mutations",ac.keyPath="batchId",ac.userMutationsIndex="userMutationsIndex",ac.userMutationsKeyPath=["userId","batchId"];var cc=(hc.prefixForUser=function(t){return[t]},hc.prefixForPath=function(t,e){return[t,nc(e)]},hc.key=function(t,e,n){return[t,nc(e),n]},hc);function hc(){}function fc(t,e){this.path=t,this.readTime=e}function lc(t,e){this.path=t,this.version=e}cc.store="documentMutations",cc.PLACEHOLDER=new cc;var pc=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};function dc(t){this.byteSize=t}function yc(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}pc.store="remoteDocuments",pc.readTimeIndex="readTimeIndex",pc.readTimeIndexPath="readTime",pc.collectionReadTimeIndex="collectionReadTimeIndex",pc.collectionReadTimeIndexPath=["parentPath","readTime"],dc.store="remoteDocumentGlobal",dc.key="remoteDocumentGlobalKey",yc.store="targets",yc.keyPath="targetId",yc.queryTargetsIndexName="queryTargetsIndex",yc.queryTargetsKeyPath=["canonicalId","targetId"];var vc=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};function gc(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function mc(t,e){this.collectionId=t,this.parent=e}function bc(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}function wc(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}function Ec(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}vc.store="targetDocuments",vc.keyPath=["targetId","path"],vc.documentTargetsIndex="documentTargetsIndex",vc.documentTargetsKeyPath=["path","targetId"],gc.key="targetGlobalKey",gc.store="targetGlobal",mc.store="collectionParents",mc.keyPath=["collectionId","parent"],bc.store="clientMetadata",bc.keyPath="clientId",wc.store="bundles",wc.keyPath="bundleId",Ec.store="namedQueries",Ec.keyPath="name";var Ic,_c=f(f(f(f([uc.store,ac.store,cc.store,pc.store,yc.store,oc.store,gc.store,vc.store],[bc.store]),[dc.store]),[mc.store]),[wc.store,Ec.store]),Tc=(h(Nc,Ic=o),Nc);function Nc(t,e){var n=this;return(n=Ic.call(this)||this).bs=t,n.vs=e,n}function Ac(t,e){return Va.Hn(t.bs,e)}var xc=(kc.prototype.Ds=function(t,e,n){for(var r,i,o,s,u,a,c=n.Cs,h=0;h<this.mutations.length;h++){var f=this.mutations[h];f.key.isEqual(t)&&(r=f,u=e,i=c[h],f=a=void 0,e=r instanceof uu?(a=i,f=(o=r).value,a.transformResults&&(s=lu(o.fieldTransforms,u,a.transformResults),f=du(o.fieldTransforms,f,s)),new Ao(o.key,a.version,f,{hasCommittedMutations:!0})):r instanceof au?(a=u,f=i,eu((u=r).Gt,a)?(a=fu(u,a,f.transformResults?lu(u.fieldTransforms,a,f.transformResults):[]),new Ao(u.key,f.version,a,{hasCommittedMutations:!0})):new So(u.key,f.version)):new xo(r.key,i.version,{hasCommittedMutations:!0}))}return e},kc.prototype.xs=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(i=r[n]).key.isEqual(t)&&(e=nu(i,e,0,this.Ss));for(var i,o=0,s=this.mutations;o<s.length;o++)(i=s[o]).key.isEqual(t)&&(e=nu(i,e,0,this.Ss));return e},kc.prototype.Ns=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.xs(t.key,n.get(t.key));e&&(i=i.Ht(t.key,e))}),i},kc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},qu())},kc.prototype.isEqual=function(t){return this.batchId===t.batchId&&ti(this.mutations,t.mutations,ru)&&ti(this.baseMutations,t.baseMutations,ru)},kc),Sc=(Dc.from=function(t,e,n){Yr(t.mutations.length===n.length);for(var r=Uu,i=t.mutations,o=0;o<i.length;o++)r=r.Ht(i[o].key,n[o].version);return new Dc(t,e,n,r)},Dc),Oc=function(t){this.ks=t};function Dc(t,e,n,r){this.batch=t,this.Fs=e,this.Cs=n,this.Os=r}function kc(t,e,n,r){this.batchId=t,this.Ss=e,this.baseMutations=n,this.mutations=r}function Lc(t,e){if(e.document)return Ia(t.ks,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Fi.Et(e.noDocument.path),r=Vc(e.noDocument.readTime);return new xo(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}return e.unknownDocument?(n=Fi.Et(e.unknownDocument.path),r=Vc(e.unknownDocument.version),new So(n,r)):Xr()}function Pc(t,e,n){var r=Cc(n),n=e.key.path.Z().rt();if(e instanceof Ao){var i={name:ya(o=t.ks,(s=e).key),fields:s.vt().mapValue.fields,updateTime:ha(o,s.version.G())},o=e.hasCommittedMutations;return new pc(null,null,i,o,r,n)}if(e instanceof xo){var s=e.key.path.rt(),i=Mc(e.version),o=e.hasCommittedMutations;return new pc(null,new fc(s,i),null,o,r,n)}return e instanceof So?(o=e.key.path.rt(),e=Mc(e.version),new pc(new lc(o,e),null,null,!0,r,n)):Xr()}function Cc(t){return[(t=t.G()).seconds,t.nanoseconds]}function Rc(t){return t=new Ci(t[0],t[1]),Ri.j(t)}function Mc(t){return t=t.G(),new sc(t.seconds,t.nanoseconds)}function Vc(t){return t=new Ci(t.seconds,t.nanoseconds),Ri.j(t)}function Uc(e,t){for(var n=(t.baseMutations||[]).map(function(t){return Ta(e.ks,t)}),r=t.mutations.length-1;0<=r;--r){var i=t.mutations[r];void 0!==(null==i?void 0:i.transform)&&(t.mutations[r-1].updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r,1),--r)}var o=t.mutations.map(function(t){return Ta(e.ks,t)}),s=Ci.fromMillis(t.localWriteTimeMs);return new xc(t.batchId,s,n,o)}function Fc(t){var e=Vc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Vc(t.lastLimboFreeSnapshotVersion):Ri.min(),r=void 0!==t.query.documents?(Yr(1===(r=t.query).documents.length),Is(ys(ma(r.documents[0])))):Is(xa(t.query));return new Os(r,t.targetId,0,t.lastListenSequenceNumber,e,n,ni.fromBase64String(t.resumeToken))}function qc(t,e){var n=Mc(e.Mt),r=Mc(e.lastLimboFreeSnapshotVersion),i=(Mo(e.target)?Na:Aa)(t.ks,e.target),t=e.resumeToken.toBase64();return new yc(e.targetId,Co(e.target),n,t,e.sequenceNumber,r,i)}function jc(t){var e=xa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?_s(e,e.limit,"L"):e}var Bc=(Hc.prototype.Ms=function(t,e){return Gc(t).get(e).next(function(t){if(t)return{id:t.bundleId,createTime:Vc(t.createTime),version:t.version}})},Hc.prototype.$s=function(t,e){return Gc(t).put({bundleId:e.id,createTime:Mc(la(e.createTime)),version:e.version})},Hc.prototype.Ls=function(t,e){return Kc(t).get(e).next(function(t){if(t)return{name:t.name,query:jc(t.bundledQuery),readTime:Vc(t.readTime)}})},Hc.prototype.Bs=function(t,e){return Kc(t).put({name:e.name,readTime:Mc(la(e.readTime)),bundledQuery:e.bundledQuery})},Hc);function Hc(){}function Gc(t){return Ac(t,wc.store)}function Kc(t){return Ac(t,Ec.store)}var zc=(Qc.prototype.Us=function(t,e){return this.qs.add(e),Ra.resolve()},Qc.prototype.Qs=function(t,e){return Ra.resolve(this.qs.getEntries(e))},Qc),Jc=(Yc.prototype.add=function(t){var e=t.et(),n=t.Z(),r=this.index[e]||new Lu(Mi.J),t=!r.has(n);return this.index[e]=r.add(n),t},Yc.prototype.has=function(t){var e=t.et(),t=t.Z();return(e=this.index[e])&&e.has(t)},Yc.prototype.getEntries=function(t){return(this.index[t]||new Lu(Mi.J)).rt()},Yc),Wc=(Xc.prototype.Us=function(t,e){var n=this;if(this.Ks.has(e))return Ra.resolve();var r=e.et(),i=e.Z();return t.Vs(function(){n.Ks.add(e)}),i={collectionId:r,parent:nc(i)},Zc(t).put(i)},Xc.prototype.Qs=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[ei(i),""],!1,!0);return Zc(t).os(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(ic(r.parent))}return o})},Xc);function Xc(){this.Ks=new Jc}function Yc(){this.index={}}function Qc(){this.qs=new Jc}function Zc(t){return Ac(t,mc.store)}var $c={js:!1,Ws:0,Gs:0,zs:0},th=(eh.Xs=function(t){return new eh(t,eh.Zs,eh.ti)},eh);function eh(t,e,n){this.Hs=t,this.Js=e,this.Ys=n}function nh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==oi.FAILED_PRECONDITION||e.message!==tc)throw e;return Kr("LocalStore","Unexpectedly lost primary lease"),[2]})})}th.Zs=10,th.ti=1e3,th.ei=new th(41943040,th.Zs,th.ti),th.ni=new th(-1,0,0);var rh=(oh.prototype.get=function(t){var e=this.si(t);if(void 0!==(e=this.ri[e]))for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.ii(i,t))return o}},oh.prototype.has=function(t){return void 0!==this.get(t)},oh.prototype.set=function(t,e){var n=this.si(t),r=this.ri[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.ii(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.ri[n]=[[t,e]]},oh.prototype.delete=function(t){var e=this.si(t),n=this.ri[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.ii(n[r][0],t))return 1===n.length?delete this.ri[e]:n.splice(r,1),!0;return!1},oh.prototype.forEach=function(s){Ji(this.ri,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];s(i,o)}})},oh.prototype.nt=function(){return Wi(this.ri)},oh),je=(ih.prototype.ai=function(t){return(t=this.oi.get(t))?t.readTime:Ri.min()},ih.prototype.ui=function(t,e){this.hi(),this.oi.set(t.key,{li:t,readTime:e})},ih.prototype._i=function(t,e){void 0===e&&(e=null),this.hi(),this.oi.set(t,{li:null,readTime:e})},ih.prototype.fi=function(t,e){this.hi();var n=this.oi.get(e);return void 0!==n?Ra.resolve(n.li):this.di(t,e)},ih.prototype.getEntries=function(t,e){return this.wi(t,e)},ih.prototype.apply=function(t){return this.hi(),this.ci=!0,this.Ti(t)},ih.prototype.hi=function(){},ih);function ih(){this.oi=new rh(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.ci=!1}function oh(t,e){this.si=t,this.ii=e,this.ri={}}function sh(t,e,n){var r=t.store(ac.store),i=t.store(cc.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.ls({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Yr(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],f=cc.key(e,h.key.path,n.batchId);o.push(i.delete(f)),u.push(h.key)}return Ra.Ln(o).next(function(){return u})}function uh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Xr();e=t.noDocument}return JSON.stringify(e).length}var ah=(ch.Ai=function(t,e,n,r){return Yr(""!==t.uid),new ch(t.A()?t.uid:"",e,n,r)},ch.prototype.Ri=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fh(t).ls({index:ac.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},ch.prototype.Pi=function(d,y,v,g){var m=this,b=lh(d),w=fh(d);return w.add({}).next(function(t){Yr("number"==typeof t);for(var e,n,r,i,o,s=new xc(t,y,v,g),u=(e=m.Kt,n=m.userId,i=(r=s).baseMutations.map(function(t){return _a(e.ks,t)}),o=r.mutations.map(function(t){return _a(e.ks,t)}),new ac(n,r.batchId,r.Ss.toMillis(),i,o)),a=[],c=new Lu(function(t,e){return $r(t.ot(),e.ot())}),h=0,f=g;h<f.length;h++){var l=f[h],p=cc.key(m.userId,l.key.path,t),c=c.add(l.key.path.Z());a.push(w.put(u)),a.push(b.put(p,cc.PLACEHOLDER))}return c.forEach(function(t){a.push(m.Ei.Us(d,t))}),d.Vs(function(){m.mi[t]=s.keys()}),Ra.Ln(a).next(function(){return s})})},ch.prototype.yi=function(t,e){var n=this;return fh(t).get(e).next(function(t){return t?(Yr(t.userId===n.userId),Uc(n.Kt,t)):null})},ch.prototype.gi=function(t,e){var n=this;return this.mi[e]?Ra.resolve(this.mi[e]):this.yi(t,e).next(function(t){return t?(t=t.keys(),n.mi[e]=t):null})},ch.prototype.Vi=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return fh(t).ls({index:ac.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Yr(e.batchId>=i),o=Uc(r.Kt,e)),n.done()}).next(function(){return o})},ch.prototype.pi=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return fh(t).ls({index:ac.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},ch.prototype.bi=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fh(t).os(ac.userMutationsIndex,n).next(function(t){return t.map(function(t){return Uc(e.Kt,t)})})},ch.prototype.vi=function(o,s){var u=this,t=cc.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return lh(o).ls({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=ic(i);if(r===u.userId&&s.path.isEqual(i))return fh(o).get(t).next(function(t){if(!t)throw Xr();Yr(t.userId===u.userId),a.push(Uc(u.Kt,t))});n.done()}).next(function(){return a})},ch.prototype.Si=function(e,t){var s=this,u=new Lu($r),n=[];return t.forEach(function(o){var t=cc.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=lh(e).ls({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=ic(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),Ra.Ln(n).next(function(){return s.Di(e,u)})},ch.prototype.Ci=function(t,e){var o=this,s=e.path,u=s.length+1,e=cc.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new Lu($r);return lh(t).ls({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=ic(i);r===o.userId&&s.st(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.Di(t,a)})},ch.prototype.Di=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(fh(e).get(t).next(function(t){if(null===t)throw Xr();Yr(t.userId===n.userId),r.push(Uc(n.Kt,t))}))}),Ra.Ln(i).next(function(){return r})},ch.prototype.xi=function(e,n){var r=this;return sh(e.bs,this.userId,n).next(function(t){return e.Vs(function(){r.Ni(n.batchId)}),Ra.forEach(t,function(t){return r.Ii.Fi(e,t)})})},ch.prototype.Ni=function(t){delete this.mi[t]},ch.prototype.Oi=function(e){var i=this;return this.Ri(e).next(function(t){if(!t)return Ra.resolve();var t=IDBKeyRange.lowerBound(cc.prefixForUser(i.userId)),r=[];return lh(e).ls({range:t},function(t,e,n){t[0]===i.userId?(t=ic(t[1]),r.push(t)):n.done()}).next(function(){Yr(0===r.length)})})},ch.prototype.ki=function(t,e){return hh(t,this.userId,e)},ch.prototype.Mi=function(t){var e=this;return ph(t).get(this.userId).next(function(t){return t||new uc(e.userId,-1,"")})},ch);function ch(t,e,n,r){this.userId=t,this.Kt=e,this.Ei=n,this.Ii=r,this.mi={}}function hh(t,o,e){var s=(e=cc.prefixForPath(o,e.path))[1],e=IDBKeyRange.lowerBound(e),u=!1;return lh(t).ls({range:e,hs:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function fh(t){return Ac(t,ac.store)}function lh(t){return Ac(t,cc.store)}function ph(t){return Ac(t,uc.store)}var dh=(gh.prototype.next=function(){return this.$i+=2,this.$i},gh.Li=function(){return new gh(0)},gh.Bi=function(){return new gh(-1)},gh),yh=(vh.prototype.qi=function(n){var r=this;return this.Ui(n).next(function(t){var e=new dh(t.highestTargetId);return t.highestTargetId=e.next(),r.Qi(n,t).next(function(){return t.highestTargetId})})},vh.prototype.Ki=function(t){return this.Ui(t).next(function(t){return Ri.j(new Ci(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},vh.prototype.ji=function(t){return this.Ui(t).next(function(t){return t.highestListenSequenceNumber})},vh.prototype.Wi=function(e,n,r){var i=this;return this.Ui(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.G()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Qi(e,t)})},vh.prototype.Gi=function(e,n){var r=this;return this.zi(e,n).next(function(){return r.Ui(e).next(function(t){return t.targetCount+=1,r.Hi(n,t),r.Qi(e,t)})})},vh.prototype.Ji=function(t,e){return this.zi(t,e)},vh.prototype.Yi=function(e,t){var n=this;return this.Xi(e,t.targetId).next(function(){return mh(e).delete(t.targetId)}).next(function(){return n.Ui(e)}).next(function(t){return Yr(0<t.targetCount),--t.targetCount,n.Qi(e,t)})},vh.prototype.Zi=function(n,r,i){var o=this,s=0,u=[];return mh(n).ls(function(t,e){(e=Fc(e)).sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.Yi(n,e)))}).next(function(){return Ra.Ln(u)}).next(function(){return s})},vh.prototype.mn=function(t,n){return mh(t).ls(function(t,e){e=Fc(e),n(e)})},vh.prototype.Ui=function(t){return bh(t).get(gc.key).next(function(t){return Yr(null!==t),t})},vh.prototype.Qi=function(t,e){return bh(t).put(gc.key,e)},vh.prototype.zi=function(t,e){return mh(t).put(qc(this.Kt,e))},vh.prototype.Hi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},vh.prototype.tr=function(t){return this.Ui(t).next(function(t){return t.targetCount})},vh.prototype.er=function(t,r){var e=Co(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return mh(t).ls({range:e,index:yc.queryTargetsIndexName},function(t,e,n){e=Fc(e),Ro(r,e.target)&&(i=e,n.done())}).next(function(){return i})},vh.prototype.nr=function(n,t,r){var i=this,o=[],s=wh(n);return t.forEach(function(t){var e=nc(t.path);o.push(s.put(new vc(r,e))),o.push(i.Ii.sr(n,r,t))}),Ra.Ln(o)},vh.prototype.ir=function(n,t,r){var i=this,o=wh(n);return Ra.forEach(t,function(t){var e=nc(t.path);return Ra.Ln([o.delete([r,e]),i.Ii.rr(n,r,t)])})},vh.prototype.Xi=function(t,e){return t=wh(t),e=IDBKeyRange.bound([e],[e+1],!1,!0),t.delete(e)},vh.prototype.cr=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=wh(t),r=qu();return t.ls({range:e,hs:!0},function(t,e,n){t=ic(t[1]),t=new Fi(t),r=r.add(t)}).next(function(){return r})},vh.prototype.ki=function(t,e){var e=nc(e.path),e=IDBKeyRange.bound([e],[ei(e)],!1,!0),i=0;return wh(t).ls({index:vc.documentTargetsIndex,hs:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},vh.prototype.Dn=function(t,e){return mh(t).get(e).next(function(t){return t?Fc(t):null})},vh);function vh(t,e){this.Ii=t,this.Kt=e}function gh(t){this.$i=t}function mh(t){return Ac(t,yc.store)}function bh(t){return Ac(t,gc.store)}function wh(t){return Ac(t,vc.store)}function Eh(t,e){var n=t[0],r=t[1],t=e[0],e=e[1];return 0===(t=$r(n,t))?$r(r,e):t}var Ih=(Oh.prototype.hr=function(){return++this.ur},Oh.prototype.lr=function(t){var e=[t,this.hr()];this.buffer.size<this.ar?this.buffer=this.buffer.add(e):Eh(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Oh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Oh),_h=(Sh.prototype.start=function(t){-1!==this._r.params.Hs&&this.Tr(t)},Sh.prototype.stop=function(){this.wr&&(this.wr.cancel(),this.wr=null)},Object.defineProperty(Sh.prototype,"Er",{get:function(){return null!==this.wr},enumerable:!1,configurable:!0}),Sh.prototype.Tr=function(n){var t=this,e=this.dr?3e5:6e4;Kr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.wr=this.fs.Ir("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.wr=null,this.dr=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.mr(this._r)];case 2:return t.sent(),[3,7];case 3:return Ka(e=t.sent())?(Kr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,nh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Tr(n)];case 8:return t.sent(),[2]}})})})},Sh),Th=(xh.prototype.Rr=function(t,e){return this.Ar.Pr(t).next(function(t){return Math.floor(e/100*t)})},xh.prototype.yr=function(t,e){var n=this;if(0===e)return Ra.resolve(Ai.U);var r=new Ih(e);return this.Ar.mn(t,function(t){return r.lr(t.sequenceNumber)}).next(function(){return n.Ar.gr(t,function(t){return r.lr(t)})}).next(function(){return r.maxValue})},xh.prototype.Zi=function(t,e,n){return this.Ar.Zi(t,e,n)},xh.prototype.Vr=function(t,e){return this.Ar.Vr(t,e)},xh.prototype.pr=function(e,n){var r=this;return-1===this.params.Hs?(Kr("LruGarbageCollector","Garbage collection skipped; disabled"),Ra.resolve($c)):this.br(e).next(function(t){return t<r.params.Hs?(Kr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Hs),$c):r.vr(e,n)})},xh.prototype.br=function(t){return this.Ar.br(t)},xh.prototype.vr=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.Rr(e,this.params.Js).next(function(t){return i=t>h.params.Ys?(Kr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Ys+" from "+t),h.params.Ys):t,s=Date.now(),h.yr(e,i)}).next(function(t){return r=t,u=Date.now(),h.Zi(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.Vr(e,r)}).next(function(t){return c=Date.now(),Gr()<=l.DEBUG&&Kr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),Ra.resolve({js:!0,Ws:i,Gs:o,zs:t})})},xh),Nh=(Ah.prototype.Pr=function(t){var n=this.Sr(t);return this.db.Dr().tr(t).next(function(e){return n.next(function(t){return e+t})})},Ah.prototype.Sr=function(t){var e=0;return this.gr(t,function(t){e++}).next(function(){return e})},Ah.prototype.mn=function(t,e){return this.db.Dr().mn(t,e)},Ah.prototype.gr=function(t,n){return this.Cr(t,function(t,e){return n(e)})},Ah.prototype.sr=function(t,e,n){return Dh(t,n)},Ah.prototype.rr=function(t,e,n){return Dh(t,n)},Ah.prototype.Zi=function(t,e,n){return this.db.Dr().Zi(t,e,n)},Ah.prototype.Fi=Dh,Ah.prototype.Nr=function(t,e){return r=e,i=!1,ph(n=t)._s(function(t){return hh(n,t,r).next(function(t){return t&&(i=!0),Ra.resolve(!t)})}).next(function(){return i});var n,r,i},Ah.prototype.Vr=function(n,r){var i=this,o=this.db.Or().Fr(),s=[],u=0;return this.Cr(n,function(e,t){t<=r&&(t=i.Nr(n,e).next(function(t){if(!t)return u++,o.fi(n,e).next(function(){return o._i(e),wh(n).delete([0,nc(e.path)])})}),s.push(t))}).next(function(){return Ra.Ln(s)}).next(function(){return o.apply(n)}).next(function(){return u})},Ah.prototype.removeTarget=function(t,e){return e=e.$t(t.vs),this.db.Dr().Ji(t,e)},Ah.prototype.kr=Dh,Ah.prototype.Cr=function(t,r){var i,t=wh(t),o=Ai.U;return t.ls({index:vc.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==Ai.U&&r(new Fi(ic(i)),o),o=e,i=t):o=Ai.U}).next(function(){o!==Ai.U&&r(new Fi(ic(i)),o)})},Ah.prototype.br=function(t){return this.db.Or().Mr(t)},Ah);function Ah(t,e){this.db=t,this._r=new Th(this,e)}function xh(t,e){this.Ar=t,this.params=e}function Sh(t,e){this._r=t,this.fs=e,this.dr=!1,this.wr=null}function Oh(t){this.ar=t,this.buffer=new Lu(Eh),this.ur=0}function Dh(t,e){return wh(t).put((t=t.vs,new vc(0,nc(e.path),t)))}var kh,Lh=(Rh.prototype.ui=function(t,e,n){return Vh(t).put(Uh(e),n)},Rh.prototype._i=function(t,e){return t=Vh(t),e=Uh(e),t.delete(e)},Rh.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.$r(e,t)})},Rh.prototype.fi=function(t,e){var n=this;return Vh(t).get(Uh(e)).next(function(t){return n.Lr(t)})},Rh.prototype.Br=function(t,e){var n=this;return Vh(t).get(Uh(e)).next(function(t){var e=n.Lr(t);return e?{li:e,size:uh(t)}:null})},Rh.prototype.getEntries=function(t,e){var n=this,r=Cu;return this.qr(t,e,function(t,e){e=n.Lr(e),r=r.Ht(t,e)}).next(function(){return r})},Rh.prototype.Ur=function(t,e){var r=this,i=Cu,o=new Nu(Fi.J);return this.qr(t,e,function(t,e){var n=r.Lr(e);o=n?(i=i.Ht(t,n),o.Ht(t,uh(e))):(i=i.Ht(t,null),o.Ht(t,0))}).next(function(){return{Qr:i,Kr:o}})},Rh.prototype.qr=function(t,e,i){if(e.nt())return Ra.resolve();var n=IDBKeyRange.bound(e.first().path.rt(),e.last().path.rt()),o=e.ee(),s=o.ce();return Vh(t).ls({range:n},function(t,e,n){for(var r=Fi.Et(t);s&&Fi.J(s,r)<0;)i(s,null),s=o.ce();s&&s.isEqual(r)&&(i(s,e),s=o.ae()?o.ce():null),s?n.rs(s.path.rt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.ae()?o.ce():null})},Rh.prototype.jr=function(t,r,e){var n,i=this,o=Vu,s=r.path.length+1,u={};return e.isEqual(Ri.min())?(n=r.path.rt(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.rt(),e=Cc(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=pc.collectionReadTimeIndex),Vh(t).ls(u,function(t,e,n){t.length===s&&(e=Lc(i.Kt,e),r.path.st(e.key.path)?e instanceof Ao&&xs(r,e)&&(o=o.Ht(e.key,e)):n.done())}).next(function(){return o})},Rh.prototype.Fr=function(t){return new Ph(this,!!t&&t.Wr)},Rh.prototype.Mr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Rh.prototype.getMetadata=function(t){return Mh(t).get(dc.key).next(function(t){return Yr(!!t),t})},Rh.prototype.$r=function(t,e){return Mh(t).put(dc.key,e)},Rh.prototype.Lr=function(t){return!t||(t=Lc(this.Kt,t))instanceof xo&&t.version.isEqual(Ri.min())?null:t},Rh),Ph=(h(Ch,kh=je),Ch.prototype.Ti=function(i){var o=this,s=[],u=0,a=new Lu(function(t,e){return $r(t.ot(),e.ot())});return this.oi.forEach(function(t,e){var n,r=o.zr.get(t);e.li?(n=Pc(o.Gr.Kt,e.li,o.ai(t)),a=a.add(t.path.Z()),e=uh(n),u+=e-r,s.push(o.Gr.ui(i,t,n))):(u-=r,o.Wr?(r=Pc(o.Gr.Kt,new xo(t,Ri.min()),o.ai(t)),s.push(o.Gr.ui(i,t,r))):s.push(o.Gr._i(i,t)))}),a.forEach(function(t){s.push(o.Gr.Ei.Us(i,t))}),s.push(this.Gr.updateMetadata(i,u)),Ra.Ln(s)},Ch.prototype.di=function(t,e){var n=this;return this.Gr.Br(t,e).next(function(t){return null===t?(n.zr.set(e,0),null):(n.zr.set(e,t.size),t.li)})},Ch.prototype.wi=function(t,e){var n=this;return this.Gr.Ur(t,e).next(function(t){var e=t.Qr;return t.Kr.forEach(function(t,e){n.zr.set(t,e)}),e})},Ch);function Ch(t,e){var n=this;return(n=kh.call(this)||this).Gr=t,n.Wr=e,n.zr=new rh(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function Rh(t,e){this.Kt=t,this.Ei=e}function Mh(t){return Ac(t,dc.store)}function Vh(t){return Ac(t,pc.store)}function Uh(t){return t.path.rt()}var Fh=(qh.prototype.Yn=function(e,n,t,r){var i=this;Yr(t<r&&0<=t&&r<=11);var o=new Ma("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(oc.store),(s=e).createObjectStore(uc.store,{keyPath:uc.keyPath}),s.createObjectStore(ac.store,{keyPath:ac.keyPath,autoIncrement:!0}).createIndex(ac.userMutationsIndex,ac.userMutationsKeyPath,{unique:!0}),s.createObjectStore(cc.store),jh(e),e.createObjectStore(pc.store));var s,u=Ra.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(vc.store),s.deleteObjectStore(yc.store),s.deleteObjectStore(gc.store),jh(e)),u=u.next(function(){return t=o.store(gc.store),e=new gc(0,0,Ri.min().G(),0),t.put(gc.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(ac.store).os().next(function(t){n.deleteObjectStore(ac.store),n.createObjectStore(ac.store,{keyPath:ac.keyPath,autoIncrement:!0}).createIndex(ac.userMutationsIndex,ac.userMutationsKeyPath,{unique:!0});var e=r.store(ac.store),t=t.map(function(t){return e.put(t)});return Ra.Ln(t)});var n,r})),u=u.next(function(){e.createObjectStore(bc.store,{keyPath:bc.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.Hr(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore(dc.store),i.Jr(o)})),t<7&&7<=r&&(u=u.next(function(){return i.Yr(o)})),t<8&&8<=r&&(u=u.next(function(){return i.Xr(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(pc.store)).createIndex(pc.readTimeIndex,pc.readTimeIndexPath,{unique:!1}),t.createIndex(pc.collectionReadTimeIndex,pc.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.Zr(o)})),t<11&&11<=r&&(u=u.next(function(){e.createObjectStore(wc.store,{keyPath:wc.keyPath}),e.createObjectStore(Ec.store,{keyPath:Ec.keyPath})})),u},qh.prototype.Jr=function(e){var n=0;return e.store(pc.store).ls(function(t,e){n+=uh(e)}).next(function(){var t=new dc(n);return e.store(dc.store).put(dc.key,t)})},qh.prototype.Hr=function(n){var r=this,t=n.store(uc.store),i=n.store(ac.store);return t.os().next(function(t){return Ra.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.os(ac.userMutationsIndex,t).next(function(t){return Ra.forEach(t,function(t){return Yr(t.userId===e.userId),t=Uc(r.Kt,t),sh(n,e.userId,t).next(function(){})})})})})},qh.prototype.Yr=function(t){var o=t.store(vc.store),e=t.store(pc.store);return t.store(gc.store).get(gc.key).next(function(r){var i=[];return e.ls(function(t,e){var n=new Mi(t),t=[0,nc(n)];i.push(o.get(t).next(function(t){return t?Ra.resolve():o.put(new vc(0,nc(n),r.highestListenSequenceNumber))}))}).next(function(){return Ra.Ln(i)})})},qh.prototype.Xr=function(t,e){function r(t){if(i.add(t)){var e=t.et(),t=t.Z();return n.put({collectionId:e,parent:nc(t)})}}t.createObjectStore(mc.store,{keyPath:mc.keyPath});var n=e.store(mc.store),i=new Jc;return e.store(pc.store).ls({hs:!0},function(t,e){return r((t=new Mi(t)).Z())}).next(function(){return e.store(cc.store).ls({hs:!0},function(t,e){t[0];var n=t[1];return r((n=(t[2],ic(n))).Z())})})},qh.prototype.Zr=function(t){var n=this,r=t.store(yc.store);return r.ls(function(t,e){return e=Fc(e),e=qc(n.Kt,e),r.put(e)})},qh);function qh(t){this.Kt=t}function jh(t){t.createObjectStore(vc.store,{keyPath:vc.keyPath}).createIndex(vc.documentTargetsIndex,vc.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(yc.store,{keyPath:yc.keyPath}).createIndex(yc.queryTargetsIndexName,yc.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(gc.store)}var Bh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Hh=(Gh.prototype.start=function(){var e=this;return this.Io().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new si(oi.FAILED_PRECONDITION,Bh);return e.mo(),e.Ao(),e.Ro(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.fo.ji(t)})}).then(function(t){e.io=new Ai(t,e.no)}).then(function(){e.ro=!0}).catch(function(t){return e._o&&e._o.close(),Promise.reject(t)})},Gh.prototype.Po=function(n){var t=this;return this.ho=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.Er?[2,n(e)]:[2]})})},n(this.isPrimary)},Gh.prototype.yo=function(n){var t=this;this._o.Zn(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Gh.prototype.Vo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.eo.ys(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Er?[4,this.Io()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Gh.prototype.Io=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return zh(e).put(new bc(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.po(e).next(function(t){t||(n.isPrimary=!1,n.eo.bo(function(){return n.ho(!1)}))})}).next(function(){return n.vo(e)}).next(function(t){return n.isPrimary&&!t?n.So(e).next(function(){return!1}):!!t&&n.Do(e).next(function(){return!0})})}).catch(function(t){if(Ka(t))return Kr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Kr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.eo.bo(function(){return n.ho(t)}),n.isPrimary=t})},Gh.prototype.po=function(t){var e=this;return Kh(t).get(oc.key).next(function(t){return Ra.resolve(e.Co(t))})},Gh.prototype.xo=function(t){return zh(t).delete(this.clientId)},Gh.prototype.No=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Fo(this.uo,18e5)?[3,2]:(this.uo=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Ac(t,bc.store);return r.os().next(function(t){var e=o.Oo(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Ra.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Eo)for(n=0,r=e;n<r.length;n++)i=r[n],this.Eo.removeItem(this.ko(i.clientId));t.label=2;case 2:return[2]}})})},Gh.prototype.Ro=function(){var t=this;this.ao=this.eo.Ir("client_metadata_refresh",4e3,function(){return t.Io().then(function(){return t.No()}).then(function(){return t.Ro()})})},Gh.prototype.Co=function(t){return!!t&&t.ownerId===this.clientId},Gh.prototype.vo=function(e){var r=this;return this.so?Ra.resolve(!0):Kh(e).get(oc.key).next(function(t){if(null!==t&&r.Fo(t.leaseTimestampMs,5e3)&&!r.Mo(t.ownerId)){if(r.Co(t)&&r.networkEnabled)return!0;if(!r.Co(t)){if(!t.allowTabSynchronization)throw new si(oi.FAILED_PRECONDITION,Bh);return!1}}return!(!r.networkEnabled||!r.inForeground)||zh(e).os().next(function(t){return void 0===r.Oo(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&Kr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Gh.prototype.$o=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.ro=!1,this.Lo(),this.ao&&(this.ao.cancel(),this.ao=null),this.Bo(),this.qo(),[4,this._o.runTransaction("shutdown","readwrite",[oc.store,bc.store],function(t){var e=new Tc(t,Ai.U);return n.So(e).next(function(){return n.xo(e)})})];case 1:return t.sent(),this._o.close(),this.Uo(),[2]}})})},Gh.prototype.Oo=function(t,e){var n=this;return t.filter(function(t){return n.Fo(t.updateTimeMs,e)&&!n.Mo(t.clientId)})},Gh.prototype.Qo=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return zh(t).os().next(function(t){return e.Oo(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(Gh.prototype,"Er",{get:function(){return this.ro},enumerable:!1,configurable:!0}),Gh.prototype.Ko=function(t){return ah.Ai(t,this.Kt,this.Ei,this.Ii)},Gh.prototype.Dr=function(){return this.fo},Gh.prototype.Or=function(){return this.wo},Gh.prototype.jo=function(){return this.Ei},Gh.prototype.Wo=function(){return this.To},Gh.prototype.runTransaction=function(e,n,r){var i=this;Kr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this._o.runTransaction(e,t,_c,function(t){return o=new Tc(t,i.io?i.io.next():Ai.U),"readwrite-primary"===n?i.po(o).next(function(t){return!!t||i.vo(o)}).next(function(t){if(!t)throw zr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.eo.bo(function(){return i.ho(!1)}),new si(oi.FAILED_PRECONDITION,tc);return r(o)}).next(function(t){return i.Do(o).next(function(){return t})}):i.Go(o).next(function(){return r(o)})}).then(function(t){return o.ps(),t})},Gh.prototype.Go=function(t){var e=this;return Kh(t).get(oc.key).next(function(t){if(null!==t&&e.Fo(t.leaseTimestampMs,5e3)&&!e.Mo(t.ownerId)&&!e.Co(t)&&!(e.so||e.allowTabSynchronization&&t.allowTabSynchronization))throw new si(oi.FAILED_PRECONDITION,Bh)})},Gh.prototype.Do=function(t){var e=new oc(this.clientId,this.allowTabSynchronization,Date.now());return Kh(t).put(oc.key,e)},Gh.jn=function(){return Va.jn()},Gh.prototype.So=function(t){var e=this,n=Kh(t);return n.get(oc.key).next(function(t){return e.Co(t)?(Kr("IndexedDbPersistence","Releasing primary lease."),n.delete(oc.key)):Ra.resolve()})},Gh.prototype.Fo=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(zr("Detected an update time that is in the future: "+t+" > "+n),1))},Gh.prototype.mo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.co=function(){t.eo.ys(function(){return t.inForeground="visible"===t.document.visibilityState,t.Io()})},this.document.addEventListener("visibilitychange",this.co),this.inForeground="visible"===this.document.visibilityState)},Gh.prototype.Bo=function(){this.co&&(this.document.removeEventListener("visibilitychange",this.co),this.co=null)},Gh.prototype.Ao=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.oo=function(){e.Lo(),e.eo.ys(function(){return e.$o()})},this.window.addEventListener("unload",this.oo))},Gh.prototype.qo=function(){this.oo&&(this.window.removeEventListener("unload",this.oo),this.oo=null)},Gh.prototype.Mo=function(t){try{var e=null!==(null===(e=this.Eo)||void 0===e?void 0:e.getItem(this.ko(t)));return Kr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return zr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Gh.prototype.Lo=function(){if(this.Eo)try{this.Eo.setItem(this.ko(this.clientId),String(Date.now()))}catch(t){zr("Failed to set zombie client id.",t)}},Gh.prototype.Uo=function(){if(this.Eo)try{this.Eo.removeItem(this.ko(this.clientId))}catch(t){}},Gh.prototype.ko=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Gh);function Gh(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.eo=i,this.window=o,this.document=s,this.no=a,this.so=c,this.io=null,this.ro=!1,this.isPrimary=!1,this.networkEnabled=!0,this.oo=null,this.inForeground=!1,this.co=null,this.ao=null,this.uo=Number.NEGATIVE_INFINITY,this.ho=function(t){return Promise.resolve()},!Gh.jn())throw new si(oi.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Ii=new Nh(this,r),this.lo=e+"main",this.Kt=new Oc(u),this._o=new Va(this.lo,11,new Fh(this.Kt)),this.fo=new yh(this.Ii,this.Kt),this.Ei=new Wc,this.wo=(e=this.Kt,u=this.Ei,new Lh(e,u)),this.To=new Bc,this.window&&this.window.localStorage?this.Eo=this.window.localStorage:(this.Eo=null,!1===c&&zr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Kh(t){return Ac(t,oc.store)}function zh(t){return Ac(t,bc.store)}function Jh(t,e){var n=t.projectId;return t.m||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function Wh(t,e){this.progress=t,this.zo=e}var Xh=(nf.prototype.Jo=function(e,n){var r=this;return this.Ho.vi(e,n).next(function(t){return r.Yo(e,n,t)})},nf.prototype.Yo=function(t,r,i){return this.wo.fi(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].xs(r,t);return t})},nf.prototype.Xo=function(t,e,i){var o=Cu;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].xs(t,e);o=o.Ht(t,e)}),o},nf.prototype.Zo=function(e,t){var n=this;return this.wo.getEntries(e,t).next(function(t){return n.tc(e,t)})},nf.prototype.tc=function(e,r){var i=this;return this.Ho.Si(e,r).next(function(t){var t=i.Xo(e,r,t),n=Cu;return t.forEach(function(t,e){e=e||new xo(t,Ri.min()),n=n.Ht(t,e)}),n})},nf.prototype.jr=function(t,e,n){return r=e,Fi.Tt(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.ec(t,e.path):ws(e)?this.nc(t,e,n):this.sc(t,e,n);var r},nf.prototype.ec=function(t,e){return this.Jo(t,new Fi(e)).next(function(t){var e=Vu;return t instanceof Ao&&(e=e.Ht(t.key,t)),e})},nf.prototype.nc=function(n,r,i){var o=this,s=r.collectionGroup,u=Vu;return this.Ei.Qs(n,s).next(function(t){return Ra.forEach(t,function(t){var e=(e=r,t=t.child(s),new ps(t,null,e.Nt.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.sc(n,e,i).next(function(t){t.forEach(function(t,e){u=u.Ht(t,e)})})}).next(function(){return u})})},nf.prototype.sc=function(e,n,t){var a,c,r=this;return this.wo.jr(e,n,t).next(function(t){return a=t,r.Ho.Ci(e,n)}).next(function(t){return c=t,r.ic(e,c,a).next(function(t){a=t;for(var e=0,n=c;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key;a=(s=nu(s,a.get(u),0,r.Ss))instanceof Ao?a.Ht(u,s):a.remove(u)}})}).next(function(){return a.forEach(function(t,e){xs(n,e)||(a=a.remove(t))}),a})},nf.prototype.ic=function(t,e,n){for(var r=qu(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof au&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.wo.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ao&&(c=c.Ht(t,e))}),c})},nf),Yh=(ef.cc=function(t,e){for(var n=qu(),r=qu(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new ef(t,e.fromCache,n,r)},ef),Qh=(tf.prototype.ac=function(t){this.uc=t},tf.prototype.jr=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.Nt.length||1===r.Nt.length&&r.Nt[0].field.ht())||i.isEqual(Ri.min())?this.hc(e,r):this.uc.Zo(e,o).next(function(t){var n=s.lc(r,t);return(vs(r)||gs(r))&&s._c(r.limitType,n,o,i)?s.hc(e,r):(Gr()<=l.DEBUG&&Kr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),As(r)),s.uc.jr(e,r,i).next(function(e){return n.forEach(function(t){e=e.Ht(t.key,t)}),e}))})},tf.prototype.lc=function(n,t){var r=new Lu(Ss(n));return t.forEach(function(t,e){e instanceof Ao&&xs(n,e)&&(r=r.add(e))}),r},tf.prototype._c=function(t,e,n,r){return n.size!==e.size||!!(e="F"===t?e.last():e.first())&&(e.hasPendingWrites||0<e.version.u(r))},tf.prototype.hc=function(t,e){return Gr()<=l.DEBUG&&Kr("QueryEngine","Using full collection scan to execute query:",As(e)),this.uc.jr(t,e,Ri.min())},tf),Zh=($h.prototype.mr=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.pr(t,n.dc)})},$h);function $h(t,e,n,r){this.persistence=t,this.fc=e,this.Kt=r,this.dc=new Nu($r),this.wc=new rh(Co,Ro),this.Tc=Ri.min(),this.Ho=t.Ko(n),this.Ec=t.Or(),this.fo=t.Dr(),this.Ic=new Xh(this.Ec,this.Ho,this.persistence.jo()),this.To=t.Wo(),this.fc.ac(this.Ic)}function tf(){}function ef(t,e,n,r){this.targetId=t,this.fromCache=e,this.rc=n,this.oc=r}function nf(t,e,n){this.wo=t,this.Ho=e,this.Ei=n}function rf(t,e,n,r){return new Zh(t,e,n,r)}function of(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ho,m=e.Ic,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Ho.bi(v).next(function(t){return g=t,n=e.persistence.Ko(o),m=new Xh(e.Ec,n,e.persistence.jo()),n.bi(v)}).next(function(t){for(var e=[],n=[],r=qu(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Zo(v,r).next(function(t){return{mc:t,Ac:e,Rc:n}})})})];case 1:return r=t.sent(),[2,(e.Ho=n,e.Ic=m,e.fc.ac(e.Ic),r)]}})})}function sf(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.fo.Ki(t)})}function uf(t,s,e,u,a){var n=qu();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Cu;return e.forEach(function(t,e){var n=i.get(t),r=(null==a?void 0:a.get(t))||u;e instanceof xo&&e.version.isEqual(Ri.min())?(s._i(t,r),o=o.Ht(t,e)):null==n||0<e.version.u(n.version)||0===e.version.u(n.version)&&n.hasPendingWrites?(s.ui(e,r),o=o.Ht(t,e)):Kr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function af(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.fo.er(e,r).next(function(t){return t?(n=t,Ra.resolve(n)):i.fo.qi(e).next(function(t){return n=new Os(r,t,0,e.vs),i.fo.Gi(e,n).next(function(){return n})})})}).then(function(t){var e=i.dc.get(t.targetId);return(null===e||0<t.Mt.u(e.Mt))&&(i.dc=i.dc.Ht(t.targetId,t),i.wc.set(r,t.targetId)),t})}function cf(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).dc.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Ii.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Ka(r=t.sent()))throw r;return Kr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.dc=e.dc.remove(o),e.wc.delete(n.target),[2]}})})}function hf(t,o,s){var u=t,a=Ri.min(),c=qu();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=Is(o),(void 0!==(t=(i=t).wc.get(r))?Ra.resolve(i.dc.get(t)):i.fo.er(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.fo.cr(e,t.targetId).next(function(t){c=t})}).next(function(){return u.fc.jr(e,o,s?a:Ri.min(),s?c:qu())}).next(function(t){return{documents:t,Pc:c}});var t,n,r,i})}function ff(t,e){var n=t,r=n.fo;return(t=n.dc.get(e))?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Dn(t,e).next(function(t){return t?t.target:null})})}function lf(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Ec,n=t,t=s.Tc,r=e,i=Cu,o=Cc(t),t=Vh(n),n=IDBKeyRange.lowerBound(o,!0),t.ls({index:pc.readTimeIndex,range:n},function(t,e){var n=Lc(r.Kt,e);i=i.Ht(n.key,n),o=e.readTime}).next(function(){return{zo:i,readTime:Rc(o)}});var e,n,r,i,o}).then(function(t){var e=t.zo,t=t.readTime;return s.Tc=t,e})}var pf,df,yf=(Cf.prototype.Ms=function(t,e){return Ra.resolve(this.bc.get(e))},Cf.prototype.$s=function(t,e){return this.bc.set(e.id,{id:e.id,version:e.version,createTime:la(e.createTime)}),Ra.resolve()},Cf.prototype.Ls=function(t,e){return Ra.resolve(this.vc.get(e))},Cf.prototype.Bs=function(t,e){return this.vc.set(e.name,{name:e.name,query:jc(e.bundledQuery),readTime:la(e.readTime)}),Ra.resolve()},Cf),vf=(Pf.prototype.nt=function(){return this.Sc.nt()},Pf.prototype.sr=function(t,e){e=new gf(t,e),this.Sc=this.Sc.add(e),this.Cc=this.Cc.add(e)},Pf.prototype.Nc=function(t,e){var n=this;t.forEach(function(t){return n.sr(t,e)})},Pf.prototype.rr=function(t,e){this.Fc(new gf(t,e))},Pf.prototype.Oc=function(t,e){var n=this;t.forEach(function(t){return n.rr(t,e)})},Pf.prototype.kc=function(t){var e=this,n=new Fi(new Mi([])),r=new gf(n,t),t=new gf(n,t+1),i=[];return this.Cc.Ae([r,t],function(t){e.Fc(t),i.push(t.key)}),i},Pf.prototype.Mc=function(){var e=this;this.Sc.forEach(function(t){return e.Fc(t)})},Pf.prototype.Fc=function(t){this.Sc=this.Sc.delete(t),this.Cc=this.Cc.delete(t)},Pf.prototype.$c=function(t){var e=new Fi(new Mi([])),n=new gf(e,t),t=new gf(e,t+1),r=qu();return this.Cc.Ae([n,t],function(t){r=r.add(t.key)}),r},Pf.prototype.ki=function(t){var e=new gf(t,0);return null!==(e=this.Sc.Pe(e))&&t.isEqual(e.key)},Pf),gf=(Lf.Dc=function(t,e){return Fi.J(t.key,e.key)||$r(t.Lc,e.Lc)},Lf.xc=function(t,e){return $r(t.Lc,e.Lc)||Fi.J(t.key,e.key)},Lf),mf=(kf.prototype.Ri=function(t){return Ra.resolve(0===this.Ho.length)},kf.prototype.Pi=function(t,e,n,r){var i=this.Bc;this.Bc++,0<this.Ho.length&&this.Ho[this.Ho.length-1],n=new xc(i,e,n,r),this.Ho.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this.qc=this.qc.add(new gf(u.key,i)),this.Ei.Us(t,u.key.path.Z())}return Ra.resolve(n)},kf.prototype.yi=function(t,e){return Ra.resolve(this.Uc(e))},kf.prototype.Vi=function(t,e){return e+=1,e=(e=this.Qc(e))<0?0:e,Ra.resolve(this.Ho.length>e?this.Ho[e]:null)},kf.prototype.pi=function(){return Ra.resolve(0===this.Ho.length?-1:this.Bc-1)},kf.prototype.bi=function(t){return Ra.resolve(this.Ho.slice())},kf.prototype.vi=function(t,e){var n=this,r=new gf(e,0),e=new gf(e,Number.POSITIVE_INFINITY),i=[];return this.qc.Ae([r,e],function(t){t=n.Uc(t.Lc),i.push(t)}),Ra.resolve(i)},kf.prototype.Si=function(t,e){var n=this,r=new Lu($r);return e.forEach(function(t){var e=new gf(t,0),t=new gf(t,Number.POSITIVE_INFINITY);n.qc.Ae([e,t],function(t){r=r.add(t.Lc)})}),Ra.resolve(this.Kc(r))},kf.prototype.Ci=function(t,e){var n=e.path,r=n.length+1,e=n;Fi.Tt(e)||(e=e.child(""));var e=new gf(new Fi(e),0),i=new Lu($r);return this.qc.Re(function(t){var e=t.key.path;return!!n.st(e)&&(e.length===r&&(i=i.add(t.Lc)),!0)},e),Ra.resolve(this.Kc(i))},kf.prototype.Kc=function(t){var e=this,n=[];return t.forEach(function(t){null!==(t=e.Uc(t))&&n.push(t)}),n},kf.prototype.xi=function(n,r){var i=this;Yr(0===this.jc(r.batchId,"removed")),this.Ho.shift();var o=this.qc;return Ra.forEach(r.mutations,function(t){var e=new gf(t.key,r.batchId);return o=o.delete(e),i.Ii.Fi(n,t.key)}).next(function(){i.qc=o})},kf.prototype.Ni=function(t){},kf.prototype.ki=function(t,e){var n=new gf(e,0),n=this.qc.Pe(n);return Ra.resolve(e.isEqual(n&&n.key))},kf.prototype.Oi=function(t){return this.Ho.length,Ra.resolve()},kf.prototype.jc=function(t,e){return this.Qc(t)},kf.prototype.Qc=function(t){return 0===this.Ho.length?0:t-this.Ho[0].batchId},kf.prototype.Uc=function(t){return(t=this.Qc(t))<0||t>=this.Ho.length?null:this.Ho[t]},kf),bf=(Df.prototype.ui=function(t,e,n){var r=e.key,i=(o=this.docs.get(r))?o.size:0,o=this.Wc(e);return this.docs=this.docs.Ht(r,{li:e,size:o,readTime:n}),this.size+=o-i,this.Ei.Us(t,r.path.Z())},Df.prototype._i=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Df.prototype.fi=function(t,e){return e=this.docs.get(e),Ra.resolve(e?e.li:null)},Df.prototype.getEntries=function(t,e){var n=this,r=Cu;return e.forEach(function(t){var e=n.docs.get(t);r=r.Ht(t,e?e.li:null)}),Ra.resolve(r)},Df.prototype.jr=function(t,e,n){for(var r=Vu,i=new Fi(e.path.child("")),o=this.docs.ne(i);o.ae();){var s=(u=o.ce()).key,u=(a=u.value).li,a=a.readTime;if(!e.path.st(s.path))break;a.u(n)<=0||u instanceof Ao&&xs(e,u)&&(r=r.Ht(u.key,u))}return Ra.resolve(r)},Df.prototype.Gc=function(t,e){return Ra.forEach(this.docs,function(t){return e(t)})},Df.prototype.Fr=function(t){return new wf(this)},Df.prototype.Mr=function(t){return Ra.resolve(this.size)},Df),wf=(h(Of,df=je),Of.prototype.Ti=function(n){var r=this,i=[];return this.oi.forEach(function(t,e){e&&e.li?i.push(r.Gr.ui(n,e.li,r.ai(t))):r.Gr._i(t)}),Ra.Ln(i)},Of.prototype.di=function(t,e){return this.Gr.fi(t,e)},Of.prototype.wi=function(t,e){return this.Gr.getEntries(t,e)},Of),Ef=(Sf.prototype.mn=function(t,n){return this.zc.forEach(function(t,e){return n(e)}),Ra.resolve()},Sf.prototype.Ki=function(t){return Ra.resolve(this.lastRemoteSnapshotVersion)},Sf.prototype.ji=function(t){return Ra.resolve(this.Hc)},Sf.prototype.qi=function(t){return this.highestTargetId=this.Yc.next(),Ra.resolve(this.highestTargetId)},Sf.prototype.Wi=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Hc&&(this.Hc=e),Ra.resolve()},Sf.prototype.zi=function(t){this.zc.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Yc=new dh(e),this.highestTargetId=e),t.sequenceNumber>this.Hc&&(this.Hc=t.sequenceNumber)},Sf.prototype.Gi=function(t,e){return this.zi(e),this.targetCount+=1,Ra.resolve()},Sf.prototype.Ji=function(t,e){return this.zi(e),Ra.resolve()},Sf.prototype.Yi=function(t,e){return this.zc.delete(e.target),this.Jc.kc(e.targetId),--this.targetCount,Ra.resolve()},Sf.prototype.Zi=function(n,r,i){var o=this,s=0,u=[];return this.zc.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.zc.delete(t),u.push(o.Xi(n,e.targetId)),s++)}),Ra.Ln(u).next(function(){return s})},Sf.prototype.tr=function(t){return Ra.resolve(this.targetCount)},Sf.prototype.er=function(t,e){return e=this.zc.get(e)||null,Ra.resolve(e)},Sf.prototype.nr=function(t,e,n){return this.Jc.Nc(e,n),Ra.resolve()},Sf.prototype.ir=function(e,t,n){this.Jc.Oc(t,n);var r=this.persistence.Ii,i=[];return r&&t.forEach(function(t){i.push(r.Fi(e,t))}),Ra.Ln(i)},Sf.prototype.Xi=function(t,e){return this.Jc.kc(e),Ra.resolve()},Sf.prototype.cr=function(t,e){return e=this.Jc.$c(e),Ra.resolve(e)},Sf.prototype.ki=function(t,e){return Ra.resolve(this.Jc.ki(e))},Sf),If=(xf.prototype.start=function(){return Promise.resolve()},xf.prototype.$o=function(){return this.ro=!1,Promise.resolve()},Object.defineProperty(xf.prototype,"Er",{get:function(){return this.ro},enumerable:!1,configurable:!0}),xf.prototype.yo=function(){},xf.prototype.Vo=function(){},xf.prototype.jo=function(){return this.Ei},xf.prototype.Ko=function(t){var e=this.Xc[t.R()];return e||(e=new mf(this.Ei,this.Ii),this.Xc[t.R()]=e),e},xf.prototype.Dr=function(){return this.fo},xf.prototype.Or=function(){return this.wo},xf.prototype.Wo=function(){return this.To},xf.prototype.runTransaction=function(t,e,n){var r=this;Kr("MemoryPersistence","Starting transaction:",t);var i=new _f(this.io.next());return this.Ii.ta(),n(i).next(function(t){return r.Ii.ea(i).next(function(){return t})}).Mn().then(function(t){return i.ps(),t})},xf.prototype.na=function(e,n){return Ra.Bn(Object.values(this.Xc).map(function(t){return function(){return t.ki(e,n)}}))},xf),_f=(h(Af,pf=o),Af),Tf=(Nf.ra=function(t){return new Nf(t)},Object.defineProperty(Nf.prototype,"oa",{get:function(){if(this.ia)return this.ia;throw Xr()},enumerable:!1,configurable:!0}),Nf.prototype.sr=function(t,e,n){return this.sa.sr(n,e),this.oa.delete(n.toString()),Ra.resolve()},Nf.prototype.rr=function(t,e,n){return this.sa.rr(n,e),this.oa.add(n.toString()),Ra.resolve()},Nf.prototype.Fi=function(t,e){return this.oa.add(e.toString()),Ra.resolve()},Nf.prototype.removeTarget=function(t,e){var n=this;this.sa.kc(e.targetId).forEach(function(t){return n.oa.add(t.toString())});var r=this.persistence.Dr();return r.cr(t,e.targetId).next(function(t){t.forEach(function(t){return n.oa.add(t.toString())})}).next(function(){return r.Yi(t,e)})},Nf.prototype.ta=function(){this.ia=new Set},Nf.prototype.ea=function(n){var r=this,i=this.persistence.Or().Fr();return Ra.forEach(this.oa,function(t){var e=Fi.ft(t);return r.ca(n,e).next(function(t){t||i._i(e)})}).next(function(){return r.ia=null,i.apply(n)})},Nf.prototype.kr=function(t,e){var n=this;return this.ca(t,e).next(function(t){t?n.oa.delete(e.toString()):n.oa.add(e.toString())})},Nf.prototype.Zc=function(t){return 0},Nf.prototype.ca=function(t,e){var n=this;return Ra.Bn([function(){return Ra.resolve(n.sa.ki(e))},function(){return n.persistence.Dr().ki(t,e)},function(){return n.persistence.na(t,e)}])},Nf);function Nf(t){this.persistence=t,this.sa=new vf,this.ia=null}function Af(t){var e=this;return(e=pf.call(this)||this).vs=t,e}function xf(t,e){var n=this;this.Xc={},this.io=new Ai(0),this.ro=!1,this.ro=!0,this.Ii=t(this),this.fo=new Ef(this),this.Ei=new zc,this.wo=(t=this.Ei,new bf(t,function(t){return n.Ii.Zc(t)})),this.Kt=new Oc(e),this.To=new yf(this.Kt)}function Sf(t){this.persistence=t,this.zc=new rh(Co,Ro),this.lastRemoteSnapshotVersion=Ri.min(),this.highestTargetId=0,this.Hc=0,this.Jc=new vf,this.targetCount=0,this.Yc=dh.Li()}function Of(t){var e=this;return(e=df.call(this)||this).Gr=t,e}function Df(t,e){this.Ei=t,this.Wc=e,this.docs=new Nu(Fi.J),this.size=0}function kf(t,e){this.Ei=t,this.Ii=e,this.Ho=[],this.Bc=1,this.qc=new Lu(gf.Dc)}function Lf(t,e){this.key=t,this.Lc=e}function Pf(){this.Sc=new Lu(gf.Dc),this.Cc=new Lu(gf.xc)}function Cf(t){this.Kt=t,this.bc=new Map,this.vc=new Map}function Rf(t,e){return"firestore_clients_"+t+"_"+e}function Mf(t,e,n){return n="firestore_mutations_"+t+"_"+n,e.A()&&(n+="_"+e.uid),n}function Vf(t,e){return"firestore_targets_"+t+"_"+e}var Uf,Ff=(al.aa=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new si(r.error.code,r.error.message)),i?new al(t,e,r.state,o):(zr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},al.prototype.ua=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},al),qf=(ul.aa=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new si(n.error.code,n.error.message)),r?new ul(t,n.state,i):(zr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},ul.prototype.ua=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},ul),jf=(sl.aa=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ju,o=0;r&&o<n.activeTargetIds.length;++o)r=oo(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new sl(t,i):(zr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},sl),Bf=(ol.aa=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new ol(e.clientId,e.onlineState):(zr("SharedClientState","Failed to parse online state: "+t),null)},ol),Hf=(il.prototype.ha=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},il.prototype.la=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},il.prototype.ua=function(){var t={activeTargetIds:this.activeTargetIds.rt(),updateTimeMs:Date.now()};return JSON.stringify(t)},il),Gf=(rl.jn=function(t){return!(!t||!t.localStorage)},rl.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f=this;return v(this,function(t){switch(t.label){case 0:return[4,this.fa.Qo()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this._a&&(i=this.getItem(Rf(this.persistenceKey,r)))&&(o=jf.aa(r,i))&&(this.Ea=this.Ea.Ht(o.clientId,o));for(this.pa(),(s=this.storage.getItem(this.ga))&&(u=this.ba(s))&&this.va(u),a=0,c=this.Ia;a<c.length;a++)h=c[a],this.Ta(h);return this.Ia=[],this.window.addEventListener("unload",function(){return f.$o()}),this.Er=!0,[2]}})})},rl.prototype.q=function(t){this.setItem(this.Aa,JSON.stringify(t))},rl.prototype.Sa=function(){return this.Da(this.Ea)},rl.prototype.Ca=function(n){var r=!1;return this.Ea.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},rl.prototype.xa=function(t){this.Na(t,"pending")},rl.prototype.Fa=function(t,e,n){this.Na(t,e,n),this.Oa(t)},rl.prototype.ka=function(t){var e,n="not-current";return this.Ca(t)&&(!(e=this.storage.getItem(Vf(this.persistenceKey,t)))||(e=qf.aa(t,e))&&(n=e.state)),this.Ma.ha(t),this.pa(),n},rl.prototype.$a=function(t){this.Ma.la(t),this.pa()},rl.prototype.La=function(t){return this.Ma.activeTargetIds.has(t)},rl.prototype.Ba=function(t){this.removeItem(Vf(this.persistenceKey,t))},rl.prototype.qa=function(t,e,n){this.Ua(t,e,n)},rl.prototype.Qa=function(t,e,n){var r=this;e.forEach(function(t){r.Oa(t)}),this.currentUser=t,n.forEach(function(t){r.xa(t)})},rl.prototype.Ka=function(t){this.ja(t)},rl.prototype.Wa=function(){this.Ga()},rl.prototype.$o=function(){this.Er&&(this.window.removeEventListener("storage",this.wa),this.removeItem(this.ma),this.Er=!1)},rl.prototype.getItem=function(t){var e=this.storage.getItem(t);return Kr("SharedClientState","READ",t,e),e},rl.prototype.setItem=function(t,e){Kr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},rl.prototype.removeItem=function(t){Kr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},rl.prototype.Ta=function(t){var e=this,o=t;o.storageArea===this.storage&&(Kr("SharedClientState","EVENT",o.key,o.newValue),o.key!==this.ma?this.eo.bo(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){if(this.Er){if(null!==o.key)if(this.Ra.test(o.key)){if(null==o.newValue)return e=this.za(o.key),[2,this.Ha(e,null)];if(e=this.Ja(o.key,o.newValue))return[2,this.Ha(e.clientId,e)]}else if(this.Pa.test(o.key)){if(null!==o.newValue&&(n=this.Ya(o.key,o.newValue)))return[2,this.Xa(n)]}else if(this.ya.test(o.key)){if(null!==o.newValue&&(r=this.Za(o.key,o.newValue)))return[2,this.tu(r)]}else if(o.key===this.ga){if(null!==o.newValue&&(i=this.ba(o.newValue)))return[2,this.va(i)]}else if(o.key===this.Aa)(i=function(t){var e=Ai.U;if(null!=t)try{var n=JSON.parse(t);Yr("number"==typeof n),e=n}catch(t){zr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==Ai.U&&this.$(i);else if(o.key===this.Va)return[2,this.fa.eu()]}else this.Ia.push(o);return[2]})})}):zr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(rl.prototype,"Ma",{get:function(){return this.Ea.get(this._a)},enumerable:!1,configurable:!0}),rl.prototype.pa=function(){this.setItem(this.ma,this.Ma.ua())},rl.prototype.Na=function(t,e,n){n=new Ff(this.currentUser,t,e,n),t=Mf(this.persistenceKey,this.currentUser,t),this.setItem(t,n.ua())},rl.prototype.Oa=function(t){t=Mf(this.persistenceKey,this.currentUser,t),this.removeItem(t)},rl.prototype.ja=function(t){t={clientId:this._a,onlineState:t},this.storage.setItem(this.ga,JSON.stringify(t))},rl.prototype.Ua=function(t,e,n){var r=Vf(this.persistenceKey,t),n=new qf(t,e,n);this.setItem(r,n.ua())},rl.prototype.Ga=function(){this.setItem(this.Va,"value-not-used")},rl.prototype.za=function(t){return(t=this.Ra.exec(t))?t[1]:null},rl.prototype.Ja=function(t,e){return t=this.za(t),jf.aa(t,e)},rl.prototype.Ya=function(t,e){var n=this.Pa.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Ff.aa(new gi(n),t,e)},rl.prototype.Za=function(t,e){return t=this.ya.exec(t),t=Number(t[1]),qf.aa(t,e)},rl.prototype.ba=function(t){return Bf.aa(t)},rl.prototype.Xa=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.fa.nu(e.batchId,e.state,e.error)]:(Kr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},rl.prototype.tu=function(t){return this.fa.su(t.targetId,t.state,t.error)},rl.prototype.Ha=function(t,e){var n=this,r=e?this.Ea.Ht(t,e):this.Ea.remove(t),i=this.Da(this.Ea),o=this.Da(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.fa.iu(s,u).then(function(){n.Ea=r})},rl.prototype.va=function(t){this.Ea.get(t.clientId)&&this.da(t.onlineState)},rl.prototype.Da=function(t){var n=ju;return t.forEach(function(t,e){n=n.ye(e.activeTargetIds)}),n},rl),Kf=(nl.prototype.xa=function(t){},nl.prototype.Fa=function(t,e,n){},nl.prototype.ka=function(t){return this.ru.ha(t),this.ou[t]||"not-current"},nl.prototype.qa=function(t,e,n){this.ou[t]=e},nl.prototype.$a=function(t){this.ru.la(t)},nl.prototype.La=function(t){return this.ru.activeTargetIds.has(t)},nl.prototype.Ba=function(t){delete this.ou[t]},nl.prototype.Sa=function(){return this.ru.activeTargetIds},nl.prototype.Ca=function(t){return this.ru.activeTargetIds.has(t)},nl.prototype.start=function(){return this.ru=new Hf,Promise.resolve()},nl.prototype.Qa=function(t,e,n){},nl.prototype.Ka=function(t){},nl.prototype.$o=function(){},nl.prototype.q=function(t){},nl.prototype.Wa=function(){},nl),zf=(el.prototype.cu=function(t){},el.prototype.$o=function(){},el),Jf=(tl.prototype.cu=function(t){this._u.push(t)},tl.prototype.$o=function(){window.removeEventListener("online",this.au),window.removeEventListener("offline",this.hu)},tl.prototype.fu=function(){window.addEventListener("online",this.au),window.addEventListener("offline",this.hu)},tl.prototype.uu=function(){Kr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this._u;t<e.length;t++)(0,e[t])(0)},tl.prototype.lu=function(){Kr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this._u;t<e.length;t++)(0,e[t])(1)},tl.jn=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},tl),Wf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Xf=($f.prototype.Tu=function(t){this.Eu=t},$f.prototype.Iu=function(t){this.mu=t},$f.prototype.onMessage=function(t){this.Au=t},$f.prototype.Ru=function(t){this.Pu=t},$f.prototype.close=function(){this.wu()},$f.prototype.send=function(t){this.du(t)},$f.prototype.yu=function(){this.Eu()},$f.prototype.gu=function(t){this.mu(t)},$f.prototype.Vu=function(t){this.Au(t)},$f.prototype.pu=function(t,e){this.Pu(t,e)},$f),Yf=(Zf.prototype.Du=function(e,t,n,r){var i=this.Cu(e,t);return Kr("RestConnection","Sending: ",i,n),t={},this.xu(t,r),this.Nu(e,i,t,n).then(function(t){return Kr("RestConnection","Received: ",t),t},function(t){throw Jr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Zf.prototype.Fu=function(t,e,n,r){return this.Du(t,e,n,r)},Zf.prototype.xu=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.2-longpoll.66863f547",t["Content-Type"]="text/plain",e)for(var n in e.V)e.V.hasOwnProperty(n)&&(t[n]=e.V[n])},Zf.prototype.Cu=function(t,e){return t=Wf[t],this.vu+"/v1/"+e+":"+t},h(Qf,Uf=Zf),Qf.prototype.Nu=function(o,e,s,u){return new Promise(function(n,r){var i=new jr;i.listenOnce(Ur.COMPLETE,function(){try{switch(i.getLastErrorCode()){case Vr.NO_ERROR:var t=i.getResponseJson();Kr("Connection","XHR received:",JSON.stringify(t)),n(t);break;case Vr.TIMEOUT:Kr("Connection",'RPC "'+o+'" timed out'),r(new si(oi.DEADLINE_EXCEEDED,"Request time out"));break;case Vr.HTTP_ERROR:var e=i.getStatus();Kr("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(oi).indexOf(e)?e:oi.UNKNOWN,r(new si(e,t.message))):r(new si(oi.UNKNOWN,"Server responded with status "+i.getStatus())):r(new si(oi.UNAVAILABLE,"Connection failed."));break;default:Xr()}}finally{Kr("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},Qf.prototype.Ou=function(t,e){var n,r=[this.vu,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new kr,o=Mr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.T.projectId+"/databases/"+this.T.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.I};this.xu(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(n=p()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders"),Kr("Connection","Creating WebChannel: "+(r=r.join("")),t);var s=i.createWebChannel(r,t),u=!1,a=!1,c=(new Date).getTime(),h=new Xf({du:function(t){a?Kr("Connection","Not sending because WebChannel is closed:",t):(u||(Kr("Connection","Opening WebChannel transport."),s.open(),u=!0),Kr("Connection","WebChannel sending:",t),s.send(t))},wu:function(){return s.close()}});return(t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})})(s,qr.EventType.OPEN,function(){a||Kr("Connection","WebChannel transport opened.")}),t(s,qr.EventType.CLOSE,function(){a||(a=!0,Kr("Connection","WebChannel transport closed"),h.gu())}),t(s,qr.EventType.ERROR,function(t){a||(a=!0,Jr("Connection","WebChannel transport errored:",t),h.gu(new si(oi.UNAVAILABLE,"The operation could not be completed")))}),t(s,qr.EventType.MESSAGE,function(t){var e,n,r,i;a||(Yr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Kr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=vu[r];if(void 0!==t)return Tu(t)}(),i=n.message,void 0===t&&(t=oi.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),a=!0,h.gu(new si(t,i)),s.close()):(Kr("Connection","WebChannel received:",e),h.Vu(e)))}),t(o,Fr.STAT_EVENT,function(t){var e=(new Date).getTime()-c;10===t.stat?(Kr("Connection","Detected buffering proxy"),h.pu(!0,e)):11===t.stat&&(Kr("Connection","Detected no buffering proxy"),h.pu(!1,e))}),setTimeout(function(){h.yu()},0),h},Qf);function Qf(t){var e=this;return(e=Uf.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.I=t.I,e}function Zf(t){this.bu=t,this.T=t.T;var e=t.ssl?"https":"http";this.vu=e+"://"+t.host,this.Su="projects/"+this.T.projectId+"/databases/"+this.T.database+"/documents"}function $f(t){this.du=t.du,this.wu=t.wu}function tl(){var t=this;this.au=function(){return t.uu()},this.hu=function(){return t.lu()},this._u=[],this.fu()}function el(){}function nl(){this.ru=new Hf,this.ou={},this.da=null,this.$=null}function rl(t,e,n,r,i){this.window=t,this.eo=e,this.persistenceKey=n,this._a=r,this.fa=null,this.da=null,this.$=null,this.wa=this.Ta.bind(this),this.Ea=new Nu($r),this.Er=!1,this.Ia=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.ma=Rf(this.persistenceKey,this._a),this.Aa="firestore_sequence_number_"+this.persistenceKey,this.Ea=this.Ea.Ht(this._a,new Hf),this.Ra=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Pa=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.ya=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.ga="firestore_online_state_"+this.persistenceKey,this.Va="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.wa)}function il(){this.activeTargetIds=ju}function ol(t,e){this.clientId=t,this.onlineState=e}function sl(t,e){this.clientId=t,this.activeTargetIds=e}function ul(t,e,n){this.targetId=t,this.state=e,this.error=n}function al(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function cl(){return"undefined"!=typeof window?window:null}function hl(){return"undefined"!=typeof document?document:null}function fl(t){return new ca(t,!0)}function ll(t,e,n,r,i){var o=this;this.xh=t,this.Nh=e,this.fs=n,this.Fh={},this.Oh=[],this.kh=new Map,this.Mh=new Set,this.$h=[],this.Lh=i,this.Lh.cu(function(t){n.ys(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Rl(this)?(Kr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Mh.add(4),[4,Sl(e)];case 1:return t.sent(),e.Bh.set("Unknown"),e.Mh.delete(4),[4,xl(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Bh=new wl(n,r)}var pl,dl,yl,vl=(Al.prototype.reset=function(){this.Lu=0},Al.prototype.Uu=function(){this.Lu=this.$u},Al.prototype.Qu=function(t){var e=this;this.cancel();var n=Math.floor(this.Lu+this.Ku()),r=Math.max(0,Date.now()-this.qu),i=Math.max(0,n-r);0<i&&Kr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Lu+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Bu=this.eo.Ir(this.ds,i,function(){return e.qu=Date.now(),t()}),this.Lu*=this.Mu,this.Lu<this.ku&&(this.Lu=this.ku),this.Lu>this.$u&&(this.Lu=this.$u)},Al.prototype.ju=function(){null!==this.Bu&&(this.Bu.Ps(),this.Bu=null)},Al.prototype.cancel=function(){null!==this.Bu&&(this.Bu.cancel(),this.Bu=null)},Al.prototype.Ku=function(){return(Math.random()-.5)*this.Lu},Al),je=(Nl.prototype.Xu=function(){return 1===this.state||2===this.state||4===this.state},Nl.prototype.Zu=function(){return 2===this.state},Nl.prototype.start=function(){3!==this.state?this.auth():this.th()},Nl.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Xu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Nl.prototype.eh=function(){this.state=0,this.Yu.reset()},Nl.prototype.nh=function(){var t=this;this.Zu()&&null===this.Ju&&(this.Ju=this.eo.Ir(this.Wu,6e4,function(){return t.sh()}))},Nl.prototype.ih=function(t){this.rh(),this.stream.send(t)},Nl.prototype.sh=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.Zu()?[2,this.close(0)]:[2]})})},Nl.prototype.rh=function(){this.Ju&&(this.Ju.cancel(),this.Ju=null)},Nl.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.rh(),this.Yu.cancel(),this.Hu++,3!==e?this.Yu.reset():n&&n.code===oi.RESOURCE_EXHAUSTED?(zr(n.toString()),zr("Using maximum backoff delay to prevent overloading the backend."),this.Yu.Uu()):n&&n.code===oi.UNAUTHENTICATED&&this.zu.v(),null!==this.stream&&(this.oh(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Iu(n)];case 1:return t.sent(),[2]}})})},Nl.prototype.oh=function(){},Nl.prototype.Ru=function(t,e){this.listener.Ru(t,e)},Nl.prototype.auth=function(){var n=this;this.state=1;var t=this.ah(this.Hu),e=this.Hu;this.zu.getToken().then(function(t){n.Hu===e&&n.uh(t)},function(e){t(function(){var t=new si(oi.UNKNOWN,"Fetching auth token failed: "+e.message);return n.hh(t)})})},Nl.prototype.uh=function(t){var r=this,i=this.ah(this.Hu);this.stream=this.lh(t),this.stream.Tu(function(){i(function(){return r.state=2,r.listener.Tu()})}),this.stream.Iu(function(t){i(function(){return r.hh(t)})}),this.stream.onMessage(function(t){i(function(){return r.onMessage(t)})}),this.stream.Ru(function(e,n){i(function(){return y(r,void 0,void 0,function(){return v(this,function(t){return[2,this.Ru(e,n)]})})})})},Nl.prototype.th=function(){var t=this;this.state=4,this.Yu.Qu(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Nl.prototype.hh=function(t){return Kr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Nl.prototype.ah=function(e){var n=this;return function(t){n.eo.ys(function(){return n.Hu===e?t():(Kr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Nl),gl=(h(Tl,yl=je),Tl.prototype.lh=function(t){return this.Gu.Ou("Listen",t)},Tl.prototype.onMessage=function(t){this.Yu.reset();var e,n=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Xr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.qt?(Yr(void 0===s||"string"==typeof s),ni.fromBase64String(s||"")):(Yr(void 0===s||s instanceof Uint8Array),ni.fromUint8Array(s||new Uint8Array))),o=(u=e.targetChange.cause)&&(a=void 0===(c=u).code?oi.UNKNOWN:Tu(c.code),new si(a,c.message||"")),s=new Xu(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime,r=va(t,n.document.name),i=la(n.document.updateTime);var u=new bo({mapValue:{fields:n.document.fields}}),a=(o=new Ao(r,i,u,{}),n.targetIds||[]),c=n.removedTargetIds||[],s=new Ju(a,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=va(t,n.document),i=n.readTime?la(n.readTime):Ri.min(),u=new xo(r,i),o=n.removedTargetIds||[],s=new Ju([],o,u.key,u);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=va(t,n.document),i=n.removedTargetIds||[],s=new Ju([],i,r,null);else{if(!("filter"in e))return Xr();e.filter,(e=e.filter).targetId,r=new yu(n=e.count||0),i=e.targetId,s=new Wu(i,r)}return s}(this.Kt,t),t=!("targetChange"in(e=t))||(e=e.targetChange).targetIds&&e.targetIds.length||!e.readTime?Ri.min():la(e.readTime);return this.listener._h(n,t)},Tl.prototype.fh=function(t){var e,n,r,i,o={};o.database=ba(this.Kt),o.addTarget=(e=this.Kt,(r=Mo(r=(n=t).target)?{documents:Na(e,r)}:{query:Aa(e,r)}).targetId=n.targetId,0<n.resumeToken.o()?r.resumeToken=fa(e,n.resumeToken):0<n.Mt.u(Ri.min())&&(r.readTime=ha(e,n.Mt.G())),r),(t=(this.Kt,i=t,null==(t=function(){switch(i.kt){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Xr()}}())?null:{"goog-listen-tags":t}))&&(o.labels=t),this.ih(o)},Tl.prototype.dh=function(t){var e={};e.database=ba(this.Kt),e.removeTarget=t,this.ih(e)},Tl),ml=(h(_l,dl=je),Object.defineProperty(_l.prototype,"Th",{get:function(){return this.wh},enumerable:!1,configurable:!0}),_l.prototype.start=function(){this.wh=!1,this.lastStreamToken=void 0,dl.prototype.start.call(this)},_l.prototype.oh=function(){this.wh&&this.Eh([])},_l.prototype.lh=function(t){return this.Gu.Ou("Write",t)},_l.prototype.onMessage=function(t){if(Yr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.wh){this.Yu.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Yr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?la(e.updateTime):la(n)).isEqual(Ri.min())&&(t=la(n)),n=null,e.transformResults&&0<e.transformResults.length&&(n=e.transformResults),new Qs(t,n);var e,n})):[]),n=la(t.commitTime);return this.listener.Ih(n,e)}var r;return Yr(!t.writeResults||0===t.writeResults.length),this.wh=!0,this.listener.mh()},_l.prototype.Ah=function(){var t={};t.database=ba(this.Kt),this.ih(t)},_l.prototype.Eh=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return _a(e.Kt,t)})};this.ih(t)},_l),bl=(h(Il,pl=function(){}),Il.prototype.Ph=function(){if(this.Rh)throw new si(oi.FAILED_PRECONDITION,"The client has already been terminated.")},Il.prototype.Du=function(e,n,r){var i=this;return this.Ph(),this.credentials.getToken().then(function(t){return i.Gu.Du(e,n,r,t)}).catch(function(t){throw t.code===oi.UNAUTHENTICATED&&i.credentials.v(),t})},Il.prototype.Fu=function(e,n,r){var i=this;return this.Ph(),this.credentials.getToken().then(function(t){return i.Gu.Fu(e,n,r,t)}).catch(function(t){throw t.code===oi.UNAUTHENTICATED&&i.credentials.v(),t})},Il.prototype.terminate=function(){this.Rh=!1},Il),wl=(El.prototype.ph=function(){var t=this;0===this.yh&&(this.bh("Unknown"),this.gh=this.fs.Ir("online_state_timeout",1e4,function(){return t.gh=null,t.Sh("Backend didn't respond within 10 seconds."),t.bh("Offline"),Promise.resolve()}))},El.prototype.Dh=function(t){"Online"===this.state?this.bh("Unknown"):(this.yh++,1<=this.yh&&(this.Ch(),this.Sh("Connection failed 1 times. Most recent error: "+t.toString()),this.bh("Offline")))},El.prototype.set=function(t){this.Ch(),this.yh=0,"Online"===t&&(this.Vh=!1),this.bh(t)},El.prototype.bh=function(t){t!==this.state&&(this.state=t,this.da(t))},El.prototype.Sh=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.Vh?(zr(t),this.Vh=!1):Kr("OnlineStateTracker",t)},El.prototype.Ch=function(){null!==this.gh&&(this.gh.cancel(),this.gh=null)},El);function El(t,e){this.fs=t,this.da=e,this.state="Unknown",this.yh=0,this.gh=null,this.Vh=!0}function Il(t,e,n){var r=this;return(r=pl.call(this)||this).credentials=t,r.Gu=e,r.Kt=n,r.Rh=!1,r}function _l(t,e,n,r,i){var o=this;return(o=dl.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).Kt=r,o.wh=!1,o}function Tl(t,e,n,r,i){var o=this;return(o=yl.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).Kt=r,o}function Nl(t,e,n,r,i,o){this.eo=t,this.Wu=n,this.Gu=r,this.zu=i,this.listener=o,this.state=0,this.Hu=0,this.Ju=null,this.stream=null,this.Yu=new vl(t,e)}function Al(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.eo=t,this.ds=e,this.ku=n,this.Mu=r,this.$u=i,this.Lu=0,this.Bu=null,this.qu=Date.now(),this.reset()}function xl(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!Rl(r))return[3,4];e=0,n=r.$h,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Sl(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.$h,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Ol(t,e){t.kh.has(e.targetId)||(t.kh.set(e.targetId,e),Cl(t)?Pl(t):Gl(t).Zu()&&kl(t,e))}function Dl(t,e){var n=t,t=Gl(n);n.kh.delete(e),t.Zu()&&Ll(n,e),0===n.kh.size&&(t.Zu()?t.nh():Rl(n)&&n.Bh.set("Unknown"))}function kl(t,e){t.qh.cn(e.targetId),Gl(t).fh(e)}function Ll(t,e){t.qh.cn(e),Gl(t).dh(e)}function Pl(e){e.qh=new Qu({Sn:function(t){return e.Fh.Sn(t)},Dn:function(t){return e.kh.get(t)||null}}),Gl(e).start(),e.Bh.ph()}function Cl(t){return Rl(t)&&!Gl(t).Xu()&&0<t.kh.size}function Rl(t){return 0===t.Mh.size}function Ml(t){t.qh=void 0}function Vl(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!Ka(r))throw r;return n.Mh.add(1),[4,Sl(n)];case 1:return t.sent(),n.Bh.set("Offline"),i=i||function(){return sf(n.xh)},n.fs.bo(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Kr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Mh.delete(1),[4,xl(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Ul(e,n){return n().catch(function(t){return Vl(e,t,n)})}function Fl(c){return y(this,void 0,void 0,function(){var o,s,u,a;return v(this,function(t){switch(t.label){case 0:s=Kl(o=c),u=0<o.Oh.length?o.Oh[o.Oh.length-1].batchId:-1,t.label=1;case 1:if(!(Rl(o)&&o.Oh.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(n=o.xh,r=u,(i=n).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===r&&(r=-1),i.Ho.Vi(t,r)}))];case 3:return null===(a=t.sent())?(0===o.Oh.length&&s.nh(),[3,7]):(u=a.batchId,e=a,(n=o).Oh.push(e),(n=Kl(n)).Zu()&&n.Th&&n.Eh(e.mutations),[3,6]);case 4:return a=t.sent(),[4,Vl(o,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return ql(o)&&jl(o),[2]}var e,n,r,i})})}function ql(t){return Rl(t)&&!Kl(t).Xu()&&0<t.Oh.length}function jl(t){Kl(t).start()}function Bl(t,e,n){t.Fh.Kh&&t.Fh.Kh(e,n)}function Hl(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Mh.delete(2),[4,xl(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Mh.add(2),[4,Sl(e)]);case 3:t.sent(),e.Bh.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Gl(n){var t,e,r,i=this;return n.Gh||(n.Gh=(t=n.Nh,e=n.fs,r={Tu:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.kh.forEach(function(t,e){kl(n,t)}),[2]})})}.bind(null,n),Iu:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return Ml(e),Cl(e)?(e.Bh.Dh(n),Pl(e)):e.Bh.set("Unknown"),[2]})})}.bind(null,n),_h:function(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Bh.set("Online"),!(u instanceof Xu&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.kh.has(i)?[4,o.Fh.Uh(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.kh.delete(i),o.qh.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Kr("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,Vl(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof Ju?s.qh.wn(u):u instanceof Wu?s.qh.yn(u):s.qh.In(u),a.isEqual(Ri.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,sf(s.xh)];case 8:return o=t.sent(),0<=a.u(o)?[4,(i=a,(e=(r=s).qh.pn(i)).Oe.forEach(function(t,e){var n;0<t.resumeToken.o()&&(n=r.kh.get(e))&&r.kh.set(e,n.Lt(t.resumeToken,i))}),e.ke.forEach(function(t){var e=r.kh.get(t);e&&(r.kh.set(t,e.Lt(ni.h,e.Mt)),Ll(r,t),e=new Os(e.target,t,1,e.sequenceNumber),kl(r,e))}),r.Fh.Qh(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Kr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Vl(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}.bind(null,n),Ru:Bl.bind(null,n)},t.Ph(),new gl(e,t.Gu,t.credentials,t.Kt,r)),n.$h.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.Gh.eh(),Cl(n)?Pl(n):n.Bh.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.Gh.stop()];case 2:t.sent(),Ml(n),t.label=3;case 3:return[2]}})})})),n.Gh}function Kl(n){var t,e,r,i=this;return n.zh||(n.zh=(t=n.Nh,e=n.fs,r={Tu:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Kl(e).Ah(),[2]})})}.bind(null,n),Iu:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&Kl(e).Th?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return _u(n=i.code)&&n!==oi.ABORTED?(e=r.Oh.shift(),Kl(r).eh(),[4,Ul(r,function(){return r.Fh.Wh(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Fl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return ql(e)&&jl(e),[2]}})})}.bind(null,n),mh:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=Kl(o),n=0,r=o.Oh;n<r.length;n++)i=r[n],e.Eh(i.mutations);return[2]})})}.bind(null,n),Ih:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Oh.shift(),n=Sc.from(e,i,o),[4,Ul(r,function(){return r.Fh.jh(n)})];case 1:return t.sent(),[4,Fl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n),Ru:Bl.bind(null,n)},t.Ph(),new ml(e,t.Gu,t.credentials,t.Kt,r)),n.$h.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.zh.eh(),[4,Fl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.zh.stop()];case 3:t.sent(),0<n.Oh.length&&(Kr("RemoteStore","Stopping write stream with "+n.Oh.length+" pending writes"),n.Oh=[]),t.label=4;case 4:return[2]}})})})),n.zh}function zl(){this.queries=new rh(Ns,Ts),this.onlineState="Unknown",this.Jh=new Set}var Jl=function(){this.Hh=void 0,this.listeners=[]};function Wl(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new Jl),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.Yh(n)];case 2:return o.Hh=t.sent(),[3,4];case 3:return o=$a(o=t.sent(),"Initialization of query '"+As(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(u),u.Xh(e.onlineState),i.Hh&&u.Zh(i.Hh)&&Yl(e),[2]}})})}function Xl(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.tl(n))]:[2]})})}function Yl(t){t.Jh.forEach(function(t){t.next()})}var Ql=(ip.prototype.Zh=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Gu(t.query,t.docs,t.De,e,t.Ce,t.fromCache,t.xe,!0)}var o=!1;return this.nl?this.il(t)&&(this.el.next(t),o=!0):this.rl(t,this.onlineState)&&(this.ol(t),o=!0),this.sl=t,o},ip.prototype.onError=function(t){this.el.error(t)},ip.prototype.Xh=function(t){this.onlineState=t;var e=!1;return this.sl&&!this.nl&&this.rl(this.sl,t)&&(this.ol(this.sl),e=!0),e},ip.prototype.rl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.cl&&n||t.docs.nt()&&"Offline"!==e)},ip.prototype.il=function(t){if(0<t.docChanges.length)return!0;var e=this.sl&&this.sl.hasPendingWrites!==t.hasPendingWrites;return!(!t.xe&&!e)&&!0===this.options.includeMetadataChanges},ip.prototype.ol=function(t){t=Gu.Fe(t.query,t.docs,t.Ce,t.fromCache),this.nl=!0,this.el.next(t)},ip),Zl=(rp.prototype.al=function(){return"metadata"in this.payload},rp),$l=(np.prototype.yc=function(t){return va(this.Kt,t)},np.prototype.gc=function(t){return t.metadata.exists?Ia(this.Kt,t.document,!1):new xo(this.yc(t.metadata.name),this.Vc(t.metadata.readTime))},np.prototype.Vc=la,np),tp=(ep.prototype.hl=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},ep.prototype.ll=function(t){for(var e=new Map,n=new $l(this.Kt),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.yc(o.metadata.name),u=0,a=o.metadata.queries;u<a.length;u++){var c=a[u],h=(e.get(c)||qu()).add(s);e.set(c,h)}}return e},ep.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return[4,function(f,l,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,u,a,c,h;return v(this,function(t){switch(t.label){case 0:for(n=f,r=qu(),i=Cu,o=Uu,e=0,s=p;e<s.length;e++)u=s[e],a=l.yc(u.metadata.name),u.document&&(r=r.add(a)),i=i.Ht(a,l.gc(u)),o=o.Ht(a,l.Vc(u.metadata.readTime));return c=n.Ec.Fr({Wr:!0}),[4,af(n,Is(ys(Mi.ct("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return uf(e,c,i,Ri.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.fo.Xi(e,h.targetId).next(function(){return n.fo.nr(e,r,h.targetId)}).next(function(){return n.Ic.tc(e,t)})})})]}})})}(this.xh,new $l(this.Kt),this.documents,this.ul.id)];case 1:e=t.sent(),n=this.ll(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=qu()),y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return[4,af(e,Is(jc(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=la(i.readTime);return 0<=n.Mt.u(e)?r.To.Bs(t,i):(e=n.Lt(ni.h,e),r.dc=r.dc.Ht(e.targetId,e),r.fo.Ji(t,e).next(function(){return r.fo.Xi(t,n.targetId)}).next(function(){return r.fo.nr(t,o,n.targetId)}).next(function(){return r.To.Bs(t,i)}))})]}})})}(this.xh,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Wh(Object.assign({},this.progress),e))]}})})},ep);function ep(t,e,n){this.ul=t,this.xh=e,this.Kt=n,this.queries=[],this.documents=[],this.progress=op(t)}function np(t){this.Kt=t}function rp(t,e){this.payload=t,this.byteLength=e}function ip(t,e,n){this.query=t,this.el=e,this.nl=!1,this.sl=null,this.onlineState="Unknown",this.options=n||{}}function op(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var sp=function(t){this.key=t},up=function(t){this.key=t},ap=(Object.defineProperty(pp.prototype,"El",{get:function(){return this._l},enumerable:!1,configurable:!0}),pp.prototype.Il=function(t,e){var s=this,u=e?e.ml:new Hu,a=(e||this).Tl,c=(e||this).Ce,h=a,f=!1,l=vs(this.query)&&a.size===this.query.limit?a.last():null,p=gs(this.query)&&a.size===this.query.limit?a.first():null;if(t.Zt(function(t,e){var n=a.get(t),r=(r=e instanceof Ao?e:null)&&(xs(s.query,r)?r:null),i=!!n&&s.Ce.has(n.key),o=!!r&&(r.bt||s.Ce.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.Al(n,r)||(u.track({type:2,doc:r}),e=!0,(l&&0<s.wl(r,l)||p&&s.wl(r,p)<0)&&(f=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(l||p)&&(f=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),vs(this.query)||gs(this.query))for(;h.size>this.query.limit;){var n=vs(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{Tl:h,ml:u,_c:f,Ce:c}},pp.prototype.Al=function(t,e){return t.bt&&e.hasCommittedMutations&&!e.bt},pp.prototype.Ti=function(t,e,n){var o=this,r=this.Tl;this.Tl=t.Tl,this.Ce=t.Ce;var i=t.ml.Se();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.wl(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xr()}}var r,i}),this.Rl(n);var s=e?this.Pl():[],e=(n=0===this.dl.size&&this.qe?1:0)!==this.fl;return this.fl=n,0!==i.length||e?{snapshot:new Gu(this.query,t.Tl,r,i,t.Ce,0==n,e,!1),yl:s}:{yl:s}},pp.prototype.Xh=function(t){return this.qe&&"Offline"===t?(this.qe=!1,this.Ti({Tl:this.Tl,ml:new Hu,Ce:this.Ce,_c:!1},!1)):{yl:[]}},pp.prototype.gl=function(t){return!this._l.has(t)&&!!this.Tl.has(t)&&!this.Tl.get(t).bt},pp.prototype.Rl=function(t){var e=this;t&&(t.Ue.forEach(function(t){return e._l=e._l.add(t)}),t.Qe.forEach(function(t){}),t.Ke.forEach(function(t){return e._l=e._l.delete(t)}),this.qe=t.qe)},pp.prototype.Pl=function(){var e=this;if(!this.qe)return[];var n=this.dl;this.dl=qu(),this.Tl.forEach(function(t){e.gl(t.key)&&(e.dl=e.dl.add(t.key))});var r=[];return n.forEach(function(t){e.dl.has(t)||r.push(new up(t))}),this.dl.forEach(function(t){n.has(t)||r.push(new sp(t))}),r},pp.prototype.Vl=function(t){return this._l=t.Pc,this.dl=qu(),t=this.Il(t.documents),this.Ti(t,!0)},pp.prototype.pl=function(){return Gu.Fe(this.query,this.Tl,this.Ce,0===this.fl)},pp),cp=function(t,e,n){this.query=t,this.targetId=e,this.view=n},hp=function(t){this.key=t,this.bl=!1},fp=(Object.defineProperty(lp.prototype,"jl",{get:function(){return!0===this.Kl},enumerable:!1,configurable:!0}),lp);function lp(t,e,n,r,i,o,s){this.xh=t,this.vl=e,this.Sl=n,this.Dl=r,this.currentUser=i,this.Cl=o,this.xl=s,this.Nl={},this.Fl=!1,this.Ol=new rh(Ns,Ts),this.kl=new Map,this.Ml=[],this.$l=new Nu(Fi.J),this.Ll=new Map,this.Bl=new vf,this.ql={},this.Ul=new Map,this.Ql=dh.Bi(),this.onlineState="Unknown",this.Kl=void 0}function pp(t,e){this.query=t,this._l=e,this.fl=null,this.qe=!1,this.dl=qu(),this.Ce=qu(),this.wl=Ss(t),this.Tl=new Bu(this.wl)}function dp(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Wl=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.Il(o))._c?[4,hf(r.xh,i.query,!1).then(function(t){return t=t.documents,i.view.Il(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.Oe.get(i.targetId),n=i.view.Ti(e,r.jl,n),[2,(_p(r,i.targetId,n.yl),n.snapshot)]}})})}(i,t,e,n)},[4,hf(i.xh,o,!0)];case 1:return n=t.sent(),r=new ap(o,n.Pc),e=r.Il(n.documents),n=zu.Be(s,u&&"Offline"!==i.onlineState),n=r.Ti(e,i.jl,n),_p(i,s,n.yl),r=new cp(o,s,r),[2,(i.Ol.set(o,r),i.kl.has(s)?i.kl.get(s).push(o):i.kl.set(s,[o]),n.snapshot)]}})})}function yp(l,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=Op(l),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.xh,a=p,h=i,f=Ci.now(),o=a.reduce(function(t,e){return t.add(e.key)},qu()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Ic.Zo(u,o).next(function(t){c=t;for(var e,n=[],r=0,i=a;r<i.length;r++){var o=i[r],s=(e=o,s=c.get(o.key),function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof Ao?e.field(o.field):void 0;null!=(s=Cs(o.transform,s||null))&&(n=(null==n?new wo:n).set(o.field,s))}return n?n.yt():null}(e.fieldTransforms,s));null!=s&&n.push(new au(o.key,s,function s(t){var u=[];return Ji(t.fields||{},function(t,e){var n=new Ui([t]);if(mo(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new Xi(u)}(s.proto.mapValue),$s.exists(!0)))}return h.Ho.Pi(u,f,n,a)})}).then(function(t){var e=t.Ns(c);return{batchId:t.batchId,oi:e}}))];case 2:return s=t.sent(),u.Dl.xa(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.ql[e.currentUser.R()])||new Nu($r)).Ht(n,r),e.ql[e.currentUser.R()]=i,[4,Np(u,s.oi)];case 3:return t.sent(),[4,Fl(u.vl)];case 4:return t.sent(),[3,6];case 5:return u=$a(u=t.sent(),"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,f,o})})}function vp(o,s){return y(this,void 0,void 0,function(){var n,i;return v(this,function(t){switch(t.label){case 0:n=o,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.xh,a=e,c=(r=s).Mt,h=a.dc,a.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=a.Ec.Fr({Wr:!0});h=a.dc;var u=[];r.Oe.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(u.push(a.fo.ir(s,t.Ke,e).next(function(){return a.fo.nr(s,t.Ue,e)})),0<(i=t.resumeToken).o()&&(n=o.Lt(i,c).$t(s.vs),h=h.Ht(e,n),r=o,i=t,Yr(0<(o=n).resumeToken.o()),(0===r.resumeToken.o()||3e8<=o.Mt.W()-r.Mt.W()||0<i.Ue.size+i.Qe.size+i.Ke.size)&&u.push(a.fo.Ji(s,n))))});var e,n=Cu;return r.Me.forEach(function(t,e){r.$e.has(t)&&u.push(a.persistence.Ii.kr(s,t))}),u.push(uf(s,t,r.Me,c,void 0).next(function(t){n=t})),c.isEqual(Ri.min())||(e=a.fo.Ki(s).next(function(t){return a.fo.Wi(s,s.vs,c)}),u.push(e)),Ra.Ln(u).next(function(){return t.apply(s)}).next(function(){return a.Ic.tc(s,n)})}).then(function(t){return a.dc=h,t}))];case 2:return i=t.sent(),s.Oe.forEach(function(t,e){(e=n.Ll.get(e))&&(Yr(t.Ue.size+t.Qe.size+t.Ke.size<=1),0<t.Ue.size?e.bl=!0:0<t.Qe.size?Yr(e.bl):0<t.Ke.size&&(Yr(e.bl),e.bl=!1))}),[4,Np(n,i,s)];case 3:return t.sent(),[3,6];case 4:return[4,nh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,a,c,h})})}function gp(t,n,e){var r;((t=t).jl&&0===e||!t.jl&&1===e)&&(r=[],t.Ol.forEach(function(t,e){(e=e.view.Xh(n)).snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Xh(i)&&(o=!0)}),o&&Yl(t)}(t.Sl,n),r.length&&t.Nl._h(r),t.onlineState=n,t.jl&&t.Dl.Ka(n))}function mp(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:Rl((n=o).vl)||Kr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.xh).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Ho.pi(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Ul.get(r)||[]).push(s),n.Ul.set(r,i),[3,4]);case 3:return i=$a(i=t.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function bp(t,e){(t.Ul.get(e)||[]).forEach(function(t){t.resolve()}),t.Ul.delete(e)}function wp(t,e,n){var r=t,i=r.ql[r.currentUser.R()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.ql[r.currentUser.R()]=i)}function Ep(e,t,n){void 0===n&&(n=null),e.Dl.$a(t);for(var r=0,i=e.kl.get(t);r<i.length;r++){var o=i[r];e.Ol.delete(o),n&&e.Nl.Gl(o,n)}e.kl.delete(t),e.jl&&e.Bl.kc(t).forEach(function(t){e.Bl.ki(t)||Ip(e,t)})}function Ip(t,e){var n=t.$l.get(e);null!==n&&(Dl(t.vl,n),t.$l=t.$l.remove(e),t.Ll.delete(n),Tp(t))}function _p(t,e,n){for(var r,i,o=0,s=n;o<s.length;o++){var u=s[o];u instanceof sp?(t.Bl.sr(u.key,e),r=t,i=(i=u).key,r.$l.get(i)||(Kr("SyncEngine","New document in limbo: "+i),r.Ml.push(i),Tp(r))):u instanceof up?(Kr("SyncEngine","Document no longer in limbo: "+u.key),t.Bl.rr(u.key,e),t.Bl.ki(u.key)||Ip(t,u.key)):Xr()}}function Tp(t){for(;0<t.Ml.length&&t.$l.size<t.Cl;){var e=t.Ml.shift(),n=t.Ql.next();t.Ll.set(n,new hp(e)),t.$l=t.$l.Ht(e,n),Ol(t.vl,new Os(Is(ys(e.path)),n,2,Ai.U))}}function Np(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Ol.nt()?[3,3]:(n.Ol.forEach(function(t,e){o.push(n.Wl(e,s,u).then(function(t){t&&(n.jl&&n.Dl.qa(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=Yh.cc(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.Nl._h(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Ra.forEach(c,function(e){return Ra.forEach(e.rc,function(t){return r.persistence.Ii.sr(n,e.targetId,t)}).next(function(){return Ra.forEach(e.oc,function(t){return r.persistence.Ii.rr(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Ka(e=t.sent()))throw e;return Kr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.dc.get(o),u=s.Mt,u=s.Bt(u),r.dc=r.dc.Ht(o,u));return[2]}})})}(n.xh,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Ap(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.kl.get(s))&&0!==a.length?[4,af(e.xh,Is(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],f=e.Ol.get(f),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,hf((e=r).xh,i.query,!0)];case 1:return n=t.sent(),n=i.view.Vl(n),[2,(e.jl&&_p(e,i.targetId,n.yl),n)]}})})}(e,f)]):[3,6];case 4:(f=t.sent()).snapshot&&r.push(f.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,ff(e.xh,s)];case 8:return l=t.sent(),[4,af(e.xh,l)];case 9:return u=t.sent(),[4,dp(e,xp(l),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Nl._h(r),n)]}})})}function xp(t){return ds(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Sp(t){var n=t;return n.vl.Fh.Qh=vp.bind(null,n),n.vl.Fh.Sn=function(t,e){var n=t;if((t=n.Ll.get(e))&&t.bl)return qu().add(t.key);var r=qu();if(!(e=n.kl.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Ol.get(s),r=r.ye(s.view.El);return r}.bind(null,n),n.vl.Fh.Uh=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).Dl.qa(s,"rejected",u),i=e.Ll.get(s),(n=i&&i.key)?(r=(r=new Nu(Fi.J)).Ht(n,new xo(n,Ri.min())),i=qu().add(n),i=new Ku(Ri.min(),new Map,new Lu($r),r,i),[4,vp(e,i)]):[3,2];case 1:return t.sent(),e.$l=e.$l.remove(n),e.Ll.delete(s),Tp(e),[3,4];case 2:return[4,cf(e.xh,s,!1).then(function(){return Ep(e,s,u)}).catch(nh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,n),n.vl.Fh.Kh=function(t,e){!n.Fl&&n.xl&&(n.Fl=!0,n.xl(t,e))},n.Nl._h=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query;if(u=n.queries.get(u)){for(var a=0,c=u.listeners;a<c.length;a++)c[a].Zh(s)&&(r=!0);u.Hh=s}}r&&Yl(n)}.bind(null,n.Sl),n.Nl.Gl=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,n.Sl),n}function Op(t){return t.vl.Fh.jh=function(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:n=o,r=s.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.xh,h=s,(f=e).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r,e=h.batch.keys(),n=f.Ec.Fr({Wr:!0}),i=f,o=t,s=n,u=(r=h).batch,a=u.keys(),c=Ra.resolve();return a.forEach(function(n){c=c.next(function(){return s.fi(o,n)}).next(function(t){var e=t;Yr(null!==(t=r.Os.get(n))),(!e||e.version.u(t)<0)&&(e=u.Ds(n,e,r))&&s.ui(e,r.Fs)})}),c.next(function(){return i.Ho.xi(o,u)}).next(function(){return n.apply(t)}).next(function(){return f.Ho.Oi(t)}).next(function(){return f.Ic.Zo(t,e)})}))];case 2:return i=t.sent(),wp(n,r,null),bp(n,r),n.Dl.Fa(r,"acknowledged"),[4,Np(n,i)];case 3:return t.sent(),[3,6];case 4:return[4,nh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,h,f})})}.bind(null,t),t.vl.Fh.Wh=function(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.xh,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Ho.yi(e,r).next(function(t){return Yr(null!==t),n=t.keys(),i.Ho.xi(e,t)}).next(function(){return i.Ho.Oi(e)}).next(function(){return i.Ic.Zo(e,n)})}))];case 2:return o=t.sent(),wp(n,u,a),bp(n,u),n.Dl.Fa(u,"rejected",a),[4,Np(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,nh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,t),t}function Dp(t,e,n){var r=t;(function(l,p,d){return y(this,void 0,void 0,function(){var u,a,c,h,f;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return u=t.sent(),[4,(r=l.xh,o=r,s=la((i=u).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.To.Ms(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.u(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d.zl({taskState:"Success",documentsLoaded:u.totalDocuments,bytesLoaded:u.totalBytes,totalDocuments:u.totalDocuments,totalBytes:u.totalBytes}))];case 4:return d.Hl(op(u)),a=new tp(u,l.xh,p.Kt),[4,p.Jl()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,a.hl(c)]:[3,10];case 7:return(h=t.sent())&&d.Hl(h),[4,p.Jl()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,a.complete()];case 11:return f=t.sent(),[4,Np(l,f.zo,void 0)];case 12:return t.sent(),[4,(r=l.xh,e=u,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.To.$s(t,e)}))];case 13:return t.sent(),d.zl(f.progress),[3,15];case 14:return Jr("SyncEngine","Loading bundle failed with "+(f=t.sent())),d.Yl(f),[3,15];case 15:return[2]}var e,n,r,i,o,s})})})(r,e,n).then(function(){r.Dl.Wa()})}var kp,Lp,Pp=(qp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Kt=fl(e.bu.T),this.Dl=this.Xl(e),this.persistence=this.Zl(e),[4,this.persistence.start()];case 1:return t.sent(),this.t_=this.e_(e),this.xh=this.n_(e),[2]}})})},qp.prototype.e_=function(t){return null},qp.prototype.n_=function(t){return rf(this.persistence,new Qh,t.s_,this.Kt)},qp.prototype.Zl=function(t){return new If(Tf.ra,this.Kt)},qp.prototype.Xl=function(t){return new Kf},qp.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.t_&&this.t_.stop(),[4,this.Dl.$o()];case 1:return t.sent(),[4,this.persistence.$o()];case 2:return t.sent(),[2]}})})},qp),Cp=(h(Fp,Lp=Pp),Fp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Lp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=Vh(t),r=Ri.min(),t.ls({index:pc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=Rc(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.Tc=t})]})})}(this.xh)];case 2:return t.sent(),[4,this.i_.initialize(this,e)];case 3:return t.sent(),[4,Op(this.i_.fa)];case 4:return t.sent(),[4,Fl(this.i_.vl)];case 5:return t.sent(),[2]}})})},Fp.prototype.n_=function(t){return rf(this.persistence,new Qh,t.s_,this.Kt)},Fp.prototype.e_=function(t){var e=this.persistence.Ii._r;return new _h(e,t.fs)},Fp.prototype.Zl=function(t){var e=Jh(t.bu.T,t.bu.persistenceKey),n=void 0!==this.cacheSizeBytes?th.Xs(this.cacheSizeBytes):th.ei;return new Hh(this.synchronizeTabs,e,t.clientId,n,t.fs,cl(),hl(),this.Kt,this.Dl,!!this.forceOwnership)},Fp.prototype.Xl=function(t){return new Kf},Fp),Rp=(h(Up,kp=Cp),Up.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,kp.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.i_.fa,this.Dl instanceof Gf?(this.Dl.fa={nu:function(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).xh,n=a,i=(r=e).Ho,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.gi(e,n).next(function(t){return t?r.Ic.Zo(e,t):Ra.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,Fl(o.vl)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(wp(o,a,h||null),bp(o,a),o.xh.Ho.Ni(a)):Xr(),t.label=4;case 4:return[4,Np(o,s)];case 5:return t.sent(),[3,7];case 6:Kr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}.bind(null,e),su:function(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return(e=i).Kl?(Kr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.kl.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,lf(e.xh)];case 3:return n=t.sent(),r=Ku.Le(o,"current"===s),[4,Np(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,cf(e.xh,o,!0)];case 6:return t.sent(),Ep(e,o,u),[3,8];case 7:Xr(),t.label=8;case 8:return[2]}})})}.bind(null,e),iu:function(c,h,f){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=Sp(c)).Kl)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.kl.has(r)?(Kr("SyncEngine","Adding an already active target "+r),[3,5]):[4,ff(n.xh,r)]):[3,6];case 2:return i=t.sent(),[4,af(n.xh,i)];case 3:return o=t.sent(),[4,dp(n,xp(i),o.targetId,!1)];case 4:t.sent(),Ol(n.vl,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.kl.has(e)?[4,cf(n.xh,e,!1).then(function(){Dl(n.vl,e),Ep(n,e)}).catch(nh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=f,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),Qo:function(t){return t.xh.persistence.Qo()}.bind(null,e),eu:function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,lf((e=n).xh).then(function(t){return Np(e,t)})]})})}.bind(null,e)},[4,this.Dl.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.Po(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,function(h,f){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return Sp(r=h),Op(r),!0!==f||!0===r.Kl?[3,3]:(e=r.Dl.Sa(),[4,Ap(r,e.rt())]);case 1:return i=t.sent(),r.Kl=!0,[4,Hl(r.vl,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],Ol(r.vl,u);return[3,7];case 3:return!1!==f||!1===r.Kl?[3,7]:(a=[],c=Promise.resolve(),r.kl.forEach(function(t,e){r.Dl.La(e)?a.push(e):c=c.then(function(){return Ep(r,e),cf(r.xh,e,!0)}),Dl(r.vl,e)}),[4,c]);case 4:return t.sent(),[4,Ap(r,a)];case 5:return t.sent(),(n=r).Ll.forEach(function(t,e){Dl(n.vl,e)}),n.Bl.Mc(),n.Ll=new Map,n.$l=new Nu(Fi.J),r.Kl=!1,[4,Hl(r.vl,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}(this.i_.fa,e)];case 1:return t.sent(),this.t_&&(e&&!this.t_.Er?this.t_.start(this.xh):e||this.t_.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Up.prototype.Xl=function(t){var e=cl();if(!Gf.jn(e))throw new si(oi.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Jh(t.bu.T,t.bu.persistenceKey);return new Gf(e,t.fs,n,t.clientId,t.s_)},Up),Mp=(Vp.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.xh?[3,2]:(this.xh=n.xh,this.Dl=n.Dl,this.Nh=this.r_(r),this.vl=this.o_(r),this.Sl=this.c_(r),this.fa=this.a_(r,!n.synchronizeTabs),this.Dl.da=function(t){return gp(e.fa,t,1)},this.vl.Fh.u_=function(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Kr("SyncEngine","User change. New user:",o.R()),[4,of(n.xh,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Ul.forEach(function(t){t.forEach(function(t){t.reject(new si(oi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ul.clear(),n.Dl.Qa(o,r.Ac,r.Rc),[4,Np(n,r.mc)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}.bind(null,this.fa),[4,Hl(this.vl,this.fa.jl)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Vp.prototype.c_=function(t){return new zl},Vp.prototype.r_=function(t){var e=fl(t.bu.T),n=(n=t.bu,new Yf(n));return t=t.credentials,new bl(t,n,e)},Vp.prototype.o_=function(t){var e=this;return new ll(this.xh,this.Nh,t.fs,function(t){return gp(e.fa,t,0)},t=new(Jf.jn()?Jf:zf))},Vp.prototype.a_=function(t,e){return n=this.xh,r=this.vl,i=this.Sl,o=this.Dl,s=t.s_,u=t.Cl,e=e,t=t.xl,t=new fp(n,r,i,o,s,u,t),e&&(t.Kl=!0),t;var n,r,i,o,s,u},Vp.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,Kr("RemoteStore","RemoteStore shutting down."),e.Mh.add(5),[4,Sl(e)];case 1:return t.sent(),e.Lh.$o(),e.Bh.set("Unknown"),[2]}})})}(this.vl)},Vp);function Vp(){}function Up(t,e){var n=this;return(n=kp.call(this,t,e,!1)||this).i_=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function Fp(t,e,n){var r=this;return(r=Lp.call(this)||this).i_=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function qp(){this.synchronizeTabs=!1}function jp(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2]})})},releaseLock:function(){}}}var Bp=(Wp.prototype.next=function(t){this.observer.next&&this.h_(this.observer.next,t)},Wp.prototype.error=function(t){this.observer.error?this.h_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Wp.prototype.l_=function(){this.muted=!0},Wp.prototype.h_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Wp),Hp=(Jp.prototype.close=function(){return this.__.cancel()},Jp.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2,this.metadata.promise]})})},Jp.prototype.Jl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.d_())]}})})},Jp.prototype.d_=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.w_()];case 1:return null===(e=t.sent())?[2,null]:(r=this.f_.decode(e),n=Number(r),isNaN(n)&&this.T_("length string ("+r+") is not valid number"),[4,this.E_(n)]);case 2:return r=t.sent(),[2,new Zl(JSON.parse(r),e.length+n)]}})})},Jp.prototype.I_=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},Jp.prototype.w_=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.I_()<0?[4,this.m_()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.I_())<0&&this.T_("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},Jp.prototype.E_=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.m_()]:[3,3];case 1:t.sent()&&this.T_("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.f_.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},Jp.prototype.T_=function(t){throw this.__.cancel(),new Error("Invalid bundle format: "+t)},Jp.prototype.m_=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.__.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},Jp),Gp=(zp.prototype.isEqual=function(t){return this.A_.isEqual(t.A_)},zp),Kp=function(t){this._methodName=t};function zp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new si(oi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.A_=new Ui(t)}function Jp(t,e){var n=this;this.__=t,this.Kt=e,this.metadata=new Ca,this.buffer=new Uint8Array,this.f_=new TextDecoder("utf-8"),this.d_().then(function(t){t&&t.al()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function Wp(t){this.observer=t,this.muted=!1}function Xp(t,e,n){if(!n)throw new si(oi.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Yp(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new si(oi.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Qp(t,e,n,r){if(!0===e&&!0===r)throw new si(oi.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Zp(t){if(!Fi.Tt(t))throw new si(oi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function $p(t){if(Fi.Tt(t))throw new si(oi.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function td(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Xr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function ed(t,e){if("_delegate"in t&&(t=t._),t instanceof e)return t;if(e.name===t.constructor.name)throw new si(oi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw t=td(t),new si(oi.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function nd(t,e){if(e<=0)throw new si(oi.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var rd,id=(dd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},dd),od=new Map,sd=(Object.defineProperty(pd.prototype,"app",{get:function(){if(!this.p_)throw new si(oi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.p_},enumerable:!1,configurable:!0}),Object.defineProperty(pd.prototype,"b_",{get:function(){return this.y_},enumerable:!1,configurable:!0}),Object.defineProperty(pd.prototype,"v_",{get:function(){return void 0!==this.S_},enumerable:!1,configurable:!0}),pd.prototype.D_=function(t){if(this.y_)throw new si(oi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.P_=new id(t),void 0!==t.credentials&&(this.V_=function(t){if(!t)return new Ii;switch(t.type){case"gapi":var e=t.client;return Yr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ni(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new si(oi.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},pd.prototype.C_=function(){return this.P_},pd.prototype.x_=function(){return this.y_=!0,this.P_},pd.prototype._delete=function(){return this.S_||(this.S_=this.N_()),this.S_},pd.prototype.N_=function(){return(t=od.get(this))&&(Kr("ComponentProvider","Removing Datastore"),od.delete(this),t.terminate()),Promise.resolve();var t},pd),ud=(Object.defineProperty(ld.prototype,"k_",{get:function(){return this.O_.path},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"id",{get:function(){return this.O_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"path",{get:function(){return this.O_.path.ot()},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"parent",{get:function(){return new cd(this.firestore,this.F_,this.O_.path.Z())},enumerable:!1,configurable:!0}),ld.prototype.withConverter=function(t){return new ld(this.firestore,t,this.O_)},ld),ad=(fd.prototype.withConverter=function(t){return new fd(this.firestore,t,this.M_)},fd),cd=(h(hd,rd=ad),Object.defineProperty(hd.prototype,"id",{get:function(){return this.M_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(hd.prototype,"path",{get:function(){return this.M_.path.ot()},enumerable:!1,configurable:!0}),Object.defineProperty(hd.prototype,"parent",{get:function(){var t=this.k_.Z();return t.nt()?null:new ud(this.firestore,null,new Fi(t))},enumerable:!1,configurable:!0}),hd.prototype.withConverter=function(t){return new hd(this.firestore,t,this.k_)},hd);function hd(t,e,n){var r=this;return(r=rd.call(this,t,e,ys(n))||this).firestore=t,r.k_=n,r.type="collection",r}function fd(t,e,n){this.F_=e,this.M_=n,this.type="query",this.firestore=t}function ld(t,e,n){this.F_=e,this.O_=n,this.type="document",this.firestore=t}function pd(t,e){this.R_="(lite)",this.P_=new id({}),this.y_=!1,t instanceof vi?(this.g_=t,this.V_=new Ii):(this.p_=t,this.g_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new si(oi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vi(t.options.projectId)}(t),this.V_=new _i(e))}function dd(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new si(oi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new si(oi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Qp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function yd(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof ai&&(t=t._),Xp("collection","path",e),t instanceof sd)return $p(n=Mi.ct.apply(Mi,f([e],r))),new cd(t,null,n);if(!(t instanceof ud||t instanceof cd))throw new si(oi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return $p(n=Mi.ct.apply(Mi,f([t.path],r)).child(Mi.ct(e))),new cd(t.firestore,null,n)}function vd(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof ai&&(t=t._),1===arguments.length&&(e=Qr.t()),Xp("doc","path",e),t instanceof sd)return Zp(n=Mi.ct.apply(Mi,f([e],r))),new ud(t,null,new Fi(n));if(!(t instanceof ud||t instanceof cd))throw new si(oi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Zp(n=t.k_.child(Mi.ct.apply(Mi,f([e],r)))),new ud(t.firestore,t instanceof cd?t.F_:null,new Fi(n))}function gd(t,e){return t instanceof ai&&(t=t._),e instanceof ai&&(e=e._),(t instanceof ud||t instanceof cd)&&(e instanceof ud||e instanceof cd)&&t.firestore===e.firestore&&t.path===e.path&&t.F_===e.F_}function md(t,e){return t instanceof ai&&(t=t._),e instanceof ai&&(e=e._),t instanceof ad&&e instanceof ad&&t.firestore===e.firestore&&Ts(t.M_,e.M_)&&t.F_===e.F_}var bd=(Object.defineProperty(Nd.prototype,"latitude",{get:function(){return this.L_},enumerable:!1,configurable:!0}),Object.defineProperty(Nd.prototype,"longitude",{get:function(){return this.B_},enumerable:!1,configurable:!0}),Nd.prototype.isEqual=function(t){return this.L_===t.L_&&this.B_===t.B_},Nd.prototype.toJSON=function(){return{latitude:this.L_,longitude:this.B_}},Nd.prototype.K=function(t){return $r(this.L_,t.L_)||$r(this.B_,t.B_)},Nd),wd=/^__.*__$/,Ed=(Td.prototype.q_=function(t,e){return null!==this.zt?new au(t,this.data,this.zt,e,this.fieldTransforms):new uu(t,this.data,e,this.fieldTransforms)},Td),Id=(_d.prototype.q_=function(t,e){return new au(t,this.data,this.zt,e,this.fieldTransforms)},_d);function _d(t,e,n){this.data=t,this.zt=e,this.fieldTransforms=n}function Td(t,e,n){this.data=t,this.zt=e,this.fieldTransforms=n}function Nd(t,e){if(!isFinite(t)||t<-90||90<t)throw new si(oi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new si(oi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.L_=t,this.B_=e}function Ad(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Xr()}}var xd=(Object.defineProperty(Dd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"Q_",{get:function(){return this.settings.Q_},enumerable:!1,configurable:!0}),Dd.prototype.K_=function(t){return new Dd(Object.assign(Object.assign({},this.settings),t),this.T,this.Kt,this.ignoreUndefinedProperties,this.fieldTransforms,this.zt)},Dd.prototype.j_=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t);return(e=this.K_({path:e,W_:!1})).G_(t),e},Dd.prototype.z_=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t);return(t=this.K_({path:t,W_:!1})).U_(),t},Dd.prototype.H_=function(t){return this.K_({path:void 0,W_:!0})},Dd.prototype.J_=function(t){return oy(t,this.settings.methodName,this.settings.Y_||!1,this.path,this.settings.X_)},Dd.prototype.contains=function(e){return void 0!==this.zt.find(function(t){return e.st(t)})||void 0!==this.fieldTransforms.find(function(t){return e.st(t.field)})},Dd.prototype.U_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.G_(this.path.get(t))},Dd.prototype.G_=function(t){if(0===t.length)throw this.J_("Document fields must not be empty");if(Ad(this.Q_)&&wd.test(t))throw this.J_('Document fields cannot begin and end with "__"')},Dd),Sd=(Od.prototype.Z_=function(t,e,n,r){return void 0===r&&(r=!1),new xd({Q_:t,methodName:e,X_:n,path:Ui.at(),W_:!1,Y_:r},this.T,this.Kt,this.ignoreUndefinedProperties)},Od);function Od(t,e,n){this.T=t,this.ignoreUndefinedProperties=e,this.Kt=n||fl(t)}function Dd(t,e,n,r,i,o){this.settings=t,this.T=e,this.Kt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.U_(),this.fieldTransforms=i||[],this.zt=o||[]}function kd(t){var e=t.x_(),n=fl(t.g_);return new Sd(t.g_,!!e.ignoreUndefinedProperties,n)}function Ld(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Z_(o.merge||o.mergeFields?2:0,e,n,i);ey("Data must be an object, but it was:",s,r);var u,a,r=$d(r,s);if(o.merge)u=new Xi(s.zt),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,f=o.mergeFields;h<f.length;h++){var l=ny(e,f[h],n);if(!s.contains(l))throw new si(oi.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");sy(c,l)||c.push(l)}u=new Xi(c),a=s.fieldTransforms.filter(function(t){return u.It(t.field)})}else u=null,a=s.fieldTransforms;return new Ed(new bo(r),u,a)}var Pd,Cd=(h(Rd,Pd=Kp),Rd.prototype.tf=function(t){if(2!==t.Q_)throw 1===t.Q_?t.J_(this._methodName+"() can only appear at the top level of your update data"):t.J_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.zt.push(t.path),null},Rd.prototype.isEqual=function(t){return t instanceof Rd},Rd);function Rd(){return null!==Pd&&Pd.apply(this,arguments)||this}function Md(t,e,n){return new xd({Q_:3,X_:e.settings.X_,methodName:t._methodName,W_:n},e.T,e.Kt,e.ignoreUndefinedProperties)}var Vd,Ud,Fd,qd,jd=(h(Wd,qd=Kp),Wd.prototype.tf=function(t){return new Zs(t.path,new Vs)},Wd.prototype.isEqual=function(t){return t instanceof Wd},Wd),Bd=(h(Jd,Fd=Kp),Jd.prototype.tf=function(t){var e=Md(this,t,!0),n=this.ef.map(function(t){return Zd(t,e)}),n=new Us(n);return new Zs(t.path,n)},Jd.prototype.isEqual=function(t){return this===t},Jd),Hd=(h(zd,Ud=Kp),zd.prototype.tf=function(t){var e=Md(this,t,!0),n=this.ef.map(function(t){return Zd(t,e)}),n=new Hs(n);return new Zs(t.path,n)},zd.prototype.isEqual=function(t){return this===t},zd),Gd=(h(Kd,Vd=Kp),Kd.prototype.tf=function(t){var e=new Js(t.Kt,Ps(t.Kt,this.nf));return new Zs(t.path,e)},Kd.prototype.isEqual=function(t){return this===t},Kd);function Kd(t,e){var n=this;return(n=Vd.call(this,t)||this).nf=e,n}function zd(t,e){var n=this;return(n=Ud.call(this,t)||this).ef=e,n}function Jd(t,e){var n=this;return(n=Fd.call(this,t)||this).ef=e,n}function Wd(){return null!==qd&&qd.apply(this,arguments)||this}function Xd(t,r,i,e){var o=t.Z_(1,r,i);ey("Data must be an object, but it was:",o,e);var s=[],u=new wo;return Ji(e,function(t,e){var n=iy(r,t,i);e instanceof ai&&(e=e._),t=o.z_(n),e instanceof Cd?s.push(n):null!=(t=Zd(e,t))&&(s.push(n),u.set(n,t))}),e=new Xi(s),new Id(u.yt(),e,o.fieldTransforms)}function Yd(t,e,n,r,i,o){var s=t.Z_(1,e,n),u=[ny(e,r,n)],a=[i];if(o.length%2!=0)throw new si(oi.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(ny(e,o[c])),a.push(o[c+1]);for(var h,f,l,p=[],d=new wo,y=u.length-1;0<=y;--y)sy(p,u[y])||(h=u[y],(f=a[y])instanceof ai&&(f=f._),l=s.z_(h),f instanceof Cd?p.push(h):null!=(l=Zd(f,l))&&(p.push(h),d.set(h,l)));return i=new Xi(p),new Id(d.yt(),i,s.fieldTransforms)}function Qd(t,e,n,r){return void 0===r&&(r=!1),Zd(n,t.Z_(r?4:3,e))}function Zd(s,t){if(s instanceof ai&&(s=s._),ty(s))return ey("Unsupported field value:",t,s),$d(s,t);if(s instanceof Kp)return function(t,e){if(!Ad(e.Q_))throw e.J_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.J_(t._methodName+"() is not currently supported inside arrays");(t=t.tf(e))&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.zt.push(t.path),s instanceof Array){if(t.settings.W_&&4!==t.Q_)throw t.J_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Zd(i[r],t.H_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(t instanceof ai&&(t=t._),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ps(e.Kt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ci.fromDate(t);return{timestampValue:ha(e.Kt,n)}}if(t instanceof Ci)return n=new Ci(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ha(e.Kt,n)};if(t instanceof bd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ui)return{bytesValue:fa(e.Kt,t.l)};if(t instanceof ud){n=e.T;var r=t.firestore.g_;if(!r.isEqual(n))throw e.J_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:pa(t.firestore.g_||e.T,t.O_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.J_("Unsupported field value: "+td(t))}(s,t)}function $d(t,n){var r={};return Wi(t)?n.path&&0<n.path.length&&n.zt.push(n.path):Ji(t,function(t,e){null!=(e=Zd(e,n.j_(t)))&&(r[t]=e)}),{mapValue:{fields:r}}}function ty(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ci||t instanceof bd||t instanceof ui||t instanceof ud||t instanceof Kp)}function ey(t,e,n){if(!ty(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=td(n))?e.J_(t+" a custom object"):e.J_(t+" "+n);var r}function ny(t,e,n){if(e instanceof ai&&(e=e._),e instanceof Gp)return e.A_;if("string"==typeof e)return iy(t,e);throw oy("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var ry=new RegExp("[~\\*/\\[\\]]");function iy(e,n,r){if(0<=n.search(ry))throw oy("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(Gp.bind.apply(Gp,f([void 0],n.split("."))))).A_}catch(t){throw oy("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function oy(t,e,n,r,i){var o=r&&!r.nt(),s=void 0!==i,e="Function "+e+"() called with invalid data";return n&&(e+=" (via `toFirestore()`)"),n="",(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new si(oi.INVALID_ARGUMENT,(e+=". ")+t+n)}function sy(t,e){return t.some(function(t){return t.isEqual(e)})}var uy=(ly.prototype.uf=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.hf(),0<this.mutations.length)throw new si(oi.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var r,e,n,i,o;return v(this,function(t){switch(t.label){case 0:return e=ba((r=s).Kt)+"/documents",n={documents:u.map(function(t){return ya(r.Kt,t)})},[4,r.Fu("BatchGetDocuments",e,n)];case 1:return n=t.sent(),i=new Map,n.forEach(function(t){var e,n,t=(n=r.Kt,"found"in t?function(t,e){Yr(!!e.found),e.found.name,e.found.updateTime;var n=va(t,e.found.name),t=la(e.found.updateTime),e=new bo({mapValue:{fields:e.found.fields}});return new Ao(n,t,e,{})}(n,t):"missing"in t?(e=n,Yr(!!(n=t).missing),Yr(!!n.readTime),e=va(e,n.missing),n=la(n.readTime),new xo(e,n)):Xr());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){Yr(!!(t=i.get(t.toString()))),o.push(t)}),o)]}})})}(this.Nh,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof xo||t instanceof Ao?n.lf(t):Xr()}),e)]}})})},ly.prototype.set=function(t,e){this.write(e.q_(t,this.Gt(t))),this.af.add(t.toString())},ly.prototype.update=function(t,e){try{this.write(e.q_(t,this._f(t)))}catch(t){this.cf=t}this.af.add(t.toString())},ly.prototype.delete=function(t){this.write(new bu(t,this.Gt(t))),this.af.add(t.toString())},ly.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.hf(),this.cf)throw this.cf;return e=this.sf,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Fi.ft(e),n.mutations.push(new wu(e,n.Gt(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=ba((e=i).Kt)+"/documents",r={writes:o.map(function(t){return _a(e.Kt,t)})},[4,e.Du("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.Nh,this.mutations)];case 1:return t.sent(),this.rf=!0,[2]}})})},ly.prototype.lf=function(t){var e;if(t instanceof Ao)e=t.version;else{if(!(t instanceof xo))throw Xr();e=Ri.min()}var n=this.sf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new si(oi.ABORTED,"Document version changed between two reads.")}else this.sf.set(t.key.toString(),e)},ly.prototype.Gt=function(t){var e=this.sf.get(t.toString());return!this.af.has(t.toString())&&e?$s.updateTime(e):$s.jt()},ly.prototype._f=function(t){var e=this.sf.get(t.toString());if(this.af.has(t.toString())||!e)return $s.exists(!0);if(e.isEqual(Ri.min()))throw new si(oi.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $s.updateTime(e)},ly.prototype.write=function(t){this.hf(),this.mutations.push(t)},ly.prototype.hf=function(){},ly),ay=(fy.prototype.run=function(){this.df()},fy.prototype.df=function(){var t=this;this.Yu.Qu(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new uy(this.Nh),(n=this.wf(e))&&n.then(function(t){r.fs.ys(function(){return e.commit().then(function(){r.Es.resolve(t)}).catch(function(t){r.Tf(t)})})}).catch(function(t){r.Tf(t)}),[2]})})})},fy.prototype.wf=function(t){try{var e=this.updateFunction(t);return!ro(e)&&e.catch&&e.then?e:(this.Es.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Es.reject(t),null}},fy.prototype.Tf=function(t){var e=this;0<this.ff&&this.Ef(t)?(--this.ff,this.fs.ys(function(){return e.df(),Promise.resolve()})):this.Es.reject(t)},fy.prototype.Ef=function(t){return"FirebaseError"===t.name&&("aborted"===(t=t.code)||"failed-precondition"===t||!_u(t))},fy),cy=(hy.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.N.promise];case 1:return[2,(t.sent(),{fs:this.fs,bu:this.bu,clientId:this.clientId,credentials:this.credentials,s_:this.user,Cl:100,xl:this.xl})]}})})},hy.prototype.mf=function(t){var e=this;this.If=t,this.N.promise.then(function(){return e.If(e.user)})},hy.prototype.Af=function(){if(this.fs.Rf)throw new si(oi.FAILED_PRECONDITION,"The client has already been terminated.")},hy.prototype.terminate=function(){var t=this;this.fs.Pf();var n=new Ca;return this.fs.yf(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.gf?[4,this.gf.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Vf?[4,this.Vf.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.D(),n.resolve(),[3,6];case 5:return e=$a(t.sent(),"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},hy);function hy(t,e,n,r){var i=this;this.credentials=t,this.fs=e,this.bu=n,this.xl=r,this.user=gi.UNAUTHENTICATED,this.clientId=Qr.t(),this.If=function(){},this.N=new Ca,this.credentials.S(function(t){Kr("FirestoreClient","Received user=",t.uid),i.user=t,i.If(t),i.N.resolve()})}function fy(t,e,n,r){this.fs=t,this.Nh=e,this.updateFunction=n,this.Es=r,this.ff=5,this.Yu=new vl(this.fs,"transaction_retry")}function ly(t){this.Nh=t,this.sf=new Map,this.mutations=[],this.rf=!1,this.cf=null,this.af=new Set}function py(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return i.fs.pf(),Kr("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.s_,i.mf(function(e){n.isEqual(e)||(n=e,i.fs.bo(function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,of(o.xh,e)];case 1:return t.sent(),[2]}})})}))}),o.persistence.yo(function(){return i.terminate()}),i.Vf=o,[2]}})})}function dy(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return r.fs.pf(),[4,yy(r)];case 1:return e=t.sent(),Kr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.mf(function(t){return r.fs.bo(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).fs.pf(),Kr("RemoteStore","RemoteStore received new credentials"),n=Rl(e),e.Mh.add(3),[4,Sl(e)];case 1:return t.sent(),n&&e.Bh.set("Unknown"),[4,e.Fh.u_(i)];case 2:return t.sent(),e.Mh.delete(3),[4,xl(e)];case 3:return t.sent(),[2]}})})}(i.vl,t)})}),r.gf=i,[2]}})})}function yy(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.Vf?[3,2]:(Kr("FirestoreClient","Using default OfflineComponentProvider"),[4,py(e,new Pp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.Vf]}})})}function vy(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.gf?[3,2]:(Kr("FirestoreClient","Using default OnlineComponentProvider"),[4,dy(e,new Mp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.gf]}})})}function gy(t){return yy(t).then(function(t){return t.persistence})}function my(t){return yy(t).then(function(t){return t.xh})}function by(t){return vy(t).then(function(t){return t.vl})}function wy(t){return vy(t).then(function(t){return t.fa})}function Ey(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,vy(r)];case 1:return e=t.sent(),[2,((n=e.Sl).Yh=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=Sp(s),(o=e.Ol.get(u))?(n=o.targetId,e.Dl.ka(n),r=o.view.pl(),[3,4]):[3,1];case 1:return[4,af(e.xh,Is(u))];case 2:return i=t.sent(),o=e.Dl.ka(i.targetId),n=i.targetId,[4,dp(e,u,n,"current"===o)];case 3:r=t.sent(),e.jl&&Ol(e.vl,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.fa),n.tl=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ol.get(o),1<(r=e.kl.get(n.targetId)).length?[2,(e.kl.set(n.targetId,r.filter(function(t){return!Ts(t,o)})),void e.Ol.delete(o))]:e.jl?(e.Dl.$a(n.targetId),e.Dl.Ca(n.targetId)?[3,2]:[4,cf(e.xh,n.targetId,!1).then(function(){e.Dl.Ba(n.targetId),Dl(e.vl,n.targetId),Ep(e,n.targetId)}).catch(nh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Ep(e,n.targetId),[4,cf(e.xh,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.fa),n)]}})})}function Iy(n,r,i){var t=this;void 0===i&&(i={});var o=new Ca;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new Bp({next:function(t){r.ys(function(){return Xl(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new si(oi.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new si(oi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new Ql(ys(i.path),t,{includeMetadataChanges:!0,cl:!0});return Wl(n,u)},[4,Ey(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.fs,r,i,o])]}})})}),o.promise}function _y(n,r,i){var t=this;void 0===i&&(i={});var o=new Ca;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new Bp({next:function(t){n.ys(function(){return Xl(e,s)}),t.fromCache&&"server"===r.source?i.reject(new si(oi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new Ql(t,o,{includeMetadataChanges:!0,cl:!0});return Wl(e,s)},[4,Ey(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.fs,r,i,o])]}})})}),o.promise}var Ty,Ny=(Object.defineProperty(Sy.prototype,"Rf",{get:function(){return this.Sf},enumerable:!1,configurable:!0}),Sy.prototype.ys=function(t){this.enqueue(t)},Sy.prototype.yf=function(t){this.Of(),this.kf(t)},Sy.prototype.Pf=function(){var t;this.Sf||(this.Sf=!0,(t=hl())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ff))},Sy.prototype.enqueue=function(t){return this.Of(),this.Sf?new Promise(function(t){}):this.kf(t)},Sy.prototype.bo=function(t){var e=this;this.ys(function(){return e.vf.push(t),e.Mf()})},Sy.prototype.Mf=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.vf.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.vf[0]()];case 2:return t.sent(),this.vf.shift(),this.Yu.reset(),[3,4];case 3:if(!Ka(e=t.sent()))throw e;return Kr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.vf.length&&this.Yu.Qu(function(){return n.Mf()}),t.label=5;case 5:return[2]}})})},Sy.prototype.kf=function(t){var r=this,e=this.bf.then(function(){return r.xf=!0,t().catch(function(t){throw r.Cf=t,r.xf=!1,zr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.xf=!1,t})});return this.bf=e},Sy.prototype.Ir=function(t,e,n){var r=this;return this.Of(),-1<this.Nf.indexOf(t)&&(e=0),n=Qa.Is(this,t,e,n,function(t){return r.$f(t)}),this.Df.push(n),n},Sy.prototype.Of=function(){this.Cf&&Xr()},Sy.prototype.pf=function(){},Sy.prototype.Lf=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.bf];case 1:t.sent(),t.label=2;case 2:if(e!==this.bf)return[3,0];t.label=3;case 3:return[2]}})})},Sy.prototype.Bf=function(t){for(var e=0,n=this.Df;e<n.length;e++)if(n[e].ds===t)return!0;return!1},Sy.prototype.qf=function(r){var i=this;return this.Lf().then(function(){i.Df.sort(function(t,e){return t.ws-e.ws});for(var t=0,e=i.Df;t<e.length;t++){var n=e[t];if(n.Ps(),"all"!==r&&n.ds===r)break}return i.Lf()})},Sy.prototype.Uf=function(t){this.Nf.push(t)},Sy.prototype.$f=function(t){t=this.Df.indexOf(t),this.Df.splice(t,1)},Sy),Ay=(h(xy,Ty=sd),xy.prototype.N_=function(){return this.jf||Dy(this),this.jf.terminate()},xy);function xy(t,e,n){var r=this;return(r=Ty.call(this,t,e)||this).Qf=n,r.Kf=new Ny,r.R_="name"in t?t.name:"[DEFAULT]",r}function Sy(){var e=this;this.bf=Promise.resolve(),this.vf=[],this.Sf=!1,this.Df=[],this.Cf=null,this.xf=!1,this.Nf=[],this.Yu=new vl(this,"async_queue_retry"),this.Ff=function(){var t=hl();t&&Kr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Yu.ju()};var t=hl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ff)}function Oy(t){return t.jf||Dy(t),t.jf.Af(),t.jf}function Dy(t){var e,n,r=t.x_(),r=(e=t.g_,n=t.R_,new yi(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.jf=new cy(t.V_,t.Kf,r,t.Qf)}function ky(n,r,i){var t=this,o=new Ca;return n.fs.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,py(n,i)];case 1:return t.sent(),[4,dy(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===oi.FAILED_PRECONDITION||t.code===oi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function Ly(t){if(t.b_||t.v_)throw new si(oi.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Py,o=(Uy.prototype.Wf=function(t,e){switch(void 0===e&&(e="none"),so(t)){case 0:return null;case 1:return t.booleanValue;case 2:return $i(t.integerValue||t.doubleValue);case 3:return this.Gf(t.timestampValue);case 4:return this.zf(t,e);case 5:return t.stringValue;case 6:return this.Hf(to(t.bytesValue));case 7:return this.Jf(t.referenceValue);case 8:return this.Yf(t.geoPointValue);case 9:return this.Xf(t.arrayValue,e);case 10:return this.Zf(t.mapValue,e);default:throw Xr()}},Uy.prototype.Zf=function(t,n){var r=this,i={};return Ji(t.fields||{},function(t,e){i[t]=r.Wf(e,n)}),i},Uy.prototype.Yf=function(t){return new bd($i(t.latitude),$i(t.longitude))},Uy.prototype.Xf=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.Wf(t,e)})},Uy.prototype.zf=function(t,e){switch(e){case"previous":var n=function t(e){return eo(e=e.mapValue.fields.__previous_value__)?t(e):e}(t);return null==n?null:this.Wf(n,e);case"estimate":return this.Gf(no(t));default:return null}},Uy.prototype.Gf=function(t){return t=Zi(t),new Ci(t.seconds,t.nanos)},Uy.prototype.td=function(t,e){var n=Mi.ct(t);return Yr(La(n)),t=new vi(n.get(1),n.get(3)),n=new Fi(n.X(5)),t.isEqual(e)||zr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},Uy),Cy=(Object.defineProperty(Vy.prototype,"id",{get:function(){return this.O_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(Vy.prototype,"ref",{get:function(){return new ud(this.ed,this.F_,this.O_)},enumerable:!1,configurable:!0}),Vy.prototype.exists=function(){return null!==this.sd},Vy.prototype.data=function(){if(this.sd){if(this.F_){var t=new Ry(this.ed,this.nd,this.O_,this.sd,null);return this.F_.fromFirestore(t)}return this.nd.Wf(this.sd.vt())}},Vy.prototype.get=function(t){if(this.sd&&null!==(t=this.sd.data().field(Fy("DocumentSnapshot.get",t))))return this.nd.Wf(t)},Vy),Ry=(h(My,Py=Cy),My.prototype.data=function(){return Py.prototype.data.call(this)},My);function My(){return null!==Py&&Py.apply(this,arguments)||this}function Vy(t,e,n,r,i){this.ed=t,this.nd=e,this.O_=n,this.sd=r,this.F_=i}function Uy(){}function Fy(t,e){return"string"==typeof e?iy(t,e):(e instanceof ai?e._:e).A_}function qy(t){if(gs(t)&&0===t.Nt.length)throw new si(oi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function jy(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r].rd(t);return t}var By,Hy,Gy,Ky,zy,Jy=(h(nv,zy=je=function(){}),nv.prototype.rd=function(t){var e=kd(t.firestore),e=function(t,e,n,r,i,o){if(r.ht()){if("array-contains"===i||"array-contains-any"===i)throw new si(oi.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){ov(o,i);for(var s=[],u=0,a=o;u<a.length;u++){var c=a[u];s.push(iv(n,t,c))}h={arrayValue:{values:s}}}else h=iv(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||ov(o,i),h=Qd(e,"where",o,"in"===i||"not-in"===i);var h=Uo.create(r,i,h);return function(t,e){if(e.xt()){var n=bs(t);if(null!==n&&!n.isEqual(e.field))throw new si(oi.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");null!==(n=ms(t))&&sv(0,e.field,n)}if(null!==(t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw t===e.op?new si(oi.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new si(oi.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t.M_,e,t.firestore.g_,this.od,this.ad,this.ud);return new ad(t.firestore,t.F_,(e=(t=t.M_).filters.concat([e]),new ps(t.path,t.collectionGroup,t.Nt.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},nv),Wy=(h(ev,Ky=je),ev.prototype.rd=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new si(oi.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new si(oi.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new hs(e,n);return e=r,null!==ms(n=t)||null!==(t=bs(n))&&sv(0,t,e.field),r}(t.M_,this.od,this.hd);return new ad(t.firestore,t.F_,(e=(t=t.M_).Nt.concat([e]),new ps(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},ev),Xy=(h(tv,Gy=je),tv.prototype.rd=function(t){return new ad(t.firestore,t.F_,_s(t.M_,this.ld,this._d))},tv),Yy=(h($y,Hy=je),$y.prototype.rd=function(t){var e=rv(t,this.type,this.fd,this.dd);return new ad(t.firestore,t.F_,(t=t.M_,new ps(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},$y),Qy=(h(Zy,By=je),Zy.prototype.rd=function(t){var e=rv(t,this.type,this.fd,this.dd);return new ad(t.firestore,t.F_,(t=t.M_,new ps(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},Zy);function Zy(t,e,n){var r=this;return(r=By.call(this)||this).type=t,r.fd=e,r.dd=n,r}function $y(t,e,n){var r=this;return(r=Hy.call(this)||this).type=t,r.fd=e,r.dd=n,r}function tv(t,e,n){var r=this;return(r=Gy.call(this)||this).type=t,r.ld=e,r._d=n,r}function ev(t,e){var n=this;return(n=Ky.call(this)||this).od=t,n.hd=e,n.type="orderBy",n}function nv(t,e,n){var r=this;return(r=zy.call(this)||this).od=t,r.ad=e,r.ud=n,r.type="where",r}function rv(t,c,e,n){if(e[0]instanceof ai&&(e[0]=e[0]._),e[0]instanceof Cy)return function(t,e,n,r){if(!n)throw new si(oi.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Es(t);o<s.length;o++){var u=s[o];if(u.field.ht())i.push(lo(e,n.key));else{var a=n.field(u.field);if(eo(a))throw new si(oi.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a)throw u=u.field.ot(),new si(oi.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.");i.push(a)}}return new is(i,r)}(t.M_,t.firestore.g_,e[0].sd,n);var r=kd(t.firestore);return function(t,e,n,r,i,o){var s=t.Nt;if(i.length>s.length)throw new si(oi.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.ht()){if("string"!=typeof c)throw new si(oi.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!ws(t)&&-1!==c.indexOf("/"))throw new si(oi.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Mi.ct(c));if(!Fi.Tt(h))throw new si(oi.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Fi(h),u.push(lo(e,h))}else c=Qd(n,r,c),u.push(c)}return new is(u,o)}(t.M_,t.firestore.g_,r,c,e,n)}function iv(t,e,n){if(n instanceof ai&&(n=n._),"string"==typeof n){if(""===n)throw new si(oi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ws(e)&&-1!==n.indexOf("/"))throw new si(oi.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(e=e.path.child(Mi.ct(n)),!Fi.Tt(e))throw new si(oi.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return lo(t,new Fi(e))}if(n instanceof ud)return lo(t,n.O_);throw new si(oi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+td(n)+".")}function ov(t,e){if(!Array.isArray(t)||0===t.length)throw new si(oi.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new si(oi.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function sv(t,e,n){if(!n.isEqual(e))throw new si(oi.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function uv(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}function av(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var cv,hv,fv,lv=(h(Ev,fv=o),Ev.prototype.Hf=function(t){return new ui(t)},Ev.prototype.Jf=function(t){return t=this.td(t,this.firestore.g_),new ud(this.firestore,null,t)},Ev),pv=(wv.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},wv),dv=(h(bv,hv=Cy),bv.prototype.exists=function(){return hv.prototype.exists.call(this)},bv.prototype.data=function(t){if(void 0===t&&(t={}),this.sd){if(this.F_){var e=new yv(this.ed,this.nd,this.O_,this.sd,this.metadata,null);return this.F_.fromFirestore(e,t)}return this.nd.Wf(this.sd.vt(),t.serverTimestamps)}},bv.prototype.get=function(t,e){if(void 0===e&&(e={}),this.sd&&null!==(t=this.sd.data().field(Fy("DocumentSnapshot.get",t))))return this.nd.Wf(t,e.serverTimestamps)},bv),yv=(h(mv,cv=dv),mv.prototype.data=function(t){return void 0===t&&(t={}),cv.prototype.data.call(this,t)},mv),vv=(Object.defineProperty(gv.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(gv.prototype,"size",{get:function(){return this.Td.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(gv.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),gv.prototype.forEach=function(e,n){var r=this;this.Td.docs.forEach(function(t){e.call(n,new yv(r.ed,r.nd,t.key,t,new pv(r.Td.Ce.has(t.key),r.Td.fromCache),r.query.F_))})},gv.prototype.docChanges=function(t){if(void 0===t&&(t={}),(t=!!t.includeMetadataChanges)&&this.Td.Ne)throw new si(oi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Ed&&this.Id===t||(this.Ed=function(i,e){if(i.Td.De.nt()){var n=0;return i.Td.docChanges.map(function(t){var e=new yv(i.ed,i.nd,t.doc.key,t.doc,new pv(i.Td.Ce.has(t.doc.key),i.Td.fromCache),i.query.F_);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i.Td.De;return i.Td.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new yv(i.ed,i.nd,t.doc.key,t.doc,new pv(i.Td.Ce.has(t.doc.key),i.Td.fromCache),i.query.F_),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xr()}}(),doc:e,oldIndex:n,newIndex:r}})}(this,t),this.Id=t),this.Ed},gv);function gv(t,e,n,r){this.ed=t,this.nd=e,this.Td=r,this.metadata=new pv(r.hasPendingWrites,r.fromCache),this.query=n}function mv(){return null!==cv&&cv.apply(this,arguments)||this}function bv(t,e,n,r,i,o){var s=this;return(s=hv.call(this,t,e,n,r,o)||this).ed=t,s.wd=t,s.metadata=i,s}function wv(t,e){this.hasPendingWrites=t,this.fromCache=e}function Ev(t){var e=this;return(e=fv.call(this)||this).firestore=t,e}function Iv(t,e){return t instanceof dv&&e instanceof dv?t.ed===e.ed&&t.O_.isEqual(e.O_)&&(null===t.sd?null===e.sd:t.sd.isEqual(e.sd))&&t.F_===e.F_:t instanceof vv&&e instanceof vv&&t.ed===e.ed&&md(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.Td.isEqual(e.Td)}var _v,Tv=(h(Nv,_v=o),Nv.prototype.Hf=function(t){return new ui(t)},Nv.prototype.Jf=function(t){return t=this.td(t,this.firestore.g_),new ud(this.firestore,null,t)},Nv);function Nv(t){var e=this;return(e=_v.call(this)||this).firestore=t,e}function Av(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=ed(t,ud);var o=ed(t.firestore,Ay),s=kd(o);return e instanceof ai&&(e=e._),Sv(o,[("string"==typeof e||e instanceof Gp?Yd(s,"updateDoc",t.O_,e,n,r):Xd(s,"updateDoc",t.O_,e)).q_(t.O_,$s.exists(!0))])}function xv(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e instanceof ai&&(e=e._);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||uv(n[i])||(r=n[i],i++);var o,s,u,a,c,h,f={includeMetadataChanges:r.includeMetadataChanges};return uv(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof ud?(u=ed(e.firestore,Ay),a=ys(e.O_.path),h={next:function(t){n[i]&&n[i](Ov(u,e,t))},error:n[i+1],complete:n[i+2]}):(s=ed(e,ad),u=ed(s.firestore,Ay),a=s.M_,c=new Tv(u),h={next:function(t){n[i]&&n[i](new vv(u,c,s,t))},error:n[i+1],complete:n[i+2]},qy(e.M_)),function(n,t,e){var r=this,i=new Bp(h),o=new Ql(t,i,e);return n.fs.ys(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Wl,[4,Ey(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.l_(),n.fs.ys(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Xl,[4,Ey(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(Oy(u),a,f)}function Sv(t,e){return function(n,r){var t=this,i=new Ca;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=yp,[4,wy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(Oy(t),e)}function Ov(t,e,n){var r=n.docs.get(e.O_),i=new Tv(t);return new dv(t,i,e.O_,r,new pv(n.hasPendingWrites,n.fromCache),e.F_)}var Dv=(kv.prototype.set=function(t,e,n){return this.yd(),e=av((t=Lv(t,this.ed)).F_,e,n),n=Ld(this.Pd,"WriteBatch.set",t.O_,e,null!==t.F_,n),this.Ad.push(n.q_(t.O_,$s.jt())),this},kv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this.yd(),t=Lv(t,this.ed),e instanceof ai&&(e=e._),e="string"==typeof e||e instanceof Gp?Yd(this.Pd,"WriteBatch.update",t.O_,e,n,r):Xd(this.Pd,"WriteBatch.update",t.O_,e),this.Ad.push(e.q_(t.O_,$s.exists(!0))),this},kv.prototype.delete=function(t){return this.yd(),t=Lv(t,this.ed),this.Ad=this.Ad.concat(new bu(t.O_,$s.jt())),this},kv.prototype.commit=function(){return this.yd(),this.Rd=!0,0<this.Ad.length?this.md(this.Ad):Promise.resolve()},kv.prototype.yd=function(){if(this.Rd)throw new si(oi.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},kv);function kv(t,e){this.ed=t,this.md=e,this.Ad=[],this.Rd=!1,this.Pd=kd(t)}function Lv(t,e){if(t instanceof ai&&(t=t._),t.firestore!==e)throw new si(oi.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Pv,Cv,Rv,Mv=(Gv.prototype.get=function(t){var e=this,n=Lv(t,this.ed),r=new lv(this.ed);return this.gd.uf([n.O_]).then(function(t){if(!t||1!==t.length)return Xr();if((t=t[0])instanceof xo)return new Cy(e.ed,r,n.O_,null,n.F_);if(t instanceof Ao)return new Cy(e.ed,r,t.key,t,n.F_);throw Xr()})},Gv.prototype.set=function(t,e,n){return e=av((t=Lv(t,this.ed)).F_,e,n),n=Ld(this.Pd,"Transaction.set",t.O_,e,null!==t.F_,n),this.gd.set(t.O_,n),this},Gv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t=Lv(t,this.ed),e instanceof ai&&(e=e._),e="string"==typeof e||e instanceof Gp?Yd(this.Pd,"Transaction.update",t.O_,e,n,r):Xd(this.Pd,"Transaction.update",t.O_,e),this.gd.update(t.O_,e),this},Gv.prototype.delete=function(t){return t=Lv(t,this.ed),this.gd.delete(t.O_),this},h(Hv,Rv=Gv),Hv.prototype.get=function(t){var e=this,n=Lv(t,this.ed),r=new Tv(this.ed);return Rv.prototype.get.call(this,t).then(function(t){return new dv(e.ed,r,n.O_,t.sd,new pv(!1,!1),n.F_)})},Hv),Vv=(Bv.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Ly(t=ed(t,Ay));var n=Oy(t),r=t.x_();return ky(n,t=new Mp,new Cp(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._,{forceOwnership:e})},Bv.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Ly(t=ed(t,Ay));var e=Oy(t),n=t.x_();return ky(e,t=new Mp,new Rp(t,n.cacheSizeBytes))}(t._)},Bv.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n.b_&&!n.v_)throw new si(oi.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new Ca;return n.Kf.yf(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Va.jn()?(e=n+"main",[4,Va.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(Jh(n.g_,n.R_))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t._)},Bv),Uv=(h(jv,Cv=ai),Object.defineProperty(jv.prototype,"g_",{get:function(){return this._.g_},enumerable:!1,configurable:!0}),jv.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._.C_()),t)).merge,this._.D_(t)},jv.prototype.useEmulator=function(t,e){var n=this._,r=t;t=e,"firestore.googleapis.com"!==(e=(n=ed(n,sd)).C_()).host&&e.host!==r&&Jr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n.D_(Object.assign(Object.assign({},e),{host:r+":"+t,ssl:!1}))},jv.prototype.enableNetwork=function(){return function(r){var t=this;return r.fs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,gy(r)];case 1:return e=t.sent(),[4,by(r)];case 2:return n=t.sent(),[2,(e.Vo(!0),(t=n).Mh.delete(0),xl(t))]}})})})}(Oy(ed(this._,Ay)))},jv.prototype.disableNetwork=function(){return function(r){var t=this;return r.fs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,gy(r)];case 1:return e=t.sent(),[4,by(r)];case 2:return n=t.sent(),[2,(e.Vo(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Mh.add(0),[4,Sl(e)];case 1:return t.sent(),e.Bh.set("Offline"),[2]}})})}(n))]}})})})}(Oy(ed(this._,Ay)))},jv.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Qp("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Vd.enableMultiTabIndexedDbPersistence(this):this.Vd.enableIndexedDbPersistence(this,n)},jv.prototype.clearPersistence=function(){return this.Vd.clearIndexedDbPersistence(this)},jv.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._._delete()},jv.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new Ca;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=mp,[4,wy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Oy(ed(this._,Ay)))},jv.prototype.onSnapshotsInSync=function(t){return function(n,t){var e=this,r=new Bp(t);return n.fs.ys(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Jh.add(e),e.next()},[4,Ey(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.l_(),n.fs.ys(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Jh.delete(e)},[4,Ey(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(Oy(ed(this._,Ay)),uv(t)?t:{next:t})},Object.defineProperty(jv.prototype,"app",{get:function(){if(!this.pd)throw new si(oi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.pd},enumerable:!1,configurable:!0}),jv.prototype.collection=function(t){try{return new dg(this,yd(this._,t))}catch(t){throw tg(t,"collection()","Firestore.collection()")}},jv.prototype.doc=function(t){try{return new Yv(this,vd(this._,t))}catch(t){throw tg(t,"doc()","Firestore.doc()")}},jv.prototype.collectionGroup=function(t){try{return new fg(this,function(t,e){if(t=ed(t,sd),Xp("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new si(oi.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ad(t,null,new ps(Mi.at(),e))}(this._,t))}catch(t){throw tg(t,"collectionGroup()","Firestore.collectionGroup()")}},jv.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new Ca;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,vy(n).then(function(t){return t.Nh})];case 1:return e=t.sent(),new ay(n.fs,e,r,i).run(),[2]}})})}),i.promise}(Oy(n=this._),function(t){return t=new Mv(n,t),e(new Wv(r,t))})},jv.prototype.batch=function(){var e=this;return Oy(this._),new Xv(new Dv(this._,function(t){return Sv(e._,t)}))},jv.prototype.loadBundle=function(t){throw new si(oi.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},jv.prototype.namedQuery=function(t){throw new si(oi.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},jv),Fv=(h(qv,Pv=o),qv.prototype.Hf=function(t){return new di(new ui(t))},qv.prototype.Jf=function(t){return t=this.td(t,this.firestore.g_),Yv.bd(t,this.firestore,null)},qv);function qv(t){var e=this;return(e=Pv.call(this)||this).firestore=t,e}function jv(t,e,n){var r=this;return(r=Cv.call(this,e)||this).Vd=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof vi||(r.pd=t),r}function Bv(){}function Hv(t,e){var n=this;return(n=Rv.call(this,t,e)||this).ed=t,n}function Gv(t,e){this.ed=t,this.gd=e,this.Pd=kd(t)}var Kv,zv,Jv,Wv=(h($v,Jv=ai),$v.prototype.get=function(t){var e=this,n=Eg(t);return this._.get(n).then(function(t){return new cg(e.ed,new dv(e.ed._,e.nd,t.O_,t.sd,t.metadata,n.F_))})},$v.prototype.set=function(t,e,n){return t=Eg(t),n?(Yp("Transaction.set",n),this._.set(t,e,n)):this._.set(t,e),this},$v.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Eg(t);return 2===arguments.length?this._.update(o,e):(t=this._).update.apply(t,f([o,e,n],r)),this},$v.prototype.delete=function(t){return t=Eg(t),this._.delete(t),this},$v),Xv=(h(Zv,zv=ai),Zv.prototype.set=function(t,e,n){return t=Eg(t),n?(Yp("WriteBatch.set",n),this._.set(t,e,n)):this._.set(t,e),this},Zv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Eg(t);return 2===arguments.length?this._.update(o,e):(t=this._).update.apply(t,f([o,e,n],r)),this},Zv.prototype.delete=function(t){return t=Eg(t),this._.delete(t),this},Zv.prototype.commit=function(){return this._.commit()},Zv),Yv=(h(Qv,Kv=ai),Qv.vd=function(t,e,n){if(t.length%2!=0)throw new si(oi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.ot()+" has "+t.length);return new Qv(e,new ud(e._,n,new Fi(t)))},Qv.bd=function(t,e,n){return new Qv(e,new ud(e._,n,t))},Object.defineProperty(Qv.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(Qv.prototype,"parent",{get:function(){return new dg(this.firestore,this._.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Qv.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Qv.prototype.collection=function(t){try{return new dg(this.firestore,yd(this._,t))}catch(t){throw tg(t,"collection()","DocumentReference.collection()")}},Qv.prototype.isEqual=function(t){return t instanceof ai&&(t=t._),t instanceof ud&&gd(this._,t)},Qv.prototype.set=function(t,e){e=Yp("DocumentReference.set",e);try{return function(t,e,n){t=ed(t,ud);var r=ed(t.firestore,Ay),e=av(t.F_,e,n);return Sv(r,[Ld(kd(r),"setDoc",t.O_,e,null!==t.F_,n).q_(t.O_,$s.jt())])}(this._,t,e)}catch(t){throw tg(t,"setDoc()","DocumentReference.set()")}},Qv.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Av(this._,t):Av.apply(void 0,f([this._,t,e],n))}catch(t){throw tg(t,"updateDoc()","DocumentReference.update()")}},Qv.prototype.delete=function(){return Sv(ed((t=this._).firestore,Ay),[new bu(t.O_,$s.jt())]);var t},Qv.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=eg(t),i=ng(t,function(t){return new cg(e.firestore,new dv(e.firestore._,e.nd,t.O_,t.sd,t.metadata,e._.F_))});return xv(this._,r,i)},Qv.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=ed(e,ud);var n=ed(e.firestore,Ay),t=Oy(n),r=new Tv(n);return function(n,r){var t=this,i=new Ca;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(o,s,u){return y(this,void 0,void 0,function(){var r,i;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Ic.Jo(t,e)}))];case 1:return(i=t.sent())instanceof Ao?u.resolve(i):i instanceof xo?u.resolve(null):u.reject(new si(oi.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=$a(r,"Failed to get document '"+s+" from cache"),u.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,my(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e.O_).then(function(t){return new dv(n,r,e.O_,t,new pv(t instanceof Ao&&t.bt,!0),e.F_)})}:"server"===(null==t?void 0:t.source)?function(e){e=ed(e,ud);var n=ed(e.firestore,Ay);return Iy(Oy(n),e.O_,{source:"server"}).then(function(t){return Ov(n,e,t)})}:function(e){e=ed(e,ud);var n=ed(e.firestore,Ay);return Iy(Oy(n),e.O_).then(function(t){return Ov(n,e,t)})})(this._).then(function(t){return new cg(e.firestore,new dv(e.firestore._,e.nd,t.O_,t.sd,t.metadata,e._.F_))})},Qv.prototype.withConverter=function(t){return new Qv(this.firestore,this._.withConverter(t))},Qv);function Qv(t,e){var n=this;return(n=Kv.call(this,e)||this).firestore=t,n.nd=new Fv(t),n}function Zv(){return null!==zv&&zv.apply(this,arguments)||this}function $v(t,e){var n=this;return(n=Jv.call(this,e)||this).ed=t,n.nd=new Fv(t),n}function tg(t,e,n){return t.message=t.message.replace(e,n),t}function eg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!uv(r))return r}return{}}function ng(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=uv(t[0])?t[0]:uv(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var rg,ig,og,sg,ug,ag,cg=(h(wg,ag=ai),Object.defineProperty(wg.prototype,"ref",{get:function(){return new Yv(this.ed,this._.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(wg.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(wg.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(wg.prototype,"exists",{get:function(){return this._.exists()},enumerable:!1,configurable:!0}),wg.prototype.data=function(t){return this._.data(t)},wg.prototype.get=function(t,e){return this._.get(t,e)},wg.prototype.isEqual=function(t){return Iv(this._,t._)},wg),hg=(h(bg,ug=cg),bg.prototype.data=function(t){return this._.data(t)},bg),fg=(h(mg,sg=ai),mg.prototype.where=function(t,e,n){try{return new mg(this.firestore,jy(this._,(r=n,i=e,o=Fy("where",t),new Jy(o,i,r))))}catch(t){throw tg(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},mg.prototype.orderBy=function(n,t){try{return new mg(this.firestore,jy(this._,function(t){void 0===t&&(t="asc");var e=t,t=Fy("orderBy",n);return new Wy(t,e)}(t)))}catch(n){throw tg(n,/(orderBy|where)\(\)/,"Query.$1()")}},mg.prototype.limit=function(t){try{return new mg(this.firestore,jy(this._,(nd("limit",e=t),new Xy("limit",e,"F"))))}catch(t){throw tg(t,"limit()","Query.limit()")}var e},mg.prototype.limitToLast=function(t){try{return new mg(this.firestore,jy(this._,(nd("limitToLast",e=t),new Xy("limitToLast",e,"L"))))}catch(t){throw tg(t,"limitToLast()","Query.limitToLast()")}var e},mg.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new mg(this.firestore,jy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Yy("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw tg(t,"startAt()","Query.startAt()")}},mg.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new mg(this.firestore,jy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Yy("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw tg(t,"startAfter()","Query.startAfter()")}},mg.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new mg(this.firestore,jy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Qy("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw tg(t,"endBefore()","Query.endBefore()")}},mg.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new mg(this.firestore,jy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Qy("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw tg(t,"endAt()","Query.endAt()")}},mg.prototype.isEqual=function(t){return md(this._,t._)},mg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=ed(e,ad);var n=ed(e.firestore,Ay),t=Oy(n),r=new Tv(n);return function(n,r){var t=this,i=new Ca;return n.fs.ys(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,hf(i,o,!0)];case 1:return r=t.sent(),e=new ap(o,r.Pc),n=e.Il(r.documents),n=e.Ti(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=$a(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,my(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e.M_).then(function(t){return new vv(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=ed(e,ad);var n=ed(e.firestore,Ay),t=Oy(n),r=new Tv(n);return _y(t,e.M_,{source:"server"}).then(function(t){return new vv(n,r,e,t)})}:function(e){e=ed(e,ad);var n=ed(e.firestore,Ay),t=Oy(n),r=new Tv(n);return qy(e.M_),_y(t,e.M_).then(function(t){return new vv(n,r,e,t)})})(this._).then(function(t){return new pg(e.firestore,new vv(e.firestore._,e.nd,e._,t.Td))})},mg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=eg(t),i=ng(t,function(t){return new pg(e.firestore,new vv(e.firestore._,e.nd,e._,t.Td))});return xv(this._,r,i)},mg.prototype.withConverter=function(t){return new mg(this.firestore,this._.withConverter(t))},mg),lg=(h(gg,og=ai),Object.defineProperty(gg.prototype,"type",{get:function(){return this._.type},enumerable:!1,configurable:!0}),Object.defineProperty(gg.prototype,"doc",{get:function(){return new hg(this.ed,this._.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(gg.prototype,"oldIndex",{get:function(){return this._.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(gg.prototype,"newIndex",{get:function(){return this._.newIndex},enumerable:!1,configurable:!0}),gg),pg=(h(vg,ig=ai),Object.defineProperty(vg.prototype,"query",{get:function(){return new fg(this.ed,this._.query)},enumerable:!1,configurable:!0}),Object.defineProperty(vg.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(vg.prototype,"size",{get:function(){return this._.size},enumerable:!1,configurable:!0}),Object.defineProperty(vg.prototype,"empty",{get:function(){return this._.empty},enumerable:!1,configurable:!0}),Object.defineProperty(vg.prototype,"docs",{get:function(){var e=this;return this._.docs.map(function(t){return new hg(e.ed,t)})},enumerable:!1,configurable:!0}),vg.prototype.docChanges=function(t){var e=this;return this._.docChanges(t).map(function(t){return new lg(e.ed,t)})},vg.prototype.forEach=function(e,n){var r=this;this._.forEach(function(t){e.call(n,new hg(r.ed,t))})},vg.prototype.isEqual=function(t){return Iv(this._,t._)},vg),dg=(h(yg,rg=fg),Object.defineProperty(yg.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(yg.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Object.defineProperty(yg.prototype,"parent",{get:function(){var t=this._.parent;return t?new Yv(this.firestore,t):null},enumerable:!1,configurable:!0}),yg.prototype.doc=function(t){try{return new Yv(this.firestore,void 0===t?vd(this._):vd(this._,t))}catch(t){throw tg(t,"doc()","CollectionReference.doc()")}},yg.prototype.add=function(t){var e,n=this,r=this._,i=t;return t=ed(r.firestore,Ay),e=vd(r),i=av(r.F_,i),Sv(t,[Ld(kd(r.firestore),"addDoc",e.O_,i,null!==r.F_,{}).q_(e.O_,$s.exists(!1))]).then(function(){return e}).then(function(t){return new Yv(n.firestore,t)})},yg.prototype.isEqual=function(t){return gd(this._,t._)},yg.prototype.withConverter=function(t){return new yg(this.firestore,this._.withConverter(t))},yg);function yg(t,e){var n=this;return(n=rg.call(this,t,e)||this).firestore=t,n._=e,n}function vg(t,e){var n=this;return(n=ig.call(this,e)||this).ed=t,n}function gg(t,e){var n=this;return(n=og.call(this,e)||this).ed=t,n}function mg(t,e){var n=this;return(n=sg.call(this,e)||this).firestore=t,n.nd=new Fv(t),n}function bg(){return null!==ug&&ug.apply(this,arguments)||this}function wg(t,e){var n=this;return(n=ag.call(this,e)||this).ed=t,n}function Eg(t){return t instanceof ai&&(t=t._),ed(t,ud)}var Ig,_g,je=(h(xg,_g=ai),xg.documentId=function(){return new xg(Ui.lt().ot())},xg.prototype.isEqual=function(t){return t instanceof ai&&(t=t._),t instanceof Gp&&this._.A_.isEqual(t.A_)},xg),o=(h(Ag,Ig=ai),Ag.serverTimestamp=function(){var t=new jd("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Ag(t)},Ag.delete=function(){var t=new Cd("deleteField");return t._methodName="FieldValue.delete",new Ag(t)},Ag.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Bd("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new Ag(n)},Ag.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hd("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new Ag(n)},Ag.increment=function(t){return(t=new Gd("increment",t))._methodName="FieldValue.increment",new Ag(t)},Ag.prototype.isEqual=function(t){return this._.isEqual(t._)},Ag),Tg=(Ng.prototype.onProgress=function(t,e,n){this.Sd={next:t,error:e,complete:n}},Ng.prototype.catch=function(t){return this.Dd.promise.catch(t)},Ng.prototype.then=function(t,e){return this.Dd.promise.then(t,e)},Ng.prototype.zl=function(t){this.Hl(t),this.Sd.complete&&this.Sd.complete(),this.Dd.resolve(t)},Ng.prototype.Yl=function(t){this.Cd.taskState="Error",this.Sd.next&&this.Sd.next(this.Cd),this.Sd.error&&this.Sd.error(t),this.Dd.reject(t)},Ng.prototype.Hl=function(t){this.Cd=t,this.Sd.next&&this.Sd.next(t)},Ng);function Ng(){this.Sd={},this.Dd=new Ca,this.Cd={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Ag(){return null!==Ig&&Ig.apply(this,arguments)||this}function xg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _g.call(this,new(Gp.bind.apply(Gp,f([void 0],t))))||this}Sg.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Sg.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Sg.prototype.setServiceProps=function(t){return this.serviceProps=t,this},N=Sg;function Sg(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}o={Firestore:Uv,GeoPoint:bd,Timestamp:Ci,Blob:di,Transaction:Wv,WriteBatch:Xv,DocumentReference:Yv,DocumentSnapshot:cg,Query:fg,QueryDocumentSnapshot:hg,QuerySnapshot:pg,CollectionReference:dg,FieldPath:je,FieldValue:o,setLogLevel:function(t){Hr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(e=e.default).INTERNAL.registerComponent(new N("firestore",function(t){var e=t.getProvider("app").getImmediate();return t=t.getProvider("auth-internal"),new Uv(e,new Ay(e,t),new Vv)},"PUBLIC").setServiceProps(Object.assign({},o))),e.registerVersion("@firebase/firestore","2.1.2-longpoll.66863f547"),Uv.prototype.loadBundle=function(t){return e=this,s=t,t=new Tg,function(n,t,r){var e,i=this,o=(e=s,t=fl(t),e=function(t){if(t instanceof Uint8Array)return jp(t,void 0);if(t instanceof ArrayBuffer)return jp(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new Hp(e,t));n.fs.ys(function(){return y(i,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Dp,[4,wy(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(Oy(e._),e.g_,t),t;var e,s},Uv.prototype.namedQuery=function(t){return function(n,r){var t=this;return n.fs.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.To.Ls(t,e)})},[4,my(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(Oy((e=this)._),t).then(function(t){return t?new fg(e,new ad(e._,null,t.query)):null});var e}}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});